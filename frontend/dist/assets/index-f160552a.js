(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();var Fb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function BF(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Zx={},AW={get exports(){return Zx},set exports(n){Zx=n}},cM={},$t={},CW={get exports(){return $t},set exports(n){$t=n}},Vi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gv=Symbol.for("react.element"),IW=Symbol.for("react.portal"),PW=Symbol.for("react.fragment"),kW=Symbol.for("react.strict_mode"),DW=Symbol.for("react.profiler"),LW=Symbol.for("react.provider"),RW=Symbol.for("react.context"),zW=Symbol.for("react.forward_ref"),OW=Symbol.for("react.suspense"),FW=Symbol.for("react.memo"),BW=Symbol.for("react.lazy"),jD=Symbol.iterator;function NW(n){return n===null||typeof n!="object"?null:(n=jD&&n[jD]||n["@@iterator"],typeof n=="function"?n:null)}var NF={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},UF=Object.assign,VF={};function Py(n,e,t){this.props=n,this.context=e,this.refs=VF,this.updater=t||NF}Py.prototype.isReactComponent={};Py.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Py.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function GF(){}GF.prototype=Py.prototype;function fI(n,e,t){this.props=n,this.context=e,this.refs=VF,this.updater=t||NF}var pI=fI.prototype=new GF;pI.constructor=fI;UF(pI,Py.prototype);pI.isPureReactComponent=!0;var qD=Array.isArray,WF=Object.prototype.hasOwnProperty,mI={current:null},HF={key:!0,ref:!0,__self:!0,__source:!0};function jF(n,e,t){var i,r={},a=null,l=null;if(e!=null)for(i in e.ref!==void 0&&(l=e.ref),e.key!==void 0&&(a=""+e.key),e)WF.call(e,i)&&!HF.hasOwnProperty(i)&&(r[i]=e[i]);var s=arguments.length-2;if(s===1)r.children=t;else if(1<s){for(var d=Array(s),m=0;m<s;m++)d[m]=arguments[m+2];r.children=d}if(n&&n.defaultProps)for(i in s=n.defaultProps,s)r[i]===void 0&&(r[i]=s[i]);return{$$typeof:Gv,type:n,key:a,ref:l,props:r,_owner:mI.current}}function UW(n,e){return{$$typeof:Gv,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function gI(n){return typeof n=="object"&&n!==null&&n.$$typeof===Gv}function VW(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var ZD=/\/+/g;function t2(n,e){return typeof n=="object"&&n!==null&&n.key!=null?VW(""+n.key):e.toString(36)}function Bb(n,e,t,i,r){var a=typeof n;(a==="undefined"||a==="boolean")&&(n=null);var l=!1;if(n===null)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(n.$$typeof){case Gv:case IW:l=!0}}if(l)return l=n,r=r(l),n=i===""?"."+t2(l,0):i,qD(r)?(t="",n!=null&&(t=n.replace(ZD,"$&/")+"/"),Bb(r,e,t,"",function(m){return m})):r!=null&&(gI(r)&&(r=UW(r,t+(!r.key||l&&l.key===r.key?"":(""+r.key).replace(ZD,"$&/")+"/")+n)),e.push(r)),1;if(l=0,i=i===""?".":i+":",qD(n))for(var s=0;s<n.length;s++){a=n[s];var d=i+t2(a,s);l+=Bb(a,e,t,d,r)}else if(d=NW(n),typeof d=="function")for(n=d.call(n),s=0;!(a=n.next()).done;)a=a.value,d=i+t2(a,s++),l+=Bb(a,e,t,d,r);else if(a==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function pw(n,e,t){if(n==null)return n;var i=[],r=0;return Bb(n,i,"","",function(a){return e.call(t,a,r++)}),i}function GW(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Ia={current:null},Nb={transition:null},WW={ReactCurrentDispatcher:Ia,ReactCurrentBatchConfig:Nb,ReactCurrentOwner:mI};Vi.Children={map:pw,forEach:function(n,e,t){pw(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return pw(n,function(){e++}),e},toArray:function(n){return pw(n,function(e){return e})||[]},only:function(n){if(!gI(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Vi.Component=Py;Vi.Fragment=PW;Vi.Profiler=DW;Vi.PureComponent=fI;Vi.StrictMode=kW;Vi.Suspense=OW;Vi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WW;Vi.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=UF({},n.props),r=n.key,a=n.ref,l=n._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,l=mI.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var s=n.type.defaultProps;for(d in e)WF.call(e,d)&&!HF.hasOwnProperty(d)&&(i[d]=e[d]===void 0&&s!==void 0?s[d]:e[d])}var d=arguments.length-2;if(d===1)i.children=t;else if(1<d){s=Array(d);for(var m=0;m<d;m++)s[m]=arguments[m+2];i.children=s}return{$$typeof:Gv,type:n.type,key:r,ref:a,props:i,_owner:l}};Vi.createContext=function(n){return n={$$typeof:RW,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:LW,_context:n},n.Consumer=n};Vi.createElement=jF;Vi.createFactory=function(n){var e=jF.bind(null,n);return e.type=n,e};Vi.createRef=function(){return{current:null}};Vi.forwardRef=function(n){return{$$typeof:zW,render:n}};Vi.isValidElement=gI;Vi.lazy=function(n){return{$$typeof:BW,_payload:{_status:-1,_result:n},_init:GW}};Vi.memo=function(n,e){return{$$typeof:FW,type:n,compare:e===void 0?null:e}};Vi.startTransition=function(n){var e=Nb.transition;Nb.transition={};try{n()}finally{Nb.transition=e}};Vi.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Vi.useCallback=function(n,e){return Ia.current.useCallback(n,e)};Vi.useContext=function(n){return Ia.current.useContext(n)};Vi.useDebugValue=function(){};Vi.useDeferredValue=function(n){return Ia.current.useDeferredValue(n)};Vi.useEffect=function(n,e){return Ia.current.useEffect(n,e)};Vi.useId=function(){return Ia.current.useId()};Vi.useImperativeHandle=function(n,e,t){return Ia.current.useImperativeHandle(n,e,t)};Vi.useInsertionEffect=function(n,e){return Ia.current.useInsertionEffect(n,e)};Vi.useLayoutEffect=function(n,e){return Ia.current.useLayoutEffect(n,e)};Vi.useMemo=function(n,e){return Ia.current.useMemo(n,e)};Vi.useReducer=function(n,e,t){return Ia.current.useReducer(n,e,t)};Vi.useRef=function(n){return Ia.current.useRef(n)};Vi.useState=function(n){return Ia.current.useState(n)};Vi.useSyncExternalStore=function(n,e,t){return Ia.current.useSyncExternalStore(n,e,t)};Vi.useTransition=function(){return Ia.current.useTransition()};Vi.version="18.2.0";(function(n){n.exports=Vi})(CW);const _I=BF($t);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HW=$t,jW=Symbol.for("react.element"),qW=Symbol.for("react.fragment"),ZW=Object.prototype.hasOwnProperty,$W=HW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,XW={key:!0,ref:!0,__self:!0,__source:!0};function qF(n,e,t){var i,r={},a=null,l=null;t!==void 0&&(a=""+t),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(l=e.ref);for(i in e)ZW.call(e,i)&&!XW.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:jW,type:n,key:a,ref:l,props:r,_owner:$W.current}}cM.Fragment=qW;cM.jsx=qF;cM.jsxs=qF;(function(n){n.exports=cM})(AW);const YW=Zx.Fragment,gr=Zx.jsx,Ma=Zx.jsxs;var HE={},jE={},JW={get exports(){return jE},set exports(n){jE=n}},Bl={},qE={},KW={get exports(){return qE},set exports(n){qE=n}},ZF={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(ce,Te){var Pe=ce.length;ce.push(Te);e:for(;0<Pe;){var Qe=Pe-1>>>1,Ne=ce[Qe];if(0<r(Ne,Te))ce[Qe]=Te,ce[Pe]=Ne,Pe=Qe;else break e}}function t(ce){return ce.length===0?null:ce[0]}function i(ce){if(ce.length===0)return null;var Te=ce[0],Pe=ce.pop();if(Pe!==Te){ce[0]=Pe;e:for(var Qe=0,Ne=ce.length,nt=Ne>>>1;Qe<nt;){var ze=2*(Qe+1)-1,et=ce[ze],Et=ze+1,Nt=ce[Et];if(0>r(et,Pe))Et<Ne&&0>r(Nt,et)?(ce[Qe]=Nt,ce[Et]=Pe,Qe=Et):(ce[Qe]=et,ce[ze]=Pe,Qe=ze);else if(Et<Ne&&0>r(Nt,Pe))ce[Qe]=Nt,ce[Et]=Pe,Qe=Et;else break e}}return Te}function r(ce,Te){var Pe=ce.sortIndex-Te.sortIndex;return Pe!==0?Pe:ce.id-Te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,s=l.now();n.unstable_now=function(){return l.now()-s}}var d=[],m=[],_=1,S=null,T=3,C=!1,P=!1,k=!1,R=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,F=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(ce){for(var Te=t(m);Te!==null;){if(Te.callback===null)i(m);else if(Te.startTime<=ce)i(m),Te.sortIndex=Te.expirationTime,e(d,Te);else break;Te=t(m)}}function G(ce){if(k=!1,N(ce),!P)if(t(d)!==null)P=!0,Oe(j);else{var Te=t(m);Te!==null&&We(G,Te.startTime-ce)}}function j(ce,Te){P=!1,k&&(k=!1,O($),$=-1),C=!0;var Pe=T;try{for(N(Te),S=t(d);S!==null&&(!(S.expirationTime>Te)||ce&&!De());){var Qe=S.callback;if(typeof Qe=="function"){S.callback=null,T=S.priorityLevel;var Ne=Qe(S.expirationTime<=Te);Te=n.unstable_now(),typeof Ne=="function"?S.callback=Ne:S===t(d)&&i(d),N(Te)}else i(d);S=t(d)}if(S!==null)var nt=!0;else{var ze=t(m);ze!==null&&We(G,ze.startTime-Te),nt=!1}return nt}finally{S=null,T=Pe,C=!1}}var Q=!1,re=null,$=-1,ne=5,ue=-1;function De(){return!(n.unstable_now()-ue<ne)}function $e(){if(re!==null){var ce=n.unstable_now();ue=ce;var Te=!0;try{Te=re(!0,ce)}finally{Te?ae():(Q=!1,re=null)}}else Q=!1}var ae;if(typeof F=="function")ae=function(){F($e)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,fe=le.port2;le.port1.onmessage=$e,ae=function(){fe.postMessage(null)}}else ae=function(){R($e,0)};function Oe(ce){re=ce,Q||(Q=!0,ae())}function We(ce,Te){$=R(function(){ce(n.unstable_now())},Te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ce){ce.callback=null},n.unstable_continueExecution=function(){P||C||(P=!0,Oe(j))},n.unstable_forceFrameRate=function(ce){0>ce||125<ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<ce?Math.floor(1e3/ce):5},n.unstable_getCurrentPriorityLevel=function(){return T},n.unstable_getFirstCallbackNode=function(){return t(d)},n.unstable_next=function(ce){switch(T){case 1:case 2:case 3:var Te=3;break;default:Te=T}var Pe=T;T=Te;try{return ce()}finally{T=Pe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ce,Te){switch(ce){case 1:case 2:case 3:case 4:case 5:break;default:ce=3}var Pe=T;T=ce;try{return Te()}finally{T=Pe}},n.unstable_scheduleCallback=function(ce,Te,Pe){var Qe=n.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?Qe+Pe:Qe):Pe=Qe,ce){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=Pe+Ne,ce={id:_++,callback:Te,priorityLevel:ce,startTime:Pe,expirationTime:Ne,sortIndex:-1},Pe>Qe?(ce.sortIndex=Pe,e(m,ce),t(d)===null&&ce===t(m)&&(k?(O($),$=-1):k=!0,We(G,Pe-Qe))):(ce.sortIndex=Ne,e(d,ce),P||C||(P=!0,Oe(j))),ce},n.unstable_shouldYield=De,n.unstable_wrapCallback=function(ce){var Te=T;return function(){var Pe=T;T=Te;try{return ce.apply(this,arguments)}finally{T=Pe}}}})(ZF);(function(n){n.exports=ZF})(KW);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $F=$t,zl=qE;function on(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var XF=new Set,$x={};function mg(n,e){ly(n,e),ly(n+"Capture",e)}function ly(n,e){for($x[n]=e,n=0;n<e.length;n++)XF.add(e[n])}var zd=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ZE=Object.prototype.hasOwnProperty,QW=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,$D={},XD={};function eH(n){return ZE.call(XD,n)?!0:ZE.call($D,n)?!1:QW.test(n)?XD[n]=!0:($D[n]=!0,!1)}function tH(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function nH(n,e,t,i){if(e===null||typeof e>"u"||tH(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Pa(n,e,t,i,r,a,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=a,this.removeEmptyString=l}var Bo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Bo[n]=new Pa(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Bo[e]=new Pa(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Bo[n]=new Pa(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Bo[n]=new Pa(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Bo[n]=new Pa(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Bo[n]=new Pa(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Bo[n]=new Pa(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Bo[n]=new Pa(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Bo[n]=new Pa(n,5,!1,n.toLowerCase(),null,!1,!1)});var yI=/[\-:]([a-z])/g;function xI(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(yI,xI);Bo[e]=new Pa(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(yI,xI);Bo[e]=new Pa(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(yI,xI);Bo[e]=new Pa(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Bo[n]=new Pa(n,1,!1,n.toLowerCase(),null,!1,!1)});Bo.xlinkHref=new Pa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Bo[n]=new Pa(n,1,!1,n.toLowerCase(),null,!0,!0)});function vI(n,e,t,i){var r=Bo.hasOwnProperty(e)?Bo[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(nH(e,t,r,i)&&(t=null),i||r===null?eH(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var qd=$F.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,mw=Symbol.for("react.element"),P_=Symbol.for("react.portal"),k_=Symbol.for("react.fragment"),wI=Symbol.for("react.strict_mode"),$E=Symbol.for("react.profiler"),YF=Symbol.for("react.provider"),JF=Symbol.for("react.context"),bI=Symbol.for("react.forward_ref"),XE=Symbol.for("react.suspense"),YE=Symbol.for("react.suspense_list"),SI=Symbol.for("react.memo"),Of=Symbol.for("react.lazy"),KF=Symbol.for("react.offscreen"),YD=Symbol.iterator;function L0(n){return n===null||typeof n!="object"?null:(n=YD&&n[YD]||n["@@iterator"],typeof n=="function"?n:null)}var us=Object.assign,n2;function dx(n){if(n2===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);n2=e&&e[1]||""}return`
`+n2+n}var i2=!1;function r2(n,e){if(!n||i2)return"";i2=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(m){var i=m}Reflect.construct(n,[],e)}else{try{e.call()}catch(m){i=m}n.call(e.prototype)}else{try{throw Error()}catch(m){i=m}n()}}catch(m){if(m&&i&&typeof m.stack=="string"){for(var r=m.stack.split(`
`),a=i.stack.split(`
`),l=r.length-1,s=a.length-1;1<=l&&0<=s&&r[l]!==a[s];)s--;for(;1<=l&&0<=s;l--,s--)if(r[l]!==a[s]){if(l!==1||s!==1)do if(l--,s--,0>s||r[l]!==a[s]){var d=`
`+r[l].replace(" at new "," at ");return n.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",n.displayName)),d}while(1<=l&&0<=s);break}}}finally{i2=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?dx(n):""}function iH(n){switch(n.tag){case 5:return dx(n.type);case 16:return dx("Lazy");case 13:return dx("Suspense");case 19:return dx("SuspenseList");case 0:case 2:case 15:return n=r2(n.type,!1),n;case 11:return n=r2(n.type.render,!1),n;case 1:return n=r2(n.type,!0),n;default:return""}}function JE(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case k_:return"Fragment";case P_:return"Portal";case $E:return"Profiler";case wI:return"StrictMode";case XE:return"Suspense";case YE:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case JF:return(n.displayName||"Context")+".Consumer";case YF:return(n._context.displayName||"Context")+".Provider";case bI:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case SI:return e=n.displayName||null,e!==null?e:JE(n.type)||"Memo";case Of:e=n._payload,n=n._init;try{return JE(n(e))}catch{}}return null}function rH(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return JE(e);case 8:return e===wI?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function pp(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function QF(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function sH(n){var e=QF(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,a=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(l){i=""+l,a.call(this,l)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(l){i=""+l},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function gw(n){n._valueTracker||(n._valueTracker=sH(n))}function eB(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=QF(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function uS(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function KE(n,e){var t=e.checked;return us({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function JD(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=pp(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function tB(n,e){e=e.checked,e!=null&&vI(n,"checked",e,!1)}function QE(n,e){tB(n,e);var t=pp(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?eA(n,e.type,t):e.hasOwnProperty("defaultValue")&&eA(n,e.type,pp(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function KD(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function eA(n,e,t){(e!=="number"||uS(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var fx=Array.isArray;function $_(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+pp(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function tA(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(on(91));return us({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function QD(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(on(92));if(fx(t)){if(1<t.length)throw Error(on(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:pp(t)}}function nB(n,e){var t=pp(e.value),i=pp(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function eL(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function iB(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function nA(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?iB(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var _w,rB=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(_w=_w||document.createElement("div"),_w.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=_w.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Xx(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Sx={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},oH=["Webkit","ms","Moz","O"];Object.keys(Sx).forEach(function(n){oH.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Sx[e]=Sx[n]})});function sB(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Sx.hasOwnProperty(n)&&Sx[n]?(""+e).trim():e+"px"}function oB(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=sB(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var aH=us({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function iA(n,e){if(e){if(aH[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(on(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(on(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(on(61))}if(e.style!=null&&typeof e.style!="object")throw Error(on(62))}}function rA(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sA=null;function MI(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var oA=null,X_=null,Y_=null;function tL(n){if(n=jv(n)){if(typeof oA!="function")throw Error(on(280));var e=n.stateNode;e&&(e=pM(e),oA(n.stateNode,n.type,e))}}function aB(n){X_?Y_?Y_.push(n):Y_=[n]:X_=n}function lB(){if(X_){var n=X_,e=Y_;if(Y_=X_=null,tL(n),e)for(n=0;n<e.length;n++)tL(e[n])}}function cB(n,e){return n(e)}function uB(){}var s2=!1;function hB(n,e,t){if(s2)return n(e,t);s2=!0;try{return cB(n,e,t)}finally{s2=!1,(X_!==null||Y_!==null)&&(uB(),lB())}}function Yx(n,e){var t=n.stateNode;if(t===null)return null;var i=pM(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(on(231,e,typeof t));return t}var aA=!1;if(zd)try{var R0={};Object.defineProperty(R0,"passive",{get:function(){aA=!0}}),window.addEventListener("test",R0,R0),window.removeEventListener("test",R0,R0)}catch{aA=!1}function lH(n,e,t,i,r,a,l,s,d){var m=Array.prototype.slice.call(arguments,3);try{e.apply(t,m)}catch(_){this.onError(_)}}var Mx=!1,hS=null,dS=!1,lA=null,cH={onError:function(n){Mx=!0,hS=n}};function uH(n,e,t,i,r,a,l,s,d){Mx=!1,hS=null,lH.apply(cH,arguments)}function hH(n,e,t,i,r,a,l,s,d){if(uH.apply(this,arguments),Mx){if(Mx){var m=hS;Mx=!1,hS=null}else throw Error(on(198));dS||(dS=!0,lA=m)}}function gg(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function dB(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function nL(n){if(gg(n)!==n)throw Error(on(188))}function dH(n){var e=n.alternate;if(!e){if(e=gg(n),e===null)throw Error(on(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var a=r.alternate;if(a===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===t)return nL(r),n;if(a===i)return nL(r),e;a=a.sibling}throw Error(on(188))}if(t.return!==i.return)t=r,i=a;else{for(var l=!1,s=r.child;s;){if(s===t){l=!0,t=r,i=a;break}if(s===i){l=!0,i=r,t=a;break}s=s.sibling}if(!l){for(s=a.child;s;){if(s===t){l=!0,t=a,i=r;break}if(s===i){l=!0,i=a,t=r;break}s=s.sibling}if(!l)throw Error(on(189))}}if(t.alternate!==i)throw Error(on(190))}if(t.tag!==3)throw Error(on(188));return t.stateNode.current===t?n:e}function fB(n){return n=dH(n),n!==null?pB(n):null}function pB(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=pB(n);if(e!==null)return e;n=n.sibling}return null}var mB=zl.unstable_scheduleCallback,iL=zl.unstable_cancelCallback,fH=zl.unstable_shouldYield,pH=zl.unstable_requestPaint,Rs=zl.unstable_now,mH=zl.unstable_getCurrentPriorityLevel,TI=zl.unstable_ImmediatePriority,gB=zl.unstable_UserBlockingPriority,fS=zl.unstable_NormalPriority,gH=zl.unstable_LowPriority,_B=zl.unstable_IdlePriority,uM=null,_h=null;function _H(n){if(_h&&typeof _h.onCommitFiberRoot=="function")try{_h.onCommitFiberRoot(uM,n,void 0,(n.current.flags&128)===128)}catch{}}var Mu=Math.clz32?Math.clz32:vH,yH=Math.log,xH=Math.LN2;function vH(n){return n>>>=0,n===0?32:31-(yH(n)/xH|0)|0}var yw=64,xw=4194304;function px(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function pS(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,a=n.pingedLanes,l=t&268435455;if(l!==0){var s=l&~r;s!==0?i=px(s):(a&=l,a!==0&&(i=px(a)))}else l=t&~r,l!==0?i=px(l):a!==0&&(i=px(a));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,a=e&-e,r>=a||r===16&&(a&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Mu(e),r=1<<t,i|=n[t],e&=~r;return i}function wH(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bH(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,a=n.pendingLanes;0<a;){var l=31-Mu(a),s=1<<l,d=r[l];d===-1?(!(s&t)||s&i)&&(r[l]=wH(s,e)):d<=e&&(n.expiredLanes|=s),a&=~s}}function cA(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function yB(){var n=yw;return yw<<=1,!(yw&4194240)&&(yw=64),n}function o2(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Wv(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Mu(e),n[e]=t}function SH(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-Mu(t),a=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~a}}function EI(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-Mu(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var Sr=0;function xB(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var vB,AI,wB,bB,SB,uA=!1,vw=[],tp=null,np=null,ip=null,Jx=new Map,Kx=new Map,Vf=[],MH="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rL(n,e){switch(n){case"focusin":case"focusout":tp=null;break;case"dragenter":case"dragleave":np=null;break;case"mouseover":case"mouseout":ip=null;break;case"pointerover":case"pointerout":Jx.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kx.delete(e.pointerId)}}function z0(n,e,t,i,r,a){return n===null||n.nativeEvent!==a?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},e!==null&&(e=jv(e),e!==null&&AI(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function TH(n,e,t,i,r){switch(e){case"focusin":return tp=z0(tp,n,e,t,i,r),!0;case"dragenter":return np=z0(np,n,e,t,i,r),!0;case"mouseover":return ip=z0(ip,n,e,t,i,r),!0;case"pointerover":var a=r.pointerId;return Jx.set(a,z0(Jx.get(a)||null,n,e,t,i,r)),!0;case"gotpointercapture":return a=r.pointerId,Kx.set(a,z0(Kx.get(a)||null,n,e,t,i,r)),!0}return!1}function MB(n){var e=Lm(n.target);if(e!==null){var t=gg(e);if(t!==null){if(e=t.tag,e===13){if(e=dB(t),e!==null){n.blockedOn=e,SB(n.priority,function(){wB(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ub(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=hA(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);sA=i,t.target.dispatchEvent(i),sA=null}else return e=jv(t),e!==null&&AI(e),n.blockedOn=t,!1;e.shift()}return!0}function sL(n,e,t){Ub(n)&&t.delete(e)}function EH(){uA=!1,tp!==null&&Ub(tp)&&(tp=null),np!==null&&Ub(np)&&(np=null),ip!==null&&Ub(ip)&&(ip=null),Jx.forEach(sL),Kx.forEach(sL)}function O0(n,e){n.blockedOn===e&&(n.blockedOn=null,uA||(uA=!0,zl.unstable_scheduleCallback(zl.unstable_NormalPriority,EH)))}function Qx(n){function e(r){return O0(r,n)}if(0<vw.length){O0(vw[0],n);for(var t=1;t<vw.length;t++){var i=vw[t];i.blockedOn===n&&(i.blockedOn=null)}}for(tp!==null&&O0(tp,n),np!==null&&O0(np,n),ip!==null&&O0(ip,n),Jx.forEach(e),Kx.forEach(e),t=0;t<Vf.length;t++)i=Vf[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<Vf.length&&(t=Vf[0],t.blockedOn===null);)MB(t),t.blockedOn===null&&Vf.shift()}var J_=qd.ReactCurrentBatchConfig,mS=!0;function AH(n,e,t,i){var r=Sr,a=J_.transition;J_.transition=null;try{Sr=1,CI(n,e,t,i)}finally{Sr=r,J_.transition=a}}function CH(n,e,t,i){var r=Sr,a=J_.transition;J_.transition=null;try{Sr=4,CI(n,e,t,i)}finally{Sr=r,J_.transition=a}}function CI(n,e,t,i){if(mS){var r=hA(n,e,t,i);if(r===null)g2(n,e,i,gS,t),rL(n,i);else if(TH(r,n,e,t,i))i.stopPropagation();else if(rL(n,i),e&4&&-1<MH.indexOf(n)){for(;r!==null;){var a=jv(r);if(a!==null&&vB(a),a=hA(n,e,t,i),a===null&&g2(n,e,i,gS,t),a===r)break;r=a}r!==null&&i.stopPropagation()}else g2(n,e,i,null,t)}}var gS=null;function hA(n,e,t,i){if(gS=null,n=MI(i),n=Lm(n),n!==null)if(e=gg(n),e===null)n=null;else if(t=e.tag,t===13){if(n=dB(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return gS=n,null}function TB(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mH()){case TI:return 1;case gB:return 4;case fS:case gH:return 16;case _B:return 536870912;default:return 16}default:return 16}}var Hf=null,II=null,Vb=null;function EB(){if(Vb)return Vb;var n,e=II,t=e.length,i,r="value"in Hf?Hf.value:Hf.textContent,a=r.length;for(n=0;n<t&&e[n]===r[n];n++);var l=t-n;for(i=1;i<=l&&e[t-i]===r[a-i];i++);return Vb=r.slice(n,1<i?1-i:void 0)}function Gb(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function ww(){return!0}function oL(){return!1}function Nl(n){function e(t,i,r,a,l){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=a,this.target=l,this.currentTarget=null;for(var s in n)n.hasOwnProperty(s)&&(t=n[s],this[s]=t?t(a):a[s]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?ww:oL,this.isPropagationStopped=oL,this}return us(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=ww)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=ww)},persist:function(){},isPersistent:ww}),e}var ky={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},PI=Nl(ky),Hv=us({},ky,{view:0,detail:0}),IH=Nl(Hv),a2,l2,F0,hM=us({},Hv,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kI,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==F0&&(F0&&n.type==="mousemove"?(a2=n.screenX-F0.screenX,l2=n.screenY-F0.screenY):l2=a2=0,F0=n),a2)},movementY:function(n){return"movementY"in n?n.movementY:l2}}),aL=Nl(hM),PH=us({},hM,{dataTransfer:0}),kH=Nl(PH),DH=us({},Hv,{relatedTarget:0}),c2=Nl(DH),LH=us({},ky,{animationName:0,elapsedTime:0,pseudoElement:0}),RH=Nl(LH),zH=us({},ky,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),OH=Nl(zH),FH=us({},ky,{data:0}),lL=Nl(FH),BH={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},NH={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UH={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VH(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=UH[n])?!!e[n]:!1}function kI(){return VH}var GH=us({},Hv,{key:function(n){if(n.key){var e=BH[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Gb(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?NH[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kI,charCode:function(n){return n.type==="keypress"?Gb(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Gb(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),WH=Nl(GH),HH=us({},hM,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cL=Nl(HH),jH=us({},Hv,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kI}),qH=Nl(jH),ZH=us({},ky,{propertyName:0,elapsedTime:0,pseudoElement:0}),$H=Nl(ZH),XH=us({},hM,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),YH=Nl(XH),JH=[9,13,27,32],DI=zd&&"CompositionEvent"in window,Tx=null;zd&&"documentMode"in document&&(Tx=document.documentMode);var KH=zd&&"TextEvent"in window&&!Tx,AB=zd&&(!DI||Tx&&8<Tx&&11>=Tx),uL=String.fromCharCode(32),hL=!1;function CB(n,e){switch(n){case"keyup":return JH.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function IB(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var D_=!1;function QH(n,e){switch(n){case"compositionend":return IB(e);case"keypress":return e.which!==32?null:(hL=!0,uL);case"textInput":return n=e.data,n===uL&&hL?null:n;default:return null}}function ej(n,e){if(D_)return n==="compositionend"||!DI&&CB(n,e)?(n=EB(),Vb=II=Hf=null,D_=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return AB&&e.locale!=="ko"?null:e.data;default:return null}}var tj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dL(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!tj[n.type]:e==="textarea"}function PB(n,e,t,i){aB(i),e=_S(e,"onChange"),0<e.length&&(t=new PI("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var Ex=null,ev=null;function nj(n){VB(n,0)}function dM(n){var e=z_(n);if(eB(e))return n}function ij(n,e){if(n==="change")return e}var kB=!1;if(zd){var u2;if(zd){var h2="oninput"in document;if(!h2){var fL=document.createElement("div");fL.setAttribute("oninput","return;"),h2=typeof fL.oninput=="function"}u2=h2}else u2=!1;kB=u2&&(!document.documentMode||9<document.documentMode)}function pL(){Ex&&(Ex.detachEvent("onpropertychange",DB),ev=Ex=null)}function DB(n){if(n.propertyName==="value"&&dM(ev)){var e=[];PB(e,ev,n,MI(n)),hB(nj,e)}}function rj(n,e,t){n==="focusin"?(pL(),Ex=e,ev=t,Ex.attachEvent("onpropertychange",DB)):n==="focusout"&&pL()}function sj(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return dM(ev)}function oj(n,e){if(n==="click")return dM(e)}function aj(n,e){if(n==="input"||n==="change")return dM(e)}function lj(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Cu=typeof Object.is=="function"?Object.is:lj;function tv(n,e){if(Cu(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!ZE.call(e,r)||!Cu(n[r],e[r]))return!1}return!0}function mL(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function gL(n,e){var t=mL(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=mL(t)}}function LB(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?LB(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function RB(){for(var n=window,e=uS();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=uS(n.document)}return e}function LI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function cj(n){var e=RB(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&LB(t.ownerDocument.documentElement,t)){if(i!==null&&LI(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,a=Math.min(i.start,r);i=i.end===void 0?a:Math.min(i.end,r),!n.extend&&a>i&&(r=i,i=a,a=r),r=gL(t,a);var l=gL(t,i);r&&l&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==l.node||n.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),a>i?(n.addRange(e),n.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var uj=zd&&"documentMode"in document&&11>=document.documentMode,L_=null,dA=null,Ax=null,fA=!1;function _L(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;fA||L_==null||L_!==uS(i)||(i=L_,"selectionStart"in i&&LI(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Ax&&tv(Ax,i)||(Ax=i,i=_S(dA,"onSelect"),0<i.length&&(e=new PI("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=L_)))}function bw(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var R_={animationend:bw("Animation","AnimationEnd"),animationiteration:bw("Animation","AnimationIteration"),animationstart:bw("Animation","AnimationStart"),transitionend:bw("Transition","TransitionEnd")},d2={},zB={};zd&&(zB=document.createElement("div").style,"AnimationEvent"in window||(delete R_.animationend.animation,delete R_.animationiteration.animation,delete R_.animationstart.animation),"TransitionEvent"in window||delete R_.transitionend.transition);function fM(n){if(d2[n])return d2[n];if(!R_[n])return n;var e=R_[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in zB)return d2[n]=e[t];return n}var OB=fM("animationend"),FB=fM("animationiteration"),BB=fM("animationstart"),NB=fM("transitionend"),UB=new Map,yL="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mp(n,e){UB.set(n,e),mg(e,[n])}for(var f2=0;f2<yL.length;f2++){var p2=yL[f2],hj=p2.toLowerCase(),dj=p2[0].toUpperCase()+p2.slice(1);Mp(hj,"on"+dj)}Mp(OB,"onAnimationEnd");Mp(FB,"onAnimationIteration");Mp(BB,"onAnimationStart");Mp("dblclick","onDoubleClick");Mp("focusin","onFocus");Mp("focusout","onBlur");Mp(NB,"onTransitionEnd");ly("onMouseEnter",["mouseout","mouseover"]);ly("onMouseLeave",["mouseout","mouseover"]);ly("onPointerEnter",["pointerout","pointerover"]);ly("onPointerLeave",["pointerout","pointerover"]);mg("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));mg("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));mg("onBeforeInput",["compositionend","keypress","textInput","paste"]);mg("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));mg("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));mg("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mx="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fj=new Set("cancel close invalid load scroll toggle".split(" ").concat(mx));function xL(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,hH(i,e,void 0,n),n.currentTarget=null}function VB(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var a=void 0;if(e)for(var l=i.length-1;0<=l;l--){var s=i[l],d=s.instance,m=s.currentTarget;if(s=s.listener,d!==a&&r.isPropagationStopped())break e;xL(r,s,m),a=d}else for(l=0;l<i.length;l++){if(s=i[l],d=s.instance,m=s.currentTarget,s=s.listener,d!==a&&r.isPropagationStopped())break e;xL(r,s,m),a=d}}}if(dS)throw n=lA,dS=!1,lA=null,n}function Gr(n,e){var t=e[yA];t===void 0&&(t=e[yA]=new Set);var i=n+"__bubble";t.has(i)||(GB(e,n,2,!1),t.add(i))}function m2(n,e,t){var i=0;e&&(i|=4),GB(t,n,i,e)}var Sw="_reactListening"+Math.random().toString(36).slice(2);function nv(n){if(!n[Sw]){n[Sw]=!0,XF.forEach(function(t){t!=="selectionchange"&&(fj.has(t)||m2(t,!1,n),m2(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Sw]||(e[Sw]=!0,m2("selectionchange",!1,e))}}function GB(n,e,t,i){switch(TB(e)){case 1:var r=AH;break;case 4:r=CH;break;default:r=CI}t=r.bind(null,e,t,n),r=void 0,!aA||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function g2(n,e,t,i,r){var a=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var l=i.tag;if(l===3||l===4){var s=i.stateNode.containerInfo;if(s===r||s.nodeType===8&&s.parentNode===r)break;if(l===4)for(l=i.return;l!==null;){var d=l.tag;if((d===3||d===4)&&(d=l.stateNode.containerInfo,d===r||d.nodeType===8&&d.parentNode===r))return;l=l.return}for(;s!==null;){if(l=Lm(s),l===null)return;if(d=l.tag,d===5||d===6){i=a=l;continue e}s=s.parentNode}}i=i.return}hB(function(){var m=a,_=MI(t),S=[];e:{var T=UB.get(n);if(T!==void 0){var C=PI,P=n;switch(n){case"keypress":if(Gb(t)===0)break e;case"keydown":case"keyup":C=WH;break;case"focusin":P="focus",C=c2;break;case"focusout":P="blur",C=c2;break;case"beforeblur":case"afterblur":C=c2;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":C=aL;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":C=kH;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":C=qH;break;case OB:case FB:case BB:C=RH;break;case NB:C=$H;break;case"scroll":C=IH;break;case"wheel":C=YH;break;case"copy":case"cut":case"paste":C=OH;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":C=cL}var k=(e&4)!==0,R=!k&&n==="scroll",O=k?T!==null?T+"Capture":null:T;k=[];for(var F=m,N;F!==null;){N=F;var G=N.stateNode;if(N.tag===5&&G!==null&&(N=G,O!==null&&(G=Yx(F,O),G!=null&&k.push(iv(F,G,N)))),R)break;F=F.return}0<k.length&&(T=new C(T,P,null,t,_),S.push({event:T,listeners:k}))}}if(!(e&7)){e:{if(T=n==="mouseover"||n==="pointerover",C=n==="mouseout"||n==="pointerout",T&&t!==sA&&(P=t.relatedTarget||t.fromElement)&&(Lm(P)||P[Od]))break e;if((C||T)&&(T=_.window===_?_:(T=_.ownerDocument)?T.defaultView||T.parentWindow:window,C?(P=t.relatedTarget||t.toElement,C=m,P=P?Lm(P):null,P!==null&&(R=gg(P),P!==R||P.tag!==5&&P.tag!==6)&&(P=null)):(C=null,P=m),C!==P)){if(k=aL,G="onMouseLeave",O="onMouseEnter",F="mouse",(n==="pointerout"||n==="pointerover")&&(k=cL,G="onPointerLeave",O="onPointerEnter",F="pointer"),R=C==null?T:z_(C),N=P==null?T:z_(P),T=new k(G,F+"leave",C,t,_),T.target=R,T.relatedTarget=N,G=null,Lm(_)===m&&(k=new k(O,F+"enter",P,t,_),k.target=N,k.relatedTarget=R,G=k),R=G,C&&P)t:{for(k=C,O=P,F=0,N=k;N;N=r_(N))F++;for(N=0,G=O;G;G=r_(G))N++;for(;0<F-N;)k=r_(k),F--;for(;0<N-F;)O=r_(O),N--;for(;F--;){if(k===O||O!==null&&k===O.alternate)break t;k=r_(k),O=r_(O)}k=null}else k=null;C!==null&&vL(S,T,C,k,!1),P!==null&&R!==null&&vL(S,R,P,k,!0)}}e:{if(T=m?z_(m):window,C=T.nodeName&&T.nodeName.toLowerCase(),C==="select"||C==="input"&&T.type==="file")var j=ij;else if(dL(T))if(kB)j=aj;else{j=sj;var Q=rj}else(C=T.nodeName)&&C.toLowerCase()==="input"&&(T.type==="checkbox"||T.type==="radio")&&(j=oj);if(j&&(j=j(n,m))){PB(S,j,t,_);break e}Q&&Q(n,T,m),n==="focusout"&&(Q=T._wrapperState)&&Q.controlled&&T.type==="number"&&eA(T,"number",T.value)}switch(Q=m?z_(m):window,n){case"focusin":(dL(Q)||Q.contentEditable==="true")&&(L_=Q,dA=m,Ax=null);break;case"focusout":Ax=dA=L_=null;break;case"mousedown":fA=!0;break;case"contextmenu":case"mouseup":case"dragend":fA=!1,_L(S,t,_);break;case"selectionchange":if(uj)break;case"keydown":case"keyup":_L(S,t,_)}var re;if(DI)e:{switch(n){case"compositionstart":var $="onCompositionStart";break e;case"compositionend":$="onCompositionEnd";break e;case"compositionupdate":$="onCompositionUpdate";break e}$=void 0}else D_?CB(n,t)&&($="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&($="onCompositionStart");$&&(AB&&t.locale!=="ko"&&(D_||$!=="onCompositionStart"?$==="onCompositionEnd"&&D_&&(re=EB()):(Hf=_,II="value"in Hf?Hf.value:Hf.textContent,D_=!0)),Q=_S(m,$),0<Q.length&&($=new lL($,n,null,t,_),S.push({event:$,listeners:Q}),re?$.data=re:(re=IB(t),re!==null&&($.data=re)))),(re=KH?QH(n,t):ej(n,t))&&(m=_S(m,"onBeforeInput"),0<m.length&&(_=new lL("onBeforeInput","beforeinput",null,t,_),S.push({event:_,listeners:m}),_.data=re))}VB(S,e)})}function iv(n,e,t){return{instance:n,listener:e,currentTarget:t}}function _S(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,a=r.stateNode;r.tag===5&&a!==null&&(r=a,a=Yx(n,t),a!=null&&i.unshift(iv(n,a,r)),a=Yx(n,e),a!=null&&i.push(iv(n,a,r))),n=n.return}return i}function r_(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function vL(n,e,t,i,r){for(var a=e._reactName,l=[];t!==null&&t!==i;){var s=t,d=s.alternate,m=s.stateNode;if(d!==null&&d===i)break;s.tag===5&&m!==null&&(s=m,r?(d=Yx(t,a),d!=null&&l.unshift(iv(t,d,s))):r||(d=Yx(t,a),d!=null&&l.push(iv(t,d,s)))),t=t.return}l.length!==0&&n.push({event:e,listeners:l})}var pj=/\r\n?/g,mj=/\u0000|\uFFFD/g;function wL(n){return(typeof n=="string"?n:""+n).replace(pj,`
`).replace(mj,"")}function Mw(n,e,t){if(e=wL(e),wL(n)!==e&&t)throw Error(on(425))}function yS(){}var pA=null,mA=null;function gA(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var _A=typeof setTimeout=="function"?setTimeout:void 0,gj=typeof clearTimeout=="function"?clearTimeout:void 0,bL=typeof Promise=="function"?Promise:void 0,_j=typeof queueMicrotask=="function"?queueMicrotask:typeof bL<"u"?function(n){return bL.resolve(null).then(n).catch(yj)}:_A;function yj(n){setTimeout(function(){throw n})}function _2(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),Qx(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);Qx(e)}function rp(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function SL(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Dy=Math.random().toString(36).slice(2),mh="__reactFiber$"+Dy,rv="__reactProps$"+Dy,Od="__reactContainer$"+Dy,yA="__reactEvents$"+Dy,xj="__reactListeners$"+Dy,vj="__reactHandles$"+Dy;function Lm(n){var e=n[mh];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Od]||t[mh]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=SL(n);n!==null;){if(t=n[mh])return t;n=SL(n)}return e}n=t,t=n.parentNode}return null}function jv(n){return n=n[mh]||n[Od],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function z_(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(on(33))}function pM(n){return n[rv]||null}var xA=[],O_=-1;function Tp(n){return{current:n}}function Hr(n){0>O_||(n.current=xA[O_],xA[O_]=null,O_--)}function Br(n,e){O_++,xA[O_]=n.current,n.current=e}var mp={},fa=Tp(mp),Ya=Tp(!1),ng=mp;function cy(n,e){var t=n.type.contextTypes;if(!t)return mp;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},a;for(a in t)r[a]=e[a];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function Ja(n){return n=n.childContextTypes,n!=null}function xS(){Hr(Ya),Hr(fa)}function ML(n,e,t){if(fa.current!==mp)throw Error(on(168));Br(fa,e),Br(Ya,t)}function WB(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(on(108,rH(n)||"Unknown",r));return us({},t,i)}function vS(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||mp,ng=fa.current,Br(fa,n),Br(Ya,Ya.current),!0}function TL(n,e,t){var i=n.stateNode;if(!i)throw Error(on(169));t?(n=WB(n,e,ng),i.__reactInternalMemoizedMergedChildContext=n,Hr(Ya),Hr(fa),Br(fa,n)):Hr(Ya),Br(Ya,t)}var wd=null,mM=!1,y2=!1;function HB(n){wd===null?wd=[n]:wd.push(n)}function wj(n){mM=!0,HB(n)}function Ep(){if(!y2&&wd!==null){y2=!0;var n=0,e=Sr;try{var t=wd;for(Sr=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}wd=null,mM=!1}catch(r){throw wd!==null&&(wd=wd.slice(n+1)),mB(TI,Ep),r}finally{Sr=e,y2=!1}}return null}var F_=[],B_=0,wS=null,bS=0,pc=[],mc=0,ig=null,Ed=1,Ad="";function Sm(n,e){F_[B_++]=bS,F_[B_++]=wS,wS=n,bS=e}function jB(n,e,t){pc[mc++]=Ed,pc[mc++]=Ad,pc[mc++]=ig,ig=n;var i=Ed;n=Ad;var r=32-Mu(i)-1;i&=~(1<<r),t+=1;var a=32-Mu(e)+r;if(30<a){var l=r-r%5;a=(i&(1<<l)-1).toString(32),i>>=l,r-=l,Ed=1<<32-Mu(e)+r|t<<r|i,Ad=a+n}else Ed=1<<a|t<<r|i,Ad=n}function RI(n){n.return!==null&&(Sm(n,1),jB(n,1,0))}function zI(n){for(;n===wS;)wS=F_[--B_],F_[B_]=null,bS=F_[--B_],F_[B_]=null;for(;n===ig;)ig=pc[--mc],pc[mc]=null,Ad=pc[--mc],pc[mc]=null,Ed=pc[--mc],pc[mc]=null}var kl=null,Pl=null,Xr=!1,xu=null;function qB(n,e){var t=xc(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function EL(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,kl=n,Pl=rp(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,kl=n,Pl=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=ig!==null?{id:Ed,overflow:Ad}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=xc(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,kl=n,Pl=null,!0):!1;default:return!1}}function vA(n){return(n.mode&1)!==0&&(n.flags&128)===0}function wA(n){if(Xr){var e=Pl;if(e){var t=e;if(!EL(n,e)){if(vA(n))throw Error(on(418));e=rp(t.nextSibling);var i=kl;e&&EL(n,e)?qB(i,t):(n.flags=n.flags&-4097|2,Xr=!1,kl=n)}}else{if(vA(n))throw Error(on(418));n.flags=n.flags&-4097|2,Xr=!1,kl=n}}}function AL(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;kl=n}function Tw(n){if(n!==kl)return!1;if(!Xr)return AL(n),Xr=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!gA(n.type,n.memoizedProps)),e&&(e=Pl)){if(vA(n))throw ZB(),Error(on(418));for(;e;)qB(n,e),e=rp(e.nextSibling)}if(AL(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(on(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Pl=rp(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Pl=null}}else Pl=kl?rp(n.stateNode.nextSibling):null;return!0}function ZB(){for(var n=Pl;n;)n=rp(n.nextSibling)}function uy(){Pl=kl=null,Xr=!1}function OI(n){xu===null?xu=[n]:xu.push(n)}var bj=qd.ReactCurrentBatchConfig;function mu(n,e){if(n&&n.defaultProps){e=us({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var SS=Tp(null),MS=null,N_=null,FI=null;function BI(){FI=N_=MS=null}function NI(n){var e=SS.current;Hr(SS),n._currentValue=e}function bA(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function K_(n,e){MS=n,FI=N_=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Xa=!0),n.firstContext=null)}function Ec(n){var e=n._currentValue;if(FI!==n)if(n={context:n,memoizedValue:e,next:null},N_===null){if(MS===null)throw Error(on(308));N_=n,MS.dependencies={lanes:0,firstContext:n}}else N_=N_.next=n;return e}var Rm=null;function UI(n){Rm===null?Rm=[n]:Rm.push(n)}function $B(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,UI(e)):(t.next=r.next,r.next=t),e.interleaved=t,Fd(n,i)}function Fd(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Ff=!1;function VI(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function XB(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ld(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function sp(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,or&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Fd(n,t)}return r=i.interleaved,r===null?(e.next=e,UI(i)):(e.next=r.next,r.next=e),i.interleaved=e,Fd(n,t)}function Wb(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,EI(n,t)}}function CL(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,a=null;if(t=t.firstBaseUpdate,t!==null){do{var l={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};a===null?r=a=l:a=a.next=l,t=t.next}while(t!==null);a===null?r=a=e:a=a.next=e}else r=a=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function TS(n,e,t,i){var r=n.updateQueue;Ff=!1;var a=r.firstBaseUpdate,l=r.lastBaseUpdate,s=r.shared.pending;if(s!==null){r.shared.pending=null;var d=s,m=d.next;d.next=null,l===null?a=m:l.next=m,l=d;var _=n.alternate;_!==null&&(_=_.updateQueue,s=_.lastBaseUpdate,s!==l&&(s===null?_.firstBaseUpdate=m:s.next=m,_.lastBaseUpdate=d))}if(a!==null){var S=r.baseState;l=0,_=m=d=null,s=a;do{var T=s.lane,C=s.eventTime;if((i&T)===T){_!==null&&(_=_.next={eventTime:C,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var P=n,k=s;switch(T=e,C=t,k.tag){case 1:if(P=k.payload,typeof P=="function"){S=P.call(C,S,T);break e}S=P;break e;case 3:P.flags=P.flags&-65537|128;case 0:if(P=k.payload,T=typeof P=="function"?P.call(C,S,T):P,T==null)break e;S=us({},S,T);break e;case 2:Ff=!0}}s.callback!==null&&s.lane!==0&&(n.flags|=64,T=r.effects,T===null?r.effects=[s]:T.push(s))}else C={eventTime:C,lane:T,tag:s.tag,payload:s.payload,callback:s.callback,next:null},_===null?(m=_=C,d=S):_=_.next=C,l|=T;if(s=s.next,s===null){if(s=r.shared.pending,s===null)break;T=s,s=T.next,T.next=null,r.lastBaseUpdate=T,r.shared.pending=null}}while(1);if(_===null&&(d=S),r.baseState=d,r.firstBaseUpdate=m,r.lastBaseUpdate=_,e=r.shared.interleaved,e!==null){r=e;do l|=r.lane,r=r.next;while(r!==e)}else a===null&&(r.shared.lanes=0);sg|=l,n.lanes=l,n.memoizedState=S}}function IL(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(on(191,r));r.call(i)}}}var YB=new $F.Component().refs;function SA(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:us({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var gM={isMounted:function(n){return(n=n._reactInternals)?gg(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Ca(),r=ap(n),a=Ld(i,r);a.payload=e,t!=null&&(a.callback=t),e=sp(n,a,r),e!==null&&(Tu(e,n,r,i),Wb(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Ca(),r=ap(n),a=Ld(i,r);a.tag=1,a.payload=e,t!=null&&(a.callback=t),e=sp(n,a,r),e!==null&&(Tu(e,n,r,i),Wb(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ca(),i=ap(n),r=Ld(t,i);r.tag=2,e!=null&&(r.callback=e),e=sp(n,r,i),e!==null&&(Tu(e,n,i,t),Wb(e,n,i))}};function PL(n,e,t,i,r,a,l){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,a,l):e.prototype&&e.prototype.isPureReactComponent?!tv(t,i)||!tv(r,a):!0}function JB(n,e,t){var i=!1,r=mp,a=e.contextType;return typeof a=="object"&&a!==null?a=Ec(a):(r=Ja(e)?ng:fa.current,i=e.contextTypes,a=(i=i!=null)?cy(n,r):mp),e=new e(t,a),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=gM,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=a),e}function kL(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&gM.enqueueReplaceState(e,e.state,null)}function MA(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs=YB,VI(n);var a=e.contextType;typeof a=="object"&&a!==null?r.context=Ec(a):(a=Ja(e)?ng:fa.current,r.context=cy(n,a)),r.state=n.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(SA(n,e,a,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&gM.enqueueReplaceState(r,r.state,null),TS(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function B0(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(on(309));var i=t.stateNode}if(!i)throw Error(on(147,n));var r=i,a=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(l){var s=r.refs;s===YB&&(s=r.refs={}),l===null?delete s[a]:s[a]=l},e._stringRef=a,e)}if(typeof n!="string")throw Error(on(284));if(!t._owner)throw Error(on(290,n))}return n}function Ew(n,e){throw n=Object.prototype.toString.call(e),Error(on(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function DL(n){var e=n._init;return e(n._payload)}function KB(n){function e(O,F){if(n){var N=O.deletions;N===null?(O.deletions=[F],O.flags|=16):N.push(F)}}function t(O,F){if(!n)return null;for(;F!==null;)e(O,F),F=F.sibling;return null}function i(O,F){for(O=new Map;F!==null;)F.key!==null?O.set(F.key,F):O.set(F.index,F),F=F.sibling;return O}function r(O,F){return O=lp(O,F),O.index=0,O.sibling=null,O}function a(O,F,N){return O.index=N,n?(N=O.alternate,N!==null?(N=N.index,N<F?(O.flags|=2,F):N):(O.flags|=2,F)):(O.flags|=1048576,F)}function l(O){return n&&O.alternate===null&&(O.flags|=2),O}function s(O,F,N,G){return F===null||F.tag!==6?(F=T2(N,O.mode,G),F.return=O,F):(F=r(F,N),F.return=O,F)}function d(O,F,N,G){var j=N.type;return j===k_?_(O,F,N.props.children,G,N.key):F!==null&&(F.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Of&&DL(j)===F.type)?(G=r(F,N.props),G.ref=B0(O,F,N),G.return=O,G):(G=Xb(N.type,N.key,N.props,null,O.mode,G),G.ref=B0(O,F,N),G.return=O,G)}function m(O,F,N,G){return F===null||F.tag!==4||F.stateNode.containerInfo!==N.containerInfo||F.stateNode.implementation!==N.implementation?(F=E2(N,O.mode,G),F.return=O,F):(F=r(F,N.children||[]),F.return=O,F)}function _(O,F,N,G,j){return F===null||F.tag!==7?(F=Hm(N,O.mode,G,j),F.return=O,F):(F=r(F,N),F.return=O,F)}function S(O,F,N){if(typeof F=="string"&&F!==""||typeof F=="number")return F=T2(""+F,O.mode,N),F.return=O,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case mw:return N=Xb(F.type,F.key,F.props,null,O.mode,N),N.ref=B0(O,null,F),N.return=O,N;case P_:return F=E2(F,O.mode,N),F.return=O,F;case Of:var G=F._init;return S(O,G(F._payload),N)}if(fx(F)||L0(F))return F=Hm(F,O.mode,N,null),F.return=O,F;Ew(O,F)}return null}function T(O,F,N,G){var j=F!==null?F.key:null;if(typeof N=="string"&&N!==""||typeof N=="number")return j!==null?null:s(O,F,""+N,G);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case mw:return N.key===j?d(O,F,N,G):null;case P_:return N.key===j?m(O,F,N,G):null;case Of:return j=N._init,T(O,F,j(N._payload),G)}if(fx(N)||L0(N))return j!==null?null:_(O,F,N,G,null);Ew(O,N)}return null}function C(O,F,N,G,j){if(typeof G=="string"&&G!==""||typeof G=="number")return O=O.get(N)||null,s(F,O,""+G,j);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case mw:return O=O.get(G.key===null?N:G.key)||null,d(F,O,G,j);case P_:return O=O.get(G.key===null?N:G.key)||null,m(F,O,G,j);case Of:var Q=G._init;return C(O,F,N,Q(G._payload),j)}if(fx(G)||L0(G))return O=O.get(N)||null,_(F,O,G,j,null);Ew(F,G)}return null}function P(O,F,N,G){for(var j=null,Q=null,re=F,$=F=0,ne=null;re!==null&&$<N.length;$++){re.index>$?(ne=re,re=null):ne=re.sibling;var ue=T(O,re,N[$],G);if(ue===null){re===null&&(re=ne);break}n&&re&&ue.alternate===null&&e(O,re),F=a(ue,F,$),Q===null?j=ue:Q.sibling=ue,Q=ue,re=ne}if($===N.length)return t(O,re),Xr&&Sm(O,$),j;if(re===null){for(;$<N.length;$++)re=S(O,N[$],G),re!==null&&(F=a(re,F,$),Q===null?j=re:Q.sibling=re,Q=re);return Xr&&Sm(O,$),j}for(re=i(O,re);$<N.length;$++)ne=C(re,O,$,N[$],G),ne!==null&&(n&&ne.alternate!==null&&re.delete(ne.key===null?$:ne.key),F=a(ne,F,$),Q===null?j=ne:Q.sibling=ne,Q=ne);return n&&re.forEach(function(De){return e(O,De)}),Xr&&Sm(O,$),j}function k(O,F,N,G){var j=L0(N);if(typeof j!="function")throw Error(on(150));if(N=j.call(N),N==null)throw Error(on(151));for(var Q=j=null,re=F,$=F=0,ne=null,ue=N.next();re!==null&&!ue.done;$++,ue=N.next()){re.index>$?(ne=re,re=null):ne=re.sibling;var De=T(O,re,ue.value,G);if(De===null){re===null&&(re=ne);break}n&&re&&De.alternate===null&&e(O,re),F=a(De,F,$),Q===null?j=De:Q.sibling=De,Q=De,re=ne}if(ue.done)return t(O,re),Xr&&Sm(O,$),j;if(re===null){for(;!ue.done;$++,ue=N.next())ue=S(O,ue.value,G),ue!==null&&(F=a(ue,F,$),Q===null?j=ue:Q.sibling=ue,Q=ue);return Xr&&Sm(O,$),j}for(re=i(O,re);!ue.done;$++,ue=N.next())ue=C(re,O,$,ue.value,G),ue!==null&&(n&&ue.alternate!==null&&re.delete(ue.key===null?$:ue.key),F=a(ue,F,$),Q===null?j=ue:Q.sibling=ue,Q=ue);return n&&re.forEach(function($e){return e(O,$e)}),Xr&&Sm(O,$),j}function R(O,F,N,G){if(typeof N=="object"&&N!==null&&N.type===k_&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case mw:e:{for(var j=N.key,Q=F;Q!==null;){if(Q.key===j){if(j=N.type,j===k_){if(Q.tag===7){t(O,Q.sibling),F=r(Q,N.props.children),F.return=O,O=F;break e}}else if(Q.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Of&&DL(j)===Q.type){t(O,Q.sibling),F=r(Q,N.props),F.ref=B0(O,Q,N),F.return=O,O=F;break e}t(O,Q);break}else e(O,Q);Q=Q.sibling}N.type===k_?(F=Hm(N.props.children,O.mode,G,N.key),F.return=O,O=F):(G=Xb(N.type,N.key,N.props,null,O.mode,G),G.ref=B0(O,F,N),G.return=O,O=G)}return l(O);case P_:e:{for(Q=N.key;F!==null;){if(F.key===Q)if(F.tag===4&&F.stateNode.containerInfo===N.containerInfo&&F.stateNode.implementation===N.implementation){t(O,F.sibling),F=r(F,N.children||[]),F.return=O,O=F;break e}else{t(O,F);break}else e(O,F);F=F.sibling}F=E2(N,O.mode,G),F.return=O,O=F}return l(O);case Of:return Q=N._init,R(O,F,Q(N._payload),G)}if(fx(N))return P(O,F,N,G);if(L0(N))return k(O,F,N,G);Ew(O,N)}return typeof N=="string"&&N!==""||typeof N=="number"?(N=""+N,F!==null&&F.tag===6?(t(O,F.sibling),F=r(F,N),F.return=O,O=F):(t(O,F),F=T2(N,O.mode,G),F.return=O,O=F),l(O)):t(O,F)}return R}var hy=KB(!0),QB=KB(!1),qv={},yh=Tp(qv),sv=Tp(qv),ov=Tp(qv);function zm(n){if(n===qv)throw Error(on(174));return n}function GI(n,e){switch(Br(ov,e),Br(sv,n),Br(yh,qv),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:nA(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=nA(e,n)}Hr(yh),Br(yh,e)}function dy(){Hr(yh),Hr(sv),Hr(ov)}function eN(n){zm(ov.current);var e=zm(yh.current),t=nA(e,n.type);e!==t&&(Br(sv,n),Br(yh,t))}function WI(n){sv.current===n&&(Hr(yh),Hr(sv))}var ss=Tp(0);function ES(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var x2=[];function HI(){for(var n=0;n<x2.length;n++)x2[n]._workInProgressVersionPrimary=null;x2.length=0}var Hb=qd.ReactCurrentDispatcher,v2=qd.ReactCurrentBatchConfig,rg=0,cs=null,to=null,bo=null,AS=!1,Cx=!1,av=0,Sj=0;function Qo(){throw Error(on(321))}function jI(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Cu(n[t],e[t]))return!1;return!0}function qI(n,e,t,i,r,a){if(rg=a,cs=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Hb.current=n===null||n.memoizedState===null?Aj:Cj,n=t(i,r),Cx){a=0;do{if(Cx=!1,av=0,25<=a)throw Error(on(301));a+=1,bo=to=null,e.updateQueue=null,Hb.current=Ij,n=t(i,r)}while(Cx)}if(Hb.current=CS,e=to!==null&&to.next!==null,rg=0,bo=to=cs=null,AS=!1,e)throw Error(on(300));return n}function ZI(){var n=av!==0;return av=0,n}function ph(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bo===null?cs.memoizedState=bo=n:bo=bo.next=n,bo}function Ac(){if(to===null){var n=cs.alternate;n=n!==null?n.memoizedState:null}else n=to.next;var e=bo===null?cs.memoizedState:bo.next;if(e!==null)bo=e,to=n;else{if(n===null)throw Error(on(310));to=n,n={memoizedState:to.memoizedState,baseState:to.baseState,baseQueue:to.baseQueue,queue:to.queue,next:null},bo===null?cs.memoizedState=bo=n:bo=bo.next=n}return bo}function lv(n,e){return typeof e=="function"?e(n):e}function w2(n){var e=Ac(),t=e.queue;if(t===null)throw Error(on(311));t.lastRenderedReducer=n;var i=to,r=i.baseQueue,a=t.pending;if(a!==null){if(r!==null){var l=r.next;r.next=a.next,a.next=l}i.baseQueue=r=a,t.pending=null}if(r!==null){a=r.next,i=i.baseState;var s=l=null,d=null,m=a;do{var _=m.lane;if((rg&_)===_)d!==null&&(d=d.next={lane:0,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null}),i=m.hasEagerState?m.eagerState:n(i,m.action);else{var S={lane:_,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null};d===null?(s=d=S,l=i):d=d.next=S,cs.lanes|=_,sg|=_}m=m.next}while(m!==null&&m!==a);d===null?l=i:d.next=s,Cu(i,e.memoizedState)||(Xa=!0),e.memoizedState=i,e.baseState=l,e.baseQueue=d,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do a=r.lane,cs.lanes|=a,sg|=a,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function b2(n){var e=Ac(),t=e.queue;if(t===null)throw Error(on(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,a=e.memoizedState;if(r!==null){t.pending=null;var l=r=r.next;do a=n(a,l.action),l=l.next;while(l!==r);Cu(a,e.memoizedState)||(Xa=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),t.lastRenderedState=a}return[a,i]}function tN(){}function nN(n,e){var t=cs,i=Ac(),r=e(),a=!Cu(i.memoizedState,r);if(a&&(i.memoizedState=r,Xa=!0),i=i.queue,$I(sN.bind(null,t,i,n),[n]),i.getSnapshot!==e||a||bo!==null&&bo.memoizedState.tag&1){if(t.flags|=2048,cv(9,rN.bind(null,t,i,r,e),void 0,null),So===null)throw Error(on(349));rg&30||iN(t,e,r)}return r}function iN(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=cs.updateQueue,e===null?(e={lastEffect:null,stores:null},cs.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function rN(n,e,t,i){e.value=t,e.getSnapshot=i,oN(e)&&aN(n)}function sN(n,e,t){return t(function(){oN(e)&&aN(n)})}function oN(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Cu(n,t)}catch{return!0}}function aN(n){var e=Fd(n,1);e!==null&&Tu(e,n,1,-1)}function LL(n){var e=ph();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lv,lastRenderedState:n},e.queue=n,n=n.dispatch=Ej.bind(null,cs,n),[e.memoizedState,n]}function cv(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=cs.updateQueue,e===null?(e={lastEffect:null,stores:null},cs.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function lN(){return Ac().memoizedState}function jb(n,e,t,i){var r=ph();cs.flags|=n,r.memoizedState=cv(1|e,t,void 0,i===void 0?null:i)}function _M(n,e,t,i){var r=Ac();i=i===void 0?null:i;var a=void 0;if(to!==null){var l=to.memoizedState;if(a=l.destroy,i!==null&&jI(i,l.deps)){r.memoizedState=cv(e,t,a,i);return}}cs.flags|=n,r.memoizedState=cv(1|e,t,a,i)}function RL(n,e){return jb(8390656,8,n,e)}function $I(n,e){return _M(2048,8,n,e)}function cN(n,e){return _M(4,2,n,e)}function uN(n,e){return _M(4,4,n,e)}function hN(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function dN(n,e,t){return t=t!=null?t.concat([n]):null,_M(4,4,hN.bind(null,e,n),t)}function XI(){}function fN(n,e){var t=Ac();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&jI(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function pN(n,e){var t=Ac();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&jI(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function mN(n,e,t){return rg&21?(Cu(t,e)||(t=yB(),cs.lanes|=t,sg|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Xa=!0),n.memoizedState=t)}function Mj(n,e){var t=Sr;Sr=t!==0&&4>t?t:4,n(!0);var i=v2.transition;v2.transition={};try{n(!1),e()}finally{Sr=t,v2.transition=i}}function gN(){return Ac().memoizedState}function Tj(n,e,t){var i=ap(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},_N(n))yN(e,t);else if(t=$B(n,e,t,i),t!==null){var r=Ca();Tu(t,n,i,r),xN(t,e,i)}}function Ej(n,e,t){var i=ap(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(_N(n))yN(e,r);else{var a=n.alternate;if(n.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var l=e.lastRenderedState,s=a(l,t);if(r.hasEagerState=!0,r.eagerState=s,Cu(s,l)){var d=e.interleaved;d===null?(r.next=r,UI(e)):(r.next=d.next,d.next=r),e.interleaved=r;return}}catch{}finally{}t=$B(n,e,r,i),t!==null&&(r=Ca(),Tu(t,n,i,r),xN(t,e,i))}}function _N(n){var e=n.alternate;return n===cs||e!==null&&e===cs}function yN(n,e){Cx=AS=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function xN(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,EI(n,t)}}var CS={readContext:Ec,useCallback:Qo,useContext:Qo,useEffect:Qo,useImperativeHandle:Qo,useInsertionEffect:Qo,useLayoutEffect:Qo,useMemo:Qo,useReducer:Qo,useRef:Qo,useState:Qo,useDebugValue:Qo,useDeferredValue:Qo,useTransition:Qo,useMutableSource:Qo,useSyncExternalStore:Qo,useId:Qo,unstable_isNewReconciler:!1},Aj={readContext:Ec,useCallback:function(n,e){return ph().memoizedState=[n,e===void 0?null:e],n},useContext:Ec,useEffect:RL,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,jb(4194308,4,hN.bind(null,e,n),t)},useLayoutEffect:function(n,e){return jb(4194308,4,n,e)},useInsertionEffect:function(n,e){return jb(4,2,n,e)},useMemo:function(n,e){var t=ph();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=ph();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=Tj.bind(null,cs,n),[i.memoizedState,n]},useRef:function(n){var e=ph();return n={current:n},e.memoizedState=n},useState:LL,useDebugValue:XI,useDeferredValue:function(n){return ph().memoizedState=n},useTransition:function(){var n=LL(!1),e=n[0];return n=Mj.bind(null,n[1]),ph().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=cs,r=ph();if(Xr){if(t===void 0)throw Error(on(407));t=t()}else{if(t=e(),So===null)throw Error(on(349));rg&30||iN(i,e,t)}r.memoizedState=t;var a={value:t,getSnapshot:e};return r.queue=a,RL(sN.bind(null,i,a,n),[n]),i.flags|=2048,cv(9,rN.bind(null,i,a,t,e),void 0,null),t},useId:function(){var n=ph(),e=So.identifierPrefix;if(Xr){var t=Ad,i=Ed;t=(i&~(1<<32-Mu(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=av++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Sj++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},Cj={readContext:Ec,useCallback:fN,useContext:Ec,useEffect:$I,useImperativeHandle:dN,useInsertionEffect:cN,useLayoutEffect:uN,useMemo:pN,useReducer:w2,useRef:lN,useState:function(){return w2(lv)},useDebugValue:XI,useDeferredValue:function(n){var e=Ac();return mN(e,to.memoizedState,n)},useTransition:function(){var n=w2(lv)[0],e=Ac().memoizedState;return[n,e]},useMutableSource:tN,useSyncExternalStore:nN,useId:gN,unstable_isNewReconciler:!1},Ij={readContext:Ec,useCallback:fN,useContext:Ec,useEffect:$I,useImperativeHandle:dN,useInsertionEffect:cN,useLayoutEffect:uN,useMemo:pN,useReducer:b2,useRef:lN,useState:function(){return b2(lv)},useDebugValue:XI,useDeferredValue:function(n){var e=Ac();return to===null?e.memoizedState=n:mN(e,to.memoizedState,n)},useTransition:function(){var n=b2(lv)[0],e=Ac().memoizedState;return[n,e]},useMutableSource:tN,useSyncExternalStore:nN,useId:gN,unstable_isNewReconciler:!1};function fy(n,e){try{var t="",i=e;do t+=iH(i),i=i.return;while(i);var r=t}catch(a){r=`
Error generating stack: `+a.message+`
`+a.stack}return{value:n,source:e,stack:r,digest:null}}function S2(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function TA(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Pj=typeof WeakMap=="function"?WeakMap:Map;function vN(n,e,t){t=Ld(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){PS||(PS=!0,zA=i),TA(n,e)},t}function wN(n,e,t){t=Ld(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){TA(n,e)}}var a=n.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(t.callback=function(){TA(n,e),typeof i!="function"&&(op===null?op=new Set([this]):op.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),t}function zL(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new Pj;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=Hj.bind(null,n,e,t),e.then(n,n))}function OL(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function FL(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Ld(-1,1),e.tag=2,sp(t,e,1))),t.lanes|=1),n)}var kj=qd.ReactCurrentOwner,Xa=!1;function Ta(n,e,t,i){e.child=n===null?QB(e,null,t,i):hy(e,n.child,t,i)}function BL(n,e,t,i,r){t=t.render;var a=e.ref;return K_(e,r),i=qI(n,e,t,i,a,r),t=ZI(),n!==null&&!Xa?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Bd(n,e,r)):(Xr&&t&&RI(e),e.flags|=1,Ta(n,e,i,r),e.child)}function NL(n,e,t,i,r){if(n===null){var a=t.type;return typeof a=="function"&&!iP(a)&&a.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=a,bN(n,e,a,i,r)):(n=Xb(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(a=n.child,!(n.lanes&r)){var l=a.memoizedProps;if(t=t.compare,t=t!==null?t:tv,t(l,i)&&n.ref===e.ref)return Bd(n,e,r)}return e.flags|=1,n=lp(a,i),n.ref=e.ref,n.return=e,e.child=n}function bN(n,e,t,i,r){if(n!==null){var a=n.memoizedProps;if(tv(a,i)&&n.ref===e.ref)if(Xa=!1,e.pendingProps=i=a,(n.lanes&r)!==0)n.flags&131072&&(Xa=!0);else return e.lanes=n.lanes,Bd(n,e,r)}return EA(n,e,t,i,r)}function SN(n,e,t){var i=e.pendingProps,r=i.children,a=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Br(V_,Al),Al|=t;else{if(!(t&1073741824))return n=a!==null?a.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Br(V_,Al),Al|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=a!==null?a.baseLanes:t,Br(V_,Al),Al|=i}else a!==null?(i=a.baseLanes|t,e.memoizedState=null):i=t,Br(V_,Al),Al|=i;return Ta(n,e,r,t),e.child}function MN(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function EA(n,e,t,i,r){var a=Ja(t)?ng:fa.current;return a=cy(e,a),K_(e,r),t=qI(n,e,t,i,a,r),i=ZI(),n!==null&&!Xa?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Bd(n,e,r)):(Xr&&i&&RI(e),e.flags|=1,Ta(n,e,t,r),e.child)}function UL(n,e,t,i,r){if(Ja(t)){var a=!0;vS(e)}else a=!1;if(K_(e,r),e.stateNode===null)qb(n,e),JB(e,t,i),MA(e,t,i,r),i=!0;else if(n===null){var l=e.stateNode,s=e.memoizedProps;l.props=s;var d=l.context,m=t.contextType;typeof m=="object"&&m!==null?m=Ec(m):(m=Ja(t)?ng:fa.current,m=cy(e,m));var _=t.getDerivedStateFromProps,S=typeof _=="function"||typeof l.getSnapshotBeforeUpdate=="function";S||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(s!==i||d!==m)&&kL(e,l,i,m),Ff=!1;var T=e.memoizedState;l.state=T,TS(e,i,l,r),d=e.memoizedState,s!==i||T!==d||Ya.current||Ff?(typeof _=="function"&&(SA(e,t,_,i),d=e.memoizedState),(s=Ff||PL(e,t,s,i,T,d,m))?(S||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=d),l.props=i,l.state=d,l.context=m,i=s):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{l=e.stateNode,XB(n,e),s=e.memoizedProps,m=e.type===e.elementType?s:mu(e.type,s),l.props=m,S=e.pendingProps,T=l.context,d=t.contextType,typeof d=="object"&&d!==null?d=Ec(d):(d=Ja(t)?ng:fa.current,d=cy(e,d));var C=t.getDerivedStateFromProps;(_=typeof C=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(s!==S||T!==d)&&kL(e,l,i,d),Ff=!1,T=e.memoizedState,l.state=T,TS(e,i,l,r);var P=e.memoizedState;s!==S||T!==P||Ya.current||Ff?(typeof C=="function"&&(SA(e,t,C,i),P=e.memoizedState),(m=Ff||PL(e,t,m,i,T,P,d)||!1)?(_||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(i,P,d),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(i,P,d)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||s===n.memoizedProps&&T===n.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&T===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=P),l.props=i,l.state=P,l.context=d,i=m):(typeof l.componentDidUpdate!="function"||s===n.memoizedProps&&T===n.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&T===n.memoizedState||(e.flags|=1024),i=!1)}return AA(n,e,t,i,a,r)}function AA(n,e,t,i,r,a){MN(n,e);var l=(e.flags&128)!==0;if(!i&&!l)return r&&TL(e,t,!1),Bd(n,e,a);i=e.stateNode,kj.current=e;var s=l&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&l?(e.child=hy(e,n.child,null,a),e.child=hy(e,null,s,a)):Ta(n,e,s,a),e.memoizedState=i.state,r&&TL(e,t,!0),e.child}function TN(n){var e=n.stateNode;e.pendingContext?ML(n,e.pendingContext,e.pendingContext!==e.context):e.context&&ML(n,e.context,!1),GI(n,e.containerInfo)}function VL(n,e,t,i,r){return uy(),OI(r),e.flags|=256,Ta(n,e,t,i),e.child}var CA={dehydrated:null,treeContext:null,retryLane:0};function IA(n){return{baseLanes:n,cachePool:null,transitions:null}}function EN(n,e,t){var i=e.pendingProps,r=ss.current,a=!1,l=(e.flags&128)!==0,s;if((s=l)||(s=n!==null&&n.memoizedState===null?!1:(r&2)!==0),s?(a=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),Br(ss,r&1),n===null)return wA(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=i.children,n=i.fallback,a?(i=e.mode,a=e.child,l={mode:"hidden",children:l},!(i&1)&&a!==null?(a.childLanes=0,a.pendingProps=l):a=vM(l,i,0,null),n=Hm(n,i,t,null),a.return=e,n.return=e,a.sibling=n,e.child=a,e.child.memoizedState=IA(t),e.memoizedState=CA,n):YI(e,l));if(r=n.memoizedState,r!==null&&(s=r.dehydrated,s!==null))return Dj(n,e,l,i,s,r,t);if(a){a=i.fallback,l=e.mode,r=n.child,s=r.sibling;var d={mode:"hidden",children:i.children};return!(l&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=d,e.deletions=null):(i=lp(r,d),i.subtreeFlags=r.subtreeFlags&14680064),s!==null?a=lp(s,a):(a=Hm(a,l,t,null),a.flags|=2),a.return=e,i.return=e,i.sibling=a,e.child=i,i=a,a=e.child,l=n.child.memoizedState,l=l===null?IA(t):{baseLanes:l.baseLanes|t,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=n.childLanes&~t,e.memoizedState=CA,i}return a=n.child,n=a.sibling,i=lp(a,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function YI(n,e){return e=vM({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Aw(n,e,t,i){return i!==null&&OI(i),hy(e,n.child,null,t),n=YI(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function Dj(n,e,t,i,r,a,l){if(t)return e.flags&256?(e.flags&=-257,i=S2(Error(on(422))),Aw(n,e,l,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(a=i.fallback,r=e.mode,i=vM({mode:"visible",children:i.children},r,0,null),a=Hm(a,r,l,null),a.flags|=2,i.return=e,a.return=e,i.sibling=a,e.child=i,e.mode&1&&hy(e,n.child,null,l),e.child.memoizedState=IA(l),e.memoizedState=CA,a);if(!(e.mode&1))return Aw(n,e,l,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var s=i.dgst;return i=s,a=Error(on(419)),i=S2(a,i,void 0),Aw(n,e,l,i)}if(s=(l&n.childLanes)!==0,Xa||s){if(i=So,i!==null){switch(l&-l){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|l)?0:r,r!==0&&r!==a.retryLane&&(a.retryLane=r,Fd(n,r),Tu(i,n,r,-1))}return nP(),i=S2(Error(on(421))),Aw(n,e,l,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=jj.bind(null,n),r._reactRetry=e,null):(n=a.treeContext,Pl=rp(r.nextSibling),kl=e,Xr=!0,xu=null,n!==null&&(pc[mc++]=Ed,pc[mc++]=Ad,pc[mc++]=ig,Ed=n.id,Ad=n.overflow,ig=e),e=YI(e,i.children),e.flags|=4096,e)}function GL(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),bA(n.return,e,t)}function M2(n,e,t,i,r){var a=n.memoizedState;a===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=t,a.tailMode=r)}function AN(n,e,t){var i=e.pendingProps,r=i.revealOrder,a=i.tail;if(Ta(n,e,i.children,t),i=ss.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&GL(n,t,e);else if(n.tag===19)GL(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Br(ss,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&ES(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),M2(e,!1,r,t,a);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&ES(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}M2(e,!0,t,null,a);break;case"together":M2(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function qb(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Bd(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),sg|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(on(153));if(e.child!==null){for(n=e.child,t=lp(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=lp(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function Lj(n,e,t){switch(e.tag){case 3:TN(e),uy();break;case 5:eN(e);break;case 1:Ja(e.type)&&vS(e);break;case 4:GI(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Br(SS,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Br(ss,ss.current&1),e.flags|=128,null):t&e.child.childLanes?EN(n,e,t):(Br(ss,ss.current&1),n=Bd(n,e,t),n!==null?n.sibling:null);Br(ss,ss.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return AN(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Br(ss,ss.current),i)break;return null;case 22:case 23:return e.lanes=0,SN(n,e,t)}return Bd(n,e,t)}var CN,PA,IN,PN;CN=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};PA=function(){};IN=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,zm(yh.current);var a=null;switch(t){case"input":r=KE(n,r),i=KE(n,i),a=[];break;case"select":r=us({},r,{value:void 0}),i=us({},i,{value:void 0}),a=[];break;case"textarea":r=tA(n,r),i=tA(n,i),a=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=yS)}iA(t,i);var l;t=null;for(m in r)if(!i.hasOwnProperty(m)&&r.hasOwnProperty(m)&&r[m]!=null)if(m==="style"){var s=r[m];for(l in s)s.hasOwnProperty(l)&&(t||(t={}),t[l]="")}else m!=="dangerouslySetInnerHTML"&&m!=="children"&&m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&($x.hasOwnProperty(m)?a||(a=[]):(a=a||[]).push(m,null));for(m in i){var d=i[m];if(s=r!=null?r[m]:void 0,i.hasOwnProperty(m)&&d!==s&&(d!=null||s!=null))if(m==="style")if(s){for(l in s)!s.hasOwnProperty(l)||d&&d.hasOwnProperty(l)||(t||(t={}),t[l]="");for(l in d)d.hasOwnProperty(l)&&s[l]!==d[l]&&(t||(t={}),t[l]=d[l])}else t||(a||(a=[]),a.push(m,t)),t=d;else m==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,s=s?s.__html:void 0,d!=null&&s!==d&&(a=a||[]).push(m,d)):m==="children"?typeof d!="string"&&typeof d!="number"||(a=a||[]).push(m,""+d):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&($x.hasOwnProperty(m)?(d!=null&&m==="onScroll"&&Gr("scroll",n),a||s===d||(a=[])):(a=a||[]).push(m,d))}t&&(a=a||[]).push("style",t);var m=a;(e.updateQueue=m)&&(e.flags|=4)}};PN=function(n,e,t,i){t!==i&&(e.flags|=4)};function N0(n,e){if(!Xr)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function ea(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function Rj(n,e,t){var i=e.pendingProps;switch(zI(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ea(e),null;case 1:return Ja(e.type)&&xS(),ea(e),null;case 3:return i=e.stateNode,dy(),Hr(Ya),Hr(fa),HI(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(Tw(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xu!==null&&(BA(xu),xu=null))),PA(n,e),ea(e),null;case 5:WI(e);var r=zm(ov.current);if(t=e.type,n!==null&&e.stateNode!=null)IN(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(on(166));return ea(e),null}if(n=zm(yh.current),Tw(e)){i=e.stateNode,t=e.type;var a=e.memoizedProps;switch(i[mh]=e,i[rv]=a,n=(e.mode&1)!==0,t){case"dialog":Gr("cancel",i),Gr("close",i);break;case"iframe":case"object":case"embed":Gr("load",i);break;case"video":case"audio":for(r=0;r<mx.length;r++)Gr(mx[r],i);break;case"source":Gr("error",i);break;case"img":case"image":case"link":Gr("error",i),Gr("load",i);break;case"details":Gr("toggle",i);break;case"input":JD(i,a),Gr("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Gr("invalid",i);break;case"textarea":QD(i,a),Gr("invalid",i)}iA(t,a),r=null;for(var l in a)if(a.hasOwnProperty(l)){var s=a[l];l==="children"?typeof s=="string"?i.textContent!==s&&(a.suppressHydrationWarning!==!0&&Mw(i.textContent,s,n),r=["children",s]):typeof s=="number"&&i.textContent!==""+s&&(a.suppressHydrationWarning!==!0&&Mw(i.textContent,s,n),r=["children",""+s]):$x.hasOwnProperty(l)&&s!=null&&l==="onScroll"&&Gr("scroll",i)}switch(t){case"input":gw(i),KD(i,a,!0);break;case"textarea":gw(i),eL(i);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(i.onclick=yS)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{l=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=iB(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=l.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=l.createElement(t,{is:i.is}):(n=l.createElement(t),t==="select"&&(l=n,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):n=l.createElementNS(n,t),n[mh]=e,n[rv]=i,CN(n,e,!1,!1),e.stateNode=n;e:{switch(l=rA(t,i),t){case"dialog":Gr("cancel",n),Gr("close",n),r=i;break;case"iframe":case"object":case"embed":Gr("load",n),r=i;break;case"video":case"audio":for(r=0;r<mx.length;r++)Gr(mx[r],n);r=i;break;case"source":Gr("error",n),r=i;break;case"img":case"image":case"link":Gr("error",n),Gr("load",n),r=i;break;case"details":Gr("toggle",n),r=i;break;case"input":JD(n,i),r=KE(n,i),Gr("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=us({},i,{value:void 0}),Gr("invalid",n);break;case"textarea":QD(n,i),r=tA(n,i),Gr("invalid",n);break;default:r=i}iA(t,r),s=r;for(a in s)if(s.hasOwnProperty(a)){var d=s[a];a==="style"?oB(n,d):a==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&rB(n,d)):a==="children"?typeof d=="string"?(t!=="textarea"||d!=="")&&Xx(n,d):typeof d=="number"&&Xx(n,""+d):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&($x.hasOwnProperty(a)?d!=null&&a==="onScroll"&&Gr("scroll",n):d!=null&&vI(n,a,d,l))}switch(t){case"input":gw(n),KD(n,i,!1);break;case"textarea":gw(n),eL(n);break;case"option":i.value!=null&&n.setAttribute("value",""+pp(i.value));break;case"select":n.multiple=!!i.multiple,a=i.value,a!=null?$_(n,!!i.multiple,a,!1):i.defaultValue!=null&&$_(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=yS)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ea(e),null;case 6:if(n&&e.stateNode!=null)PN(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(on(166));if(t=zm(ov.current),zm(yh.current),Tw(e)){if(i=e.stateNode,t=e.memoizedProps,i[mh]=e,(a=i.nodeValue!==t)&&(n=kl,n!==null))switch(n.tag){case 3:Mw(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Mw(i.nodeValue,t,(n.mode&1)!==0)}a&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[mh]=e,e.stateNode=i}return ea(e),null;case 13:if(Hr(ss),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Xr&&Pl!==null&&e.mode&1&&!(e.flags&128))ZB(),uy(),e.flags|=98560,a=!1;else if(a=Tw(e),i!==null&&i.dehydrated!==null){if(n===null){if(!a)throw Error(on(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(on(317));a[mh]=e}else uy(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ea(e),a=!1}else xu!==null&&(BA(xu),xu=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||ss.current&1?io===0&&(io=3):nP())),e.updateQueue!==null&&(e.flags|=4),ea(e),null);case 4:return dy(),PA(n,e),n===null&&nv(e.stateNode.containerInfo),ea(e),null;case 10:return NI(e.type._context),ea(e),null;case 17:return Ja(e.type)&&xS(),ea(e),null;case 19:if(Hr(ss),a=e.memoizedState,a===null)return ea(e),null;if(i=(e.flags&128)!==0,l=a.rendering,l===null)if(i)N0(a,!1);else{if(io!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(l=ES(n),l!==null){for(e.flags|=128,N0(a,!1),i=l.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)a=t,n=i,a.flags&=14680066,l=a.alternate,l===null?(a.childLanes=0,a.lanes=n,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,n=l.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Br(ss,ss.current&1|2),e.child}n=n.sibling}a.tail!==null&&Rs()>py&&(e.flags|=128,i=!0,N0(a,!1),e.lanes=4194304)}else{if(!i)if(n=ES(l),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),N0(a,!0),a.tail===null&&a.tailMode==="hidden"&&!l.alternate&&!Xr)return ea(e),null}else 2*Rs()-a.renderingStartTime>py&&t!==1073741824&&(e.flags|=128,i=!0,N0(a,!1),e.lanes=4194304);a.isBackwards?(l.sibling=e.child,e.child=l):(t=a.last,t!==null?t.sibling=l:e.child=l,a.last=l)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Rs(),e.sibling=null,t=ss.current,Br(ss,i?t&1|2:t&1),e):(ea(e),null);case 22:case 23:return tP(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Al&1073741824&&(ea(e),e.subtreeFlags&6&&(e.flags|=8192)):ea(e),null;case 24:return null;case 25:return null}throw Error(on(156,e.tag))}function zj(n,e){switch(zI(e),e.tag){case 1:return Ja(e.type)&&xS(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return dy(),Hr(Ya),Hr(fa),HI(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return WI(e),null;case 13:if(Hr(ss),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(on(340));uy()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Hr(ss),null;case 4:return dy(),null;case 10:return NI(e.type._context),null;case 22:case 23:return tP(),null;case 24:return null;default:return null}}var Cw=!1,sa=!1,Oj=typeof WeakSet=="function"?WeakSet:Set,Bn=null;function U_(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){xs(n,e,i)}else t.current=null}function kA(n,e,t){try{t()}catch(i){xs(n,e,i)}}var WL=!1;function Fj(n,e){if(pA=mS,n=RB(),LI(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{t.nodeType,a.nodeType}catch{t=null;break e}var l=0,s=-1,d=-1,m=0,_=0,S=n,T=null;t:for(;;){for(var C;S!==t||r!==0&&S.nodeType!==3||(s=l+r),S!==a||i!==0&&S.nodeType!==3||(d=l+i),S.nodeType===3&&(l+=S.nodeValue.length),(C=S.firstChild)!==null;)T=S,S=C;for(;;){if(S===n)break t;if(T===t&&++m===r&&(s=l),T===a&&++_===i&&(d=l),(C=S.nextSibling)!==null)break;S=T,T=S.parentNode}S=C}t=s===-1||d===-1?null:{start:s,end:d}}else t=null}t=t||{start:0,end:0}}else t=null;for(mA={focusedElem:n,selectionRange:t},mS=!1,Bn=e;Bn!==null;)if(e=Bn,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Bn=n;else for(;Bn!==null;){e=Bn;try{var P=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(P!==null){var k=P.memoizedProps,R=P.memoizedState,O=e.stateNode,F=O.getSnapshotBeforeUpdate(e.elementType===e.type?k:mu(e.type,k),R);O.__reactInternalSnapshotBeforeUpdate=F}break;case 3:var N=e.stateNode.containerInfo;N.nodeType===1?N.textContent="":N.nodeType===9&&N.documentElement&&N.removeChild(N.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(on(163))}}catch(G){xs(e,e.return,G)}if(n=e.sibling,n!==null){n.return=e.return,Bn=n;break}Bn=e.return}return P=WL,WL=!1,P}function Ix(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var a=r.destroy;r.destroy=void 0,a!==void 0&&kA(e,t,a)}r=r.next}while(r!==i)}}function yM(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function DA(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function kN(n){var e=n.alternate;e!==null&&(n.alternate=null,kN(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[mh],delete e[rv],delete e[yA],delete e[xj],delete e[vj])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function DN(n){return n.tag===5||n.tag===3||n.tag===4}function HL(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||DN(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function LA(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=yS));else if(i!==4&&(n=n.child,n!==null))for(LA(n,e,t),n=n.sibling;n!==null;)LA(n,e,t),n=n.sibling}function RA(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(RA(n,e,t),n=n.sibling;n!==null;)RA(n,e,t),n=n.sibling}var Lo=null,gu=!1;function Ef(n,e,t){for(t=t.child;t!==null;)LN(n,e,t),t=t.sibling}function LN(n,e,t){if(_h&&typeof _h.onCommitFiberUnmount=="function")try{_h.onCommitFiberUnmount(uM,t)}catch{}switch(t.tag){case 5:sa||U_(t,e);case 6:var i=Lo,r=gu;Lo=null,Ef(n,e,t),Lo=i,gu=r,Lo!==null&&(gu?(n=Lo,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Lo.removeChild(t.stateNode));break;case 18:Lo!==null&&(gu?(n=Lo,t=t.stateNode,n.nodeType===8?_2(n.parentNode,t):n.nodeType===1&&_2(n,t),Qx(n)):_2(Lo,t.stateNode));break;case 4:i=Lo,r=gu,Lo=t.stateNode.containerInfo,gu=!0,Ef(n,e,t),Lo=i,gu=r;break;case 0:case 11:case 14:case 15:if(!sa&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var a=r,l=a.destroy;a=a.tag,l!==void 0&&(a&2||a&4)&&kA(t,e,l),r=r.next}while(r!==i)}Ef(n,e,t);break;case 1:if(!sa&&(U_(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(s){xs(t,e,s)}Ef(n,e,t);break;case 21:Ef(n,e,t);break;case 22:t.mode&1?(sa=(i=sa)||t.memoizedState!==null,Ef(n,e,t),sa=i):Ef(n,e,t);break;default:Ef(n,e,t)}}function jL(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new Oj),e.forEach(function(i){var r=qj.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function cu(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var a=n,l=e,s=l;e:for(;s!==null;){switch(s.tag){case 5:Lo=s.stateNode,gu=!1;break e;case 3:Lo=s.stateNode.containerInfo,gu=!0;break e;case 4:Lo=s.stateNode.containerInfo,gu=!0;break e}s=s.return}if(Lo===null)throw Error(on(160));LN(a,l,r),Lo=null,gu=!1;var d=r.alternate;d!==null&&(d.return=null),r.return=null}catch(m){xs(r,e,m)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)RN(e,n),e=e.sibling}function RN(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(cu(e,n),hh(n),i&4){try{Ix(3,n,n.return),yM(3,n)}catch(k){xs(n,n.return,k)}try{Ix(5,n,n.return)}catch(k){xs(n,n.return,k)}}break;case 1:cu(e,n),hh(n),i&512&&t!==null&&U_(t,t.return);break;case 5:if(cu(e,n),hh(n),i&512&&t!==null&&U_(t,t.return),n.flags&32){var r=n.stateNode;try{Xx(r,"")}catch(k){xs(n,n.return,k)}}if(i&4&&(r=n.stateNode,r!=null)){var a=n.memoizedProps,l=t!==null?t.memoizedProps:a,s=n.type,d=n.updateQueue;if(n.updateQueue=null,d!==null)try{s==="input"&&a.type==="radio"&&a.name!=null&&tB(r,a),rA(s,l);var m=rA(s,a);for(l=0;l<d.length;l+=2){var _=d[l],S=d[l+1];_==="style"?oB(r,S):_==="dangerouslySetInnerHTML"?rB(r,S):_==="children"?Xx(r,S):vI(r,_,S,m)}switch(s){case"input":QE(r,a);break;case"textarea":nB(r,a);break;case"select":var T=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var C=a.value;C!=null?$_(r,!!a.multiple,C,!1):T!==!!a.multiple&&(a.defaultValue!=null?$_(r,!!a.multiple,a.defaultValue,!0):$_(r,!!a.multiple,a.multiple?[]:"",!1))}r[rv]=a}catch(k){xs(n,n.return,k)}}break;case 6:if(cu(e,n),hh(n),i&4){if(n.stateNode===null)throw Error(on(162));r=n.stateNode,a=n.memoizedProps;try{r.nodeValue=a}catch(k){xs(n,n.return,k)}}break;case 3:if(cu(e,n),hh(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Qx(e.containerInfo)}catch(k){xs(n,n.return,k)}break;case 4:cu(e,n),hh(n);break;case 13:cu(e,n),hh(n),r=n.child,r.flags&8192&&(a=r.memoizedState!==null,r.stateNode.isHidden=a,!a||r.alternate!==null&&r.alternate.memoizedState!==null||(QI=Rs())),i&4&&jL(n);break;case 22:if(_=t!==null&&t.memoizedState!==null,n.mode&1?(sa=(m=sa)||_,cu(e,n),sa=m):cu(e,n),hh(n),i&8192){if(m=n.memoizedState!==null,(n.stateNode.isHidden=m)&&!_&&n.mode&1)for(Bn=n,_=n.child;_!==null;){for(S=Bn=_;Bn!==null;){switch(T=Bn,C=T.child,T.tag){case 0:case 11:case 14:case 15:Ix(4,T,T.return);break;case 1:U_(T,T.return);var P=T.stateNode;if(typeof P.componentWillUnmount=="function"){i=T,t=T.return;try{e=i,P.props=e.memoizedProps,P.state=e.memoizedState,P.componentWillUnmount()}catch(k){xs(i,t,k)}}break;case 5:U_(T,T.return);break;case 22:if(T.memoizedState!==null){ZL(S);continue}}C!==null?(C.return=T,Bn=C):ZL(S)}_=_.sibling}e:for(_=null,S=n;;){if(S.tag===5){if(_===null){_=S;try{r=S.stateNode,m?(a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(s=S.stateNode,d=S.memoizedProps.style,l=d!=null&&d.hasOwnProperty("display")?d.display:null,s.style.display=sB("display",l))}catch(k){xs(n,n.return,k)}}}else if(S.tag===6){if(_===null)try{S.stateNode.nodeValue=m?"":S.memoizedProps}catch(k){xs(n,n.return,k)}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===n)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===n)break e;for(;S.sibling===null;){if(S.return===null||S.return===n)break e;_===S&&(_=null),S=S.return}_===S&&(_=null),S.sibling.return=S.return,S=S.sibling}}break;case 19:cu(e,n),hh(n),i&4&&jL(n);break;case 21:break;default:cu(e,n),hh(n)}}function hh(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(DN(t)){var i=t;break e}t=t.return}throw Error(on(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Xx(r,""),i.flags&=-33);var a=HL(n);RA(n,a,r);break;case 3:case 4:var l=i.stateNode.containerInfo,s=HL(n);LA(n,s,l);break;default:throw Error(on(161))}}catch(d){xs(n,n.return,d)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Bj(n,e,t){Bn=n,zN(n)}function zN(n,e,t){for(var i=(n.mode&1)!==0;Bn!==null;){var r=Bn,a=r.child;if(r.tag===22&&i){var l=r.memoizedState!==null||Cw;if(!l){var s=r.alternate,d=s!==null&&s.memoizedState!==null||sa;s=Cw;var m=sa;if(Cw=l,(sa=d)&&!m)for(Bn=r;Bn!==null;)l=Bn,d=l.child,l.tag===22&&l.memoizedState!==null?$L(r):d!==null?(d.return=l,Bn=d):$L(r);for(;a!==null;)Bn=a,zN(a),a=a.sibling;Bn=r,Cw=s,sa=m}qL(n)}else r.subtreeFlags&8772&&a!==null?(a.return=r,Bn=a):qL(n)}}function qL(n){for(;Bn!==null;){var e=Bn;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:sa||yM(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!sa)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:mu(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&IL(e,a,i);break;case 3:var l=e.updateQueue;if(l!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}IL(e,l,t)}break;case 5:var s=e.stateNode;if(t===null&&e.flags&4){t=s;var d=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&t.focus();break;case"img":d.src&&(t.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var m=e.alternate;if(m!==null){var _=m.memoizedState;if(_!==null){var S=_.dehydrated;S!==null&&Qx(S)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(on(163))}sa||e.flags&512&&DA(e)}catch(T){xs(e,e.return,T)}}if(e===n){Bn=null;break}if(t=e.sibling,t!==null){t.return=e.return,Bn=t;break}Bn=e.return}}function ZL(n){for(;Bn!==null;){var e=Bn;if(e===n){Bn=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Bn=t;break}Bn=e.return}}function $L(n){for(;Bn!==null;){var e=Bn;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{yM(4,e)}catch(d){xs(e,t,d)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(d){xs(e,r,d)}}var a=e.return;try{DA(e)}catch(d){xs(e,a,d)}break;case 5:var l=e.return;try{DA(e)}catch(d){xs(e,l,d)}}}catch(d){xs(e,e.return,d)}if(e===n){Bn=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Bn=s;break}Bn=e.return}}var Nj=Math.ceil,IS=qd.ReactCurrentDispatcher,JI=qd.ReactCurrentOwner,Tc=qd.ReactCurrentBatchConfig,or=0,So=null,js=null,Fo=0,Al=0,V_=Tp(0),io=0,uv=null,sg=0,xM=0,KI=0,Px=null,ja=null,QI=0,py=1/0,xd=null,PS=!1,zA=null,op=null,Iw=!1,jf=null,kS=0,kx=0,OA=null,Zb=-1,$b=0;function Ca(){return or&6?Rs():Zb!==-1?Zb:Zb=Rs()}function ap(n){return n.mode&1?or&2&&Fo!==0?Fo&-Fo:bj.transition!==null?($b===0&&($b=yB()),$b):(n=Sr,n!==0||(n=window.event,n=n===void 0?16:TB(n.type)),n):1}function Tu(n,e,t,i){if(50<kx)throw kx=0,OA=null,Error(on(185));Wv(n,t,i),(!(or&2)||n!==So)&&(n===So&&(!(or&2)&&(xM|=t),io===4&&Gf(n,Fo)),Ka(n,i),t===1&&or===0&&!(e.mode&1)&&(py=Rs()+500,mM&&Ep()))}function Ka(n,e){var t=n.callbackNode;bH(n,e);var i=pS(n,n===So?Fo:0);if(i===0)t!==null&&iL(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&iL(t),e===1)n.tag===0?wj(XL.bind(null,n)):HB(XL.bind(null,n)),_j(function(){!(or&6)&&Ep()}),t=null;else{switch(xB(i)){case 1:t=TI;break;case 4:t=gB;break;case 16:t=fS;break;case 536870912:t=_B;break;default:t=fS}t=WN(t,ON.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function ON(n,e){if(Zb=-1,$b=0,or&6)throw Error(on(327));var t=n.callbackNode;if(Q_()&&n.callbackNode!==t)return null;var i=pS(n,n===So?Fo:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=DS(n,i);else{e=i;var r=or;or|=2;var a=BN();(So!==n||Fo!==e)&&(xd=null,py=Rs()+500,Wm(n,e));do try{Gj();break}catch(s){FN(n,s)}while(1);BI(),IS.current=a,or=r,js!==null?e=0:(So=null,Fo=0,e=io)}if(e!==0){if(e===2&&(r=cA(n),r!==0&&(i=r,e=FA(n,r))),e===1)throw t=uv,Wm(n,0),Gf(n,i),Ka(n,Rs()),t;if(e===6)Gf(n,i);else{if(r=n.current.alternate,!(i&30)&&!Uj(r)&&(e=DS(n,i),e===2&&(a=cA(n),a!==0&&(i=a,e=FA(n,a))),e===1))throw t=uv,Wm(n,0),Gf(n,i),Ka(n,Rs()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(on(345));case 2:Mm(n,ja,xd);break;case 3:if(Gf(n,i),(i&130023424)===i&&(e=QI+500-Rs(),10<e)){if(pS(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){Ca(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=_A(Mm.bind(null,n,ja,xd),e);break}Mm(n,ja,xd);break;case 4:if(Gf(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var l=31-Mu(i);a=1<<l,l=e[l],l>r&&(r=l),i&=~a}if(i=r,i=Rs()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Nj(i/1960))-i,10<i){n.timeoutHandle=_A(Mm.bind(null,n,ja,xd),i);break}Mm(n,ja,xd);break;case 5:Mm(n,ja,xd);break;default:throw Error(on(329))}}}return Ka(n,Rs()),n.callbackNode===t?ON.bind(null,n):null}function FA(n,e){var t=Px;return n.current.memoizedState.isDehydrated&&(Wm(n,e).flags|=256),n=DS(n,e),n!==2&&(e=ja,ja=t,e!==null&&BA(e)),n}function BA(n){ja===null?ja=n:ja.push.apply(ja,n)}function Uj(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],a=r.getSnapshot;r=r.value;try{if(!Cu(a(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Gf(n,e){for(e&=~KI,e&=~xM,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Mu(e),i=1<<t;n[t]=-1,e&=~i}}function XL(n){if(or&6)throw Error(on(327));Q_();var e=pS(n,0);if(!(e&1))return Ka(n,Rs()),null;var t=DS(n,e);if(n.tag!==0&&t===2){var i=cA(n);i!==0&&(e=i,t=FA(n,i))}if(t===1)throw t=uv,Wm(n,0),Gf(n,e),Ka(n,Rs()),t;if(t===6)throw Error(on(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Mm(n,ja,xd),Ka(n,Rs()),null}function eP(n,e){var t=or;or|=1;try{return n(e)}finally{or=t,or===0&&(py=Rs()+500,mM&&Ep())}}function og(n){jf!==null&&jf.tag===0&&!(or&6)&&Q_();var e=or;or|=1;var t=Tc.transition,i=Sr;try{if(Tc.transition=null,Sr=1,n)return n()}finally{Sr=i,Tc.transition=t,or=e,!(or&6)&&Ep()}}function tP(){Al=V_.current,Hr(V_)}function Wm(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,gj(t)),js!==null)for(t=js.return;t!==null;){var i=t;switch(zI(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&xS();break;case 3:dy(),Hr(Ya),Hr(fa),HI();break;case 5:WI(i);break;case 4:dy();break;case 13:Hr(ss);break;case 19:Hr(ss);break;case 10:NI(i.type._context);break;case 22:case 23:tP()}t=t.return}if(So=n,js=n=lp(n.current,null),Fo=Al=e,io=0,uv=null,KI=xM=sg=0,ja=Px=null,Rm!==null){for(e=0;e<Rm.length;e++)if(t=Rm[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,a=t.pending;if(a!==null){var l=a.next;a.next=r,i.next=l}t.pending=i}Rm=null}return n}function FN(n,e){do{var t=js;try{if(BI(),Hb.current=CS,AS){for(var i=cs.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}AS=!1}if(rg=0,bo=to=cs=null,Cx=!1,av=0,JI.current=null,t===null||t.return===null){io=1,uv=e,js=null;break}e:{var a=n,l=t.return,s=t,d=e;if(e=Fo,s.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var m=d,_=s,S=_.tag;if(!(_.mode&1)&&(S===0||S===11||S===15)){var T=_.alternate;T?(_.updateQueue=T.updateQueue,_.memoizedState=T.memoizedState,_.lanes=T.lanes):(_.updateQueue=null,_.memoizedState=null)}var C=OL(l);if(C!==null){C.flags&=-257,FL(C,l,s,a,e),C.mode&1&&zL(a,m,e),e=C,d=m;var P=e.updateQueue;if(P===null){var k=new Set;k.add(d),e.updateQueue=k}else P.add(d);break e}else{if(!(e&1)){zL(a,m,e),nP();break e}d=Error(on(426))}}else if(Xr&&s.mode&1){var R=OL(l);if(R!==null){!(R.flags&65536)&&(R.flags|=256),FL(R,l,s,a,e),OI(fy(d,s));break e}}a=d=fy(d,s),io!==4&&(io=2),Px===null?Px=[a]:Px.push(a),a=l;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var O=vN(a,d,e);CL(a,O);break e;case 1:s=d;var F=a.type,N=a.stateNode;if(!(a.flags&128)&&(typeof F.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(op===null||!op.has(N)))){a.flags|=65536,e&=-e,a.lanes|=e;var G=wN(a,s,e);CL(a,G);break e}}a=a.return}while(a!==null)}UN(t)}catch(j){e=j,js===t&&t!==null&&(js=t=t.return);continue}break}while(1)}function BN(){var n=IS.current;return IS.current=CS,n===null?CS:n}function nP(){(io===0||io===3||io===2)&&(io=4),So===null||!(sg&268435455)&&!(xM&268435455)||Gf(So,Fo)}function DS(n,e){var t=or;or|=2;var i=BN();(So!==n||Fo!==e)&&(xd=null,Wm(n,e));do try{Vj();break}catch(r){FN(n,r)}while(1);if(BI(),or=t,IS.current=i,js!==null)throw Error(on(261));return So=null,Fo=0,io}function Vj(){for(;js!==null;)NN(js)}function Gj(){for(;js!==null&&!fH();)NN(js)}function NN(n){var e=GN(n.alternate,n,Al);n.memoizedProps=n.pendingProps,e===null?UN(n):js=e,JI.current=null}function UN(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=zj(t,e),t!==null){t.flags&=32767,js=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{io=6,js=null;return}}else if(t=Rj(t,e,Al),t!==null){js=t;return}if(e=e.sibling,e!==null){js=e;return}js=e=n}while(e!==null);io===0&&(io=5)}function Mm(n,e,t){var i=Sr,r=Tc.transition;try{Tc.transition=null,Sr=1,Wj(n,e,t,i)}finally{Tc.transition=r,Sr=i}return null}function Wj(n,e,t,i){do Q_();while(jf!==null);if(or&6)throw Error(on(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(on(177));n.callbackNode=null,n.callbackPriority=0;var a=t.lanes|t.childLanes;if(SH(n,a),n===So&&(js=So=null,Fo=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Iw||(Iw=!0,WN(fS,function(){return Q_(),null})),a=(t.flags&15990)!==0,t.subtreeFlags&15990||a){a=Tc.transition,Tc.transition=null;var l=Sr;Sr=1;var s=or;or|=4,JI.current=null,Fj(n,t),RN(t,n),cj(mA),mS=!!pA,mA=pA=null,n.current=t,Bj(t),pH(),or=s,Sr=l,Tc.transition=a}else n.current=t;if(Iw&&(Iw=!1,jf=n,kS=r),a=n.pendingLanes,a===0&&(op=null),_H(t.stateNode),Ka(n,Rs()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(PS)throw PS=!1,n=zA,zA=null,n;return kS&1&&n.tag!==0&&Q_(),a=n.pendingLanes,a&1?n===OA?kx++:(kx=0,OA=n):kx=0,Ep(),null}function Q_(){if(jf!==null){var n=xB(kS),e=Tc.transition,t=Sr;try{if(Tc.transition=null,Sr=16>n?16:n,jf===null)var i=!1;else{if(n=jf,jf=null,kS=0,or&6)throw Error(on(331));var r=or;for(or|=4,Bn=n.current;Bn!==null;){var a=Bn,l=a.child;if(Bn.flags&16){var s=a.deletions;if(s!==null){for(var d=0;d<s.length;d++){var m=s[d];for(Bn=m;Bn!==null;){var _=Bn;switch(_.tag){case 0:case 11:case 15:Ix(8,_,a)}var S=_.child;if(S!==null)S.return=_,Bn=S;else for(;Bn!==null;){_=Bn;var T=_.sibling,C=_.return;if(kN(_),_===m){Bn=null;break}if(T!==null){T.return=C,Bn=T;break}Bn=C}}}var P=a.alternate;if(P!==null){var k=P.child;if(k!==null){P.child=null;do{var R=k.sibling;k.sibling=null,k=R}while(k!==null)}}Bn=a}}if(a.subtreeFlags&2064&&l!==null)l.return=a,Bn=l;else e:for(;Bn!==null;){if(a=Bn,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Ix(9,a,a.return)}var O=a.sibling;if(O!==null){O.return=a.return,Bn=O;break e}Bn=a.return}}var F=n.current;for(Bn=F;Bn!==null;){l=Bn;var N=l.child;if(l.subtreeFlags&2064&&N!==null)N.return=l,Bn=N;else e:for(l=F;Bn!==null;){if(s=Bn,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:yM(9,s)}}catch(j){xs(s,s.return,j)}if(s===l){Bn=null;break e}var G=s.sibling;if(G!==null){G.return=s.return,Bn=G;break e}Bn=s.return}}if(or=r,Ep(),_h&&typeof _h.onPostCommitFiberRoot=="function")try{_h.onPostCommitFiberRoot(uM,n)}catch{}i=!0}return i}finally{Sr=t,Tc.transition=e}}return!1}function YL(n,e,t){e=fy(t,e),e=vN(n,e,1),n=sp(n,e,1),e=Ca(),n!==null&&(Wv(n,1,e),Ka(n,e))}function xs(n,e,t){if(n.tag===3)YL(n,n,t);else for(;e!==null;){if(e.tag===3){YL(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(op===null||!op.has(i))){n=fy(t,n),n=wN(e,n,1),e=sp(e,n,1),n=Ca(),e!==null&&(Wv(e,1,n),Ka(e,n));break}}e=e.return}}function Hj(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Ca(),n.pingedLanes|=n.suspendedLanes&t,So===n&&(Fo&t)===t&&(io===4||io===3&&(Fo&130023424)===Fo&&500>Rs()-QI?Wm(n,0):KI|=t),Ka(n,e)}function VN(n,e){e===0&&(n.mode&1?(e=xw,xw<<=1,!(xw&130023424)&&(xw=4194304)):e=1);var t=Ca();n=Fd(n,e),n!==null&&(Wv(n,e,t),Ka(n,t))}function jj(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),VN(n,t)}function qj(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(on(314))}i!==null&&i.delete(e),VN(n,t)}var GN;GN=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Ya.current)Xa=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Xa=!1,Lj(n,e,t);Xa=!!(n.flags&131072)}else Xa=!1,Xr&&e.flags&1048576&&jB(e,bS,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;qb(n,e),n=e.pendingProps;var r=cy(e,fa.current);K_(e,t),r=qI(null,e,i,n,r,t);var a=ZI();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ja(i)?(a=!0,vS(e)):a=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,VI(e),r.updater=gM,e.stateNode=r,r._reactInternals=e,MA(e,i,n,t),e=AA(null,e,i,!0,a,t)):(e.tag=0,Xr&&a&&RI(e),Ta(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(qb(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=$j(i),n=mu(i,n),r){case 0:e=EA(null,e,i,n,t);break e;case 1:e=UL(null,e,i,n,t);break e;case 11:e=BL(null,e,i,n,t);break e;case 14:e=NL(null,e,i,mu(i.type,n),t);break e}throw Error(on(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:mu(i,r),EA(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:mu(i,r),UL(n,e,i,r,t);case 3:e:{if(TN(e),n===null)throw Error(on(387));i=e.pendingProps,a=e.memoizedState,r=a.element,XB(n,e),TS(e,i,null,t);var l=e.memoizedState;if(i=l.element,a.isDehydrated)if(a={element:i,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){r=fy(Error(on(423)),e),e=VL(n,e,i,t,r);break e}else if(i!==r){r=fy(Error(on(424)),e),e=VL(n,e,i,t,r);break e}else for(Pl=rp(e.stateNode.containerInfo.firstChild),kl=e,Xr=!0,xu=null,t=QB(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(uy(),i===r){e=Bd(n,e,t);break e}Ta(n,e,i,t)}e=e.child}return e;case 5:return eN(e),n===null&&wA(e),i=e.type,r=e.pendingProps,a=n!==null?n.memoizedProps:null,l=r.children,gA(i,r)?l=null:a!==null&&gA(i,a)&&(e.flags|=32),MN(n,e),Ta(n,e,l,t),e.child;case 6:return n===null&&wA(e),null;case 13:return EN(n,e,t);case 4:return GI(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=hy(e,null,i,t):Ta(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:mu(i,r),BL(n,e,i,r,t);case 7:return Ta(n,e,e.pendingProps,t),e.child;case 8:return Ta(n,e,e.pendingProps.children,t),e.child;case 12:return Ta(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,a=e.memoizedProps,l=r.value,Br(SS,i._currentValue),i._currentValue=l,a!==null)if(Cu(a.value,l)){if(a.children===r.children&&!Ya.current){e=Bd(n,e,t);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var s=a.dependencies;if(s!==null){l=a.child;for(var d=s.firstContext;d!==null;){if(d.context===i){if(a.tag===1){d=Ld(-1,t&-t),d.tag=2;var m=a.updateQueue;if(m!==null){m=m.shared;var _=m.pending;_===null?d.next=d:(d.next=_.next,_.next=d),m.pending=d}}a.lanes|=t,d=a.alternate,d!==null&&(d.lanes|=t),bA(a.return,t,e),s.lanes|=t;break}d=d.next}}else if(a.tag===10)l=a.type===e.type?null:a.child;else if(a.tag===18){if(l=a.return,l===null)throw Error(on(341));l.lanes|=t,s=l.alternate,s!==null&&(s.lanes|=t),bA(l,t,e),l=a.sibling}else l=a.child;if(l!==null)l.return=a;else for(l=a;l!==null;){if(l===e){l=null;break}if(a=l.sibling,a!==null){a.return=l.return,l=a;break}l=l.return}a=l}Ta(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,K_(e,t),r=Ec(r),i=i(r),e.flags|=1,Ta(n,e,i,t),e.child;case 14:return i=e.type,r=mu(i,e.pendingProps),r=mu(i.type,r),NL(n,e,i,r,t);case 15:return bN(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:mu(i,r),qb(n,e),e.tag=1,Ja(i)?(n=!0,vS(e)):n=!1,K_(e,t),JB(e,i,r),MA(e,i,r,t),AA(null,e,i,!0,n,t);case 19:return AN(n,e,t);case 22:return SN(n,e,t)}throw Error(on(156,e.tag))};function WN(n,e){return mB(n,e)}function Zj(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xc(n,e,t,i){return new Zj(n,e,t,i)}function iP(n){return n=n.prototype,!(!n||!n.isReactComponent)}function $j(n){if(typeof n=="function")return iP(n)?1:0;if(n!=null){if(n=n.$$typeof,n===bI)return 11;if(n===SI)return 14}return 2}function lp(n,e){var t=n.alternate;return t===null?(t=xc(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Xb(n,e,t,i,r,a){var l=2;if(i=n,typeof n=="function")iP(n)&&(l=1);else if(typeof n=="string")l=5;else e:switch(n){case k_:return Hm(t.children,r,a,e);case wI:l=8,r|=8;break;case $E:return n=xc(12,t,e,r|2),n.elementType=$E,n.lanes=a,n;case XE:return n=xc(13,t,e,r),n.elementType=XE,n.lanes=a,n;case YE:return n=xc(19,t,e,r),n.elementType=YE,n.lanes=a,n;case KF:return vM(t,r,a,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case YF:l=10;break e;case JF:l=9;break e;case bI:l=11;break e;case SI:l=14;break e;case Of:l=16,i=null;break e}throw Error(on(130,n==null?n:typeof n,""))}return e=xc(l,t,e,r),e.elementType=n,e.type=i,e.lanes=a,e}function Hm(n,e,t,i){return n=xc(7,n,i,e),n.lanes=t,n}function vM(n,e,t,i){return n=xc(22,n,i,e),n.elementType=KF,n.lanes=t,n.stateNode={isHidden:!1},n}function T2(n,e,t){return n=xc(6,n,null,e),n.lanes=t,n}function E2(n,e,t){return e=xc(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Xj(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=o2(0),this.expirationTimes=o2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=o2(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function rP(n,e,t,i,r,a,l,s,d){return n=new Xj(n,e,t,s,d),e===1?(e=1,a===!0&&(e|=8)):e=0,a=xc(3,null,null,e),n.current=a,a.stateNode=n,a.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},VI(a),n}function Yj(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P_,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function HN(n){if(!n)return mp;n=n._reactInternals;e:{if(gg(n)!==n||n.tag!==1)throw Error(on(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ja(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(on(171))}if(n.tag===1){var t=n.type;if(Ja(t))return WB(n,t,e)}return e}function jN(n,e,t,i,r,a,l,s,d){return n=rP(t,i,!0,n,r,a,l,s,d),n.context=HN(null),t=n.current,i=Ca(),r=ap(t),a=Ld(i,r),a.callback=e??null,sp(t,a,r),n.current.lanes=r,Wv(n,r,i),Ka(n,i),n}function wM(n,e,t,i){var r=e.current,a=Ca(),l=ap(r);return t=HN(t),e.context===null?e.context=t:e.pendingContext=t,e=Ld(a,l),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=sp(r,e,l),n!==null&&(Tu(n,r,l,a),Wb(n,r,l)),l}function LS(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function JL(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function sP(n,e){JL(n,e),(n=n.alternate)&&JL(n,e)}function Jj(){return null}var qN=typeof reportError=="function"?reportError:function(n){console.error(n)};function oP(n){this._internalRoot=n}bM.prototype.render=oP.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(on(409));wM(n,e,null,null)};bM.prototype.unmount=oP.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;og(function(){wM(null,n,null,null)}),e[Od]=null}};function bM(n){this._internalRoot=n}bM.prototype.unstable_scheduleHydration=function(n){if(n){var e=bB();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Vf.length&&e!==0&&e<Vf[t].priority;t++);Vf.splice(t,0,n),t===0&&MB(n)}};function aP(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function SM(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function KL(){}function Kj(n,e,t,i,r){if(r){if(typeof i=="function"){var a=i;i=function(){var m=LS(l);a.call(m)}}var l=jN(e,i,n,0,null,!1,!1,"",KL);return n._reactRootContainer=l,n[Od]=l.current,nv(n.nodeType===8?n.parentNode:n),og(),l}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var s=i;i=function(){var m=LS(d);s.call(m)}}var d=rP(n,0,!1,null,null,!1,!1,"",KL);return n._reactRootContainer=d,n[Od]=d.current,nv(n.nodeType===8?n.parentNode:n),og(function(){wM(e,d,t,i)}),d}function MM(n,e,t,i,r){var a=t._reactRootContainer;if(a){var l=a;if(typeof r=="function"){var s=r;r=function(){var d=LS(l);s.call(d)}}wM(e,l,n,r)}else l=Kj(t,e,n,r,i);return LS(l)}vB=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=px(e.pendingLanes);t!==0&&(EI(e,t|1),Ka(e,Rs()),!(or&6)&&(py=Rs()+500,Ep()))}break;case 13:og(function(){var i=Fd(n,1);if(i!==null){var r=Ca();Tu(i,n,1,r)}}),sP(n,1)}};AI=function(n){if(n.tag===13){var e=Fd(n,134217728);if(e!==null){var t=Ca();Tu(e,n,134217728,t)}sP(n,134217728)}};wB=function(n){if(n.tag===13){var e=ap(n),t=Fd(n,e);if(t!==null){var i=Ca();Tu(t,n,e,i)}sP(n,e)}};bB=function(){return Sr};SB=function(n,e){var t=Sr;try{return Sr=n,e()}finally{Sr=t}};oA=function(n,e,t){switch(e){case"input":if(QE(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=pM(i);if(!r)throw Error(on(90));eB(i),QE(i,r)}}}break;case"textarea":nB(n,t);break;case"select":e=t.value,e!=null&&$_(n,!!t.multiple,e,!1)}};cB=eP;uB=og;var Qj={usingClientEntryPoint:!1,Events:[jv,z_,pM,aB,lB,eP]},U0={findFiberByHostInstance:Lm,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},e9={bundleType:U0.bundleType,version:U0.version,rendererPackageName:U0.rendererPackageName,rendererConfig:U0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:qd.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=fB(n),n===null?null:n.stateNode},findFiberByHostInstance:U0.findFiberByHostInstance||Jj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pw=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pw.isDisabled&&Pw.supportsFiber)try{uM=Pw.inject(e9),_h=Pw}catch{}}Bl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qj;Bl.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!aP(e))throw Error(on(200));return Yj(n,e,null,t)};Bl.createRoot=function(n,e){if(!aP(n))throw Error(on(299));var t=!1,i="",r=qN;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=rP(n,1,!1,null,null,t,!1,i,r),n[Od]=e.current,nv(n.nodeType===8?n.parentNode:n),new oP(e)};Bl.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(on(188)):(n=Object.keys(n).join(","),Error(on(268,n)));return n=fB(e),n=n===null?null:n.stateNode,n};Bl.flushSync=function(n){return og(n)};Bl.hydrate=function(n,e,t){if(!SM(e))throw Error(on(200));return MM(null,n,e,!0,t)};Bl.hydrateRoot=function(n,e,t){if(!aP(n))throw Error(on(405));var i=t!=null&&t.hydratedSources||null,r=!1,a="",l=qN;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onRecoverableError!==void 0&&(l=t.onRecoverableError)),e=jN(e,null,n,1,t??null,r,!1,a,l),n[Od]=e.current,nv(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new bM(e)};Bl.render=function(n,e,t){if(!SM(e))throw Error(on(200));return MM(null,n,e,!1,t)};Bl.unmountComponentAtNode=function(n){if(!SM(n))throw Error(on(40));return n._reactRootContainer?(og(function(){MM(null,null,n,!1,function(){n._reactRootContainer=null,n[Od]=null})}),!0):!1};Bl.unstable_batchedUpdates=eP;Bl.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!SM(t))throw Error(on(200));if(n==null||n._reactInternals===void 0)throw Error(on(38));return MM(n,e,t,!1,i)};Bl.version="18.2.0-next-9e3b772b8-20220608";(function(n){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}e(),n.exports=Bl})(JW);var QL=jE;HE.createRoot=QL.createRoot,HE.hydrateRoot=QL.hydrateRoot;var NA={},t9={get exports(){return NA},set exports(n){NA=n}};(function(n,e){(function(i,r){n.exports=r()})(Fb,function(){var i=function(r){var a="@VERSION@-@BUILDLEVEL@",l=r.localStorage||function(){var ae={};return{setItem:function(le,fe){ae[le]=fe},getItem:function(le){return ae[le]},removeItem:function(le){delete ae[le]}}}(),s={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},d=function(ae,le){for(var fe in ae)if(ae.hasOwnProperty(fe))if(le.hasOwnProperty(fe)){if(typeof ae[fe]!==le[fe])throw new Error(T(_.INVALID_TYPE,[typeof ae[fe],fe]))}else{var Oe="Unknown property, "+fe+". Valid properties are:";for(var We in le)le.hasOwnProperty(We)&&(Oe=Oe+" "+We);throw new Error(Oe)}},m=function(ae,le){return function(){return ae.apply(le,arguments)}},_={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."},BUFFER_FULL:{code:18,text:"AMQJS0018E Message buffer is full, maximum buffer size: {0}."}},S={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},T=function(ae,le){var fe=ae.text;if(le){for(var Oe,We,ce=0;ce<le.length;ce++)if(Oe="{"+ce+"}",We=fe.indexOf(Oe),We>0){var Te=fe.substring(0,We),Pe=fe.substring(We+Oe.length);fe=Te+le[ce]+Pe}}return fe},C=[0,6,77,81,73,115,100,112,3],P=[0,4,77,81,84,84,4],k=function(ae,le){this.type=ae;for(var fe in le)le.hasOwnProperty(fe)&&(this[fe]=le[fe])};k.prototype.encode=function(){var ae=(this.type&15)<<4,le=0,fe=[],Oe=0,We;switch(this.messageIdentifier!==void 0&&(le+=2),this.type){case s.CONNECT:switch(this.mqttVersion){case 3:le+=C.length+3;break;case 4:le+=P.length+3;break}le+=j(this.clientId)+2,this.willMessage!==void 0&&(le+=j(this.willMessage.destinationName)+2,We=this.willMessage.payloadBytes,We instanceof Uint8Array||(We=new Uint8Array(Te)),le+=We.byteLength+2),this.userName!==void 0&&(le+=j(this.userName)+2),this.password!==void 0&&(le+=j(this.password)+2);break;case s.SUBSCRIBE:ae|=2;for(var ce=0;ce<this.topics.length;ce++)fe[ce]=j(this.topics[ce]),le+=fe[ce]+2;le+=this.requestedQos.length;break;case s.UNSUBSCRIBE:ae|=2;for(var ce=0;ce<this.topics.length;ce++)fe[ce]=j(this.topics[ce]),le+=fe[ce]+2;break;case s.PUBREL:ae|=2;break;case s.PUBLISH:this.payloadMessage.duplicate&&(ae|=8),ae=ae|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(ae|=1),Oe=j(this.payloadMessage.destinationName),le+=Oe+2;var Te=this.payloadMessage.payloadBytes;le+=Te.byteLength,Te instanceof ArrayBuffer?Te=new Uint8Array(Te):Te instanceof Uint8Array||(Te=new Uint8Array(Te.buffer));break}var Pe=G(le),Qe=Pe.length+1,Ne=new ArrayBuffer(le+Qe),nt=new Uint8Array(Ne);if(nt[0]=ae,nt.set(Pe,1),this.type==s.PUBLISH)Qe=F(this.payloadMessage.destinationName,Oe,nt,Qe);else if(this.type==s.CONNECT){switch(this.mqttVersion){case 3:nt.set(C,Qe),Qe+=C.length;break;case 4:nt.set(P,Qe),Qe+=P.length;break}var ze=0;this.cleanSession&&(ze=2),this.willMessage!==void 0&&(ze|=4,ze|=this.willMessage.qos<<3,this.willMessage.retained&&(ze|=32)),this.userName!==void 0&&(ze|=128),this.password!==void 0&&(ze|=64),nt[Qe++]=ze,Qe=O(this.keepAliveInterval,nt,Qe)}switch(this.messageIdentifier!==void 0&&(Qe=O(this.messageIdentifier,nt,Qe)),this.type){case s.CONNECT:Qe=F(this.clientId,j(this.clientId),nt,Qe),this.willMessage!==void 0&&(Qe=F(this.willMessage.destinationName,j(this.willMessage.destinationName),nt,Qe),Qe=O(We.byteLength,nt,Qe),nt.set(We,Qe),Qe+=We.byteLength),this.userName!==void 0&&(Qe=F(this.userName,j(this.userName),nt,Qe)),this.password!==void 0&&(Qe=F(this.password,j(this.password),nt,Qe));break;case s.PUBLISH:nt.set(Te,Qe);break;case s.SUBSCRIBE:for(var ce=0;ce<this.topics.length;ce++)Qe=F(this.topics[ce],fe[ce],nt,Qe),nt[Qe++]=this.requestedQos[ce];break;case s.UNSUBSCRIBE:for(var ce=0;ce<this.topics.length;ce++)Qe=F(this.topics[ce],fe[ce],nt,Qe);break}return Ne};function R(ae,le){var fe=le,Oe=ae[le],We=Oe>>4,ce=Oe&=15;le+=1;var Te,Pe=0,Qe=1;do{if(le==ae.length)return[null,fe];Te=ae[le++],Pe+=(Te&127)*Qe,Qe*=128}while(Te&128);var Ne=le+Pe;if(Ne>ae.length)return[null,fe];var nt=new k(We);switch(We){case s.CONNACK:var ze=ae[le++];ze&1&&(nt.sessionPresent=!0),nt.returnCode=ae[le++];break;case s.PUBLISH:var et=ce>>1&3,Et=N(ae,le);le+=2;var Nt=re(ae,le,Et);le+=Et,et>0&&(nt.messageIdentifier=N(ae,le),le+=2);var qt=new $e(ae.subarray(le,Ne));(ce&1)==1&&(qt.retained=!0),(ce&8)==8&&(qt.duplicate=!0),qt.qos=et,qt.destinationName=Nt,nt.payloadMessage=qt;break;case s.PUBACK:case s.PUBREC:case s.PUBREL:case s.PUBCOMP:case s.UNSUBACK:nt.messageIdentifier=N(ae,le);break;case s.SUBACK:nt.messageIdentifier=N(ae,le),le+=2,nt.returnCode=ae.subarray(le,Ne);break}return[nt,Ne]}function O(ae,le,fe){return le[fe++]=ae>>8,le[fe++]=ae%256,fe}function F(ae,le,fe,Oe){return Oe=O(le,fe,Oe),Q(ae,fe,Oe),Oe+le}function N(ae,le){return 256*ae[le]+ae[le+1]}function G(ae){var le=new Array(1),fe=0;do{var Oe=ae%128;ae=ae>>7,ae>0&&(Oe|=128),le[fe++]=Oe}while(ae>0&&fe<4);return le}function j(ae){for(var le=0,fe=0;fe<ae.length;fe++){var Oe=ae.charCodeAt(fe);Oe>2047?(55296<=Oe&&Oe<=56319&&(fe++,le++),le+=3):Oe>127?le+=2:le++}return le}function Q(ae,le,fe){for(var Oe=fe,We=0;We<ae.length;We++){var ce=ae.charCodeAt(We);if(55296<=ce&&ce<=56319){var Te=ae.charCodeAt(++We);if(isNaN(Te))throw new Error(T(_.MALFORMED_UNICODE,[ce,Te]));ce=(ce-55296<<10)+(Te-56320)+65536}ce<=127?le[Oe++]=ce:ce<=2047?(le[Oe++]=ce>>6&31|192,le[Oe++]=ce&63|128):ce<=65535?(le[Oe++]=ce>>12&15|224,le[Oe++]=ce>>6&63|128,le[Oe++]=ce&63|128):(le[Oe++]=ce>>18&7|240,le[Oe++]=ce>>12&63|128,le[Oe++]=ce>>6&63|128,le[Oe++]=ce&63|128)}return le}function re(ae,le,fe){for(var Oe="",We,ce=le;ce<le+fe;){var Te=ae[ce++];if(Te<128)We=Te;else{var Pe=ae[ce++]-128;if(Pe<0)throw new Error(T(_.MALFORMED_UTF,[Te.toString(16),Pe.toString(16),""]));if(Te<224)We=64*(Te-192)+Pe;else{var Qe=ae[ce++]-128;if(Qe<0)throw new Error(T(_.MALFORMED_UTF,[Te.toString(16),Pe.toString(16),Qe.toString(16)]));if(Te<240)We=4096*(Te-224)+64*Pe+Qe;else{var Ne=ae[ce++]-128;if(Ne<0)throw new Error(T(_.MALFORMED_UTF,[Te.toString(16),Pe.toString(16),Qe.toString(16),Ne.toString(16)]));if(Te<248)We=262144*(Te-240)+4096*Pe+64*Qe+Ne;else throw new Error(T(_.MALFORMED_UTF,[Te.toString(16),Pe.toString(16),Qe.toString(16),Ne.toString(16)]))}}}We>65535&&(We-=65536,Oe+=String.fromCharCode(55296+(We>>10)),We=56320+(We&1023)),Oe+=String.fromCharCode(We)}return Oe}var $=function(ae,le){this._client=ae,this._keepAliveInterval=le*1e3,this.isReset=!1;var fe=new k(s.PINGREQ).encode(),Oe=function(ce){return function(){return We.apply(ce)}},We=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(fe),this.timeout=setTimeout(Oe(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(_.PING_TIMEOUT.code,T(_.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(Oe(this),this._keepAliveInterval))},this.cancel=function(){clearTimeout(this.timeout)}},ne=function(ae,le,fe,Oe){le||(le=30);var We=function(ce,Te,Pe){return function(){return ce.apply(Te,Pe)}};this.timeout=setTimeout(We(fe,ae,Oe),le*1e3),this.cancel=function(){clearTimeout(this.timeout)}},ue=function(ae,le,fe,Oe,We){if(!("WebSocket"in r&&r.WebSocket!==null))throw new Error(T(_.UNSUPPORTED,["WebSocket"]));if(!("ArrayBuffer"in r&&r.ArrayBuffer!==null))throw new Error(T(_.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.Client",ae,le,fe,Oe,We),this.host=le,this.port=fe,this.path=Oe,this.uri=ae,this.clientId=We,this._wsuri=null,this._localKey=le+":"+fe+(Oe!="/mqtt"?":"+Oe:"")+":"+We+":",this._msg_queue=[],this._buffered_msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0;for(var ce in l)(ce.indexOf("Sent:"+this._localKey)===0||ce.indexOf("Received:"+this._localKey)===0)&&this.restore(ce)};ue.prototype.host=null,ue.prototype.port=null,ue.prototype.path=null,ue.prototype.uri=null,ue.prototype.clientId=null,ue.prototype.socket=null,ue.prototype.connected=!1,ue.prototype.maxMessageIdentifier=65536,ue.prototype.connectOptions=null,ue.prototype.hostIndex=null,ue.prototype.onConnected=null,ue.prototype.onConnectionLost=null,ue.prototype.onMessageDelivered=null,ue.prototype.onMessageArrived=null,ue.prototype.traceFunction=null,ue.prototype._msg_queue=null,ue.prototype._buffered_msg_queue=null,ue.prototype._connectTimeout=null,ue.prototype.sendPinger=null,ue.prototype.receivePinger=null,ue.prototype._reconnectInterval=1,ue.prototype._reconnecting=!1,ue.prototype._reconnectTimeout=null,ue.prototype.disconnectedPublishing=!1,ue.prototype.disconnectedBufferSize=5e3,ue.prototype.receiveBuffer=null,ue.prototype._traceBuffer=null,ue.prototype._MAX_TRACE_ENTRIES=100,ue.prototype.connect=function(ae){var le=this._traceMask(ae,"password");if(this._trace("Client.connect",le,this.socket,this.connected),this.connected)throw new Error(T(_.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(T(_.INVALID_STATE,["already connected"]));this._reconnecting&&(this._reconnectTimeout.cancel(),this._reconnectTimeout=null,this._reconnecting=!1),this.connectOptions=ae,this._reconnectInterval=1,this._reconnecting=!1,ae.uris?(this.hostIndex=0,this._doConnect(ae.uris[0])):this._doConnect(this.uri)},ue.prototype.subscribe=function(ae,le){if(this._trace("Client.subscribe",ae,le),!this.connected)throw new Error(T(_.INVALID_STATE,["not connected"]));var fe=new k(s.SUBSCRIBE);fe.topics=ae.constructor===Array?ae:[ae],le.qos===void 0&&(le.qos=0),fe.requestedQos=[];for(var Oe=0;Oe<fe.topics.length;Oe++)fe.requestedQos[Oe]=le.qos;le.onSuccess&&(fe.onSuccess=function(We){le.onSuccess({invocationContext:le.invocationContext,grantedQos:We})}),le.onFailure&&(fe.onFailure=function(We){le.onFailure({invocationContext:le.invocationContext,errorCode:We,errorMessage:T(We)})}),le.timeout&&(fe.timeOut=new ne(this,le.timeout,le.onFailure,[{invocationContext:le.invocationContext,errorCode:_.SUBSCRIBE_TIMEOUT.code,errorMessage:T(_.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(fe),this._schedule_message(fe)},ue.prototype.unsubscribe=function(ae,le){if(this._trace("Client.unsubscribe",ae,le),!this.connected)throw new Error(T(_.INVALID_STATE,["not connected"]));var fe=new k(s.UNSUBSCRIBE);fe.topics=ae.constructor===Array?ae:[ae],le.onSuccess&&(fe.callback=function(){le.onSuccess({invocationContext:le.invocationContext})}),le.timeout&&(fe.timeOut=new ne(this,le.timeout,le.onFailure,[{invocationContext:le.invocationContext,errorCode:_.UNSUBSCRIBE_TIMEOUT.code,errorMessage:T(_.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(fe),this._schedule_message(fe)},ue.prototype.send=function(ae){this._trace("Client.send",ae);var le=new k(s.PUBLISH);if(le.payloadMessage=ae,this.connected)ae.qos>0?this._requires_ack(le):this.onMessageDelivered&&(this._notify_msg_sent[le]=this.onMessageDelivered(le.payloadMessage)),this._schedule_message(le);else if(this._reconnecting&&this.disconnectedPublishing){var fe=Object.keys(this._sentMessages).length+this._buffered_msg_queue.length;if(fe>this.disconnectedBufferSize)throw new Error(T(_.BUFFER_FULL,[this.disconnectedBufferSize]));ae.qos>0?this._requires_ack(le):(le.sequence=++this._sequence,this._buffered_msg_queue.unshift(le))}else throw new Error(T(_.INVALID_STATE,["not connected"]))},ue.prototype.disconnect=function(){if(this._trace("Client.disconnect"),this._reconnecting&&(this._reconnectTimeout.cancel(),this._reconnectTimeout=null,this._reconnecting=!1),!this.socket)throw new Error(T(_.INVALID_STATE,["not connecting or connected"]));var ae=new k(s.DISCONNECT);this._notify_msg_sent[ae]=m(this._disconnected,this),this._schedule_message(ae)},ue.prototype.getTraceLog=function(){if(this._traceBuffer!==null){this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var ae in this._sentMessages)this._trace("_sentMessages ",ae,this._sentMessages[ae]);for(var ae in this._receivedMessages)this._trace("_receivedMessages ",ae,this._receivedMessages[ae]);return this._traceBuffer}},ue.prototype.startTrace=function(){this._traceBuffer===null&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,a)},ue.prototype.stopTrace=function(){delete this._traceBuffer},ue.prototype._doConnect=function(ae){if(this.connectOptions.useSSL){var le=ae.split(":");le[0]="wss",ae=le.join(":")}this._wsuri=ae,this.connected=!1,this.connectOptions.mqttVersion<4?this.socket=new WebSocket(ae,["mqttv3.1"]):this.socket=new WebSocket(ae,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=m(this._on_socket_open,this),this.socket.onmessage=m(this._on_socket_message,this),this.socket.onerror=m(this._on_socket_error,this),this.socket.onclose=m(this._on_socket_close,this),this.sendPinger=new $(this,this.connectOptions.keepAliveInterval),this.receivePinger=new $(this,this.connectOptions.keepAliveInterval),this._connectTimeout&&(this._connectTimeout.cancel(),this._connectTimeout=null),this._connectTimeout=new ne(this,this.connectOptions.timeout,this._disconnected,[_.CONNECT_TIMEOUT.code,T(_.CONNECT_TIMEOUT)])},ue.prototype._schedule_message=function(ae){this._msg_queue.unshift(ae),this.connected&&this._process_queue()},ue.prototype.store=function(ae,le){var fe={type:le.type,messageIdentifier:le.messageIdentifier,version:1};switch(le.type){case s.PUBLISH:le.pubRecReceived&&(fe.pubRecReceived=!0),fe.payloadMessage={};for(var Oe="",We=le.payloadMessage.payloadBytes,ce=0;ce<We.length;ce++)We[ce]<=15?Oe=Oe+"0"+We[ce].toString(16):Oe=Oe+We[ce].toString(16);fe.payloadMessage.payloadHex=Oe,fe.payloadMessage.qos=le.payloadMessage.qos,fe.payloadMessage.destinationName=le.payloadMessage.destinationName,le.payloadMessage.duplicate&&(fe.payloadMessage.duplicate=!0),le.payloadMessage.retained&&(fe.payloadMessage.retained=!0),ae.indexOf("Sent:")===0&&(le.sequence===void 0&&(le.sequence=++this._sequence),fe.sequence=le.sequence);break;default:throw Error(T(_.INVALID_STORED_DATA,[ae+this._localKey+le.messageIdentifier,fe]))}l.setItem(ae+this._localKey+le.messageIdentifier,JSON.stringify(fe))},ue.prototype.restore=function(ae){var le=l.getItem(ae),fe=JSON.parse(le),Oe=new k(fe.type,fe);switch(fe.type){case s.PUBLISH:for(var We=fe.payloadMessage.payloadHex,ce=new ArrayBuffer(We.length/2),Te=new Uint8Array(ce),Pe=0;We.length>=2;){var Qe=parseInt(We.substring(0,2),16);We=We.substring(2,We.length),Te[Pe++]=Qe}var Ne=new $e(Te);Ne.qos=fe.payloadMessage.qos,Ne.destinationName=fe.payloadMessage.destinationName,fe.payloadMessage.duplicate&&(Ne.duplicate=!0),fe.payloadMessage.retained&&(Ne.retained=!0),Oe.payloadMessage=Ne;break;default:throw Error(T(_.INVALID_STORED_DATA,[ae,le]))}ae.indexOf("Sent:"+this._localKey)===0?(Oe.payloadMessage.duplicate=!0,this._sentMessages[Oe.messageIdentifier]=Oe):ae.indexOf("Received:"+this._localKey)===0&&(this._receivedMessages[Oe.messageIdentifier]=Oe)},ue.prototype._process_queue=function(){for(var ae=null;ae=this._msg_queue.pop();)this._socket_send(ae),this._notify_msg_sent[ae]&&(this._notify_msg_sent[ae](),delete this._notify_msg_sent[ae])},ue.prototype._requires_ack=function(ae){var le=Object.keys(this._sentMessages).length;if(le>this.maxMessageIdentifier)throw Error("Too many messages:"+le);for(;this._sentMessages[this._message_identifier]!==void 0;)this._message_identifier++;ae.messageIdentifier=this._message_identifier,this._sentMessages[ae.messageIdentifier]=ae,ae.type===s.PUBLISH&&this.store("Sent:",ae),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},ue.prototype._on_socket_open=function(){var ae=new k(s.CONNECT,this.connectOptions);ae.clientId=this.clientId,this._socket_send(ae)},ue.prototype._on_socket_message=function(ae){this._trace("Client._on_socket_message",ae.data);for(var le=this._deframeMessages(ae.data),fe=0;fe<le.length;fe+=1)this._handleMessage(le[fe])},ue.prototype._deframeMessages=function(ae){var le=new Uint8Array(ae),fe=[];if(this.receiveBuffer){var Oe=new Uint8Array(this.receiveBuffer.length+le.length);Oe.set(this.receiveBuffer),Oe.set(le,this.receiveBuffer.length),le=Oe,delete this.receiveBuffer}try{for(var We=0;We<le.length;){var ce=R(le,We),Te=ce[0];if(We=ce[1],Te!==null)fe.push(Te);else break}We<le.length&&(this.receiveBuffer=le.subarray(We))}catch(Qe){var Pe=Qe.hasOwnProperty("stack")=="undefined"?Qe.stack.toString():"No Error Stack Available";this._disconnected(_.INTERNAL_ERROR.code,T(_.INTERNAL_ERROR,[Qe.message,Pe]));return}return fe},ue.prototype._handleMessage=function(ae){this._trace("Client._handleMessage",ae);try{switch(ae.type){case s.CONNACK:if(this._connectTimeout.cancel(),this._reconnectTimeout&&this._reconnectTimeout.cancel(),this.connectOptions.cleanSession){for(var le in this._sentMessages){var ze=this._sentMessages[le];l.removeItem("Sent:"+this._localKey+ze.messageIdentifier)}this._sentMessages={};for(var le in this._receivedMessages){var Ne=this._receivedMessages[le];l.removeItem("Received:"+this._localKey+Ne.messageIdentifier)}this._receivedMessages={}}if(ae.returnCode===0)this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);else{this._disconnected(_.CONNACK_RETURNCODE.code,T(_.CONNACK_RETURNCODE,[ae.returnCode,S[ae.returnCode]]));break}var We=[];for(var fe in this._sentMessages)this._sentMessages.hasOwnProperty(fe)&&We.push(this._sentMessages[fe]);if(this._buffered_msg_queue.length>0)for(var Oe=null;Oe=this._buffered_msg_queue.pop();)We.push(Oe),this.onMessageDelivered&&(this._notify_msg_sent[Oe]=this.onMessageDelivered(Oe.payloadMessage));for(var We=We.sort(function(Et,Nt){return Et.sequence-Nt.sequence}),ce=0,Te=We.length;ce<Te;ce++){var ze=We[ce];if(ze.type==s.PUBLISH&&ze.pubRecReceived){var Pe=new k(s.PUBREL,{messageIdentifier:ze.messageIdentifier});this._schedule_message(Pe)}else this._schedule_message(ze)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext});var Qe=!1;this._reconnecting&&(Qe=!0,this._reconnectInterval=1,this._reconnecting=!1),this._connected(Qe,this._wsuri),this._process_queue();break;case s.PUBLISH:this._receivePublish(ae);break;case s.PUBACK:var ze=this._sentMessages[ae.messageIdentifier];ze&&(delete this._sentMessages[ae.messageIdentifier],l.removeItem("Sent:"+this._localKey+ae.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(ze.payloadMessage));break;case s.PUBREC:var ze=this._sentMessages[ae.messageIdentifier];if(ze){ze.pubRecReceived=!0;var Pe=new k(s.PUBREL,{messageIdentifier:ae.messageIdentifier});this.store("Sent:",ze),this._schedule_message(Pe)}break;case s.PUBREL:var Ne=this._receivedMessages[ae.messageIdentifier];l.removeItem("Received:"+this._localKey+ae.messageIdentifier),Ne&&(this._receiveMessage(Ne),delete this._receivedMessages[ae.messageIdentifier]);var nt=new k(s.PUBCOMP,{messageIdentifier:ae.messageIdentifier});this._schedule_message(nt);break;case s.PUBCOMP:var ze=this._sentMessages[ae.messageIdentifier];delete this._sentMessages[ae.messageIdentifier],l.removeItem("Sent:"+this._localKey+ae.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(ze.payloadMessage);break;case s.SUBACK:var ze=this._sentMessages[ae.messageIdentifier];ze&&(ze.timeOut&&ze.timeOut.cancel(),ae.returnCode[0]===128?ze.onFailure&&ze.onFailure(ae.returnCode):ze.onSuccess&&ze.onSuccess(ae.returnCode),delete this._sentMessages[ae.messageIdentifier]);break;case s.UNSUBACK:var ze=this._sentMessages[ae.messageIdentifier];ze&&(ze.timeOut&&ze.timeOut.cancel(),ze.callback&&ze.callback(),delete this._sentMessages[ae.messageIdentifier]);break;case s.PINGRESP:this.sendPinger.reset();break;case s.DISCONNECT:this._disconnected(_.INVALID_MQTT_MESSAGE_TYPE.code,T(_.INVALID_MQTT_MESSAGE_TYPE,[ae.type]));break;default:this._disconnected(_.INVALID_MQTT_MESSAGE_TYPE.code,T(_.INVALID_MQTT_MESSAGE_TYPE,[ae.type]))}}catch(Et){var et=Et.hasOwnProperty("stack")=="undefined"?Et.stack.toString():"No Error Stack Available";this._disconnected(_.INTERNAL_ERROR.code,T(_.INTERNAL_ERROR,[Et.message,et]));return}},ue.prototype._on_socket_error=function(ae){this._reconnecting||this._disconnected(_.SOCKET_ERROR.code,T(_.SOCKET_ERROR,[ae.data]))},ue.prototype._on_socket_close=function(){this._reconnecting||this._disconnected(_.SOCKET_CLOSE.code,T(_.SOCKET_CLOSE))},ue.prototype._socket_send=function(ae){if(ae.type==1){var le=this._traceMask(ae,"password");this._trace("Client._socket_send",le)}else this._trace("Client._socket_send",ae);this.socket.send(ae.encode()),this.sendPinger.reset()},ue.prototype._receivePublish=function(ae){switch(ae.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(ae);break;case 1:var le=new k(s.PUBACK,{messageIdentifier:ae.messageIdentifier});this._schedule_message(le),this._receiveMessage(ae);break;case 2:this._receivedMessages[ae.messageIdentifier]=ae,this.store("Received:",ae);var fe=new k(s.PUBREC,{messageIdentifier:ae.messageIdentifier});this._schedule_message(fe);break;default:throw Error("Invaild qos="+ae.payloadMessage.qos)}},ue.prototype._receiveMessage=function(ae){this.onMessageArrived&&this.onMessageArrived(ae.payloadMessage)},ue.prototype._connected=function(ae,le){this.onConnected&&this.onConnected(ae,le)},ue.prototype._reconnect=function(){this._trace("Client._reconnect"),this.connected||(this._reconnecting=!0,this.sendPinger.cancel(),this.receivePinger.cancel(),this._reconnectInterval<128&&(this._reconnectInterval=this._reconnectInterval*2),this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri))},ue.prototype._disconnected=function(ae,le){if(this._trace("Client._disconnected",ae,le),ae!==void 0&&this._reconnecting){this._reconnectTimeout=new ne(this,this._reconnectInterval,this._reconnect);return}if(this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&(this._connectTimeout.cancel(),this._connectTimeout=null),this._msg_queue=[],this._buffered_msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.readyState===1&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1)this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex]);else if(ae===void 0&&(ae=_.OK.code,le=T(_.OK)),this.connected){if(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:ae,errorMessage:le,reconnect:this.connectOptions.reconnect,uri:this._wsuri}),ae!==_.OK.code&&this.connectOptions.reconnect){this._reconnectInterval=1,this._reconnect();return}}else this.connectOptions.mqttVersion===4&&this.connectOptions.mqttVersionExplicit===!1?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:ae,errorMessage:le})},ue.prototype._trace=function(){if(this.traceFunction){var ae=Array.prototype.slice.call(arguments);for(var le in ae)typeof ae[le]<"u"&&ae.splice(le,1,JSON.stringify(ae[le]));var fe=ae.join("");this.traceFunction({severity:"Debug",message:fe})}if(this._traceBuffer!==null)for(var le=0,Oe=arguments.length;le<Oe;le++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),le===0?this._traceBuffer.push(arguments[le]):typeof arguments[le]>"u"?this._traceBuffer.push(arguments[le]):this._traceBuffer.push("  "+JSON.stringify(arguments[le]))},ue.prototype._traceMask=function(ae,le){var fe={};for(var Oe in ae)ae.hasOwnProperty(Oe)&&(Oe==le?fe[Oe]="******":fe[Oe]=ae[Oe]);return fe};var De=function(ae,le,fe,Oe){var We;if(typeof ae!="string")throw new Error(T(_.INVALID_TYPE,[typeof ae,"host"]));if(arguments.length==2){Oe=le,We=ae;var ce=We.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(ce)ae=ce[4]||ce[2],le=parseInt(ce[7]),fe=ce[8];else throw new Error(T(_.INVALID_ARGUMENT,[ae,"host"]))}else{if(arguments.length==3&&(Oe=fe,fe="/mqtt"),typeof le!="number"||le<0)throw new Error(T(_.INVALID_TYPE,[typeof le,"port"]));if(typeof fe!="string")throw new Error(T(_.INVALID_TYPE,[typeof fe,"path"]));var Te=ae.indexOf(":")!==-1&&ae.slice(0,1)!=="["&&ae.slice(-1)!=="]";We="ws://"+(Te?"["+ae+"]":ae)+":"+le+fe}for(var Pe=0,Qe=0;Qe<Oe.length;Qe++){var Ne=Oe.charCodeAt(Qe);55296<=Ne&&Ne<=56319&&Qe++,Pe++}if(typeof Oe!="string"||Pe>65535)throw new Error(T(_.INVALID_ARGUMENT,[Oe,"clientId"]));var nt=new ue(We,ae,le,fe,Oe);Object.defineProperties(this,{host:{get:function(){return ae},set:function(){throw new Error(T(_.UNSUPPORTED_OPERATION))}},port:{get:function(){return le},set:function(){throw new Error(T(_.UNSUPPORTED_OPERATION))}},path:{get:function(){return fe},set:function(){throw new Error(T(_.UNSUPPORTED_OPERATION))}},uri:{get:function(){return We},set:function(){throw new Error(T(_.UNSUPPORTED_OPERATION))}},clientId:{get:function(){return nt.clientId},set:function(){throw new Error(T(_.UNSUPPORTED_OPERATION))}},onConnected:{get:function(){return nt.onConnected},set:function(ze){if(typeof ze=="function")nt.onConnected=ze;else throw new Error(T(_.INVALID_TYPE,[typeof ze,"onConnected"]))}},disconnectedPublishing:{get:function(){return nt.disconnectedPublishing},set:function(ze){nt.disconnectedPublishing=ze}},disconnectedBufferSize:{get:function(){return nt.disconnectedBufferSize},set:function(ze){nt.disconnectedBufferSize=ze}},onConnectionLost:{get:function(){return nt.onConnectionLost},set:function(ze){if(typeof ze=="function")nt.onConnectionLost=ze;else throw new Error(T(_.INVALID_TYPE,[typeof ze,"onConnectionLost"]))}},onMessageDelivered:{get:function(){return nt.onMessageDelivered},set:function(ze){if(typeof ze=="function")nt.onMessageDelivered=ze;else throw new Error(T(_.INVALID_TYPE,[typeof ze,"onMessageDelivered"]))}},onMessageArrived:{get:function(){return nt.onMessageArrived},set:function(ze){if(typeof ze=="function")nt.onMessageArrived=ze;else throw new Error(T(_.INVALID_TYPE,[typeof ze,"onMessageArrived"]))}},trace:{get:function(){return nt.traceFunction},set:function(ze){if(typeof ze=="function")nt.traceFunction=ze;else throw new Error(T(_.INVALID_TYPE,[typeof ze,"onTrace"]))}}}),this.connect=function(ze){if(ze=ze||{},d(ze,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",reconnect:"boolean",mqttVersion:"number",mqttVersionExplicit:"boolean",uris:"object"}),ze.keepAliveInterval===void 0&&(ze.keepAliveInterval=60),ze.mqttVersion>4||ze.mqttVersion<3)throw new Error(T(_.INVALID_ARGUMENT,[ze.mqttVersion,"connectOptions.mqttVersion"]));if(ze.mqttVersion===void 0?(ze.mqttVersionExplicit=!1,ze.mqttVersion=4):ze.mqttVersionExplicit=!0,ze.password!==void 0&&ze.userName===void 0)throw new Error(T(_.INVALID_ARGUMENT,[ze.password,"connectOptions.password"]));if(ze.willMessage){if(!(ze.willMessage instanceof $e))throw new Error(T(_.INVALID_TYPE,[ze.willMessage,"connectOptions.willMessage"]));if(ze.willMessage.stringPayload=null,typeof ze.willMessage.destinationName>"u")throw new Error(T(_.INVALID_TYPE,[typeof ze.willMessage.destinationName,"connectOptions.willMessage.destinationName"]))}if(typeof ze.cleanSession>"u"&&(ze.cleanSession=!0),ze.hosts){if(!(ze.hosts instanceof Array))throw new Error(T(_.INVALID_ARGUMENT,[ze.hosts,"connectOptions.hosts"]));if(ze.hosts.length<1)throw new Error(T(_.INVALID_ARGUMENT,[ze.hosts,"connectOptions.hosts"]));for(var et=!1,Et=0;Et<ze.hosts.length;Et++){if(typeof ze.hosts[Et]!="string")throw new Error(T(_.INVALID_TYPE,[typeof ze.hosts[Et],"connectOptions.hosts["+Et+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(ze.hosts[Et])){if(Et===0)et=!0;else if(!et)throw new Error(T(_.INVALID_ARGUMENT,[ze.hosts[Et],"connectOptions.hosts["+Et+"]"]))}else if(et)throw new Error(T(_.INVALID_ARGUMENT,[ze.hosts[Et],"connectOptions.hosts["+Et+"]"]))}if(et)ze.uris=ze.hosts;else{if(!ze.ports)throw new Error(T(_.INVALID_ARGUMENT,[ze.ports,"connectOptions.ports"]));if(!(ze.ports instanceof Array))throw new Error(T(_.INVALID_ARGUMENT,[ze.ports,"connectOptions.ports"]));if(ze.hosts.length!==ze.ports.length)throw new Error(T(_.INVALID_ARGUMENT,[ze.ports,"connectOptions.ports"]));ze.uris=[];for(var Et=0;Et<ze.hosts.length;Et++){if(typeof ze.ports[Et]!="number"||ze.ports[Et]<0)throw new Error(T(_.INVALID_TYPE,[typeof ze.ports[Et],"connectOptions.ports["+Et+"]"]));var Nt=ze.hosts[Et],qt=ze.ports[Et],wn=Nt.indexOf(":")!==-1;We="ws://"+(wn?"["+Nt+"]":Nt)+":"+qt+fe,ze.uris.push(We)}}}nt.connect(ze)},this.subscribe=function(ze,et){if(typeof ze!="string"&&ze.constructor!==Array)throw new Error("Invalid argument:"+ze);if(et=et||{},d(et,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),et.timeout&&!et.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if(typeof et.qos<"u"&&!(et.qos===0||et.qos===1||et.qos===2))throw new Error(T(_.INVALID_ARGUMENT,[et.qos,"subscribeOptions.qos"]));nt.subscribe(ze,et)},this.unsubscribe=function(ze,et){if(typeof ze!="string"&&ze.constructor!==Array)throw new Error("Invalid argument:"+ze);if(et=et||{},d(et,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),et.timeout&&!et.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");nt.unsubscribe(ze,et)},this.send=function(ze,et,Et,Nt){var qt;if(arguments.length===0)throw new Error("Invalid argument.length");if(arguments.length==1){if(!(ze instanceof $e)&&typeof ze!="string")throw new Error("Invalid argument:"+typeof ze);if(qt=ze,typeof qt.destinationName>"u")throw new Error(T(_.INVALID_ARGUMENT,[qt.destinationName,"Message.destinationName"]));nt.send(qt)}else qt=new $e(et),qt.destinationName=ze,arguments.length>=3&&(qt.qos=Et),arguments.length>=4&&(qt.retained=Nt),nt.send(qt)},this.publish=function(ze,et,Et,Nt){var qt;if(arguments.length===0)throw new Error("Invalid argument.length");if(arguments.length==1){if(!(ze instanceof $e)&&typeof ze!="string")throw new Error("Invalid argument:"+typeof ze);if(qt=ze,typeof qt.destinationName>"u")throw new Error(T(_.INVALID_ARGUMENT,[qt.destinationName,"Message.destinationName"]));nt.send(qt)}else qt=new $e(et),qt.destinationName=ze,arguments.length>=3&&(qt.qos=Et),arguments.length>=4&&(qt.retained=Nt),nt.send(qt)},this.disconnect=function(){nt.disconnect()},this.getTraceLog=function(){return nt.getTraceLog()},this.startTrace=function(){nt.startTrace()},this.stopTrace=function(){nt.stopTrace()},this.isConnected=function(){return nt.connected}},$e=function(ae){var le;if(typeof ae=="string"||ae instanceof ArrayBuffer||ArrayBuffer.isView(ae)&&!(ae instanceof DataView))le=ae;else throw T(_.INVALID_ARGUMENT,[ae,"newPayload"]);var fe,Oe=0,We=!1,ce=!1;Object.defineProperties(this,{payloadString:{enumerable:!0,get:function(){return typeof le=="string"?le:re(le,0,le.length)}},payloadBytes:{enumerable:!0,get:function(){if(typeof le=="string"){var Te=new ArrayBuffer(j(le)),Pe=new Uint8Array(Te);return Q(le,Pe,0),Pe}else return le}},destinationName:{enumerable:!0,get:function(){return fe},set:function(Te){if(typeof Te=="string")fe=Te;else throw new Error(T(_.INVALID_ARGUMENT,[Te,"newDestinationName"]))}},qos:{enumerable:!0,get:function(){return Oe},set:function(Te){if(Te===0||Te===1||Te===2)Oe=Te;else throw new Error("Invalid argument:"+Te)}},retained:{enumerable:!0,get:function(){return We},set:function(Te){if(typeof Te=="boolean")We=Te;else throw new Error(T(_.INVALID_ARGUMENT,[Te,"newRetained"]))}},topic:{enumerable:!0,get:function(){return fe},set:function(Te){fe=Te}},duplicate:{enumerable:!0,get:function(){return ce},set:function(Te){ce=Te}}})};return{Client:De,Message:$e}}(typeof Fb<"u"?Fb:typeof self<"u"?self:typeof window<"u"?window:{});return i})})(t9);const n9=NA;/*!
 * Chart.js v3.9.1
 * https://www.chartjs.org
 * (c) 2022 Chart.js Contributors
 * Released under the MIT License
 */function Ha(){}const i9=function(){let n=0;return function(){return n++}}();function _r(n){return n===null||typeof n>"u"}function Lr(n){if(Array.isArray&&Array.isArray(n))return!0;const e=Object.prototype.toString.call(n);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function ar(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}const so=n=>(typeof n=="number"||n instanceof Number)&&isFinite(+n);function uc(n,e){return so(n)?n:e}function Mi(n,e){return typeof n>"u"?e:n}const r9=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:n/e,ZN=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*e:+n;function mr(n,e,t){if(n&&typeof n.call=="function")return n.apply(t,e)}function _i(n,e,t,i){let r,a,l;if(Lr(n))if(a=n.length,i)for(r=a-1;r>=0;r--)e.call(t,n[r],r);else for(r=0;r<a;r++)e.call(t,n[r],r);else if(ar(n))for(l=Object.keys(n),a=l.length,r=0;r<a;r++)e.call(t,n[l[r]],l[r])}function RS(n,e){let t,i,r,a;if(!n||!e||n.length!==e.length)return!1;for(t=0,i=n.length;t<i;++t)if(r=n[t],a=e[t],r.datasetIndex!==a.datasetIndex||r.index!==a.index)return!1;return!0}function zS(n){if(Lr(n))return n.map(zS);if(ar(n)){const e=Object.create(null),t=Object.keys(n),i=t.length;let r=0;for(;r<i;++r)e[t[r]]=zS(n[t[r]]);return e}return n}function $N(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function s9(n,e,t,i){if(!$N(n))return;const r=e[n],a=t[n];ar(r)&&ar(a)?hv(r,a,i):e[n]=zS(a)}function hv(n,e,t){const i=Lr(e)?e:[e],r=i.length;if(!ar(n))return n;t=t||{};const a=t.merger||s9;for(let l=0;l<r;++l){if(e=i[l],!ar(e))continue;const s=Object.keys(e);for(let d=0,m=s.length;d<m;++d)a(s[d],n,e,t)}return n}function Dx(n,e){return hv(n,e,{merger:o9})}function o9(n,e,t){if(!$N(n))return;const i=e[n],r=t[n];ar(i)&&ar(r)?Dx(i,r):Object.prototype.hasOwnProperty.call(e,n)||(e[n]=zS(r))}const eR={"":n=>n,x:n=>n.x,y:n=>n.y};function gp(n,e){return(eR[e]||(eR[e]=a9(e)))(n)}function a9(n){const e=l9(n);return t=>{for(const i of e){if(i==="")break;t=t&&t[i]}return t}}function l9(n){const e=n.split("."),t=[];let i="";for(const r of e)i+=r,i.endsWith("\\")?i=i.slice(0,-1)+".":(t.push(i),i="");return t}function lP(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Cc=n=>typeof n<"u",_p=n=>typeof n=="function",tR=(n,e)=>{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;return!0};function c9(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const Jr=Math.PI,Rr=2*Jr,u9=Rr+Jr,OS=Number.POSITIVE_INFINITY,h9=Jr/180,vs=Jr/2,V0=Jr/4,nR=Jr*2/3,_c=Math.log10,xh=Math.sign;function iR(n){const e=Math.round(n);n=Lx(n,e,n/1e3)?e:n;const t=Math.pow(10,Math.floor(_c(n))),i=n/t;return(i<=1?1:i<=2?2:i<=5?5:10)*t}function d9(n){const e=[],t=Math.sqrt(n);let i;for(i=1;i<t;i++)n%i===0&&(e.push(i),e.push(n/i));return t===(t|0)&&e.push(t),e.sort((r,a)=>r-a).pop(),e}function ag(n){return!isNaN(parseFloat(n))&&isFinite(n)}function Lx(n,e,t){return Math.abs(n-e)<t}function f9(n,e){const t=Math.round(n);return t-e<=n&&t+e>=n}function XN(n,e,t){let i,r,a;for(i=0,r=n.length;i<r;i++)a=n[i][t],isNaN(a)||(e.min=Math.min(e.min,a),e.max=Math.max(e.max,a))}function bu(n){return n*(Jr/180)}function cP(n){return n*(180/Jr)}function rR(n){if(!so(n))return;let e=1,t=0;for(;Math.round(n*e)/e!==n;)e*=10,t++;return t}function YN(n,e){const t=e.x-n.x,i=e.y-n.y,r=Math.sqrt(t*t+i*i);let a=Math.atan2(i,t);return a<-.5*Jr&&(a+=Rr),{angle:a,distance:r}}function UA(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function p9(n,e){return(n-e+u9)%Rr-Jr}function _u(n){return(n%Rr+Rr)%Rr}function dv(n,e,t,i){const r=_u(n),a=_u(e),l=_u(t),s=_u(a-r),d=_u(l-r),m=_u(r-a),_=_u(r-l);return r===a||r===l||i&&a===l||s>d&&m<_}function ca(n,e,t){return Math.max(e,Math.min(t,n))}function m9(n){return ca(n,-32768,32767)}function qf(n,e,t,i=1e-6){return n>=Math.min(e,t)-i&&n<=Math.max(e,t)+i}function TM(n,e,t){t=t||(l=>n[l]<e);let i=n.length-1,r=0,a;for(;i-r>1;)a=r+i>>1,t(a)?r=a:i=a;return{lo:r,hi:i}}const Om=(n,e,t,i)=>TM(n,t,i?r=>n[r][e]<=t:r=>n[r][e]<t),g9=(n,e,t)=>TM(n,t,i=>n[i][e]>=t);function _9(n,e,t){let i=0,r=n.length;for(;i<r&&n[i]<e;)i++;for(;r>i&&n[r-1]>t;)r--;return i>0||r<n.length?n.slice(i,r):n}const JN=["push","pop","shift","splice","unshift"];function y9(n,e){if(n._chartjs){n._chartjs.listeners.push(e);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),JN.forEach(t=>{const i="_onData"+lP(t),r=n[t];Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value(...a){const l=r.apply(this,a);return n._chartjs.listeners.forEach(s=>{typeof s[i]=="function"&&s[i](...a)}),l}})})}function sR(n,e){const t=n._chartjs;if(!t)return;const i=t.listeners,r=i.indexOf(e);r!==-1&&i.splice(r,1),!(i.length>0)&&(JN.forEach(a=>{delete n[a]}),delete n._chartjs)}function KN(n){const e=new Set;let t,i;for(t=0,i=n.length;t<i;++t)e.add(n[t]);return e.size===i?n:Array.from(e)}const FS=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function QN(n,e,t){const i=t||(l=>Array.prototype.slice.call(l));let r=!1,a=[];return function(...l){a=i(l),r||(r=!0,FS.call(window,()=>{r=!1,n.apply(e,a)}))}}function x9(n,e){let t;return function(...i){return e?(clearTimeout(t),t=setTimeout(n,e,i)):n.apply(this,i),e}}const uP=n=>n==="start"?"left":n==="end"?"right":"center",ra=(n,e,t)=>n==="start"?e:n==="end"?t:(e+t)/2,v9=(n,e,t,i)=>n===(i?"left":"right")?t:n==="center"?(e+t)/2:e;function e4(n,e,t){const i=e.length;let r=0,a=i;if(n._sorted){const{iScale:l,_parsed:s}=n,d=l.axis,{min:m,max:_,minDefined:S,maxDefined:T}=l.getUserBounds();S&&(r=ca(Math.min(Om(s,l.axis,m).lo,t?i:Om(e,d,l.getPixelForValue(m)).lo),0,i-1)),T?a=ca(Math.max(Om(s,l.axis,_,!0).hi+1,t?0:Om(e,d,l.getPixelForValue(_),!0).hi+1),r,i)-r:a=i-r}return{start:r,count:a}}function t4(n){const{xScale:e,yScale:t,_scaleRanges:i}=n,r={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!i)return n._scaleRanges=r,!0;const a=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==t.min||i.ymax!==t.max;return Object.assign(i,r),a}const kw=n=>n===0||n===1,oR=(n,e,t)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-e)*Rr/t)),aR=(n,e,t)=>Math.pow(2,-10*n)*Math.sin((n-e)*Rr/t)+1,Rx={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*vs)+1,easeOutSine:n=>Math.sin(n*vs),easeInOutSine:n=>-.5*(Math.cos(Jr*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>kw(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>kw(n)?n:oR(n,.075,.3),easeOutElastic:n=>kw(n)?n:aR(n,.075,.3),easeInOutElastic(n){return kw(n)?n:n<.5?.5*oR(n*2,.1125,.45):.5+.5*aR(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let e=1.70158;return(n/=.5)<1?.5*(n*n*(((e*=1.525)+1)*n-e)):.5*((n-=2)*n*(((e*=1.525)+1)*n+e)+2)},easeInBounce:n=>1-Rx.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Rx.easeInBounce(n*2)*.5:Rx.easeOutBounce(n*2-1)*.5+.5};/*!
 * @kurkle/color v0.2.1
 * https://github.com/kurkle/color#readme
 * (c) 2022 Jukka Kurkela
 * Released under the MIT License
 */function Zv(n){return n+.5|0}const Zf=(n,e,t)=>Math.max(Math.min(n,t),e);function gx(n){return Zf(Zv(n*2.55),0,255)}function cp(n){return Zf(Zv(n*255),0,255)}function bd(n){return Zf(Zv(n/2.55)/100,0,1)}function lR(n){return Zf(Zv(n*100),0,100)}const ac={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},VA=[..."0123456789ABCDEF"],w9=n=>VA[n&15],b9=n=>VA[(n&240)>>4]+VA[n&15],Dw=n=>(n&240)>>4===(n&15),S9=n=>Dw(n.r)&&Dw(n.g)&&Dw(n.b)&&Dw(n.a);function M9(n){var e=n.length,t;return n[0]==="#"&&(e===4||e===5?t={r:255&ac[n[1]]*17,g:255&ac[n[2]]*17,b:255&ac[n[3]]*17,a:e===5?ac[n[4]]*17:255}:(e===7||e===9)&&(t={r:ac[n[1]]<<4|ac[n[2]],g:ac[n[3]]<<4|ac[n[4]],b:ac[n[5]]<<4|ac[n[6]],a:e===9?ac[n[7]]<<4|ac[n[8]]:255})),t}const T9=(n,e)=>n<255?e(n):"";function E9(n){var e=S9(n)?w9:b9;return n?"#"+e(n.r)+e(n.g)+e(n.b)+T9(n.a,e):void 0}const A9=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function n4(n,e,t){const i=e*Math.min(t,1-t),r=(a,l=(a+n/30)%12)=>t-i*Math.max(Math.min(l-3,9-l,1),-1);return[r(0),r(8),r(4)]}function C9(n,e,t){const i=(r,a=(r+n/60)%6)=>t-t*e*Math.max(Math.min(a,4-a,1),0);return[i(5),i(3),i(1)]}function I9(n,e,t){const i=n4(n,1,.5);let r;for(e+t>1&&(r=1/(e+t),e*=r,t*=r),r=0;r<3;r++)i[r]*=1-e-t,i[r]+=e;return i}function P9(n,e,t,i,r){return n===r?(e-t)/i+(e<t?6:0):e===r?(t-n)/i+2:(n-e)/i+4}function hP(n){const t=n.r/255,i=n.g/255,r=n.b/255,a=Math.max(t,i,r),l=Math.min(t,i,r),s=(a+l)/2;let d,m,_;return a!==l&&(_=a-l,m=s>.5?_/(2-a-l):_/(a+l),d=P9(t,i,r,_,a),d=d*60+.5),[d|0,m||0,s]}function dP(n,e,t,i){return(Array.isArray(e)?n(e[0],e[1],e[2]):n(e,t,i)).map(cp)}function fP(n,e,t){return dP(n4,n,e,t)}function k9(n,e,t){return dP(I9,n,e,t)}function D9(n,e,t){return dP(C9,n,e,t)}function i4(n){return(n%360+360)%360}function L9(n){const e=A9.exec(n);let t=255,i;if(!e)return;e[5]!==i&&(t=e[6]?gx(+e[5]):cp(+e[5]));const r=i4(+e[2]),a=+e[3]/100,l=+e[4]/100;return e[1]==="hwb"?i=k9(r,a,l):e[1]==="hsv"?i=D9(r,a,l):i=fP(r,a,l),{r:i[0],g:i[1],b:i[2],a:t}}function R9(n,e){var t=hP(n);t[0]=i4(t[0]+e),t=fP(t),n.r=t[0],n.g=t[1],n.b=t[2]}function z9(n){if(!n)return;const e=hP(n),t=e[0],i=lR(e[1]),r=lR(e[2]);return n.a<255?`hsla(${t}, ${i}%, ${r}%, ${bd(n.a)})`:`hsl(${t}, ${i}%, ${r}%)`}const cR={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},uR={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function O9(){const n={},e=Object.keys(uR),t=Object.keys(cR);let i,r,a,l,s;for(i=0;i<e.length;i++){for(l=s=e[i],r=0;r<t.length;r++)a=t[r],s=s.replace(a,cR[a]);a=parseInt(uR[l],16),n[s]=[a>>16&255,a>>8&255,a&255]}return n}let Lw;function F9(n){Lw||(Lw=O9(),Lw.transparent=[0,0,0,0]);const e=Lw[n.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const B9=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function N9(n){const e=B9.exec(n);let t=255,i,r,a;if(e){if(e[7]!==i){const l=+e[7];t=e[8]?gx(l):Zf(l*255,0,255)}return i=+e[1],r=+e[3],a=+e[5],i=255&(e[2]?gx(i):Zf(i,0,255)),r=255&(e[4]?gx(r):Zf(r,0,255)),a=255&(e[6]?gx(a):Zf(a,0,255)),{r:i,g:r,b:a,a:t}}}function U9(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${bd(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const A2=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,s_=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function V9(n,e,t){const i=s_(bd(n.r)),r=s_(bd(n.g)),a=s_(bd(n.b));return{r:cp(A2(i+t*(s_(bd(e.r))-i))),g:cp(A2(r+t*(s_(bd(e.g))-r))),b:cp(A2(a+t*(s_(bd(e.b))-a))),a:n.a+t*(e.a-n.a)}}function Rw(n,e,t){if(n){let i=hP(n);i[e]=Math.max(0,Math.min(i[e]+i[e]*t,e===0?360:1)),i=fP(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function r4(n,e){return n&&Object.assign(e||{},n)}function hR(n){var e={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(e={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(e.a=cp(n[3]))):(e=r4(n,{r:0,g:0,b:0,a:1}),e.a=cp(e.a)),e}function G9(n){return n.charAt(0)==="r"?N9(n):L9(n)}let W9=class GA{constructor(e){if(e instanceof GA)return e;const t=typeof e;let i;t==="object"?i=hR(e):t==="string"&&(i=M9(e)||F9(e)||G9(e)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var e=r4(this._rgb);return e&&(e.a=bd(e.a)),e}set rgb(e){this._rgb=hR(e)}rgbString(){return this._valid?U9(this._rgb):void 0}hexString(){return this._valid?E9(this._rgb):void 0}hslString(){return this._valid?z9(this._rgb):void 0}mix(e,t){if(e){const i=this.rgb,r=e.rgb;let a;const l=t===a?.5:t,s=2*l-1,d=i.a-r.a,m=((s*d===-1?s:(s+d)/(1+s*d))+1)/2;a=1-m,i.r=255&m*i.r+a*r.r+.5,i.g=255&m*i.g+a*r.g+.5,i.b=255&m*i.b+a*r.b+.5,i.a=l*i.a+(1-l)*r.a,this.rgb=i}return this}interpolate(e,t){return e&&(this._rgb=V9(this._rgb,e._rgb,t)),this}clone(){return new GA(this.rgb)}alpha(e){return this._rgb.a=cp(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=Zv(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Rw(this._rgb,2,e),this}darken(e){return Rw(this._rgb,2,-e),this}saturate(e){return Rw(this._rgb,1,e),this}desaturate(e){return Rw(this._rgb,1,-e),this}rotate(e){return R9(this._rgb,e),this}};function s4(n){return new W9(n)}function o4(n){if(n&&typeof n=="object"){const e=n.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function dR(n){return o4(n)?n:s4(n)}function C2(n){return o4(n)?n:s4(n).saturate(.5).darken(.1).hexString()}const lg=Object.create(null),WA=Object.create(null);function zx(n,e){if(!e)return n;const t=e.split(".");for(let i=0,r=t.length;i<r;++i){const a=t[i];n=n[a]||(n[a]=Object.create(null))}return n}function I2(n,e,t){return typeof e=="string"?hv(zx(n,e),t):hv(zx(n,""),e)}class H9{constructor(e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,i)=>C2(i.backgroundColor),this.hoverBorderColor=(t,i)=>C2(i.borderColor),this.hoverColor=(t,i)=>C2(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e)}set(e,t){return I2(this,e,t)}get(e){return zx(this,e)}describe(e,t){return I2(WA,e,t)}override(e,t){return I2(lg,e,t)}route(e,t,i,r){const a=zx(this,e),l=zx(this,i),s="_"+t;Object.defineProperties(a,{[s]:{value:a[t],writable:!0},[t]:{enumerable:!0,get(){const d=this[s],m=l[r];return ar(d)?Object.assign({},m,d):Mi(d,m)},set(d){this[s]=d}}})}}var Fi=new H9({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function j9(n){return!n||_r(n.size)||_r(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function BS(n,e,t,i,r){let a=e[r];return a||(a=e[r]=n.measureText(r).width,t.push(r)),a>i&&(i=a),i}function q9(n,e,t,i){i=i||{};let r=i.data=i.data||{},a=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(r=i.data={},a=i.garbageCollect=[],i.font=e),n.save(),n.font=e;let l=0;const s=t.length;let d,m,_,S,T;for(d=0;d<s;d++)if(S=t[d],S!=null&&Lr(S)!==!0)l=BS(n,r,a,l,S);else if(Lr(S))for(m=0,_=S.length;m<_;m++)T=S[m],T!=null&&!Lr(T)&&(l=BS(n,r,a,l,T));n.restore();const C=a.length/2;if(C>t.length){for(d=0;d<C;d++)delete r[a[d]];a.splice(0,C)}return l}function um(n,e,t){const i=n.currentDevicePixelRatio,r=t!==0?Math.max(t/2,.5):0;return Math.round((e-r)*i)/i+r}function fR(n,e){e=e||n.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,n.width,n.height),e.restore()}function HA(n,e,t,i){a4(n,e,t,i,null)}function a4(n,e,t,i,r){let a,l,s,d,m,_;const S=e.pointStyle,T=e.rotation,C=e.radius;let P=(T||0)*h9;if(S&&typeof S=="object"&&(a=S.toString(),a==="[object HTMLImageElement]"||a==="[object HTMLCanvasElement]")){n.save(),n.translate(t,i),n.rotate(P),n.drawImage(S,-S.width/2,-S.height/2,S.width,S.height),n.restore();return}if(!(isNaN(C)||C<=0)){switch(n.beginPath(),S){default:r?n.ellipse(t,i,r/2,C,0,0,Rr):n.arc(t,i,C,0,Rr),n.closePath();break;case"triangle":n.moveTo(t+Math.sin(P)*C,i-Math.cos(P)*C),P+=nR,n.lineTo(t+Math.sin(P)*C,i-Math.cos(P)*C),P+=nR,n.lineTo(t+Math.sin(P)*C,i-Math.cos(P)*C),n.closePath();break;case"rectRounded":m=C*.516,d=C-m,l=Math.cos(P+V0)*d,s=Math.sin(P+V0)*d,n.arc(t-l,i-s,m,P-Jr,P-vs),n.arc(t+s,i-l,m,P-vs,P),n.arc(t+l,i+s,m,P,P+vs),n.arc(t-s,i+l,m,P+vs,P+Jr),n.closePath();break;case"rect":if(!T){d=Math.SQRT1_2*C,_=r?r/2:d,n.rect(t-_,i-d,2*_,2*d);break}P+=V0;case"rectRot":l=Math.cos(P)*C,s=Math.sin(P)*C,n.moveTo(t-l,i-s),n.lineTo(t+s,i-l),n.lineTo(t+l,i+s),n.lineTo(t-s,i+l),n.closePath();break;case"crossRot":P+=V0;case"cross":l=Math.cos(P)*C,s=Math.sin(P)*C,n.moveTo(t-l,i-s),n.lineTo(t+l,i+s),n.moveTo(t+s,i-l),n.lineTo(t-s,i+l);break;case"star":l=Math.cos(P)*C,s=Math.sin(P)*C,n.moveTo(t-l,i-s),n.lineTo(t+l,i+s),n.moveTo(t+s,i-l),n.lineTo(t-s,i+l),P+=V0,l=Math.cos(P)*C,s=Math.sin(P)*C,n.moveTo(t-l,i-s),n.lineTo(t+l,i+s),n.moveTo(t+s,i-l),n.lineTo(t-s,i+l);break;case"line":l=r?r/2:Math.cos(P)*C,s=Math.sin(P)*C,n.moveTo(t-l,i-s),n.lineTo(t+l,i+s);break;case"dash":n.moveTo(t,i),n.lineTo(t+Math.cos(P)*C,i+Math.sin(P)*C);break}n.fill(),e.borderWidth>0&&n.stroke()}}function fv(n,e,t){return t=t||.5,!e||n&&n.x>e.left-t&&n.x<e.right+t&&n.y>e.top-t&&n.y<e.bottom+t}function $v(n,e){n.save(),n.beginPath(),n.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),n.clip()}function Xv(n){n.restore()}function Z9(n,e,t,i,r){if(!e)return n.lineTo(t.x,t.y);if(r==="middle"){const a=(e.x+t.x)/2;n.lineTo(a,e.y),n.lineTo(a,t.y)}else r==="after"!=!!i?n.lineTo(e.x,t.y):n.lineTo(t.x,e.y);n.lineTo(t.x,t.y)}function $9(n,e,t,i){if(!e)return n.lineTo(t.x,t.y);n.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?t.cp2x:t.cp1x,i?t.cp2y:t.cp1y,t.x,t.y)}function cg(n,e,t,i,r,a={}){const l=Lr(e)?e:[e],s=a.strokeWidth>0&&a.strokeColor!=="";let d,m;for(n.save(),n.font=r.string,X9(n,a),d=0;d<l.length;++d)m=l[d],s&&(a.strokeColor&&(n.strokeStyle=a.strokeColor),_r(a.strokeWidth)||(n.lineWidth=a.strokeWidth),n.strokeText(m,t,i,a.maxWidth)),n.fillText(m,t,i,a.maxWidth),Y9(n,t,i,m,a),i+=r.lineHeight;n.restore()}function X9(n,e){e.translation&&n.translate(e.translation[0],e.translation[1]),_r(e.rotation)||n.rotate(e.rotation),e.color&&(n.fillStyle=e.color),e.textAlign&&(n.textAlign=e.textAlign),e.textBaseline&&(n.textBaseline=e.textBaseline)}function Y9(n,e,t,i,r){if(r.strikethrough||r.underline){const a=n.measureText(i),l=e-a.actualBoundingBoxLeft,s=e+a.actualBoundingBoxRight,d=t-a.actualBoundingBoxAscent,m=t+a.actualBoundingBoxDescent,_=r.strikethrough?(d+m)/2:m;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=r.decorationWidth||2,n.moveTo(l,_),n.lineTo(s,_),n.stroke()}}function pv(n,e){const{x:t,y:i,w:r,h:a,radius:l}=e;n.arc(t+l.topLeft,i+l.topLeft,l.topLeft,-vs,Jr,!0),n.lineTo(t,i+a-l.bottomLeft),n.arc(t+l.bottomLeft,i+a-l.bottomLeft,l.bottomLeft,Jr,vs,!0),n.lineTo(t+r-l.bottomRight,i+a),n.arc(t+r-l.bottomRight,i+a-l.bottomRight,l.bottomRight,vs,0,!0),n.lineTo(t+r,i+l.topRight),n.arc(t+r-l.topRight,i+l.topRight,l.topRight,0,-vs,!0),n.lineTo(t+l.topLeft,i)}const J9=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),K9=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function Q9(n,e){const t=(""+n).match(J9);if(!t||t[1]==="normal")return e*1.2;switch(n=+t[2],t[3]){case"px":return n;case"%":n/=100;break}return e*n}const e7=n=>+n||0;function pP(n,e){const t={},i=ar(e),r=i?Object.keys(e):e,a=ar(n)?i?l=>Mi(n[l],n[e[l]]):l=>n[l]:()=>n;for(const l of r)t[l]=e7(a(l));return t}function l4(n){return pP(n,{top:"y",right:"x",bottom:"y",left:"x"})}function jm(n){return pP(n,["topLeft","topRight","bottomLeft","bottomRight"])}function pa(n){const e=l4(n);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function ro(n,e){n=n||{},e=e||Fi.font;let t=Mi(n.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let i=Mi(n.style,e.style);i&&!(""+i).match(K9)&&(console.warn('Invalid font style specified: "'+i+'"'),i="");const r={family:Mi(n.family,e.family),lineHeight:Q9(Mi(n.lineHeight,e.lineHeight),t),size:t,style:i,weight:Mi(n.weight,e.weight),string:""};return r.string=j9(r),r}function zw(n,e,t,i){let r=!0,a,l,s;for(a=0,l=n.length;a<l;++a)if(s=n[a],s!==void 0&&(e!==void 0&&typeof s=="function"&&(s=s(e),r=!1),t!==void 0&&Lr(s)&&(s=s[t%s.length],r=!1),s!==void 0))return i&&!r&&(i.cacheable=!1),s}function t7(n,e,t){const{min:i,max:r}=n,a=ZN(e,(r-i)/2),l=(s,d)=>t&&s===0?0:s+d;return{min:l(i,-Math.abs(a)),max:l(r,a)}}function Ap(n,e){return Object.assign(Object.create(n),e)}function mP(n,e=[""],t=n,i,r=()=>n[0]){Cc(i)||(i=d4("_fallback",n));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:t,_fallback:i,_getTarget:r,override:l=>mP([l,...n],e,t,i)};return new Proxy(a,{deleteProperty(l,s){return delete l[s],delete l._keys,delete n[0][s],!0},get(l,s){return u4(l,s,()=>c7(s,e,n,l))},getOwnPropertyDescriptor(l,s){return Reflect.getOwnPropertyDescriptor(l._scopes[0],s)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(l,s){return mR(l).includes(s)},ownKeys(l){return mR(l)},set(l,s,d){const m=l._storage||(l._storage=r());return l[s]=m[s]=d,delete l._keys,!0}})}function my(n,e,t,i){const r={_cacheable:!1,_proxy:n,_context:e,_subProxy:t,_stack:new Set,_descriptors:c4(n,i),setContext:a=>my(n,a,t,i),override:a=>my(n.override(a),e,t,i)};return new Proxy(r,{deleteProperty(a,l){return delete a[l],delete n[l],!0},get(a,l,s){return u4(a,l,()=>i7(a,l,s))},getOwnPropertyDescriptor(a,l){return a._descriptors.allKeys?Reflect.has(n,l)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,l)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(a,l){return Reflect.has(n,l)},ownKeys(){return Reflect.ownKeys(n)},set(a,l,s){return n[l]=s,delete a[l],!0}})}function c4(n,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:i=e.indexable,_allKeys:r=e.allKeys}=n;return{allKeys:r,scriptable:t,indexable:i,isScriptable:_p(t)?t:()=>t,isIndexable:_p(i)?i:()=>i}}const n7=(n,e)=>n?n+lP(e):e,gP=(n,e)=>ar(e)&&n!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function u4(n,e,t){if(Object.prototype.hasOwnProperty.call(n,e))return n[e];const i=t();return n[e]=i,i}function i7(n,e,t){const{_proxy:i,_context:r,_subProxy:a,_descriptors:l}=n;let s=i[e];return _p(s)&&l.isScriptable(e)&&(s=r7(e,s,n,t)),Lr(s)&&s.length&&(s=s7(e,s,n,l.isIndexable)),gP(e,s)&&(s=my(s,r,a&&a[e],l)),s}function r7(n,e,t,i){const{_proxy:r,_context:a,_subProxy:l,_stack:s}=t;if(s.has(n))throw new Error("Recursion detected: "+Array.from(s).join("->")+"->"+n);return s.add(n),e=e(a,l||i),s.delete(n),gP(n,e)&&(e=_P(r._scopes,r,n,e)),e}function s7(n,e,t,i){const{_proxy:r,_context:a,_subProxy:l,_descriptors:s}=t;if(Cc(a.index)&&i(n))e=e[a.index%e.length];else if(ar(e[0])){const d=e,m=r._scopes.filter(_=>_!==d);e=[];for(const _ of d){const S=_P(m,r,n,_);e.push(my(S,a,l&&l[n],s))}}return e}function h4(n,e,t){return _p(n)?n(e,t):n}const o7=(n,e)=>n===!0?e:typeof n=="string"?gp(e,n):void 0;function a7(n,e,t,i,r){for(const a of e){const l=o7(t,a);if(l){n.add(l);const s=h4(l._fallback,t,r);if(Cc(s)&&s!==t&&s!==i)return s}else if(l===!1&&Cc(i)&&t!==i)return null}return!1}function _P(n,e,t,i){const r=e._rootScopes,a=h4(e._fallback,t,i),l=[...n,...r],s=new Set;s.add(i);let d=pR(s,l,t,a||t,i);return d===null||Cc(a)&&a!==t&&(d=pR(s,l,a,d,i),d===null)?!1:mP(Array.from(s),[""],r,a,()=>l7(e,t,i))}function pR(n,e,t,i,r){for(;t;)t=a7(n,e,t,i,r);return t}function l7(n,e,t){const i=n._getTarget();e in i||(i[e]={});const r=i[e];return Lr(r)&&ar(t)?t:r}function c7(n,e,t,i){let r;for(const a of e)if(r=d4(n7(a,n),t),Cc(r))return gP(n,r)?_P(t,i,n,r):r}function d4(n,e){for(const t of e){if(!t)continue;const i=t[n];if(Cc(i))return i}}function mR(n){let e=n._keys;return e||(e=n._keys=u7(n._scopes)),e}function u7(n){const e=new Set;for(const t of n)for(const i of Object.keys(t).filter(r=>!r.startsWith("_")))e.add(i);return Array.from(e)}function f4(n,e,t,i){const{iScale:r}=n,{key:a="r"}=this._parsing,l=new Array(i);let s,d,m,_;for(s=0,d=i;s<d;++s)m=s+t,_=e[m],l[s]={r:r.parse(gp(_,a),m)};return l}const h7=Number.EPSILON||1e-14,gy=(n,e)=>e<n.length&&!n[e].skip&&n[e],p4=n=>n==="x"?"y":"x";function d7(n,e,t,i){const r=n.skip?e:n,a=e,l=t.skip?e:t,s=UA(a,r),d=UA(l,a);let m=s/(s+d),_=d/(s+d);m=isNaN(m)?0:m,_=isNaN(_)?0:_;const S=i*m,T=i*_;return{previous:{x:a.x-S*(l.x-r.x),y:a.y-S*(l.y-r.y)},next:{x:a.x+T*(l.x-r.x),y:a.y+T*(l.y-r.y)}}}function f7(n,e,t){const i=n.length;let r,a,l,s,d,m=gy(n,0);for(let _=0;_<i-1;++_)if(d=m,m=gy(n,_+1),!(!d||!m)){if(Lx(e[_],0,h7)){t[_]=t[_+1]=0;continue}r=t[_]/e[_],a=t[_+1]/e[_],s=Math.pow(r,2)+Math.pow(a,2),!(s<=9)&&(l=3/Math.sqrt(s),t[_]=r*l*e[_],t[_+1]=a*l*e[_])}}function p7(n,e,t="x"){const i=p4(t),r=n.length;let a,l,s,d=gy(n,0);for(let m=0;m<r;++m){if(l=s,s=d,d=gy(n,m+1),!s)continue;const _=s[t],S=s[i];l&&(a=(_-l[t])/3,s[`cp1${t}`]=_-a,s[`cp1${i}`]=S-a*e[m]),d&&(a=(d[t]-_)/3,s[`cp2${t}`]=_+a,s[`cp2${i}`]=S+a*e[m])}}function m7(n,e="x"){const t=p4(e),i=n.length,r=Array(i).fill(0),a=Array(i);let l,s,d,m=gy(n,0);for(l=0;l<i;++l)if(s=d,d=m,m=gy(n,l+1),!!d){if(m){const _=m[e]-d[e];r[l]=_!==0?(m[t]-d[t])/_:0}a[l]=s?m?xh(r[l-1])!==xh(r[l])?0:(r[l-1]+r[l])/2:r[l-1]:r[l]}f7(n,r,a),p7(n,a,e)}function Ow(n,e,t){return Math.max(Math.min(n,t),e)}function g7(n,e){let t,i,r,a,l,s=fv(n[0],e);for(t=0,i=n.length;t<i;++t)l=a,a=s,s=t<i-1&&fv(n[t+1],e),a&&(r=n[t],l&&(r.cp1x=Ow(r.cp1x,e.left,e.right),r.cp1y=Ow(r.cp1y,e.top,e.bottom)),s&&(r.cp2x=Ow(r.cp2x,e.left,e.right),r.cp2y=Ow(r.cp2y,e.top,e.bottom)))}function _7(n,e,t,i,r){let a,l,s,d;if(e.spanGaps&&(n=n.filter(m=>!m.skip)),e.cubicInterpolationMode==="monotone")m7(n,r);else{let m=i?n[n.length-1]:n[0];for(a=0,l=n.length;a<l;++a)s=n[a],d=d7(m,s,n[Math.min(a+1,l-(i?0:1))%l],e.tension),s.cp1x=d.previous.x,s.cp1y=d.previous.y,s.cp2x=d.next.x,s.cp2y=d.next.y,m=s}e.capBezierPoints&&g7(n,t)}function m4(){return typeof window<"u"&&typeof document<"u"}function yP(n){let e=n.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function NS(n,e,t){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*e.parentNode[t])):i=n,i}const EM=n=>window.getComputedStyle(n,null);function y7(n,e){return EM(n).getPropertyValue(e)}const x7=["top","right","bottom","left"];function qm(n,e,t){const i={};t=t?"-"+t:"";for(let r=0;r<4;r++){const a=x7[r];i[a]=parseFloat(n[e+"-"+a+t])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const v7=(n,e,t)=>(n>0||e>0)&&(!t||!t.shadowRoot);function w7(n,e){const t=n.touches,i=t&&t.length?t[0]:n,{offsetX:r,offsetY:a}=i;let l=!1,s,d;if(v7(r,a,n.target))s=r,d=a;else{const m=e.getBoundingClientRect();s=i.clientX-m.left,d=i.clientY-m.top,l=!0}return{x:s,y:d,box:l}}function Bf(n,e){if("native"in n)return n;const{canvas:t,currentDevicePixelRatio:i}=e,r=EM(t),a=r.boxSizing==="border-box",l=qm(r,"padding"),s=qm(r,"border","width"),{x:d,y:m,box:_}=w7(n,t),S=l.left+(_&&s.left),T=l.top+(_&&s.top);let{width:C,height:P}=e;return a&&(C-=l.width+s.width,P-=l.height+s.height),{x:Math.round((d-S)/C*t.width/i),y:Math.round((m-T)/P*t.height/i)}}function b7(n,e,t){let i,r;if(e===void 0||t===void 0){const a=yP(n);if(!a)e=n.clientWidth,t=n.clientHeight;else{const l=a.getBoundingClientRect(),s=EM(a),d=qm(s,"border","width"),m=qm(s,"padding");e=l.width-m.width-d.width,t=l.height-m.height-d.height,i=NS(s.maxWidth,a,"clientWidth"),r=NS(s.maxHeight,a,"clientHeight")}}return{width:e,height:t,maxWidth:i||OS,maxHeight:r||OS}}const P2=n=>Math.round(n*10)/10;function S7(n,e,t,i){const r=EM(n),a=qm(r,"margin"),l=NS(r.maxWidth,n,"clientWidth")||OS,s=NS(r.maxHeight,n,"clientHeight")||OS,d=b7(n,e,t);let{width:m,height:_}=d;if(r.boxSizing==="content-box"){const S=qm(r,"border","width"),T=qm(r,"padding");m-=T.width+S.width,_-=T.height+S.height}return m=Math.max(0,m-a.width),_=Math.max(0,i?Math.floor(m/i):_-a.height),m=P2(Math.min(m,l,d.maxWidth)),_=P2(Math.min(_,s,d.maxHeight)),m&&!_&&(_=P2(m/2)),{width:m,height:_}}function gR(n,e,t){const i=e||1,r=Math.floor(n.height*i),a=Math.floor(n.width*i);n.height=r/i,n.width=a/i;const l=n.canvas;return l.style&&(t||!l.style.height&&!l.style.width)&&(l.style.height=`${n.height}px`,l.style.width=`${n.width}px`),n.currentDevicePixelRatio!==i||l.height!==r||l.width!==a?(n.currentDevicePixelRatio=i,l.height=r,l.width=a,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const M7=function(){let n=!1;try{const e={get passive(){return n=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch{}return n}();function _R(n,e){const t=y7(n,e),i=t&&t.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Tm(n,e,t,i){return{x:n.x+t*(e.x-n.x),y:n.y+t*(e.y-n.y)}}function T7(n,e,t,i){return{x:n.x+t*(e.x-n.x),y:i==="middle"?t<.5?n.y:e.y:i==="after"?t<1?n.y:e.y:t>0?e.y:n.y}}function E7(n,e,t,i){const r={x:n.cp2x,y:n.cp2y},a={x:e.cp1x,y:e.cp1y},l=Tm(n,r,t),s=Tm(r,a,t),d=Tm(a,e,t),m=Tm(l,s,t),_=Tm(s,d,t);return Tm(m,_,t)}const yR=new Map;function A7(n,e){e=e||{};const t=n+JSON.stringify(e);let i=yR.get(t);return i||(i=new Intl.NumberFormat(n,e),yR.set(t,i)),i}function Yv(n,e,t){return A7(e,t).format(n)}const C7=function(n,e){return{x(t){return n+n+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,i){return t-i},leftForLtr(t,i){return t-i}}},I7=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,e){return n+e},leftForLtr(n,e){return n}}};function ey(n,e,t){return n?C7(e,t):I7()}function g4(n,e){let t,i;(e==="ltr"||e==="rtl")&&(t=n.canvas.style,i=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),n.prevTextDirection=i)}function _4(n,e){e!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",e[0],e[1]))}function y4(n){return n==="angle"?{between:dv,compare:p9,normalize:_u}:{between:qf,compare:(e,t)=>e-t,normalize:e=>e}}function xR({start:n,end:e,count:t,loop:i,style:r}){return{start:n%t,end:e%t,loop:i&&(e-n+1)%t===0,style:r}}function P7(n,e,t){const{property:i,start:r,end:a}=t,{between:l,normalize:s}=y4(i),d=e.length;let{start:m,end:_,loop:S}=n,T,C;if(S){for(m+=d,_+=d,T=0,C=d;T<C&&l(s(e[m%d][i]),r,a);++T)m--,_--;m%=d,_%=d}return _<m&&(_+=d),{start:m,end:_,loop:S,style:n.style}}function k7(n,e,t){if(!t)return[n];const{property:i,start:r,end:a}=t,l=e.length,{compare:s,between:d,normalize:m}=y4(i),{start:_,end:S,loop:T,style:C}=P7(n,e,t),P=[];let k=!1,R=null,O,F,N;const G=()=>d(r,N,O)&&s(r,N)!==0,j=()=>s(a,O)===0||d(a,N,O),Q=()=>k||G(),re=()=>!k||j();for(let $=_,ne=_;$<=S;++$)F=e[$%l],!F.skip&&(O=m(F[i]),O!==N&&(k=d(O,r,a),R===null&&Q()&&(R=s(O,r)===0?$:ne),R!==null&&re()&&(P.push(xR({start:R,end:$,loop:T,count:l,style:C})),R=null),ne=$,N=O));return R!==null&&P.push(xR({start:R,end:S,loop:T,count:l,style:C})),P}function D7(n,e){const t=[],i=n.segments;for(let r=0;r<i.length;r++){const a=k7(i[r],n.points,e);a.length&&t.push(...a)}return t}function L7(n,e,t,i){let r=0,a=e-1;if(t&&!i)for(;r<e&&!n[r].skip;)r++;for(;r<e&&n[r].skip;)r++;for(r%=e,t&&(a+=r);a>r&&n[a%e].skip;)a--;return a%=e,{start:r,end:a}}function R7(n,e,t,i){const r=n.length,a=[];let l=e,s=n[e],d;for(d=e+1;d<=t;++d){const m=n[d%r];m.skip||m.stop?s.skip||(i=!1,a.push({start:e%r,end:(d-1)%r,loop:i}),e=l=m.stop?d:null):(l=d,s.skip&&(e=d)),s=m}return l!==null&&a.push({start:e%r,end:l%r,loop:i}),a}function z7(n,e){const t=n.points,i=n.options.spanGaps,r=t.length;if(!r)return[];const a=!!n._loop,{start:l,end:s}=L7(t,r,a,i);if(i===!0)return vR(n,[{start:l,end:s,loop:a}],t,e);const d=s<l?s+r:s,m=!!n._fullLoop&&l===0&&s===r-1;return vR(n,R7(t,l,d,m),t,e)}function vR(n,e,t,i){return!i||!i.setContext||!t?e:O7(n,e,t,i)}function O7(n,e,t,i){const r=n._chart.getContext(),a=wR(n.options),{_datasetIndex:l,options:{spanGaps:s}}=n,d=t.length,m=[];let _=a,S=e[0].start,T=S;function C(P,k,R,O){const F=s?-1:1;if(P!==k){for(P+=d;t[P%d].skip;)P-=F;for(;t[k%d].skip;)k+=F;P%d!==k%d&&(m.push({start:P%d,end:k%d,loop:R,style:O}),_=O,S=k%d)}}for(const P of e){S=s?S:P.start;let k=t[S%d],R;for(T=S+1;T<=P.end;T++){const O=t[T%d];R=wR(i.setContext(Ap(r,{type:"segment",p0:k,p1:O,p0DataIndex:(T-1)%d,p1DataIndex:T%d,datasetIndex:l}))),F7(R,_)&&C(S,T-1,P.loop,_),k=O,_=R}S<T-1&&C(S,T-1,P.loop,_)}return m}function wR(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function F7(n,e){return e&&JSON.stringify(n)!==JSON.stringify(e)}/*!
 * Chart.js v3.9.1
 * https://www.chartjs.org
 * (c) 2022 Chart.js Contributors
 * Released under the MIT License
 */class B7{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,i,r){const a=t.listeners[r],l=t.duration;a.forEach(s=>s({chart:e,initial:t.initial,numSteps:l,currentStep:Math.min(i-t.start,l)}))}_refresh(){this._request||(this._running=!0,this._request=FS.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((i,r)=>{if(!i.running||!i.items.length)return;const a=i.items;let l=a.length-1,s=!1,d;for(;l>=0;--l)d=a[l],d._active?(d._total>i.duration&&(i.duration=d._total),d.tick(e),s=!0):(a[l]=a[a.length-1],a.pop());s&&(r.draw(),this._notify(r,i,e,"progress")),a.length||(i.running=!1,this._notify(r,i,e,"complete"),i.initial=!1),t+=a.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let i=t.get(e);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,i)),i}listen(e,t,i){this._getAnims(e).listeners[t].push(i)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((i,r)=>Math.max(i,r._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const i=t.items;let r=i.length-1;for(;r>=0;--r)i[r].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var _d=new B7;const bR="transparent",N7={boolean(n,e,t){return t>.5?e:n},color(n,e,t){const i=dR(n||bR),r=i.valid&&dR(e||bR);return r&&r.valid?r.mix(i,t).hexString():e},number(n,e,t){return n+(e-n)*t}};let U7=class{constructor(e,t,i,r){const a=t[i];r=zw([e.to,r,a,e.from]);const l=zw([e.from,a,r]);this._active=!0,this._fn=e.fn||N7[e.type||typeof l],this._easing=Rx[e.easing]||Rx.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=i,this._from=l,this._to=r,this._promises=void 0}active(){return this._active}update(e,t,i){if(this._active){this._notify(!1);const r=this._target[this._prop],a=i-this._start,l=this._duration-a;this._start=i,this._duration=Math.floor(Math.max(l,e.duration)),this._total+=a,this._loop=!!e.loop,this._to=zw([e.to,t,r,e.from]),this._from=zw([e.from,r,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,i=this._duration,r=this._prop,a=this._from,l=this._loop,s=this._to;let d;if(this._active=a!==s&&(l||t<i),!this._active){this._target[r]=s,this._notify(!0);return}if(t<0){this._target[r]=a;return}d=t/i%2,d=l&&d>1?2-d:d,d=this._easing(Math.min(1,Math.max(0,d))),this._target[r]=this._fn(a,s,d)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,i)=>{e.push({res:t,rej:i})})}_notify(e){const t=e?"res":"rej",i=this._promises||[];for(let r=0;r<i.length;r++)i[r][t]()}};const V7=["x","y","borderWidth","radius","tension"],G7=["color","borderColor","backgroundColor"];Fi.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const W7=Object.keys(Fi.animation);Fi.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:n=>n!=="onProgress"&&n!=="onComplete"&&n!=="fn"});Fi.set("animations",{colors:{type:"color",properties:G7},numbers:{type:"number",properties:V7}});Fi.describe("animations",{_fallback:"animation"});Fi.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:n=>n|0}}}});class x4{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!ar(e))return;const t=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const r=e[i];if(!ar(r))return;const a={};for(const l of W7)a[l]=r[l];(Lr(r.properties)&&r.properties||[i]).forEach(l=>{(l===i||!t.has(l))&&t.set(l,a)})})}_animateOptions(e,t){const i=t.options,r=j7(e,i);if(!r)return[];const a=this._createAnimations(r,i);return i.$shared&&H7(e.options.$animations,i).then(()=>{e.options=i},()=>{}),a}_createAnimations(e,t){const i=this._properties,r=[],a=e.$animations||(e.$animations={}),l=Object.keys(t),s=Date.now();let d;for(d=l.length-1;d>=0;--d){const m=l[d];if(m.charAt(0)==="$")continue;if(m==="options"){r.push(...this._animateOptions(e,t));continue}const _=t[m];let S=a[m];const T=i.get(m);if(S)if(T&&S.active()){S.update(T,_,s);continue}else S.cancel();if(!T||!T.duration){e[m]=_;continue}a[m]=S=new U7(T,e,m,_),r.push(S)}return r}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const i=this._createAnimations(e,t);if(i.length)return _d.add(this._chart,i),!0}}function H7(n,e){const t=[],i=Object.keys(e);for(let r=0;r<i.length;r++){const a=n[i[r]];a&&a.active()&&t.push(a.wait())}return Promise.all(t)}function j7(n,e){if(!e)return;let t=n.options;if(!t){n.options=e;return}return t.$shared&&(n.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function SR(n,e){const t=n&&n.options||{},i=t.reverse,r=t.min===void 0?e:0,a=t.max===void 0?e:0;return{start:i?a:r,end:i?r:a}}function q7(n,e,t){if(t===!1)return!1;const i=SR(n,t),r=SR(e,t);return{top:r.end,right:i.end,bottom:r.start,left:i.start}}function Z7(n){let e,t,i,r;return ar(n)?(e=n.top,t=n.right,i=n.bottom,r=n.left):e=t=i=r=n,{top:e,right:t,bottom:i,left:r,disabled:n===!1}}function v4(n,e){const t=[],i=n._getSortedDatasetMetas(e);let r,a;for(r=0,a=i.length;r<a;++r)t.push(i[r].index);return t}function MR(n,e,t,i={}){const r=n.keys,a=i.mode==="single";let l,s,d,m;if(e!==null){for(l=0,s=r.length;l<s;++l){if(d=+r[l],d===t){if(i.all)continue;break}m=n.values[d],so(m)&&(a||e===0||xh(e)===xh(m))&&(e+=m)}return e}}function $7(n){const e=Object.keys(n),t=new Array(e.length);let i,r,a;for(i=0,r=e.length;i<r;++i)a=e[i],t[i]={x:a,y:n[a]};return t}function TR(n,e){const t=n&&n.options.stacked;return t||t===void 0&&e.stack!==void 0}function X7(n,e,t){return`${n.id}.${e.id}.${t.stack||t.type}`}function Y7(n){const{min:e,max:t,minDefined:i,maxDefined:r}=n.getUserBounds();return{min:i?e:Number.NEGATIVE_INFINITY,max:r?t:Number.POSITIVE_INFINITY}}function J7(n,e,t){const i=n[e]||(n[e]={});return i[t]||(i[t]={})}function ER(n,e,t,i){for(const r of e.getMatchingVisibleMetas(i).reverse()){const a=n[r.index];if(t&&a>0||!t&&a<0)return r.index}return null}function AR(n,e){const{chart:t,_cachedMeta:i}=n,r=t._stacks||(t._stacks={}),{iScale:a,vScale:l,index:s}=i,d=a.axis,m=l.axis,_=X7(a,l,i),S=e.length;let T;for(let C=0;C<S;++C){const P=e[C],{[d]:k,[m]:R}=P,O=P._stacks||(P._stacks={});T=O[m]=J7(r,_,k),T[s]=R,T._top=ER(T,l,!0,i.type),T._bottom=ER(T,l,!1,i.type)}}function k2(n,e){const t=n.scales;return Object.keys(t).filter(i=>t[i].axis===e).shift()}function K7(n,e){return Ap(n,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function Q7(n,e,t){return Ap(n,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function G0(n,e){const t=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){e=e||n._parsed;for(const r of e){const a=r._stacks;if(!a||a[i]===void 0||a[i][t]===void 0)return;delete a[i][t]}}}const D2=n=>n==="reset"||n==="none",CR=(n,e)=>e?n:Object.assign({},n),eq=(n,e,t)=>n&&!e.hidden&&e._stacked&&{keys:v4(t,!0),values:null};class Pc{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=TR(e.vScale,e),this.addElements()}updateIndex(e){this.index!==e&&G0(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,i=this.getDataset(),r=(S,T,C,P)=>S==="x"?T:S==="r"?P:C,a=t.xAxisID=Mi(i.xAxisID,k2(e,"x")),l=t.yAxisID=Mi(i.yAxisID,k2(e,"y")),s=t.rAxisID=Mi(i.rAxisID,k2(e,"r")),d=t.indexAxis,m=t.iAxisID=r(d,a,l,s),_=t.vAxisID=r(d,l,a,s);t.xScale=this.getScaleForId(a),t.yScale=this.getScaleForId(l),t.rScale=this.getScaleForId(s),t.iScale=this.getScaleForId(m),t.vScale=this.getScaleForId(_)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&sR(this._data,this),e._stacked&&G0(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),i=this._data;if(ar(t))this._data=$7(t);else if(i!==t){if(i){sR(i,this);const r=this._cachedMeta;G0(r),r._parsed=[]}t&&Object.isExtensible(t)&&y9(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,i=this.getDataset();let r=!1;this._dataCheck();const a=t._stacked;t._stacked=TR(t.vScale,t),t.stack!==i.stack&&(r=!0,G0(t),t.stack=i.stack),this._resyncElements(e),(r||a!==t._stacked)&&AR(this,t._parsed)}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),i=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:i,_data:r}=this,{iScale:a,_stacked:l}=i,s=a.axis;let d=e===0&&t===r.length?!0:i._sorted,m=e>0&&i._parsed[e-1],_,S,T;if(this._parsing===!1)i._parsed=r,i._sorted=!0,T=r;else{Lr(r[e])?T=this.parseArrayData(i,r,e,t):ar(r[e])?T=this.parseObjectData(i,r,e,t):T=this.parsePrimitiveData(i,r,e,t);const C=()=>S[s]===null||m&&S[s]<m[s];for(_=0;_<t;++_)i._parsed[_+e]=S=T[_],d&&(C()&&(d=!1),m=S);i._sorted=d}l&&AR(this,T)}parsePrimitiveData(e,t,i,r){const{iScale:a,vScale:l}=e,s=a.axis,d=l.axis,m=a.getLabels(),_=a===l,S=new Array(r);let T,C,P;for(T=0,C=r;T<C;++T)P=T+i,S[T]={[s]:_||a.parse(m[P],P),[d]:l.parse(t[P],P)};return S}parseArrayData(e,t,i,r){const{xScale:a,yScale:l}=e,s=new Array(r);let d,m,_,S;for(d=0,m=r;d<m;++d)_=d+i,S=t[_],s[d]={x:a.parse(S[0],_),y:l.parse(S[1],_)};return s}parseObjectData(e,t,i,r){const{xScale:a,yScale:l}=e,{xAxisKey:s="x",yAxisKey:d="y"}=this._parsing,m=new Array(r);let _,S,T,C;for(_=0,S=r;_<S;++_)T=_+i,C=t[T],m[_]={x:a.parse(gp(C,s),T),y:l.parse(gp(C,d),T)};return m}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,i){const r=this.chart,a=this._cachedMeta,l=t[e.axis],s={keys:v4(r,!0),values:t._stacks[e.axis]};return MR(s,l,a.index,{mode:i})}updateRangeFromParsed(e,t,i,r){const a=i[t.axis];let l=a===null?NaN:a;const s=r&&i._stacks[t.axis];r&&s&&(r.values=s,l=MR(r,a,this._cachedMeta.index)),e.min=Math.min(e.min,l),e.max=Math.max(e.max,l)}getMinMax(e,t){const i=this._cachedMeta,r=i._parsed,a=i._sorted&&e===i.iScale,l=r.length,s=this._getOtherScale(e),d=eq(t,i,this.chart),m={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:_,max:S}=Y7(s);let T,C;function P(){C=r[T];const k=C[s.axis];return!so(C[e.axis])||_>k||S<k}for(T=0;T<l&&!(!P()&&(this.updateRangeFromParsed(m,e,C,d),a));++T);if(a){for(T=l-1;T>=0;--T)if(!P()){this.updateRangeFromParsed(m,e,C,d);break}}return m}getAllParsedValues(e){const t=this._cachedMeta._parsed,i=[];let r,a,l;for(r=0,a=t.length;r<a;++r)l=t[r][e.axis],so(l)&&i.push(l);return i}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,i=t.iScale,r=t.vScale,a=this.getParsed(e);return{label:i?""+i.getLabelForValue(a[i.axis]):"",value:r?""+r.getLabelForValue(a[r.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=Z7(Mi(this.options.clip,q7(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,i=this._cachedMeta,r=i.data||[],a=t.chartArea,l=[],s=this._drawStart||0,d=this._drawCount||r.length-s,m=this.options.drawActiveElementsOnTop;let _;for(i.dataset&&i.dataset.draw(e,a,s,d),_=s;_<s+d;++_){const S=r[_];S.hidden||(S.active&&m?l.push(S):S.draw(e,a))}for(_=0;_<l.length;++_)l[_].draw(e,a)}getStyle(e,t){const i=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(e||0,i)}getContext(e,t,i){const r=this.getDataset();let a;if(e>=0&&e<this._cachedMeta.data.length){const l=this._cachedMeta.data[e];a=l.$context||(l.$context=Q7(this.getContext(),e,l)),a.parsed=this.getParsed(e),a.raw=r.data[e],a.index=a.dataIndex=e}else a=this.$context||(this.$context=K7(this.chart.getContext(),this.index)),a.dataset=r,a.index=a.datasetIndex=this.index;return a.active=!!t,a.mode=i,a}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",i){const r=t==="active",a=this._cachedDataOpts,l=e+"-"+t,s=a[l],d=this.enableOptionSharing&&Cc(i);if(s)return CR(s,d);const m=this.chart.config,_=m.datasetElementScopeKeys(this._type,e),S=r?[`${e}Hover`,"hover",e,""]:[e,""],T=m.getOptionScopes(this.getDataset(),_),C=Object.keys(Fi.elements[e]),P=()=>this.getContext(i,r),k=m.resolveNamedOptions(T,C,P,S);return k.$shared&&(k.$shared=d,a[l]=Object.freeze(CR(k,d))),k}_resolveAnimations(e,t,i){const r=this.chart,a=this._cachedDataOpts,l=`animation-${t}`,s=a[l];if(s)return s;let d;if(r.options.animation!==!1){const _=this.chart.config,S=_.datasetAnimationScopeKeys(this._type,t),T=_.getOptionScopes(this.getDataset(),S);d=_.createResolver(T,this.getContext(e,i,t))}const m=new x4(r,d&&d.animations);return d&&d._cacheable&&(a[l]=Object.freeze(m)),m}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||D2(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const i=this.resolveDataElementOptions(e,t),r=this._sharedOptions,a=this.getSharedOptions(i),l=this.includeOptions(t,a)||a!==r;return this.updateSharedOptions(a,t,i),{sharedOptions:a,includeOptions:l}}updateElement(e,t,i,r){D2(r)?Object.assign(e,i):this._resolveAnimations(t,r).update(e,i)}updateSharedOptions(e,t,i){e&&!D2(t)&&this._resolveAnimations(void 0,t).update(e,i)}_setStyle(e,t,i,r){e.active=r;const a=this.getStyle(t,r);this._resolveAnimations(t,i,r).update(e,{options:!r&&this.getSharedOptions(a)||a})}removeHoverStyle(e,t,i){this._setStyle(e,i,"active",!1)}setHoverStyle(e,t,i){this._setStyle(e,i,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,i=this._cachedMeta.data;for(const[s,d,m]of this._syncList)this[s](d,m);this._syncList=[];const r=i.length,a=t.length,l=Math.min(a,r);l&&this.parse(0,l),a>r?this._insertElements(r,a-r,e):a<r&&this._removeElements(a,r-a)}_insertElements(e,t,i=!0){const r=this._cachedMeta,a=r.data,l=e+t;let s;const d=m=>{for(m.length+=t,s=m.length-1;s>=l;s--)m[s]=m[s-t]};for(d(a),s=e;s<l;++s)a[s]=new this.dataElementType;this._parsing&&d(r._parsed),this.parse(e,t),i&&this.updateElements(a,e,t,"reset")}updateElements(e,t,i,r){}_removeElements(e,t){const i=this._cachedMeta;if(this._parsing){const r=i._parsed.splice(e,t);i._stacked&&G0(i,r)}i.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,i,r]=e;this[t](i,r)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const i=arguments.length-2;i&&this._sync(["_insertElements",e,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Pc.defaults={};Pc.prototype.datasetElementType=null;Pc.prototype.dataElementType=null;function tq(n,e){if(!n._cache.$bar){const t=n.getMatchingVisibleMetas(e);let i=[];for(let r=0,a=t.length;r<a;r++)i=i.concat(t[r].controller.getAllParsedValues(n));n._cache.$bar=KN(i.sort((r,a)=>r-a))}return n._cache.$bar}function nq(n){const e=n.iScale,t=tq(e,n.type);let i=e._length,r,a,l,s;const d=()=>{l===32767||l===-32768||(Cc(s)&&(i=Math.min(i,Math.abs(l-s)||i)),s=l)};for(r=0,a=t.length;r<a;++r)l=e.getPixelForValue(t[r]),d();for(s=void 0,r=0,a=e.ticks.length;r<a;++r)l=e.getPixelForTick(r),d();return i}function iq(n,e,t,i){const r=t.barThickness;let a,l;return _r(r)?(a=e.min*t.categoryPercentage,l=t.barPercentage):(a=r*i,l=1),{chunk:a/i,ratio:l,start:e.pixels[n]-a/2}}function rq(n,e,t,i){const r=e.pixels,a=r[n];let l=n>0?r[n-1]:null,s=n<r.length-1?r[n+1]:null;const d=t.categoryPercentage;l===null&&(l=a-(s===null?e.end-e.start:s-a)),s===null&&(s=a+a-l);const m=a-(a-Math.min(l,s))/2*d;return{chunk:Math.abs(s-l)/2*d/i,ratio:t.barPercentage,start:m}}function sq(n,e,t,i){const r=t.parse(n[0],i),a=t.parse(n[1],i),l=Math.min(r,a),s=Math.max(r,a);let d=l,m=s;Math.abs(l)>Math.abs(s)&&(d=s,m=l),e[t.axis]=m,e._custom={barStart:d,barEnd:m,start:r,end:a,min:l,max:s}}function w4(n,e,t,i){return Lr(n)?sq(n,e,t,i):e[t.axis]=t.parse(n,i),e}function IR(n,e,t,i){const r=n.iScale,a=n.vScale,l=r.getLabels(),s=r===a,d=[];let m,_,S,T;for(m=t,_=t+i;m<_;++m)T=e[m],S={},S[r.axis]=s||r.parse(l[m],m),d.push(w4(T,S,a,m));return d}function L2(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function oq(n,e,t){return n!==0?xh(n):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function aq(n){let e,t,i,r,a;return n.horizontal?(e=n.base>n.x,t="left",i="right"):(e=n.base<n.y,t="bottom",i="top"),e?(r="end",a="start"):(r="start",a="end"),{start:t,end:i,reverse:e,top:r,bottom:a}}function lq(n,e,t,i){let r=e.borderSkipped;const a={};if(!r){n.borderSkipped=a;return}if(r===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:l,end:s,reverse:d,top:m,bottom:_}=aq(n);r==="middle"&&t&&(n.enableBorderRadius=!0,(t._top||0)===i?r=m:(t._bottom||0)===i?r=_:(a[PR(_,l,s,d)]=!0,r=m)),a[PR(r,l,s,d)]=!0,n.borderSkipped=a}function PR(n,e,t,i){return i?(n=cq(n,e,t),n=kR(n,t,e)):n=kR(n,e,t),n}function cq(n,e,t){return n===e?t:n===t?e:n}function kR(n,e,t){return n==="start"?e:n==="end"?t:n}function uq(n,{inflateAmount:e},t){n.inflateAmount=e==="auto"?t===1?.33:0:e}class xP extends Pc{parsePrimitiveData(e,t,i,r){return IR(e,t,i,r)}parseArrayData(e,t,i,r){return IR(e,t,i,r)}parseObjectData(e,t,i,r){const{iScale:a,vScale:l}=e,{xAxisKey:s="x",yAxisKey:d="y"}=this._parsing,m=a.axis==="x"?s:d,_=l.axis==="x"?s:d,S=[];let T,C,P,k;for(T=i,C=i+r;T<C;++T)k=t[T],P={},P[a.axis]=a.parse(gp(k,m),T),S.push(w4(gp(k,_),P,l,T));return S}updateRangeFromParsed(e,t,i,r){super.updateRangeFromParsed(e,t,i,r);const a=i._custom;a&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,a.min),e.max=Math.max(e.max,a.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:i,vScale:r}=t,a=this.getParsed(e),l=a._custom,s=L2(l)?"["+l.start+", "+l.end+"]":""+r.getLabelForValue(a[r.axis]);return{label:""+i.getLabelForValue(a[i.axis]),value:s}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,i,r){const a=r==="reset",{index:l,_cachedMeta:{vScale:s}}=this,d=s.getBasePixel(),m=s.isHorizontal(),_=this._getRuler(),{sharedOptions:S,includeOptions:T}=this._getSharedOptions(t,r);for(let C=t;C<t+i;C++){const P=this.getParsed(C),k=a||_r(P[s.axis])?{base:d,head:d}:this._calculateBarValuePixels(C),R=this._calculateBarIndexPixels(C,_),O=(P._stacks||{})[s.axis],F={horizontal:m,base:k.base,enableBorderRadius:!O||L2(P._custom)||l===O._top||l===O._bottom,x:m?k.head:R.center,y:m?R.center:k.head,height:m?R.size:Math.abs(k.size),width:m?Math.abs(k.size):R.size};T&&(F.options=S||this.resolveDataElementOptions(C,e[C].active?"active":r));const N=F.options||e[C].options;lq(F,N,O,l),uq(F,N,_.ratio),this.updateElement(e[C],C,F,r)}}_getStacks(e,t){const{iScale:i}=this._cachedMeta,r=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),a=i.options.stacked,l=[],s=d=>{const m=d.controller.getParsed(t),_=m&&m[d.vScale.axis];if(_r(_)||isNaN(_))return!0};for(const d of r)if(!(t!==void 0&&s(d))&&((a===!1||l.indexOf(d.stack)===-1||a===void 0&&d.stack===void 0)&&l.push(d.stack),d.index===e))break;return l.length||l.push(void 0),l}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,i){const r=this._getStacks(e,i),a=t!==void 0?r.indexOf(t):-1;return a===-1?r.length-1:a}_getRuler(){const e=this.options,t=this._cachedMeta,i=t.iScale,r=[];let a,l;for(a=0,l=t.data.length;a<l;++a)r.push(i.getPixelForValue(this.getParsed(a)[i.axis],a));const s=e.barThickness;return{min:s||nq(t),pixels:r,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:e.grouped,ratio:s?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:i},options:{base:r,minBarLength:a}}=this,l=r||0,s=this.getParsed(e),d=s._custom,m=L2(d);let _=s[t.axis],S=0,T=i?this.applyStack(t,s,i):_,C,P;T!==_&&(S=T-_,T=_),m&&(_=d.barStart,T=d.barEnd-d.barStart,_!==0&&xh(_)!==xh(d.barEnd)&&(S=0),S+=_);const k=!_r(r)&&!m?r:S;let R=t.getPixelForValue(k);if(this.chart.getDataVisibility(e)?C=t.getPixelForValue(S+T):C=R,P=C-R,Math.abs(P)<a){P=oq(P,t,l)*a,_===l&&(R-=P/2);const O=t.getPixelForDecimal(0),F=t.getPixelForDecimal(1),N=Math.min(O,F),G=Math.max(O,F);R=Math.max(Math.min(R,G),N),C=R+P}if(R===t.getPixelForValue(l)){const O=xh(P)*t.getLineWidthForValue(l)/2;R+=O,P-=O}return{size:P,base:R,head:C,center:C+P/2}}_calculateBarIndexPixels(e,t){const i=t.scale,r=this.options,a=r.skipNull,l=Mi(r.maxBarThickness,1/0);let s,d;if(t.grouped){const m=a?this._getStackCount(e):t.stackCount,_=r.barThickness==="flex"?rq(e,t,r,m):iq(e,t,r,m),S=this._getStackIndex(this.index,this._cachedMeta.stack,a?e:void 0);s=_.start+_.chunk*S+_.chunk/2,d=Math.min(l,_.chunk*_.ratio)}else s=i.getPixelForValue(this.getParsed(e)[i.axis],e),d=Math.min(l,t.min*t.ratio);return{base:s-d/2,head:s+d/2,center:s,size:d}}draw(){const e=this._cachedMeta,t=e.vScale,i=e.data,r=i.length;let a=0;for(;a<r;++a)this.getParsed(a)[t.axis]!==null&&i[a].draw(this._ctx)}}xP.id="bar";xP.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};xP.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class vP extends Pc{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,i,r){const a=super.parsePrimitiveData(e,t,i,r);for(let l=0;l<a.length;l++)a[l]._custom=this.resolveDataElementOptions(l+i).radius;return a}parseArrayData(e,t,i,r){const a=super.parseArrayData(e,t,i,r);for(let l=0;l<a.length;l++){const s=t[i+l];a[l]._custom=Mi(s[2],this.resolveDataElementOptions(l+i).radius)}return a}parseObjectData(e,t,i,r){const a=super.parseObjectData(e,t,i,r);for(let l=0;l<a.length;l++){const s=t[i+l];a[l]._custom=Mi(s&&s.r&&+s.r,this.resolveDataElementOptions(l+i).radius)}return a}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,{xScale:i,yScale:r}=t,a=this.getParsed(e),l=i.getLabelForValue(a.x),s=r.getLabelForValue(a.y),d=a._custom;return{label:t.label,value:"("+l+", "+s+(d?", "+d:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,i,r){const a=r==="reset",{iScale:l,vScale:s}=this._cachedMeta,{sharedOptions:d,includeOptions:m}=this._getSharedOptions(t,r),_=l.axis,S=s.axis;for(let T=t;T<t+i;T++){const C=e[T],P=!a&&this.getParsed(T),k={},R=k[_]=a?l.getPixelForDecimal(.5):l.getPixelForValue(P[_]),O=k[S]=a?s.getBasePixel():s.getPixelForValue(P[S]);k.skip=isNaN(R)||isNaN(O),m&&(k.options=d||this.resolveDataElementOptions(T,C.active?"active":r),a&&(k.options.radius=0)),this.updateElement(C,T,k,r)}}resolveDataElementOptions(e,t){const i=this.getParsed(e);let r=super.resolveDataElementOptions(e,t);r.$shared&&(r=Object.assign({},r,{$shared:!1}));const a=r.radius;return t!=="active"&&(r.radius=0),r.radius+=Mi(i&&i._custom,a),r}}vP.id="bubble";vP.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};vP.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title(){return""}}}}};function hq(n,e,t){let i=1,r=1,a=0,l=0;if(e<Rr){const s=n,d=s+e,m=Math.cos(s),_=Math.sin(s),S=Math.cos(d),T=Math.sin(d),C=(N,G,j)=>dv(N,s,d,!0)?1:Math.max(G,G*t,j,j*t),P=(N,G,j)=>dv(N,s,d,!0)?-1:Math.min(G,G*t,j,j*t),k=C(0,m,S),R=C(vs,_,T),O=P(Jr,m,S),F=P(Jr+vs,_,T);i=(k-O)/2,r=(R-F)/2,a=-(k+O)/2,l=-(R+F)/2}return{ratioX:i,ratioY:r,offsetX:a,offsetY:l}}class Jv extends Pc{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const i=this.getDataset().data,r=this._cachedMeta;if(this._parsing===!1)r._parsed=i;else{let a=d=>+i[d];if(ar(i[e])){const{key:d="value"}=this._parsing;a=m=>+gp(i[m],d)}let l,s;for(l=e,s=e+t;l<s;++l)r._parsed[l]=a(l)}}_getRotation(){return bu(this.options.rotation-90)}_getCircumference(){return bu(this.options.circumference)}_getRotationExtents(){let e=Rr,t=-Rr;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)){const r=this.chart.getDatasetMeta(i).controller,a=r._getRotation(),l=r._getCircumference();e=Math.min(e,a),t=Math.max(t,a+l)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:i}=t,r=this._cachedMeta,a=r.data,l=this.getMaxBorderWidth()+this.getMaxOffset(a)+this.options.spacing,s=Math.max((Math.min(i.width,i.height)-l)/2,0),d=Math.min(r9(this.options.cutout,s),1),m=this._getRingWeight(this.index),{circumference:_,rotation:S}=this._getRotationExtents(),{ratioX:T,ratioY:C,offsetX:P,offsetY:k}=hq(S,_,d),R=(i.width-l)/T,O=(i.height-l)/C,F=Math.max(Math.min(R,O)/2,0),N=ZN(this.options.radius,F),G=Math.max(N*d,0),j=(N-G)/this._getVisibleDatasetWeightTotal();this.offsetX=P*N,this.offsetY=k*N,r.total=this.calculateTotal(),this.outerRadius=N-j*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-j*m,0),this.updateElements(a,0,a.length,e)}_circumference(e,t){const i=this.options,r=this._cachedMeta,a=this._getCircumference();return t&&i.animation.animateRotate||!this.chart.getDataVisibility(e)||r._parsed[e]===null||r.data[e].hidden?0:this.calculateCircumference(r._parsed[e]*a/Rr)}updateElements(e,t,i,r){const a=r==="reset",l=this.chart,s=l.chartArea,m=l.options.animation,_=(s.left+s.right)/2,S=(s.top+s.bottom)/2,T=a&&m.animateScale,C=T?0:this.innerRadius,P=T?0:this.outerRadius,{sharedOptions:k,includeOptions:R}=this._getSharedOptions(t,r);let O=this._getRotation(),F;for(F=0;F<t;++F)O+=this._circumference(F,a);for(F=t;F<t+i;++F){const N=this._circumference(F,a),G=e[F],j={x:_+this.offsetX,y:S+this.offsetY,startAngle:O,endAngle:O+N,circumference:N,outerRadius:P,innerRadius:C};R&&(j.options=k||this.resolveDataElementOptions(F,G.active?"active":r)),O+=N,this.updateElement(G,F,j,r)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let i=0,r;for(r=0;r<t.length;r++){const a=e._parsed[r];a!==null&&!isNaN(a)&&this.chart.getDataVisibility(r)&&!t[r].hidden&&(i+=Math.abs(a))}return i}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?Rr*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,r=i.data.labels||[],a=Yv(t._parsed[e],i.options.locale);return{label:r[e]||"",value:a}}getMaxBorderWidth(e){let t=0;const i=this.chart;let r,a,l,s,d;if(!e){for(r=0,a=i.data.datasets.length;r<a;++r)if(i.isDatasetVisible(r)){l=i.getDatasetMeta(r),e=l.data,s=l.controller;break}}if(!e)return 0;for(r=0,a=e.length;r<a;++r)d=s.resolveDataElementOptions(r),d.borderAlign!=="inner"&&(t=Math.max(t,d.borderWidth||0,d.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let i=0,r=e.length;i<r;++i){const a=this.resolveDataElementOptions(i);t=Math.max(t,a.offset||0,a.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let i=0;i<e;++i)this.chart.isDatasetVisible(i)&&(t+=this._getRingWeight(i));return t}_getRingWeight(e){return Math.max(Mi(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Jv.id="doughnut";Jv.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};Jv.descriptors={_scriptable:n=>n!=="spacing",_indexable:n=>n!=="spacing"};Jv.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(n){const e=n.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:t}}=n.legend.options;return e.labels.map((i,r)=>{const l=n.getDatasetMeta(0).controller.getStyle(r);return{text:i,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,lineWidth:l.borderWidth,pointStyle:t,hidden:!n.getDataVisibility(r),index:r}})}return[]}},onClick(n,e,t){t.chart.toggleDataVisibility(e.index),t.chart.update()}},tooltip:{callbacks:{title(){return""},label(n){let e=n.label;const t=": "+n.formattedValue;return Lr(e)?(e=e.slice(),e[0]+=t):e+=t,e}}}}};class AM extends Pc{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:i,data:r=[],_dataset:a}=t,l=this.chart._animationsDisabled;let{start:s,count:d}=e4(t,r,l);this._drawStart=s,this._drawCount=d,t4(t)&&(s=0,d=r.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!a._decimated,i.points=r;const m=this.resolveDatasetElementOptions(e);this.options.showLine||(m.borderWidth=0),m.segment=this.options.segment,this.updateElement(i,void 0,{animated:!l,options:m},e),this.updateElements(r,s,d,e)}updateElements(e,t,i,r){const a=r==="reset",{iScale:l,vScale:s,_stacked:d,_dataset:m}=this._cachedMeta,{sharedOptions:_,includeOptions:S}=this._getSharedOptions(t,r),T=l.axis,C=s.axis,{spanGaps:P,segment:k}=this.options,R=ag(P)?P:Number.POSITIVE_INFINITY,O=this.chart._animationsDisabled||a||r==="none";let F=t>0&&this.getParsed(t-1);for(let N=t;N<t+i;++N){const G=e[N],j=this.getParsed(N),Q=O?G:{},re=_r(j[C]),$=Q[T]=l.getPixelForValue(j[T],N),ne=Q[C]=a||re?s.getBasePixel():s.getPixelForValue(d?this.applyStack(s,j,d):j[C],N);Q.skip=isNaN($)||isNaN(ne)||re,Q.stop=N>0&&Math.abs(j[T]-F[T])>R,k&&(Q.parsed=j,Q.raw=m.data[N]),S&&(Q.options=_||this.resolveDataElementOptions(N,G.active?"active":r)),O||this.updateElement(G,N,Q,r),F=j}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,i=t.options&&t.options.borderWidth||0,r=e.data||[];if(!r.length)return i;const a=r[0].size(this.resolveDataElementOptions(0)),l=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(i,a,l)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}AM.id="line";AM.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};AM.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class wP extends Pc{constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,r=i.data.labels||[],a=Yv(t._parsed[e].r,i.options.locale);return{label:r[e]||"",value:a}}parseObjectData(e,t,i,r){return f4.bind(this)(e,t,i,r)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((i,r)=>{const a=this.getParsed(r).r;!isNaN(a)&&this.chart.getDataVisibility(r)&&(a<t.min&&(t.min=a),a>t.max&&(t.max=a))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,i=e.options,r=Math.min(t.right-t.left,t.bottom-t.top),a=Math.max(r/2,0),l=Math.max(i.cutoutPercentage?a/100*i.cutoutPercentage:1,0),s=(a-l)/e.getVisibleDatasetCount();this.outerRadius=a-s*this.index,this.innerRadius=this.outerRadius-s}updateElements(e,t,i,r){const a=r==="reset",l=this.chart,d=l.options.animation,m=this._cachedMeta.rScale,_=m.xCenter,S=m.yCenter,T=m.getIndexAngle(0)-.5*Jr;let C=T,P;const k=360/this.countVisibleElements();for(P=0;P<t;++P)C+=this._computeAngle(P,r,k);for(P=t;P<t+i;P++){const R=e[P];let O=C,F=C+this._computeAngle(P,r,k),N=l.getDataVisibility(P)?m.getDistanceFromCenterForValue(this.getParsed(P).r):0;C=F,a&&(d.animateScale&&(N=0),d.animateRotate&&(O=F=T));const G={x:_,y:S,innerRadius:0,outerRadius:N,startAngle:O,endAngle:F,options:this.resolveDataElementOptions(P,R.active?"active":r)};this.updateElement(R,P,G,r)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((i,r)=>{!isNaN(this.getParsed(r).r)&&this.chart.getDataVisibility(r)&&t++}),t}_computeAngle(e,t,i){return this.chart.getDataVisibility(e)?bu(this.resolveDataElementOptions(e,t).angle||i):0}}wP.id="polarArea";wP.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};wP.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(n){const e=n.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:t}}=n.legend.options;return e.labels.map((i,r)=>{const l=n.getDatasetMeta(0).controller.getStyle(r);return{text:i,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,lineWidth:l.borderWidth,pointStyle:t,hidden:!n.getDataVisibility(r),index:r}})}return[]}},onClick(n,e,t){t.chart.toggleDataVisibility(e.index),t.chart.update()}},tooltip:{callbacks:{title(){return""},label(n){return n.chart.data.labels[n.dataIndex]+": "+n.formattedValue}}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class b4 extends Jv{}b4.id="pie";b4.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class bP extends Pc{getLabelAndValue(e){const t=this._cachedMeta.vScale,i=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(i[t.axis])}}parseObjectData(e,t,i,r){return f4.bind(this)(e,t,i,r)}update(e){const t=this._cachedMeta,i=t.dataset,r=t.data||[],a=t.iScale.getLabels();if(i.points=r,e!=="resize"){const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0);const s={_loop:!0,_fullLoop:a.length===r.length,options:l};this.updateElement(i,void 0,s,e)}this.updateElements(r,0,r.length,e)}updateElements(e,t,i,r){const a=this._cachedMeta.rScale,l=r==="reset";for(let s=t;s<t+i;s++){const d=e[s],m=this.resolveDataElementOptions(s,d.active?"active":r),_=a.getPointPositionForValue(s,this.getParsed(s).r),S=l?a.xCenter:_.x,T=l?a.yCenter:_.y,C={x:S,y:T,angle:_.angle,skip:isNaN(S)||isNaN(T),options:m};this.updateElement(d,s,C,r)}}}bP.id="radar";bP.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};bP.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class ku{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}hasValue(){return ag(this.x)&&ag(this.y)}getProps(e,t){const i=this.$animations;if(!t||!i)return this;const r={};return e.forEach(a=>{r[a]=i[a]&&i[a].active()?i[a]._to:this[a]}),r}}ku.defaults={};ku.defaultRoutes=void 0;const S4={values(n){return Lr(n)?n:""+n},numeric(n,e,t){if(n===0)return"0";const i=this.chart.options.locale;let r,a=n;if(t.length>1){const m=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(m<1e-4||m>1e15)&&(r="scientific"),a=dq(n,t)}const l=_c(Math.abs(a)),s=Math.max(Math.min(-1*Math.floor(l),20),0),d={notation:r,minimumFractionDigits:s,maximumFractionDigits:s};return Object.assign(d,this.options.ticks.format),Yv(n,i,d)},logarithmic(n,e,t){if(n===0)return"0";const i=n/Math.pow(10,Math.floor(_c(n)));return i===1||i===2||i===5?S4.numeric.call(this,n,e,t):""}};function dq(n,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&n!==Math.floor(n)&&(t=n-Math.floor(n)),t}var CM={formatters:S4};Fi.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(n,e)=>e.lineWidth,tickColor:(n,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:CM.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}});Fi.route("scale.ticks","color","","color");Fi.route("scale.grid","color","","borderColor");Fi.route("scale.grid","borderColor","","borderColor");Fi.route("scale.title","color","","color");Fi.describe("scale",{_fallback:!1,_scriptable:n=>!n.startsWith("before")&&!n.startsWith("after")&&n!=="callback"&&n!=="parser",_indexable:n=>n!=="borderDash"&&n!=="tickBorderDash"});Fi.describe("scales",{_fallback:"scale"});Fi.describe("scale.ticks",{_scriptable:n=>n!=="backdropPadding"&&n!=="callback",_indexable:n=>n!=="backdropPadding"});function fq(n,e){const t=n.options.ticks,i=t.maxTicksLimit||pq(n),r=t.major.enabled?gq(e):[],a=r.length,l=r[0],s=r[a-1],d=[];if(a>i)return _q(e,d,r,a/i),d;const m=mq(r,e,i);if(a>0){let _,S;const T=a>1?Math.round((s-l)/(a-1)):null;for(Fw(e,d,m,_r(T)?0:l-T,l),_=0,S=a-1;_<S;_++)Fw(e,d,m,r[_],r[_+1]);return Fw(e,d,m,s,_r(T)?e.length:s+T),d}return Fw(e,d,m),d}function pq(n){const e=n.options.offset,t=n._tickSize(),i=n._length/t+(e?0:1),r=n._maxLength/t;return Math.floor(Math.min(i,r))}function mq(n,e,t){const i=yq(n),r=e.length/t;if(!i)return Math.max(r,1);const a=d9(i);for(let l=0,s=a.length-1;l<s;l++){const d=a[l];if(d>r)return d}return Math.max(r,1)}function gq(n){const e=[];let t,i;for(t=0,i=n.length;t<i;t++)n[t].major&&e.push(t);return e}function _q(n,e,t,i){let r=0,a=t[0],l;for(i=Math.ceil(i),l=0;l<n.length;l++)l===a&&(e.push(n[l]),r++,a=t[r*i])}function Fw(n,e,t,i,r){const a=Mi(i,0),l=Math.min(Mi(r,n.length),n.length);let s=0,d,m,_;for(t=Math.ceil(t),r&&(d=r-i,t=d/Math.floor(d/t)),_=a;_<0;)s++,_=Math.round(a+s*t);for(m=Math.max(a,0);m<l;m++)m===_&&(e.push(n[m]),s++,_=Math.round(a+s*t))}function yq(n){const e=n.length;let t,i;if(e<2)return!1;for(i=n[0],t=1;t<e;++t)if(n[t]-n[t-1]!==i)return!1;return i}const xq=n=>n==="left"?"right":n==="right"?"left":n,DR=(n,e,t)=>e==="top"||e==="left"?n[e]+t:n[e]-t;function LR(n,e){const t=[],i=n.length/e,r=n.length;let a=0;for(;a<r;a+=i)t.push(n[Math.floor(a)]);return t}function vq(n,e,t){const i=n.ticks.length,r=Math.min(e,i-1),a=n._startPixel,l=n._endPixel,s=1e-6;let d=n.getPixelForTick(r),m;if(!(t&&(i===1?m=Math.max(d-a,l-d):e===0?m=(n.getPixelForTick(1)-d)/2:m=(d-n.getPixelForTick(r-1))/2,d+=r<e?m:-m,d<a-s||d>l+s)))return d}function wq(n,e){_i(n,t=>{const i=t.gc,r=i.length/2;let a;if(r>e){for(a=0;a<r;++a)delete t.data[i[a]];i.splice(0,r)}})}function W0(n){return n.drawTicks?n.tickLength:0}function RR(n,e){if(!n.display)return 0;const t=ro(n.font,e),i=pa(n.padding);return(Lr(n.text)?n.text.length:1)*t.lineHeight+i.height}function bq(n,e){return Ap(n,{scale:e,type:"scale"})}function Sq(n,e,t){return Ap(n,{tick:t,index:e,type:"tick"})}function Mq(n,e,t){let i=uP(n);return(t&&e!=="right"||!t&&e==="right")&&(i=xq(i)),i}function Tq(n,e,t,i){const{top:r,left:a,bottom:l,right:s,chart:d}=n,{chartArea:m,scales:_}=d;let S=0,T,C,P;const k=l-r,R=s-a;if(n.isHorizontal()){if(C=ra(i,a,s),ar(t)){const O=Object.keys(t)[0],F=t[O];P=_[O].getPixelForValue(F)+k-e}else t==="center"?P=(m.bottom+m.top)/2+k-e:P=DR(n,t,e);T=s-a}else{if(ar(t)){const O=Object.keys(t)[0],F=t[O];C=_[O].getPixelForValue(F)-R+e}else t==="center"?C=(m.left+m.right)/2-R+e:C=DR(n,t,e);P=ra(i,l,r),S=t==="left"?-vs:vs}return{titleX:C,titleY:P,maxWidth:T,rotation:S}}class _g extends ku{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:i,_suggestedMax:r}=this;return e=uc(e,Number.POSITIVE_INFINITY),t=uc(t,Number.NEGATIVE_INFINITY),i=uc(i,Number.POSITIVE_INFINITY),r=uc(r,Number.NEGATIVE_INFINITY),{min:uc(e,i),max:uc(t,r),minDefined:so(e),maxDefined:so(t)}}getMinMax(e){let{min:t,max:i,minDefined:r,maxDefined:a}=this.getUserBounds(),l;if(r&&a)return{min:t,max:i};const s=this.getMatchingVisibleMetas();for(let d=0,m=s.length;d<m;++d)l=s[d].controller.getMinMax(this,e),r||(t=Math.min(t,l.min)),a||(i=Math.max(i,l.max));return t=a&&t>i?i:t,i=r&&t>i?t:i,{min:uc(t,uc(i,t)),max:uc(i,uc(t,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){mr(this.options.beforeUpdate,[this])}update(e,t,i){const{beginAtZero:r,grace:a,ticks:l}=this.options,s=l.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=t7(this,a,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const d=s<this.ticks.length;this._convertTicksToLabels(d?LR(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),l.display&&(l.autoSkip||l.source==="auto")&&(this.ticks=fq(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),d&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,i;this.isHorizontal()?(t=this.left,i=this.right):(t=this.top,i=this.bottom,e=!e),this._startPixel=t,this._endPixel=i,this._reversePixels=e,this._length=i-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){mr(this.options.afterUpdate,[this])}beforeSetDimensions(){mr(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){mr(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),mr(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){mr(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let i,r,a;for(i=0,r=e.length;i<r;i++)a=e[i],a.label=mr(t.callback,[a.value,i,e],this)}afterTickToLabelConversion(){mr(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){mr(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,i=this.ticks.length,r=t.minRotation||0,a=t.maxRotation;let l=r,s,d,m;if(!this._isVisible()||!t.display||r>=a||i<=1||!this.isHorizontal()){this.labelRotation=r;return}const _=this._getLabelSizes(),S=_.widest.width,T=_.highest.height,C=ca(this.chart.width-S,0,this.maxWidth);s=e.offset?this.maxWidth/i:C/(i-1),S+6>s&&(s=C/(i-(e.offset?.5:1)),d=this.maxHeight-W0(e.grid)-t.padding-RR(e.title,this.chart.options.font),m=Math.sqrt(S*S+T*T),l=cP(Math.min(Math.asin(ca((_.highest.height+6)/s,-1,1)),Math.asin(ca(d/m,-1,1))-Math.asin(ca(T/m,-1,1)))),l=Math.max(r,Math.min(a,l))),this.labelRotation=l}afterCalculateLabelRotation(){mr(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){mr(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:i,title:r,grid:a}}=this,l=this._isVisible(),s=this.isHorizontal();if(l){const d=RR(r,t.options.font);if(s?(e.width=this.maxWidth,e.height=W0(a)+d):(e.height=this.maxHeight,e.width=W0(a)+d),i.display&&this.ticks.length){const{first:m,last:_,widest:S,highest:T}=this._getLabelSizes(),C=i.padding*2,P=bu(this.labelRotation),k=Math.cos(P),R=Math.sin(P);if(s){const O=i.mirror?0:R*S.width+k*T.height;e.height=Math.min(this.maxHeight,e.height+O+C)}else{const O=i.mirror?0:k*S.width+R*T.height;e.width=Math.min(this.maxWidth,e.width+O+C)}this._calculatePadding(m,_,R,k)}}this._handleMargins(),s?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,i,r){const{ticks:{align:a,padding:l},position:s}=this.options,d=this.labelRotation!==0,m=s!=="top"&&this.axis==="x";if(this.isHorizontal()){const _=this.getPixelForTick(0)-this.left,S=this.right-this.getPixelForTick(this.ticks.length-1);let T=0,C=0;d?m?(T=r*e.width,C=i*t.height):(T=i*e.height,C=r*t.width):a==="start"?C=t.width:a==="end"?T=e.width:a!=="inner"&&(T=e.width/2,C=t.width/2),this.paddingLeft=Math.max((T-_+l)*this.width/(this.width-_),0),this.paddingRight=Math.max((C-S+l)*this.width/(this.width-S),0)}else{let _=t.height/2,S=e.height/2;a==="start"?(_=0,S=e.height):a==="end"&&(_=t.height,S=0),this.paddingTop=_+l,this.paddingBottom=S+l}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){mr(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,i;for(t=0,i=e.length;t<i;t++)_r(e[t].label)&&(e.splice(t,1),i--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let i=this.ticks;t<i.length&&(i=LR(i,t)),this._labelSizes=e=this._computeLabelSizes(i,i.length)}return e}_computeLabelSizes(e,t){const{ctx:i,_longestTextCache:r}=this,a=[],l=[];let s=0,d=0,m,_,S,T,C,P,k,R,O,F,N;for(m=0;m<t;++m){if(T=e[m].label,C=this._resolveTickFontOptions(m),i.font=P=C.string,k=r[P]=r[P]||{data:{},gc:[]},R=C.lineHeight,O=F=0,!_r(T)&&!Lr(T))O=BS(i,k.data,k.gc,O,T),F=R;else if(Lr(T))for(_=0,S=T.length;_<S;++_)N=T[_],!_r(N)&&!Lr(N)&&(O=BS(i,k.data,k.gc,O,N),F+=R);a.push(O),l.push(F),s=Math.max(O,s),d=Math.max(F,d)}wq(r,t);const G=a.indexOf(s),j=l.indexOf(d),Q=re=>({width:a[re]||0,height:l[re]||0});return{first:Q(0),last:Q(t-1),widest:Q(G),highest:Q(j),widths:a,heights:l}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return m9(this._alignToPixels?um(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const i=t[e];return i.$context||(i.$context=Sq(this.getContext(),e,i))}return this.$context||(this.$context=bq(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=bu(this.labelRotation),i=Math.abs(Math.cos(t)),r=Math.abs(Math.sin(t)),a=this._getLabelSizes(),l=e.autoSkipPadding||0,s=a?a.widest.width+l:0,d=a?a.highest.height+l:0;return this.isHorizontal()?d*i>s*r?s/i:d/r:d*r<s*i?d/i:s/r}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,i=this.chart,r=this.options,{grid:a,position:l}=r,s=a.offset,d=this.isHorizontal(),_=this.ticks.length+(s?1:0),S=W0(a),T=[],C=a.setContext(this.getContext()),P=C.drawBorder?C.borderWidth:0,k=P/2,R=function(fe){return um(i,fe,P)};let O,F,N,G,j,Q,re,$,ne,ue,De,$e;if(l==="top")O=R(this.bottom),Q=this.bottom-S,$=O-k,ue=R(e.top)+k,$e=e.bottom;else if(l==="bottom")O=R(this.top),ue=e.top,$e=R(e.bottom)-k,Q=O+k,$=this.top+S;else if(l==="left")O=R(this.right),j=this.right-S,re=O-k,ne=R(e.left)+k,De=e.right;else if(l==="right")O=R(this.left),ne=e.left,De=R(e.right)-k,j=O+k,re=this.left+S;else if(t==="x"){if(l==="center")O=R((e.top+e.bottom)/2+.5);else if(ar(l)){const fe=Object.keys(l)[0],Oe=l[fe];O=R(this.chart.scales[fe].getPixelForValue(Oe))}ue=e.top,$e=e.bottom,Q=O+k,$=Q+S}else if(t==="y"){if(l==="center")O=R((e.left+e.right)/2);else if(ar(l)){const fe=Object.keys(l)[0],Oe=l[fe];O=R(this.chart.scales[fe].getPixelForValue(Oe))}j=O-k,re=j-S,ne=e.left,De=e.right}const ae=Mi(r.ticks.maxTicksLimit,_),le=Math.max(1,Math.ceil(_/ae));for(F=0;F<_;F+=le){const fe=a.setContext(this.getContext(F)),Oe=fe.lineWidth,We=fe.color,ce=fe.borderDash||[],Te=fe.borderDashOffset,Pe=fe.tickWidth,Qe=fe.tickColor,Ne=fe.tickBorderDash||[],nt=fe.tickBorderDashOffset;N=vq(this,F,s),N!==void 0&&(G=um(i,N,Oe),d?j=re=ne=De=G:Q=$=ue=$e=G,T.push({tx1:j,ty1:Q,tx2:re,ty2:$,x1:ne,y1:ue,x2:De,y2:$e,width:Oe,color:We,borderDash:ce,borderDashOffset:Te,tickWidth:Pe,tickColor:Qe,tickBorderDash:Ne,tickBorderDashOffset:nt}))}return this._ticksLength=_,this._borderValue=O,T}_computeLabelItems(e){const t=this.axis,i=this.options,{position:r,ticks:a}=i,l=this.isHorizontal(),s=this.ticks,{align:d,crossAlign:m,padding:_,mirror:S}=a,T=W0(i.grid),C=T+_,P=S?-_:C,k=-bu(this.labelRotation),R=[];let O,F,N,G,j,Q,re,$,ne,ue,De,$e,ae="middle";if(r==="top")Q=this.bottom-P,re=this._getXAxisLabelAlignment();else if(r==="bottom")Q=this.top+P,re=this._getXAxisLabelAlignment();else if(r==="left"){const fe=this._getYAxisLabelAlignment(T);re=fe.textAlign,j=fe.x}else if(r==="right"){const fe=this._getYAxisLabelAlignment(T);re=fe.textAlign,j=fe.x}else if(t==="x"){if(r==="center")Q=(e.top+e.bottom)/2+C;else if(ar(r)){const fe=Object.keys(r)[0],Oe=r[fe];Q=this.chart.scales[fe].getPixelForValue(Oe)+C}re=this._getXAxisLabelAlignment()}else if(t==="y"){if(r==="center")j=(e.left+e.right)/2-C;else if(ar(r)){const fe=Object.keys(r)[0],Oe=r[fe];j=this.chart.scales[fe].getPixelForValue(Oe)}re=this._getYAxisLabelAlignment(T).textAlign}t==="y"&&(d==="start"?ae="top":d==="end"&&(ae="bottom"));const le=this._getLabelSizes();for(O=0,F=s.length;O<F;++O){N=s[O],G=N.label;const fe=a.setContext(this.getContext(O));$=this.getPixelForTick(O)+a.labelOffset,ne=this._resolveTickFontOptions(O),ue=ne.lineHeight,De=Lr(G)?G.length:1;const Oe=De/2,We=fe.color,ce=fe.textStrokeColor,Te=fe.textStrokeWidth;let Pe=re;l?(j=$,re==="inner"&&(O===F-1?Pe=this.options.reverse?"left":"right":O===0?Pe=this.options.reverse?"right":"left":Pe="center"),r==="top"?m==="near"||k!==0?$e=-De*ue+ue/2:m==="center"?$e=-le.highest.height/2-Oe*ue+ue:$e=-le.highest.height+ue/2:m==="near"||k!==0?$e=ue/2:m==="center"?$e=le.highest.height/2-Oe*ue:$e=le.highest.height-De*ue,S&&($e*=-1)):(Q=$,$e=(1-De)*ue/2);let Qe;if(fe.showLabelBackdrop){const Ne=pa(fe.backdropPadding),nt=le.heights[O],ze=le.widths[O];let et=Q+$e-Ne.top,Et=j-Ne.left;switch(ae){case"middle":et-=nt/2;break;case"bottom":et-=nt;break}switch(re){case"center":Et-=ze/2;break;case"right":Et-=ze;break}Qe={left:Et,top:et,width:ze+Ne.width,height:nt+Ne.height,color:fe.backdropColor}}R.push({rotation:k,label:G,font:ne,color:We,strokeColor:ce,strokeWidth:Te,textOffset:$e,textAlign:Pe,textBaseline:ae,translation:[j,Q],backdrop:Qe})}return R}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-bu(this.labelRotation))return e==="top"?"left":"right";let r="center";return t.align==="start"?r="left":t.align==="end"?r="right":t.align==="inner"&&(r="inner"),r}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:i,mirror:r,padding:a}}=this.options,l=this._getLabelSizes(),s=e+a,d=l.widest.width;let m,_;return t==="left"?r?(_=this.right+a,i==="near"?m="left":i==="center"?(m="center",_+=d/2):(m="right",_+=d)):(_=this.right-s,i==="near"?m="right":i==="center"?(m="center",_-=d/2):(m="left",_=this.left)):t==="right"?r?(_=this.left+a,i==="near"?m="right":i==="center"?(m="center",_-=d/2):(m="left",_-=d)):(_=this.left+s,i==="near"?m="left":i==="center"?(m="center",_+=d/2):(m="right",_=this.right)):m="right",{textAlign:m,x:_}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:i,top:r,width:a,height:l}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(i,r,a,l),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const r=this.ticks.findIndex(a=>a.value===e);return r>=0?t.setContext(this.getContext(r)).lineWidth:0}drawGrid(e){const t=this.options.grid,i=this.ctx,r=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let a,l;const s=(d,m,_)=>{!_.width||!_.color||(i.save(),i.lineWidth=_.width,i.strokeStyle=_.color,i.setLineDash(_.borderDash||[]),i.lineDashOffset=_.borderDashOffset,i.beginPath(),i.moveTo(d.x,d.y),i.lineTo(m.x,m.y),i.stroke(),i.restore())};if(t.display)for(a=0,l=r.length;a<l;++a){const d=r[a];t.drawOnChartArea&&s({x:d.x1,y:d.y1},{x:d.x2,y:d.y2},d),t.drawTicks&&s({x:d.tx1,y:d.ty1},{x:d.tx2,y:d.ty2},{color:d.tickColor,width:d.tickWidth,borderDash:d.tickBorderDash,borderDashOffset:d.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{grid:i}}=this,r=i.setContext(this.getContext()),a=i.drawBorder?r.borderWidth:0;if(!a)return;const l=i.setContext(this.getContext(0)).lineWidth,s=this._borderValue;let d,m,_,S;this.isHorizontal()?(d=um(e,this.left,a)-a/2,m=um(e,this.right,l)+l/2,_=S=s):(_=um(e,this.top,a)-a/2,S=um(e,this.bottom,l)+l/2,d=m=s),t.save(),t.lineWidth=r.borderWidth,t.strokeStyle=r.borderColor,t.beginPath(),t.moveTo(d,_),t.lineTo(m,S),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const i=this.ctx,r=this._computeLabelArea();r&&$v(i,r);const a=this._labelItems||(this._labelItems=this._computeLabelItems(e));let l,s;for(l=0,s=a.length;l<s;++l){const d=a[l],m=d.font,_=d.label;d.backdrop&&(i.fillStyle=d.backdrop.color,i.fillRect(d.backdrop.left,d.backdrop.top,d.backdrop.width,d.backdrop.height));let S=d.textOffset;cg(i,_,0,S,m,d)}r&&Xv(i)}drawTitle(){const{ctx:e,options:{position:t,title:i,reverse:r}}=this;if(!i.display)return;const a=ro(i.font),l=pa(i.padding),s=i.align;let d=a.lineHeight/2;t==="bottom"||t==="center"||ar(t)?(d+=l.bottom,Lr(i.text)&&(d+=a.lineHeight*(i.text.length-1))):d+=l.top;const{titleX:m,titleY:_,maxWidth:S,rotation:T}=Tq(this,d,t,s);cg(e,i.text,0,0,a,{color:i.color,maxWidth:S,rotation:T,textAlign:Mq(s,t,r),textBaseline:"middle",translation:[m,_]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,i=Mi(e.grid&&e.grid.z,-1);return!this._isVisible()||this.draw!==_g.prototype.draw?[{z:t,draw:r=>{this.draw(r)}}]:[{z:i,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:i+1,draw:()=>{this.drawBorder()}},{z:t,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",r=[];let a,l;for(a=0,l=t.length;a<l;++a){const s=t[a];s[i]===this.id&&(!e||s.type===e)&&r.push(s)}return r}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return ro(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class Bw{constructor(e,t,i){this.type=e,this.scope=t,this.override=i,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let i;Cq(t)&&(i=this.register(t));const r=this.items,a=e.id,l=this.scope+"."+a;if(!a)throw new Error("class does not have id: "+e);return a in r||(r[a]=e,Eq(e,l,i),this.override&&Fi.override(e.id,e.overrides)),l}get(e){return this.items[e]}unregister(e){const t=this.items,i=e.id,r=this.scope;i in t&&delete t[i],r&&i in Fi[r]&&(delete Fi[r][i],this.override&&delete lg[i])}}function Eq(n,e,t){const i=hv(Object.create(null),[t?Fi.get(t):{},Fi.get(e),n.defaults]);Fi.set(e,i),n.defaultRoutes&&Aq(e,n.defaultRoutes),n.descriptors&&Fi.describe(e,n.descriptors)}function Aq(n,e){Object.keys(e).forEach(t=>{const i=t.split("."),r=i.pop(),a=[n].concat(i).join("."),l=e[t].split("."),s=l.pop(),d=l.join(".");Fi.route(a,r,d,s)})}function Cq(n){return"id"in n&&"defaults"in n}class Iq{constructor(){this.controllers=new Bw(Pc,"datasets",!0),this.elements=new Bw(ku,"elements"),this.plugins=new Bw(Object,"plugins"),this.scales=new Bw(_g,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,i){[...t].forEach(r=>{const a=i||this._getRegistryForType(r);i||a.isForType(r)||a===this.plugins&&r.id?this._exec(e,a,r):_i(r,l=>{const s=i||this._getRegistryForType(l);this._exec(e,s,l)})})}_exec(e,t,i){const r=lP(e);mr(i["before"+r],[],i),t[e](i),mr(i["after"+r],[],i)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const i=this._typedRegistries[t];if(i.isForType(e))return i}return this.plugins}_get(e,t,i){const r=t.get(e);if(r===void 0)throw new Error('"'+e+'" is not a registered '+i+".");return r}}var Ea=new Iq;class SP extends Pc{update(e){const t=this._cachedMeta,{data:i=[]}=t,r=this.chart._animationsDisabled;let{start:a,count:l}=e4(t,i,r);if(this._drawStart=a,this._drawCount=l,t4(t)&&(a=0,l=i.length),this.options.showLine){const{dataset:s,_dataset:d}=t;s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!d._decimated,s.points=i;const m=this.resolveDatasetElementOptions(e);m.segment=this.options.segment,this.updateElement(s,void 0,{animated:!r,options:m},e)}this.updateElements(i,a,l,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=Ea.getElement("line")),super.addElements()}updateElements(e,t,i,r){const a=r==="reset",{iScale:l,vScale:s,_stacked:d,_dataset:m}=this._cachedMeta,_=this.resolveDataElementOptions(t,r),S=this.getSharedOptions(_),T=this.includeOptions(r,S),C=l.axis,P=s.axis,{spanGaps:k,segment:R}=this.options,O=ag(k)?k:Number.POSITIVE_INFINITY,F=this.chart._animationsDisabled||a||r==="none";let N=t>0&&this.getParsed(t-1);for(let G=t;G<t+i;++G){const j=e[G],Q=this.getParsed(G),re=F?j:{},$=_r(Q[P]),ne=re[C]=l.getPixelForValue(Q[C],G),ue=re[P]=a||$?s.getBasePixel():s.getPixelForValue(d?this.applyStack(s,Q,d):Q[P],G);re.skip=isNaN(ne)||isNaN(ue)||$,re.stop=G>0&&Math.abs(Q[C]-N[C])>O,R&&(re.parsed=Q,re.raw=m.data[G]),T&&(re.options=S||this.resolveDataElementOptions(G,j.active?"active":r)),F||this.updateElement(j,G,re,r),N=Q}this.updateSharedOptions(S,r,_)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let s=0;for(let d=t.length-1;d>=0;--d)s=Math.max(s,t[d].size(this.resolveDataElementOptions(d))/2);return s>0&&s}const i=e.dataset,r=i.options&&i.options.borderWidth||0;if(!t.length)return r;const a=t[0].size(this.resolveDataElementOptions(0)),l=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(r,a,l)/2}}SP.id="scatter";SP.defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};SP.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title(){return""},label(n){return"("+n.label+", "+n.formattedValue+")"}}}},scales:{x:{type:"linear"},y:{type:"linear"}}};function hm(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class jA{constructor(e){this.options=e||{}}init(e){}formats(){return hm()}parse(e,t){return hm()}format(e,t){return hm()}add(e,t,i){return hm()}diff(e,t,i){return hm()}startOf(e,t,i){return hm()}endOf(e,t){return hm()}}jA.override=function(n){Object.assign(jA.prototype,n)};var M4={_date:jA};function Pq(n,e,t,i){const{controller:r,data:a,_sorted:l}=n,s=r._cachedMeta.iScale;if(s&&e===s.axis&&e!=="r"&&l&&a.length){const d=s._reversePixels?g9:Om;if(i){if(r._sharedOptions){const m=a[0],_=typeof m.getRange=="function"&&m.getRange(e);if(_){const S=d(a,e,t-_),T=d(a,e,t+_);return{lo:S.lo,hi:T.hi}}}}else return d(a,e,t)}return{lo:0,hi:a.length-1}}function Kv(n,e,t,i,r){const a=n.getSortedVisibleDatasetMetas(),l=t[e];for(let s=0,d=a.length;s<d;++s){const{index:m,data:_}=a[s],{lo:S,hi:T}=Pq(a[s],e,l,r);for(let C=S;C<=T;++C){const P=_[C];P.skip||i(P,m,C)}}}function kq(n){const e=n.indexOf("x")!==-1,t=n.indexOf("y")!==-1;return function(i,r){const a=e?Math.abs(i.x-r.x):0,l=t?Math.abs(i.y-r.y):0;return Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}}function R2(n,e,t,i,r){const a=[];return!r&&!n.isPointInArea(e)||Kv(n,t,e,function(s,d,m){!r&&!fv(s,n.chartArea,0)||s.inRange(e.x,e.y,i)&&a.push({element:s,datasetIndex:d,index:m})},!0),a}function Dq(n,e,t,i){let r=[];function a(l,s,d){const{startAngle:m,endAngle:_}=l.getProps(["startAngle","endAngle"],i),{angle:S}=YN(l,{x:e.x,y:e.y});dv(S,m,_)&&r.push({element:l,datasetIndex:s,index:d})}return Kv(n,t,e,a),r}function Lq(n,e,t,i,r,a){let l=[];const s=kq(t);let d=Number.POSITIVE_INFINITY;function m(_,S,T){const C=_.inRange(e.x,e.y,r);if(i&&!C)return;const P=_.getCenterPoint(r);if(!(!!a||n.isPointInArea(P))&&!C)return;const R=s(e,P);R<d?(l=[{element:_,datasetIndex:S,index:T}],d=R):R===d&&l.push({element:_,datasetIndex:S,index:T})}return Kv(n,t,e,m),l}function z2(n,e,t,i,r,a){return!a&&!n.isPointInArea(e)?[]:t==="r"&&!i?Dq(n,e,t,r):Lq(n,e,t,i,r,a)}function zR(n,e,t,i,r){const a=[],l=t==="x"?"inXRange":"inYRange";let s=!1;return Kv(n,t,e,(d,m,_)=>{d[l](e[t],r)&&(a.push({element:d,datasetIndex:m,index:_}),s=s||d.inRange(e.x,e.y,r))}),i&&!s?[]:a}var Rq={evaluateInteractionItems:Kv,modes:{index(n,e,t,i){const r=Bf(e,n),a=t.axis||"x",l=t.includeInvisible||!1,s=t.intersect?R2(n,r,a,i,l):z2(n,r,a,!1,i,l),d=[];return s.length?(n.getSortedVisibleDatasetMetas().forEach(m=>{const _=s[0].index,S=m.data[_];S&&!S.skip&&d.push({element:S,datasetIndex:m.index,index:_})}),d):[]},dataset(n,e,t,i){const r=Bf(e,n),a=t.axis||"xy",l=t.includeInvisible||!1;let s=t.intersect?R2(n,r,a,i,l):z2(n,r,a,!1,i,l);if(s.length>0){const d=s[0].datasetIndex,m=n.getDatasetMeta(d).data;s=[];for(let _=0;_<m.length;++_)s.push({element:m[_],datasetIndex:d,index:_})}return s},point(n,e,t,i){const r=Bf(e,n),a=t.axis||"xy",l=t.includeInvisible||!1;return R2(n,r,a,i,l)},nearest(n,e,t,i){const r=Bf(e,n),a=t.axis||"xy",l=t.includeInvisible||!1;return z2(n,r,a,t.intersect,i,l)},x(n,e,t,i){const r=Bf(e,n);return zR(n,r,"x",t.intersect,i)},y(n,e,t,i){const r=Bf(e,n);return zR(n,r,"y",t.intersect,i)}}};const T4=["left","top","right","bottom"];function H0(n,e){return n.filter(t=>t.pos===e)}function OR(n,e){return n.filter(t=>T4.indexOf(t.pos)===-1&&t.box.axis===e)}function j0(n,e){return n.sort((t,i)=>{const r=e?i:t,a=e?t:i;return r.weight===a.weight?r.index-a.index:r.weight-a.weight})}function zq(n){const e=[];let t,i,r,a,l,s;for(t=0,i=(n||[]).length;t<i;++t)r=n[t],{position:a,options:{stack:l,stackWeight:s=1}}=r,e.push({index:t,box:r,pos:a,horizontal:r.isHorizontal(),weight:r.weight,stack:l&&a+l,stackWeight:s});return e}function Oq(n){const e={};for(const t of n){const{stack:i,pos:r,stackWeight:a}=t;if(!i||!T4.includes(r))continue;const l=e[i]||(e[i]={count:0,placed:0,weight:0,size:0});l.count++,l.weight+=a}return e}function Fq(n,e){const t=Oq(n),{vBoxMaxWidth:i,hBoxMaxHeight:r}=e;let a,l,s;for(a=0,l=n.length;a<l;++a){s=n[a];const{fullSize:d}=s.box,m=t[s.stack],_=m&&s.stackWeight/m.weight;s.horizontal?(s.width=_?_*i:d&&e.availableWidth,s.height=r):(s.width=i,s.height=_?_*r:d&&e.availableHeight)}return t}function Bq(n){const e=zq(n),t=j0(e.filter(m=>m.box.fullSize),!0),i=j0(H0(e,"left"),!0),r=j0(H0(e,"right")),a=j0(H0(e,"top"),!0),l=j0(H0(e,"bottom")),s=OR(e,"x"),d=OR(e,"y");return{fullSize:t,leftAndTop:i.concat(a),rightAndBottom:r.concat(d).concat(l).concat(s),chartArea:H0(e,"chartArea"),vertical:i.concat(r).concat(d),horizontal:a.concat(l).concat(s)}}function FR(n,e,t,i){return Math.max(n[t],e[t])+Math.max(n[i],e[i])}function E4(n,e){n.top=Math.max(n.top,e.top),n.left=Math.max(n.left,e.left),n.bottom=Math.max(n.bottom,e.bottom),n.right=Math.max(n.right,e.right)}function Nq(n,e,t,i){const{pos:r,box:a}=t,l=n.maxPadding;if(!ar(r)){t.size&&(n[r]-=t.size);const S=i[t.stack]||{size:0,count:1};S.size=Math.max(S.size,t.horizontal?a.height:a.width),t.size=S.size/S.count,n[r]+=t.size}a.getPadding&&E4(l,a.getPadding());const s=Math.max(0,e.outerWidth-FR(l,n,"left","right")),d=Math.max(0,e.outerHeight-FR(l,n,"top","bottom")),m=s!==n.w,_=d!==n.h;return n.w=s,n.h=d,t.horizontal?{same:m,other:_}:{same:_,other:m}}function Uq(n){const e=n.maxPadding;function t(i){const r=Math.max(e[i]-n[i],0);return n[i]+=r,r}n.y+=t("top"),n.x+=t("left"),t("right"),t("bottom")}function Vq(n,e){const t=e.maxPadding;function i(r){const a={left:0,top:0,right:0,bottom:0};return r.forEach(l=>{a[l]=Math.max(e[l],t[l])}),a}return i(n?["left","right"]:["top","bottom"])}function _x(n,e,t,i){const r=[];let a,l,s,d,m,_;for(a=0,l=n.length,m=0;a<l;++a){s=n[a],d=s.box,d.update(s.width||e.w,s.height||e.h,Vq(s.horizontal,e));const{same:S,other:T}=Nq(e,t,s,i);m|=S&&r.length,_=_||T,d.fullSize||r.push(s)}return m&&_x(r,e,t,i)||_}function Nw(n,e,t,i,r){n.top=t,n.left=e,n.right=e+i,n.bottom=t+r,n.width=i,n.height=r}function BR(n,e,t,i){const r=t.padding;let{x:a,y:l}=e;for(const s of n){const d=s.box,m=i[s.stack]||{count:1,placed:0,weight:1},_=s.stackWeight/m.weight||1;if(s.horizontal){const S=e.w*_,T=m.size||d.height;Cc(m.start)&&(l=m.start),d.fullSize?Nw(d,r.left,l,t.outerWidth-r.right-r.left,T):Nw(d,e.left+m.placed,l,S,T),m.start=l,m.placed+=S,l=d.bottom}else{const S=e.h*_,T=m.size||d.width;Cc(m.start)&&(a=m.start),d.fullSize?Nw(d,a,r.top,T,t.outerHeight-r.bottom-r.top):Nw(d,a,e.top+m.placed,T,S),m.start=a,m.placed+=S,a=d.right}}e.x=a,e.y=l}Fi.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var vc={addBox(n,e){n.boxes||(n.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},n.boxes.push(e)},removeBox(n,e){const t=n.boxes?n.boxes.indexOf(e):-1;t!==-1&&n.boxes.splice(t,1)},configure(n,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(n,e,t,i){if(!n)return;const r=pa(n.options.layout.padding),a=Math.max(e-r.width,0),l=Math.max(t-r.height,0),s=Bq(n.boxes),d=s.vertical,m=s.horizontal;_i(n.boxes,k=>{typeof k.beforeLayout=="function"&&k.beforeLayout()});const _=d.reduce((k,R)=>R.box.options&&R.box.options.display===!1?k:k+1,0)||1,S=Object.freeze({outerWidth:e,outerHeight:t,padding:r,availableWidth:a,availableHeight:l,vBoxMaxWidth:a/2/_,hBoxMaxHeight:l/2}),T=Object.assign({},r);E4(T,pa(i));const C=Object.assign({maxPadding:T,w:a,h:l,x:r.left,y:r.top},r),P=Fq(d.concat(m),S);_x(s.fullSize,C,S,P),_x(d,C,S,P),_x(m,C,S,P)&&_x(d,C,S,P),Uq(C),BR(s.leftAndTop,C,S,P),C.x+=C.w,C.y+=C.h,BR(s.rightAndBottom,C,S,P),n.chartArea={left:C.left,top:C.top,right:C.left+C.w,bottom:C.top+C.h,height:C.h,width:C.w},_i(s.chartArea,k=>{const R=k.box;Object.assign(R,n.chartArea),R.update(C.w,C.h,{left:0,top:0,right:0,bottom:0})})}};class A4{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,i){}removeEventListener(e,t,i){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,i,r){return t=Math.max(0,t||e.width),i=i||e.height,{width:t,height:Math.max(0,r?Math.floor(t/r):i)}}isAttached(e){return!0}updateConfig(e){}}class Gq extends A4{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Yb="$chartjs",Wq={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},NR=n=>n===null||n==="";function Hq(n,e){const t=n.style,i=n.getAttribute("height"),r=n.getAttribute("width");if(n[Yb]={initial:{height:i,width:r,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",NR(r)){const a=_R(n,"width");a!==void 0&&(n.width=a)}if(NR(i))if(n.style.height==="")n.height=n.width/(e||2);else{const a=_R(n,"height");a!==void 0&&(n.height=a)}return n}const C4=M7?{passive:!0}:!1;function jq(n,e,t){n.addEventListener(e,t,C4)}function qq(n,e,t){n.canvas.removeEventListener(e,t,C4)}function Zq(n,e){const t=Wq[n.type]||n.type,{x:i,y:r}=Bf(n,e);return{type:t,chart:e,native:n,x:i!==void 0?i:null,y:r!==void 0?r:null}}function US(n,e){for(const t of n)if(t===e||t.contains(e))return!0}function $q(n,e,t){const i=n.canvas,r=new MutationObserver(a=>{let l=!1;for(const s of a)l=l||US(s.addedNodes,i),l=l&&!US(s.removedNodes,i);l&&t()});return r.observe(document,{childList:!0,subtree:!0}),r}function Xq(n,e,t){const i=n.canvas,r=new MutationObserver(a=>{let l=!1;for(const s of a)l=l||US(s.removedNodes,i),l=l&&!US(s.addedNodes,i);l&&t()});return r.observe(document,{childList:!0,subtree:!0}),r}const mv=new Map;let UR=0;function I4(){const n=window.devicePixelRatio;n!==UR&&(UR=n,mv.forEach((e,t)=>{t.currentDevicePixelRatio!==n&&e()}))}function Yq(n,e){mv.size||window.addEventListener("resize",I4),mv.set(n,e)}function Jq(n){mv.delete(n),mv.size||window.removeEventListener("resize",I4)}function Kq(n,e,t){const i=n.canvas,r=i&&yP(i);if(!r)return;const a=QN((s,d)=>{const m=r.clientWidth;t(s,d),m<r.clientWidth&&t()},window),l=new ResizeObserver(s=>{const d=s[0],m=d.contentRect.width,_=d.contentRect.height;m===0&&_===0||a(m,_)});return l.observe(r),Yq(n,a),l}function O2(n,e,t){t&&t.disconnect(),e==="resize"&&Jq(n)}function Qq(n,e,t){const i=n.canvas,r=QN(a=>{n.ctx!==null&&t(Zq(a,n))},n,a=>{const l=a[0];return[l,l.offsetX,l.offsetY]});return jq(i,e,r),r}class eZ extends A4{acquireContext(e,t){const i=e&&e.getContext&&e.getContext("2d");return i&&i.canvas===e?(Hq(e,t),i):null}releaseContext(e){const t=e.canvas;if(!t[Yb])return!1;const i=t[Yb].initial;["height","width"].forEach(a=>{const l=i[a];_r(l)?t.removeAttribute(a):t.setAttribute(a,l)});const r=i.style||{};return Object.keys(r).forEach(a=>{t.style[a]=r[a]}),t.width=t.width,delete t[Yb],!0}addEventListener(e,t,i){this.removeEventListener(e,t);const r=e.$proxies||(e.$proxies={}),l={attach:$q,detach:Xq,resize:Kq}[t]||Qq;r[t]=l(e,t,i)}removeEventListener(e,t){const i=e.$proxies||(e.$proxies={}),r=i[t];if(!r)return;({attach:O2,detach:O2,resize:O2}[t]||qq)(e,t,r),i[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,i,r){return S7(e,t,i,r)}isAttached(e){const t=yP(e);return!!(t&&t.isConnected)}}function tZ(n){return!m4()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?Gq:eZ}class nZ{constructor(){this._init=[]}notify(e,t,i,r){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const a=r?this._descriptors(e).filter(r):this._descriptors(e),l=this._notify(a,e,t,i);return t==="afterDestroy"&&(this._notify(a,e,"stop"),this._notify(this._init,e,"uninstall")),l}_notify(e,t,i,r){r=r||{};for(const a of e){const l=a.plugin,s=l[i],d=[t,r,a.options];if(mr(s,d,l)===!1&&r.cancelable)return!1}return!0}invalidate(){_r(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const i=e&&e.config,r=Mi(i.options&&i.options.plugins,{}),a=iZ(i);return r===!1&&!t?[]:sZ(e,a,r,t)}_notifyStateChanges(e){const t=this._oldCache||[],i=this._cache,r=(a,l)=>a.filter(s=>!l.some(d=>s.plugin.id===d.plugin.id));this._notify(r(t,i),e,"stop"),this._notify(r(i,t),e,"start")}}function iZ(n){const e={},t=[],i=Object.keys(Ea.plugins.items);for(let a=0;a<i.length;a++)t.push(Ea.getPlugin(i[a]));const r=n.plugins||[];for(let a=0;a<r.length;a++){const l=r[a];t.indexOf(l)===-1&&(t.push(l),e[l.id]=!0)}return{plugins:t,localIds:e}}function rZ(n,e){return!e&&n===!1?null:n===!0?{}:n}function sZ(n,{plugins:e,localIds:t},i,r){const a=[],l=n.getContext();for(const s of e){const d=s.id,m=rZ(i[d],r);m!==null&&a.push({plugin:s,options:oZ(n.config,{plugin:s,local:t[d]},m,l)})}return a}function oZ(n,{plugin:e,local:t},i,r){const a=n.pluginScopeKeys(e),l=n.getOptionScopes(i,a);return t&&e.defaults&&l.push(e.defaults),n.createResolver(l,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function qA(n,e){const t=Fi.datasets[n]||{};return((e.datasets||{})[n]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function aZ(n,e){let t=n;return n==="_index_"?t=e:n==="_value_"&&(t=e==="x"?"y":"x"),t}function lZ(n,e){return n===e?"_index_":"_value_"}function cZ(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function ZA(n,e){return n==="x"||n==="y"?n:e.axis||cZ(e.position)||n.charAt(0).toLowerCase()}function uZ(n,e){const t=lg[n.type]||{scales:{}},i=e.scales||{},r=qA(n.type,e),a=Object.create(null),l=Object.create(null);return Object.keys(i).forEach(s=>{const d=i[s];if(!ar(d))return console.error(`Invalid scale configuration for scale: ${s}`);if(d._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${s}`);const m=ZA(s,d),_=lZ(m,r),S=t.scales||{};a[m]=a[m]||s,l[s]=Dx(Object.create(null),[{axis:m},d,S[m],S[_]])}),n.data.datasets.forEach(s=>{const d=s.type||n.type,m=s.indexAxis||qA(d,e),S=(lg[d]||{}).scales||{};Object.keys(S).forEach(T=>{const C=aZ(T,m),P=s[C+"AxisID"]||a[C]||C;l[P]=l[P]||Object.create(null),Dx(l[P],[{axis:C},i[P],S[T]])})}),Object.keys(l).forEach(s=>{const d=l[s];Dx(d,[Fi.scales[d.type],Fi.scale])}),l}function P4(n){const e=n.options||(n.options={});e.plugins=Mi(e.plugins,{}),e.scales=uZ(n,e)}function k4(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function hZ(n){return n=n||{},n.data=k4(n.data),P4(n),n}const VR=new Map,D4=new Set;function Uw(n,e){let t=VR.get(n);return t||(t=e(),VR.set(n,t),D4.add(t)),t}const q0=(n,e,t)=>{const i=gp(e,t);i!==void 0&&n.add(i)};class dZ{constructor(e){this._config=hZ(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=k4(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),P4(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Uw(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Uw(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Uw(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,i=this.type;return Uw(`${i}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const i=this._scopeCache;let r=i.get(e);return(!r||t)&&(r=new Map,i.set(e,r)),r}getOptionScopes(e,t,i){const{options:r,type:a}=this,l=this._cachedScopes(e,i),s=l.get(t);if(s)return s;const d=new Set;t.forEach(_=>{e&&(d.add(e),_.forEach(S=>q0(d,e,S))),_.forEach(S=>q0(d,r,S)),_.forEach(S=>q0(d,lg[a]||{},S)),_.forEach(S=>q0(d,Fi,S)),_.forEach(S=>q0(d,WA,S))});const m=Array.from(d);return m.length===0&&m.push(Object.create(null)),D4.has(t)&&l.set(t,m),m}chartOptionScopes(){const{options:e,type:t}=this;return[e,lg[t]||{},Fi.datasets[t]||{},{type:t},Fi,WA]}resolveNamedOptions(e,t,i,r=[""]){const a={$shared:!0},{resolver:l,subPrefixes:s}=GR(this._resolverCache,e,r);let d=l;if(pZ(l,t)){a.$shared=!1,i=_p(i)?i():i;const m=this.createResolver(e,i,s);d=my(l,i,m)}for(const m of t)a[m]=d[m];return a}createResolver(e,t,i=[""],r){const{resolver:a}=GR(this._resolverCache,e,i);return ar(t)?my(a,t,void 0,r):a}}function GR(n,e,t){let i=n.get(e);i||(i=new Map,n.set(e,i));const r=t.join();let a=i.get(r);return a||(a={resolver:mP(e,t),subPrefixes:t.filter(s=>!s.toLowerCase().includes("hover"))},i.set(r,a)),a}const fZ=n=>ar(n)&&Object.getOwnPropertyNames(n).reduce((e,t)=>e||_p(n[t]),!1);function pZ(n,e){const{isScriptable:t,isIndexable:i}=c4(n);for(const r of e){const a=t(r),l=i(r),s=(l||a)&&n[r];if(a&&(_p(s)||fZ(s))||l&&Lr(s))return!0}return!1}var mZ="3.9.1";const gZ=["top","bottom","left","right","chartArea"];function WR(n,e){return n==="top"||n==="bottom"||gZ.indexOf(n)===-1&&e==="x"}function HR(n,e){return function(t,i){return t[n]===i[n]?t[e]-i[e]:t[n]-i[n]}}function jR(n){const e=n.chart,t=e.options.animation;e.notifyPlugins("afterRender"),mr(t&&t.onComplete,[n],e)}function _Z(n){const e=n.chart,t=e.options.animation;mr(t&&t.onProgress,[n],e)}function L4(n){return m4()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const VS={},R4=n=>{const e=L4(n);return Object.values(VS).filter(t=>t.canvas===e).pop()};function yZ(n,e,t){const i=Object.keys(n);for(const r of i){const a=+r;if(a>=e){const l=n[r];delete n[r],(t>0||a>e)&&(n[a+t]=l)}}}function xZ(n,e,t,i){return!t||n.type==="mouseout"?null:i?e:n}let Ly=class{constructor(e,t){const i=this.config=new dZ(t),r=L4(e),a=R4(r);if(a)throw new Error("Canvas is already in use. Chart with ID '"+a.id+"' must be destroyed before the canvas with ID '"+a.canvas.id+"' can be reused.");const l=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||tZ(r)),this.platform.updateConfig(i);const s=this.platform.acquireContext(r,l.aspectRatio),d=s&&s.canvas,m=d&&d.height,_=d&&d.width;if(this.id=i9(),this.ctx=s,this.canvas=d,this.width=_,this.height=m,this._options=l,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new nZ,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=x9(S=>this.update(S),l.resizeDelay||0),this._dataChanges=[],VS[this.id]=this,!s||!d){console.error("Failed to create chart: can't acquire context from the given item");return}_d.listen(this,"complete",jR),_d.listen(this,"progress",_Z),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:i,height:r,_aspectRatio:a}=this;return _r(e)?t&&a?a:r?i/r:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():gR(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return fR(this.canvas,this.ctx),this}stop(){return _d.stop(this),this}resize(e,t){_d.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const i=this.options,r=this.canvas,a=i.maintainAspectRatio&&this.aspectRatio,l=this.platform.getMaximumSize(r,e,t,a),s=i.devicePixelRatio||this.platform.getDevicePixelRatio(),d=this.width?"resize":"attach";this.width=l.width,this.height=l.height,this._aspectRatio=this.aspectRatio,gR(this,s,!0)&&(this.notifyPlugins("resize",{size:l}),mr(i.onResize,[this,l],this),this.attached&&this._doResize(d)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};_i(t,(i,r)=>{i.id=r})}buildOrUpdateScales(){const e=this.options,t=e.scales,i=this.scales,r=Object.keys(i).reduce((l,s)=>(l[s]=!1,l),{});let a=[];t&&(a=a.concat(Object.keys(t).map(l=>{const s=t[l],d=ZA(l,s),m=d==="r",_=d==="x";return{options:s,dposition:m?"chartArea":_?"bottom":"left",dtype:m?"radialLinear":_?"category":"linear"}}))),_i(a,l=>{const s=l.options,d=s.id,m=ZA(d,s),_=Mi(s.type,l.dtype);(s.position===void 0||WR(s.position,m)!==WR(l.dposition))&&(s.position=l.dposition),r[d]=!0;let S=null;if(d in i&&i[d].type===_)S=i[d];else{const T=Ea.getScale(_);S=new T({id:d,type:_,ctx:this.ctx,chart:this}),i[S.id]=S}S.init(s,e)}),_i(r,(l,s)=>{l||delete i[s]}),_i(i,l=>{vc.configure(this,l,l.options),vc.addBox(this,l)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,i=e.length;if(e.sort((r,a)=>r.index-a.index),i>t){for(let r=t;r<i;++r)this._destroyDatasetMeta(r);e.splice(t,i-t)}this._sortedMetasets=e.slice(0).sort(HR("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((i,r)=>{t.filter(a=>a===i._dataset).length===0&&this._destroyDatasetMeta(r)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let i,r;for(this._removeUnreferencedMetasets(),i=0,r=t.length;i<r;i++){const a=t[i];let l=this.getDatasetMeta(i);const s=a.type||this.config.type;if(l.type&&l.type!==s&&(this._destroyDatasetMeta(i),l=this.getDatasetMeta(i)),l.type=s,l.indexAxis=a.indexAxis||qA(s,this.options),l.order=a.order||0,l.index=i,l.label=""+a.label,l.visible=this.isDatasetVisible(i),l.controller)l.controller.updateIndex(i),l.controller.linkScales();else{const d=Ea.getController(s),{datasetElementType:m,dataElementType:_}=Fi.datasets[s];Object.assign(d.prototype,{dataElementType:Ea.getElement(_),datasetElementType:m&&Ea.getElement(m)}),l.controller=new d(this,i),e.push(l.controller)}}return this._updateMetasets(),e}_resetElements(){_i(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const i=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),r=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const a=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let l=0;for(let m=0,_=this.data.datasets.length;m<_;m++){const{controller:S}=this.getDatasetMeta(m),T=!r&&a.indexOf(S)===-1;S.buildOrUpdateElements(T),l=Math.max(+S.getMaxOverflow(),l)}l=this._minPadding=i.layout.autoPadding?l:0,this._updateLayout(l),r||_i(a,m=>{m.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(HR("z","_idx"));const{_active:s,_lastEvent:d}=this;d?this._eventHandler(d,!0):s.length&&this._updateHoverStyles(s,s,!0),this.render()}_updateScales(){_i(this.scales,e=>{vc.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),i=new Set(e.events);(!tR(t,i)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:i,start:r,count:a}of t){const l=i==="_removeElements"?-a:a;yZ(e,r,l)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,i=a=>new Set(e.filter(l=>l[0]===a).map((l,s)=>s+","+l.splice(1).join(","))),r=i(0);for(let a=1;a<t;a++)if(!tR(r,i(a)))return;return Array.from(r).map(a=>a.split(",")).map(a=>({method:a[1],start:+a[2],count:+a[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;vc.update(this,this.width,this.height,e);const t=this.chartArea,i=t.width<=0||t.height<=0;this._layers=[],_i(this.boxes,r=>{i&&r.position==="chartArea"||(r.configure&&r.configure(),this._layers.push(...r._layers()))},this),this._layers.forEach((r,a)=>{r._idx=a}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,i=this.data.datasets.length;t<i;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,i=this.data.datasets.length;t<i;++t)this._updateDataset(t,_p(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const i=this.getDatasetMeta(e),r={meta:i,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",r)!==!1&&(i.controller._update(t),r.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",r))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(_d.has(this)?this.attached&&!_d.running(this)&&_d.start(this):(this.draw(),jR({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:i,height:r}=this._resizeBeforeDraw;this._resize(i,r),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,i=[];let r,a;for(r=0,a=t.length;r<a;++r){const l=t[r];(!e||l.visible)&&i.push(l)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,i=e._clip,r=!i.disabled,a=this.chartArea,l={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",l)!==!1&&(r&&$v(t,{left:i.left===!1?0:a.left-i.left,right:i.right===!1?this.width:a.right+i.right,top:i.top===!1?0:a.top-i.top,bottom:i.bottom===!1?this.height:a.bottom+i.bottom}),e.controller.draw(),r&&Xv(t),l.cancelable=!1,this.notifyPlugins("afterDatasetDraw",l))}isPointInArea(e){return fv(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,i,r){const a=Rq.modes[t];return typeof a=="function"?a(this,e,i,r):[]}getDatasetMeta(e){const t=this.data.datasets[e],i=this._metasets;let r=i.filter(a=>a&&a._dataset===t).pop();return r||(r={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},i.push(r)),r}getContext(){return this.$context||(this.$context=Ap(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const i=this.getDatasetMeta(e);return typeof i.hidden=="boolean"?!i.hidden:!t.hidden}setDatasetVisibility(e,t){const i=this.getDatasetMeta(e);i.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,i){const r=i?"show":"hide",a=this.getDatasetMeta(e),l=a.controller._resolveAnimations(void 0,r);Cc(t)?(a.data[t].hidden=!i,this.update()):(this.setDatasetVisibility(e,i),l.update(a,{visible:i}),this.update(s=>s.datasetIndex===e?r:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),_d.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),fR(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete VS[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,i=(a,l)=>{t.addEventListener(this,a,l),e[a]=l},r=(a,l,s)=>{a.offsetX=l,a.offsetY=s,this._eventHandler(a)};_i(this.options.events,a=>i(a,r))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,i=(d,m)=>{t.addEventListener(this,d,m),e[d]=m},r=(d,m)=>{e[d]&&(t.removeEventListener(this,d,m),delete e[d])},a=(d,m)=>{this.canvas&&this.resize(d,m)};let l;const s=()=>{r("attach",s),this.attached=!0,this.resize(),i("resize",a),i("detach",l)};l=()=>{this.attached=!1,r("resize",a),this._stop(),this._resize(0,0),i("attach",s)},t.isAttached(this.canvas)?s():l()}unbindEvents(){_i(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},_i(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,i){const r=i?"set":"remove";let a,l,s,d;for(t==="dataset"&&(a=this.getDatasetMeta(e[0].datasetIndex),a.controller["_"+r+"DatasetHoverStyle"]()),s=0,d=e.length;s<d;++s){l=e[s];const m=l&&this.getDatasetMeta(l.datasetIndex).controller;m&&m[r+"HoverStyle"](l.element,l.datasetIndex,l.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],i=e.map(({datasetIndex:a,index:l})=>{const s=this.getDatasetMeta(a);if(!s)throw new Error("No dataset found at index "+a);return{datasetIndex:a,element:s.data[l],index:l}});!RS(i,t)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,t))}notifyPlugins(e,t,i){return this._plugins.notify(this,e,t,i)}_updateHoverStyles(e,t,i){const r=this.options.hover,a=(d,m)=>d.filter(_=>!m.some(S=>_.datasetIndex===S.datasetIndex&&_.index===S.index)),l=a(t,e),s=i?e:a(e,t);l.length&&this.updateHoverStyle(l,r.mode,!1),s.length&&r.mode&&this.updateHoverStyle(s,r.mode,!0)}_eventHandler(e,t){const i={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},r=l=>(l.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",i,r)===!1)return;const a=this._handleEvent(e,t,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,r),(a||i.changed)&&this.render(),this}_handleEvent(e,t,i){const{_active:r=[],options:a}=this,l=t,s=this._getActiveElements(e,r,i,l),d=c9(e),m=xZ(e,this._lastEvent,i,d);i&&(this._lastEvent=null,mr(a.onHover,[e,s,this],this),d&&mr(a.onClick,[e,s,this],this));const _=!RS(s,r);return(_||t)&&(this._active=s,this._updateHoverStyles(s,r,t)),this._lastEvent=m,_}_getActiveElements(e,t,i,r){if(e.type==="mouseout")return[];if(!i)return t;const a=this.options.hover;return this.getElementsAtEventForMode(e,a.mode,a,r)}};const qR=()=>_i(Ly.instances,n=>n._plugins.invalidate()),Af=!0;Object.defineProperties(Ly,{defaults:{enumerable:Af,value:Fi},instances:{enumerable:Af,value:VS},overrides:{enumerable:Af,value:lg},registry:{enumerable:Af,value:Ea},version:{enumerable:Af,value:mZ},getChart:{enumerable:Af,value:R4},register:{enumerable:Af,value:(...n)=>{Ea.add(...n),qR()}},unregister:{enumerable:Af,value:(...n)=>{Ea.remove(...n),qR()}}});function z4(n,e,t){const{startAngle:i,pixelMargin:r,x:a,y:l,outerRadius:s,innerRadius:d}=e;let m=r/s;n.beginPath(),n.arc(a,l,s,i-m,t+m),d>r?(m=r/d,n.arc(a,l,d,t+m,i-m,!0)):n.arc(a,l,r,t+vs,i-vs),n.closePath(),n.clip()}function vZ(n){return pP(n,["outerStart","outerEnd","innerStart","innerEnd"])}function wZ(n,e,t,i){const r=vZ(n.options.borderRadius),a=(t-e)/2,l=Math.min(a,i*e/2),s=d=>{const m=(t-Math.min(a,d))*i/2;return ca(d,0,Math.min(a,m))};return{outerStart:s(r.outerStart),outerEnd:s(r.outerEnd),innerStart:ca(r.innerStart,0,l),innerEnd:ca(r.innerEnd,0,l)}}function o_(n,e,t,i){return{x:t+n*Math.cos(e),y:i+n*Math.sin(e)}}function $A(n,e,t,i,r,a){const{x:l,y:s,startAngle:d,pixelMargin:m,innerRadius:_}=e,S=Math.max(e.outerRadius+i+t-m,0),T=_>0?_+i+t+m:0;let C=0;const P=r-d;if(i){const fe=_>0?_-i:0,Oe=S>0?S-i:0,We=(fe+Oe)/2,ce=We!==0?P*We/(We+i):P;C=(P-ce)/2}const k=Math.max(.001,P*S-t/Jr)/S,R=(P-k)/2,O=d+R+C,F=r-R-C,{outerStart:N,outerEnd:G,innerStart:j,innerEnd:Q}=wZ(e,T,S,F-O),re=S-N,$=S-G,ne=O+N/re,ue=F-G/$,De=T+j,$e=T+Q,ae=O+j/De,le=F-Q/$e;if(n.beginPath(),a){if(n.arc(l,s,S,ne,ue),G>0){const We=o_($,ue,l,s);n.arc(We.x,We.y,G,ue,F+vs)}const fe=o_($e,F,l,s);if(n.lineTo(fe.x,fe.y),Q>0){const We=o_($e,le,l,s);n.arc(We.x,We.y,Q,F+vs,le+Math.PI)}if(n.arc(l,s,T,F-Q/T,O+j/T,!0),j>0){const We=o_(De,ae,l,s);n.arc(We.x,We.y,j,ae+Math.PI,O-vs)}const Oe=o_(re,O,l,s);if(n.lineTo(Oe.x,Oe.y),N>0){const We=o_(re,ne,l,s);n.arc(We.x,We.y,N,O-vs,ne)}}else{n.moveTo(l,s);const fe=Math.cos(ne)*S+l,Oe=Math.sin(ne)*S+s;n.lineTo(fe,Oe);const We=Math.cos(ue)*S+l,ce=Math.sin(ue)*S+s;n.lineTo(We,ce)}n.closePath()}function bZ(n,e,t,i,r){const{fullCircles:a,startAngle:l,circumference:s}=e;let d=e.endAngle;if(a){$A(n,e,t,i,l+Rr,r);for(let m=0;m<a;++m)n.fill();isNaN(s)||(d=l+s%Rr,s%Rr===0&&(d+=Rr))}return $A(n,e,t,i,d,r),n.fill(),d}function SZ(n,e,t){const{x:i,y:r,startAngle:a,pixelMargin:l,fullCircles:s}=e,d=Math.max(e.outerRadius-l,0),m=e.innerRadius+l;let _;for(t&&z4(n,e,a+Rr),n.beginPath(),n.arc(i,r,m,a+Rr,a,!0),_=0;_<s;++_)n.stroke();for(n.beginPath(),n.arc(i,r,d,a,a+Rr),_=0;_<s;++_)n.stroke()}function MZ(n,e,t,i,r,a){const{options:l}=e,{borderWidth:s,borderJoinStyle:d}=l,m=l.borderAlign==="inner";s&&(m?(n.lineWidth=s*2,n.lineJoin=d||"round"):(n.lineWidth=s,n.lineJoin=d||"bevel"),e.fullCircles&&SZ(n,e,m),m&&z4(n,e,r),$A(n,e,t,i,r,a),n.stroke())}class MP extends ku{constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,i){const r=this.getProps(["x","y"],i),{angle:a,distance:l}=YN(r,{x:e,y:t}),{startAngle:s,endAngle:d,innerRadius:m,outerRadius:_,circumference:S}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),T=this.options.spacing/2,P=Mi(S,d-s)>=Rr||dv(a,s,d),k=qf(l,m+T,_+T);return P&&k}getCenterPoint(e){const{x:t,y:i,startAngle:r,endAngle:a,innerRadius:l,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],e),{offset:d,spacing:m}=this.options,_=(r+a)/2,S=(l+s+m+d)/2;return{x:t+Math.cos(_)*S,y:i+Math.sin(_)*S}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:i}=this,r=(t.offset||0)/2,a=(t.spacing||0)/2,l=t.circular;if(this.pixelMargin=t.borderAlign==="inner"?.33:0,this.fullCircles=i>Rr?Math.floor(i/Rr):0,i===0||this.innerRadius<0||this.outerRadius<0)return;e.save();let s=0;if(r){s=r/2;const m=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(m)*s,Math.sin(m)*s),this.circumference>=Jr&&(s=r)}e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor;const d=bZ(e,this,s,a,l);MZ(e,this,s,a,d,l),e.restore()}}MP.id="arc";MP.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};MP.defaultRoutes={backgroundColor:"backgroundColor"};function O4(n,e,t=e){n.lineCap=Mi(t.borderCapStyle,e.borderCapStyle),n.setLineDash(Mi(t.borderDash,e.borderDash)),n.lineDashOffset=Mi(t.borderDashOffset,e.borderDashOffset),n.lineJoin=Mi(t.borderJoinStyle,e.borderJoinStyle),n.lineWidth=Mi(t.borderWidth,e.borderWidth),n.strokeStyle=Mi(t.borderColor,e.borderColor)}function TZ(n,e,t){n.lineTo(t.x,t.y)}function EZ(n){return n.stepped?Z9:n.tension||n.cubicInterpolationMode==="monotone"?$9:TZ}function F4(n,e,t={}){const i=n.length,{start:r=0,end:a=i-1}=t,{start:l,end:s}=e,d=Math.max(r,l),m=Math.min(a,s),_=r<l&&a<l||r>s&&a>s;return{count:i,start:d,loop:e.loop,ilen:m<d&&!_?i+m-d:m-d}}function AZ(n,e,t,i){const{points:r,options:a}=e,{count:l,start:s,loop:d,ilen:m}=F4(r,t,i),_=EZ(a);let{move:S=!0,reverse:T}=i||{},C,P,k;for(C=0;C<=m;++C)P=r[(s+(T?m-C:C))%l],!P.skip&&(S?(n.moveTo(P.x,P.y),S=!1):_(n,k,P,T,a.stepped),k=P);return d&&(P=r[(s+(T?m:0))%l],_(n,k,P,T,a.stepped)),!!d}function CZ(n,e,t,i){const r=e.points,{count:a,start:l,ilen:s}=F4(r,t,i),{move:d=!0,reverse:m}=i||{};let _=0,S=0,T,C,P,k,R,O;const F=G=>(l+(m?s-G:G))%a,N=()=>{k!==R&&(n.lineTo(_,R),n.lineTo(_,k),n.lineTo(_,O))};for(d&&(C=r[F(0)],n.moveTo(C.x,C.y)),T=0;T<=s;++T){if(C=r[F(T)],C.skip)continue;const G=C.x,j=C.y,Q=G|0;Q===P?(j<k?k=j:j>R&&(R=j),_=(S*_+G)/++S):(N(),n.lineTo(G,j),P=Q,S=0,k=R=j),O=j}N()}function XA(n){const e=n.options,t=e.borderDash&&e.borderDash.length;return!n._decimated&&!n._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?CZ:AZ}function IZ(n){return n.stepped?T7:n.tension||n.cubicInterpolationMode==="monotone"?E7:Tm}function PZ(n,e,t,i){let r=e._path;r||(r=e._path=new Path2D,e.path(r,t,i)&&r.closePath()),O4(n,e.options),n.stroke(r)}function kZ(n,e,t,i){const{segments:r,options:a}=e,l=XA(e);for(const s of r)O4(n,a,s.style),n.beginPath(),l(n,e,s,{start:t,end:t+i-1})&&n.closePath(),n.stroke()}const DZ=typeof Path2D=="function";function LZ(n,e,t,i){DZ&&!e.options.segment?PZ(n,e,t,i):kZ(n,e,t,i)}class Qv extends ku{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const r=i.spanGaps?this._loop:this._fullLoop;_7(this._points,i,e,r,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=z7(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,i=e.length;return i&&t[e[i-1].end]}interpolate(e,t){const i=this.options,r=e[t],a=this.points,l=D7(this,{property:t,start:r,end:r});if(!l.length)return;const s=[],d=IZ(i);let m,_;for(m=0,_=l.length;m<_;++m){const{start:S,end:T}=l[m],C=a[S],P=a[T];if(C===P){s.push(C);continue}const k=Math.abs((r-C[t])/(P[t]-C[t])),R=d(C,P,k,i.stepped);R[t]=e[t],s.push(R)}return s.length===1?s[0]:s}pathSegment(e,t,i){return XA(this)(e,this,t,i)}path(e,t,i){const r=this.segments,a=XA(this);let l=this._loop;t=t||0,i=i||this.points.length-t;for(const s of r)l&=a(e,this,s,{start:t,end:t+i-1});return!!l}draw(e,t,i,r){const a=this.options||{};(this.points||[]).length&&a.borderWidth&&(e.save(),LZ(e,this,i,r),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Qv.id="line";Qv.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};Qv.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};Qv.descriptors={_scriptable:!0,_indexable:n=>n!=="borderDash"&&n!=="fill"};function ZR(n,e,t,i){const r=n.options,{[t]:a}=n.getProps([t],i);return Math.abs(e-a)<r.radius+r.hitRadius}class IM extends ku{constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,i){const r=this.options,{x:a,y:l}=this.getProps(["x","y"],i);return Math.pow(e-a,2)+Math.pow(t-l,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,t){return ZR(this,e,"x",t)}inYRange(e,t){return ZR(this,e,"y",t)}getCenterPoint(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}size(e){e=e||this.options||{};let t=e.radius||0;t=Math.max(t,t&&e.hoverRadius||0);const i=t&&e.borderWidth||0;return(t+i)*2}draw(e,t){const i=this.options;this.skip||i.radius<.1||!fv(this,t,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,HA(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}IM.id="point";IM.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};IM.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};function B4(n,e){const{x:t,y:i,base:r,width:a,height:l}=n.getProps(["x","y","base","width","height"],e);let s,d,m,_,S;return n.horizontal?(S=l/2,s=Math.min(t,r),d=Math.max(t,r),m=i-S,_=i+S):(S=a/2,s=t-S,d=t+S,m=Math.min(i,r),_=Math.max(i,r)),{left:s,top:m,right:d,bottom:_}}function $f(n,e,t,i){return n?0:ca(e,t,i)}function RZ(n,e,t){const i=n.options.borderWidth,r=n.borderSkipped,a=l4(i);return{t:$f(r.top,a.top,0,t),r:$f(r.right,a.right,0,e),b:$f(r.bottom,a.bottom,0,t),l:$f(r.left,a.left,0,e)}}function zZ(n,e,t){const{enableBorderRadius:i}=n.getProps(["enableBorderRadius"]),r=n.options.borderRadius,a=jm(r),l=Math.min(e,t),s=n.borderSkipped,d=i||ar(r);return{topLeft:$f(!d||s.top||s.left,a.topLeft,0,l),topRight:$f(!d||s.top||s.right,a.topRight,0,l),bottomLeft:$f(!d||s.bottom||s.left,a.bottomLeft,0,l),bottomRight:$f(!d||s.bottom||s.right,a.bottomRight,0,l)}}function OZ(n){const e=B4(n),t=e.right-e.left,i=e.bottom-e.top,r=RZ(n,t/2,i/2),a=zZ(n,t/2,i/2);return{outer:{x:e.left,y:e.top,w:t,h:i,radius:a},inner:{x:e.left+r.l,y:e.top+r.t,w:t-r.l-r.r,h:i-r.t-r.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,a.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(r.b,r.r))}}}}function F2(n,e,t,i){const r=e===null,a=t===null,s=n&&!(r&&a)&&B4(n,i);return s&&(r||qf(e,s.left,s.right))&&(a||qf(t,s.top,s.bottom))}function FZ(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function BZ(n,e){n.rect(e.x,e.y,e.w,e.h)}function B2(n,e,t={}){const i=n.x!==t.x?-e:0,r=n.y!==t.y?-e:0,a=(n.x+n.w!==t.x+t.w?e:0)-i,l=(n.y+n.h!==t.y+t.h?e:0)-r;return{x:n.x+i,y:n.y+r,w:n.w+a,h:n.h+l,radius:n.radius}}class TP extends ku{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:i,backgroundColor:r}}=this,{inner:a,outer:l}=OZ(this),s=FZ(l.radius)?pv:BZ;e.save(),(l.w!==a.w||l.h!==a.h)&&(e.beginPath(),s(e,B2(l,t,a)),e.clip(),s(e,B2(a,-t,l)),e.fillStyle=i,e.fill("evenodd")),e.beginPath(),s(e,B2(a,t)),e.fillStyle=r,e.fill(),e.restore()}inRange(e,t,i){return F2(this,e,t,i)}inXRange(e,t){return F2(this,e,null,t)}inYRange(e,t){return F2(this,null,e,t)}getCenterPoint(e){const{x:t,y:i,base:r,horizontal:a}=this.getProps(["x","y","base","horizontal"],e);return{x:a?(t+r)/2:t,y:a?i:(i+r)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}TP.id="bar";TP.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};TP.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};const $R=(n,e)=>{let{boxHeight:t=e,boxWidth:i=e}=n;return n.usePointStyle&&(t=Math.min(t,e),i=n.pointStyleWidth||Math.min(i,e)),{boxWidth:i,boxHeight:t,itemHeight:Math.max(e,t)}},NZ=(n,e)=>n!==null&&e!==null&&n.datasetIndex===e.datasetIndex&&n.index===e.index;class XR extends ku{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,i){this.maxWidth=e,this.maxHeight=t,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=mr(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(i=>e.filter(i,this.chart.data))),e.sort&&(t=t.sort((i,r)=>e.sort(i,r,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const i=e.labels,r=ro(i.font),a=r.size,l=this._computeTitleHeight(),{boxWidth:s,itemHeight:d}=$R(i,a);let m,_;t.font=r.string,this.isHorizontal()?(m=this.maxWidth,_=this._fitRows(l,a,s,d)+10):(_=this.maxHeight,m=this._fitCols(l,a,s,d)+10),this.width=Math.min(m,e.maxWidth||this.maxWidth),this.height=Math.min(_,e.maxHeight||this.maxHeight)}_fitRows(e,t,i,r){const{ctx:a,maxWidth:l,options:{labels:{padding:s}}}=this,d=this.legendHitBoxes=[],m=this.lineWidths=[0],_=r+s;let S=e;a.textAlign="left",a.textBaseline="middle";let T=-1,C=-_;return this.legendItems.forEach((P,k)=>{const R=i+t/2+a.measureText(P.text).width;(k===0||m[m.length-1]+R+2*s>l)&&(S+=_,m[m.length-(k>0?0:1)]=0,C+=_,T++),d[k]={left:0,top:C,row:T,width:R,height:r},m[m.length-1]+=R+s}),S}_fitCols(e,t,i,r){const{ctx:a,maxHeight:l,options:{labels:{padding:s}}}=this,d=this.legendHitBoxes=[],m=this.columnSizes=[],_=l-e;let S=s,T=0,C=0,P=0,k=0;return this.legendItems.forEach((R,O)=>{const F=i+t/2+a.measureText(R.text).width;O>0&&C+r+2*s>_&&(S+=T+s,m.push({width:T,height:C}),P+=T+s,k++,T=C=0),d[O]={left:P,top:C,col:k,width:F,height:r},T=Math.max(T,F),C+=r+s}),S+=T,m.push({width:T,height:C}),S}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:i,labels:{padding:r},rtl:a}}=this,l=ey(a,this.left,this.width);if(this.isHorizontal()){let s=0,d=ra(i,this.left+r,this.right-this.lineWidths[s]);for(const m of t)s!==m.row&&(s=m.row,d=ra(i,this.left+r,this.right-this.lineWidths[s])),m.top+=this.top+e+r,m.left=l.leftForLtr(l.x(d),m.width),d+=m.width+r}else{let s=0,d=ra(i,this.top+e+r,this.bottom-this.columnSizes[s].height);for(const m of t)m.col!==s&&(s=m.col,d=ra(i,this.top+e+r,this.bottom-this.columnSizes[s].height)),m.top=d,m.left+=this.left+r,m.left=l.leftForLtr(l.x(m.left),m.width),d+=m.height+r}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;$v(e,this),this._draw(),Xv(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:i,ctx:r}=this,{align:a,labels:l}=e,s=Fi.color,d=ey(e.rtl,this.left,this.width),m=ro(l.font),{color:_,padding:S}=l,T=m.size,C=T/2;let P;this.drawTitle(),r.textAlign=d.textAlign("left"),r.textBaseline="middle",r.lineWidth=.5,r.font=m.string;const{boxWidth:k,boxHeight:R,itemHeight:O}=$R(l,T),F=function(re,$,ne){if(isNaN(k)||k<=0||isNaN(R)||R<0)return;r.save();const ue=Mi(ne.lineWidth,1);if(r.fillStyle=Mi(ne.fillStyle,s),r.lineCap=Mi(ne.lineCap,"butt"),r.lineDashOffset=Mi(ne.lineDashOffset,0),r.lineJoin=Mi(ne.lineJoin,"miter"),r.lineWidth=ue,r.strokeStyle=Mi(ne.strokeStyle,s),r.setLineDash(Mi(ne.lineDash,[])),l.usePointStyle){const De={radius:R*Math.SQRT2/2,pointStyle:ne.pointStyle,rotation:ne.rotation,borderWidth:ue},$e=d.xPlus(re,k/2),ae=$+C;a4(r,De,$e,ae,l.pointStyleWidth&&k)}else{const De=$+Math.max((T-R)/2,0),$e=d.leftForLtr(re,k),ae=jm(ne.borderRadius);r.beginPath(),Object.values(ae).some(le=>le!==0)?pv(r,{x:$e,y:De,w:k,h:R,radius:ae}):r.rect($e,De,k,R),r.fill(),ue!==0&&r.stroke()}r.restore()},N=function(re,$,ne){cg(r,ne.text,re,$+O/2,m,{strikethrough:ne.hidden,textAlign:d.textAlign(ne.textAlign)})},G=this.isHorizontal(),j=this._computeTitleHeight();G?P={x:ra(a,this.left+S,this.right-i[0]),y:this.top+S+j,line:0}:P={x:this.left+S,y:ra(a,this.top+j+S,this.bottom-t[0].height),line:0},g4(this.ctx,e.textDirection);const Q=O+S;this.legendItems.forEach((re,$)=>{r.strokeStyle=re.fontColor||_,r.fillStyle=re.fontColor||_;const ne=r.measureText(re.text).width,ue=d.textAlign(re.textAlign||(re.textAlign=l.textAlign)),De=k+C+ne;let $e=P.x,ae=P.y;d.setWidth(this.width),G?$>0&&$e+De+S>this.right&&(ae=P.y+=Q,P.line++,$e=P.x=ra(a,this.left+S,this.right-i[P.line])):$>0&&ae+Q>this.bottom&&($e=P.x=$e+t[P.line].width+S,P.line++,ae=P.y=ra(a,this.top+j+S,this.bottom-t[P.line].height));const le=d.x($e);F(le,ae,re),$e=v9(ue,$e+k+C,G?$e+De:this.right,e.rtl),N(d.x($e),ae,re),G?P.x+=De+S:P.y+=Q}),_4(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,i=ro(t.font),r=pa(t.padding);if(!t.display)return;const a=ey(e.rtl,this.left,this.width),l=this.ctx,s=t.position,d=i.size/2,m=r.top+d;let _,S=this.left,T=this.width;if(this.isHorizontal())T=Math.max(...this.lineWidths),_=this.top+m,S=ra(e.align,S,this.right-T);else{const P=this.columnSizes.reduce((k,R)=>Math.max(k,R.height),0);_=m+ra(e.align,this.top,this.bottom-P-e.labels.padding-this._computeTitleHeight())}const C=ra(s,S,S+T);l.textAlign=a.textAlign(uP(s)),l.textBaseline="middle",l.strokeStyle=t.color,l.fillStyle=t.color,l.font=i.string,cg(l,t.text,C,_,i)}_computeTitleHeight(){const e=this.options.title,t=ro(e.font),i=pa(e.padding);return e.display?t.lineHeight+i.height:0}_getLegendItemAt(e,t){let i,r,a;if(qf(e,this.left,this.right)&&qf(t,this.top,this.bottom)){for(a=this.legendHitBoxes,i=0;i<a.length;++i)if(r=a[i],qf(e,r.left,r.left+r.width)&&qf(t,r.top,r.top+r.height))return this.legendItems[i]}return null}handleEvent(e){const t=this.options;if(!UZ(e.type,t))return;const i=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const r=this._hoveredItem,a=NZ(r,i);r&&!a&&mr(t.onLeave,[e,r,this],this),this._hoveredItem=i,i&&!a&&mr(t.onHover,[e,i,this],this)}else i&&mr(t.onClick,[e,i,this],this)}}function UZ(n,e){return!!((n==="mousemove"||n==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(n==="click"||n==="mouseup"))}var VZ={id:"legend",_element:XR,start(n,e,t){const i=n.legend=new XR({ctx:n.ctx,options:t,chart:n});vc.configure(n,i,t),vc.addBox(n,i)},stop(n){vc.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,e,t){const i=n.legend;vc.configure(n,i,t),i.options=t},afterUpdate(n){const e=n.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(n,e){e.replay||n.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,e,t){const i=e.datasetIndex,r=t.chart;r.isDatasetVisible(i)?(r.hide(i),e.hidden=!0):(r.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const e=n.data.datasets,{labels:{usePointStyle:t,pointStyle:i,textAlign:r,color:a}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const s=l.controller.getStyle(t?0:void 0),d=pa(s.borderWidth);return{text:e[l.index].label,fillStyle:s.backgroundColor,fontColor:a,hidden:!l.visible,lineCap:s.borderCapStyle,lineDash:s.borderDash,lineDashOffset:s.borderDashOffset,lineJoin:s.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:s.borderColor,pointStyle:i||s.pointStyle,rotation:s.rotation,textAlign:r||s.textAlign,borderRadius:0,datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class N4 extends ku{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const r=Lr(i.text)?i.text.length:1;this._padding=pa(i.padding);const a=r*ro(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=a:this.width=a}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:i,bottom:r,right:a,options:l}=this,s=l.align;let d=0,m,_,S;return this.isHorizontal()?(_=ra(s,i,a),S=t+e,m=a-i):(l.position==="left"?(_=i+e,S=ra(s,r,t),d=Jr*-.5):(_=a-e,S=ra(s,t,r),d=Jr*.5),m=r-t),{titleX:_,titleY:S,maxWidth:m,rotation:d}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const i=ro(t.font),a=i.lineHeight/2+this._padding.top,{titleX:l,titleY:s,maxWidth:d,rotation:m}=this._drawArgs(a);cg(e,t.text,0,0,i,{color:t.color,maxWidth:d,rotation:m,textAlign:uP(t.align),textBaseline:"middle",translation:[l,s]})}}function GZ(n,e){const t=new N4({ctx:n.ctx,options:e,chart:n});vc.configure(n,t,e),vc.addBox(n,t),n.titleBlock=t}var WZ={id:"title",_element:N4,start(n,e,t){GZ(n,t)},stop(n){const e=n.titleBlock;vc.removeBox(n,e),delete n.titleBlock},beforeUpdate(n,e,t){const i=n.titleBlock;vc.configure(n,i,t),i.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ox={average(n){if(!n.length)return!1;let e,t,i=0,r=0,a=0;for(e=0,t=n.length;e<t;++e){const l=n[e].element;if(l&&l.hasValue()){const s=l.tooltipPosition();i+=s.x,r+=s.y,++a}}return{x:i/a,y:r/a}},nearest(n,e){if(!n.length)return!1;let t=e.x,i=e.y,r=Number.POSITIVE_INFINITY,a,l,s;for(a=0,l=n.length;a<l;++a){const d=n[a].element;if(d&&d.hasValue()){const m=d.getCenterPoint(),_=UA(e,m);_<r&&(r=_,s=d)}}if(s){const d=s.tooltipPosition();t=d.x,i=d.y}return{x:t,y:i}}};function fh(n,e){return e&&(Lr(e)?Array.prototype.push.apply(n,e):n.push(e)),n}function yd(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function HZ(n,e){const{element:t,datasetIndex:i,index:r}=e,a=n.getDatasetMeta(i).controller,{label:l,value:s}=a.getLabelAndValue(r);return{chart:n,label:l,parsed:a.getParsed(r),raw:n.data.datasets[i].data[r],formattedValue:s,dataset:a.getDataset(),dataIndex:r,datasetIndex:i,element:t}}function YR(n,e){const t=n.chart.ctx,{body:i,footer:r,title:a}=n,{boxWidth:l,boxHeight:s}=e,d=ro(e.bodyFont),m=ro(e.titleFont),_=ro(e.footerFont),S=a.length,T=r.length,C=i.length,P=pa(e.padding);let k=P.height,R=0,O=i.reduce((G,j)=>G+j.before.length+j.lines.length+j.after.length,0);if(O+=n.beforeBody.length+n.afterBody.length,S&&(k+=S*m.lineHeight+(S-1)*e.titleSpacing+e.titleMarginBottom),O){const G=e.displayColors?Math.max(s,d.lineHeight):d.lineHeight;k+=C*G+(O-C)*d.lineHeight+(O-1)*e.bodySpacing}T&&(k+=e.footerMarginTop+T*_.lineHeight+(T-1)*e.footerSpacing);let F=0;const N=function(G){R=Math.max(R,t.measureText(G).width+F)};return t.save(),t.font=m.string,_i(n.title,N),t.font=d.string,_i(n.beforeBody.concat(n.afterBody),N),F=e.displayColors?l+2+e.boxPadding:0,_i(i,G=>{_i(G.before,N),_i(G.lines,N),_i(G.after,N)}),F=0,t.font=_.string,_i(n.footer,N),t.restore(),R+=P.width,{width:R,height:k}}function jZ(n,e){const{y:t,height:i}=e;return t<i/2?"top":t>n.height-i/2?"bottom":"center"}function qZ(n,e,t,i){const{x:r,width:a}=i,l=t.caretSize+t.caretPadding;if(n==="left"&&r+a+l>e.width||n==="right"&&r-a-l<0)return!0}function ZZ(n,e,t,i){const{x:r,width:a}=t,{width:l,chartArea:{left:s,right:d}}=n;let m="center";return i==="center"?m=r<=(s+d)/2?"left":"right":r<=a/2?m="left":r>=l-a/2&&(m="right"),qZ(m,n,e,t)&&(m="center"),m}function JR(n,e,t){const i=t.yAlign||e.yAlign||jZ(n,t);return{xAlign:t.xAlign||e.xAlign||ZZ(n,e,t,i),yAlign:i}}function $Z(n,e){let{x:t,width:i}=n;return e==="right"?t-=i:e==="center"&&(t-=i/2),t}function XZ(n,e,t){let{y:i,height:r}=n;return e==="top"?i+=t:e==="bottom"?i-=r+t:i-=r/2,i}function KR(n,e,t,i){const{caretSize:r,caretPadding:a,cornerRadius:l}=n,{xAlign:s,yAlign:d}=t,m=r+a,{topLeft:_,topRight:S,bottomLeft:T,bottomRight:C}=jm(l);let P=$Z(e,s);const k=XZ(e,d,m);return d==="center"?s==="left"?P+=m:s==="right"&&(P-=m):s==="left"?P-=Math.max(_,T)+r:s==="right"&&(P+=Math.max(S,C)+r),{x:ca(P,0,i.width-e.width),y:ca(k,0,i.height-e.height)}}function Vw(n,e,t){const i=pa(t.padding);return e==="center"?n.x+n.width/2:e==="right"?n.x+n.width-i.right:n.x+i.left}function QR(n){return fh([],yd(n))}function YZ(n,e,t){return Ap(n,{tooltip:e,tooltipItems:t,type:"tooltip"})}function ez(n,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?n.override(t):n}class YA extends ku{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart||e._chart,this._chart=this.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,i=this.options.setContext(this.getContext()),r=i.enabled&&t.options.animation&&i.animations,a=new x4(this.chart,r);return r._cacheable&&(this._cachedAnimations=Object.freeze(a)),a}getContext(){return this.$context||(this.$context=YZ(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:i}=t,r=i.beforeTitle.apply(this,[e]),a=i.title.apply(this,[e]),l=i.afterTitle.apply(this,[e]);let s=[];return s=fh(s,yd(r)),s=fh(s,yd(a)),s=fh(s,yd(l)),s}getBeforeBody(e,t){return QR(t.callbacks.beforeBody.apply(this,[e]))}getBody(e,t){const{callbacks:i}=t,r=[];return _i(e,a=>{const l={before:[],lines:[],after:[]},s=ez(i,a);fh(l.before,yd(s.beforeLabel.call(this,a))),fh(l.lines,s.label.call(this,a)),fh(l.after,yd(s.afterLabel.call(this,a))),r.push(l)}),r}getAfterBody(e,t){return QR(t.callbacks.afterBody.apply(this,[e]))}getFooter(e,t){const{callbacks:i}=t,r=i.beforeFooter.apply(this,[e]),a=i.footer.apply(this,[e]),l=i.afterFooter.apply(this,[e]);let s=[];return s=fh(s,yd(r)),s=fh(s,yd(a)),s=fh(s,yd(l)),s}_createItems(e){const t=this._active,i=this.chart.data,r=[],a=[],l=[];let s=[],d,m;for(d=0,m=t.length;d<m;++d)s.push(HZ(this.chart,t[d]));return e.filter&&(s=s.filter((_,S,T)=>e.filter(_,S,T,i))),e.itemSort&&(s=s.sort((_,S)=>e.itemSort(_,S,i))),_i(s,_=>{const S=ez(e.callbacks,_);r.push(S.labelColor.call(this,_)),a.push(S.labelPointStyle.call(this,_)),l.push(S.labelTextColor.call(this,_))}),this.labelColors=r,this.labelPointStyles=a,this.labelTextColors=l,this.dataPoints=s,s}update(e,t){const i=this.options.setContext(this.getContext()),r=this._active;let a,l=[];if(!r.length)this.opacity!==0&&(a={opacity:0});else{const s=Ox[i.position].call(this,r,this._eventPosition);l=this._createItems(i),this.title=this.getTitle(l,i),this.beforeBody=this.getBeforeBody(l,i),this.body=this.getBody(l,i),this.afterBody=this.getAfterBody(l,i),this.footer=this.getFooter(l,i);const d=this._size=YR(this,i),m=Object.assign({},s,d),_=JR(this.chart,i,m),S=KR(i,m,_,this.chart);this.xAlign=_.xAlign,this.yAlign=_.yAlign,a={opacity:1,x:S.x,y:S.y,width:d.width,height:d.height,caretX:s.x,caretY:s.y}}this._tooltipItems=l,this.$context=void 0,a&&this._resolveAnimations().update(this,a),e&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,i,r){const a=this.getCaretPosition(e,i,r);t.lineTo(a.x1,a.y1),t.lineTo(a.x2,a.y2),t.lineTo(a.x3,a.y3)}getCaretPosition(e,t,i){const{xAlign:r,yAlign:a}=this,{caretSize:l,cornerRadius:s}=i,{topLeft:d,topRight:m,bottomLeft:_,bottomRight:S}=jm(s),{x:T,y:C}=e,{width:P,height:k}=t;let R,O,F,N,G,j;return a==="center"?(G=C+k/2,r==="left"?(R=T,O=R-l,N=G+l,j=G-l):(R=T+P,O=R+l,N=G-l,j=G+l),F=R):(r==="left"?O=T+Math.max(d,_)+l:r==="right"?O=T+P-Math.max(m,S)-l:O=this.caretX,a==="top"?(N=C,G=N-l,R=O-l,F=O+l):(N=C+k,G=N+l,R=O+l,F=O-l),j=N),{x1:R,x2:O,x3:F,y1:N,y2:G,y3:j}}drawTitle(e,t,i){const r=this.title,a=r.length;let l,s,d;if(a){const m=ey(i.rtl,this.x,this.width);for(e.x=Vw(this,i.titleAlign,i),t.textAlign=m.textAlign(i.titleAlign),t.textBaseline="middle",l=ro(i.titleFont),s=i.titleSpacing,t.fillStyle=i.titleColor,t.font=l.string,d=0;d<a;++d)t.fillText(r[d],m.x(e.x),e.y+l.lineHeight/2),e.y+=l.lineHeight+s,d+1===a&&(e.y+=i.titleMarginBottom-s)}}_drawColorBox(e,t,i,r,a){const l=this.labelColors[i],s=this.labelPointStyles[i],{boxHeight:d,boxWidth:m,boxPadding:_}=a,S=ro(a.bodyFont),T=Vw(this,"left",a),C=r.x(T),P=d<S.lineHeight?(S.lineHeight-d)/2:0,k=t.y+P;if(a.usePointStyle){const R={radius:Math.min(m,d)/2,pointStyle:s.pointStyle,rotation:s.rotation,borderWidth:1},O=r.leftForLtr(C,m)+m/2,F=k+d/2;e.strokeStyle=a.multiKeyBackground,e.fillStyle=a.multiKeyBackground,HA(e,R,O,F),e.strokeStyle=l.borderColor,e.fillStyle=l.backgroundColor,HA(e,R,O,F)}else{e.lineWidth=ar(l.borderWidth)?Math.max(...Object.values(l.borderWidth)):l.borderWidth||1,e.strokeStyle=l.borderColor,e.setLineDash(l.borderDash||[]),e.lineDashOffset=l.borderDashOffset||0;const R=r.leftForLtr(C,m-_),O=r.leftForLtr(r.xPlus(C,1),m-_-2),F=jm(l.borderRadius);Object.values(F).some(N=>N!==0)?(e.beginPath(),e.fillStyle=a.multiKeyBackground,pv(e,{x:R,y:k,w:m,h:d,radius:F}),e.fill(),e.stroke(),e.fillStyle=l.backgroundColor,e.beginPath(),pv(e,{x:O,y:k+1,w:m-2,h:d-2,radius:F}),e.fill()):(e.fillStyle=a.multiKeyBackground,e.fillRect(R,k,m,d),e.strokeRect(R,k,m,d),e.fillStyle=l.backgroundColor,e.fillRect(O,k+1,m-2,d-2))}e.fillStyle=this.labelTextColors[i]}drawBody(e,t,i){const{body:r}=this,{bodySpacing:a,bodyAlign:l,displayColors:s,boxHeight:d,boxWidth:m,boxPadding:_}=i,S=ro(i.bodyFont);let T=S.lineHeight,C=0;const P=ey(i.rtl,this.x,this.width),k=function($){t.fillText($,P.x(e.x+C),e.y+T/2),e.y+=T+a},R=P.textAlign(l);let O,F,N,G,j,Q,re;for(t.textAlign=l,t.textBaseline="middle",t.font=S.string,e.x=Vw(this,R,i),t.fillStyle=i.bodyColor,_i(this.beforeBody,k),C=s&&R!=="right"?l==="center"?m/2+_:m+2+_:0,G=0,Q=r.length;G<Q;++G){for(O=r[G],F=this.labelTextColors[G],t.fillStyle=F,_i(O.before,k),N=O.lines,s&&N.length&&(this._drawColorBox(t,e,G,P,i),T=Math.max(S.lineHeight,d)),j=0,re=N.length;j<re;++j)k(N[j]),T=S.lineHeight;_i(O.after,k)}C=0,T=S.lineHeight,_i(this.afterBody,k),e.y-=a}drawFooter(e,t,i){const r=this.footer,a=r.length;let l,s;if(a){const d=ey(i.rtl,this.x,this.width);for(e.x=Vw(this,i.footerAlign,i),e.y+=i.footerMarginTop,t.textAlign=d.textAlign(i.footerAlign),t.textBaseline="middle",l=ro(i.footerFont),t.fillStyle=i.footerColor,t.font=l.string,s=0;s<a;++s)t.fillText(r[s],d.x(e.x),e.y+l.lineHeight/2),e.y+=l.lineHeight+i.footerSpacing}}drawBackground(e,t,i,r){const{xAlign:a,yAlign:l}=this,{x:s,y:d}=e,{width:m,height:_}=i,{topLeft:S,topRight:T,bottomLeft:C,bottomRight:P}=jm(r.cornerRadius);t.fillStyle=r.backgroundColor,t.strokeStyle=r.borderColor,t.lineWidth=r.borderWidth,t.beginPath(),t.moveTo(s+S,d),l==="top"&&this.drawCaret(e,t,i,r),t.lineTo(s+m-T,d),t.quadraticCurveTo(s+m,d,s+m,d+T),l==="center"&&a==="right"&&this.drawCaret(e,t,i,r),t.lineTo(s+m,d+_-P),t.quadraticCurveTo(s+m,d+_,s+m-P,d+_),l==="bottom"&&this.drawCaret(e,t,i,r),t.lineTo(s+C,d+_),t.quadraticCurveTo(s,d+_,s,d+_-C),l==="center"&&a==="left"&&this.drawCaret(e,t,i,r),t.lineTo(s,d+S),t.quadraticCurveTo(s,d,s+S,d),t.closePath(),t.fill(),r.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,i=this.$animations,r=i&&i.x,a=i&&i.y;if(r||a){const l=Ox[e.position].call(this,this._active,this._eventPosition);if(!l)return;const s=this._size=YR(this,e),d=Object.assign({},l,this._size),m=JR(t,e,d),_=KR(e,d,m,t);(r._to!==_.x||a._to!==_.y)&&(this.xAlign=m.xAlign,this.yAlign=m.yAlign,this.width=s.width,this.height=s.height,this.caretX=l.x,this.caretY=l.y,this._resolveAnimations().update(this,_))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(t);const r={width:this.width,height:this.height},a={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const l=pa(t.padding),s=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&s&&(e.save(),e.globalAlpha=i,this.drawBackground(a,e,r,t),g4(e,t.textDirection),a.y+=l.top,this.drawTitle(a,e,t),this.drawBody(a,e,t),this.drawFooter(a,e,t),_4(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const i=this._active,r=e.map(({datasetIndex:s,index:d})=>{const m=this.chart.getDatasetMeta(s);if(!m)throw new Error("Cannot find a dataset at index "+s);return{datasetIndex:s,element:m.data[d],index:d}}),a=!RS(i,r),l=this._positionChanged(r,t);(a||l)&&(this._active=r,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,i=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const r=this.options,a=this._active||[],l=this._getActiveElements(e,a,t,i),s=this._positionChanged(l,e),d=t||!RS(l,a)||s;return d&&(this._active=l,(r.enabled||r.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),d}_getActiveElements(e,t,i,r){const a=this.options;if(e.type==="mouseout")return[];if(!r)return t;const l=this.chart.getElementsAtEventForMode(e,a.mode,a,i);return a.reverse&&l.reverse(),l}_positionChanged(e,t){const{caretX:i,caretY:r,options:a}=this,l=Ox[a.position].call(this,e,t);return l!==!1&&(i!==l.x||r!==l.y)}}YA.positioners=Ox;var JZ={id:"tooltip",_element:YA,positioners:Ox,afterInit(n,e,t){t&&(n.tooltip=new YA({chart:n,options:t}))},beforeUpdate(n,e,t){n.tooltip&&n.tooltip.initialize(t)},reset(n,e,t){n.tooltip&&n.tooltip.initialize(t)},afterDraw(n){const e=n.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(n.notifyPlugins("beforeTooltipDraw",t)===!1)return;e.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",t)}},afterEvent(n,e){if(n.tooltip){const t=e.replay;n.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,e)=>e.bodyFont.size,boxWidth:(n,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:Ha,title(n){if(n.length>0){const e=n[0],t=e.chart.data.labels,i=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return t[e.dataIndex]}return""},afterTitle:Ha,beforeBody:Ha,beforeLabel:Ha,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let e=n.dataset.label||"";e&&(e+=": ");const t=n.formattedValue;return _r(t)||(e+=t),e},labelColor(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:Ha,afterBody:Ha,beforeFooter:Ha,footer:Ha,afterFooter:Ha}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const KZ=(n,e,t,i)=>(typeof e=="string"?(t=n.push(e)-1,i.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function QZ(n,e,t,i){const r=n.indexOf(e);if(r===-1)return KZ(n,e,t,i);const a=n.lastIndexOf(e);return r!==a?t:r}const e$=(n,e)=>n===null?null:ca(Math.round(n),0,e);class GS extends _g{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const i=this.getLabels();for(const{index:r,label:a}of t)i[r]===a&&i.splice(r,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(_r(e))return null;const i=this.getLabels();return t=isFinite(t)&&i[t]===e?t:QZ(i,e,Mi(t,e),this._addedLabels),e$(t,i.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:i,max:r}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(i=0),t||(r=this.getLabels().length-1)),this.min=i,this.max=r}buildTicks(){const e=this.min,t=this.max,i=this.options.offset,r=[];let a=this.getLabels();a=e===0&&t===a.length-1?a:a.slice(e,t+1),this._valueRange=Math.max(a.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let l=e;l<=t;l++)r.push({value:l});return r}getLabelForValue(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}GS.id="category";GS.defaults={ticks:{callback:GS.prototype.getLabelForValue}};function t$(n,e){const t=[],{bounds:r,step:a,min:l,max:s,precision:d,count:m,maxTicks:_,maxDigits:S,includeBounds:T}=n,C=a||1,P=_-1,{min:k,max:R}=e,O=!_r(l),F=!_r(s),N=!_r(m),G=(R-k)/(S+1);let j=iR((R-k)/P/C)*C,Q,re,$,ne;if(j<1e-14&&!O&&!F)return[{value:k},{value:R}];ne=Math.ceil(R/j)-Math.floor(k/j),ne>P&&(j=iR(ne*j/P/C)*C),_r(d)||(Q=Math.pow(10,d),j=Math.ceil(j*Q)/Q),r==="ticks"?(re=Math.floor(k/j)*j,$=Math.ceil(R/j)*j):(re=k,$=R),O&&F&&a&&f9((s-l)/a,j/1e3)?(ne=Math.round(Math.min((s-l)/j,_)),j=(s-l)/ne,re=l,$=s):N?(re=O?l:re,$=F?s:$,ne=m-1,j=($-re)/ne):(ne=($-re)/j,Lx(ne,Math.round(ne),j/1e3)?ne=Math.round(ne):ne=Math.ceil(ne));const ue=Math.max(rR(j),rR(re));Q=Math.pow(10,_r(d)?ue:d),re=Math.round(re*Q)/Q,$=Math.round($*Q)/Q;let De=0;for(O&&(T&&re!==l?(t.push({value:l}),re<l&&De++,Lx(Math.round((re+De*j)*Q)/Q,l,tz(l,G,n))&&De++):re<l&&De++);De<ne;++De)t.push({value:Math.round((re+De*j)*Q)/Q});return F&&T&&$!==s?t.length&&Lx(t[t.length-1].value,s,tz(s,G,n))?t[t.length-1].value=s:t.push({value:s}):(!F||$===s)&&t.push({value:$}),t}function tz(n,e,{horizontal:t,minRotation:i}){const r=bu(i),a=(t?Math.sin(r):Math.cos(r))||.001,l=.75*e*(""+n).length;return Math.min(e/a,l)}class WS extends _g{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return _r(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:i}=this.getUserBounds();let{min:r,max:a}=this;const l=d=>r=t?r:d,s=d=>a=i?a:d;if(e){const d=xh(r),m=xh(a);d<0&&m<0?s(0):d>0&&m>0&&l(0)}if(r===a){let d=1;(a>=Number.MAX_SAFE_INTEGER||r<=Number.MIN_SAFE_INTEGER)&&(d=Math.abs(a*.05)),s(a+d),e||l(r-d)}this.min=r,this.max=a}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:i}=e,r;return i?(r=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,r>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${r} ticks. Limiting to 1000.`),r=1e3)):(r=this.computeTickLimit(),t=t||11),t&&(r=Math.min(t,r)),r}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let i=this.getTickLimit();i=Math.max(2,i);const r={maxTicks:i,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},a=this._range||this,l=t$(r,a);return e.bounds==="ticks"&&XN(l,this,"value"),e.reverse?(l.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),l}configure(){const e=this.ticks;let t=this.min,i=this.max;if(super.configure(),this.options.offset&&e.length){const r=(i-t)/Math.max(e.length-1,1)/2;t-=r,i+=r}this._startValue=t,this._endValue=i,this._valueRange=i-t}getLabelForValue(e){return Yv(e,this.chart.options.locale,this.options.ticks.format)}}class EP extends WS{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=so(e)?e:0,this.max=so(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,i=bu(this.options.ticks.minRotation),r=(e?Math.sin(i):Math.cos(i))||.001,a=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,a.lineHeight/r))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}EP.id="linear";EP.defaults={ticks:{callback:CM.formatters.numeric}};function nz(n){return n/Math.pow(10,Math.floor(_c(n)))===1}function n$(n,e){const t=Math.floor(_c(e.max)),i=Math.ceil(e.max/Math.pow(10,t)),r=[];let a=uc(n.min,Math.pow(10,Math.floor(_c(e.min)))),l=Math.floor(_c(a)),s=Math.floor(a/Math.pow(10,l)),d=l<0?Math.pow(10,Math.abs(l)):1;do r.push({value:a,major:nz(a)}),++s,s===10&&(s=1,++l,d=l>=0?1:d),a=Math.round(s*Math.pow(10,l)*d)/d;while(l<t||l===t&&s<i);const m=uc(n.max,a);return r.push({value:m,major:nz(a)}),r}class U4 extends _g{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const i=WS.prototype.parse.apply(this,[e,t]);if(i===0){this._zero=!0;return}return so(i)&&i>0?i:null}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=so(e)?Math.max(0,e):null,this.max=so(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let i=this.min,r=this.max;const a=d=>i=e?i:d,l=d=>r=t?r:d,s=(d,m)=>Math.pow(10,Math.floor(_c(d))+m);i===r&&(i<=0?(a(1),l(10)):(a(s(i,-1)),l(s(r,1)))),i<=0&&a(s(r,-1)),r<=0&&l(s(i,1)),this._zero&&this.min!==this._suggestedMin&&i===s(this.min,0)&&a(s(i,-1)),this.min=i,this.max=r}buildTicks(){const e=this.options,t={min:this._userMin,max:this._userMax},i=n$(t,this);return e.bounds==="ticks"&&XN(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(e){return e===void 0?"0":Yv(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=_c(e),this._valueRange=_c(this.max)-_c(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(_c(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}U4.id="logarithmic";U4.defaults={ticks:{callback:CM.formatters.logarithmic,major:{enabled:!0}}};function JA(n){const e=n.ticks;if(e.display&&n.display){const t=pa(e.backdropPadding);return Mi(e.font&&e.font.size,Fi.font.size)+t.height}return 0}function i$(n,e,t){return t=Lr(t)?t:[t],{w:q9(n,e.string,t),h:t.length*e.lineHeight}}function iz(n,e,t,i,r){return n===i||n===r?{start:e-t/2,end:e+t/2}:n<i||n>r?{start:e-t,end:e}:{start:e,end:e+t}}function r$(n){const e={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},t=Object.assign({},e),i=[],r=[],a=n._pointLabels.length,l=n.options.pointLabels,s=l.centerPointLabels?Jr/a:0;for(let d=0;d<a;d++){const m=l.setContext(n.getPointLabelContext(d));r[d]=m.padding;const _=n.getPointPosition(d,n.drawingArea+r[d],s),S=ro(m.font),T=i$(n.ctx,S,n._pointLabels[d]);i[d]=T;const C=_u(n.getIndexAngle(d)+s),P=Math.round(cP(C)),k=iz(P,_.x,T.w,0,180),R=iz(P,_.y,T.h,90,270);s$(t,e,C,k,R)}n.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),n._pointLabelItems=o$(n,i,r)}function s$(n,e,t,i,r){const a=Math.abs(Math.sin(t)),l=Math.abs(Math.cos(t));let s=0,d=0;i.start<e.l?(s=(e.l-i.start)/a,n.l=Math.min(n.l,e.l-s)):i.end>e.r&&(s=(i.end-e.r)/a,n.r=Math.max(n.r,e.r+s)),r.start<e.t?(d=(e.t-r.start)/l,n.t=Math.min(n.t,e.t-d)):r.end>e.b&&(d=(r.end-e.b)/l,n.b=Math.max(n.b,e.b+d))}function o$(n,e,t){const i=[],r=n._pointLabels.length,a=n.options,l=JA(a)/2,s=n.drawingArea,d=a.pointLabels.centerPointLabels?Jr/r:0;for(let m=0;m<r;m++){const _=n.getPointPosition(m,s+l+t[m],d),S=Math.round(cP(_u(_.angle+vs))),T=e[m],C=c$(_.y,T.h,S),P=a$(S),k=l$(_.x,T.w,P);i.push({x:_.x,y:C,textAlign:P,left:k,top:C,right:k+T.w,bottom:C+T.h})}return i}function a$(n){return n===0||n===180?"center":n<180?"left":"right"}function l$(n,e,t){return t==="right"?n-=e:t==="center"&&(n-=e/2),n}function c$(n,e,t){return t===90||t===270?n-=e/2:(t>270||t<90)&&(n-=e),n}function u$(n,e){const{ctx:t,options:{pointLabels:i}}=n;for(let r=e-1;r>=0;r--){const a=i.setContext(n.getPointLabelContext(r)),l=ro(a.font),{x:s,y:d,textAlign:m,left:_,top:S,right:T,bottom:C}=n._pointLabelItems[r],{backdropColor:P}=a;if(!_r(P)){const k=jm(a.borderRadius),R=pa(a.backdropPadding);t.fillStyle=P;const O=_-R.left,F=S-R.top,N=T-_+R.width,G=C-S+R.height;Object.values(k).some(j=>j!==0)?(t.beginPath(),pv(t,{x:O,y:F,w:N,h:G,radius:k}),t.fill()):t.fillRect(O,F,N,G)}cg(t,n._pointLabels[r],s,d+l.lineHeight/2,l,{color:a.color,textAlign:m,textBaseline:"middle"})}}function V4(n,e,t,i){const{ctx:r}=n;if(t)r.arc(n.xCenter,n.yCenter,e,0,Rr);else{let a=n.getPointPosition(0,e);r.moveTo(a.x,a.y);for(let l=1;l<i;l++)a=n.getPointPosition(l,e),r.lineTo(a.x,a.y)}}function h$(n,e,t,i){const r=n.ctx,a=e.circular,{color:l,lineWidth:s}=e;!a&&!i||!l||!s||t<0||(r.save(),r.strokeStyle=l,r.lineWidth=s,r.setLineDash(e.borderDash),r.lineDashOffset=e.borderDashOffset,r.beginPath(),V4(n,t,a,i),r.closePath(),r.stroke(),r.restore())}function d$(n,e,t){return Ap(n,{label:t,index:e,type:"pointLabel"})}class PM extends WS{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=pa(JA(this.options)/2),t=this.width=this.maxWidth-e.width,i=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+i/2+e.top),this.drawingArea=Math.floor(Math.min(t,i)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=so(e)&&!isNaN(e)?e:0,this.max=so(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/JA(this.options))}generateTickLabels(e){WS.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,i)=>{const r=mr(this.options.pointLabels.callback,[t,i],this);return r||r===0?r:""}).filter((t,i)=>this.chart.getDataVisibility(i))}fit(){const e=this.options;e.display&&e.pointLabels.display?r$(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,i,r){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((i-r)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,i,r))}getIndexAngle(e){const t=Rr/(this._pointLabels.length||1),i=this.options.startAngle||0;return _u(e*t+bu(i))}getDistanceFromCenterForValue(e){if(_r(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(_r(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const i=t[e];return d$(this.getContext(),e,i)}}getPointPosition(e,t,i=0){const r=this.getIndexAngle(e)-vs+i;return{x:Math.cos(r)*t+this.xCenter,y:Math.sin(r)*t+this.yCenter,angle:r}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:i,right:r,bottom:a}=this._pointLabelItems[e];return{left:t,top:i,right:r,bottom:a}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const i=this.ctx;i.save(),i.beginPath(),V4(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),i.closePath(),i.fillStyle=e,i.fill(),i.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:i,grid:r}=t,a=this._pointLabels.length;let l,s,d;if(t.pointLabels.display&&u$(this,a),r.display&&this.ticks.forEach((m,_)=>{if(_!==0){s=this.getDistanceFromCenterForValue(m.value);const S=r.setContext(this.getContext(_-1));h$(this,S,s,a)}}),i.display){for(e.save(),l=a-1;l>=0;l--){const m=i.setContext(this.getPointLabelContext(l)),{color:_,lineWidth:S}=m;!S||!_||(e.lineWidth=S,e.strokeStyle=_,e.setLineDash(m.borderDash),e.lineDashOffset=m.borderDashOffset,s=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),d=this.getPointPosition(l,s),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(d.x,d.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,i=t.ticks;if(!i.display)return;const r=this.getIndexAngle(0);let a,l;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(r),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((s,d)=>{if(d===0&&!t.reverse)return;const m=i.setContext(this.getContext(d)),_=ro(m.font);if(a=this.getDistanceFromCenterForValue(this.ticks[d].value),m.showLabelBackdrop){e.font=_.string,l=e.measureText(s.label).width,e.fillStyle=m.backdropColor;const S=pa(m.backdropPadding);e.fillRect(-l/2-S.left,-a-_.size/2-S.top,l+S.width,_.size+S.height)}cg(e,s.label,0,-a,_,{color:m.color})}),e.restore()}drawTitle(){}}PM.id="radialLinear";PM.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:CM.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(n){return n},padding:5,centerPointLabels:!1}};PM.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};PM.descriptors={angleLines:{_fallback:"grid"}};const kM={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},qa=Object.keys(kM);function f$(n,e){return n-e}function rz(n,e){if(_r(e))return null;const t=n._adapter,{parser:i,round:r,isoWeekday:a}=n._parseOpts;let l=e;return typeof i=="function"&&(l=i(l)),so(l)||(l=typeof i=="string"?t.parse(l,i):t.parse(l)),l===null?null:(r&&(l=r==="week"&&(ag(a)||a===!0)?t.startOf(l,"isoWeek",a):t.startOf(l,r)),+l)}function sz(n,e,t,i){const r=qa.length;for(let a=qa.indexOf(n);a<r-1;++a){const l=kM[qa[a]],s=l.steps?l.steps:Number.MAX_SAFE_INTEGER;if(l.common&&Math.ceil((t-e)/(s*l.size))<=i)return qa[a]}return qa[r-1]}function p$(n,e,t,i,r){for(let a=qa.length-1;a>=qa.indexOf(t);a--){const l=qa[a];if(kM[l].common&&n._adapter.diff(r,i,l)>=e-1)return l}return qa[t?qa.indexOf(t):0]}function m$(n){for(let e=qa.indexOf(n)+1,t=qa.length;e<t;++e)if(kM[qa[e]].common)return qa[e]}function oz(n,e,t){if(!t)n[e]=!0;else if(t.length){const{lo:i,hi:r}=TM(t,e),a=t[i]>=e?t[i]:t[r];n[a]=!0}}function g$(n,e,t,i){const r=n._adapter,a=+r.startOf(e[0].value,i),l=e[e.length-1].value;let s,d;for(s=a;s<=l;s=+r.add(s,1,i))d=t[s],d>=0&&(e[d].major=!0);return e}function az(n,e,t){const i=[],r={},a=e.length;let l,s;for(l=0;l<a;++l)s=e[l],r[s]=l,i.push({value:s,major:!1});return a===0||!t?i:g$(n,i,r,t)}class e1 extends _g{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t){const i=e.time||(e.time={}),r=this._adapter=new M4._date(e.adapters.date);r.init(t),Dx(i.displayFormats,r.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:rz(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,i=e.time.unit||"day";let{min:r,max:a,minDefined:l,maxDefined:s}=this.getUserBounds();function d(m){!l&&!isNaN(m.min)&&(r=Math.min(r,m.min)),!s&&!isNaN(m.max)&&(a=Math.max(a,m.max))}(!l||!s)&&(d(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&d(this.getMinMax(!1))),r=so(r)&&!isNaN(r)?r:+t.startOf(Date.now(),i),a=so(a)&&!isNaN(a)?a:+t.endOf(Date.now(),i)+1,this.min=Math.min(r,a-1),this.max=Math.max(r+1,a)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],i=e[e.length-1]),{min:t,max:i}}buildTicks(){const e=this.options,t=e.time,i=e.ticks,r=i.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&r.length&&(this.min=this._userMin||r[0],this.max=this._userMax||r[r.length-1]);const a=this.min,l=this.max,s=_9(r,a,l);return this._unit=t.unit||(i.autoSkip?sz(t.minUnit,this.min,this.max,this._getLabelCapacity(a)):p$(this,s.length,t.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:m$(this._unit),this.initOffsets(r),e.reverse&&s.reverse(),az(this,s,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e){let t=0,i=0,r,a;this.options.offset&&e.length&&(r=this.getDecimalForValue(e[0]),e.length===1?t=1-r:t=(this.getDecimalForValue(e[1])-r)/2,a=this.getDecimalForValue(e[e.length-1]),e.length===1?i=a:i=(a-this.getDecimalForValue(e[e.length-2]))/2);const l=e.length<3?.5:.25;t=ca(t,0,l),i=ca(i,0,l),this._offsets={start:t,end:i,factor:1/(t+1+i)}}_generate(){const e=this._adapter,t=this.min,i=this.max,r=this.options,a=r.time,l=a.unit||sz(a.minUnit,t,i,this._getLabelCapacity(t)),s=Mi(a.stepSize,1),d=l==="week"?a.isoWeekday:!1,m=ag(d)||d===!0,_={};let S=t,T,C;if(m&&(S=+e.startOf(S,"isoWeek",d)),S=+e.startOf(S,m?"day":l),e.diff(i,t,l)>1e5*s)throw new Error(t+" and "+i+" are too far apart with stepSize of "+s+" "+l);const P=r.ticks.source==="data"&&this.getDataTimestamps();for(T=S,C=0;T<i;T=+e.add(T,s,l),C++)oz(_,T,P);return(T===i||r.bounds==="ticks"||C===1)&&oz(_,T,P),Object.keys(_).sort((k,R)=>k-R).map(k=>+k)}getLabelForValue(e){const t=this._adapter,i=this.options.time;return i.tooltipFormat?t.format(e,i.tooltipFormat):t.format(e,i.displayFormats.datetime)}_tickFormatFunction(e,t,i,r){const a=this.options,l=a.time.displayFormats,s=this._unit,d=this._majorUnit,m=s&&l[s],_=d&&l[d],S=i[t],T=d&&_&&S&&S.major,C=this._adapter.format(e,r||(T?_:m)),P=a.ticks.callback;return P?mr(P,[C,t,i],this):C}generateTickLabels(e){let t,i,r;for(t=0,i=e.length;t<i;++t)r=e[t],r.label=this._tickFormatFunction(r.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,i=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+i)*t.factor)}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+i*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,i=this.ctx.measureText(e).width,r=bu(this.isHorizontal()?t.maxRotation:t.minRotation),a=Math.cos(r),l=Math.sin(r),s=this._resolveTickFontOptions(0).size;return{w:i*a+s*l,h:i*l+s*a}}_getLabelCapacity(e){const t=this.options.time,i=t.displayFormats,r=i[t.unit]||i.millisecond,a=this._tickFormatFunction(e,0,az(this,[e],this._majorUnit),r),l=this._getLabelSize(a),s=Math.floor(this.isHorizontal()?this.width/l.w:this.height/l.h)-1;return s>0?s:1}getDataTimestamps(){let e=this._cache.data||[],t,i;if(e.length)return e;const r=this.getMatchingVisibleMetas();if(this._normalized&&r.length)return this._cache.data=r[0].controller.getAllParsedValues(this);for(t=0,i=r.length;t<i;++t)e=e.concat(r[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,i;if(e.length)return e;const r=this.getLabels();for(t=0,i=r.length;t<i;++t)e.push(rz(this,r[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return KN(e.sort(f$))}}e1.id="time";e1.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};function Gw(n,e,t){let i=0,r=n.length-1,a,l,s,d;t?(e>=n[i].pos&&e<=n[r].pos&&({lo:i,hi:r}=Om(n,"pos",e)),{pos:a,time:s}=n[i],{pos:l,time:d}=n[r]):(e>=n[i].time&&e<=n[r].time&&({lo:i,hi:r}=Om(n,"time",e)),{time:a,pos:s}=n[i],{time:l,pos:d}=n[r]);const m=l-a;return m?s+(d-s)*(e-a)/m:s}class G4 extends e1{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=Gw(t,this.min),this._tableRange=Gw(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:i}=this,r=[],a=[];let l,s,d,m,_;for(l=0,s=e.length;l<s;++l)m=e[l],m>=t&&m<=i&&r.push(m);if(r.length<2)return[{time:t,pos:0},{time:i,pos:1}];for(l=0,s=r.length;l<s;++l)_=r[l+1],d=r[l-1],m=r[l],Math.round((_+d)/2)!==m&&a.push({time:m,pos:l/(s-1)});return a}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),i=this.getLabelTimestamps();return t.length&&i.length?e=this.normalize(t.concat(i)):e=t.length?t:i,e=this._cache.all=e,e}getDecimalForValue(e){return(Gw(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return Gw(this._table,i*this._tableRange+this._minPos,!0)}}G4.id="timeseries";G4.defaults=e1.defaults;const W4="label";function lz(n,e){typeof n=="function"?n(e):n&&(n.current=e)}function _$(n,e){const t=n.options;t&&e&&Object.assign(t,e)}function H4(n,e){n.labels=e}function j4(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:W4;const i=[];n.datasets=e.map(r=>{const a=n.datasets.find(l=>l[t]===r[t]);return!a||!r.data||i.includes(a)?{...r}:(i.push(a),Object.assign(a,r),a)})}function y$(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:W4;const t={labels:[],datasets:[]};return H4(t,n.labels),j4(t,n.datasets,e),t}function x$(n,e){const{height:t=150,width:i=300,redraw:r=!1,datasetIdKey:a,type:l,data:s,options:d,plugins:m=[],fallbackContent:_,updateMode:S,...T}=n,C=$t.useRef(null),P=$t.useRef(),k=()=>{C.current&&(P.current=new Ly(C.current,{type:l,data:y$(s,a),options:d&&{...d},plugins:m}),lz(e,P.current))},R=()=>{lz(e,null),P.current&&(P.current.destroy(),P.current=null)};return $t.useEffect(()=>{!r&&P.current&&d&&_$(P.current,d)},[r,d]),$t.useEffect(()=>{!r&&P.current&&H4(P.current.config.data,s.labels)},[r,s.labels]),$t.useEffect(()=>{!r&&P.current&&s.datasets&&j4(P.current.config.data,s.datasets,a)},[r,s.datasets]),$t.useEffect(()=>{P.current&&(r?(R(),setTimeout(k)):P.current.update(S))},[r,d,s.labels,s.datasets,S]),$t.useEffect(()=>{P.current&&(R(),setTimeout(k))},[l]),$t.useEffect(()=>(k(),()=>R()),[]),_I.createElement("canvas",Object.assign({ref:C,role:"img",height:t,width:i},T),_)}const v$=$t.forwardRef(x$);function w$(n,e){return Ly.register(e),$t.forwardRef((t,i)=>_I.createElement(v$,Object.assign({},t,{ref:i,type:n})))}const b$=w$("line",AM);class yg extends Error{}class S$ extends yg{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class M$ extends yg{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class T$ extends yg{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class yx extends yg{}class q4 extends yg{constructor(e){super(`Invalid unit ${e}`)}}class gc extends yg{}class Cf extends yg{constructor(){super("Zone is an abstract class")}}const En="numeric",Iu="short",Dl="long",HS={year:En,month:En,day:En},Z4={year:En,month:Iu,day:En},E$={year:En,month:Iu,day:En,weekday:Iu},$4={year:En,month:Dl,day:En},X4={year:En,month:Dl,day:En,weekday:Dl},Y4={hour:En,minute:En},J4={hour:En,minute:En,second:En},K4={hour:En,minute:En,second:En,timeZoneName:Iu},Q4={hour:En,minute:En,second:En,timeZoneName:Dl},e5={hour:En,minute:En,hourCycle:"h23"},t5={hour:En,minute:En,second:En,hourCycle:"h23"},n5={hour:En,minute:En,second:En,hourCycle:"h23",timeZoneName:Iu},i5={hour:En,minute:En,second:En,hourCycle:"h23",timeZoneName:Dl},r5={year:En,month:En,day:En,hour:En,minute:En},s5={year:En,month:En,day:En,hour:En,minute:En,second:En},o5={year:En,month:Iu,day:En,hour:En,minute:En},a5={year:En,month:Iu,day:En,hour:En,minute:En,second:En},A$={year:En,month:Iu,day:En,weekday:Iu,hour:En,minute:En},l5={year:En,month:Dl,day:En,hour:En,minute:En,timeZoneName:Iu},c5={year:En,month:Dl,day:En,hour:En,minute:En,second:En,timeZoneName:Iu},u5={year:En,month:Dl,day:En,weekday:Dl,hour:En,minute:En,timeZoneName:Dl},h5={year:En,month:Dl,day:En,weekday:Dl,hour:En,minute:En,second:En,timeZoneName:Dl};class t1{get type(){throw new Cf}get name(){throw new Cf}get ianaName(){return this.name}get isUniversal(){throw new Cf}offsetName(e,t){throw new Cf}formatOffset(e,t){throw new Cf}offset(e){throw new Cf}equals(e){throw new Cf}get isValid(){throw new Cf}}let N2=null;class DM extends t1{static get instance(){return N2===null&&(N2=new DM),N2}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return f5(e,t,i)}formatOffset(e,t){return Bx(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let Jb={};function C$(n){return Jb[n]||(Jb[n]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:n,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Jb[n]}const I$={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function P$(n,e){const t=n.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,r,a,l,s,d,m,_]=i;return[l,r,a,s,d,m,_]}function k$(n,e){const t=n.formatToParts(e),i=[];for(let r=0;r<t.length;r++){const{type:a,value:l}=t[r],s=I$[a];a==="era"?i[s]=l:Ki(s)||(i[s]=parseInt(l,10))}return i}let Ww={};class Nd extends t1{static create(e){return Ww[e]||(Ww[e]=new Nd(e)),Ww[e]}static resetCache(){Ww={},Jb={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Nd.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return f5(e,t,i,this.name)}formatOffset(e,t){return Bx(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const i=C$(this.name);let[r,a,l,s,d,m,_]=i.formatToParts?k$(i,t):P$(i,t);s==="BC"&&(r=-Math.abs(r)+1);const T=IP({year:r,month:a,day:l,hour:d===24?0:d,minute:m,second:_,millisecond:0});let C=+t;const P=C%1e3;return C-=P>=0?P:1e3+P,(T-C)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let cz={};function D$(n,e={}){const t=JSON.stringify([n,e]);let i=cz[t];return i||(i=new Intl.ListFormat(n,e),cz[t]=i),i}let KA={};function QA(n,e={}){const t=JSON.stringify([n,e]);let i=KA[t];return i||(i=new Intl.DateTimeFormat(n,e),KA[t]=i),i}let eC={};function L$(n,e={}){const t=JSON.stringify([n,e]);let i=eC[t];return i||(i=new Intl.NumberFormat(n,e),eC[t]=i),i}let tC={};function R$(n,e={}){const{base:t,...i}=e,r=JSON.stringify([n,i]);let a=tC[r];return a||(a=new Intl.RelativeTimeFormat(n,e),tC[r]=a),a}let xx=null;function z$(){return xx||(xx=new Intl.DateTimeFormat().resolvedOptions().locale,xx)}function O$(n){const e=n.indexOf("-x-");e!==-1&&(n=n.substring(0,e));const t=n.indexOf("-u-");if(t===-1)return[n];{let i,r;try{i=QA(n).resolvedOptions(),r=n}catch{const d=n.substring(0,t);i=QA(d).resolvedOptions(),r=d}const{numberingSystem:a,calendar:l}=i;return[r,a,l]}}function F$(n,e,t){return(t||e)&&(n.includes("-u-")||(n+="-u"),t&&(n+=`-ca-${t}`),e&&(n+=`-nu-${e}`)),n}function B$(n){const e=[];for(let t=1;t<=12;t++){const i=ti.utc(2016,t,1);e.push(n(i))}return e}function N$(n){const e=[];for(let t=1;t<=7;t++){const i=ti.utc(2016,11,13+t);e.push(n(i))}return e}function Hw(n,e,t,i,r){const a=n.listingMode(t);return a==="error"?null:a==="en"?i(e):r(e)}function U$(n){return n.numberingSystem&&n.numberingSystem!=="latn"?!1:n.numberingSystem==="latn"||!n.locale||n.locale.startsWith("en")||new Intl.DateTimeFormat(n.intl).resolvedOptions().numberingSystem==="latn"}class V${constructor(e,t,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:r,floor:a,...l}=i;if(!t||Object.keys(l).length>0){const s={useGrouping:!1,...i};i.padTo>0&&(s.minimumIntegerDigits=i.padTo),this.inf=L$(e,s)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{const t=this.floor?Math.floor(e):CP(e,3);return Gs(t,this.padTo)}}}class G${constructor(e,t,i){this.opts=i;let r;if(e.zone.isUniversal){const l=-1*(e.offset/60),s=l>=0?`Etc/GMT+${l}`:`Etc/GMT${l}`;e.offset!==0&&Nd.create(s).valid?(r=s,this.dt=e):(r="UTC",i.timeZoneName?this.dt=e:this.dt=e.offset===0?e:ti.fromMillis(e.ts+e.offset*60*1e3))}else e.zone.type==="system"?this.dt=e:(this.dt=e,r=e.zone.name);const a={...this.opts};a.timeZone=a.timeZone||r,this.dtf=QA(t,a)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class W${constructor(e,t,i){this.opts={style:"long",...i},!t&&d5()&&(this.rtf=R$(e,i))}format(e,t){return this.rtf?this.rtf.format(e,t):oX(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}class Wr{static fromOpts(e){return Wr.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,t,i,r=!1){const a=e||Vs.defaultLocale,l=a||(r?"en-US":z$()),s=t||Vs.defaultNumberingSystem,d=i||Vs.defaultOutputCalendar;return new Wr(l,s,d,a)}static resetCache(){xx=null,KA={},eC={},tC={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:i}={}){return Wr.create(e,t,i)}constructor(e,t,i,r){const[a,l,s]=O$(e);this.locale=a,this.numberingSystem=t||l||null,this.outputCalendar=i||s||null,this.intl=F$(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=U$(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Wr.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1,i=!0){return Hw(this,e,i,g5,()=>{const r=t?{month:e,day:"numeric"}:{month:e},a=t?"format":"standalone";return this.monthsCache[a][e]||(this.monthsCache[a][e]=B$(l=>this.extract(l,r,"month"))),this.monthsCache[a][e]})}weekdays(e,t=!1,i=!0){return Hw(this,e,i,x5,()=>{const r=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},a=t?"format":"standalone";return this.weekdaysCache[a][e]||(this.weekdaysCache[a][e]=N$(l=>this.extract(l,r,"weekday"))),this.weekdaysCache[a][e]})}meridiems(e=!0){return Hw(this,void 0,e,()=>v5,()=>{if(!this.meridiemCache){const t={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ti.utc(2016,11,13,9),ti.utc(2016,11,13,19)].map(i=>this.extract(i,t,"dayperiod"))}return this.meridiemCache})}eras(e,t=!0){return Hw(this,e,t,w5,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[ti.utc(-40,1,1),ti.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,t,i){const r=this.dtFormatter(e,t),a=r.formatToParts(),l=a.find(s=>s.type.toLowerCase()===i);return l?l.value:null}numberFormatter(e={}){return new V$(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new G$(e,this.intl,t)}relFormatter(e={}){return new W$(this.intl,this.isEnglish(),e)}listFormatter(e={}){return D$(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let U2=null;class Aa extends t1{static get utcInstance(){return U2===null&&(U2=new Aa(0)),U2}static instance(e){return e===0?Aa.utcInstance:new Aa(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new Aa(RM(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${Bx(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${Bx(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return Bx(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class H$ extends t1{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Wf(n,e){if(Ki(n)||n===null)return e;if(n instanceof t1)return n;if(j$(n)){const t=n.toLowerCase();return t==="default"?e:t==="local"||t==="system"?DM.instance:t==="utc"||t==="gmt"?Aa.utcInstance:Aa.parseSpecifier(t)||Nd.create(n)}else return Zm(n)?Aa.instance(n):typeof n=="object"&&n.offset&&typeof n.offset=="number"?n:new H$(n)}let uz=()=>Date.now(),hz="system",dz=null,fz=null,pz=null,mz=60,gz;class Vs{static get now(){return uz}static set now(e){uz=e}static set defaultZone(e){hz=e}static get defaultZone(){return Wf(hz,DM.instance)}static get defaultLocale(){return dz}static set defaultLocale(e){dz=e}static get defaultNumberingSystem(){return fz}static set defaultNumberingSystem(e){fz=e}static get defaultOutputCalendar(){return pz}static set defaultOutputCalendar(e){pz=e}static get twoDigitCutoffYear(){return mz}static set twoDigitCutoffYear(e){mz=e%100}static get throwOnInvalid(){return gz}static set throwOnInvalid(e){gz=e}static resetCaches(){Wr.resetCache(),Nd.resetCache()}}function Ki(n){return typeof n>"u"}function Zm(n){return typeof n=="number"}function LM(n){return typeof n=="number"&&n%1===0}function j$(n){return typeof n=="string"}function q$(n){return Object.prototype.toString.call(n)==="[object Date]"}function d5(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function Z$(n){return Array.isArray(n)?n:[n]}function _z(n,e,t){if(n.length!==0)return n.reduce((i,r)=>{const a=[e(r),r];return i&&t(i[0],a[0])===i[0]?i:a},null)[1]}function $$(n,e){return e.reduce((t,i)=>(t[i]=n[i],t),{})}function _y(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Cd(n,e,t){return LM(n)&&n>=e&&n<=t}function X$(n,e){return n-e*Math.floor(n/e)}function Gs(n,e=2){const t=n<0;let i;return t?i="-"+(""+-n).padStart(e,"0"):i=(""+n).padStart(e,"0"),i}function Nf(n){if(!(Ki(n)||n===null||n===""))return parseInt(n,10)}function dm(n){if(!(Ki(n)||n===null||n===""))return parseFloat(n)}function AP(n){if(!(Ki(n)||n===null||n==="")){const e=parseFloat("0."+n)*1e3;return Math.floor(e)}}function CP(n,e,t=!1){const i=10**e;return(t?Math.trunc:Math.round)(n*i)/i}function n1(n){return n%4===0&&(n%100!==0||n%400===0)}function Fx(n){return n1(n)?366:365}function jS(n,e){const t=X$(e-1,12)+1,i=n+(e-t)/12;return t===2?n1(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function IP(n){let e=Date.UTC(n.year,n.month-1,n.day,n.hour,n.minute,n.second,n.millisecond);return n.year<100&&n.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function qS(n){const e=(n+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400))%7,t=n-1,i=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7;return e===4||i===3?53:52}function nC(n){return n>99?n:n>Vs.twoDigitCutoffYear?1900+n:2e3+n}function f5(n,e,t,i=null){const r=new Date(n),a={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(a.timeZone=i);const l={timeZoneName:e,...a},s=new Intl.DateTimeFormat(t,l).formatToParts(r).find(d=>d.type.toLowerCase()==="timezonename");return s?s.value:null}function RM(n,e){let t=parseInt(n,10);Number.isNaN(t)&&(t=0);const i=parseInt(e,10)||0,r=t<0||Object.is(t,-0)?-i:i;return t*60+r}function p5(n){const e=Number(n);if(typeof n=="boolean"||n===""||Number.isNaN(e))throw new gc(`Invalid unit value ${n}`);return e}function ZS(n,e){const t={};for(const i in n)if(_y(n,i)){const r=n[i];if(r==null)continue;t[e(i)]=p5(r)}return t}function Bx(n,e){const t=Math.trunc(Math.abs(n/60)),i=Math.trunc(Math.abs(n%60)),r=n>=0?"+":"-";switch(e){case"short":return`${r}${Gs(t,2)}:${Gs(i,2)}`;case"narrow":return`${r}${t}${i>0?`:${i}`:""}`;case"techie":return`${r}${Gs(t,2)}${Gs(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function zM(n){return $$(n,["hour","minute","second","millisecond"])}const Y$=["January","February","March","April","May","June","July","August","September","October","November","December"],m5=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],J$=["J","F","M","A","M","J","J","A","S","O","N","D"];function g5(n){switch(n){case"narrow":return[...J$];case"short":return[...m5];case"long":return[...Y$];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const _5=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],y5=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],K$=["M","T","W","T","F","S","S"];function x5(n){switch(n){case"narrow":return[...K$];case"short":return[...y5];case"long":return[..._5];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const v5=["AM","PM"],Q$=["Before Christ","Anno Domini"],eX=["BC","AD"],tX=["B","A"];function w5(n){switch(n){case"narrow":return[...tX];case"short":return[...eX];case"long":return[...Q$];default:return null}}function nX(n){return v5[n.hour<12?0:1]}function iX(n,e){return x5(e)[n.weekday-1]}function rX(n,e){return g5(e)[n.month-1]}function sX(n,e){return w5(e)[n.year<0?0:1]}function oX(n,e,t="always",i=!1){const r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},a=["hours","minutes","seconds"].indexOf(n)===-1;if(t==="auto"&&a){const S=n==="days";switch(e){case 1:return S?"tomorrow":`next ${r[n][0]}`;case-1:return S?"yesterday":`last ${r[n][0]}`;case 0:return S?"today":`this ${r[n][0]}`}}const l=Object.is(e,-0)||e<0,s=Math.abs(e),d=s===1,m=r[n],_=i?d?m[1]:m[2]||m[1]:d?r[n][0]:n;return l?`${s} ${_} ago`:`in ${s} ${_}`}function yz(n,e){let t="";for(const i of n)i.literal?t+=i.val:t+=e(i.val);return t}const aX={D:HS,DD:Z4,DDD:$4,DDDD:X4,t:Y4,tt:J4,ttt:K4,tttt:Q4,T:e5,TT:t5,TTT:n5,TTTT:i5,f:r5,ff:o5,fff:l5,ffff:u5,F:s5,FF:a5,FFF:c5,FFFF:h5};class oa{static create(e,t={}){return new oa(e,t)}static parseFormat(e){let t=null,i="",r=!1;const a=[];for(let l=0;l<e.length;l++){const s=e.charAt(l);s==="'"?(i.length>0&&a.push({literal:r,val:i}),t=null,i="",r=!r):r||s===t?i+=s:(i.length>0&&a.push({literal:!1,val:i}),i=s,t=s)}return i.length>0&&a.push({literal:r,val:i}),a}static macroTokenToFormatOpts(e){return aX[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}formatDateTime(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t}).format()}formatDateTimeParts(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t}).formatToParts()}formatInterval(e,t={}){return this.loc.dtFormatter(e.start,{...this.opts,...t}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t}).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return Gs(e,t);const i={...this.opts};return t>0&&(i.padTo=t),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,t){const i=this.loc.listingMode()==="en",r=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",a=(C,P)=>this.loc.extract(e,C,P),l=C=>e.isOffsetFixed&&e.offset===0&&C.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,C.format):"",s=()=>i?nX(e):a({hour:"numeric",hourCycle:"h12"},"dayperiod"),d=(C,P)=>i?rX(e,C):a(P?{month:C}:{month:C,day:"numeric"},"month"),m=(C,P)=>i?iX(e,C):a(P?{weekday:C}:{weekday:C,month:"long",day:"numeric"},"weekday"),_=C=>{const P=oa.macroTokenToFormatOpts(C);return P?this.formatWithSystemDefault(e,P):C},S=C=>i?sX(e,C):a({era:C},"era"),T=C=>{switch(C){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return l({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return l({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return l({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return s();case"d":return r?a({day:"numeric"},"day"):this.num(e.day);case"dd":return r?a({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return m("short",!0);case"cccc":return m("long",!0);case"ccccc":return m("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return m("short",!1);case"EEEE":return m("long",!1);case"EEEEE":return m("narrow",!1);case"L":return r?a({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return r?a({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return d("short",!0);case"LLLL":return d("long",!0);case"LLLLL":return d("narrow",!0);case"M":return r?a({month:"numeric"},"month"):this.num(e.month);case"MM":return r?a({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return d("short",!1);case"MMMM":return d("long",!1);case"MMMMM":return d("narrow",!1);case"y":return r?a({year:"numeric"},"year"):this.num(e.year);case"yy":return r?a({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return r?a({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return r?a({year:"numeric"},"year"):this.num(e.year,6);case"G":return S("short");case"GG":return S("long");case"GGGGG":return S("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return _(C)}};return yz(oa.parseFormat(t),T)}formatDurationFromString(e,t){const i=d=>{switch(d[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},r=d=>m=>{const _=i(m);return _?this.num(d.get(_),m.length):m},a=oa.parseFormat(t),l=a.reduce((d,{literal:m,val:_})=>m?d:d.concat(_),[]),s=e.shiftTo(...l.map(i).filter(d=>d));return yz(a,r(s))}}class Su{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const b5=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function Ry(...n){const e=n.reduce((t,i)=>t+i.source,"");return RegExp(`^${e}$`)}function zy(...n){return e=>n.reduce(([t,i,r],a)=>{const[l,s,d]=a(e,r);return[{...t,...l},s||i,d]},[{},null,1]).slice(0,2)}function Oy(n,...e){if(n==null)return[null,null];for(const[t,i]of e){const r=t.exec(n);if(r)return i(r)}return[null,null]}function S5(...n){return(e,t)=>{const i={};let r;for(r=0;r<n.length;r++)i[n[r]]=Nf(e[t+r]);return[i,null,t+r]}}const M5=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,lX=`(?:${M5.source}?(?:\\[(${b5.source})\\])?)?`,PP=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,T5=RegExp(`${PP.source}${lX}`),kP=RegExp(`(?:T${T5.source})?`),cX=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,uX=/(\d{4})-?W(\d\d)(?:-?(\d))?/,hX=/(\d{4})-?(\d{3})/,dX=S5("weekYear","weekNumber","weekDay"),fX=S5("year","ordinal"),pX=/(\d{4})-(\d\d)-(\d\d)/,E5=RegExp(`${PP.source} ?(?:${M5.source}|(${b5.source}))?`),mX=RegExp(`(?: ${E5.source})?`);function ty(n,e,t){const i=n[e];return Ki(i)?t:Nf(i)}function gX(n,e){return[{year:ty(n,e),month:ty(n,e+1,1),day:ty(n,e+2,1)},null,e+3]}function Fy(n,e){return[{hours:ty(n,e,0),minutes:ty(n,e+1,0),seconds:ty(n,e+2,0),milliseconds:AP(n[e+3])},null,e+4]}function i1(n,e){const t=!n[e]&&!n[e+1],i=RM(n[e+1],n[e+2]),r=t?null:Aa.instance(i);return[{},r,e+3]}function r1(n,e){const t=n[e]?Nd.create(n[e]):null;return[{},t,e+1]}const _X=RegExp(`^T?${PP.source}$`),yX=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function xX(n){const[e,t,i,r,a,l,s,d,m]=n,_=e[0]==="-",S=d&&d[0]==="-",T=(C,P=!1)=>C!==void 0&&(P||C&&_)?-C:C;return[{years:T(dm(t)),months:T(dm(i)),weeks:T(dm(r)),days:T(dm(a)),hours:T(dm(l)),minutes:T(dm(s)),seconds:T(dm(d),d==="-0"),milliseconds:T(AP(m),S)}]}const vX={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function DP(n,e,t,i,r,a,l){const s={year:e.length===2?nC(Nf(e)):Nf(e),month:m5.indexOf(t)+1,day:Nf(i),hour:Nf(r),minute:Nf(a)};return l&&(s.second=Nf(l)),n&&(s.weekday=n.length>3?_5.indexOf(n)+1:y5.indexOf(n)+1),s}const wX=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function bX(n){const[,e,t,i,r,a,l,s,d,m,_,S]=n,T=DP(e,r,i,t,a,l,s);let C;return d?C=vX[d]:m?C=0:C=RM(_,S),[T,new Aa(C)]}function SX(n){return n.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const MX=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,TX=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,EX=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function xz(n){const[,e,t,i,r,a,l,s]=n;return[DP(e,r,i,t,a,l,s),Aa.utcInstance]}function AX(n){const[,e,t,i,r,a,l,s]=n;return[DP(e,s,t,i,r,a,l),Aa.utcInstance]}const CX=Ry(cX,kP),IX=Ry(uX,kP),PX=Ry(hX,kP),kX=Ry(T5),A5=zy(gX,Fy,i1,r1),DX=zy(dX,Fy,i1,r1),LX=zy(fX,Fy,i1,r1),RX=zy(Fy,i1,r1);function zX(n){return Oy(n,[CX,A5],[IX,DX],[PX,LX],[kX,RX])}function OX(n){return Oy(SX(n),[wX,bX])}function FX(n){return Oy(n,[MX,xz],[TX,xz],[EX,AX])}function BX(n){return Oy(n,[yX,xX])}const NX=zy(Fy);function UX(n){return Oy(n,[_X,NX])}const VX=Ry(pX,mX),GX=Ry(E5),WX=zy(Fy,i1,r1);function HX(n){return Oy(n,[VX,A5],[GX,WX])}const jX="Invalid Duration",C5={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},qX={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...C5},lc=146097/400,a_=146097/4800,ZX={years:{quarters:4,months:12,weeks:lc/7,days:lc,hours:lc*24,minutes:lc*24*60,seconds:lc*24*60*60,milliseconds:lc*24*60*60*1e3},quarters:{months:3,weeks:lc/28,days:lc/4,hours:lc*24/4,minutes:lc*24*60/4,seconds:lc*24*60*60/4,milliseconds:lc*24*60*60*1e3/4},months:{weeks:a_/7,days:a_,hours:a_*24,minutes:a_*24*60,seconds:a_*24*60*60,milliseconds:a_*24*60*60*1e3},...C5},Em=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],$X=Em.slice(0).reverse();function If(n,e,t=!1){const i={values:t?e.values:{...n.values,...e.values||{}},loc:n.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||n.conversionAccuracy,matrix:e.matrix||n.matrix};return new rr(i)}function XX(n){return n<0?Math.floor(n):Math.ceil(n)}function I5(n,e,t,i,r){const a=n[r][t],l=e[t]/a,s=Math.sign(l)===Math.sign(i[r]),d=!s&&i[r]!==0&&Math.abs(l)<=1?XX(l):Math.trunc(l);i[r]+=d,e[t]-=d*a}function YX(n,e){$X.reduce((t,i)=>Ki(e[i])?t:(t&&I5(n,e,t,e,i),i),null)}function JX(n){const e={};for(const[t,i]of Object.entries(n))i!==0&&(e[t]=i);return e}class rr{constructor(e){const t=e.conversionAccuracy==="longterm"||!1;let i=t?ZX:qX;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||Wr.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,t){return rr.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new gc(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new rr({values:ZS(e,rr.normalizeUnit),loc:Wr.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(Zm(e))return rr.fromMillis(e);if(rr.isDuration(e))return e;if(typeof e=="object")return rr.fromObject(e);throw new gc(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[i]=BX(e);return i?rr.fromObject(i,t):rr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[i]=UX(e);return i?rr.fromObject(i,t):rr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new gc("need to specify a reason the Duration is invalid");const i=e instanceof Su?e:new Su(e,t);if(Vs.throwOnInvalid)throw new T$(i);return new rr({invalid:i})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new q4(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const i={...t,floor:t.round!==!1&&t.floor!==!1};return this.isValid?oa.create(this.loc,i).formatDurationFromString(this,e):jX}toHuman(e={}){const t=Em.map(i=>{const r=this.values[i];return Ki(r)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(r)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=CP(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let r=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(r+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(r+=".SSS"));let a=i.toFormat(r);return e.includePrefix&&(a="T"+a),a}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=rr.fromDurationLike(e),i={};for(const r of Em)(_y(t.values,r)||_y(this.values,r))&&(i[r]=t.get(r)+this.get(r));return If(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const t=rr.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=p5(e(this.values[i],i));return If(this,{values:t},!0)}get(e){return this[rr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const t={...this.values,...ZS(e,rr.normalizeUnit)};return If(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:i,matrix:r}={}){const l={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:r,conversionAccuracy:i};return If(this,l)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return YX(this.matrix,e),If(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=JX(this.normalize().shiftToAll().toObject());return If(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(l=>rr.normalizeUnit(l));const t={},i={},r=this.toObject();let a;for(const l of Em)if(e.indexOf(l)>=0){a=l;let s=0;for(const m in i)s+=this.matrix[m][l]*i[m],i[m]=0;Zm(r[l])&&(s+=r[l]);const d=Math.trunc(s);t[l]=d,i[l]=(s*1e3-d*1e3)/1e3;for(const m in r)Em.indexOf(m)>Em.indexOf(l)&&I5(this.matrix,r,m,t,l)}else Zm(r[l])&&(i[l]=r[l]);for(const l in i)i[l]!==0&&(t[a]+=l===a?i[l]:i[l]/this.matrix[a][l]);return If(this,{values:t},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return If(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(i,r){return i===void 0||i===0?r===void 0||r===0:i===r}for(const i of Em)if(!t(this.values[i],e.values[i]))return!1;return!0}}const l_="Invalid Interval";function KX(n,e){return!n||!n.isValid?ys.invalid("missing or invalid start"):!e||!e.isValid?ys.invalid("missing or invalid end"):e<n?ys.invalid("end before start",`The end of an interval must be after its start, but you had start=${n.toISO()} and end=${e.toISO()}`):null}class ys{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new gc("need to specify a reason the Interval is invalid");const i=e instanceof Su?e:new Su(e,t);if(Vs.throwOnInvalid)throw new M$(i);return new ys({invalid:i})}static fromDateTimes(e,t){const i=X0(e),r=X0(t),a=KX(i,r);return a??new ys({start:i,end:r})}static after(e,t){const i=rr.fromDurationLike(t),r=X0(e);return ys.fromDateTimes(r,r.plus(i))}static before(e,t){const i=rr.fromDurationLike(t),r=X0(e);return ys.fromDateTimes(r.minus(i),r)}static fromISO(e,t){const[i,r]=(e||"").split("/",2);if(i&&r){let a,l;try{a=ti.fromISO(i,t),l=a.isValid}catch{l=!1}let s,d;try{s=ti.fromISO(r,t),d=s.isValid}catch{d=!1}if(l&&d)return ys.fromDateTimes(a,s);if(l){const m=rr.fromISO(r,t);if(m.isValid)return ys.after(a,m)}else if(d){const m=rr.fromISO(i,t);if(m.isValid)return ys.before(s,m)}}return ys.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const t=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(t,e).get(e))+1}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?ys.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(X0).filter(l=>this.contains(l)).sort(),i=[];let{s:r}=this,a=0;for(;r<this.e;){const l=t[a]||this.e,s=+l>+this.e?this.e:l;i.push(ys.fromDateTimes(r,s)),r=s,a+=1}return i}splitBy(e){const t=rr.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:i}=this,r=1,a;const l=[];for(;i<this.e;){const s=this.start.plus(t.mapUnits(d=>d*r));a=+s>+this.e?this.e:s,l.push(ys.fromDateTimes(i,a)),i=a,r+=1}return l}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return t>=i?null:ys.fromDateTimes(t,i)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return ys.fromDateTimes(t,i)}static merge(e){const[t,i]=e.sort((r,a)=>r.s-a.s).reduce(([r,a],l)=>a?a.overlaps(l)||a.abutsStart(l)?[r,a.union(l)]:[r.concat([a]),l]:[r,l],[[],null]);return i&&t.push(i),t}static xor(e){let t=null,i=0;const r=[],a=e.map(d=>[{time:d.s,type:"s"},{time:d.e,type:"e"}]),l=Array.prototype.concat(...a),s=l.sort((d,m)=>d.time-m.time);for(const d of s)i+=d.type==="s"?1:-1,i===1?t=d.time:(t&&+t!=+d.time&&r.push(ys.fromDateTimes(t,d.time)),t=null);return ys.merge(r)}difference(...e){return ys.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:l_}toLocaleString(e=HS,t={}){return this.isValid?oa.create(this.s.loc.clone(t),e).formatInterval(this):l_}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:l_}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:l_}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:l_}toFormat(e,{separator:t="  "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:l_}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):rr.invalid(this.invalidReason)}mapEndpoints(e){return ys.fromDateTimes(e(this.s),e(this.e))}}class jw{static hasDST(e=Vs.defaultZone){const t=ti.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Nd.isValidZone(e)}static normalizeZone(e){return Wf(e,Vs.defaultZone)}static months(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:a="gregory"}={}){return(r||Wr.create(t,i,a)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:a="gregory"}={}){return(r||Wr.create(t,i,a)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||Wr.create(t,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||Wr.create(t,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Wr.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return Wr.create(t,null,"gregory").eras(e)}static features(){return{relative:d5()}}}function vz(n,e){const t=r=>r.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=t(e)-t(n);return Math.floor(rr.fromMillis(i).as("days"))}function QX(n,e,t){const i=[["years",(d,m)=>m.year-d.year],["quarters",(d,m)=>m.quarter-d.quarter+(m.year-d.year)*4],["months",(d,m)=>m.month-d.month+(m.year-d.year)*12],["weeks",(d,m)=>{const _=vz(d,m);return(_-_%7)/7}],["days",vz]],r={},a=n;let l,s;for(const[d,m]of i)t.indexOf(d)>=0&&(l=d,r[d]=m(n,e),s=a.plus(r),s>e?(r[d]--,n=a.plus(r)):n=s);return[n,r,s,l]}function eY(n,e,t,i){let[r,a,l,s]=QX(n,e,t);const d=e-r,m=t.filter(S=>["hours","minutes","seconds","milliseconds"].indexOf(S)>=0);m.length===0&&(l<e&&(l=r.plus({[s]:1})),l!==r&&(a[s]=(a[s]||0)+d/(l-r)));const _=rr.fromObject(a,i);return m.length>0?rr.fromMillis(d,i).shiftTo(...m).plus(_):_}const LP={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},wz={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},tY=LP.hanidec.replace(/[\[|\]]/g,"").split("");function nY(n){let e=parseInt(n,10);if(isNaN(e)){e="";for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);if(n[t].search(LP.hanidec)!==-1)e+=tY.indexOf(n[t]);else for(const r in wz){const[a,l]=wz[r];i>=a&&i<=l&&(e+=i-a)}}return parseInt(e,10)}else return e}function uu({numberingSystem:n},e=""){return new RegExp(`${LP[n||"latn"]}${e}`)}const iY="missing Intl.DateTimeFormat.formatToParts support";function dr(n,e=t=>t){return{regex:n,deser:([t])=>e(nY(t))}}const rY=String.fromCharCode(160),P5=`[ ${rY}]`,k5=new RegExp(P5,"g");function sY(n){return n.replace(/\./g,"\\.?").replace(k5,P5)}function bz(n){return n.replace(/\./g,"").replace(k5," ").toLowerCase()}function hu(n,e){return n===null?null:{regex:RegExp(n.map(sY).join("|")),deser:([t])=>n.findIndex(i=>bz(t)===bz(i))+e}}function Sz(n,e){return{regex:n,deser:([,t,i])=>RM(t,i),groups:e}}function V2(n){return{regex:n,deser:([e])=>e}}function oY(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function aY(n,e){const t=uu(e),i=uu(e,"{2}"),r=uu(e,"{3}"),a=uu(e,"{4}"),l=uu(e,"{6}"),s=uu(e,"{1,2}"),d=uu(e,"{1,3}"),m=uu(e,"{1,6}"),_=uu(e,"{1,9}"),S=uu(e,"{2,4}"),T=uu(e,"{4,6}"),C=R=>({regex:RegExp(oY(R.val)),deser:([O])=>O,literal:!0}),k=(R=>{if(n.literal)return C(R);switch(R.val){case"G":return hu(e.eras("short",!1),0);case"GG":return hu(e.eras("long",!1),0);case"y":return dr(m);case"yy":return dr(S,nC);case"yyyy":return dr(a);case"yyyyy":return dr(T);case"yyyyyy":return dr(l);case"M":return dr(s);case"MM":return dr(i);case"MMM":return hu(e.months("short",!0,!1),1);case"MMMM":return hu(e.months("long",!0,!1),1);case"L":return dr(s);case"LL":return dr(i);case"LLL":return hu(e.months("short",!1,!1),1);case"LLLL":return hu(e.months("long",!1,!1),1);case"d":return dr(s);case"dd":return dr(i);case"o":return dr(d);case"ooo":return dr(r);case"HH":return dr(i);case"H":return dr(s);case"hh":return dr(i);case"h":return dr(s);case"mm":return dr(i);case"m":return dr(s);case"q":return dr(s);case"qq":return dr(i);case"s":return dr(s);case"ss":return dr(i);case"S":return dr(d);case"SSS":return dr(r);case"u":return V2(_);case"uu":return V2(s);case"uuu":return dr(t);case"a":return hu(e.meridiems(),0);case"kkkk":return dr(a);case"kk":return dr(S,nC);case"W":return dr(s);case"WW":return dr(i);case"E":case"c":return dr(t);case"EEE":return hu(e.weekdays("short",!1,!1),1);case"EEEE":return hu(e.weekdays("long",!1,!1),1);case"ccc":return hu(e.weekdays("short",!0,!1),1);case"cccc":return hu(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Sz(new RegExp(`([+-]${s.source})(?::(${i.source}))?`),2);case"ZZZ":return Sz(new RegExp(`([+-]${s.source})(${i.source})?`),2);case"z":return V2(/[a-z_+-/]{1,256}?/i);default:return C(R)}})(n)||{invalidReason:iY};return k.token=n,k}const lY={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function cY(n,e){const{type:t,value:i}=n;if(t==="literal")return{literal:!0,val:i};const r=e[t];let a=lY[t];if(typeof a=="object"&&(a=a[r]),a)return{literal:!1,val:a}}function uY(n){return[`^${n.map(t=>t.regex).reduce((t,i)=>`${t}(${i.source})`,"")}$`,n]}function hY(n,e,t){const i=n.match(e);if(i){const r={};let a=1;for(const l in t)if(_y(t,l)){const s=t[l],d=s.groups?s.groups+1:1;!s.literal&&s.token&&(r[s.token.val[0]]=s.deser(i.slice(a,a+d))),a+=d}return[i,r]}else return[i,{}]}function dY(n){const e=a=>{switch(a){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let t=null,i;return Ki(n.z)||(t=Nd.create(n.z)),Ki(n.Z)||(t||(t=new Aa(n.Z)),i=n.Z),Ki(n.q)||(n.M=(n.q-1)*3+1),Ki(n.h)||(n.h<12&&n.a===1?n.h+=12:n.h===12&&n.a===0&&(n.h=0)),n.G===0&&n.y&&(n.y=-n.y),Ki(n.u)||(n.S=AP(n.u)),[Object.keys(n).reduce((a,l)=>{const s=e(l);return s&&(a[s]=n[l]),a},{}),t,i]}let G2=null;function fY(){return G2||(G2=ti.fromMillis(1555555555555)),G2}function pY(n,e){if(n.literal)return n;const t=oa.macroTokenToFormatOpts(n.val),i=R5(t,e);return i==null||i.includes(void 0)?n:i}function D5(n,e){return Array.prototype.concat(...n.map(t=>pY(t,e)))}function L5(n,e,t){const i=D5(oa.parseFormat(t),n),r=i.map(l=>aY(l,n)),a=r.find(l=>l.invalidReason);if(a)return{input:e,tokens:i,invalidReason:a.invalidReason};{const[l,s]=uY(r),d=RegExp(l,"i"),[m,_]=hY(e,d,s),[S,T,C]=_?dY(_):[null,null,void 0];if(_y(_,"a")&&_y(_,"H"))throw new yx("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:d,rawMatches:m,matches:_,result:S,zone:T,specificOffset:C}}}function mY(n,e,t){const{result:i,zone:r,specificOffset:a,invalidReason:l}=L5(n,e,t);return[i,r,a,l]}function R5(n,e){return n?oa.create(e,n).formatDateTimeParts(fY()).map(r=>cY(r,n)):null}const z5=[0,31,59,90,120,151,181,212,243,273,304,334],O5=[0,31,60,91,121,152,182,213,244,274,305,335];function wc(n,e){return new Su("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${n}, which is invalid`)}function F5(n,e,t){const i=new Date(Date.UTC(n,e-1,t));n<100&&n>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const r=i.getUTCDay();return r===0?7:r}function B5(n,e,t){return t+(n1(n)?O5:z5)[e-1]}function N5(n,e){const t=n1(n)?O5:z5,i=t.findIndex(a=>a<e),r=e-t[i];return{month:i+1,day:r}}function iC(n){const{year:e,month:t,day:i}=n,r=B5(e,t,i),a=F5(e,t,i);let l=Math.floor((r-a+10)/7),s;return l<1?(s=e-1,l=qS(s)):l>qS(e)?(s=e+1,l=1):s=e,{weekYear:s,weekNumber:l,weekday:a,...zM(n)}}function Mz(n){const{weekYear:e,weekNumber:t,weekday:i}=n,r=F5(e,1,4),a=Fx(e);let l=t*7+i-r-3,s;l<1?(s=e-1,l+=Fx(s)):l>a?(s=e+1,l-=Fx(e)):s=e;const{month:d,day:m}=N5(s,l);return{year:s,month:d,day:m,...zM(n)}}function W2(n){const{year:e,month:t,day:i}=n,r=B5(e,t,i);return{year:e,ordinal:r,...zM(n)}}function Tz(n){const{year:e,ordinal:t}=n,{month:i,day:r}=N5(e,t);return{year:e,month:i,day:r,...zM(n)}}function gY(n){const e=LM(n.weekYear),t=Cd(n.weekNumber,1,qS(n.weekYear)),i=Cd(n.weekday,1,7);return e?t?i?!1:wc("weekday",n.weekday):wc("week",n.week):wc("weekYear",n.weekYear)}function _Y(n){const e=LM(n.year),t=Cd(n.ordinal,1,Fx(n.year));return e?t?!1:wc("ordinal",n.ordinal):wc("year",n.year)}function U5(n){const e=LM(n.year),t=Cd(n.month,1,12),i=Cd(n.day,1,jS(n.year,n.month));return e?t?i?!1:wc("day",n.day):wc("month",n.month):wc("year",n.year)}function V5(n){const{hour:e,minute:t,second:i,millisecond:r}=n,a=Cd(e,0,23)||e===24&&t===0&&i===0&&r===0,l=Cd(t,0,59),s=Cd(i,0,59),d=Cd(r,0,999);return a?l?s?d?!1:wc("millisecond",r):wc("second",i):wc("minute",t):wc("hour",e)}const H2="Invalid DateTime",Ez=864e13;function qw(n){return new Su("unsupported zone",`the zone "${n.name}" is not supported`)}function j2(n){return n.weekData===null&&(n.weekData=iC(n.c)),n.weekData}function Z0(n,e){const t={ts:n.ts,zone:n.zone,c:n.c,o:n.o,loc:n.loc,invalid:n.invalid};return new ti({...t,...e,old:t})}function G5(n,e,t){let i=n-e*60*1e3;const r=t.offset(i);if(e===r)return[i,e];i-=(r-e)*60*1e3;const a=t.offset(i);return r===a?[i,r]:[n-Math.min(r,a)*60*1e3,Math.max(r,a)]}function Az(n,e){n+=e*60*1e3;const t=new Date(n);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function Kb(n,e,t){return G5(IP(n),e,t)}function Cz(n,e){const t=n.o,i=n.c.year+Math.trunc(e.years),r=n.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,a={...n.c,year:i,month:r,day:Math.min(n.c.day,jS(i,r))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},l=rr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),s=IP(a);let[d,m]=G5(s,t,n.zone);return l!==0&&(d+=l,m=n.zone.offset(d)),{ts:d,o:m}}function $0(n,e,t,i,r,a){const{setZone:l,zone:s}=t;if(n&&Object.keys(n).length!==0){const d=e||s,m=ti.fromObject(n,{...t,zone:d,specificOffset:a});return l?m:m.setZone(s)}else return ti.invalid(new Su("unparsable",`the input "${r}" can't be parsed as ${i}`))}function Zw(n,e,t=!0){return n.isValid?oa.create(Wr.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(n,e):null}function q2(n,e){const t=n.c.year>9999||n.c.year<0;let i="";return t&&n.c.year>=0&&(i+="+"),i+=Gs(n.c.year,t?6:4),e?(i+="-",i+=Gs(n.c.month),i+="-",i+=Gs(n.c.day)):(i+=Gs(n.c.month),i+=Gs(n.c.day)),i}function Iz(n,e,t,i,r,a){let l=Gs(n.c.hour);return e?(l+=":",l+=Gs(n.c.minute),(n.c.second!==0||!t)&&(l+=":")):l+=Gs(n.c.minute),(n.c.second!==0||!t)&&(l+=Gs(n.c.second),(n.c.millisecond!==0||!i)&&(l+=".",l+=Gs(n.c.millisecond,3))),r&&(n.isOffsetFixed&&n.offset===0&&!a?l+="Z":n.o<0?(l+="-",l+=Gs(Math.trunc(-n.o/60)),l+=":",l+=Gs(Math.trunc(-n.o%60))):(l+="+",l+=Gs(Math.trunc(n.o/60)),l+=":",l+=Gs(Math.trunc(n.o%60)))),a&&(l+="["+n.zone.ianaName+"]"),l}const W5={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},yY={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},xY={ordinal:1,hour:0,minute:0,second:0,millisecond:0},H5=["year","month","day","hour","minute","second","millisecond"],vY=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],wY=["year","ordinal","hour","minute","second","millisecond"];function Pz(n){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[n.toLowerCase()];if(!e)throw new q4(n);return e}function kz(n,e){const t=Wf(e.zone,Vs.defaultZone),i=Wr.fromObject(e),r=Vs.now();let a,l;if(Ki(n.year))a=r;else{for(const m of H5)Ki(n[m])&&(n[m]=W5[m]);const s=U5(n)||V5(n);if(s)return ti.invalid(s);const d=t.offset(r);[a,l]=Kb(n,d,t)}return new ti({ts:a,zone:t,loc:i,o:l})}function Dz(n,e,t){const i=Ki(t.round)?!0:t.round,r=(l,s)=>(l=CP(l,i||t.calendary?0:2,!0),e.loc.clone(t).relFormatter(t).format(l,s)),a=l=>t.calendary?e.hasSame(n,l)?0:e.startOf(l).diff(n.startOf(l),l).get(l):e.diff(n,l).get(l);if(t.unit)return r(a(t.unit),t.unit);for(const l of t.units){const s=a(l);if(Math.abs(s)>=1)return r(s,l)}return r(n>e?-0:0,t.units[t.units.length-1])}function Lz(n){let e={},t;return n.length>0&&typeof n[n.length-1]=="object"?(e=n[n.length-1],t=Array.from(n).slice(0,n.length-1)):t=Array.from(n),[e,t]}class ti{constructor(e){const t=e.zone||Vs.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Su("invalid input"):null)||(t.isValid?null:qw(t));this.ts=Ki(e.ts)?Vs.now():e.ts;let r=null,a=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[r,a]=[e.old.c,e.old.o];else{const s=t.offset(this.ts);r=Az(this.ts,s),i=Number.isNaN(r.year)?new Su("invalid input"):null,r=i?null:r,a=i?null:s}this._zone=t,this.loc=e.loc||Wr.create(),this.invalid=i,this.weekData=null,this.c=r,this.o=a,this.isLuxonDateTime=!0}static now(){return new ti({})}static local(){const[e,t]=Lz(arguments),[i,r,a,l,s,d,m]=t;return kz({year:i,month:r,day:a,hour:l,minute:s,second:d,millisecond:m},e)}static utc(){const[e,t]=Lz(arguments),[i,r,a,l,s,d,m]=t;return e.zone=Aa.utcInstance,kz({year:i,month:r,day:a,hour:l,minute:s,second:d,millisecond:m},e)}static fromJSDate(e,t={}){const i=q$(e)?e.valueOf():NaN;if(Number.isNaN(i))return ti.invalid("invalid input");const r=Wf(t.zone,Vs.defaultZone);return r.isValid?new ti({ts:i,zone:r,loc:Wr.fromObject(t)}):ti.invalid(qw(r))}static fromMillis(e,t={}){if(Zm(e))return e<-Ez||e>Ez?ti.invalid("Timestamp out of range"):new ti({ts:e,zone:Wf(t.zone,Vs.defaultZone),loc:Wr.fromObject(t)});throw new gc(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(Zm(e))return new ti({ts:e*1e3,zone:Wf(t.zone,Vs.defaultZone),loc:Wr.fromObject(t)});throw new gc("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const i=Wf(t.zone,Vs.defaultZone);if(!i.isValid)return ti.invalid(qw(i));const r=Vs.now(),a=Ki(t.specificOffset)?i.offset(r):t.specificOffset,l=ZS(e,Pz),s=!Ki(l.ordinal),d=!Ki(l.year),m=!Ki(l.month)||!Ki(l.day),_=d||m,S=l.weekYear||l.weekNumber,T=Wr.fromObject(t);if((_||s)&&S)throw new yx("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&s)throw new yx("Can't mix ordinal dates with month/day");const C=S||l.weekday&&!_;let P,k,R=Az(r,a);C?(P=vY,k=yY,R=iC(R)):s?(P=wY,k=xY,R=W2(R)):(P=H5,k=W5);let O=!1;for(const $ of P){const ne=l[$];Ki(ne)?O?l[$]=k[$]:l[$]=R[$]:O=!0}const F=C?gY(l):s?_Y(l):U5(l),N=F||V5(l);if(N)return ti.invalid(N);const G=C?Mz(l):s?Tz(l):l,[j,Q]=Kb(G,a,i),re=new ti({ts:j,zone:i,o:Q,loc:T});return l.weekday&&_&&e.weekday!==re.weekday?ti.invalid("mismatched weekday",`you can't specify both a weekday of ${l.weekday} and a date of ${re.toISO()}`):re}static fromISO(e,t={}){const[i,r]=zX(e);return $0(i,r,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[i,r]=OX(e);return $0(i,r,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[i,r]=FX(e);return $0(i,r,t,"HTTP",t)}static fromFormat(e,t,i={}){if(Ki(e)||Ki(t))throw new gc("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:a=null}=i,l=Wr.fromOpts({locale:r,numberingSystem:a,defaultToEN:!0}),[s,d,m,_]=mY(l,e,t);return _?ti.invalid(_):$0(s,d,i,`format ${t}`,e,m)}static fromString(e,t,i={}){return ti.fromFormat(e,t,i)}static fromSQL(e,t={}){const[i,r]=HX(e);return $0(i,r,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new gc("need to specify a reason the DateTime is invalid");const i=e instanceof Su?e:new Su(e,t);if(Vs.throwOnInvalid)throw new S$(i);return new ti({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const i=R5(e,Wr.fromObject(t));return i?i.map(r=>r?r.val:null).join(""):null}static expandFormat(e,t={}){return D5(oa.parseFormat(e),Wr.fromObject(t)).map(r=>r.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?j2(this).weekYear:NaN}get weekNumber(){return this.isValid?j2(this).weekNumber:NaN}get weekday(){return this.isValid?j2(this).weekday:NaN}get ordinal(){return this.isValid?W2(this.c).ordinal:NaN}get monthShort(){return this.isValid?jw.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?jw.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?jw.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?jw.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return n1(this.year)}get daysInMonth(){return jS(this.year,this.month)}get daysInYear(){return this.isValid?Fx(this.year):NaN}get weeksInWeekYear(){return this.isValid?qS(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:i,calendar:r}=oa.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:i,outputCalendar:r}}toUTC(e=0,t={}){return this.setZone(Aa.instance(e),t)}toLocal(){return this.setZone(Vs.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:i=!1}={}){if(e=Wf(e,Vs.defaultZone),e.equals(this.zone))return this;if(e.isValid){let r=this.ts;if(t||i){const a=e.offset(this.ts),l=this.toObject();[r]=Kb(l,a,e)}return Z0(this,{ts:r,zone:e})}else return ti.invalid(qw(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:i}={}){const r=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:i});return Z0(this,{loc:r})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=ZS(e,Pz),i=!Ki(t.weekYear)||!Ki(t.weekNumber)||!Ki(t.weekday),r=!Ki(t.ordinal),a=!Ki(t.year),l=!Ki(t.month)||!Ki(t.day),s=a||l,d=t.weekYear||t.weekNumber;if((s||r)&&d)throw new yx("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&r)throw new yx("Can't mix ordinal dates with month/day");let m;i?m=Mz({...iC(this.c),...t}):Ki(t.ordinal)?(m={...this.toObject(),...t},Ki(t.day)&&(m.day=Math.min(jS(m.year,m.month),m.day))):m=Tz({...W2(this.c),...t});const[_,S]=Kb(m,this.o,this.zone);return Z0(this,{ts:_,o:S})}plus(e){if(!this.isValid)return this;const t=rr.fromDurationLike(e);return Z0(this,Cz(this,t))}minus(e){if(!this.isValid)return this;const t=rr.fromDurationLike(e).negate();return Z0(this,Cz(this,t))}startOf(e){if(!this.isValid)return this;const t={},i=rr.normalizeUnit(e);switch(i){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0;break}if(i==="weeks"&&(t.weekday=1),i==="quarters"){const r=Math.ceil(this.month/3);t.month=(r-1)*3+1}return this.set(t)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?oa.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):H2}toLocaleString(e=HS,t={}){return this.isValid?oa.create(this.loc.clone(t),e).formatDateTime(this):H2}toLocaleParts(e={}){return this.isValid?oa.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:i=!1,includeOffset:r=!0,extendedZone:a=!1}={}){if(!this.isValid)return null;const l=e==="extended";let s=q2(this,l);return s+="T",s+=Iz(this,l,t,i,r,a),s}toISODate({format:e="extended"}={}){return this.isValid?q2(this,e==="extended"):null}toISOWeekDate(){return Zw(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:i=!0,includePrefix:r=!1,extendedZone:a=!1,format:l="extended"}={}){return this.isValid?(r?"T":"")+Iz(this,l==="extended",t,e,i,a):null}toRFC2822(){return Zw(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Zw(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?q2(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:i=!0}={}){let r="HH:mm:ss.SSS";return(t||e)&&(i&&(r+=" "),t?r+="z":e&&(r+="ZZ")),Zw(this,r,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():H2}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",i={}){if(!this.isValid||!e.isValid)return rr.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...i},a=Z$(t).map(rr.normalizeUnit),l=e.valueOf()>this.valueOf(),s=l?this:e,d=l?e:this,m=eY(s,d,a,r);return l?m.negate():m}diffNow(e="milliseconds",t={}){return this.diff(ti.now(),e,t)}until(e){return this.isValid?ys.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;const i=e.valueOf(),r=this.setZone(e.zone,{keepLocalTime:!0});return r.startOf(t)<=i&&i<=r.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||ti.fromObject({},{zone:this.zone}),i=e.padding?this<t?-e.padding:e.padding:0;let r=["years","months","days","hours","minutes","seconds"],a=e.unit;return Array.isArray(e.unit)&&(r=e.unit,a=void 0),Dz(t,this.plus(i),{...e,numeric:"always",units:r,unit:a})}toRelativeCalendar(e={}){return this.isValid?Dz(e.base||ti.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(ti.isDateTime))throw new gc("min requires all arguments be DateTimes");return _z(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(ti.isDateTime))throw new gc("max requires all arguments be DateTimes");return _z(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,i={}){const{locale:r=null,numberingSystem:a=null}=i,l=Wr.fromOpts({locale:r,numberingSystem:a,defaultToEN:!0});return L5(l,e,t)}static fromStringExplain(e,t,i={}){return ti.fromFormatExplain(e,t,i)}static get DATE_SHORT(){return HS}static get DATE_MED(){return Z4}static get DATE_MED_WITH_WEEKDAY(){return E$}static get DATE_FULL(){return $4}static get DATE_HUGE(){return X4}static get TIME_SIMPLE(){return Y4}static get TIME_WITH_SECONDS(){return J4}static get TIME_WITH_SHORT_OFFSET(){return K4}static get TIME_WITH_LONG_OFFSET(){return Q4}static get TIME_24_SIMPLE(){return e5}static get TIME_24_WITH_SECONDS(){return t5}static get TIME_24_WITH_SHORT_OFFSET(){return n5}static get TIME_24_WITH_LONG_OFFSET(){return i5}static get DATETIME_SHORT(){return r5}static get DATETIME_SHORT_WITH_SECONDS(){return s5}static get DATETIME_MED(){return o5}static get DATETIME_MED_WITH_SECONDS(){return a5}static get DATETIME_MED_WITH_WEEKDAY(){return A$}static get DATETIME_FULL(){return l5}static get DATETIME_FULL_WITH_SECONDS(){return c5}static get DATETIME_HUGE(){return u5}static get DATETIME_HUGE_WITH_SECONDS(){return h5}}function X0(n){if(ti.isDateTime(n))return n;if(n&&n.valueOf&&Zm(n.valueOf()))return ti.fromJSDate(n);if(n&&typeof n=="object")return ti.fromObject(n);throw new gc(`Unknown datetime argument: ${n}, of type ${typeof n}`)}/*!
 * chartjs-adapter-luxon v1.3.1
 * https://www.chartjs.org
 * (c) 2023 chartjs-adapter-luxon Contributors
 * Released under the MIT license
 */const bY={datetime:ti.DATETIME_MED_WITH_SECONDS,millisecond:"h:mm:ss.SSS a",second:ti.TIME_WITH_SECONDS,minute:ti.TIME_SIMPLE,hour:{hour:"numeric"},day:{day:"numeric",month:"short"},week:"DD",month:{month:"short",year:"numeric"},quarter:"'Q'q - yyyy",year:{year:"numeric"}};M4._date.override({_id:"luxon",_create:function(n){return ti.fromMillis(n,this.options)},init(n){this.options.locale||(this.options.locale=n.locale)},formats:function(){return bY},parse:function(n,e){const t=this.options,i=typeof n;return n===null||i==="undefined"?null:(i==="number"?n=this._create(n):i==="string"?typeof e=="string"?n=ti.fromFormat(n,e,t):n=ti.fromISO(n,t):n instanceof Date?n=ti.fromJSDate(n,t):i==="object"&&!(n instanceof ti)&&(n=ti.fromObject(n,t)),n.isValid?n.valueOf():null)},format:function(n,e){const t=this._create(n);return typeof e=="string"?t.toFormat(e):t.toLocaleString(e)},add:function(n,e,t){const i={};return i[t]=e,this._create(n).plus(i).valueOf()},diff:function(n,e,t){return this._create(n).diff(this._create(e)).as(t).valueOf()},startOf:function(n,e,t){if(e==="isoWeek"){t=Math.trunc(Math.min(Math.max(0,t),6));const i=this._create(n);return i.minus({days:(i.weekday-t+7)%7}).startOf("day").valueOf()}return e?this._create(n).startOf(e).valueOf():n},endOf:function(n,e){return this._create(n).endOf(e).valueOf()}});/*!
 * chartjs-plugin-streaming v2.0.0
 * https://nagix.github.io/chartjs-plugin-streaming
 * (c) 2017-2021 Akihiko Kusanagi
 * Released under the MIT license
 */function rC(n,e,t){return Math.min(Math.max(n,e),t)}function Ws(n,e){const t=n.options.realtime,i=n.chart.options.plugins.streaming;return Mi(t[e],i[e])}function sC(n,{x:e,y:t},{xAxisID:i,yAxisID:r}){const a={};return _i(e,l=>{a[l]={axisId:i}}),_i(t,l=>{a[l]={axisId:r}}),a}const SY=function(){return typeof window>"u"?Ha:window.cancelAnimationFrame}();function MY(n,e){if(!n.frameRequestID){const t=()=>{const i=n.nextRefresh||0,r=Date.now();if(i<=r){const a=mr(e),l=1e3/(Math.max(a,0)||30),s=n.nextRefresh+l||0;n.nextRefresh=s>r?s:r+l}n.frameRequestID=FS.call(window,t)};n.frameRequestID=FS.call(window,t)}}function Rz(n){const e=n.frameRequestID;e&&(SY.call(window,e),delete n.frameRequestID)}function j5(n){const e=n.refreshTimerID;e&&(clearInterval(e),delete n.refreshTimerID,delete n.refreshInterval)}function q5(n,e,t){n.refreshTimerID||(n.refreshTimerID=setInterval(()=>{const i=mr(e);n.refreshInterval!==i&&!isNaN(i)&&(j5(n),q5(n,e,i))},t||0),n.refreshInterval=t||0)}function wu(n,e,t){return e=typeof e=="number"?e:n.parse(e),so(e)?{value:n.getPixelForValue(e),transitionable:!0}:{value:t}}function TY(n,e,t){const{scales:i,chartArea:r}=e,{xScaleID:a,yScaleID:l,xMin:s,xMax:d,yMin:m,yMax:_}=t,S=i[a],T=i[l],{top:C,left:P,bottom:k,right:R}=r,O=n.$streaming={};if(S){const F=wu(S,s,P),N=wu(S,d,R),G=F.value>N.value;F.transitionable&&(O[G?"x2":"x"]={axisId:a}),N.transitionable&&(O[G?"x":"x2"]={axisId:a}),F.transitionable!==N.transitionable&&(O.width={axisId:a,reverse:F.transitionable})}if(T){const F=wu(T,m,C),N=wu(T,_,k),G=F.value>N.value;F.transitionable&&(O[G?"y2":"y"]={axisId:l}),N.transitionable&&(O[G?"y":"y2"]={axisId:l}),F.transitionable!==N.transitionable&&(O.height={axisId:l,reverse:F.transitionable})}}function EY(n,e,t){const{scales:i,chartArea:r}=e,{scaleID:a,value:l}=t,s=i[a],{top:d,left:m,bottom:_,right:S}=r,T=n.$streaming={};if(s){const Q=s.isHorizontal();return wu(s,l).transitionable&&(T[Q?"x":"y"]={axisId:a},T[Q?"x2":"y2"]={axisId:a}),Q?{top:d,bottom:_}:{left:m,right:S}}const{xScaleID:C,yScaleID:P,xMin:k,xMax:R,yMin:O,yMax:F}=t,N=i[C],G=i[P],j={};if(N){const Q=wu(N,k),re=wu(N,R);Q.transitionable?T.x={axisId:C}:j.left=m,re.transitionable?T.x2={axisId:C}:j.right=S}if(G){const Q=wu(G,O),re=wu(G,F);Q.transitionable?T.y={axisId:P}:j.top=d,re.transitionable?T.y2={axisId:P}:j.bottom=_}return j}function AY(n,e,t){const i=e.scales,{xScaleID:r,yScaleID:a,xValue:l,yValue:s}=t,d=i[r],m=i[a],_=n.$streaming={};d&&wu(d,l).transitionable&&(_.x={axisId:r}),m&&wu(m,s).transitionable&&(_.y={axisId:a})}function CY(){const n=Ea.getElement("boxAnnotation"),e=Ea.getElement("lineAnnotation"),t=Ea.getElement("pointAnnotation"),i=n.prototype.resolveElementProperties,r=e.prototype.resolveElementProperties,a=t.prototype.resolveElementProperties;n.prototype.resolveElementProperties=function(l,s){return TY(this,l,s),i.call(this,l,s)},e.prototype.resolveElementProperties=function(l,s){const d=l.chartArea;l.chartArea=EY(this,l,s);const m=r.call(this,l,s);return l.chartArea=d,m},t.prototype.resolveElementProperties=function(l,s){return AY(this,l,s),a.call(this,l,s)}}function IY(n,e){const t=e.$streaming;if(t.annotationPlugin!==n){const i=n.afterUpdate;CY(),t.annotationPlugin=n,n.afterUpdate=(r,a,l)=>{const s=a.mode,d=l.animation;s==="quiet"&&(l.animation=!1),i.call(this,r,a,l),s==="quiet"&&(l.animation=d)}}}function PY(n){const e=n.$streaming.annotationPlugin;if(e){const t=e._getState(n);return t&&t.elements||[]}return[]}function kY(n){delete n.$streaming.annotationPlugin}const DY={x:["x","caretX"],y:["y","caretY"]};function LY(...n){const e=this,t=e.getActiveElements()[0];if(t){const i=e._chart.getDatasetMeta(t.datasetIndex);e.$streaming=sC(e,DY,i)}else e.$streaming={};e.constructor.prototype.update.call(e,...n)}const oC=new WeakMap;function RY(n){let e=oC.get(n);return e||(e={originalScaleOptions:{}},oC.set(n,e)),e}function zY(n){oC.delete(n)}function RP(n){const{originalScaleOptions:e}=RY(n),t=n.scales;return _i(t,i=>{const r=i.id;e[r]||(e[r]={duration:Ws(i,"duration"),delay:Ws(i,"delay")})}),_i(e,(i,r)=>{t[r]||delete e[r]}),e}function OY(n,e,t,i){const{chart:r,axis:a}=n,{minDuration:l=0,maxDuration:s=1/0,minDelay:d=-1/0,maxDelay:m=1/0}=i&&i[a]||{},_=n.options.realtime,S=Ws(n,"duration"),T=Ws(n,"delay"),C=rC(S*(2-e),l,s);let P,k;return RP(r),n.isHorizontal()?P=(n.right-t.x)/(n.right-n.left):P=(n.bottom-t.y)/(n.bottom-n.top),k=T+P*(S-C),_.duration=C,_.delay=rC(k,d,m),C!==n.max-n.min}function FY(n,e,t){const{chart:i,axis:r}=n,{minDelay:a=-1/0,maxDelay:l=1/0}=t&&t[r]||{},d=Ws(n,"delay")+(n.getValueForPixel(e)-n.getValueForPixel(0));return RP(i),n.options.realtime.delay=rC(d,a,l),!0}function BY(n){const e=RP(n);_i(n.scales,t=>{const i=t.options.realtime;if(i){const r=e[t.id];r?(i.duration=r.duration,i.delay=r.delay):(delete i.duration,delete i.delay)}})}function NY(n){n.zoomFunctions.realtime=OY,n.panFunctions.realtime=FY}function UY(n,e){const t=e.$streaming;if(t.zoomPlugin!==n){const i=t.resetZoom=e.resetZoom;NY(n),e.resetZoom=r=>{BY(e),i(r)},t.zoomPlugin=n}}function VY(n){const e=n.$streaming;e.zoomPlugin&&(n.resetZoom=e.resetZoom,zY(n),delete e.resetZoom,delete e.zoomPlugin)}const s1={millisecond:{common:!0,size:1,steps:[1,2,5,10,20,50,100,250,500]},second:{common:!0,size:1e3,steps:[1,2,5,10,15,30]},minute:{common:!0,size:6e4,steps:[1,2,5,10,15,30]},hour:{common:!0,size:36e5,steps:[1,2,3,6,12]},day:{common:!0,size:864e5,steps:[1,2,5]},week:{common:!1,size:6048e5,steps:[1,2,3,4]},month:{common:!0,size:2628e6,steps:[1,2,3]},quarter:{common:!1,size:7884e6,steps:[1,2,3,4]},year:{common:!0,size:3154e7}},Md=Object.keys(s1);function GY(n,e,t,i){const r=e-n,{size:a,steps:l}=s1[t];let s;if(!l)return Math.ceil(r/(i*a));for(let d=0,m=l.length;d<m&&(s=l[d],!(Math.ceil(r/(a*s))<=i));++d);return s}function WY(n,e,t,i){const r=t-e,a=Md.length;for(let l=Md.indexOf(n);l<a-1;++l){const{common:s,size:d,steps:m}=s1[Md[l]],_=m?m[m.length-1]:Number.MAX_SAFE_INTEGER;if(s&&Math.ceil(r/(_*d))<=i)return Md[l]}return Md[a-1]}function HY(n){for(let e=Md.indexOf(n)+1,t=Md.length;e<t;++e)if(s1[Md[e]].common)return Md[e]}function zz(n,e,t){if(!t)n[e]=!0;else if(t.length){const{lo:i,hi:r}=TM(t,e),a=t[i]>=e?t[i]:t[r];n[a]=!0}}const jY=["pointBackgroundColor","pointBorderColor","pointBorderWidth","pointRadius","pointRotation","pointStyle","pointHitRadius","pointHoverBackgroundColor","pointHoverBorderColor","pointHoverBorderWidth","pointHoverRadius","backgroundColor","borderColor","borderSkipped","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth","hoverRadius","hitRadius","radius","rotation"];function qY(n){const{chart:e,id:t,max:i}=n,r=Ws(n,"duration"),a=Ws(n,"delay"),l=Ws(n,"ttl"),s=Ws(n,"pause"),d=Date.now()-(isNaN(l)?r+a:l);let m,_,S,T;_i(e.data.datasets,(C,P)=>{const k=e.getDatasetMeta(P),R=t===k.xAxisID&&"x"||t===k.yAxisID&&"y";if(R){const O=k.controller,F=C.data,N=F.length;if(s){for(m=0;m<N;++m){const G=O.getParsed(m);if(G&&!(G[R]<i))break}_=m+2}else _=0;for(m=_;m<N;++m){const G=O.getParsed(m);if(!G||!(G[R]<=d))break}S=m-_,isNaN(l)&&(S=Math.max(S-2,0)),F.splice(_,S),_i(jY,G=>{Lr(C[G])&&C[G].splice(_,S)}),_i(C.datalabels,G=>{Lr(G)&&G.splice(_,S)}),typeof F[0]!="object"&&(T={start:_,count:S}),_i(e._active,(G,j)=>{G.datasetIndex===P&&G.index>=_&&(G.index>=_+S?G.index-=S:e._active.splice(j,1))},null,!0)}}),T&&e.data.labels.splice(T.start,T.count)}function $w(n,e,t){const i=n.$animations||{};_i(n.$streaming,(r,a)=>{if(r.axisId===e){const l=r.reverse?-t:t,s=i[a];so(n[a])&&(n[a]-=l),s&&(s._from-=l,s._to-=l)}})}function ZY(n){const{chart:e,id:t,$realtime:i}=n,r=Ws(n,"duration"),a=Ws(n,"delay"),l=n.isHorizontal(),s=l?n.width:n.height,d=Date.now(),m=e.tooltip,_=PY(e);let S=s*(d-i.head)/r;l===!!n.options.reverse&&(S=-S),_i(e.data.datasets,(T,C)=>{const P=e.getDatasetMeta(C),{data:k=[],dataset:R}=P;for(let O=0,F=k.length;O<F;++O)$w(k[O],t,S);R&&($w(R,t,S),delete R._path)});for(let T=0,C=_.length;T<C;++T)$w(_[T],t,S);m&&$w(m,t,S),n.max=d-a,n.min=n.max-r,i.head=d}class ny extends e1{constructor(e){super(e),this.$realtime=this.$realtime||{}}init(e,t){const i=this;super.init(e,t),q5(i.$realtime,()=>{const r=i.chart,a=Ws(i,"onRefresh");return mr(a,[r],i),qY(i),r.update("quiet"),Ws(i,"refresh")})}update(e,t,i){const r=this,{$realtime:a,options:l}=r,{bounds:s,offset:d,ticks:m}=l,{autoSkip:_,source:S,major:T}=m,C=T.enabled;Ws(r,"pause")?Rz(a):(a.frameRequestID||(a.head=Date.now()),MY(a,()=>{const P=r.chart,k=P.$streaming;return ZY(r),k&&mr(k.render,[P]),Ws(r,"frameRate")})),l.bounds=void 0,l.offset=!1,m.autoSkip=!1,m.source=S==="auto"?"":S,T.enabled=!0,super.update(e,t,i),l.bounds=s,l.offset=d,m.autoSkip=_,m.source=S,T.enabled=C}buildTicks(){const e=this,t=Ws(e,"duration"),i=Ws(e,"delay"),r=e.$realtime.head-i,a=r-t,l=[1e15,r],s=[-1e15,a];Object.defineProperty(e,"min",{get:()=>s.shift(),set:Ha}),Object.defineProperty(e,"max",{get:()=>l.shift(),set:Ha});const d=super.buildTicks();return delete e.min,delete e.max,e.min=a,e.max=r,d}calculateLabelRotation(){const e=this.options.ticks,t=e.maxRotation;e.maxRotation=e.minRotation||0,super.calculateLabelRotation(),e.maxRotation=t}fit(){const e=this,t=e.options;super.fit(),t.ticks.display&&t.display&&e.isHorizontal()&&(e.paddingLeft=3,e.paddingRight=3,e._handleMargins())}draw(e){const t=this,{chart:i,ctx:r}=t,a=t.isHorizontal()?{left:e.left,top:0,right:e.right,bottom:i.height}:{left:0,top:e.top,right:i.width,bottom:e.bottom};t._gridLineItems=null,t._labelItems=null,$v(r,a),super.draw(e),Xv(r)}destroy(){const e=this.$realtime;Rz(e),j5(e)}_generate(){const e=this,t=e._adapter,i=Ws(e,"duration"),r=Ws(e,"delay"),a=Ws(e,"refresh"),l=e.$realtime.head-r,s=l-i,d=e._getLabelCapacity(s),{time:m,ticks:_}=e.options,S=m.unit||WY(m.minUnit,s,l,d),T=HY(S),C=m.stepSize||GY(s,l,S,d),P=S==="week"?m.isoWeekday:!1,k=_.major.enabled,R=ag(P)||P===!0,O=s1[S],F={};let N=s,G,j;if(R&&(N=+t.startOf(N,"isoWeek",P)),N=+t.startOf(N,R?"day":S),t.diff(l,s,S)>1e5*C)throw new Error(s+" and "+l+" are too far apart with stepSize of "+C+" "+S);G=N,k&&T&&!R&&!m.round&&(G=+t.startOf(G,T),G=+t.add(G,~~((N-G)/(O.size*C))*C,S));const Q=_.source==="data"&&e.getDataTimestamps();for(j=0;G<l+a;G=+t.add(G,C,S),j++)zz(F,G,Q);return(G===l+a||j===1)&&zz(F,G,Q),Object.keys(F).sort((re,$)=>re-$).map(re=>+re)}}ny.id="realtime";ny.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},realtime:{},ticks:{autoSkip:!1,source:"auto",major:{enabled:!0}}};Fi.describe("scale.realtime",{_scriptable:n=>n!=="onRefresh"});var $Y="2.0.0";Fi.set("transitions",{quiet:{animation:{duration:0}}});const Oz={x:["x","cp1x","cp2x"],y:["y","cp1y","cp2y"]};function XY(n){const e=this;n==="quiet"&&_i(e.data.datasets,(t,i)=>{const r=e.getDatasetMeta(i).controller;r._setStyle=function(a,l,s,d){Pc.prototype._setStyle.call(this,a,l,"quiet",d)}}),Ly.prototype.update.call(e,n),n==="quiet"&&_i(e.data.datasets,(t,i)=>{delete e.getDatasetMeta(i).controller._setStyle})}function YY(n){const e=n.$streaming;n.render(),e.lastMouseEvent&&setTimeout(()=>{const t=e.lastMouseEvent;t&&n._eventHandler(t)},0)}var JY={id:"streaming",version:$Y,beforeInit(n){const e=n.$streaming=n.$streaming||{render:YY},t=e.canvas=n.canvas,i=e.mouseEventListener=r=>{const a=Bf(r,n);e.lastMouseEvent={type:"mousemove",chart:n,native:r,x:a.x,y:a.y}};t.addEventListener("mousedown",i),t.addEventListener("mouseup",i)},afterInit(n){n.update=XY},beforeUpdate(n){const{scales:e,elements:t}=n.options,i=n.tooltip;_i(e,({type:r})=>{r==="realtime"&&(t.line.capBezierPoints=!1)}),i&&(i.update=LY);try{const r=Ea.getPlugin("annotation");IY(r,n)}catch{kY(n)}try{const r=Ea.getPlugin("zoom");UY(r,n)}catch{VY(n)}},beforeDatasetUpdate(n,e){const{meta:t,mode:i}=e;if(i==="quiet"){const{controller:r,$animations:a}=t;a&&a.visible&&a.visible._active&&(r.updateElement=Ha,r.updateSharedOptions=Ha)}},afterDatasetUpdate(n,e){const{meta:t,mode:i}=e,{data:r=[],dataset:a,controller:l}=t;for(let s=0,d=r.length;s<d;++s)r[s].$streaming=sC(r[s],Oz,t);a&&(a.$streaming=sC(a,Oz,t)),i==="quiet"&&(delete l.updateElement,delete l.updateSharedOptions)},beforeDatasetDraw(n,e){const{ctx:t,chartArea:i,width:r,height:a}=n,{xAxisID:l,yAxisID:s,controller:d}=e.meta,m={left:0,top:0,right:r,bottom:a};l&&d.getScaleForId(l)instanceof ny&&(m.left=i.left,m.right=i.right),s&&d.getScaleForId(s)instanceof ny&&(m.top=i.top,m.bottom=i.bottom),$v(t,m)},afterDatasetDraw(n){Xv(n.ctx)},beforeEvent(n,e){const t=n.$streaming,i=e.event;i.type==="mousemove"?t.lastMouseEvent=i:i.type==="mouseout"&&delete t.lastMouseEvent},destroy(n){const{scales:e,$streaming:t,tooltip:i}=n,{canvas:r,mouseEventListener:a}=t;delete n.update,i&&delete i.update,r.removeEventListener("mousedown",a),r.removeEventListener("mouseup",a),_i(e,l=>{l instanceof ny&&l.destroy()})},defaults:{duration:1e4,delay:0,frameRate:30,refresh:1e3,onRefresh:null,pause:!1,ttl:void 0},descriptors:{_scriptable:n=>n!=="onRefresh"}};const KY=[JY,ny];Ly.register(GS,EP,IM,Qv,WZ,JZ,VZ,KY);let QY=$t.forwardRef((n,e)=>{let t,i=[{}];switch(n.type){case"altitude":t="Altitude (m)",i=[{id:1,label:"filtered altitude",backgroundColor:"rgba(255, 99, 132, 0.5)",borderColor:"rgb(255, 99, 132)",data:[],borderWidth:2,pointRadius:2},{id:2,label:"raw altitude",backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgb(54, 162, 235)",data:[],pointRadius:2}];break;case"velocity":t="Velocity (m/s)",i=[{id:1,label:"filtered velocity",backgroundColor:"rgba(255, 99, 132, 0.5)",borderColor:"rgb(255, 99, 132)",data:[]}];break;case"acceleration":t="Acceleration (m/s^2)",i=[{id:1,label:"filtered acceleration",backgroundColor:"rgba(255, 99, 132, 0.5)",borderColor:"rgb(255, 99, 132)",data:[]},{id:2,label:"ax",backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgb(54, 162, 235)",data:[]},{id:3,label:"ay",borderColor:"rgb(255,165,0)",backgroundColor:"rgb(255,165,0,0.1)",data:[]},{id:4,label:"az",borderColor:"rgb(60,186,159)",backgroundColor:"rgb(60,186,159,0.1)",data:[]}];break;case"gyroscope":t="Gyroscope (rad/s)";break;default:t="Altitude (m)"}return gr(b$,{ref:e,data:{datasets:i},options:{datasets:{line:{borderWidth:1,pointRadius:1}},scales:{x:{type:"realtime",realtime:{},ticks:{font:{size:12,weight:"bolder"},color:"#000"},title:{display:!0,text:"Time",font:{size:18,weight:"bolder"},color:"#000"}},y:{ticks:{font:{size:15,weight:"bolder"},color:"#000"},title:{display:!0,text:t,font:{size:18,weight:"bolder"},color:"#000"}}},plugins:{legend:{position:"top",align:"end"},title:{display:!1,text:"Telemetry Graph"}}}})});const Z2=$t.memo(QY);function vd(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Z5(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.11.4
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Ll={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},yy={duration:.5,overwrite:!1,delay:0},zP,ua,Hs,bc=1e8,Dr=1/bc,aC=Math.PI*2,eJ=aC/4,tJ=0,$5=Math.sqrt,nJ=Math.cos,iJ=Math.sin,Mo=function(e){return typeof e=="string"},ws=function(e){return typeof e=="function"},Ud=function(e){return typeof e=="number"},OP=function(e){return typeof e>"u"},bh=function(e){return typeof e=="object"},Qa=function(e){return e!==!1},X5=function(){return typeof window<"u"},Xw=function(e){return ws(e)||Mo(e)},Y5=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ha=Array.isArray,lC=/(?:-?\.?\d|\.)+/gi,J5=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,G_=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,$2=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,K5=/[+-]=-?[.\d]+/,Q5=/[^,'"\[\]\s]+/gi,rJ=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,os,dc,cC,FP,Ol={},$S={},eU,tU=function(e){return($S=ug(e,Ol))&&Fl},BP=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},XS=function(e,t){return!t&&console.warn(e)},nU=function(e,t){return e&&(Ol[e]=t)&&$S&&($S[e]=t)||Ol},gv=function(){return 0},sJ={suppressEvents:!0,isStart:!0,kill:!1},Qb={suppressEvents:!0,kill:!1},oJ={suppressEvents:!0},NP={},up=[],uC={},iU,Cl={},X2={},Fz=30,eS=[],UP="",VP=function(e){var t=e[0],i,r;if(bh(t)||ws(t)||(e=[e]),!(i=(t._gsap||{}).harness)){for(r=eS.length;r--&&!eS[r].targetTest(t););i=eS[r]}for(r=e.length;r--;)e[r]&&(e[r]._gsap||(e[r]._gsap=new TU(e[r],i)))||e.splice(r,1);return e},$m=function(e){return e._gsap||VP(Sc(e))[0]._gsap},rU=function(e,t,i){return(i=e[t])&&ws(i)?e[t]():OP(i)&&e.getAttribute&&e.getAttribute(t)||i},el=function(e,t){return(e=e.split(",")).forEach(t)||e},Ds=function(e){return Math.round(e*1e5)/1e5||0},Ro=function(e){return Math.round(e*1e7)/1e7||0},iy=function(e,t){var i=t.charAt(0),r=parseFloat(t.substr(2));return e=parseFloat(e),i==="+"?e+r:i==="-"?e-r:i==="*"?e*r:e/r},aJ=function(e,t){for(var i=t.length,r=0;e.indexOf(t[r])<0&&++r<i;);return r<i},YS=function(){var e=up.length,t=up.slice(0),i,r;for(uC={},up.length=0,i=0;i<e;i++)r=t[i],r&&r._lazy&&(r.render(r._lazy[0],r._lazy[1],!0)._lazy=0)},sU=function(e,t,i,r){up.length&&!ua&&YS(),e.render(t,i,r||ua&&t<0&&(e._initted||e._startAt)),up.length&&!ua&&YS()},oU=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Q5).length<2?t:Mo(e)?e.trim():e},aU=function(e){return e},Ic=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},lJ=function(e){return function(t,i){for(var r in i)r in t||r==="duration"&&e||r==="ease"||(t[r]=i[r])}},ug=function(e,t){for(var i in t)e[i]=t[i];return e},Bz=function n(e,t){for(var i in t)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(e[i]=bh(t[i])?n(e[i]||(e[i]={}),t[i]):t[i]);return e},JS=function(e,t){var i={},r;for(r in e)r in t||(i[r]=e[r]);return i},Nx=function(e){var t=e.parent||os,i=e.keyframes?lJ(ha(e.keyframes)):Ic;if(Qa(e.inherit))for(;t;)i(e,t.vars.defaults),t=t.parent||t._dp;return e},cJ=function(e,t){for(var i=e.length,r=i===t.length;r&&i--&&e[i]===t[i];);return i<0},lU=function(e,t,i,r,a){i===void 0&&(i="_first"),r===void 0&&(r="_last");var l=e[r],s;if(a)for(s=t[a];l&&l[a]>s;)l=l._prev;return l?(t._next=l._next,l._next=t):(t._next=e[i],e[i]=t),t._next?t._next._prev=t:e[r]=t,t._prev=l,t.parent=t._dp=e,t},OM=function(e,t,i,r){i===void 0&&(i="_first"),r===void 0&&(r="_last");var a=t._prev,l=t._next;a?a._next=l:e[i]===t&&(e[i]=l),l?l._prev=a:e[r]===t&&(e[r]=a),t._next=t._prev=t.parent=null},yp=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},Xm=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var i=e;i;)i._dirty=1,i=i.parent;return e},uJ=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},hC=function(e,t,i,r){return e._startAt&&(ua?e._startAt.revert(Qb):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,r))},hJ=function n(e){return!e||e._ts&&n(e.parent)},Nz=function(e){return e._repeat?xy(e._tTime,e=e.duration()+e._rDelay)*e:0},xy=function(e,t){var i=Math.floor(e/=t);return e&&i===e?i-1:i},KS=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},FM=function(e){return e._end=Ro(e._start+(e._tDur/Math.abs(e._ts||e._rts||Dr)||0))},BM=function(e,t){var i=e._dp;return i&&i.smoothChildTiming&&e._ts&&(e._start=Ro(i._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),FM(e),i._dirty||Xm(i,e)),e},cU=function(e,t){var i;if((t._time||t._initted&&!t._dur)&&(i=KS(e.rawTime(),t),(!t._dur||o1(0,t.totalDuration(),i)-t._tTime>Dr)&&t.render(i,!0)),Xm(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(i=e;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;e._zTime=-Dr}},gh=function(e,t,i,r){return t.parent&&yp(t),t._start=Ro((Ud(i)?i:i||e!==os?hc(e,i,t):e._time)+t._delay),t._end=Ro(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),lU(e,t,"_first","_last",e._sort?"_start":0),dC(t)||(e._recent=t),r||cU(e,t),e._ts<0&&BM(e,e._tTime),e},uU=function(e,t){return(Ol.ScrollTrigger||BP("scrollTrigger",t))&&Ol.ScrollTrigger.create(t,e)},hU=function(e,t,i,r,a){if(WP(e,t,a),!e._initted)return 1;if(!i&&e._pt&&!ua&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&iU!==Il.frame)return up.push(e),e._lazy=[a,r],1},dJ=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},dC=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},fJ=function(e,t,i,r){var a=e.ratio,l=t<0||!t&&(!e._start&&dJ(e)&&!(!e._initted&&dC(e))||(e._ts<0||e._dp._ts<0)&&!dC(e))?0:1,s=e._rDelay,d=0,m,_,S;if(s&&e._repeat&&(d=o1(0,e._tDur,t),_=xy(d,s),e._yoyo&&_&1&&(l=1-l),_!==xy(e._tTime,s)&&(a=1-l,e.vars.repeatRefresh&&e._initted&&e.invalidate())),l!==a||ua||r||e._zTime===Dr||!t&&e._zTime){if(!e._initted&&hU(e,t,r,i,d))return;for(S=e._zTime,e._zTime=t||(i?Dr:0),i||(i=t&&!S),e.ratio=l,e._from&&(l=1-l),e._time=0,e._tTime=d,m=e._pt;m;)m.r(l,m.d),m=m._next;t<0&&hC(e,t,i,!0),e._onUpdate&&!i&&Mc(e,"onUpdate"),d&&e._repeat&&!i&&e.parent&&Mc(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===l&&(l&&yp(e,1),!i&&!ua&&(Mc(e,l?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},pJ=function(e,t,i){var r;if(i>t)for(r=e._first;r&&r._start<=i;){if(r.data==="isPause"&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=i;){if(r.data==="isPause"&&r._start<t)return r;r=r._prev}},vy=function(e,t,i,r){var a=e._repeat,l=Ro(t)||0,s=e._tTime/e._tDur;return s&&!r&&(e._time*=l/e._dur),e._dur=l,e._tDur=a?a<0?1e10:Ro(l*(a+1)+e._rDelay*a):l,s>0&&!r&&BM(e,e._tTime=e._tDur*s),e.parent&&FM(e),i||Xm(e.parent,e),e},Uz=function(e){return e instanceof Za?Xm(e):vy(e,e._dur)},mJ={_start:0,endTime:gv,totalDuration:gv},hc=function n(e,t,i){var r=e.labels,a=e._recent||mJ,l=e.duration()>=bc?a.endTime(!1):e._dur,s,d,m;return Mo(t)&&(isNaN(t)||t in r)?(d=t.charAt(0),m=t.substr(-1)==="%",s=t.indexOf("="),d==="<"||d===">"?(s>=0&&(t=t.replace(/=/,"")),(d==="<"?a._start:a.endTime(a._repeat>=0))+(parseFloat(t.substr(1))||0)*(m?(s<0?a:i).totalDuration()/100:1)):s<0?(t in r||(r[t]=l),r[t]):(d=parseFloat(t.charAt(s-1)+t.substr(s+1)),m&&i&&(d=d/100*(ha(i)?i[0]:i).totalDuration()),s>1?n(e,t.substr(0,s-1),i)+d:l+d)):t==null?l:+t},Ux=function(e,t,i){var r=Ud(t[1]),a=(r?2:1)+(e<2?0:1),l=t[a],s,d;if(r&&(l.duration=t[1]),l.parent=i,e){for(s=l,d=i;d&&!("immediateRender"in s);)s=d.vars.defaults||{},d=Qa(d.vars.inherit)&&d.parent;l.immediateRender=Qa(s.immediateRender),e<2?l.runBackwards=1:l.startAt=t[a-1]}return new no(t[0],l,t[a+1])},Cp=function(e,t){return e||e===0?t(e):t},o1=function(e,t,i){return i<e?e:i>t?t:i},aa=function(e,t){return!Mo(e)||!(t=rJ.exec(e))?"":t[1]},gJ=function(e,t,i){return Cp(i,function(r){return o1(e,t,r)})},fC=[].slice,dU=function(e,t){return e&&bh(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&bh(e[0]))&&!e.nodeType&&e!==dc},_J=function(e,t,i){return i===void 0&&(i=[]),e.forEach(function(r){var a;return Mo(r)&&!t||dU(r,1)?(a=i).push.apply(a,Sc(r)):i.push(r)})||i},Sc=function(e,t,i){return Hs&&!t&&Hs.selector?Hs.selector(e):Mo(e)&&!i&&(cC||!wy())?fC.call((t||FP).querySelectorAll(e),0):ha(e)?_J(e,i):dU(e)?fC.call(e,0):e?[e]:[]},pC=function(e){return e=Sc(e)[0]||XS("Invalid scope")||{},function(t){var i=e.current||e.nativeElement||e;return Sc(t,i.querySelectorAll?i:i===e?XS("Invalid scope")||FP.createElement("div"):e)}},fU=function(e){return e.sort(function(){return .5-Math.random()})},pU=function(e){if(ws(e))return e;var t=bh(e)?e:{each:e},i=Ym(t.ease),r=t.from||0,a=parseFloat(t.base)||0,l={},s=r>0&&r<1,d=isNaN(r)||s,m=t.axis,_=r,S=r;return Mo(r)?_=S={center:.5,edges:.5,end:1}[r]||0:!s&&d&&(_=r[0],S=r[1]),function(T,C,P){var k=(P||t).length,R=l[k],O,F,N,G,j,Q,re,$,ne;if(!R){if(ne=t.grid==="auto"?0:(t.grid||[1,bc])[1],!ne){for(re=-bc;re<(re=P[ne++].getBoundingClientRect().left)&&ne<k;);ne--}for(R=l[k]=[],O=d?Math.min(ne,k)*_-.5:r%ne,F=ne===bc?0:d?k*S/ne-.5:r/ne|0,re=0,$=bc,Q=0;Q<k;Q++)N=Q%ne-O,G=F-(Q/ne|0),R[Q]=j=m?Math.abs(m==="y"?G:N):$5(N*N+G*G),j>re&&(re=j),j<$&&($=j);r==="random"&&fU(R),R.max=re-$,R.min=$,R.v=k=(parseFloat(t.amount)||parseFloat(t.each)*(ne>k?k-1:m?m==="y"?k/ne:ne:Math.max(ne,k/ne))||0)*(r==="edges"?-1:1),R.b=k<0?a-k:a,R.u=aa(t.amount||t.each)||0,i=i&&k<0?bU(i):i}return k=(R[T]-R.min)/R.max||0,Ro(R.b+(i?i(k):k)*R.v)+R.u}},mC=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(i){var r=Ro(Math.round(parseFloat(i)/e)*e*t);return(r-r%1)/t+(Ud(i)?0:aa(i))}},mU=function(e,t){var i=ha(e),r,a;return!i&&bh(e)&&(r=i=e.radius||bc,e.values?(e=Sc(e.values),(a=!Ud(e[0]))&&(r*=r)):e=mC(e.increment)),Cp(t,i?ws(e)?function(l){return a=e(l),Math.abs(a-l)<=r?a:l}:function(l){for(var s=parseFloat(a?l.x:l),d=parseFloat(a?l.y:0),m=bc,_=0,S=e.length,T,C;S--;)a?(T=e[S].x-s,C=e[S].y-d,T=T*T+C*C):T=Math.abs(e[S]-s),T<m&&(m=T,_=S);return _=!r||m<=r?e[_]:l,a||_===l||Ud(l)?_:_+aa(l)}:mC(e))},gU=function(e,t,i,r){return Cp(ha(e)?!t:i===!0?!!(i=0):!r,function(){return ha(e)?e[~~(Math.random()*e.length)]:(i=i||1e-5)&&(r=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((e-i/2+Math.random()*(t-e+i*.99))/i)*i*r)/r})},yJ=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(r){return t.reduce(function(a,l){return l(a)},r)}},xJ=function(e,t){return function(i){return e(parseFloat(i))+(t||aa(i))}},vJ=function(e,t,i){return yU(e,t,0,1,i)},_U=function(e,t,i){return Cp(i,function(r){return e[~~t(r)]})},wJ=function n(e,t,i){var r=t-e;return ha(e)?_U(e,n(0,e.length),t):Cp(i,function(a){return(r+(a-e)%r)%r+e})},bJ=function n(e,t,i){var r=t-e,a=r*2;return ha(e)?_U(e,n(0,e.length-1),t):Cp(i,function(l){return l=(a+(l-e)%a)%a||0,e+(l>r?a-l:l)})},_v=function(e){for(var t=0,i="",r,a,l,s;~(r=e.indexOf("random(",t));)l=e.indexOf(")",r),s=e.charAt(r+7)==="[",a=e.substr(r+7,l-r-7).match(s?Q5:lC),i+=e.substr(t,r-t)+gU(s?a:+a[0],s?0:+a[1],+a[2]||1e-5),t=l+1;return i+e.substr(t,e.length-t)},yU=function(e,t,i,r,a){var l=t-e,s=r-i;return Cp(a,function(d){return i+((d-e)/l*s||0)})},SJ=function n(e,t,i,r){var a=isNaN(e+t)?0:function(C){return(1-C)*e+C*t};if(!a){var l=Mo(e),s={},d,m,_,S,T;if(i===!0&&(r=1)&&(i=null),l)e={p:e},t={p:t};else if(ha(e)&&!ha(t)){for(_=[],S=e.length,T=S-2,m=1;m<S;m++)_.push(n(e[m-1],e[m]));S--,a=function(P){P*=S;var k=Math.min(T,~~P);return _[k](P-k)},i=t}else r||(e=ug(ha(e)?[]:{},e));if(!_){for(d in t)GP.call(s,e,d,"get",t[d]);a=function(P){return qP(P,s)||(l?e.p:e)}}}return Cp(i,a)},Vz=function(e,t,i){var r=e.labels,a=bc,l,s,d;for(l in r)s=r[l]-t,s<0==!!i&&s&&a>(s=Math.abs(s))&&(d=l,a=s);return d},Mc=function(e,t,i){var r=e.vars,a=r[t],l=Hs,s=e._ctx,d,m,_;if(a)return d=r[t+"Params"],m=r.callbackScope||e,i&&up.length&&YS(),s&&(Hs=s),_=d?a.apply(m,d):a.call(m),Hs=l,_},vx=function(e){return yp(e),e.scrollTrigger&&e.scrollTrigger.kill(!!ua),e.progress()<1&&Mc(e,"onInterrupt"),e},W_,MJ=function(e){e=!e.name&&e.default||e;var t=e.name,i=ws(e),r=t&&!i&&e.init?function(){this._props=[]}:e,a={init:gv,render:qP,add:GP,kill:UJ,modifier:NJ,rawVars:0},l={targetTest:0,get:0,getSetter:jP,aliases:{},register:0};if(wy(),e!==r){if(Cl[t])return;Ic(r,Ic(JS(e,a),l)),ug(r.prototype,ug(a,JS(e,l))),Cl[r.prop=t]=r,e.targetTest&&(eS.push(r),NP[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}nU(t,r),e.register&&e.register(Fl,r,tl)},Pr=255,wx={aqua:[0,Pr,Pr],lime:[0,Pr,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Pr],navy:[0,0,128],white:[Pr,Pr,Pr],olive:[128,128,0],yellow:[Pr,Pr,0],orange:[Pr,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Pr,0,0],pink:[Pr,192,203],cyan:[0,Pr,Pr],transparent:[Pr,Pr,Pr,0]},Y2=function(e,t,i){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(i-t)*e*6:e<.5?i:e*3<2?t+(i-t)*(2/3-e)*6:t)*Pr+.5|0},xU=function(e,t,i){var r=e?Ud(e)?[e>>16,e>>8&Pr,e&Pr]:0:wx.black,a,l,s,d,m,_,S,T,C,P;if(!r){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),wx[e])r=wx[e];else if(e.charAt(0)==="#"){if(e.length<6&&(a=e.charAt(1),l=e.charAt(2),s=e.charAt(3),e="#"+a+a+l+l+s+s+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return r=parseInt(e.substr(1,6),16),[r>>16,r>>8&Pr,r&Pr,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),r=[e>>16,e>>8&Pr,e&Pr]}else if(e.substr(0,3)==="hsl"){if(r=P=e.match(lC),!t)d=+r[0]%360/360,m=+r[1]/100,_=+r[2]/100,l=_<=.5?_*(m+1):_+m-_*m,a=_*2-l,r.length>3&&(r[3]*=1),r[0]=Y2(d+1/3,a,l),r[1]=Y2(d,a,l),r[2]=Y2(d-1/3,a,l);else if(~e.indexOf("="))return r=e.match(J5),i&&r.length<4&&(r[3]=1),r}else r=e.match(lC)||wx.transparent;r=r.map(Number)}return t&&!P&&(a=r[0]/Pr,l=r[1]/Pr,s=r[2]/Pr,S=Math.max(a,l,s),T=Math.min(a,l,s),_=(S+T)/2,S===T?d=m=0:(C=S-T,m=_>.5?C/(2-S-T):C/(S+T),d=S===a?(l-s)/C+(l<s?6:0):S===l?(s-a)/C+2:(a-l)/C+4,d*=60),r[0]=~~(d+.5),r[1]=~~(m*100+.5),r[2]=~~(_*100+.5)),i&&r.length<4&&(r[3]=1),r},vU=function(e){var t=[],i=[],r=-1;return e.split(hp).forEach(function(a){var l=a.match(G_)||[];t.push.apply(t,l),i.push(r+=l.length+1)}),t.c=i,t},Gz=function(e,t,i){var r="",a=(e+r).match(hp),l=t?"hsla(":"rgba(",s=0,d,m,_,S;if(!a)return e;if(a=a.map(function(T){return(T=xU(T,t,1))&&l+(t?T[0]+","+T[1]+"%,"+T[2]+"%,"+T[3]:T.join(","))+")"}),i&&(_=vU(e),d=i.c,d.join(r)!==_.c.join(r)))for(m=e.replace(hp,"1").split(G_),S=m.length-1;s<S;s++)r+=m[s]+(~d.indexOf(s)?a.shift()||l+"0,0,0,0)":(_.length?_:a.length?a:i).shift());if(!m)for(m=e.split(hp),S=m.length-1;s<S;s++)r+=m[s]+a[s];return r+m[S]},hp=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in wx)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),TJ=/hsl[a]?\(/,wU=function(e){var t=e.join(" "),i;if(hp.lastIndex=0,hp.test(t))return i=TJ.test(t),e[1]=Gz(e[1],i),e[0]=Gz(e[0],i,vU(e[1])),!0},yv,Il=function(){var n=Date.now,e=500,t=33,i=n(),r=i,a=1e3/240,l=a,s=[],d,m,_,S,T,C,P=function k(R){var O=n()-r,F=R===!0,N,G,j,Q;if(O>e&&(i+=O-t),r+=O,j=r-i,N=j-l,(N>0||F)&&(Q=++S.frame,T=j-S.time*1e3,S.time=j=j/1e3,l+=N+(N>=a?4:a-N),G=1),F||(d=m(k)),G)for(C=0;C<s.length;C++)s[C](j,T,Q,R)};return S={time:0,frame:0,tick:function(){P(!0)},deltaRatio:function(R){return T/(1e3/(R||60))},wake:function(){eU&&(!cC&&X5()&&(dc=cC=window,FP=dc.document||{},Ol.gsap=Fl,(dc.gsapVersions||(dc.gsapVersions=[])).push(Fl.version),tU($S||dc.GreenSockGlobals||!dc.gsap&&dc||{}),_=dc.requestAnimationFrame),d&&S.sleep(),m=_||function(R){return setTimeout(R,l-S.time*1e3+1|0)},yv=1,P(2))},sleep:function(){(_?dc.cancelAnimationFrame:clearTimeout)(d),yv=0,m=gv},lagSmoothing:function(R,O){e=R||1/0,t=Math.min(O||33,e)},fps:function(R){a=1e3/(R||240),l=S.time*1e3+a},add:function(R,O,F){var N=O?function(G,j,Q,re){R(G,j,Q,re),S.remove(N)}:R;return S.remove(R),s[F?"unshift":"push"](N),wy(),N},remove:function(R,O){~(O=s.indexOf(R))&&s.splice(O,1)&&C>=O&&C--},_listeners:s},S}(),wy=function(){return!yv&&Il.wake()},ji={},EJ=/^[\d.\-M][\d.\-,\s]/,AJ=/["']/g,CJ=function(e){for(var t={},i=e.substr(1,e.length-3).split(":"),r=i[0],a=1,l=i.length,s,d,m;a<l;a++)d=i[a],s=a!==l-1?d.lastIndexOf(","):d.length,m=d.substr(0,s),t[r]=isNaN(m)?m.replace(AJ,"").trim():+m,r=d.substr(s+1).trim();return t},IJ=function(e){var t=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",t);return e.substring(t,~r&&r<i?e.indexOf(")",i+1):i)},PJ=function(e){var t=(e+"").split("("),i=ji[t[0]];return i&&t.length>1&&i.config?i.config.apply(null,~e.indexOf("{")?[CJ(t[1])]:IJ(e).split(",").map(oU)):ji._CE&&EJ.test(e)?ji._CE("",e):i},bU=function(e){return function(t){return 1-e(1-t)}},SU=function n(e,t){for(var i=e._first,r;i;)i instanceof Za?n(i,t):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==t&&(i.timeline?n(i.timeline,t):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=t)),i=i._next},Ym=function(e,t){return e&&(ws(e)?e:ji[e]||PJ(e))||t},xg=function(e,t,i,r){i===void 0&&(i=function(d){return 1-t(1-d)}),r===void 0&&(r=function(d){return d<.5?t(d*2)/2:1-t((1-d)*2)/2});var a={easeIn:t,easeOut:i,easeInOut:r},l;return el(e,function(s){ji[s]=Ol[s]=a,ji[l=s.toLowerCase()]=i;for(var d in a)ji[l+(d==="easeIn"?".in":d==="easeOut"?".out":".inOut")]=ji[s+"."+d]=a[d]}),a},MU=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},J2=function n(e,t,i){var r=t>=1?t:1,a=(i||(e?.3:.45))/(t<1?t:1),l=a/aC*(Math.asin(1/r)||0),s=function(_){return _===1?1:r*Math.pow(2,-10*_)*iJ((_-l)*a)+1},d=e==="out"?s:e==="in"?function(m){return 1-s(1-m)}:MU(s);return a=aC/a,d.config=function(m,_){return n(e,m,_)},d},K2=function n(e,t){t===void 0&&(t=1.70158);var i=function(l){return l?--l*l*((t+1)*l+t)+1:0},r=e==="out"?i:e==="in"?function(a){return 1-i(1-a)}:MU(i);return r.config=function(a){return n(e,a)},r};el("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;xg(n+",Power"+(t-1),e?function(i){return Math.pow(i,t)}:function(i){return i},function(i){return 1-Math.pow(1-i,t)},function(i){return i<.5?Math.pow(i*2,t)/2:1-Math.pow((1-i)*2,t)/2})});ji.Linear.easeNone=ji.none=ji.Linear.easeIn;xg("Elastic",J2("in"),J2("out"),J2());(function(n,e){var t=1/e,i=2*t,r=2.5*t,a=function(s){return s<t?n*s*s:s<i?n*Math.pow(s-1.5/e,2)+.75:s<r?n*(s-=2.25/e)*s+.9375:n*Math.pow(s-2.625/e,2)+.984375};xg("Bounce",function(l){return 1-a(1-l)},a)})(7.5625,2.75);xg("Expo",function(n){return n?Math.pow(2,10*(n-1)):0});xg("Circ",function(n){return-($5(1-n*n)-1)});xg("Sine",function(n){return n===1?1:-nJ(n*eJ)+1});xg("Back",K2("in"),K2("out"),K2());ji.SteppedEase=ji.steps=Ol.SteppedEase={config:function(e,t){e===void 0&&(e=1);var i=1/e,r=e+(t?0:1),a=t?1:0,l=1-Dr;return function(s){return((r*o1(0,l,s)|0)+a)*i}}};yy.ease=ji["quad.out"];el("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return UP+=n+","+n+"Params,"});var TU=function(e,t){this.id=tJ++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:rU,this.set=t?t.getSetter:jP},by=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,vy(this,+t.duration,1,1),this.data=t.data,Hs&&(this._ctx=Hs,Hs.data.push(this)),yv||Il.wake()}var e=n.prototype;return e.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},e.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},e.totalDuration=function(i){return arguments.length?(this._dirty=0,vy(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(i,r){if(wy(),!arguments.length)return this._tTime;var a=this._dp;if(a&&a.smoothChildTiming&&this._ts){for(BM(this,i),!a._dp||a.parent||cU(a,this);a&&a.parent;)a.parent._time!==a._start+(a._ts>=0?a._tTime/a._ts:(a.totalDuration()-a._tTime)/-a._ts)&&a.totalTime(a._tTime,!0),a=a.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&gh(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===Dr||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),sU(this,i,r)),this},e.time=function(i,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+Nz(this))%(this._dur+this._rDelay)||(i?this._dur:0),r):this._time},e.totalProgress=function(i,r){return arguments.length?this.totalTime(this.totalDuration()*i,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(i,r){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+Nz(this),r):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(i,r){var a=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*a,r):this._repeat?xy(this._tTime,a)+1:1},e.timeScale=function(i){if(!arguments.length)return this._rts===-Dr?0:this._rts;if(this._rts===i)return this;var r=this.parent&&this._ts?KS(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-Dr?0:this._rts,this.totalTime(o1(-this._delay,this._tDur,r),!0),FM(this),uJ(this)},e.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(wy(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Dr&&(this._tTime-=Dr)))),this):this._ps},e.startTime=function(i){if(arguments.length){this._start=i;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&gh(r,this,i-this._delay),this}return this._start},e.endTime=function(i){return this._start+(Qa(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(i){var r=this.parent||this._dp;return r?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?KS(r.rawTime(i),this):this._tTime:this._tTime},e.revert=function(i){i===void 0&&(i=oJ);var r=ua;return ua=i,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents)),this.data!=="nested"&&i.kill!==!1&&this.kill(),ua=r,this},e.globalTime=function(i){for(var r=this,a=arguments.length?i:r.rawTime();r;)a=r._start+a/(r._ts||1),r=r._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1:this._sat.globalTime(i):a},e.repeat=function(i){return arguments.length?(this._repeat=i===1/0?-2:i,Uz(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(i){if(arguments.length){var r=this._time;return this._rDelay=i,Uz(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},e.seek=function(i,r){return this.totalTime(hc(this,i),Qa(r))},e.restart=function(i,r){return this.play().totalTime(i?-this._delay:0,Qa(r))},e.play=function(i,r){return i!=null&&this.seek(i,r),this.reversed(!1).paused(!1)},e.reverse=function(i,r){return i!=null&&this.seek(i||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(i,r){return i!=null&&this.seek(i,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-Dr:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Dr,this},e.isActive=function(){var i=this.parent||this._dp,r=this._start,a;return!!(!i||this._ts&&this._initted&&i.isActive()&&(a=i.rawTime(!0))>=r&&a<this.endTime(!0)-Dr)},e.eventCallback=function(i,r,a){var l=this.vars;return arguments.length>1?(r?(l[i]=r,a&&(l[i+"Params"]=a),i==="onUpdate"&&(this._onUpdate=r)):delete l[i],this):l[i]},e.then=function(i){var r=this;return new Promise(function(a){var l=ws(i)?i:aU,s=function(){var m=r.then;r.then=null,ws(l)&&(l=l(r))&&(l.then||l===r)&&(r.then=m),a(l),r.then=m};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?s():r._prom=s})},e.kill=function(){vx(this)},n}();Ic(by.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Dr,_prom:0,_ps:!1,_rts:1});var Za=function(n){Z5(e,n);function e(i,r){var a;return i===void 0&&(i={}),a=n.call(this,i)||this,a.labels={},a.smoothChildTiming=!!i.smoothChildTiming,a.autoRemoveChildren=!!i.autoRemoveChildren,a._sort=Qa(i.sortChildren),os&&gh(i.parent||os,vd(a),r),i.reversed&&a.reverse(),i.paused&&a.paused(!0),i.scrollTrigger&&uU(vd(a),i.scrollTrigger),a}var t=e.prototype;return t.to=function(r,a,l){return Ux(0,arguments,this),this},t.from=function(r,a,l){return Ux(1,arguments,this),this},t.fromTo=function(r,a,l,s){return Ux(2,arguments,this),this},t.set=function(r,a,l){return a.duration=0,a.parent=this,Nx(a).repeatDelay||(a.repeat=0),a.immediateRender=!!a.immediateRender,new no(r,a,hc(this,l),1),this},t.call=function(r,a,l){return gh(this,no.delayedCall(0,r,a),l)},t.staggerTo=function(r,a,l,s,d,m,_){return l.duration=a,l.stagger=l.stagger||s,l.onComplete=m,l.onCompleteParams=_,l.parent=this,new no(r,l,hc(this,d)),this},t.staggerFrom=function(r,a,l,s,d,m,_){return l.runBackwards=1,Nx(l).immediateRender=Qa(l.immediateRender),this.staggerTo(r,a,l,s,d,m,_)},t.staggerFromTo=function(r,a,l,s,d,m,_,S){return s.startAt=l,Nx(s).immediateRender=Qa(s.immediateRender),this.staggerTo(r,a,s,d,m,_,S)},t.render=function(r,a,l){var s=this._time,d=this._dirty?this.totalDuration():this._tDur,m=this._dur,_=r<=0?0:Ro(r),S=this._zTime<0!=r<0&&(this._initted||!m),T,C,P,k,R,O,F,N,G,j,Q,re;if(this!==os&&_>d&&r>=0&&(_=d),_!==this._tTime||l||S){if(s!==this._time&&m&&(_+=this._time-s,r+=this._time-s),T=_,G=this._start,N=this._ts,O=!N,S&&(m||(s=this._zTime),(r||!a)&&(this._zTime=r)),this._repeat){if(Q=this._yoyo,R=m+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(R*100+r,a,l);if(T=Ro(_%R),_===d?(k=this._repeat,T=m):(k=~~(_/R),k&&k===_/R&&(T=m,k--),T>m&&(T=m)),j=xy(this._tTime,R),!s&&this._tTime&&j!==k&&(j=k),Q&&k&1&&(T=m-T,re=1),k!==j&&!this._lock){var $=Q&&j&1,ne=$===(Q&&k&1);if(k<j&&($=!$),s=$?0:m,this._lock=1,this.render(s||(re?0:Ro(k*R)),a,!m)._lock=0,this._tTime=_,!a&&this.parent&&Mc(this,"onRepeat"),this.vars.repeatRefresh&&!re&&(this.invalidate()._lock=1),s&&s!==this._time||O!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(m=this._dur,d=this._tDur,ne&&(this._lock=2,s=$?m:-1e-4,this.render(s,!0),this.vars.repeatRefresh&&!re&&this.invalidate()),this._lock=0,!this._ts&&!O)return this;SU(this,re)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(F=pJ(this,Ro(s),Ro(T)),F&&(_-=T-(T=F._start))),this._tTime=_,this._time=T,this._act=!N,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,s=0),!s&&T&&!a&&(Mc(this,"onStart"),this._tTime!==_))return this;if(T>=s&&r>=0)for(C=this._first;C;){if(P=C._next,(C._act||T>=C._start)&&C._ts&&F!==C){if(C.parent!==this)return this.render(r,a,l);if(C.render(C._ts>0?(T-C._start)*C._ts:(C._dirty?C.totalDuration():C._tDur)+(T-C._start)*C._ts,a,l),T!==this._time||!this._ts&&!O){F=0,P&&(_+=this._zTime=-Dr);break}}C=P}else{C=this._last;for(var ue=r<0?r:T;C;){if(P=C._prev,(C._act||ue<=C._end)&&C._ts&&F!==C){if(C.parent!==this)return this.render(r,a,l);if(C.render(C._ts>0?(ue-C._start)*C._ts:(C._dirty?C.totalDuration():C._tDur)+(ue-C._start)*C._ts,a,l||ua&&(C._initted||C._startAt)),T!==this._time||!this._ts&&!O){F=0,P&&(_+=this._zTime=ue?-Dr:Dr);break}}C=P}}if(F&&!a&&(this.pause(),F.render(T>=s?0:-Dr)._zTime=T>=s?1:-1,this._ts))return this._start=G,FM(this),this.render(r,a,l);this._onUpdate&&!a&&Mc(this,"onUpdate",!0),(_===d&&this._tTime>=this.totalDuration()||!_&&s)&&(G===this._start||Math.abs(N)!==Math.abs(this._ts))&&(this._lock||((r||!m)&&(_===d&&this._ts>0||!_&&this._ts<0)&&yp(this,1),!a&&!(r<0&&!s)&&(_||s||!d)&&(Mc(this,_===d&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(_<d&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,a){var l=this;if(Ud(a)||(a=hc(this,a,r)),!(r instanceof by)){if(ha(r))return r.forEach(function(s){return l.add(s,a)}),this;if(Mo(r))return this.addLabel(r,a);if(ws(r))r=no.delayedCall(0,r);else return this}return this!==r?gh(this,r,a):this},t.getChildren=function(r,a,l,s){r===void 0&&(r=!0),a===void 0&&(a=!0),l===void 0&&(l=!0),s===void 0&&(s=-bc);for(var d=[],m=this._first;m;)m._start>=s&&(m instanceof no?a&&d.push(m):(l&&d.push(m),r&&d.push.apply(d,m.getChildren(!0,a,l)))),m=m._next;return d},t.getById=function(r){for(var a=this.getChildren(1,1,1),l=a.length;l--;)if(a[l].vars.id===r)return a[l]},t.remove=function(r){return Mo(r)?this.removeLabel(r):ws(r)?this.killTweensOf(r):(OM(this,r),r===this._recent&&(this._recent=this._last),Xm(this))},t.totalTime=function(r,a){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Ro(Il.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),n.prototype.totalTime.call(this,r,a),this._forcing=0,this):this._tTime},t.addLabel=function(r,a){return this.labels[r]=hc(this,a),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,a,l){var s=no.delayedCall(0,a||gv,l);return s.data="isPause",this._hasPause=1,gh(this,s,hc(this,r))},t.removePause=function(r){var a=this._first;for(r=hc(this,r);a;)a._start===r&&a.data==="isPause"&&yp(a),a=a._next},t.killTweensOf=function(r,a,l){for(var s=this.getTweensOf(r,l),d=s.length;d--;)Xf!==s[d]&&s[d].kill(r,a);return this},t.getTweensOf=function(r,a){for(var l=[],s=Sc(r),d=this._first,m=Ud(a),_;d;)d instanceof no?aJ(d._targets,s)&&(m?(!Xf||d._initted&&d._ts)&&d.globalTime(0)<=a&&d.globalTime(d.totalDuration())>a:!a||d.isActive())&&l.push(d):(_=d.getTweensOf(s,a)).length&&l.push.apply(l,_),d=d._next;return l},t.tweenTo=function(r,a){a=a||{};var l=this,s=hc(l,r),d=a,m=d.startAt,_=d.onStart,S=d.onStartParams,T=d.immediateRender,C,P=no.to(l,Ic({ease:a.ease||"none",lazy:!1,immediateRender:!1,time:s,overwrite:"auto",duration:a.duration||Math.abs((s-(m&&"time"in m?m.time:l._time))/l.timeScale())||Dr,onStart:function(){if(l.pause(),!C){var R=a.duration||Math.abs((s-(m&&"time"in m?m.time:l._time))/l.timeScale());P._dur!==R&&vy(P,R,0,1).render(P._time,!0,!0),C=1}_&&_.apply(P,S||[])}},a));return T?P.render(0):P},t.tweenFromTo=function(r,a,l){return this.tweenTo(a,Ic({startAt:{time:hc(this,r)}},l))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),Vz(this,hc(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),Vz(this,hc(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+Dr)},t.shiftChildren=function(r,a,l){l===void 0&&(l=0);for(var s=this._first,d=this.labels,m;s;)s._start>=l&&(s._start+=r,s._end+=r),s=s._next;if(a)for(m in d)d[m]>=l&&(d[m]+=r);return Xm(this)},t.invalidate=function(r){var a=this._first;for(this._lock=0;a;)a.invalidate(r),a=a._next;return n.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var a=this._first,l;a;)l=a._next,this.remove(a),a=l;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),Xm(this)},t.totalDuration=function(r){var a=0,l=this,s=l._last,d=bc,m,_,S;if(arguments.length)return l.timeScale((l._repeat<0?l.duration():l.totalDuration())/(l.reversed()?-r:r));if(l._dirty){for(S=l.parent;s;)m=s._prev,s._dirty&&s.totalDuration(),_=s._start,_>d&&l._sort&&s._ts&&!l._lock?(l._lock=1,gh(l,s,_-s._delay,1)._lock=0):d=_,_<0&&s._ts&&(a-=_,(!S&&!l._dp||S&&S.smoothChildTiming)&&(l._start+=_/l._ts,l._time-=_,l._tTime-=_),l.shiftChildren(-_,!1,-1/0),d=0),s._end>a&&s._ts&&(a=s._end),s=m;vy(l,l===os&&l._time>a?l._time:a,1,1),l._dirty=0}return l._tDur},e.updateRoot=function(r){if(os._ts&&(sU(os,KS(r,os)),iU=Il.frame),Il.frame>=Fz){Fz+=Ll.autoSleep||120;var a=os._first;if((!a||!a._ts)&&Ll.autoSleep&&Il._listeners.length<2){for(;a&&!a._ts;)a=a._next;a||Il.sleep()}}},e}(by);Ic(Za.prototype,{_lock:0,_hasPause:0,_forcing:0});var kJ=function(e,t,i,r,a,l,s){var d=new tl(this._pt,e,t,0,1,kU,null,a),m=0,_=0,S,T,C,P,k,R,O,F;for(d.b=i,d.e=r,i+="",r+="",(O=~r.indexOf("random("))&&(r=_v(r)),l&&(F=[i,r],l(F,e,t),i=F[0],r=F[1]),T=i.match($2)||[];S=$2.exec(r);)P=S[0],k=r.substring(m,S.index),C?C=(C+1)%5:k.substr(-5)==="rgba("&&(C=1),P!==T[_++]&&(R=parseFloat(T[_-1])||0,d._pt={_next:d._pt,p:k||_===1?k:",",s:R,c:P.charAt(1)==="="?iy(R,P)-R:parseFloat(P)-R,m:C&&C<4?Math.round:0},m=$2.lastIndex);return d.c=m<r.length?r.substring(m,r.length):"",d.fp=s,(K5.test(r)||O)&&(d.e=0),this._pt=d,d},GP=function(e,t,i,r,a,l,s,d,m,_){ws(r)&&(r=r(a||0,e,l));var S=e[t],T=i!=="get"?i:ws(S)?m?e[t.indexOf("set")||!ws(e["get"+t.substr(3)])?t:"get"+t.substr(3)](m):e[t]():S,C=ws(S)?m?OJ:IU:HP,P;if(Mo(r)&&(~r.indexOf("random(")&&(r=_v(r)),r.charAt(1)==="="&&(P=iy(T,r)+(aa(T)||0),(P||P===0)&&(r=P))),!_||T!==r||gC)return!isNaN(T*r)&&r!==""?(P=new tl(this._pt,e,t,+T||0,r-(T||0),typeof S=="boolean"?BJ:PU,0,C),m&&(P.fp=m),s&&P.modifier(s,this,e),this._pt=P):(!S&&!(t in e)&&BP(t,r),kJ.call(this,e,t,T,r,C,d||Ll.stringFilter,m))},DJ=function(e,t,i,r,a){if(ws(e)&&(e=Vx(e,a,t,i,r)),!bh(e)||e.style&&e.nodeType||ha(e)||Y5(e))return Mo(e)?Vx(e,a,t,i,r):e;var l={},s;for(s in e)l[s]=Vx(e[s],a,t,i,r);return l},EU=function(e,t,i,r,a,l){var s,d,m,_;if(Cl[e]&&(s=new Cl[e]).init(a,s.rawVars?t[e]:DJ(t[e],r,a,l,i),i,r,l)!==!1&&(i._pt=d=new tl(i._pt,a,e,0,1,s.render,s,0,s.priority),i!==W_))for(m=i._ptLookup[i._targets.indexOf(a)],_=s._props.length;_--;)m[s._props[_]]=d;return s},Xf,gC,WP=function n(e,t,i){var r=e.vars,a=r.ease,l=r.startAt,s=r.immediateRender,d=r.lazy,m=r.onUpdate,_=r.onUpdateParams,S=r.callbackScope,T=r.runBackwards,C=r.yoyoEase,P=r.keyframes,k=r.autoRevert,R=e._dur,O=e._startAt,F=e._targets,N=e.parent,G=N&&N.data==="nested"?N.vars.targets:F,j=e._overwrite==="auto"&&!zP,Q=e.timeline,re,$,ne,ue,De,$e,ae,le,fe,Oe,We,ce,Te;if(Q&&(!P||!a)&&(a="none"),e._ease=Ym(a,yy.ease),e._yEase=C?bU(Ym(C===!0?a:C,yy.ease)):0,C&&e._yoyo&&!e._repeat&&(C=e._yEase,e._yEase=e._ease,e._ease=C),e._from=!Q&&!!r.runBackwards,!Q||P&&!r.stagger){if(le=F[0]?$m(F[0]).harness:0,ce=le&&r[le.prop],re=JS(r,NP),O&&(O._zTime<0&&O.progress(1),t<0&&T&&s&&!k?O.render(-1,!0):O.revert(T&&R?Qb:sJ),O._lazy=0),l){if(yp(e._startAt=no.set(F,Ic({data:"isStart",overwrite:!1,parent:N,immediateRender:!0,lazy:!O&&Qa(d),startAt:null,delay:0,onUpdate:m,onUpdateParams:_,callbackScope:S,stagger:0},l))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ua||!s&&!k)&&e._startAt.revert(Qb),s&&R&&t<=0&&i<=0){t&&(e._zTime=t);return}}else if(T&&R&&!O){if(t&&(s=!1),ne=Ic({overwrite:!1,data:"isFromStart",lazy:s&&!O&&Qa(d),immediateRender:s,stagger:0,parent:N},re),ce&&(ne[le.prop]=ce),yp(e._startAt=no.set(F,ne)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ua?e._startAt.revert(Qb):e._startAt.render(-1,!0)),e._zTime=t,!s)n(e._startAt,Dr,Dr);else if(!t)return}for(e._pt=e._ptCache=0,d=R&&Qa(d)||d&&!R,$=0;$<F.length;$++){if(De=F[$],ae=De._gsap||VP(F)[$]._gsap,e._ptLookup[$]=Oe={},uC[ae.id]&&up.length&&YS(),We=G===F?$:G.indexOf(De),le&&(fe=new le).init(De,ce||re,e,We,G)!==!1&&(e._pt=ue=new tl(e._pt,De,fe.name,0,1,fe.render,fe,0,fe.priority),fe._props.forEach(function(Pe){Oe[Pe]=ue}),fe.priority&&($e=1)),!le||ce)for(ne in re)Cl[ne]&&(fe=EU(ne,re,e,We,De,G))?fe.priority&&($e=1):Oe[ne]=ue=GP.call(e,De,ne,"get",re[ne],We,G,0,r.stringFilter);e._op&&e._op[$]&&e.kill(De,e._op[$]),j&&e._pt&&(Xf=e,os.killTweensOf(De,Oe,e.globalTime(t)),Te=!e.parent,Xf=0),e._pt&&d&&(uC[ae.id]=1)}$e&&DU(e),e._onInit&&e._onInit(e)}e._onUpdate=m,e._initted=(!e._op||e._pt)&&!Te,P&&t<=0&&Q.render(bc,!0,!0)},LJ=function(e,t,i,r,a,l,s){var d=(e._pt&&e._ptCache||(e._ptCache={}))[t],m,_,S,T;if(!d)for(d=e._ptCache[t]=[],S=e._ptLookup,T=e._targets.length;T--;){if(m=S[T][t],m&&m.d&&m.d._pt)for(m=m.d._pt;m&&m.p!==t&&m.fp!==t;)m=m._next;if(!m)return gC=1,e.vars[t]="+=0",WP(e,s),gC=0,1;d.push(m)}for(T=d.length;T--;)_=d[T],m=_._pt||_,m.s=(r||r===0)&&!a?r:m.s+(r||0)+l*m.c,m.c=i-m.s,_.e&&(_.e=Ds(i)+aa(_.e)),_.b&&(_.b=m.s+aa(_.b))},RJ=function(e,t){var i=e[0]?$m(e[0]).harness:0,r=i&&i.aliases,a,l,s,d;if(!r)return t;a=ug({},t);for(l in r)if(l in a)for(d=r[l].split(","),s=d.length;s--;)a[d[s]]=a[l];return a},zJ=function(e,t,i,r){var a=t.ease||r||"power1.inOut",l,s;if(ha(t))s=i[e]||(i[e]=[]),t.forEach(function(d,m){return s.push({t:m/(t.length-1)*100,v:d,e:a})});else for(l in t)s=i[l]||(i[l]=[]),l==="ease"||s.push({t:parseFloat(e),v:t[l],e:a})},Vx=function(e,t,i,r,a){return ws(e)?e.call(t,i,r,a):Mo(e)&&~e.indexOf("random(")?_v(e):e},AU=UP+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",CU={};el(AU+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return CU[n]=1});var no=function(n){Z5(e,n);function e(i,r,a,l){var s;typeof r=="number"&&(a.duration=r,r=a,a=null),s=n.call(this,l?r:Nx(r))||this;var d=s.vars,m=d.duration,_=d.delay,S=d.immediateRender,T=d.stagger,C=d.overwrite,P=d.keyframes,k=d.defaults,R=d.scrollTrigger,O=d.yoyoEase,F=r.parent||os,N=(ha(i)||Y5(i)?Ud(i[0]):"length"in r)?[i]:Sc(i),G,j,Q,re,$,ne,ue,De;if(s._targets=N.length?VP(N):XS("GSAP target "+i+" not found. https://greensock.com",!Ll.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=C,P||T||Xw(m)||Xw(_)){if(r=s.vars,G=s.timeline=new Za({data:"nested",defaults:k||{},targets:F&&F.data==="nested"?F.vars.targets:N}),G.kill(),G.parent=G._dp=vd(s),G._start=0,T||Xw(m)||Xw(_)){if(re=N.length,ue=T&&pU(T),bh(T))for($ in T)~AU.indexOf($)&&(De||(De={}),De[$]=T[$]);for(j=0;j<re;j++)Q=JS(r,CU),Q.stagger=0,O&&(Q.yoyoEase=O),De&&ug(Q,De),ne=N[j],Q.duration=+Vx(m,vd(s),j,ne,N),Q.delay=(+Vx(_,vd(s),j,ne,N)||0)-s._delay,!T&&re===1&&Q.delay&&(s._delay=_=Q.delay,s._start+=_,Q.delay=0),G.to(ne,Q,ue?ue(j,ne,N):0),G._ease=ji.none;G.duration()?m=_=0:s.timeline=0}else if(P){Nx(Ic(G.vars.defaults,{ease:"none"})),G._ease=Ym(P.ease||r.ease||"none");var $e=0,ae,le,fe;if(ha(P))P.forEach(function(Oe){return G.to(N,Oe,">")}),G.duration();else{Q={};for($ in P)$==="ease"||$==="easeEach"||zJ($,P[$],Q,P.easeEach);for($ in Q)for(ae=Q[$].sort(function(Oe,We){return Oe.t-We.t}),$e=0,j=0;j<ae.length;j++)le=ae[j],fe={ease:le.e,duration:(le.t-(j?ae[j-1].t:0))/100*m},fe[$]=le.v,G.to(N,fe,$e),$e+=fe.duration;G.duration()<m&&G.to({},{duration:m-G.duration()})}}m||s.duration(m=G.duration())}else s.timeline=0;return C===!0&&!zP&&(Xf=vd(s),os.killTweensOf(N),Xf=0),gh(F,vd(s),a),r.reversed&&s.reverse(),r.paused&&s.paused(!0),(S||!m&&!P&&s._start===Ro(F._time)&&Qa(S)&&hJ(vd(s))&&F.data!=="nested")&&(s._tTime=-Dr,s.render(Math.max(0,-_)||0)),R&&uU(vd(s),R),s}var t=e.prototype;return t.render=function(r,a,l){var s=this._time,d=this._tDur,m=this._dur,_=r<0,S=r>d-Dr&&!_?d:r<Dr?0:r,T,C,P,k,R,O,F,N,G;if(!m)fJ(this,r,a,l);else if(S!==this._tTime||!r||l||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==_){if(T=S,N=this.timeline,this._repeat){if(k=m+this._rDelay,this._repeat<-1&&_)return this.totalTime(k*100+r,a,l);if(T=Ro(S%k),S===d?(P=this._repeat,T=m):(P=~~(S/k),P&&P===S/k&&(T=m,P--),T>m&&(T=m)),O=this._yoyo&&P&1,O&&(G=this._yEase,T=m-T),R=xy(this._tTime,k),T===s&&!l&&this._initted)return this._tTime=S,this;P!==R&&(N&&this._yEase&&SU(N,O),this.vars.repeatRefresh&&!O&&!this._lock&&(this._lock=l=1,this.render(Ro(k*P),!0).invalidate()._lock=0))}if(!this._initted){if(hU(this,_?r:T,l,a,S))return this._tTime=0,this;if(s!==this._time)return this;if(m!==this._dur)return this.render(r,a,l)}if(this._tTime=S,this._time=T,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=F=(G||this._ease)(T/m),this._from&&(this.ratio=F=1-F),T&&!s&&!a&&(Mc(this,"onStart"),this._tTime!==S))return this;for(C=this._pt;C;)C.r(F,C.d),C=C._next;N&&N.render(r<0?r:!T&&O?-Dr:N._dur*N._ease(T/this._dur),a,l)||this._startAt&&(this._zTime=r),this._onUpdate&&!a&&(_&&hC(this,r,a,l),Mc(this,"onUpdate")),this._repeat&&P!==R&&this.vars.onRepeat&&!a&&this.parent&&Mc(this,"onRepeat"),(S===this._tDur||!S)&&this._tTime===S&&(_&&!this._onUpdate&&hC(this,r,!0,!0),(r||!m)&&(S===this._tDur&&this._ts>0||!S&&this._ts<0)&&yp(this,1),!a&&!(_&&!s)&&(S||s||O)&&(Mc(this,S===d?"onComplete":"onReverseComplete",!0),this._prom&&!(S<d&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),n.prototype.invalidate.call(this,r)},t.resetTo=function(r,a,l,s){yv||Il.wake(),this._ts||this.play();var d=Math.min(this._dur,(this._dp._time-this._start)*this._ts),m;return this._initted||WP(this,d),m=this._ease(d/this._dur),LJ(this,r,a,l,s,m,d)?this.resetTo(r,a,l,s):(BM(this,0),this.parent||lU(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,a){if(a===void 0&&(a="all"),!r&&(!a||a==="all"))return this._lazy=this._pt=0,this.parent?vx(this):this;if(this.timeline){var l=this.timeline.totalDuration();return this.timeline.killTweensOf(r,a,Xf&&Xf.vars.overwrite!==!0)._first||vx(this),this.parent&&l!==this.timeline.totalDuration()&&vy(this,this._dur*this.timeline._tDur/l,0,1),this}var s=this._targets,d=r?Sc(r):s,m=this._ptLookup,_=this._pt,S,T,C,P,k,R,O;if((!a||a==="all")&&cJ(s,d))return a==="all"&&(this._pt=0),vx(this);for(S=this._op=this._op||[],a!=="all"&&(Mo(a)&&(k={},el(a,function(F){return k[F]=1}),a=k),a=RJ(s,a)),O=s.length;O--;)if(~d.indexOf(s[O])){T=m[O],a==="all"?(S[O]=a,P=T,C={}):(C=S[O]=S[O]||{},P=a);for(k in P)R=T&&T[k],R&&((!("kill"in R.d)||R.d.kill(k)===!0)&&OM(this,R,"_pt"),delete T[k]),C!=="all"&&(C[k]=1)}return this._initted&&!this._pt&&_&&vx(this),this},e.to=function(r,a){return new e(r,a,arguments[2])},e.from=function(r,a){return Ux(1,arguments)},e.delayedCall=function(r,a,l,s){return new e(a,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:a,onReverseComplete:a,onCompleteParams:l,onReverseCompleteParams:l,callbackScope:s})},e.fromTo=function(r,a,l){return Ux(2,arguments)},e.set=function(r,a){return a.duration=0,a.repeatDelay||(a.repeat=0),new e(r,a)},e.killTweensOf=function(r,a,l){return os.killTweensOf(r,a,l)},e}(by);Ic(no.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});el("staggerTo,staggerFrom,staggerFromTo",function(n){no[n]=function(){var e=new Za,t=fC.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var HP=function(e,t,i){return e[t]=i},IU=function(e,t,i){return e[t](i)},OJ=function(e,t,i,r){return e[t](r.fp,i)},FJ=function(e,t,i){return e.setAttribute(t,i)},jP=function(e,t){return ws(e[t])?IU:OP(e[t])&&e.setAttribute?FJ:HP},PU=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},BJ=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},kU=function(e,t){var i=t._pt,r="";if(!e&&t.b)r=t.b;else if(e===1&&t.e)r=t.e;else{for(;i;)r=i.p+(i.m?i.m(i.s+i.c*e):Math.round((i.s+i.c*e)*1e4)/1e4)+r,i=i._next;r+=t.c}t.set(t.t,t.p,r,t)},qP=function(e,t){for(var i=t._pt;i;)i.r(e,i.d),i=i._next},NJ=function(e,t,i,r){for(var a=this._pt,l;a;)l=a._next,a.p===r&&a.modifier(e,t,i),a=l},UJ=function(e){for(var t=this._pt,i,r;t;)r=t._next,t.p===e&&!t.op||t.op===e?OM(this,t,"_pt"):t.dep||(i=1),t=r;return!i},VJ=function(e,t,i,r){r.mSet(e,t,r.m.call(r.tween,i,r.mt),r)},DU=function(e){for(var t=e._pt,i,r,a,l;t;){for(i=t._next,r=a;r&&r.pr>t.pr;)r=r._next;(t._prev=r?r._prev:l)?t._prev._next=t:a=t,(t._next=r)?r._prev=t:l=t,t=i}e._pt=a},tl=function(){function n(t,i,r,a,l,s,d,m,_){this.t=i,this.s=a,this.c=l,this.p=r,this.r=s||PU,this.d=d||this,this.set=m||HP,this.pr=_||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(i,r,a){this.mSet=this.mSet||this.set,this.set=VJ,this.m=i,this.mt=a,this.tween=r},n}();el(UP+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return NP[n]=1});Ol.TweenMax=Ol.TweenLite=no;Ol.TimelineLite=Ol.TimelineMax=Za;os=new Za({sortChildren:!1,defaults:yy,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Ll.stringFilter=wU;var Sy=[],tS={},GJ=[],Wz=0,Q2=function(e){return(tS[e]||GJ).map(function(t){return t()})},_C=function(){var e=Date.now(),t=[];e-Wz>2&&(Q2("matchMediaInit"),Sy.forEach(function(i){var r=i.queries,a=i.conditions,l,s,d,m;for(s in r)l=dc.matchMedia(r[s]).matches,l&&(d=1),l!==a[s]&&(a[s]=l,m=1);m&&(i.revert(),d&&t.push(i))}),Q2("matchMediaRevert"),t.forEach(function(i){return i.onMatch(i)}),Wz=e,Q2("matchMedia"))},LU=function(){function n(t,i){this.selector=i&&pC(i),this.data=[],this._r=[],this.isReverted=!1,t&&this.add(t)}var e=n.prototype;return e.add=function(i,r,a){ws(i)&&(a=r,r=i,i=ws);var l=this,s=function(){var m=Hs,_=l.selector,S;return m&&m!==l&&m.data.push(l),a&&(l.selector=pC(a)),Hs=l,S=r.apply(l,arguments),ws(S)&&l._r.push(S),Hs=m,l.selector=_,l.isReverted=!1,S};return l.last=s,i===ws?s(l):i?l[i]=s:s},e.ignore=function(i){var r=Hs;Hs=null,i(this),Hs=r},e.getTweens=function(){var i=[];return this.data.forEach(function(r){return r instanceof n?i.push.apply(i,r.getTweens()):r instanceof no&&!(r.parent&&r.parent.data==="nested")&&i.push(r)}),i},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(i,r){var a=this;if(i){var l=this.getTweens();this.data.forEach(function(d){d.data==="isFlip"&&(d.revert(),d.getChildren(!0,!0,!1).forEach(function(m){return l.splice(l.indexOf(m),1)}))}),l.map(function(d){return{g:d.globalTime(0),t:d}}).sort(function(d,m){return m.g-d.g||-1}).forEach(function(d){return d.t.revert(i)}),this.data.forEach(function(d){return!(d instanceof by)&&d.revert&&d.revert(i)}),this._r.forEach(function(d){return d(i,a)}),this.isReverted=!0}else this.data.forEach(function(d){return d.kill&&d.kill()});if(this.clear(),r){var s=Sy.indexOf(this);~s&&Sy.splice(s,1)}},e.revert=function(i){this.kill(i||{})},n}(),WJ=function(){function n(t){this.contexts=[],this.scope=t}var e=n.prototype;return e.add=function(i,r,a){bh(i)||(i={matches:i});var l=new LU(0,a||this.scope),s=l.conditions={},d,m,_;this.contexts.push(l),r=l.add("onMatch",r),l.queries=i;for(m in i)m==="all"?_=1:(d=dc.matchMedia(i[m]),d&&(Sy.indexOf(l)<0&&Sy.push(l),(s[m]=d.matches)&&(_=1),d.addListener?d.addListener(_C):d.addEventListener("change",_C)));return _&&r(l),this},e.revert=function(i){this.kill(i||{})},e.kill=function(i){this.contexts.forEach(function(r){return r.kill(i,!0)})},n}(),QS={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(function(r){return MJ(r)})},timeline:function(e){return new Za(e)},getTweensOf:function(e,t){return os.getTweensOf(e,t)},getProperty:function(e,t,i,r){Mo(e)&&(e=Sc(e)[0]);var a=$m(e||{}).get,l=i?aU:oU;return i==="native"&&(i=""),e&&(t?l((Cl[t]&&Cl[t].get||a)(e,t,i,r)):function(s,d,m){return l((Cl[s]&&Cl[s].get||a)(e,s,d,m))})},quickSetter:function(e,t,i){if(e=Sc(e),e.length>1){var r=e.map(function(_){return Fl.quickSetter(_,t,i)}),a=r.length;return function(_){for(var S=a;S--;)r[S](_)}}e=e[0]||{};var l=Cl[t],s=$m(e),d=s.harness&&(s.harness.aliases||{})[t]||t,m=l?function(_){var S=new l;W_._pt=0,S.init(e,i?_+i:_,W_,0,[e]),S.render(1,S),W_._pt&&qP(1,W_)}:s.set(e,d);return l?m:function(_){return m(e,d,i?_+i:_,s,1)}},quickTo:function(e,t,i){var r,a=Fl.to(e,ug((r={},r[t]="+=0.1",r.paused=!0,r),i||{})),l=function(d,m,_){return a.resetTo(t,d,m,_)};return l.tween=a,l},isTweening:function(e){return os.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Ym(e.ease,yy.ease)),Bz(yy,e||{})},config:function(e){return Bz(Ll,e||{})},registerEffect:function(e){var t=e.name,i=e.effect,r=e.plugins,a=e.defaults,l=e.extendTimeline;(r||"").split(",").forEach(function(s){return s&&!Cl[s]&&!Ol[s]&&XS(t+" effect requires "+s+" plugin.")}),X2[t]=function(s,d,m){return i(Sc(s),Ic(d||{},a),m)},l&&(Za.prototype[t]=function(s,d,m){return this.add(X2[t](s,bh(d)?d:(m=d)&&{},this),m)})},registerEase:function(e,t){ji[e]=Ym(t)},parseEase:function(e,t){return arguments.length?Ym(e,t):ji},getById:function(e){return os.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var i=new Za(e),r,a;for(i.smoothChildTiming=Qa(e.smoothChildTiming),os.remove(i),i._dp=0,i._time=i._tTime=os._time,r=os._first;r;)a=r._next,(t||!(!r._dur&&r instanceof no&&r.vars.onComplete===r._targets[0]))&&gh(i,r,r._start-r._delay),r=a;return gh(os,i,0),i},context:function(e,t){return e?new LU(e,t):Hs},matchMedia:function(e){return new WJ(e)},matchMediaRefresh:function(){return Sy.forEach(function(e){var t=e.conditions,i,r;for(r in t)t[r]&&(t[r]=!1,i=1);i&&e.revert()})||_C()},addEventListener:function(e,t){var i=tS[e]||(tS[e]=[]);~i.indexOf(t)||i.push(t)},removeEventListener:function(e,t){var i=tS[e],r=i&&i.indexOf(t);r>=0&&i.splice(r,1)},utils:{wrap:wJ,wrapYoyo:bJ,distribute:pU,random:gU,snap:mU,normalize:vJ,getUnit:aa,clamp:gJ,splitColor:xU,toArray:Sc,selector:pC,mapRange:yU,pipe:yJ,unitize:xJ,interpolate:SJ,shuffle:fU},install:tU,effects:X2,ticker:Il,updateRoot:Za.updateRoot,plugins:Cl,globalTimeline:os,core:{PropTween:tl,globals:nU,Tween:no,Timeline:Za,Animation:by,getCache:$m,_removeLinkedListItem:OM,reverting:function(){return ua},context:function(e){return e&&Hs&&(Hs.data.push(e),e._ctx=Hs),Hs},suppressOverwrites:function(e){return zP=e}}};el("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return QS[n]=no[n]});Il.add(Za.updateRoot);W_=QS.to({},{duration:0});var HJ=function(e,t){for(var i=e._pt;i&&i.p!==t&&i.op!==t&&i.fp!==t;)i=i._next;return i},jJ=function(e,t){var i=e._targets,r,a,l;for(r in t)for(a=i.length;a--;)l=e._ptLookup[a][r],l&&(l=l.d)&&(l._pt&&(l=HJ(l,r)),l&&l.modifier&&l.modifier(t[r],e,i[a],r))},eE=function(e,t){return{name:e,rawVars:1,init:function(r,a,l){l._onInit=function(s){var d,m;if(Mo(a)&&(d={},el(a,function(_){return d[_]=1}),a=d),t){d={};for(m in a)d[m]=t(a[m]);a=d}jJ(s,a)}}}},Fl=QS.registerPlugin({name:"attr",init:function(e,t,i,r,a){var l,s,d;this.tween=i;for(l in t)d=e.getAttribute(l)||"",s=this.add(e,"setAttribute",(d||0)+"",t[l],r,a,0,0,l),s.op=l,s.b=d,this._props.push(l)},render:function(e,t){for(var i=t._pt;i;)ua?i.set(i.t,i.p,i.b,i):i.r(e,i.d),i=i._next}},{name:"endArray",init:function(e,t){for(var i=t.length;i--;)this.add(e,i,e[i]||0,t[i],0,0,0,0,0,1)}},eE("roundProps",mC),eE("modifiers"),eE("snap",mU))||QS;no.version=Za.version=Fl.version="3.11.4";eU=1;X5()&&wy();ji.Power0;ji.Power1;ji.Power2;ji.Power3;ji.Power4;ji.Linear;ji.Quad;ji.Cubic;ji.Quart;ji.Quint;ji.Strong;ji.Elastic;ji.Back;ji.SteppedEase;ji.Bounce;ji.Sine;ji.Expo;ji.Circ;/*!
 * CSSPlugin 3.11.4
 * https://greensock.com
 *
 * Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Hz,Yf,ry,ZP,Fm,jz,$P,qJ=function(){return typeof window<"u"},Vd={},Am=180/Math.PI,sy=Math.PI/180,c_=Math.atan2,qz=1e8,XP=/([A-Z])/g,ZJ=/(left|right|width|margin|padding|x)/i,$J=/[\s,\(]\S/,Id={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},yC=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},XJ=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},YJ=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},JJ=function(e,t){var i=t.s+t.c*e;t.set(t.t,t.p,~~(i+(i<0?-.5:.5))+t.u,t)},RU=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},zU=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},KJ=function(e,t,i){return e.style[t]=i},QJ=function(e,t,i){return e.style.setProperty(t,i)},eK=function(e,t,i){return e._gsap[t]=i},tK=function(e,t,i){return e._gsap.scaleX=e._gsap.scaleY=i},nK=function(e,t,i,r,a){var l=e._gsap;l.scaleX=l.scaleY=i,l.renderTransform(a,l)},iK=function(e,t,i,r,a){var l=e._gsap;l[t]=i,l.renderTransform(a,l)},as="transform",Eu=as+"Origin",rK=function(e,t){var i=this,r=this.target,a=r.style;if(e in Vd){if(this.tfm=this.tfm||{},e!=="transform"&&(e=Id[e]||e,~e.indexOf(",")?e.split(",").forEach(function(l){return i.tfm[l]=Sd(r,l)}):this.tfm[e]=r._gsap.x?r._gsap[e]:Sd(r,e)),this.props.indexOf(as)>=0)return;r._gsap.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(Eu,t,"")),e=as}(a||t)&&this.props.push(e,t,a[e])},OU=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},sK=function(){var e=this.props,t=this.target,i=t.style,r=t._gsap,a,l;for(a=0;a<e.length;a+=3)e[a+1]?t[e[a]]=e[a+2]:e[a+2]?i[e[a]]=e[a+2]:i.removeProperty(e[a].replace(XP,"-$1").toLowerCase());if(this.tfm){for(l in this.tfm)r[l]=this.tfm[l];r.svg&&(r.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),a=$P(),a&&!a.isStart&&!i[as]&&(OU(i),r.uncache=1)}},FU=function(e,t){var i={target:e,props:[],revert:sK,save:rK};return t&&t.split(",").forEach(function(r){return i.save(r)}),i},BU,xC=function(e,t){var i=Yf.createElementNS?Yf.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Yf.createElement(e);return i.style?i:Yf.createElement(e)},vh=function n(e,t,i){var r=getComputedStyle(e);return r[t]||r.getPropertyValue(t.replace(XP,"-$1").toLowerCase())||r.getPropertyValue(t)||!i&&n(e,My(t)||t,1)||""},Zz="O,Moz,ms,Ms,Webkit".split(","),My=function(e,t,i){var r=t||Fm,a=r.style,l=5;if(e in a&&!i)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);l--&&!(Zz[l]+e in a););return l<0?null:(l===3?"ms":l>=0?Zz[l]:"")+e},vC=function(){qJ()&&window.document&&(Hz=window,Yf=Hz.document,ry=Yf.documentElement,Fm=xC("div")||{style:{}},xC("div"),as=My(as),Eu=as+"Origin",Fm.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",BU=!!My("perspective"),$P=Fl.core.reverting,ZP=1)},tE=function n(e){var t=xC("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,r=this.nextSibling,a=this.style.cssText,l;if(ry.appendChild(t),t.appendChild(this),this.style.display="block",e)try{l=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch{}else this._gsapBBox&&(l=this._gsapBBox());return i&&(r?i.insertBefore(this,r):i.appendChild(this)),ry.removeChild(t),this.style.cssText=a,l},$z=function(e,t){for(var i=t.length;i--;)if(e.hasAttribute(t[i]))return e.getAttribute(t[i])},NU=function(e){var t;try{t=e.getBBox()}catch{t=tE.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===tE||(t=tE.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+$z(e,["x","cx","x1"])||0,y:+$z(e,["y","cy","y1"])||0,width:0,height:0}:t},UU=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&NU(e))},xv=function(e,t){if(t){var i=e.style;t in Vd&&t!==Eu&&(t=as),i.removeProperty?((t.substr(0,2)==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),i.removeProperty(t.replace(XP,"-$1").toLowerCase())):i.removeAttribute(t)}},Jf=function(e,t,i,r,a,l){var s=new tl(e._pt,t,i,0,1,l?zU:RU);return e._pt=s,s.b=r,s.e=a,e._props.push(i),s},Xz={deg:1,rad:1,turn:1},oK={grid:1,flex:1},xp=function n(e,t,i,r){var a=parseFloat(i)||0,l=(i+"").trim().substr((a+"").length)||"px",s=Fm.style,d=ZJ.test(t),m=e.tagName.toLowerCase()==="svg",_=(m?"client":"offset")+(d?"Width":"Height"),S=100,T=r==="px",C=r==="%",P,k,R,O;return r===l||!a||Xz[r]||Xz[l]?a:(l!=="px"&&!T&&(a=n(e,t,i,"px")),O=e.getCTM&&UU(e),(C||l==="%")&&(Vd[t]||~t.indexOf("adius"))?(P=O?e.getBBox()[d?"width":"height"]:e[_],Ds(C?a/P*S:a/100*P)):(s[d?"width":"height"]=S+(T?l:r),k=~t.indexOf("adius")||r==="em"&&e.appendChild&&!m?e:e.parentNode,O&&(k=(e.ownerSVGElement||{}).parentNode),(!k||k===Yf||!k.appendChild)&&(k=Yf.body),R=k._gsap,R&&C&&R.width&&d&&R.time===Il.time&&!R.uncache?Ds(a/R.width*S):((C||l==="%")&&!oK[vh(k,"display")]&&(s.position=vh(e,"position")),k===e&&(s.position="static"),k.appendChild(Fm),P=Fm[_],k.removeChild(Fm),s.position="absolute",d&&C&&(R=$m(k),R.time=Il.time,R.width=k[_]),Ds(T?P*a/S:P&&a?S/P*a:0))))},Sd=function(e,t,i,r){var a;return ZP||vC(),t in Id&&t!=="transform"&&(t=Id[t],~t.indexOf(",")&&(t=t.split(",")[0])),Vd[t]&&t!=="transform"?(a=wv(e,r),a=t!=="transformOrigin"?a[t]:a.svg?a.origin:tM(vh(e,Eu))+" "+a.zOrigin+"px"):(a=e.style[t],(!a||a==="auto"||r||~(a+"").indexOf("calc("))&&(a=eM[t]&&eM[t](e,t,i)||vh(e,t)||rU(e,t)||(t==="opacity"?1:0))),i&&!~(a+"").trim().indexOf(" ")?xp(e,t,a,i)+i:a},aK=function(e,t,i,r){if(!i||i==="none"){var a=My(t,e,1),l=a&&vh(e,a,1);l&&l!==i?(t=a,i=l):t==="borderColor"&&(i=vh(e,"borderTopColor"))}var s=new tl(this._pt,e.style,t,0,1,kU),d=0,m=0,_,S,T,C,P,k,R,O,F,N,G,j;if(s.b=i,s.e=r,i+="",r+="",r==="auto"&&(e.style[t]=r,r=vh(e,t)||r,e.style[t]=i),_=[i,r],wU(_),i=_[0],r=_[1],T=i.match(G_)||[],j=r.match(G_)||[],j.length){for(;S=G_.exec(r);)R=S[0],F=r.substring(d,S.index),P?P=(P+1)%5:(F.substr(-5)==="rgba("||F.substr(-5)==="hsla(")&&(P=1),R!==(k=T[m++]||"")&&(C=parseFloat(k)||0,G=k.substr((C+"").length),R.charAt(1)==="="&&(R=iy(C,R)+G),O=parseFloat(R),N=R.substr((O+"").length),d=G_.lastIndex-N.length,N||(N=N||Ll.units[t]||G,d===r.length&&(r+=N,s.e+=N)),G!==N&&(C=xp(e,t,k,N)||0),s._pt={_next:s._pt,p:F||m===1?F:",",s:C,c:O-C,m:P&&P<4||t==="zIndex"?Math.round:0});s.c=d<r.length?r.substring(d,r.length):""}else s.r=t==="display"&&r==="none"?zU:RU;return K5.test(r)&&(s.e=0),this._pt=s,s},Yz={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},lK=function(e){var t=e.split(" "),i=t[0],r=t[1]||"50%";return(i==="top"||i==="bottom"||r==="left"||r==="right")&&(e=i,i=r,r=e),t[0]=Yz[i]||i,t[1]=Yz[r]||r,t.join(" ")},cK=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var i=t.t,r=i.style,a=t.u,l=i._gsap,s,d,m;if(a==="all"||a===!0)r.cssText="",d=1;else for(a=a.split(","),m=a.length;--m>-1;)s=a[m],Vd[s]&&(d=1,s=s==="transformOrigin"?Eu:as),xv(i,s);d&&(xv(i,as),l&&(l.svg&&i.removeAttribute("transform"),wv(i,1),l.uncache=1,OU(r)))}},eM={clearProps:function(e,t,i,r,a){if(a.data!=="isFromStart"){var l=e._pt=new tl(e._pt,t,i,0,0,cK);return l.u=r,l.pr=-10,l.tween=a,e._props.push(i),1}}},vv=[1,0,0,1,0,0],VU={},GU=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Jz=function(e){var t=vh(e,as);return GU(t)?vv:t.substr(7).match(J5).map(Ds)},YP=function(e,t){var i=e._gsap||$m(e),r=e.style,a=Jz(e),l,s,d,m;return i.svg&&e.getAttribute("transform")?(d=e.transform.baseVal.consolidate().matrix,a=[d.a,d.b,d.c,d.d,d.e,d.f],a.join(",")==="1,0,0,1,0,0"?vv:a):(a===vv&&!e.offsetParent&&e!==ry&&!i.svg&&(d=r.display,r.display="block",l=e.parentNode,(!l||!e.offsetParent)&&(m=1,s=e.nextElementSibling,ry.appendChild(e)),a=Jz(e),d?r.display=d:xv(e,"display"),m&&(s?l.insertBefore(e,s):l?l.appendChild(e):ry.removeChild(e))),t&&a.length>6?[a[0],a[1],a[4],a[5],a[12],a[13]]:a)},wC=function(e,t,i,r,a,l){var s=e._gsap,d=a||YP(e,!0),m=s.xOrigin||0,_=s.yOrigin||0,S=s.xOffset||0,T=s.yOffset||0,C=d[0],P=d[1],k=d[2],R=d[3],O=d[4],F=d[5],N=t.split(" "),G=parseFloat(N[0])||0,j=parseFloat(N[1])||0,Q,re,$,ne;i?d!==vv&&(re=C*R-P*k)&&($=G*(R/re)+j*(-k/re)+(k*F-R*O)/re,ne=G*(-P/re)+j*(C/re)-(C*F-P*O)/re,G=$,j=ne):(Q=NU(e),G=Q.x+(~N[0].indexOf("%")?G/100*Q.width:G),j=Q.y+(~(N[1]||N[0]).indexOf("%")?j/100*Q.height:j)),r||r!==!1&&s.smooth?(O=G-m,F=j-_,s.xOffset=S+(O*C+F*k)-O,s.yOffset=T+(O*P+F*R)-F):s.xOffset=s.yOffset=0,s.xOrigin=G,s.yOrigin=j,s.smooth=!!r,s.origin=t,s.originIsAbsolute=!!i,e.style[Eu]="0px 0px",l&&(Jf(l,s,"xOrigin",m,G),Jf(l,s,"yOrigin",_,j),Jf(l,s,"xOffset",S,s.xOffset),Jf(l,s,"yOffset",T,s.yOffset)),e.setAttribute("data-svg-origin",G+" "+j)},wv=function(e,t){var i=e._gsap||new TU(e);if("x"in i&&!t&&!i.uncache)return i;var r=e.style,a=i.scaleX<0,l="px",s="deg",d=getComputedStyle(e),m=vh(e,Eu)||"0",_,S,T,C,P,k,R,O,F,N,G,j,Q,re,$,ne,ue,De,$e,ae,le,fe,Oe,We,ce,Te,Pe,Qe,Ne,nt,ze,et;return _=S=T=k=R=O=F=N=G=0,C=P=1,i.svg=!!(e.getCTM&&UU(e)),d.translate&&((d.translate!=="none"||d.scale!=="none"||d.rotate!=="none")&&(r[as]=(d.translate!=="none"?"translate3d("+(d.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(d.rotate!=="none"?"rotate("+d.rotate+") ":"")+(d.scale!=="none"?"scale("+d.scale.split(" ").join(",")+") ":"")+(d[as]!=="none"?d[as]:"")),r.scale=r.rotate=r.translate="none"),re=YP(e,i.svg),i.svg&&(i.uncache?(ce=e.getBBox(),m=i.xOrigin-ce.x+"px "+(i.yOrigin-ce.y)+"px",We=""):We=!t&&e.getAttribute("data-svg-origin"),wC(e,We||m,!!We||i.originIsAbsolute,i.smooth!==!1,re)),j=i.xOrigin||0,Q=i.yOrigin||0,re!==vv&&(De=re[0],$e=re[1],ae=re[2],le=re[3],_=fe=re[4],S=Oe=re[5],re.length===6?(C=Math.sqrt(De*De+$e*$e),P=Math.sqrt(le*le+ae*ae),k=De||$e?c_($e,De)*Am:0,F=ae||le?c_(ae,le)*Am+k:0,F&&(P*=Math.abs(Math.cos(F*sy))),i.svg&&(_-=j-(j*De+Q*ae),S-=Q-(j*$e+Q*le))):(et=re[6],nt=re[7],Pe=re[8],Qe=re[9],Ne=re[10],ze=re[11],_=re[12],S=re[13],T=re[14],$=c_(et,Ne),R=$*Am,$&&(ne=Math.cos(-$),ue=Math.sin(-$),We=fe*ne+Pe*ue,ce=Oe*ne+Qe*ue,Te=et*ne+Ne*ue,Pe=fe*-ue+Pe*ne,Qe=Oe*-ue+Qe*ne,Ne=et*-ue+Ne*ne,ze=nt*-ue+ze*ne,fe=We,Oe=ce,et=Te),$=c_(-ae,Ne),O=$*Am,$&&(ne=Math.cos(-$),ue=Math.sin(-$),We=De*ne-Pe*ue,ce=$e*ne-Qe*ue,Te=ae*ne-Ne*ue,ze=le*ue+ze*ne,De=We,$e=ce,ae=Te),$=c_($e,De),k=$*Am,$&&(ne=Math.cos($),ue=Math.sin($),We=De*ne+$e*ue,ce=fe*ne+Oe*ue,$e=$e*ne-De*ue,Oe=Oe*ne-fe*ue,De=We,fe=ce),R&&Math.abs(R)+Math.abs(k)>359.9&&(R=k=0,O=180-O),C=Ds(Math.sqrt(De*De+$e*$e+ae*ae)),P=Ds(Math.sqrt(Oe*Oe+et*et)),$=c_(fe,Oe),F=Math.abs($)>2e-4?$*Am:0,G=ze?1/(ze<0?-ze:ze):0),i.svg&&(We=e.getAttribute("transform"),i.forceCSS=e.setAttribute("transform","")||!GU(vh(e,as)),We&&e.setAttribute("transform",We))),Math.abs(F)>90&&Math.abs(F)<270&&(a?(C*=-1,F+=k<=0?180:-180,k+=k<=0?180:-180):(P*=-1,F+=F<=0?180:-180)),t=t||i.uncache,i.x=_-((i.xPercent=_&&(!t&&i.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-_)?-50:0)))?e.offsetWidth*i.xPercent/100:0)+l,i.y=S-((i.yPercent=S&&(!t&&i.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-S)?-50:0)))?e.offsetHeight*i.yPercent/100:0)+l,i.z=T+l,i.scaleX=Ds(C),i.scaleY=Ds(P),i.rotation=Ds(k)+s,i.rotationX=Ds(R)+s,i.rotationY=Ds(O)+s,i.skewX=F+s,i.skewY=N+s,i.transformPerspective=G+l,(i.zOrigin=parseFloat(m.split(" ")[2])||0)&&(r[Eu]=tM(m)),i.xOffset=i.yOffset=0,i.force3D=Ll.force3D,i.renderTransform=i.svg?hK:BU?WU:uK,i.uncache=0,i},tM=function(e){return(e=e.split(" "))[0]+" "+e[1]},nE=function(e,t,i){var r=aa(t);return Ds(parseFloat(t)+parseFloat(xp(e,"x",i+"px",r)))+r},uK=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,WU(e,t)},fm="0deg",Y0="0px",pm=") ",WU=function(e,t){var i=t||this,r=i.xPercent,a=i.yPercent,l=i.x,s=i.y,d=i.z,m=i.rotation,_=i.rotationY,S=i.rotationX,T=i.skewX,C=i.skewY,P=i.scaleX,k=i.scaleY,R=i.transformPerspective,O=i.force3D,F=i.target,N=i.zOrigin,G="",j=O==="auto"&&e&&e!==1||O===!0;if(N&&(S!==fm||_!==fm)){var Q=parseFloat(_)*sy,re=Math.sin(Q),$=Math.cos(Q),ne;Q=parseFloat(S)*sy,ne=Math.cos(Q),l=nE(F,l,re*ne*-N),s=nE(F,s,-Math.sin(Q)*-N),d=nE(F,d,$*ne*-N+N)}R!==Y0&&(G+="perspective("+R+pm),(r||a)&&(G+="translate("+r+"%, "+a+"%) "),(j||l!==Y0||s!==Y0||d!==Y0)&&(G+=d!==Y0||j?"translate3d("+l+", "+s+", "+d+") ":"translate("+l+", "+s+pm),m!==fm&&(G+="rotate("+m+pm),_!==fm&&(G+="rotateY("+_+pm),S!==fm&&(G+="rotateX("+S+pm),(T!==fm||C!==fm)&&(G+="skew("+T+", "+C+pm),(P!==1||k!==1)&&(G+="scale("+P+", "+k+pm),F.style[as]=G||"translate(0, 0)"},hK=function(e,t){var i=t||this,r=i.xPercent,a=i.yPercent,l=i.x,s=i.y,d=i.rotation,m=i.skewX,_=i.skewY,S=i.scaleX,T=i.scaleY,C=i.target,P=i.xOrigin,k=i.yOrigin,R=i.xOffset,O=i.yOffset,F=i.forceCSS,N=parseFloat(l),G=parseFloat(s),j,Q,re,$,ne;d=parseFloat(d),m=parseFloat(m),_=parseFloat(_),_&&(_=parseFloat(_),m+=_,d+=_),d||m?(d*=sy,m*=sy,j=Math.cos(d)*S,Q=Math.sin(d)*S,re=Math.sin(d-m)*-T,$=Math.cos(d-m)*T,m&&(_*=sy,ne=Math.tan(m-_),ne=Math.sqrt(1+ne*ne),re*=ne,$*=ne,_&&(ne=Math.tan(_),ne=Math.sqrt(1+ne*ne),j*=ne,Q*=ne)),j=Ds(j),Q=Ds(Q),re=Ds(re),$=Ds($)):(j=S,$=T,Q=re=0),(N&&!~(l+"").indexOf("px")||G&&!~(s+"").indexOf("px"))&&(N=xp(C,"x",l,"px"),G=xp(C,"y",s,"px")),(P||k||R||O)&&(N=Ds(N+P-(P*j+k*re)+R),G=Ds(G+k-(P*Q+k*$)+O)),(r||a)&&(ne=C.getBBox(),N=Ds(N+r/100*ne.width),G=Ds(G+a/100*ne.height)),ne="matrix("+j+","+Q+","+re+","+$+","+N+","+G+")",C.setAttribute("transform",ne),F&&(C.style[as]=ne)},dK=function(e,t,i,r,a){var l=360,s=Mo(a),d=parseFloat(a)*(s&&~a.indexOf("rad")?Am:1),m=d-r,_=r+m+"deg",S,T;return s&&(S=a.split("_")[1],S==="short"&&(m%=l,m!==m%(l/2)&&(m+=m<0?l:-l)),S==="cw"&&m<0?m=(m+l*qz)%l-~~(m/l)*l:S==="ccw"&&m>0&&(m=(m-l*qz)%l-~~(m/l)*l)),e._pt=T=new tl(e._pt,t,i,r,m,XJ),T.e=_,T.u="deg",e._props.push(i),T},Kz=function(e,t){for(var i in t)e[i]=t[i];return e},fK=function(e,t,i){var r=Kz({},i._gsap),a="perspective,force3D,transformOrigin,svgOrigin",l=i.style,s,d,m,_,S,T,C,P;r.svg?(m=i.getAttribute("transform"),i.setAttribute("transform",""),l[as]=t,s=wv(i,1),xv(i,as),i.setAttribute("transform",m)):(m=getComputedStyle(i)[as],l[as]=t,s=wv(i,1),l[as]=m);for(d in Vd)m=r[d],_=s[d],m!==_&&a.indexOf(d)<0&&(C=aa(m),P=aa(_),S=C!==P?xp(i,d,m,P):parseFloat(m),T=parseFloat(_),e._pt=new tl(e._pt,s,d,S,T-S,yC),e._pt.u=P||0,e._props.push(d));Kz(s,r)};el("padding,margin,Width,Radius",function(n,e){var t="Top",i="Right",r="Bottom",a="Left",l=(e<3?[t,i,r,a]:[t+a,t+i,r+i,r+a]).map(function(s){return e<2?n+s:"border"+s+n});eM[e>1?"border"+n:n]=function(s,d,m,_,S){var T,C;if(arguments.length<4)return T=l.map(function(P){return Sd(s,P,m)}),C=T.join(" "),C.split(T[0]).length===5?T[0]:C;T=(_+"").split(" "),C={},l.forEach(function(P,k){return C[P]=T[k]=T[k]||T[(k-1)/2|0]}),s.init(d,C,S)}});var HU={name:"css",register:vC,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,i,r,a){var l=this._props,s=e.style,d=i.vars.startAt,m,_,S,T,C,P,k,R,O,F,N,G,j,Q,re,$;ZP||vC(),this.styles=this.styles||FU(e),$=this.styles.props,this.tween=i;for(k in t)if(k!=="autoRound"&&(_=t[k],!(Cl[k]&&EU(k,t,i,r,e,a)))){if(C=typeof _,P=eM[k],C==="function"&&(_=_.call(i,r,e,a),C=typeof _),C==="string"&&~_.indexOf("random(")&&(_=_v(_)),P)P(this,e,k,_,i)&&(re=1);else if(k.substr(0,2)==="--")m=(getComputedStyle(e).getPropertyValue(k)+"").trim(),_+="",hp.lastIndex=0,hp.test(m)||(R=aa(m),O=aa(_)),O?R!==O&&(m=xp(e,k,m,O)+O):R&&(_+=R),this.add(s,"setProperty",m,_,r,a,0,0,k),l.push(k),$.push(k,0,s[k]);else if(C!=="undefined"){if(d&&k in d?(m=typeof d[k]=="function"?d[k].call(i,r,e,a):d[k],Mo(m)&&~m.indexOf("random(")&&(m=_v(m)),aa(m+"")||(m+=Ll.units[k]||aa(Sd(e,k))||""),(m+"").charAt(1)==="="&&(m=Sd(e,k))):m=Sd(e,k),T=parseFloat(m),F=C==="string"&&_.charAt(1)==="="&&_.substr(0,2),F&&(_=_.substr(2)),S=parseFloat(_),k in Id&&(k==="autoAlpha"&&(T===1&&Sd(e,"visibility")==="hidden"&&S&&(T=0),$.push("visibility",0,s.visibility),Jf(this,s,"visibility",T?"inherit":"hidden",S?"inherit":"hidden",!S)),k!=="scale"&&k!=="transform"&&(k=Id[k],~k.indexOf(",")&&(k=k.split(",")[0]))),N=k in Vd,N){if(this.styles.save(k),G||(j=e._gsap,j.renderTransform&&!t.parseTransform||wv(e,t.parseTransform),Q=t.smoothOrigin!==!1&&j.smooth,G=this._pt=new tl(this._pt,s,as,0,1,j.renderTransform,j,0,-1),G.dep=1),k==="scale")this._pt=new tl(this._pt,j,"scaleY",j.scaleY,(F?iy(j.scaleY,F+S):S)-j.scaleY||0,yC),this._pt.u=0,l.push("scaleY",k),k+="X";else if(k==="transformOrigin"){$.push(Eu,0,s[Eu]),_=lK(_),j.svg?wC(e,_,0,Q,0,this):(O=parseFloat(_.split(" ")[2])||0,O!==j.zOrigin&&Jf(this,j,"zOrigin",j.zOrigin,O),Jf(this,s,k,tM(m),tM(_)));continue}else if(k==="svgOrigin"){wC(e,_,1,Q,0,this);continue}else if(k in VU){dK(this,j,k,T,F?iy(T,F+_):_);continue}else if(k==="smoothOrigin"){Jf(this,j,"smooth",j.smooth,_);continue}else if(k==="force3D"){j[k]=_;continue}else if(k==="transform"){fK(this,_,e);continue}}else k in s||(k=My(k)||k);if(N||(S||S===0)&&(T||T===0)&&!$J.test(_)&&k in s)R=(m+"").substr((T+"").length),S||(S=0),O=aa(_)||(k in Ll.units?Ll.units[k]:R),R!==O&&(T=xp(e,k,m,O)),this._pt=new tl(this._pt,N?j:s,k,T,(F?iy(T,F+S):S)-T,!N&&(O==="px"||k==="zIndex")&&t.autoRound!==!1?JJ:yC),this._pt.u=O||0,R!==O&&O!=="%"&&(this._pt.b=m,this._pt.r=YJ);else if(k in s)aK.call(this,e,k,m,F?F+_:_);else if(k in e)this.add(e,k,m||e[k],F?F+_:_,r,a);else if(k!=="parseTransform"){BP(k,_);continue}N||(k in s?$.push(k,0,s[k]):$.push(k,1,m||e[k])),l.push(k)}}re&&DU(this)},render:function(e,t){if(t.tween._time||!$P())for(var i=t._pt;i;)i.r(e,i.d),i=i._next;else t.styles.revert()},get:Sd,aliases:Id,getSetter:function(e,t,i){var r=Id[t];return r&&r.indexOf(",")<0&&(t=r),t in Vd&&t!==Eu&&(e._gsap.x||Sd(e,"x"))?i&&jz===i?t==="scale"?tK:eK:(jz=i||{})&&(t==="scale"?nK:iK):e.style&&!OP(e.style[t])?KJ:~t.indexOf("-")?QJ:jP(e,t)},core:{_removeProperty:xv,_getMatrix:YP}};Fl.utils.checkPrefix=My;Fl.core.getStyleSaver=FU;(function(n,e,t,i){var r=el(n+","+e+","+t,function(a){Vd[a]=1});el(e,function(a){Ll.units[a]="deg",VU[a]=1}),Id[r[13]]=n+","+e,el(i,function(a){var l=a.split(":");Id[l[1]]=r[l[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");el("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){Ll.units[n]="px"});Fl.registerPlugin(HU);var jU=Fl.registerPlugin(HU)||Fl;jU.core.Tween;var bC={},pK={get exports(){return bC},set exports(n){bC=n}};(function(n,e){(function(t,i){n.exports=i()})(Fb,function(){var t,i,r;function a(s,d){if(!t)t=d;else if(!i)i=d;else{var m="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",_={};t(_),r=d(_),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([m],{type:"text/javascript"})))}}a(["exports"],function(s){var d=typeof self<"u"?self:{},m="2.12.1";let _;const S={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(_==null){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{_={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):c}catch{_=c}}return _},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},T={supported:!1,testSupport:function(c){!k&&P&&(R?O(c):C=c)}};let C,P,k=!1,R=!1;function O(c){const o=c.createTexture();c.bindTexture(c.TEXTURE_2D,o);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,P),c.isContextLost())return;T.supported=!0}catch{}c.deleteTexture(o),k=!0}d.document&&(P=d.document.createElement("img"),P.onload=function(){C&&O(C),C=null,R=!0},P.onerror=function(){k=!0,C=null},P.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const F="01";var N=G;function G(c,o,u,f){this.cx=3*c,this.bx=3*(u-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=o,this.p2x=u,this.p2y=f}G.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,o){if(o===void 0&&(o=1e-6),c<0)return 0;if(c>1)return 1;for(var u=c,f=0;f<8;f++){var g=this.sampleCurveX(u)-c;if(Math.abs(g)<o)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=g/v}var M=0,A=1;for(u=c,f=0;f<20&&(g=this.sampleCurveX(u),!(Math.abs(g-c)<o));f++)c>g?M=u:A=u,u=.5*(A-M)+M;return u},solve:function(c,o){return this.sampleCurveY(this.solveCurveX(c,o))}};var j=Q;function Q(c,o){this.x=c,this.y=o}Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,o){return this.clone()._rotateAround(c,o)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var o=c.x-this.x,u=c.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,o){return Math.atan2(this.x*o-this.y*c,this.x*c+this.y*o)},_matMult:function(c){var o=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=o,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var o=Math.cos(c),u=Math.sin(c),f=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=f,this},_rotateAround:function(c,o){var u=Math.cos(c),f=Math.sin(c),g=o.y+f*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-f*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Q.convert=function(c){return c instanceof Q?c:Array.isArray(c)?new Q(c[0],c[1]):c};const re=Math.PI/180,$=180/Math.PI;function ne(c){return c*re}function ue(c){return c*$}const De=[[0,0],[1,0],[1,1],[0,1]];function $e(c){if(c<=0)return 0;if(c>=1)return 1;const o=c*c,u=o*c;return 4*(c<.5?u:3*(c-o)+u-.75)}function ae(c,o,u,f){const g=new N(c,o,u,f);return function(v){return g.solve(v)}}const le=ae(.25,.1,.25,1);function fe(c,o,u){return Math.min(u,Math.max(o,c))}function Oe(c,o,u){return(u=fe((u-c)/(o-c),0,1))*u*(3-2*u)}function We(c,o,u){const f=u-o,g=((c-o)%f+f)%f+o;return g===o?u:g}function ce(c,o,u){if(!c.length)return u(null,[]);let f=c.length;const g=new Array(c.length);let v=null;c.forEach((M,A)=>{o(M,(D,z)=>{D&&(v=D),g[A]=z,--f==0&&u(v,g)})})}function Te(c){const o=[];for(const u in c)o.push(c[u]);return o}function Pe(c,...o){for(const u of o)for(const f in u)c[f]=u[f];return c}let Qe=1;function Ne(){return Qe++}function nt(){return function c(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()}function ze(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function et(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)}function Et(c,o){c.forEach(u=>{o[u]&&(o[u]=o[u].bind(o))})}function Nt(c,o){return c.indexOf(o,c.length-o.length)!==-1}function qt(c,o,u){const f={};for(const g in c)f[g]=o.call(u||this,c[g],g,c);return f}function wn(c,o,u){const f={};for(const g in c)o.call(u||this,c[g],g,c)&&(f[g]=c[g]);return f}function _n(c){return Array.isArray(c)?c.map(_n):typeof c=="object"&&c?qt(c,_n):c}const Ln={};function At(c){Ln[c]||(typeof console<"u"&&console.warn(c),Ln[c]=!0)}function Ot(c,o,u){return(u.y-c.y)*(o.x-c.x)>(o.y-c.y)*(u.x-c.x)}function Ft(c){let o=0;for(let u,f,g=0,v=c.length,M=v-1;g<v;M=g++)u=c[g],f=c[M],o+=(f.x-u.x)*(u.y+f.y);return o}function An(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function pn(c){const o={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,g,v)=>{const M=g||v;return o[f]=!M||M.toLowerCase(),""}),o["max-age"]){const u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}let Vn=null;function On(c){if(Vn==null){const o=c.navigator?c.navigator.userAgent:null;Vn=!!c.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Vn}function Zn(c){try{const o=d[c];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}function ai(c,o){return[c[4*o],c[4*o+1],c[4*o+2],c[4*o+3]]}const Ti="mapbox-tiles";let Be,Se,St=500,tn=50;function nn(){try{return d.caches}catch{}}function fn(){nn()&&!Be&&(Be=d.caches.open(Ti))}function Nn(c){const o=c.indexOf("?");if(o<0)return c;const u=function(g){const v=g.indexOf("?");return v>0?g.slice(v+1).split("&"):[]}(c),f=u.filter(g=>{const v=g.split("=");return v[0]==="language"||v[0]==="worldview"});return f.length?`${c.slice(0,o)}?${f.join("&")}`:c.slice(0,o)}let yn=1/0;const Lt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Lt);class Un extends Error{constructor(o,u,f){u===401&&bn(f)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=u,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ke=An()?()=>self.worker&&self.worker.referrer:()=>(d.location.protocol==="blob:"?d.parent:d).location.href,It=function(c,o){if(!(/^file:/.test(u=c.url)||/^file:/.test(Ke())&&!/^\w+:/.test(u))){if(d.fetch&&d.Request&&d.AbortController&&d.Request.prototype.hasOwnProperty("signal"))return function(f,g){const v=new d.AbortController,M=new d.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Ke(),signal:v.signal});let A=!1,D=!1;const z=(W=M.url).indexOf("sku=")>0&&bn(W);var W;f.type==="json"&&M.headers.set("Accept","application/json");const q=(K,ie,he)=>{if(D)return;if(K&&K.message!=="SecurityError"&&At(K),ie&&he)return X(ie);const ge=Date.now();d.fetch(M).then(Re=>{if(Re.ok){const He=z?Re.clone():null;return X(Re,He,ge)}return g(new Un(Re.statusText,Re.status,f.url))}).catch(Re=>{Re.code!==20&&g(new Error(Re.message))})},X=(K,ie,he)=>{(f.type==="arrayBuffer"?K.arrayBuffer():f.type==="json"?K.json():K.text()).then(ge=>{D||(ie&&he&&function(Re,He,Le){if(fn(),!Be)return;const Ge={status:He.status,statusText:He.statusText,headers:new d.Headers};He.headers.forEach((dt,ut)=>Ge.headers.set(ut,dt));const Xe=pn(He.headers.get("Cache-Control")||"");if(Xe["no-store"])return;Xe["max-age"]&&Ge.headers.set("Expires",new Date(Le+1e3*Xe["max-age"]).toUTCString());const je=Ge.headers.get("Expires");je&&(new Date(je).getTime()-Le<42e4||function(dt,ut){if(Se===void 0)try{new Response(new ReadableStream),Se=!0}catch{Se=!1}Se?ut(dt.body):dt.blob().then(ut)}(He,dt=>{const ut=new d.Response(dt,Ge);fn(),Be&&Be.then(Tt=>Tt.put(Nn(Re.url),ut)).catch(Tt=>At(Tt.message))}))}(M,ie,he),A=!0,g(null,ge,K.headers.get("Cache-Control"),K.headers.get("Expires")))}).catch(ge=>{D||g(new Error(ge.message))})};return z?function(K,ie){if(fn(),!Be)return ie(null);const he=Nn(K.url);Be.then(ge=>{ge.match(he).then(Re=>{const He=function(Le){if(!Le)return!1;const Ge=new Date(Le.headers.get("Expires")||0),Xe=pn(Le.headers.get("Cache-Control")||"");return Ge>Date.now()&&!Xe["no-cache"]}(Re);ge.delete(he),He&&ge.put(he,Re.clone()),ie(null,Re,He)}).catch(ie)}).catch(ie)}(M,q):q(null,null),{cancel:()=>{D=!0,A||v.abort()}}}(c,o);if(An()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,o,void 0,!0)}var u;return function(f,g){const v=new d.XMLHttpRequest;v.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(v.responseType="arraybuffer");for(const M in f.headers)v.setRequestHeader(M,f.headers[M]);return f.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=f.credentials==="include",v.onerror=()=>{g(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let M=v.response;if(f.type==="json")try{M=JSON.parse(v.response)}catch(A){return g(A)}g(null,M,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else g(new Un(v.statusText,v.status,f.url))},v.send(f.body),{cancel:()=>v.abort()}}(c,o)},Zt=function(c,o){return It(Pe(c,{type:"arrayBuffer"}),o)};function sn(c){const o=d.document.createElement("a");return o.href=c,o.protocol===d.document.location.protocol&&o.host===d.document.location.host}const Yn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let li,Bi;li=[],Bi=0;const rt=function(c,o){if(T.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Bi>=S.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:c,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return li.push(v),v}Bi++;let u=!1;const f=()=>{if(!u)for(u=!0,Bi--;li.length&&Bi<S.MAX_PARALLEL_IMAGE_REQUESTS;){const v=li.shift(),{requestParameters:M,callback:A,cancelled:D}=v;D||(v.cancel=rt(M,A).cancel)}},g=Zt(c,(v,M,A,D)=>{f(),v?o(v):M&&(d.createImageBitmap?function(z,W){const q=new d.Blob([new Uint8Array(z)],{type:"image/png"});d.createImageBitmap(q).then(X=>{W(null,X)}).catch(X=>{W(new Error(`Could not load image because of ${X.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(M,(z,W)=>o(z,W,A,D)):function(z,W){const q=new d.Image,X=d.URL;q.onload=()=>{W(null,q),X.revokeObjectURL(q.src),q.onload=null,d.requestAnimationFrame(()=>{q.src=Yn})},q.onerror=()=>W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const K=new d.Blob([new Uint8Array(z)],{type:"image/png"});q.src=z.byteLength?X.createObjectURL(K):Yn}(M,(z,W)=>o(z,W,A,D)))});return{cancel:()=>{g.cancel(),f()}}},Ct="NO_ACCESS_TOKEN";function Vt(c){return c.indexOf("mapbox:")===0}function bn(c){return S.API_URL_REGEX.test(c)}function Pn(c){return S.API_CDN_URL_REGEX.test(c)}function Ri(c){return S.API_STYLE_REGEX.test(c)&&!cr(c)}function cr(c){return S.API_SPRITE_REGEX.test(c)}const Or=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Cr(c){const o=c.match(Or);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Gi(c){const o=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${o}`}function Kr(c){if(!c)return null;const o=c.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(d.atob(o[1]).split("").map(u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ee{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const u=Kr(S.ACCESS_TOKEN);let f="";return f=u&&u.u?d.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,(g,v)=>String.fromCharCode(Number("0x"+v)))):S.ACCESS_TOKEN||"",o?`mapbox.eventData.${o}:${f}`:`mapbox.eventData:${f}`}fetchEventData(){const o=Zn("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{const g=d.localStorage.getItem(u);g&&(this.eventData=JSON.parse(g));const v=d.localStorage.getItem(f);v&&(this.anonId=v)}catch{At("Unable to read from LocalStorage")}}saveEventData(){const o=Zn("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{d.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&d.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{At("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,u,f,g){if(!S.EVENTS_URL)return;const v=Cr(S.EVENTS_URL);v.params.push(`access_token=${g||S.ACCESS_TOKEN||""}`);const M={event:this.type,created:new Date(o).toISOString()},A=u?Pe(M,u):M,D={url:Gi(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=function(z,W){return It(Pe(z,{method:"POST"}),W)}(D,z=>{this.pendingRequest=null,f(z),this.saveEventData(),this.processRequests(g)})}queueRequest(o,u){this.queue.push(o),this.processRequests(u)}}const se=new class extends Ee{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,o){S.EVENTS_URL&&S.ACCESS_TOKEN&&Array.isArray(c)&&c.some(u=>Vt(u)||bn(u))&&this.queueRequest(Date.now(),o)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Kr(S.ACCESS_TOKEN),u=o?o.u:S.ACCESS_TOKEN;let f=u!==this.eventData.tokenU;et(this.anonId)||(this.anonId=nt(),f=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),M=new Date(g),A=(g-this.eventData.lastSuccess)/864e5;f=f||A>=1||A<-1||v.getDate()!==M.getDate()}else f=!0;f?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:m,skuId:F,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=g,this.eventData.tokenU=u)},c):this.processRequests()}},de=se.postTurnstileEvent.bind(se),Ie=new class extends Ee{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,o,u,f){this.skuToken=o,this.errorCb=f,S.EVENTS_URL&&(u||S.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},u):this.errorCb(new Error(Ct)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),et(this.anonId)||(this.anonId=nt()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:m,skuId:F,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},c))}},ee=Ie.postMapLoadEvent.bind(Ie),pe=new class extends Ee{constructor(){super("gljs.performance")}postPerformanceEvent(c,o){S.EVENTS_URL&&(c||S.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:u}=this.queue.shift(),f=function(g){const v=d.performance.getEntriesByType("resource"),M=d.performance.getEntriesByType("mark"),A=function(X){const K={};if(X){for(const ie in X)if(ie!=="other")for(const he of X[ie]){const ge=`${ie}ResolveRangeMin`,Re=`${ie}ResolveRangeMax`,He=`${ie}RequestCount`,Le=`${ie}RequestCachedCount`;K[ge]=Math.min(K[ge]||1/0,he.startTime),K[Re]=Math.max(K[Re]||-1/0,he.responseEnd);const Ge=Xe=>{K[Xe]===void 0&&(K[Xe]=0),++K[Xe]};he.transferSize!==void 0&&he.transferSize===0&&Ge(Le),Ge(He)}}return K}(function(X,K){const ie={};if(X)for(const he of X){const ge=K(he);ie[ge]===void 0&&(ie[ge]=[]),ie[ge].push(he)}return ie}(v,vt)),D=d.devicePixelRatio,z=d.navigator.connection||d.navigator.mozConnection||d.navigator.webkitConnection,W={counters:[],metadata:[],attributes:[]},q=(X,K,ie)=>{ie!=null&&X.push({name:K,value:ie.toString()})};for(const X in A)q(W.counters,X,A[X]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(q(W.counters,"interactionRangeMin",g.interactionRange[0]),q(W.counters,"interactionRangeMax",g.interactionRange[1])),M)for(const X of Object.keys(ht)){const K=ht[X],ie=M.find(he=>he.name===K);ie&&q(W.counters,K,ie.startTime)}return q(W.counters,"visibilityHidden",g.visibilityHidden),q(W.attributes,"style",function(X){if(X)for(const K of X){const ie=K.name.split("?")[0];if(Ri(ie)){const he=ie.split("/").slice(-2);if(he.length===2)return`mapbox://styles/${he[0]}/${he[1]}`}}}(v)),q(W.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),q(W.attributes,"fogEnabled",g.fogEnabled?"true":"false"),q(W.attributes,"projection",g.projection),q(W.attributes,"zoom",g.zoom),q(W.metadata,"devicePixelRatio",D),q(W.metadata,"connectionEffectiveType",z?z.effectiveType:void 0),q(W.metadata,"navigatorUserAgent",d.navigator.userAgent),q(W.metadata,"screenWidth",d.screen.width),q(W.metadata,"screenHeight",d.screen.height),q(W.metadata,"windowWidth",d.innerWidth),q(W.metadata,"windowHeight",d.innerHeight),q(W.metadata,"mapWidth",g.width/D),q(W.metadata,"mapHeight",g.height/D),q(W.metadata,"webglRenderer",g.renderer),q(W.metadata,"webglVendor",g.vendor),q(W.metadata,"sdkVersion",m),q(W.metadata,"sdkIdentifier","mapbox-gl-js"),W}(u);for(const g of f.metadata);for(const g of f.counters);for(const g of f.attributes);this.postEvent(o,f,()=>{},c)}},Ae=pe.postPerformanceEvent.bind(pe),ye=new class extends Ee{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,o,u,f){if(!S.API_URL||!S.SESSION_PATH)return;const g=Cr(S.API_URL+S.SESSION_PATH);g.params.push(`sku=${o||""}`),g.params.push(`access_token=${f||S.ACCESS_TOKEN||""}`);const v={url:Gi(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(M,A){return It(Pe(M,{method:"GET"}),A)}(v,M=>{this.pendingRequest=null,u(M),this.saveEventData(),this.processRequests(f)})}getSessionAPI(c,o,u,f){this.skuToken=o,this.errorCb=f,S.SESSION_PATH&&S.API_URL&&(u||S.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},u):this.errorCb(new Error(Ct)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||this.getSession(u,this.skuToken,f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},c)}},ve=ye.getSessionAPI.bind(ye),Je=new Set,ht={create:"create",load:"load",fullLoad:"fullLoad"},zt={mark(c){d.performance.mark(c)},measure(c,o,u){d.performance.measure(c,o,u)}};function vt(c){const o=c.name.split("?")[0];return Pn(o)&&o.includes("mapbox-gl.js")?"javascript":Pn(o)&&o.includes("mapbox-gl.css")?"css":function(u){return S.API_FONTS_REGEX.test(u)}(o)?"fontRange":cr(o)?"sprite":Ri(o)?"style":function(u){return S.API_TILEJSON_REGEX.test(u)}(o)?"tilejson":"other"}const Kt=d.performance;function Yt(c){const o=c?c.url.toString():void 0;return Kt.getEntriesByName(o)}let Xt,gn,$n,ii;const Sn={now:()=>$n!==void 0?$n:d.performance.now(),setNow(c){$n=c},restoreNow(){$n=void 0},frame(c){const o=d.requestAnimationFrame(c);return{cancel:()=>d.cancelAnimationFrame(o)}},getImageData(c,o=0){const{width:u,height:f}=c;ii||(ii=d.document.createElement("canvas"));const g=ii.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(u>ii.width||f>ii.height)&&(ii.width=u,ii.height=f),g.clearRect(-o,-o,u+2*o,f+2*o),g.drawImage(c,0,0,u,f),g.getImageData(-o,-o,u+2*o,f+2*o)},resolveURL:c=>(Xt||(Xt=d.document.createElement("a")),Xt.href=c,Xt.href),get devicePixelRatio(){return d.devicePixelRatio},get prefersReducedMotion(){return!!d.matchMedia&&(gn==null&&(gn=d.matchMedia("(prefers-reduced-motion: reduce)")),gn.matches)}};function Kn(c,o,u){u[c]&&u[c].indexOf(o)!==-1||(u[c]=u[c]||[],u[c].push(o))}function kn(c,o,u){if(u&&u[c]){const f=u[c].indexOf(o);f!==-1&&u[c].splice(f,1)}}class hs{constructor(o,u={}){Pe(this,u),this.type=o}}class Qi extends hs{constructor(o,u={}){super("error",Pe({error:o},u))}}class Fr{on(o,u){return this._listeners=this._listeners||{},Kn(o,u,this._listeners),this}off(o,u){return kn(o,u,this._listeners),kn(o,u,this._oneTimeListeners),this}once(o,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Kn(o,u,this._oneTimeListeners),this):new Promise(f=>this.once(o,f))}fire(o,u){typeof o=="string"&&(o=new hs(o,u||{}));const f=o.type;if(this.listens(f)){o.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const A of g)A.call(this,o);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const A of v)kn(f,A,this._oneTimeListeners),A.call(this,o);const M=this._eventedParent;M&&(Pe(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),M.fire(o))}else o instanceof Qi&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,u){return this._eventedParent=o,this._eventedParentData=u,this}}var wt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ss(c,...o){for(const u of o)for(const f in u)c[f]=u[f];return c}function er(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Ni(c){if(Array.isArray(c))return c.map(Ni);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const o={};for(const u in c)o[u]=Ni(c[u]);return o}return er(c)}class zi extends Error{constructor(o,u){super(u),this.message=u,this.key=o}}var ci=zi;class yr{constructor(o,u=[]){this.parent=o,this.bindings={};for(const[f,g]of u)this.bindings[f]=g}concat(o){return new yr(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var Nr=yr;const qi={kind:"null"},Jt={kind:"number"},ni={kind:"string"},Jn={kind:"boolean"},lo={kind:"color"},Vl={kind:"object"},ri={kind:"value"},Gl={kind:"collator"},kc={kind:"formatted"},ds={kind:"resolvedImage"};function Ms(c,o){return{kind:"array",itemType:c,N:o}}function xr(c){if(c.kind==="array"){const o=xr(c.itemType);return typeof c.N=="number"?`array<${o}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${o}>`}return c.kind}const Da=[qi,Jt,ni,Jn,lo,kc,Vl,Ms(ri),ds];function Wl(c,o){if(o.kind==="error")return null;if(c.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Wl(c.itemType,o.itemType))&&(typeof c.N!="number"||c.N===o.N))return null}else{if(c.kind===o.kind)return null;if(c.kind==="value"){for(const u of Da)if(!Wl(u,o))return null}}return`Expected ${xr(c)} but found ${xr(o)} instead.`}function Hl(c,o){return o.some(u=>u.kind===c.kind)}function il(c,o){return o.some(u=>u==="null"?c===null:u==="array"?Array.isArray(c):u==="object"?c&&!Array.isArray(c)&&typeof c=="object":u===typeof c)}var jl,Lp={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ql(c){return(c=Math.round(c))<0?0:c>255?255:c}function Dc(c){return ql(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function Ru(c){return(o=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:o>1?1:o;var o}function Lc(c,o,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?c+(o-c)*u*6:2*u<1?o:3*u<2?c+(o-c)*(2/3-u)*6:c}try{jl={}.parseCSSColor=function(c){var o,u=c.replace(/ /g,"").toLowerCase();if(u in Lp)return Lp[u].slice();if(u[0]==="#")return u.length===4?(o=parseInt(u.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:u.length===7&&(o=parseInt(u.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var f=u.indexOf("("),g=u.indexOf(")");if(f!==-1&&g+1===u.length){var v=u.substr(0,f),M=u.substr(f+1,g-(f+1)).split(","),A=1;switch(v){case"rgba":if(M.length!==4)return null;A=Ru(M.pop());case"rgb":return M.length!==3?null:[Dc(M[0]),Dc(M[1]),Dc(M[2]),A];case"hsla":if(M.length!==4)return null;A=Ru(M.pop());case"hsl":if(M.length!==3)return null;var D=(parseFloat(M[0])%360+360)%360/360,z=Ru(M[1]),W=Ru(M[2]),q=W<=.5?W*(z+1):W+z-W*z,X=2*W-q;return[ql(255*Lc(X,q,D+1/3)),ql(255*Lc(X,q,D)),ql(255*Lc(X,q,D-1/3)),A];default:return null}}return null}}catch{}class co{constructor(o,u,f,g=1){this.r=o,this.g=u,this.b=f,this.a=g}static parse(o){if(!o)return;if(o instanceof co)return o;if(typeof o!="string")return;const u=jl(o);return u?new co(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[o,u,f,g]=this.toArray();return`rgba(${Math.round(o)},${Math.round(u)},${Math.round(f)},${g})`}toArray(){const{r:o,g:u,b:f,a:g}=this;return g===0?[0,0,0,0]:[255*o/g,255*u/g,255*f/g,g]}toArray01(){const{r:o,g:u,b:f,a:g}=this;return g===0?[0,0,0,0]:[o/g,u/g,f/g,g]}toArray01PremultipliedAlpha(){const{r:o,g:u,b:f,a:g}=this;return[o,u,f,g]}}co.black=new co(0,0,0,1),co.white=new co(1,1,1,1),co.transparent=new co(0,0,0,0),co.red=new co(1,0,0,1),co.blue=new co(0,0,1,1);var vr=co;class Ei{constructor(o,u,f){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,u){return this.collator.compare(o,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $d{constructor(o,u,f,g,v){this.text=o.normalize?o.normalize():o,this.image=u,this.scale=f,this.fontStack=g,this.textColor=v}}class Qr{constructor(o){this.sections=o}static fromString(o){return new Qr([new $d(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Qr?o:Qr.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const u of this.sections){if(u.image){o.push(["image",u.image.name]);continue}o.push(u.text);const f={};u.fontStack&&(f["text-font"]=["literal",u.fontStack.split(",")]),u.scale&&(f["font-scale"]=u.scale),u.textColor&&(f["text-color"]=["rgba"].concat(u.textColor.toArray())),o.push(f)}return o}}class To{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new To({name:o,available:!1}):null}serialize(){return["image",this.name]}}function Eg(c,o,u,f){return typeof c=="number"&&c>=0&&c<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,o,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,o,u,f]:[c,o,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xd(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof vr||c instanceof Ei||c instanceof Qr||c instanceof To)return!0;if(Array.isArray(c)){for(const o of c)if(!Xd(o))return!1;return!0}if(typeof c=="object"){for(const o in c)if(!Xd(c[o]))return!1;return!0}return!1}function wi(c){if(c===null)return qi;if(typeof c=="string")return ni;if(typeof c=="boolean")return Jn;if(typeof c=="number")return Jt;if(c instanceof vr)return lo;if(c instanceof Ei)return Gl;if(c instanceof Qr)return kc;if(c instanceof To)return ds;if(Array.isArray(c)){const o=c.length;let u;for(const f of c){const g=wi(f);if(u){if(u===g)continue;u=ri;break}u=g}return Ms(u||ri,o)}return Vl}function Rc(c){const o=typeof c;return c===null?"":o==="string"||o==="number"||o==="boolean"?String(c):c instanceof vr||c instanceof Qr||c instanceof To?c.toString():JSON.stringify(c)}class Rp{constructor(o,u){this.type=o,this.value=u}static parse(o,u){if(o.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Xd(o[1]))return u.error("invalid value");const f=o[1];let g=wi(f);const v=u.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new Rp(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vr?["rgba"].concat(this.value.toArray()):this.value instanceof Qr?this.value.serialize():this.value}}var zc=Rp,fs=class{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}};const rl={string:ni,number:Jt,boolean:Jn,object:Vl};class Uo{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");let f,g=1;const v=o[0];if(v==="array"){let A,D;if(o.length>2){const z=o[1];if(typeof z!="string"||!(z in rl)||z==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);A=rl[z],g++}else A=ri;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);D=o[2],g++}f=Ms(A,D)}else f=rl[v];const M=[];for(;g<o.length;g++){const A=u.parse(o[g],g,ri);if(!A)return null;M.push(A)}return new Uo(f,M)}evaluate(o){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(o);if(!Wl(this.type,wi(f)))return f;if(u===this.args.length-1)throw new fs(`Expected value to be of type ${xr(this.type)}, but found ${xr(wi(f))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,u=[o.kind];if(o.kind==="array"){const f=o.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){u.push(f.kind);const g=o.N;(typeof g=="number"||this.args.length>1)&&u.push(g)}}return u.concat(this.args.map(f=>f.serialize()))}}var sl=Uo;class Eh{constructor(o){this.type=kc,this.sections=o}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const g=[];let v=!1;for(let M=1;M<=o.length-1;++M){const A=o[M];if(v&&typeof A=="object"&&!Array.isArray(A)){v=!1;let D=null;if(A["font-scale"]&&(D=u.parse(A["font-scale"],1,Jt),!D))return null;let z=null;if(A["text-font"]&&(z=u.parse(A["text-font"],1,Ms(ni)),!z))return null;let W=null;if(A["text-color"]&&(W=u.parse(A["text-color"],1,lo),!W))return null;const q=g[g.length-1];q.scale=D,q.font=z,q.textColor=W}else{const D=u.parse(o[M],1,ri);if(!D)return null;const z=D.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:D,scale:null,font:null,textColor:null})}}return new Eh(g)}evaluate(o){return new Qr(this.sections.map(u=>{const f=u.content.evaluate(o);return wi(f)===ds?new $d("",f,null,null,null):new $d(Rc(f),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))}eachChild(o){for(const u of this.sections)o(u.content),u.scale&&o(u.scale),u.font&&o(u.font),u.textColor&&o(u.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const u of this.sections){o.push(u.content.serialize());const f={};u.scale&&(f["font-scale"]=u.scale.serialize()),u.font&&(f["text-font"]=u.font.serialize()),u.textColor&&(f["text-color"]=u.textColor.serialize()),o.push(f)}return o}}class Eo{constructor(o){this.type=ds,this.input=o}static parse(o,u){if(o.length!==2)return u.error("Expected two arguments.");const f=u.parse(o[1],1,ni);return f?new Eo(f):u.error("No image name provided.")}evaluate(o){const u=this.input.evaluate(o),f=To.fromString(u);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(u)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ol={"to-boolean":Jn,"to-color":lo,"to-number":Jt,"to-string":ni};class zu{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[0];if((f==="to-boolean"||f==="to-string")&&o.length!==2)return u.error("Expected one argument.");const g=ol[f],v=[];for(let M=1;M<o.length;M++){const A=u.parse(o[M],M,ri);if(!A)return null;v.push(A)}return new zu(g,v)}evaluate(o){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(o));if(this.type.kind==="color"){let u,f;for(const g of this.args){if(u=g.evaluate(o),f=null,u instanceof vr)return u;if(typeof u=="string"){const v=o.parseColor(u);if(v)return v}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Eg(u[0],u[1],u[2],u[3]),!f))return new vr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new fs(f||`Could not parse color from value '${typeof u=="string"?u:String(JSON.stringify(u))}'`)}if(this.type.kind==="number"){let u=null;for(const f of this.args){if(u=f.evaluate(o),u===null)return 0;const g=Number(u);if(!isNaN(g))return g}throw new fs(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?Qr.fromString(Rc(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?To.fromString(Rc(this.args[0].evaluate(o))):Rc(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Eh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Eo(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(u=>{o.push(u.serialize())}),o}}var al=zu;const Ah=["Unknown","Point","LineString","Polygon"];var Ag=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ah[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const c=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-c[0])+this.featureDistanceData.bearing[1]*(f*o-c[1])}return 0}parseColor(c){let o=this._parseColorCache[c];return o||(o=this._parseColorCache[c]=vr.parse(c)),o}};class qs{constructor(o,u,f,g){this.name=o,this.type=u,this._evaluate=f,this.args=g}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,u){const f=o[0],g=qs.definitions[f];if(!g)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,M=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,A=M.filter(([z])=>!Array.isArray(z)||z.length===o.length-1);let D=null;for(const[z,W]of A){D=new Ra(u.registry,u.path,null,u.scope);const q=[];let X=!1;for(let K=1;K<o.length;K++){const ie=o[K],he=Array.isArray(z)?z[K-1]:z.type,ge=D.parse(ie,1+q.length,he);if(!ge){X=!0;break}q.push(ge)}if(!X)if(Array.isArray(z)&&z.length!==q.length)D.error(`Expected ${z.length} arguments, but found ${q.length} instead.`);else{for(let K=0;K<q.length;K++){const ie=Array.isArray(z)?z[K]:z.type,he=q[K];D.concat(K+1).checkSubtype(ie,he.type)}if(D.errors.length===0)return new qs(f,v,W,q)}}if(A.length===1)u.errors.push(...D.errors);else{const z=(A.length?A:M).map(([q])=>{return X=q,Array.isArray(X)?`(${X.map(xr).join(", ")})`:`(${xr(X.type)}...)`;var X}).join(" | "),W=[];for(let q=1;q<o.length;q++){const X=u.parse(o[q],1+W.length);if(!X)return null;W.push(xr(X.type))}u.error(`Expected arguments of type ${z}, but found (${W.join(", ")}) instead.`)}return null}static register(o,u){qs.definitions=u;for(const f in u)o[f]=qs}}var Zl=qs;class Oc{constructor(o,u,f){this.type=Gl,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=u}static parse(o,u){if(o.length!==2)return u.error("Expected one argument.");const f=o[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const g=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Jn);if(!g)return null;const v=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Jn);if(!v)return null;let M=null;return f.locale&&(M=u.parse(f.locale,1,ni),!M)?null:new Oc(g,v,M)}evaluate(o){return new Ei(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Ts=8192;function uo(c,o){c[0]=Math.min(c[0],o[0]),c[1]=Math.min(c[1],o[1]),c[2]=Math.max(c[2],o[0]),c[3]=Math.max(c[3],o[1])}function $l(c,o){return!(c[0]<=o[0]||c[2]>=o[2]||c[1]<=o[1]||c[3]>=o[3])}function Ch(c,o){const u=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(u*g*Ts),Math.round(f*g*Ts)]}function Fc(c,o,u){const f=c[0]-o[0],g=c[1]-o[1],v=c[0]-u[0],M=c[1]-u[1];return f*M-v*g==0&&f*v<=0&&g*M<=0}function Ou(c,o){let u=!1;for(let M=0,A=o.length;M<A;M++){const D=o[M];for(let z=0,W=D.length;z<W-1;z++){if(Fc(c,D[z],D[z+1]))return!1;(g=D[z])[1]>(f=c)[1]!=(v=D[z+1])[1]>f[1]&&f[0]<(v[0]-g[0])*(f[1]-g[1])/(v[1]-g[1])+g[0]&&(u=!u)}}var f,g,v;return u}function Yd(c,o){for(let u=0;u<o.length;u++)if(Ou(c,o[u]))return!0;return!1}function Ih(c,o,u,f){const g=f[0]-u[0],v=f[1]-u[1],M=(c[0]-u[0])*v-g*(c[1]-u[1]),A=(o[0]-u[0])*v-g*(o[1]-u[1]);return M>0&&A<0||M<0&&A>0}function Bc(c,o,u){for(const z of u)for(let W=0;W<z.length-1;++W)if((A=[(M=z[W+1])[0]-(v=z[W])[0],M[1]-v[1]])[0]*(D=[(g=o)[0]-(f=c)[0],g[1]-f[1]])[1]-A[1]*D[0]!=0&&Ih(f,g,v,M)&&Ih(v,M,f,g))return!0;var f,g,v,M,A,D;return!1}function Ph(c,o){for(let u=0;u<c.length;++u)if(!Ou(c[u],o))return!1;for(let u=0;u<c.length-1;++u)if(Bc(c[u],c[u+1],o))return!1;return!0}function Nc(c,o){for(let u=0;u<o.length;u++)if(Ph(c,o[u]))return!0;return!1}function Fs(c,o,u){const f=[];for(let g=0;g<c.length;g++){const v=[];for(let M=0;M<c[g].length;M++){const A=Ch(c[g][M],u);uo(o,A),v.push(A)}f.push(v)}return f}function Vo(c,o,u){const f=[];for(let g=0;g<c.length;g++){const v=Fs(c[g],o,u);f.push(v)}return f}function ho(c,o,u,f){if(c[0]<u[0]||c[0]>u[2]){const g=.5*f;let v=c[0]-u[0]>g?-f:u[0]-c[0]>g?f:0;v===0&&(v=c[0]-u[2]>g?-f:u[2]-c[0]>g?f:0),c[0]+=v}uo(o,c)}function Ai(c,o,u,f){const g=Math.pow(2,f.z)*Ts,v=[f.x*Ts,f.y*Ts],M=[];if(!c)return M;for(const A of c)for(const D of A){const z=[D.x+v[0],D.y+v[1]];ho(z,o,u,g),M.push(z)}return M}function zp(c,o,u,f){const g=Math.pow(2,f.z)*Ts,v=[f.x*Ts,f.y*Ts],M=[];if(!c)return M;for(const D of c){const z=[];for(const W of D){const q=[W.x+v[0],W.y+v[1]];uo(o,q),z.push(q)}M.push(z)}if(o[2]-o[0]<=g/2){(A=o)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const D of M)for(const z of D)ho(z,o,u,g)}var A;return M}class Ao{constructor(o,u){this.type=Jn,this.geojson=o,this.geometries=u}static parse(o,u){if(o.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Xd(o[1])){const f=o[1];if(f.type==="FeatureCollection")for(let g=0;g<f.features.length;++g){const v=f.features[g].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Ao(f,f.features[g].geometry)}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ao(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Ao(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],M=u.canonicalID();if(!M)return!1;if(f.type==="Polygon"){const A=Fs(f.coordinates,v,M),D=Ai(u.geometry(),g,v,M);if(!$l(g,v))return!1;for(const z of D)if(!Ou(z,A))return!1}if(f.type==="MultiPolygon"){const A=Vo(f.coordinates,v,M),D=Ai(u.geometry(),g,v,M);if(!$l(g,v))return!1;for(const z of D)if(!Yd(z,A))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],M=u.canonicalID();if(!M)return!1;if(f.type==="Polygon"){const A=Fs(f.coordinates,v,M),D=zp(u.geometry(),g,v,M);if(!$l(g,v))return!1;for(const z of D)if(!Ph(z,A))return!1}if(f.type==="MultiPolygon"){const A=Vo(f.coordinates,v,M),D=zp(u.geometry(),g,v,M);if(!$l(g,v))return!1;for(const z of D)if(!Nc(z,A))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var La=Ao;function ll(c){if(c instanceof Zl&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof La)return!1;let o=!0;return c.eachChild(u=>{o&&!ll(u)&&(o=!1)}),o}function kh(c){if(c instanceof Zl&&c.name==="feature-state")return!1;let o=!0;return c.eachChild(u=>{o&&!kh(u)&&(o=!1)}),o}function Xl(c,o){if(c instanceof Zl&&o.indexOf(c.name)>=0)return!1;let u=!0;return c.eachChild(f=>{u&&!Xl(f,o)&&(u=!1)}),u}class Dh{constructor(o,u){this.type=u.type,this.name=o,this.boundExpression=u}static parse(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=o[1];return u.scope.has(f)?new Dh(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Jd=Dh;class Fu{constructor(o,u=[],f,g=new Nr,v=[]){this.registry=o,this.path=u,this.key=u.map(M=>`[${M}]`).join(""),this.scope=g,this.errors=v,this.expectedType=f}parse(o,u,f,g,v={}){return u?this.concat(u,f,g)._parse(o,v):this._parse(o,v)}_parse(o,u){function f(g,v,M){return M==="assert"?new sl(v,[g]):M==="coerce"?new al(v,[g]):g}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=o[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let M=v.parse(o,this);if(!M)return null;if(this.expectedType){const A=this.expectedType,D=M.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||D.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||D.kind!=="value"&&D.kind!=="string"){if(this.checkSubtype(A,D))return null}else M=f(M,A,u.typeAnnotation||"coerce");else M=f(M,A,u.typeAnnotation||"assert")}if(!(M instanceof zc)&&M.type.kind!=="resolvedImage"&&Uc(M)){const A=new Ag;try{M=new zc(M.type,M.evaluate(A))}catch(D){return this.error(D.message),null}}return M}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,u,f){const g=typeof o=="number"?this.path.concat(o):this.path,v=f?this.scope.concat(f):this.scope;return new Fu(this.registry,g,u||null,v,this.errors)}error(o,...u){const f=`${this.key}${u.map(g=>`[${g}]`).join("")}`;this.errors.push(new ci(f,o))}checkSubtype(o,u){const f=Wl(o,u);return f&&this.error(f),f}}var Ra=Fu;function Uc(c){if(c instanceof Jd)return Uc(c.boundExpression);if(c instanceof Zl&&c.name==="error"||c instanceof Oc||c instanceof La)return!1;const o=c instanceof al||c instanceof sl;let u=!0;return c.eachChild(f=>{u=o?u&&Uc(f):u&&f instanceof zc}),!!u&&ll(c)&&Xl(c,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Lh(c,o){const u=c.length-1;let f,g,v=0,M=u,A=0;for(;v<=M;)if(A=Math.floor((v+M)/2),f=c[A],g=c[A+1],f<=o){if(A===u||o<g)return A;v=A+1}else{if(!(f>o))throw new fs("Input is not a number.");M=A-1}return 0}class Bu{constructor(o,u,f){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(const[g,v]of f)this.labels.push(g),this.outputs.push(v)}static parse(o,u){if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(o[1],1,Jt);if(!f)return null;const g=[];let v=null;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);for(let M=1;M<o.length;M+=2){const A=M===1?-1/0:o[M],D=o[M+1],z=M,W=M+1;if(typeof A!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const q=u.parse(D,W,v);if(!q)return null;v=v||q.type,g.push([A,q])}return new Bu(v,f,g)}evaluate(o){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);const g=this.input.evaluate(o);if(g<=u[0])return f[0].evaluate(o);const v=u.length;return g>=u[v-1]?f[v-1].evaluate(o):f[Lh(u,g)].evaluate(o)}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o}}var Nu=Bu;function hi(c,o,u){return c*(1-u)+o*u}var cl=Object.freeze({__proto__:null,number:hi,color:function(c,o,u){return new vr(hi(c.r,o.r,u),hi(c.g,o.g,u),hi(c.b,o.b,u),hi(c.a,o.a,u))},array:function(c,o,u){return c.map((f,g)=>hi(f,o[g],u))}});const Uu=.95047,Rh=1.08883,fo=4/29,Zs=6/29,Yl=3*Zs*Zs,za=Math.PI/180,ul=180/Math.PI;function Oa(c){return c>.008856451679035631?Math.pow(c,1/3):c/Yl+fo}function zh(c){return c>Zs?c*c*c:Yl*(c-fo)}function Oh(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Fh(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function po(c){const o=Fh(c.r),u=Fh(c.g),f=Fh(c.b),g=Oa((.4124564*o+.3575761*u+.1804375*f)/Uu),v=Oa((.2126729*o+.7151522*u+.072175*f)/1);return{l:116*v-16,a:500*(g-v),b:200*(v-Oa((.0193339*o+.119192*u+.9503041*f)/Rh)),alpha:c.a}}function mo(c){let o=(c.l+16)/116,u=isNaN(c.a)?o:o+c.a/500,f=isNaN(c.b)?o:o-c.b/200;return o=1*zh(o),u=Uu*zh(u),f=Rh*zh(f),new vr(Oh(3.2404542*u-1.5371385*o-.4985314*f),Oh(-.969266*u+1.8760108*o+.041556*f),Oh(.0556434*u-.2040259*o+1.0572252*f),c.alpha)}function Mr(c,o,u){const f=o-c;return c+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const hl={forward:po,reverse:mo,interpolate:function(c,o,u){return{l:hi(c.l,o.l,u),a:hi(c.a,o.a,u),b:hi(c.b,o.b,u),alpha:hi(c.alpha,o.alpha,u)}}},Bs={forward:function(c){const{l:o,a:u,b:f}=po(c),g=Math.atan2(f,u)*ul;return{h:g<0?g+360:g,c:Math.sqrt(u*u+f*f),l:o,alpha:c.a}},reverse:function(c){const o=c.h*za,u=c.c;return mo({l:c.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:c.alpha})},interpolate:function(c,o,u){return{h:Mr(c.h,o.h,u),c:hi(c.c,o.c,u),l:hi(c.l,o.l,u),alpha:hi(c.alpha,o.alpha,u)}}};var Op=Object.freeze({__proto__:null,lab:hl,hcl:Bs});class Bh{constructor(o,u,f,g,v){this.type=o,this.operator=u,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[M,A]of v)this.labels.push(M),this.outputs.push(A)}static interpolationFactor(o,u,f,g){let v=0;if(o.name==="exponential")v=Nh(u,o.base,f,g);else if(o.name==="linear")v=Nh(u,1,f,g);else if(o.name==="cubic-bezier"){const M=o.controlPoints;v=new N(M[0],M[1],M[2],M[3]).solve(Nh(u,1,f,g))}return v}static parse(o,u){let[f,g,v,...M]=o;if(!Array.isArray(g)||g.length===0)return u.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const z=g[1];if(typeof z!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:z}}else{if(g[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const z=g.slice(1);if(z.length!==4||z.some(W=>typeof W!="number"||W<0||W>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:z}}}if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(v=u.parse(v,2,Jt),!v)return null;const A=[];let D=null;f==="interpolate-hcl"||f==="interpolate-lab"?D=lo:u.expectedType&&u.expectedType.kind!=="value"&&(D=u.expectedType);for(let z=0;z<M.length;z+=2){const W=M[z],q=M[z+1],X=z+3,K=z+4;if(typeof W!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(A.length&&A[A.length-1][0]>=W)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const ie=u.parse(q,K,D);if(!ie)return null;D=D||ie.type,A.push([W,ie])}return D.kind==="number"||D.kind==="color"||D.kind==="array"&&D.itemType.kind==="number"&&typeof D.N=="number"?new Bh(D,f,g,v,A):u.error(`Type ${xr(D)} is not interpolatable.`)}evaluate(o){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);const g=this.input.evaluate(o);if(g<=u[0])return f[0].evaluate(o);const v=u.length;if(g>=u[v-1])return f[v-1].evaluate(o);const M=Lh(u,g),A=Bh.interpolationFactor(this.interpolation,g,u[M],u[M+1]),D=f[M].evaluate(o),z=f[M+1].evaluate(o);return this.operator==="interpolate"?cl[this.type.kind.toLowerCase()](D,z,A):this.operator==="interpolate-hcl"?Bs.reverse(Bs.interpolate(Bs.forward(D),Bs.forward(z),A)):hl.reverse(hl.interpolate(hl.forward(D),hl.forward(z),A))}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const u=[this.operator,o,this.input.serialize()];for(let f=0;f<this.labels.length;f++)u.push(this.labels[f],this.outputs[f].serialize());return u}}function Nh(c,o,u,f){const g=f-u,v=c-u;return g===0?0:o===1?v/g:(Math.pow(o,v)-1)/(Math.pow(o,g)-1)}var Go=Bh;class Uh{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expectected at least one argument.");let f=null;const g=u.expectedType;g&&g.kind!=="value"&&(f=g);const v=[];for(const A of o.slice(1)){const D=u.parse(A,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!D)return null;f=f||D.type,v.push(D)}const M=g&&v.some(A=>Wl(g,A.type));return new Uh(M?ri:f,v)}evaluate(o){let u,f=null,g=0;for(const v of this.args){if(g++,f=v.evaluate(o),f&&f instanceof To&&!f.available&&(u||(u=f),f=null,g===this.args.length))return u;if(f!==null)break}return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(u=>{o.push(u.serialize())}),o}}var Vc=Uh;class dl{constructor(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const u of this.bindings)o(u[1]);o(this.result)}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let v=1;v<o.length-1;v+=2){const M=o[v];if(typeof M!="string")return u.error(`Expected string, but found ${typeof M} instead.`,v);if(/[^a-zA-Z0-9_]/.test(M))return u.error("Variable names must contain only alphanumeric characters or '_'.",v);const A=u.parse(o[v+1],v+1);if(!A)return null;f.push([M,A])}const g=u.parse(o[o.length-1],o.length-1,u.expectedType,f);return g?new dl(f,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[u,f]of this.bindings)o.push(u,f.serialize());return o.push(this.result.serialize()),o}}var Kd=dl;class Gc{constructor(o,u,f){this.type=o,this.index=u,this.input=f}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,Jt),g=u.parse(o[2],2,Ms(u.expectedType||ri));return f&&g?new Gc(g.type.itemType,f,g):null}evaluate(o){const u=this.index.evaluate(o),f=this.input.evaluate(o);if(u<0)throw new fs(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new fs(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new fs(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Vh=Gc;class Gh{constructor(o,u){this.type=Jn,this.needle=o,this.haystack=u}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,ri),g=u.parse(o[2],2,ri);return f&&g?Hl(f.type,[Jn,ni,Jt,qi,ri])?new Gh(f,g):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${xr(f.type)} instead`):null}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(f==null)return!1;if(!il(u,["boolean","string","number","null"]))throw new fs(`Expected first argument to be of type boolean, string, number or null, but found ${xr(wi(u))} instead.`);if(!il(f,["string","array"]))throw new fs(`Expected second argument to be of type array or string, but found ${xr(wi(f))} instead.`);return f.indexOf(u)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Fp=Gh;class fl{constructor(o,u,f){this.type=Jt,this.needle=o,this.haystack=u,this.fromIndex=f}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,ri),g=u.parse(o[2],2,ri);if(!f||!g)return null;if(!Hl(f.type,[Jn,ni,Jt,qi,ri]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${xr(f.type)} instead`);if(o.length===4){const v=u.parse(o[3],3,Jt);return v?new fl(f,g,v):null}return new fl(f,g)}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!il(u,["boolean","string","number","null"]))throw new fs(`Expected first argument to be of type boolean, string, number or null, but found ${xr(wi(u))} instead.`);if(!il(f,["string","array"]))throw new fs(`Expected second argument to be of type array or string, but found ${xr(wi(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(o);return f.indexOf(u,g)}return f.indexOf(u)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Cg=fl;class Wc{constructor(o,u,f,g,v,M){this.inputType=o,this.type=u,this.input=f,this.cases=g,this.outputs=v,this.otherwise=M}static parse(o,u){if(o.length<5)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return u.error("Expected an even number of arguments.");let f,g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const v={},M=[];for(let z=2;z<o.length-1;z+=2){let W=o[z];const q=o[z+1];Array.isArray(W)||(W=[W]);const X=u.concat(z);if(W.length===0)return X.error("Expected at least one branch label.");for(const ie of W){if(typeof ie!="number"&&typeof ie!="string")return X.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return X.error("Numeric branch labels must be integer values.");if(f){if(X.checkSubtype(f,wi(ie)))return null}else f=wi(ie);if(v[String(ie)]!==void 0)return X.error("Branch labels must be unique.");v[String(ie)]=M.length}const K=u.parse(q,z,g);if(!K)return null;g=g||K.type,M.push(K)}const A=u.parse(o[1],1,ri);if(!A)return null;const D=u.parse(o[o.length-1],o.length-1,g);return D?A.type.kind!=="value"&&u.concat(1).checkSubtype(f,A.type)?null:new Wc(f,g,A,v,M,D):null}evaluate(o){const u=this.input.evaluate(o);return(wi(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],u=Object.keys(this.cases).sort(),f=[],g={};for(const M of u){const A=g[this.cases[M]];A===void 0?(g[this.cases[M]]=f.length,f.push([this.cases[M],[M]])):f[A][1].push(M)}const v=M=>this.inputType.kind==="number"?Number(M):M;for(const[M,A]of f)o.push(A.length===1?v(A[0]):A.map(v)),o.push(this.outputs[M].serialize());return o.push(this.otherwise.serialize()),o}}var Wo=Wc;class Fa{constructor(o,u,f){this.type=o,this.branches=u,this.otherwise=f}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const g=[];for(let M=1;M<o.length-1;M+=2){const A=u.parse(o[M],M,Jn);if(!A)return null;const D=u.parse(o[M+1],M+1,f);if(!D)return null;g.push([A,D]),f=f||D.type}const v=u.parse(o[o.length-1],o.length-1,f);return v?new Fa(f,g,v):null}evaluate(o){for(const[u,f]of this.branches)if(u.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[u,f]of this.branches)o(u),o(f);o(this.otherwise)}outputDefined(){return this.branches.every(([o,u])=>u.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(u=>{o.push(u.serialize())}),o}}var Hc=Fa;class go{constructor(o,u,f,g){this.type=o,this.input=u,this.beginIndex=f,this.endIndex=g}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,ri),g=u.parse(o[2],2,Jt);if(!f||!g)return null;if(!Hl(f.type,[Ms(ri),ni,ri]))return u.error(`Expected first argument to be of type array or string, but found ${xr(f.type)} instead`);if(o.length===4){const v=u.parse(o[3],3,Jt);return v?new go(f.type,f,g,v):null}return new go(f.type,f,g)}evaluate(o){const u=this.input.evaluate(o),f=this.beginIndex.evaluate(o);if(!il(u,["string","array"]))throw new fs(`Expected first argument to be of type array or string, but found ${xr(wi(u))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(o);return u.slice(f,g)}return u.slice(f)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Bp=go;function jc(c,o){return c==="=="||c==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Np(c,o,u,f){return f.compare(o,u)===0}function pl(c,o,u){const f=c!=="=="&&c!=="!=";return class qU{constructor(v,M,A){this.type=Jn,this.lhs=v,this.rhs=M,this.collator=A,this.hasUntypedArgument=v.type.kind==="value"||M.type.kind==="value"}static parse(v,M){if(v.length!==3&&v.length!==4)return M.error("Expected two or three arguments.");const A=v[0];let D=M.parse(v[1],1,ri);if(!D)return null;if(!jc(A,D.type))return M.concat(1).error(`"${A}" comparisons are not supported for type '${xr(D.type)}'.`);let z=M.parse(v[2],2,ri);if(!z)return null;if(!jc(A,z.type))return M.concat(2).error(`"${A}" comparisons are not supported for type '${xr(z.type)}'.`);if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return M.error(`Cannot compare types '${xr(D.type)}' and '${xr(z.type)}'.`);f&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new sl(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new sl(D.type,[z])));let W=null;if(v.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return M.error("Cannot use collator to compare non-string types.");if(W=M.parse(v[3],3,Gl),!W)return null}return new qU(D,z,W)}evaluate(v){const M=this.lhs.evaluate(v),A=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const D=wi(M),z=wi(A);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new fs(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${D.kind}, ${z.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const D=wi(M),z=wi(A);if(D.kind!=="string"||z.kind!=="string")return o(v,M,A)}return this.collator?u(v,M,A,this.collator.evaluate(v)):o(v,M,A)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}serialize(){const v=[c];return this.eachChild(M=>{v.push(M.serialize())}),v}}}const Tr=pl("==",function(c,o,u){return o===u},Np),Wh=pl("!=",function(c,o,u){return o!==u},function(c,o,u,f){return!Np(0,o,u,f)}),Hh=pl("<",function(c,o,u){return o<u},function(c,o,u,f){return f.compare(o,u)<0}),Up=pl(">",function(c,o,u){return o>u},function(c,o,u,f){return f.compare(o,u)>0}),Qd=pl("<=",function(c,o,u){return o<=u},function(c,o,u,f){return f.compare(o,u)<=0}),Ho=pl(">=",function(c,o,u){return o>=u},function(c,o,u,f){return f.compare(o,u)>=0});class Jl{constructor(o,u,f,g,v,M){this.type=ni,this.number=o,this.locale=u,this.currency=f,this.unit=g,this.minFractionDigits=v,this.maxFractionDigits=M}static parse(o,u){if(o.length!==3)return u.error("Expected two arguments.");const f=u.parse(o[1],1,Jt);if(!f)return null;const g=o[2];if(typeof g!="object"||Array.isArray(g))return u.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=u.parse(g.locale,1,ni),!v))return null;let M=null;if(g.currency&&(M=u.parse(g.currency,1,ni),!M))return null;let A=null;if(g.unit&&(A=u.parse(g.unit,1,ni),!A))return null;let D=null;if(g["min-fraction-digits"]&&(D=u.parse(g["min-fraction-digits"],1,Jt),!D))return null;let z=null;return g["max-fraction-digits"]&&(z=u.parse(g["max-fraction-digits"],1,Jt),!z)?null:new Jl(f,v,M,A,D,z)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Er{constructor(o){this.type=Jt,this.input=o}static parse(o,u){if(o.length!==2)return u.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=u.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${xr(f.type)} instead.`):new Er(f):null}evaluate(o){const u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new fs(`Expected value to be of type string or array, but found ${xr(wi(u))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(u=>{o.push(u.serialize())}),o}}const Es={"==":Tr,"!=":Wh,">":Up,"<":Hh,">=":Ho,"<=":Qd,array:sl,at:Vh,boolean:sl,case:Hc,coalesce:Vc,collator:Oc,format:Eh,image:Eo,in:Fp,"index-of":Cg,interpolate:Go,"interpolate-hcl":Go,"interpolate-lab":Go,length:Er,let:Kd,literal:zc,match:Wo,number:sl,"number-format":Jl,object:sl,slice:Bp,step:Nu,string:sl,"to-boolean":al,"to-color":al,"to-number":al,"to-string":al,var:Jd,within:La};function es(c,[o,u,f,g]){o=o.evaluate(c),u=u.evaluate(c),f=f.evaluate(c);const v=g?g.evaluate(c):1,M=Eg(o,u,f,v);if(M)throw new fs(M);return new vr(o/255*v,u/255*v,f/255*v,v)}function Vu(c,o){return c in o}function Kl(c,o){const u=o[c];return u===void 0?null:u}function _o(c){return{type:c}}Zl.register(Es,{error:[{kind:"error"},[ni],(c,[o])=>{throw new fs(o.evaluate(c))}],typeof:[ni,[ri],(c,[o])=>xr(wi(o.evaluate(c)))],"to-rgba":[Ms(Jt,4),[lo],(c,[o])=>o.evaluate(c).toArray()],rgb:[lo,[Jt,Jt,Jt],es],rgba:[lo,[Jt,Jt,Jt,Jt],es],has:{type:Jn,overloads:[[[ni],(c,[o])=>Vu(o.evaluate(c),c.properties())],[[ni,Vl],(c,[o,u])=>Vu(o.evaluate(c),u.evaluate(c))]]},get:{type:ri,overloads:[[[ni],(c,[o])=>Kl(o.evaluate(c),c.properties())],[[ni,Vl],(c,[o,u])=>Kl(o.evaluate(c),u.evaluate(c))]]},"feature-state":[ri,[ni],(c,[o])=>Kl(o.evaluate(c),c.featureState||{})],properties:[Vl,[],c=>c.properties()],"geometry-type":[ni,[],c=>c.geometryType()],id:[ri,[],c=>c.id()],zoom:[Jt,[],c=>c.globals.zoom],pitch:[Jt,[],c=>c.globals.pitch||0],"distance-from-center":[Jt,[],c=>c.distanceFromCenter()],"heatmap-density":[Jt,[],c=>c.globals.heatmapDensity||0],"line-progress":[Jt,[],c=>c.globals.lineProgress||0],"sky-radial-progress":[Jt,[],c=>c.globals.skyRadialProgress||0],accumulated:[ri,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Jt,_o(Jt),(c,o)=>{let u=0;for(const f of o)u+=f.evaluate(c);return u}],"*":[Jt,_o(Jt),(c,o)=>{let u=1;for(const f of o)u*=f.evaluate(c);return u}],"-":{type:Jt,overloads:[[[Jt,Jt],(c,[o,u])=>o.evaluate(c)-u.evaluate(c)],[[Jt],(c,[o])=>-o.evaluate(c)]]},"/":[Jt,[Jt,Jt],(c,[o,u])=>o.evaluate(c)/u.evaluate(c)],"%":[Jt,[Jt,Jt],(c,[o,u])=>o.evaluate(c)%u.evaluate(c)],ln2:[Jt,[],()=>Math.LN2],pi:[Jt,[],()=>Math.PI],e:[Jt,[],()=>Math.E],"^":[Jt,[Jt,Jt],(c,[o,u])=>Math.pow(o.evaluate(c),u.evaluate(c))],sqrt:[Jt,[Jt],(c,[o])=>Math.sqrt(o.evaluate(c))],log10:[Jt,[Jt],(c,[o])=>Math.log(o.evaluate(c))/Math.LN10],ln:[Jt,[Jt],(c,[o])=>Math.log(o.evaluate(c))],log2:[Jt,[Jt],(c,[o])=>Math.log(o.evaluate(c))/Math.LN2],sin:[Jt,[Jt],(c,[o])=>Math.sin(o.evaluate(c))],cos:[Jt,[Jt],(c,[o])=>Math.cos(o.evaluate(c))],tan:[Jt,[Jt],(c,[o])=>Math.tan(o.evaluate(c))],asin:[Jt,[Jt],(c,[o])=>Math.asin(o.evaluate(c))],acos:[Jt,[Jt],(c,[o])=>Math.acos(o.evaluate(c))],atan:[Jt,[Jt],(c,[o])=>Math.atan(o.evaluate(c))],min:[Jt,_o(Jt),(c,o)=>Math.min(...o.map(u=>u.evaluate(c)))],max:[Jt,_o(Jt),(c,o)=>Math.max(...o.map(u=>u.evaluate(c)))],abs:[Jt,[Jt],(c,[o])=>Math.abs(o.evaluate(c))],round:[Jt,[Jt],(c,[o])=>{const u=o.evaluate(c);return u<0?-Math.round(-u):Math.round(u)}],floor:[Jt,[Jt],(c,[o])=>Math.floor(o.evaluate(c))],ceil:[Jt,[Jt],(c,[o])=>Math.ceil(o.evaluate(c))],"filter-==":[Jn,[ni,ri],(c,[o,u])=>c.properties()[o.value]===u.value],"filter-id-==":[Jn,[ri],(c,[o])=>c.id()===o.value],"filter-type-==":[Jn,[ni],(c,[o])=>c.geometryType()===o.value],"filter-<":[Jn,[ni,ri],(c,[o,u])=>{const f=c.properties()[o.value],g=u.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Jn,[ri],(c,[o])=>{const u=c.id(),f=o.value;return typeof u==typeof f&&u<f}],"filter->":[Jn,[ni,ri],(c,[o,u])=>{const f=c.properties()[o.value],g=u.value;return typeof f==typeof g&&f>g}],"filter-id->":[Jn,[ri],(c,[o])=>{const u=c.id(),f=o.value;return typeof u==typeof f&&u>f}],"filter-<=":[Jn,[ni,ri],(c,[o,u])=>{const f=c.properties()[o.value],g=u.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Jn,[ri],(c,[o])=>{const u=c.id(),f=o.value;return typeof u==typeof f&&u<=f}],"filter->=":[Jn,[ni,ri],(c,[o,u])=>{const f=c.properties()[o.value],g=u.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Jn,[ri],(c,[o])=>{const u=c.id(),f=o.value;return typeof u==typeof f&&u>=f}],"filter-has":[Jn,[ri],(c,[o])=>o.value in c.properties()],"filter-has-id":[Jn,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Jn,[Ms(ni)],(c,[o])=>o.value.indexOf(c.geometryType())>=0],"filter-id-in":[Jn,[Ms(ri)],(c,[o])=>o.value.indexOf(c.id())>=0],"filter-in-small":[Jn,[ni,Ms(ri)],(c,[o,u])=>u.value.indexOf(c.properties()[o.value])>=0],"filter-in-large":[Jn,[ni,Ms(ri)],(c,[o,u])=>function(f,g,v,M){for(;v<=M;){const A=v+M>>1;if(g[A]===f)return!0;g[A]>f?M=A-1:v=A+1}return!1}(c.properties()[o.value],u.value,0,u.value.length-1)],all:{type:Jn,overloads:[[[Jn,Jn],(c,[o,u])=>o.evaluate(c)&&u.evaluate(c)],[_o(Jn),(c,o)=>{for(const u of o)if(!u.evaluate(c))return!1;return!0}]]},any:{type:Jn,overloads:[[[Jn,Jn],(c,[o,u])=>o.evaluate(c)||u.evaluate(c)],[_o(Jn),(c,o)=>{for(const u of o)if(u.evaluate(c))return!0;return!1}]]},"!":[Jn,[Jn],(c,[o])=>!o.evaluate(c)],"is-supported-script":[Jn,[ni],(c,[o])=>{const u=c.globals&&c.globals.isSupportedScript;return!u||u(o.evaluate(c))}],upcase:[ni,[ni],(c,[o])=>o.evaluate(c).toUpperCase()],downcase:[ni,[ni],(c,[o])=>o.evaluate(c).toLowerCase()],concat:[ni,_o(ri),(c,o)=>o.map(u=>Rc(u.evaluate(c))).join("")],"resolved-locale":[ni,[Gl],(c,[o])=>o.evaluate(c).resolvedLocale()]});var jh=Es;function As(c){return{result:"success",value:c}}function $s(c){return{result:"error",value:c}}function ml(c){return c["property-type"]==="data-driven"}function gl(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function ma(c){return!!c.expression&&c.expression.interpolated}function oi(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function ga(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function ef(c){return c}function qc(c,o){const u=o.type==="color",f=c.stops&&typeof c.stops[0][0]=="object",g=f||!(f||c.property!==void 0),v=c.type||(ma(o)?"exponential":"interval");if(u&&((c=Ss({},c)).stops&&(c.stops=c.stops.map(z=>[z[0],vr.parse(z[1])])),c.default=vr.parse(c.default?c.default:o.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!Op[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let M,A,D;if(v==="exponential")M=nf;else if(v==="interval")M=Vp;else if(v==="categorical"){M=tf,A=Object.create(null);for(const z of c.stops)A[z[0]]=z[1];D=typeof c.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);M=rf}if(f){const z={},W=[];for(let K=0;K<c.stops.length;K++){const ie=c.stops[K],he=ie[0].zoom;z[he]===void 0&&(z[he]={zoom:he,type:c.type,property:c.property,default:c.default,stops:[]},W.push(he)),z[he].stops.push([ie[0].value,ie[1]])}const q=[];for(const K of W)q.push([z[K].zoom,qc(z[K],o)]);const X={name:"linear"};return{kind:"composite",interpolationType:X,interpolationFactor:Go.interpolationFactor.bind(void 0,X),zoomStops:q.map(K=>K[0]),evaluate:({zoom:K},ie)=>nf({stops:q,base:c.base},o,K).evaluate(K,ie)}}if(g){const z=v==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:Go.interpolationFactor.bind(void 0,z),zoomStops:c.stops.map(W=>W[0]),evaluate:({zoom:W})=>M(c,o,W,A,D)}}return{kind:"source",evaluate(z,W){const q=W&&W.properties?W.properties[c.property]:void 0;return q===void 0?Zc(c.default,o.default):M(c,o,q,A,D)}}}function Zc(c,o,u){return c!==void 0?c:o!==void 0?o:u!==void 0?u:void 0}function tf(c,o,u,f,g){return Zc(typeof u===g?f[u]:void 0,c.default,o.default)}function Vp(c,o,u){if(oi(u)!=="number")return Zc(c.default,o.default);const f=c.stops.length;if(f===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[f-1][0])return c.stops[f-1][1];const g=Lh(c.stops.map(v=>v[0]),u);return c.stops[g][1]}function nf(c,o,u){const f=c.base!==void 0?c.base:1;if(oi(u)!=="number")return Zc(c.default,o.default);const g=c.stops.length;if(g===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[g-1][0])return c.stops[g-1][1];const v=Lh(c.stops.map(W=>W[0]),u),M=function(W,q,X,K){const ie=K-X,he=W-X;return ie===0?0:q===1?he/ie:(Math.pow(q,he)-1)/(Math.pow(q,ie)-1)}(u,f,c.stops[v][0],c.stops[v+1][0]),A=c.stops[v][1],D=c.stops[v+1][1];let z=cl[o.type]||ef;if(c.colorSpace&&c.colorSpace!=="rgb"){const W=Op[c.colorSpace];z=(q,X)=>W.reverse(W.interpolate(W.forward(q),W.forward(X),M))}return typeof A.evaluate=="function"?{evaluate(...W){const q=A.evaluate.apply(void 0,W),X=D.evaluate.apply(void 0,W);if(q!==void 0&&X!==void 0)return z(q,X,M)}}:z(A,D,M)}function rf(c,o,u){return o.type==="color"?u=vr.parse(u):o.type==="formatted"?u=Qr.fromString(u.toString()):o.type==="resolvedImage"?u=To.fromString(u.toString()):oi(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),Zc(u,c.default,o.default)}class qh{constructor(o,u){this.expression=o,this._warningHistory={},this._evaluator=new Ag,this._defaultValue=u?function(f){return f.type==="color"&&(ga(f.default)||Array.isArray(f.default))?new vr(0,0,0,0):f.type==="color"?vr.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(o,u,f,g,v,M,A,D){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=g||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=M,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(o,u,f,g,v,M,A,D){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=M||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=D||null;try{const z=this.expression.evaluate(this._evaluator);if(z==null||typeof z=="number"&&z!=z)return this._defaultValue;if(this._enumValues&&!(z in this._enumValues))throw new fs(`Expected value to be one of ${Object.keys(this._enumValues).map(W=>JSON.stringify(W)).join(", ")}, but found ${JSON.stringify(z)} instead.`);return z}catch(z){return this._warningHistory[z.message]||(this._warningHistory[z.message]=!0,typeof console<"u"&&console.warn(z.message)),this._defaultValue}}}function $c(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in jh}function jo(c,o){const u=new Ra(jh,[],o?function(g){const v={color:lo,string:ni,number:Jt,enum:ni,boolean:Jn,formatted:kc,resolvedImage:ds};return g.type==="array"?Ms(v[g.value]||ri,g.length):v[g.type]}(o):void 0),f=u.parse(c,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?As(new qh(f,o)):$s(u.errors)}class _l{constructor(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!kh(u.expression)}evaluateWithoutErrorHandling(o,u,f,g,v,M){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,g,v,M)}evaluate(o,u,f,g,v,M){return this._styleExpression.evaluate(o,u,f,g,v,M)}}class Xc{constructor(o,u,f,g){this.kind=o,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!kh(u.expression),this.interpolationType=g}evaluateWithoutErrorHandling(o,u,f,g,v,M){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,g,v,M)}evaluate(o,u,f,g,v,M){return this._styleExpression.evaluate(o,u,f,g,v,M)}interpolationFactor(o,u,f){return this.interpolationType?Go.interpolationFactor(this.interpolationType,o,u,f):0}}function Gu(c,o){if((c=jo(c,o)).result==="error")return c;const u=c.value.expression,f=ll(u);if(!f&&!ml(o))return $s([new ci("","data expressions not supported")]);const g=Xl(u,["zoom","pitch","distance-from-center"]);if(!g&&!gl(o))return $s([new ci("","zoom expressions not supported")]);const v=yl(u);return v||g?v instanceof ci?$s([v]):v instanceof Go&&!ma(o)?$s([new ci("",'"interpolate" expressions cannot be used with this property')]):As(v?new Xc(f?"camera":"composite",c.value,v.labels,v instanceof Go?v.interpolation:void 0):new _l(f?"constant":"source",c.value)):$s([new ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ql{constructor(o,u){this._parameters=o,this._specification=u,Ss(this,qc(this._parameters,this._specification))}static deserialize(o){return new Ql(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function yl(c){let o=null;if(c instanceof Kd)o=yl(c.result);else if(c instanceof Vc){for(const u of c.args)if(o=yl(u),o)break}else(c instanceof Nu||c instanceof Go)&&c.input instanceof Zl&&c.input.name==="zoom"&&(o=c);return o instanceof ci||c.eachChild(u=>{const f=yl(u);f instanceof ci?o=f:!o&&f?o=new ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class hn{constructor(o,u,f,g){this.message=(o?`${o}: `:"")+f,g&&(this.identifier=g),u!=null&&u.__line__&&(this.line=u.__line__)}}function Co(c){const o=c.key,u=c.value,f=c.valueSpec||{},g=c.objectElementValidators||{},v=c.style,M=c.styleSpec;let A=[];const D=oi(u);if(D!=="object")return[new hn(o,u,`object expected, ${D} found`)];for(const z in u){const W=z.split(".")[0],q=f[W]||f["*"];let X;g[W]?X=g[W]:f[W]?X=Wi:g["*"]?X=g["*"]:f["*"]&&(X=Wi),X?A=A.concat(X({key:(o&&`${o}.`)+z,value:u[z],valueSpec:q,style:v,styleSpec:M,object:u,objectKey:z},u)):A.push(new hn(o,u[z],`unknown property "${z}"`))}for(const z in f)g[z]||f[z].required&&f[z].default===void 0&&u[z]===void 0&&A.push(new hn(o,u,`missing required property "${z}"`));return A}function Wu(c){const o=c.value,u=c.valueSpec,f=c.style,g=c.styleSpec,v=c.key,M=c.arrayElementValidator||Wi;if(oi(o)!=="array")return[new hn(v,o,`array expected, ${oi(o)} found`)];if(u.length&&o.length!==u.length)return[new hn(v,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new hn(v,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let A={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};g.$version<7&&(A.function=u.function),oi(u.value)==="object"&&(A=u.value);let D=[];for(let z=0;z<o.length;z++)D=D.concat(M({array:o,arrayIndex:z,value:o[z],valueSpec:A,style:f,styleSpec:g,key:`${v}[${z}]`}));return D}function Gp(c){const o=c.key,u=c.value,f=c.valueSpec;let g=oi(u);if(g==="number"&&u!=u&&(g="NaN"),g!=="number")return[new hn(o,u,`number expected, ${g} found`)];if("minimum"in f){let v=f.minimum;if(oi(f.minimum)==="array"&&(v=f.minimum[c.arrayIndex]),u<v)return[new hn(o,u,`${u} is less than the minimum value ${v}`)]}if("maximum"in f){let v=f.maximum;if(oi(f.maximum)==="array"&&(v=f.maximum[c.arrayIndex]),u>v)return[new hn(o,u,`${u} is greater than the maximum value ${v}`)]}return[]}function sf(c){const o=c.valueSpec,u=er(c.value.type);let f,g,v,M={};const A=u!=="categorical"&&c.value.property===void 0,D=!A,z=oi(c.value.stops)==="array"&&oi(c.value.stops[0])==="array"&&oi(c.value.stops[0][0])==="object",W=Co({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(K){if(u==="identity")return[new hn(K.key,K.value,'identity function may not have a "stops" property')];let ie=[];const he=K.value;return ie=ie.concat(Wu({key:K.key,value:he,valueSpec:K.valueSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:q})),oi(he)==="array"&&he.length===0&&ie.push(new hn(K.key,he,"array must have at least one stop")),ie},default:function(K){return Wi({key:K.key,value:K.value,valueSpec:o,style:K.style,styleSpec:K.styleSpec})}}});return u==="identity"&&A&&W.push(new hn(c.key,c.value,'missing required property "property"')),u==="identity"||c.value.stops||W.push(new hn(c.key,c.value,'missing required property "stops"')),u==="exponential"&&c.valueSpec.expression&&!ma(c.valueSpec)&&W.push(new hn(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(D&&!ml(c.valueSpec)?W.push(new hn(c.key,c.value,"property functions not supported")):A&&!gl(c.valueSpec)&&W.push(new hn(c.key,c.value,"zoom functions not supported"))),u!=="categorical"&&!z||c.value.property!==void 0||W.push(new hn(c.key,c.value,'"property" property is required')),W;function q(K){let ie=[];const he=K.value,ge=K.key;if(oi(he)!=="array")return[new hn(ge,he,`array expected, ${oi(he)} found`)];if(he.length!==2)return[new hn(ge,he,`array length 2 expected, length ${he.length} found`)];if(z){if(oi(he[0])!=="object")return[new hn(ge,he,`object expected, ${oi(he[0])} found`)];if(he[0].zoom===void 0)return[new hn(ge,he,"object stop key must have zoom")];if(he[0].value===void 0)return[new hn(ge,he,"object stop key must have value")];const Re=er(he[0].zoom);if(typeof Re!="number")return[new hn(ge,he[0].zoom,"stop zoom values must be numbers")];if(v&&v>Re)return[new hn(ge,he[0].zoom,"stop zoom values must appear in ascending order")];Re!==v&&(v=Re,g=void 0,M={}),ie=ie.concat(Co({key:`${ge}[0]`,value:he[0],valueSpec:{zoom:{}},style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:Gp,value:X}}))}else ie=ie.concat(X({key:`${ge}[0]`,value:he[0],valueSpec:{},style:K.style,styleSpec:K.styleSpec},he));return $c(Ni(he[1]))?ie.concat([new hn(`${ge}[1]`,he[1],"expressions are not allowed in function stops.")]):ie.concat(Wi({key:`${ge}[1]`,value:he[1],valueSpec:o,style:K.style,styleSpec:K.styleSpec}))}function X(K,ie){const he=oi(K.value),ge=er(K.value),Re=K.value!==null?K.value:ie;if(f){if(he!==f)return[new hn(K.key,Re,`${he} stop domain type must match previous stop domain type ${f}`)]}else f=he;if(he!=="number"&&he!=="string"&&he!=="boolean"&&typeof ge!="number"&&typeof ge!="string"&&typeof ge!="boolean")return[new hn(K.key,Re,"stop domain value must be a number, string, or boolean")];if(he!=="number"&&u!=="categorical"){let He=`number expected, ${he} found`;return ml(o)&&u===void 0&&(He+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new hn(K.key,Re,He)]}return u!=="categorical"||he!=="number"||typeof ge=="number"&&isFinite(ge)&&Math.floor(ge)===ge?u!=="categorical"&&he==="number"&&typeof ge=="number"&&typeof g=="number"&&g!==void 0&&ge<g?[new hn(K.key,Re,"stop domain values must appear in ascending order")]:(g=ge,u==="categorical"&&ge in M?[new hn(K.key,Re,"stop domain values must be unique")]:(M[ge]=!0,[])):[new hn(K.key,Re,`integer expected, found ${String(ge)}`)]}}function Yc(c){const o=(c.expressionContext==="property"?Gu:jo)(Ni(c.value),c.valueSpec);if(o.result==="error")return o.value.map(f=>new hn(`${c.key}${f.key}`,c.value,f.message));const u=o.value.expression||o.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!u.outputDefined())return[new hn(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!kh(u))return[new hn(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Wp(u,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Xl(u,["zoom","feature-state"]))return[new hn(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!ll(u))return[new hn(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wp(c,o){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const g of o.valueSpec.expression.parameters)u.delete(g);if(u.size===0)return[];const f=[];return c instanceof Zl&&u.has(c.name)?[new hn(o.key,o.value,`["${c.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(c.eachChild(g=>{f.push(...Wp(g,o))}),f)}function of(c){const o=c.key,u=c.value,f=c.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(er(u))===-1&&g.push(new hn(o,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(er(u))===-1&&g.push(new hn(o,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),g}function Jc(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const o of c.slice(1))if(!Jc(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}function Kc(c,o="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Jc(c)||(c=ju(c));const u=c;let f=!0;try{f=function(z){if(!Qc(z))return z;let W=Ni(z);return Hu(W),W=yo(W),W}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}const g=wt[`filter_${o}`],v=jo(f,g);let M=null;if(v.result==="error")throw new Error(v.value.map(z=>`${z.key}: ${z.message}`).join(", "));M=(z,W,q)=>v.value.evaluate(z,W,{},q);let A=null,D=null;if(f!==u){const z=jo(u,g);if(z.result==="error")throw new Error(z.value.map(W=>`${W.key}: ${W.message}`).join(", "));A=(W,q,X,K,ie)=>z.value.evaluate(W,q,{},X,void 0,void 0,K,ie),D=!ll(z.value.expression)}return{filter:M,dynamicFilter:A||void 0,needGeometry:Zh(f),needFeature:!!D}}function yo(c){if(!Array.isArray(c))return c;const o=function(u){if(Ig.has(u[0])){for(let f=1;f<u.length;f++)if(Qc(u[f]))return!0}return u}(c);return o===!0?o:o.map(u=>yo(u))}function Hu(c){let o=!1;const u=[];if(c[0]==="case"){for(let f=1;f<c.length-1;f+=2)o=o||Qc(c[f]),u.push(c[f+1]);u.push(c[c.length-1])}else if(c[0]==="match"){o=o||Qc(c[1]);for(let f=2;f<c.length-1;f+=2)u.push(c[f+1]);u.push(c[c.length-1])}else if(c[0]==="step"){o=o||Qc(c[1]);for(let f=1;f<c.length-1;f+=2)u.push(c[f+1])}o&&(c.length=0,c.push("any",...u));for(let f=1;f<c.length;f++)Hu(c[f])}function Qc(c){if(!Array.isArray(c))return!1;if((o=c[0])==="pitch"||o==="distance-from-center")return!0;var o;for(let u=1;u<c.length;u++)if(Qc(c[u]))return!0;return!1}const Ig=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Pg(c,o){return c<o?-1:c>o?1:0}function Zh(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let o=1;o<c.length;o++)if(Zh(c[o]))return!0;return!1}function ju(c){if(!c)return!0;const o=c[0];return c.length<=1?o!=="any":o==="=="?Hp(c[1],c[2],"=="):o==="!="?qu(Hp(c[1],c[2],"==")):o==="<"||o===">"||o==="<="||o===">="?Hp(c[1],c[2],o):o==="any"?(u=c.slice(1),["any"].concat(u.map(ju))):o==="all"?["all"].concat(c.slice(1).map(ju)):o==="none"?["all"].concat(c.slice(1).map(ju).map(qu)):o==="in"?af(c[1],c.slice(2)):o==="!in"?qu(af(c[1],c.slice(2))):o==="has"?lf(c[1]):o==="!has"?qu(lf(c[1])):o!=="within"||c;var u}function Hp(c,o,u){switch(c){case"$type":return[`filter-type-${u}`,o];case"$id":return[`filter-id-${u}`,o];default:return[`filter-${u}`,c,o]}}function af(c,o){if(o.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(u=>typeof u!=typeof o[0])?["filter-in-large",c,["literal",o.sort(Pg)]]:["filter-in-small",c,["literal",o]]}}function lf(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function qu(c){return["!",c]}function $h(c){return Jc(Ni(c.value))?Yc(Ss({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):jp(c)}function jp(c){const o=c.value,u=c.key;if(oi(o)!=="array")return[new hn(u,o,`array expected, ${oi(o)} found`)];const f=c.styleSpec;let g,v=[];if(o.length<1)return[new hn(u,o,"filter array must have at least 1 element")];switch(v=v.concat(of({key:`${u}[0]`,value:o[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),er(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&er(o[1])==="$type"&&v.push(new hn(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&v.push(new hn(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(g=oi(o[1]),g!=="string"&&v.push(new hn(`${u}[1]`,o[1],`string expected, ${g} found`)));for(let M=2;M<o.length;M++)g=oi(o[M]),er(o[1])==="$type"?v=v.concat(of({key:`${u}[${M}]`,value:o[M],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new hn(`${u}[${M}]`,o[M],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let M=1;M<o.length;M++)v=v.concat(jp({key:`${u}[${M}]`,value:o[M],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":g=oi(o[1]),o.length!==2?v.push(new hn(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new hn(`${u}[1]`,o[1],`string expected, ${g} found`));break;case"within":g=oi(o[1]),o.length!==2?v.push(new hn(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):g!=="object"&&v.push(new hn(`${u}[1]`,o[1],`object expected, ${g} found`))}return v}function cf(c,o){const u=c.key,f=c.style,g=c.styleSpec,v=c.value,M=c.objectKey,A=g[`${o}_${c.layerType}`];if(!A)return[];const D=M.match(/^(.*)-transition$/);if(o==="paint"&&D&&A[D[1]]&&A[D[1]].transition)return Wi({key:u,value:v,valueSpec:g.transition,style:f,styleSpec:g});const z=c.valueSpec||A[M];if(!z)return[new hn(u,v,`unknown property "${M}"`)];let W;if(oi(v)==="string"&&ml(z)&&!z.tokens&&(W=/^{([^}]+)}$/.exec(v)))return[new hn(u,v,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(W[1])} }\`.`)];const q=[];return c.layerType==="symbol"&&(M==="text-field"&&f&&!f.glyphs&&q.push(new hn(u,v,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&ga(Ni(v))&&er(v.type)==="identity"&&q.push(new hn(u,v,'"text-font" does not support identity functions'))),q.concat(Wi({key:c.key,value:v,valueSpec:z,style:f,styleSpec:g,expressionContext:"property",propertyType:o,propertyKey:M}))}function uf(c){return cf(c,"paint")}function qp(c){return cf(c,"layout")}function Xh(c){let o=[];const u=c.value,f=c.key,g=c.style,v=c.styleSpec;u.type||u.ref||o.push(new hn(f,u,'either "type" or "ref" is required'));let M=er(u.type);const A=er(u.ref);if(u.id){const D=er(u.id);for(let z=0;z<c.arrayIndex;z++){const W=g.layers[z];er(W.id)===D&&o.push(new hn(f,u.id,`duplicate layer id "${u.id}", previously used at line ${W.id.__line__}`))}}if("ref"in u){let D;["type","source","source-layer","filter","layout"].forEach(z=>{z in u&&o.push(new hn(f,u[z],`"${z}" is prohibited for ref layers`))}),g.layers.forEach(z=>{er(z.id)===A&&(D=z)}),D?D.ref?o.push(new hn(f,u.ref,"ref cannot reference another ref layer")):M=er(D.type):typeof A=="string"&&o.push(new hn(f,u.ref,`ref layer "${A}" not found`))}else if(M!=="background"&&M!=="sky")if(u.source){const D=g.sources&&g.sources[u.source],z=D&&er(D.type);D?z==="vector"&&M==="raster"?o.push(new hn(f,u.source,`layer "${u.id}" requires a raster source`)):z==="raster"&&M!=="raster"?o.push(new hn(f,u.source,`layer "${u.id}" requires a vector source`)):z!=="vector"||u["source-layer"]?z==="raster-dem"&&M!=="hillshade"?o.push(new hn(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||z==="geojson"&&D.lineMetrics||o.push(new hn(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new hn(f,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new hn(f,u.source,`source "${u.source}" not found`))}else o.push(new hn(f,u,'missing required property "source"'));return o=o.concat(Co({key:f,value:u,valueSpec:v.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wi({key:`${f}.type`,value:u.type,valueSpec:v.layer.type,style:c.style,styleSpec:c.styleSpec,object:u,objectKey:"type"}),filter:D=>$h(Ss({layerType:M},D)),layout:D=>Co({layer:u,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":z=>qp(Ss({layerType:M},z))}}),paint:D=>Co({layer:u,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":z=>uf(Ss({layerType:M},z))}})}})),o}function ps(c){const o=c.value,u=c.key,f=oi(o);return f!=="string"?[new hn(u,o,`string expected, ${f} found`)]:[]}const hf={promoteId:function({key:c,value:o}){if(oi(o)==="string")return ps({key:c,value:o});{const u=[];for(const f in o)u.push(...ps({key:`${c}.${f}`,value:o[f]}));return u}}};function Zu(c){const o=c.value,u=c.key,f=c.styleSpec,g=c.style;if(!o.type)return[new hn(u,o,'"type" is required')];const v=er(o.type);let M;switch(v){case"vector":case"raster":case"raster-dem":return M=Co({key:u,value:o,valueSpec:f[`source_${v.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:hf}),M;case"geojson":if(M=Co({key:u,value:o,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:hf}),o.cluster)for(const A in o.clusterProperties){const[D,z]=o.clusterProperties[A],W=typeof D=="string"?[D,["accumulated"],["get",A]]:D;M.push(...Yc({key:`${u}.${A}.map`,value:z,expressionContext:"cluster-map"})),M.push(...Yc({key:`${u}.${A}.reduce`,value:W,expressionContext:"cluster-reduce"}))}return M;case"video":return Co({key:u,value:o,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return Co({key:u,value:o,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new hn(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return of({key:`${u}.type`,value:o.type,valueSpec:{values:$u(f)},style:g,styleSpec:f})}}function $u(c){return c.source.reduce((o,u)=>{const f=c[u];return f.type.type==="enum"&&(o=o.concat(Object.keys(f.type.values))),o},[])}function Yh(c){const o=c.value,u=c.styleSpec,f=u.light,g=c.style;let v=[];const M=oi(o);if(o===void 0)return v;if(M!=="object")return v=v.concat([new hn("light",o,`object expected, ${M} found`)]),v;for(const A in o){const D=A.match(/^(.*)-transition$/);v=v.concat(D&&f[D[1]]&&f[D[1]].transition?Wi({key:A,value:o[A],valueSpec:u.transition,style:g,styleSpec:u}):f[A]?Wi({key:A,value:o[A],valueSpec:f[A],style:g,styleSpec:u}):[new hn(A,o[A],`unknown property "${A}"`)])}return v}function eu(c){const o=c.value,u=c.key,f=c.style,g=c.styleSpec,v=g.terrain;let M=[];const A=oi(o);if(o===void 0)return M;if(A!=="object")return M=M.concat([new hn("terrain",o,`object expected, ${A} found`)]),M;for(const D in o){const z=D.match(/^(.*)-transition$/);M=M.concat(z&&v[z[1]]&&v[z[1]].transition?Wi({key:D,value:o[D],valueSpec:g.transition,style:f,styleSpec:g}):v[D]?Wi({key:D,value:o[D],valueSpec:v[D],style:f,styleSpec:g}):[new hn(D,o[D],`unknown property "${D}"`)])}if(o.source){const D=f.sources&&f.sources[o.source],z=D&&er(D.type);D?z!=="raster-dem"&&M.push(new hn(u,o.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):M.push(new hn(u,o.source,`source "${o.source}" not found`))}else M.push(new hn(u,o,'terrain is missing required property "source"'));return M}function Zp(c){const o=c.value,u=c.style,f=c.styleSpec,g=f.fog;let v=[];const M=oi(o);if(o===void 0)return v;if(M!=="object")return v=v.concat([new hn("fog",o,`object expected, ${M} found`)]),v;for(const A in o){const D=A.match(/^(.*)-transition$/);v=v.concat(D&&g[D[1]]&&g[D[1]].transition?Wi({key:A,value:o[A],valueSpec:f.transition,style:u,styleSpec:f}):g[A]?Wi({key:A,value:o[A],valueSpec:g[A],style:u,styleSpec:f}):[new hn(A,o[A],`unknown property "${A}"`)])}return v}const Xu={"*":()=>[],array:Wu,boolean:function(c){const o=c.value,u=c.key,f=oi(o);return f!=="boolean"?[new hn(u,o,`boolean expected, ${f} found`)]:[]},number:Gp,color:function(c){const o=c.key,u=c.value,f=oi(u);return f!=="string"?[new hn(o,u,`color expected, ${f} found`)]:jl(u)===null?[new hn(o,u,`color expected, "${u}" found`)]:[]},enum:of,filter:$h,function:sf,layer:Xh,object:Co,source:Zu,light:Yh,terrain:eu,fog:Zp,string:ps,formatted:function(c){return ps(c).length===0?[]:Yc(c)},resolvedImage:function(c){return ps(c).length===0?[]:Yc(c)},projection:function(c){const o=c.value,u=c.styleSpec,f=u.projection,g=c.style;let v=[];const M=oi(o);if(M==="object")for(const A in o)v=v.concat(Wi({key:A,value:o[A],valueSpec:f[A],style:g,styleSpec:u}));else M!=="string"&&(v=v.concat([new hn("projection",o,`object or string expected, ${M} found`)]));return v}};function Wi(c){const o=c.value,u=c.valueSpec,f=c.styleSpec;return u.expression&&ga(er(o))?sf(c):u.expression&&$c(Ni(o))?Yc(c):u.type&&Xu[u.type]?Xu[u.type](c):Co(Ss({},c,{valueSpec:u.type?f[u.type]:u}))}function jy(c){const o=c.value,u=c.key,f=ps(c);return f.length||(o.indexOf("{fontstack}")===-1&&f.push(new hn(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&f.push(new hn(u,o,'"glyphs" url must include a "{range}" token'))),f}function $p(c,o=wt){return Ba(Wi({key:"",value:c,valueSpec:o.$root,styleSpec:o,style:c,objectElementValidators:{glyphs:jy,"*":()=>[]}}))}const Io=c=>Ba(uf(c)),Xs=c=>Ba(qp(c));function Ba(c){return c.slice().sort((o,u)=>o.line&&u.line?o.line-u.line:0)}function Xp(c,o){let u=!1;if(o&&o.length)for(const f of o)c.fire(new Qi(new Error(f.message))),u=!0;return u}var tu=_a;function _a(c,o,u){var f=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var g=new Int32Array(this.arrayBuffer);c=g[0],this.d=(o=g[1])+2*(u=g[2]);for(var v=0;v<this.d*this.d;v++){var M=g[3+v],A=g[3+v+1];f.push(M===A?null:g.subarray(M,A))}var D=g[3+f.length+1];this.keys=g.subarray(g[3+f.length],D),this.bboxes=g.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)f.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=c,this.padding=u,this.scale=o/c,this.uid=0;var W=u/o*c;this.min=-W,this.max=c+W}_a.prototype.insert=function(c,o,u,f,g){this._forEachCell(o,u,f,g,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g)},_a.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},_a.prototype._insertCell=function(c,o,u,f,g,v){this.cells[g].push(v)},_a.prototype.query=function(c,o,u,f,g){var v=this.min,M=this.max;if(c<=v&&o<=v&&M<=u&&M<=f&&!g)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(c,o,u,f,this._queryCell,A,{},g),A},_a.prototype._queryCell=function(c,o,u,f,g,v,M,A){var D=this.cells[g];if(D!==null)for(var z=this.keys,W=this.bboxes,q=0;q<D.length;q++){var X=D[q];if(M[X]===void 0){var K=4*X;(A?A(W[K+0],W[K+1],W[K+2],W[K+3]):c<=W[K+2]&&o<=W[K+3]&&u>=W[K+0]&&f>=W[K+1])?(M[X]=!0,v.push(z[X])):M[X]=!1}}},_a.prototype._forEachCell=function(c,o,u,f,g,v,M,A){for(var D=this._convertToCellCoord(c),z=this._convertToCellCoord(o),W=this._convertToCellCoord(u),q=this._convertToCellCoord(f),X=D;X<=W;X++)for(var K=z;K<=q;K++){var ie=this.d*K+X;if((!A||A(this._convertFromCellCoord(X),this._convertFromCellCoord(K),this._convertFromCellCoord(X+1),this._convertFromCellCoord(K+1)))&&g.call(this,c,o,u,f,ie,v,M,A))return}},_a.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},_a.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},_a.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,o=3+this.cells.length+1+1,u=0,f=0;f<this.cells.length;f++)u+=this.cells[f].length;var g=new Int32Array(o+u+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var v=o,M=0;M<c.length;M++){var A=c[M];g[3+M]=v,g.set(A,v),v+=A.length}return g[3+c.length]=v,g.set(this.keys,v),g[3+c.length+1]=v+=this.keys.length,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer};const Jh={};function dn(c,o,u={}){Object.defineProperty(c,"_classRegistryKey",{value:o,writeable:!1}),Jh[o]={klass:c,omit:u.omit||[]}}dn(Object,"Object"),tu.serialize=function(c,o){const u=c.toArrayBuffer();return o&&o.push(u),{buffer:u}},tu.deserialize=function(c){return new tu(c.buffer)},Object.defineProperty(tu,"name",{value:"Grid"}),dn(tu,"Grid"),dn(vr,"Color"),dn(Error,"Error"),dn(Un,"AJAXError"),dn(To,"ResolvedImage"),dn(Ql,"StylePropertyFunction"),dn(qh,"StyleExpression",{omit:["_evaluator"]}),dn(Xc,"ZoomDependentExpression"),dn(_l,"ZoomConstantExpression"),dn(Zl,"CompoundExpression",{omit:["_evaluate"]});for(const c in jh)Jh[jh[c]._classRegistryKey]||dn(jh[c],`Expression${c}`);function Yp(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function df(c){return d.ImageBitmap&&c instanceof d.ImageBitmap}function xl(c,o){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Yp(c)||df(c))return o&&o.push(c),c;if(ArrayBuffer.isView(c)){const u=c;return o&&o.push(u.buffer),u}if(c instanceof d.ImageData)return o&&o.push(c.data.buffer),c;if(Array.isArray(c)){const u=[];for(const f of c)u.push(xl(f,o));return u}if(typeof c=="object"){const u=c.constructor,f=u._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${f}`);const g=u.serialize?u.serialize(c,o):{};if(!u.serialize){for(const v in c)c.hasOwnProperty(v)&&(Jh[f].omit.indexOf(v)>=0||(g[v]=xl(c[v],o)));c instanceof Error&&(g.message=c.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof c)}function Yu(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Yp(c)||df(c)||ArrayBuffer.isView(c)||c instanceof d.ImageData)return c;if(Array.isArray(c))return c.map(Yu);if(typeof c=="object"){const o=c.$name||"Object",{klass:u}=Jh[o];if(!u)throw new Error(`can't deserialize unregistered class ${o}`);if(u.deserialize)return u.deserialize(c);const f=Object.create(u.prototype);for(const g of Object.keys(c))g!=="$name"&&(f[g]=Yu(c[g]));return f}throw new Error("can't deserialize object of type "+typeof c)}const Ju=c=>c>=1536&&c<=1791,Kh=c=>c>=1872&&c<=1919,ff=c=>c>=2208&&c<=2303,Qh=c=>c>=11904&&c<=12031,pf=c=>c>=12032&&c<=12255,mf=c=>c>=12272&&c<=12287,vl=c=>c>=12288&&c<=12351,Ku=c=>c>=12352&&c<=12447,Qu=c=>c>=12448&&c<=12543,Jp=c=>c>=12544&&c<=12591,ya=c=>c>=12704&&c<=12735,kg=c=>c>=12736&&c<=12783,Dg=c=>c>=12784&&c<=12799,ed=c=>c>=12800&&c<=13055,ec=c=>c>=13056&&c<=13311,Lg=c=>c>=13312&&c<=19903,xn=c=>c>=19968&&c<=40959,td=c=>c>=40960&&c<=42127,gf=c=>c>=42128&&c<=42191,_f=c=>c>=44032&&c<=55215,nd=c=>c>=63744&&c<=64255,y=c=>c>=64336&&c<=65023,h=c=>c>=65040&&c<=65055,p=c=>c>=65072&&c<=65103,w=c=>c>=65104&&c<=65135,E=c=>c>=65136&&c<=65279,I=c=>c>=65280&&c<=65519;function B(c){for(const o of c)if(J(o.charCodeAt(0)))return!0;return!1}function U(c){for(const o of c)if(!H(o.charCodeAt(0)))return!1;return!0}function H(c){return!(Ju(c)||Kh(c)||ff(c)||y(c)||E(c))}function J(c){return!(c!==746&&c!==747&&(c<4352||!(ya(c)||Jp(c)||p(c)&&!(c>=65097&&c<=65103)||nd(c)||ec(c)||Qh(c)||kg(c)||!(!vl(c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Lg(c)||xn(c)||ed(c)||(o=>o>=12592&&o<=12687)(c)||(o=>o>=43360&&o<=43391)(c)||(o=>o>=55216&&o<=55295)(c)||(o=>o>=4352&&o<=4607)(c)||_f(c)||Ku(c)||mf(c)||(o=>o>=12688&&o<=12703)(c)||pf(c)||Dg(c)||Qu(c)&&c!==12540||!(!I(c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!w(c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||(o=>o>=5120&&o<=5759)(c)||(o=>o>=6320&&o<=6399)(c)||h(c)||(o=>o>=19904&&o<=19967)(c)||td(c)||gf(c))))}function Y(c){return!(J(c)||function(o){return!!((u=>u>=128&&u<=255)(o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||(u=>u>=8192&&u<=8303)(o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||(u=>u>=8448&&u<=8527)(o)||(u=>u>=8528&&u<=8591)(o)||(u=>u>=8960&&u<=9215)(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||(u=>u>=9216&&u<=9279)(o)&&o!==9251||(u=>u>=9280&&u<=9311)(o)||(u=>u>=9312&&u<=9471)(o)||(u=>u>=9632&&u<=9727)(o)||(u=>u>=9728&&u<=9983)(o)&&!(o>=9754&&o<=9759)||(u=>u>=11008&&u<=11263)(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||vl(o)||Qu(o)||(u=>u>=57344&&u<=63743)(o)||p(o)||w(o)||I(o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(c))}function oe(c){return c>=1424&&c<=2303||y(c)||E(c)}function me(c,o){return!(!o&&oe(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||(u=>u>=6016&&u<=6143)(c))}function be(c){for(const o of c)if(oe(o.charCodeAt(0)))return!0;return!1}const we="deferred",Me="loading",_e="loaded";let xe=null,ke="unavailable",Ce=null;const Ue=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(ke="error"),xe&&xe(c)};function Ze(){qe.fire(new hs("pluginStateChange",{pluginStatus:ke,pluginURL:Ce}))}const qe=new Fr,tt=function(){return ke},ft=function(){if(ke!==we||!Ce)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ke=Me,Ze(),Ce&&Zt({url:Ce},c=>{c?Ue(c):(ke=_e,Ze())})},lt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ke===_e||lt.applyArabicShaping!=null,isLoading:()=>ke===Me,setState(c){ke=c.pluginStatus,Ce=c.pluginURL},isParsed:()=>lt.applyArabicShaping!=null&&lt.processBidirectionalText!=null&&lt.processStyledBidirectionalText!=null,getPluginURL:()=>Ce};class it{constructor(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.transition=u.transition,this.pitch=u.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(u,f){for(const g of u)if(!me(g.charCodeAt(0),f))return!1;return!0}(o,lt.isLoaded())}}class Gt{constructor(o,u){this.property=o,this.value=u,this.expression=function(f,g){if(ga(f))return new Ql(f,g);if($c(f)){const v=Gu(f,g);if(v.result==="error")throw new Error(v.value.map(M=>`${M.key}: ${M.message}`).join(", "));return v.value}{let v=f;return typeof f=="string"&&g.type==="color"&&(v=vr.parse(f)),{kind:"constant",evaluate:()=>v}}}(u===void 0?o.specification.default:u,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,u,f){return this.property.possiblyEvaluate(this,o,u,f)}}class ot{constructor(o){this.property=o,this.value=new Gt(o,void 0)}transitioned(o,u){return new mt(this.property,this.value,u,Pe({},o.transition,this.transition),o.now)}untransitioned(){return new mt(this.property,this.value,null,{},0)}}class bt{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return _n(this._values[o].value.value)}setValue(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new ot(this._values[o].property)),this._values[o].value=new Gt(this._values[o].property,u===null?void 0:_n(u))}getTransition(o){return _n(this._values[o].transition)}setTransition(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new ot(this._values[o].property)),this._values[o].transition=_n(u)||void 0}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(o[u]=f);const g=this.getTransition(u);g!==void 0&&(o[`${u}-transition`]=g)}return o}transitioned(o,u){const f=new Ut(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(o,u._values[g]);return f}untransitioned(){const o=new Ut(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].untransitioned();return o}}class mt{constructor(o,u,f,g,v){const M=g.delay||0,A=g.duration||0;v=v||0,this.property=o,this.value=u,this.begin=v+M,this.end=this.begin+A,o.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(o,u,f){const g=o.now||0,v=this.value.possiblyEvaluate(o,u,f),M=this.prior;if(M){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return M.possiblyEvaluate(o,u,f);{const A=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(M.possiblyEvaluate(o,u,f),v,$e(A))}}return v}}class Ut{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,u,f){const g=new Dt(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(o,u,f);return g}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class gt{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return _n(this._values[o].value)}setValue(o,u){this._values[o]=new Gt(this._values[o].property,u===null?void 0:_n(u))}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(o[u]=f)}return o}possiblyEvaluate(o,u,f){const g=new Dt(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(o,u,f);return g}}class kt{constructor(o,u,f){this.property=o,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,u,f,g){return this.property.evaluate(this.value,this.parameters,o,u,f,g)}}class Dt{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Ye{constructor(o){this.specification=o}possiblyEvaluate(o,u){return o.expression.evaluate(u)}interpolate(o,u,f){const g=cl[this.specification.type];return g?g(o,u,f):o}}class at{constructor(o,u){this.specification=o,this.overrides=u}possiblyEvaluate(o,u,f,g){return new kt(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},f,g)}:o.expression,u)}interpolate(o,u,f){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new kt(this,{kind:"constant",value:void 0},o.parameters);const g=cl[this.specification.type];return g?new kt(this,{kind:"constant",value:g(o.value.value,u.value.value,f)},o.parameters):o}evaluate(o,u,f,g,v,M){return o.kind==="constant"?o.value:o.evaluate(u,f,g,v,M)}}class Qt{constructor(o){this.specification=o}possiblyEvaluate(o,u,f,g){return!!o.expression.evaluate(u,null,{},f,g)}interpolate(){return!1}}class mn{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const u=new it(0,{});for(const f in o){const g=o[f];g.specification.overridable&&this.overridableProperties.push(f);const v=this.defaultPropertyValues[f]=new Gt(g,void 0),M=this.defaultTransitionablePropertyValues[f]=new ot(g);this.defaultTransitioningPropertyValues[f]=M.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=v.possiblyEvaluate(u)}}}function cn(c,o){return 256*(c=fe(Math.floor(c),0,255))+fe(Math.floor(o),0,255)}dn(at,"DataDrivenProperty"),dn(Ye,"DataConstantProperty"),dn(Qt,"ColorRampProperty");const Fn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rn{constructor(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Cn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function an(c,o=1){let u=0,f=0;return{members:c.map(g=>{const v=Fn[g.type].BYTES_PER_ELEMENT,M=u=ki(u,Math.max(o,v)),A=g.components||1;return f=Math.max(f,v),u+=v*A,{name:g.name,type:g.type,components:A,offset:M}}),size:ki(u,Math.max(f,o)),alignment:o}}function ki(c,o){return Math.ceil(c/o)*o}class bi extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const g=2*o;return this.int16[g+0]=u,this.int16[g+1]=f,o}}bi.prototype.bytesPerElement=4,dn(bi,"StructArrayLayout2i4");class Di extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,u,f)}emplace(o,u,f,g){const v=3*o;return this.int16[v+0]=u,this.int16[v+1]=f,this.int16[v+2]=g,o}}Di.prototype.bytesPerElement=6,dn(Di,"StructArrayLayout3i6");class si extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,f,g)}emplace(o,u,f,g,v){const M=4*o;return this.int16[M+0]=u,this.int16[M+1]=f,this.int16[M+2]=g,this.int16[M+3]=v,o}}si.prototype.bytesPerElement=8,dn(si,"StructArrayLayout4i8");class Ns extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v,M,A){const D=this.length;return this.resize(D+1),this.emplace(D,o,u,f,g,v,M,A)}emplace(o,u,f,g,v,M,A,D){const z=6*o,W=12*o,q=3*o;return this.int16[z+0]=u,this.int16[z+1]=f,this.uint8[W+4]=g,this.uint8[W+5]=v,this.uint8[W+6]=M,this.uint8[W+7]=A,this.float32[q+2]=D,o}}Ns.prototype.bytesPerElement=12,dn(Ns,"StructArrayLayout2i4ub1f12");class Ys extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,f,g)}emplace(o,u,f,g,v){const M=4*o;return this.float32[M+0]=u,this.float32[M+1]=f,this.float32[M+2]=g,this.float32[M+3]=v,o}}Ys.prototype.bytesPerElement=16,dn(Ys,"StructArrayLayout4f16");class jr extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v){const M=this.length;return this.resize(M+1),this.emplace(M,o,u,f,g,v)}emplace(o,u,f,g,v,M){const A=6*o,D=3*o;return this.uint16[A+0]=u,this.uint16[A+1]=f,this.uint16[A+2]=g,this.uint16[A+3]=v,this.float32[D+2]=M,o}}jr.prototype.bytesPerElement=12,dn(jr,"StructArrayLayout4ui1f12");class Po extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,f,g)}emplace(o,u,f,g,v){const M=4*o;return this.uint16[M+0]=u,this.uint16[M+1]=f,this.uint16[M+2]=g,this.uint16[M+3]=v,o}}Po.prototype.bytesPerElement=8,dn(Po,"StructArrayLayout4ui8");class Zi extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v,M){const A=this.length;return this.resize(A+1),this.emplace(A,o,u,f,g,v,M)}emplace(o,u,f,g,v,M,A){const D=6*o;return this.int16[D+0]=u,this.int16[D+1]=f,this.int16[D+2]=g,this.int16[D+3]=v,this.int16[D+4]=M,this.int16[D+5]=A,o}}Zi.prototype.bytesPerElement=12,dn(Zi,"StructArrayLayout6i12");class Si extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v,M,A,D,z,W,q,X){const K=this.length;return this.resize(K+1),this.emplace(K,o,u,f,g,v,M,A,D,z,W,q,X)}emplace(o,u,f,g,v,M,A,D,z,W,q,X,K){const ie=12*o;return this.int16[ie+0]=u,this.int16[ie+1]=f,this.int16[ie+2]=g,this.int16[ie+3]=v,this.uint16[ie+4]=M,this.uint16[ie+5]=A,this.uint16[ie+6]=D,this.uint16[ie+7]=z,this.int16[ie+8]=W,this.int16[ie+9]=q,this.int16[ie+10]=X,this.int16[ie+11]=K,o}}Si.prototype.bytesPerElement=24,dn(Si,"StructArrayLayout4i4ui4i24");class yi extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v,M){const A=this.length;return this.resize(A+1),this.emplace(A,o,u,f,g,v,M)}emplace(o,u,f,g,v,M,A){const D=10*o,z=5*o;return this.int16[D+0]=u,this.int16[D+1]=f,this.int16[D+2]=g,this.float32[z+2]=v,this.float32[z+3]=M,this.float32[z+4]=A,o}}yi.prototype.bytesPerElement=20,dn(yi,"StructArrayLayout3i3f20");class tr extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint32[1*o+0]=u,o}}tr.prototype.bytesPerElement=4,dn(tr,"StructArrayLayout1ul4");class ts extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v,M,A,D,z,W,q,X,K){const ie=this.length;return this.resize(ie+1),this.emplace(ie,o,u,f,g,v,M,A,D,z,W,q,X,K)}emplace(o,u,f,g,v,M,A,D,z,W,q,X,K,ie){const he=20*o,ge=10*o;return this.int16[he+0]=u,this.int16[he+1]=f,this.int16[he+2]=g,this.int16[he+3]=v,this.int16[he+4]=M,this.float32[ge+3]=A,this.float32[ge+4]=D,this.float32[ge+5]=z,this.float32[ge+6]=W,this.int16[he+14]=q,this.uint32[ge+8]=X,this.uint16[he+18]=K,this.uint16[he+19]=ie,o}}ts.prototype.bytesPerElement=40,dn(ts,"StructArrayLayout5i4f1i1ul2ui40");class Oi extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v,M,A){const D=this.length;return this.resize(D+1),this.emplace(D,o,u,f,g,v,M,A)}emplace(o,u,f,g,v,M,A,D){const z=8*o;return this.int16[z+0]=u,this.int16[z+1]=f,this.int16[z+2]=g,this.int16[z+4]=v,this.int16[z+5]=M,this.int16[z+6]=A,this.int16[z+7]=D,o}}Oi.prototype.bytesPerElement=16,dn(Oi,"StructArrayLayout3i2i2i16");class Cs extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v){const M=this.length;return this.resize(M+1),this.emplace(M,o,u,f,g,v)}emplace(o,u,f,g,v,M){const A=4*o,D=8*o;return this.float32[A+0]=u,this.float32[A+1]=f,this.float32[A+2]=g,this.int16[D+6]=v,this.int16[D+7]=M,o}}Cs.prototype.bytesPerElement=16,dn(Cs,"StructArrayLayout2f1f2i16");class tc extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,f,g)}emplace(o,u,f,g,v){const M=12*o,A=3*o;return this.uint8[M+0]=u,this.uint8[M+1]=f,this.float32[A+1]=g,this.float32[A+2]=v,o}}tc.prototype.bytesPerElement=12,dn(tc,"StructArrayLayout2ub2f12");class qo extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,u,f)}emplace(o,u,f,g){const v=3*o;return this.float32[v+0]=u,this.float32[v+1]=f,this.float32[v+2]=g,o}}qo.prototype.bytesPerElement=12,dn(qo,"StructArrayLayout3f12");class $i extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,u,f)}emplace(o,u,f,g){const v=3*o;return this.uint16[v+0]=u,this.uint16[v+1]=f,this.uint16[v+2]=g,o}}$i.prototype.bytesPerElement=6,dn($i,"StructArrayLayout3ui6");class ns extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v,M,A,D,z,W,q,X,K,ie,he,ge,Re,He,Le,Ge,Xe){const je=this.length;return this.resize(je+1),this.emplace(je,o,u,f,g,v,M,A,D,z,W,q,X,K,ie,he,ge,Re,He,Le,Ge,Xe)}emplace(o,u,f,g,v,M,A,D,z,W,q,X,K,ie,he,ge,Re,He,Le,Ge,Xe,je){const dt=30*o,ut=15*o,Tt=60*o;return this.int16[dt+0]=u,this.int16[dt+1]=f,this.int16[dt+2]=g,this.float32[ut+2]=v,this.float32[ut+3]=M,this.uint16[dt+8]=A,this.uint16[dt+9]=D,this.uint32[ut+5]=z,this.uint32[ut+6]=W,this.uint32[ut+7]=q,this.uint16[dt+16]=X,this.uint16[dt+17]=K,this.uint16[dt+18]=ie,this.float32[ut+10]=he,this.float32[ut+11]=ge,this.uint8[Tt+48]=Re,this.uint8[Tt+49]=He,this.uint8[Tt+50]=Le,this.uint32[ut+13]=Ge,this.int16[dt+28]=Xe,this.uint8[Tt+58]=je,o}}ns.prototype.bytesPerElement=60,dn(ns,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ur extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v,M,A,D,z,W,q,X,K,ie,he,ge,Re,He,Le,Ge,Xe,je,dt,ut,Tt,Wt,yt,Pt,Rt,Bt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,o,u,f,g,v,M,A,D,z,W,q,X,K,ie,he,ge,Re,He,Le,Ge,Xe,je,dt,ut,Tt,Wt,yt,Pt,Rt,Bt)}emplace(o,u,f,g,v,M,A,D,z,W,q,X,K,ie,he,ge,Re,He,Le,Ge,Xe,je,dt,ut,Tt,Wt,yt,Pt,Rt,Bt,jt){const xt=38*o,en=19*o;return this.int16[xt+0]=u,this.int16[xt+1]=f,this.int16[xt+2]=g,this.float32[en+2]=v,this.float32[en+3]=M,this.int16[xt+8]=A,this.int16[xt+9]=D,this.int16[xt+10]=z,this.int16[xt+11]=W,this.int16[xt+12]=q,this.int16[xt+13]=X,this.uint16[xt+14]=K,this.uint16[xt+15]=ie,this.uint16[xt+16]=he,this.uint16[xt+17]=ge,this.uint16[xt+18]=Re,this.uint16[xt+19]=He,this.uint16[xt+20]=Le,this.uint16[xt+21]=Ge,this.uint16[xt+22]=Xe,this.uint16[xt+23]=je,this.uint16[xt+24]=dt,this.uint16[xt+25]=ut,this.uint16[xt+26]=Tt,this.uint16[xt+27]=Wt,this.uint16[xt+28]=yt,this.uint32[en+15]=Pt,this.float32[en+16]=Rt,this.float32[en+17]=Bt,this.float32[en+18]=jt,o}}Ur.prototype.bytesPerElement=76,dn(Ur,"StructArrayLayout3i2f6i15ui1ul3f76");class ko extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.float32[1*o+0]=u,o}}ko.prototype.bytesPerElement=4,dn(ko,"StructArrayLayout1f4");class ms extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,g,v){const M=this.length;return this.resize(M+1),this.emplace(M,o,u,f,g,v)}emplace(o,u,f,g,v,M){const A=5*o;return this.float32[A+0]=u,this.float32[A+1]=f,this.float32[A+2]=g,this.float32[A+3]=v,this.float32[A+4]=M,o}}ms.prototype.bytesPerElement=20,dn(ms,"StructArrayLayout5f20");class nu extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,f,g)}emplace(o,u,f,g,v){const M=6*o;return this.uint32[3*o+0]=u,this.uint16[M+2]=f,this.uint16[M+3]=g,this.uint16[M+4]=v,o}}nu.prototype.bytesPerElement=12,dn(nu,"StructArrayLayout1ul3ui12");class Zo extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const g=2*o;return this.uint16[g+0]=u,this.uint16[g+1]=f,o}}Zo.prototype.bytesPerElement=4,dn(Zo,"StructArrayLayout2ui4");class id extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint16[1*o+0]=u,o}}id.prototype.bytesPerElement=2,dn(id,"StructArrayLayout1ui2");class Rg extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const g=2*o;return this.float32[g+0]=u,this.float32[g+1]=f,o}}Rg.prototype.bytesPerElement=8,dn(Rg,"StructArrayLayout2f8");class iu extends Rn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}iu.prototype.size=40;class zg extends ts{get(o){return new iu(this,o)}}dn(zg,"CollisionBoxArray");class qy extends Rn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}qy.prototype.size=60;class Og extends ns{get(o){return new qy(this,o)}}dn(Og,"PlacedSymbolArray");class eh extends Rn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}eh.prototype.size=76;class Zy extends Ur{get(o){return new eh(this,o)}}dn(Zy,"SymbolInstanceArray");class $y extends ko{getoffsetX(o){return this.float32[1*o+0]}}dn($y,"GlyphOffsetArray");class Fg extends bi{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}dn(Fg,"SymbolLineVertexArray");class Kp extends Rn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Kp.prototype.size=12;class E1 extends nu{get(o){return new Kp(this,o)}}dn(E1,"FeatureIndexArray");class A1 extends Zo{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}dn(A1,"FillExtrusionCentroidArray");const C1=an([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),I1=an([{name:"a_dash",components:4,type:"Uint16"}]);var Na={exports:{}},P1={exports:{}};P1.exports=function(c,o){var u,f,g,v,M,A,D,z;for(f=c.length-(u=3&c.length),g=o,M=3432918353,A=461845907,z=0;z<f;)D=255&c.charCodeAt(z)|(255&c.charCodeAt(++z))<<8|(255&c.charCodeAt(++z))<<16|(255&c.charCodeAt(++z))<<24,++z,g=27492+(65535&(v=5*(65535&(g=(g^=D=(65535&(D=(D=(65535&D)*M+(((D>>>16)*M&65535)<<16)&4294967295)<<15|D>>>17))*A+(((D>>>16)*A&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(D=0,u){case 3:D^=(255&c.charCodeAt(z+2))<<16;case 2:D^=(255&c.charCodeAt(z+1))<<8;case 1:g^=D=(65535&(D=(D=(65535&(D^=255&c.charCodeAt(z)))*M+(((D>>>16)*M&65535)<<16)&4294967295)<<15|D>>>17))*A+(((D>>>16)*A&65535)<<16)&4294967295}return g^=c.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var th={exports:{}};th.exports=function(c,o){for(var u,f=c.length,g=o^f,v=0;f>=4;)u=1540483477*(65535&(u=255&c.charCodeAt(v)|(255&c.charCodeAt(++v))<<8|(255&c.charCodeAt(++v))<<16|(255&c.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:g^=(255&c.charCodeAt(v+2))<<16;case 2:g^=(255&c.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&c.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Xy=P1.exports,$o=th.exports;Na.exports=Xy,Na.exports.murmur3=Xy,Na.exports.murmur2=$o;class Bg{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,u,f,g){this.ids.push(Yy(o)),this.positions.push(u,f,g)}getPositions(o){const u=Yy(o);let f=0,g=this.ids.length-1;for(;f<g;){const M=f+g>>1;this.ids[M]>=u?g=M:f=M+1}const v=[];for(;this.ids[f]===u;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(o,u){const f=new Float64Array(o.ids),g=new Uint32Array(o.positions);return Jy(f,g,0,f.length-1),u&&u.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(o){const u=new Bg;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u}}function Yy(c){const o=+c;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Na.exports(String(c))}function Jy(c,o,u,f){for(;u<f;){const g=c[u+f>>1];let v=u-1,M=f+1;for(;;){do v++;while(c[v]<g);do M--;while(c[M]>g);if(v>=M)break;Ng(c,v,M),Ng(o,3*v,3*M),Ng(o,3*v+1,3*M+1),Ng(o,3*v+2,3*M+2)}M-u<f-M?(Jy(c,o,u,M),u=M+1):(Jy(c,o,M+1,f),f=M)}}function Ng(c,o,u){const f=c[o];c[o]=c[u],c[u]=f}dn(Bg,"FeaturePositionMap");class nc{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,u){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,u),this.initialized=!0),!!this.location}}class Qp extends nc{constructor(o){super(o),this.current=0}set(o,u,f){this.fetchUniformLocation(o,u)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class k1 extends nc{constructor(o){super(o),this.current=[0,0,0,0]}set(o,u,f){this.fetchUniformLocation(o,u)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class xa extends nc{constructor(o){super(o),this.current=vr.transparent}set(o,u,f){this.fetchUniformLocation(o,u)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const Ky=new Float32Array(16),nT=new Float32Array(9),nh=new Float32Array(4);function yf(c){return[cn(255*c.r,255*c.g),cn(255*c.b,255*c.a)]}class wl{constructor(o,u,f){this.value=o,this.uniformNames=u.map(g=>`u_${g}`),this.type=f}setUniform(o,u,f,g,v){u.set(o,v,g.constantOr(this.value))}getBinding(o,u){return this.type==="color"?new xa(o):new Qp(o)}}class ru{constructor(o,u){this.uniformNames=u.map(f=>`u_${f}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,u,f,g,v){const M=v==="u_pattern"||v==="u_dash"?this.pattern:v==="u_pixel_ratio"?this.pixelRatio:null;M&&u.set(o,v,M)}getBinding(o,u){return u==="u_pattern"||u==="u_dash"?new k1(o):new Qp(o)}}class bl{constructor(o,u,f,g){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(o,u,f,g,v,M){const A=this.paintVertexArray.length,D=this.expression.evaluate(new it(0),u,{},v,g,M);this.paintVertexArray.resize(o),this._setPaintValue(A,o,D)}updatePaintArray(o,u,f,g,v){const M=this.expression.evaluate({zoom:0},f,g,void 0,v);this._setPaintValue(o,u,M)}_setPaintValue(o,u,f){if(this.type==="color"){const g=yf(f);for(let v=o;v<u;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=o;g<u;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class va{constructor(o,u,f,g,v,M){this.expression=o,this.uniformNames=u.map(A=>`u_${A}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=u.map(A=>({name:`a_${A}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new M}populatePaintArray(o,u,f,g,v,M){const A=this.expression.evaluate(new it(this.zoom),u,{},v,g,M),D=this.expression.evaluate(new it(this.zoom+1),u,{},v,g,M),z=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(z,o,A,D)}updatePaintArray(o,u,f,g,v){const M=this.expression.evaluate({zoom:this.zoom},f,g,void 0,v),A=this.expression.evaluate({zoom:this.zoom+1},f,g,void 0,v);this._setPaintValue(o,u,M,A)}_setPaintValue(o,u,f,g){if(this.type==="color"){const v=yf(f),M=yf(g);for(let A=o;A<u;A++)this.paintVertexArray.emplace(A,v[0],v[1],M[0],M[1])}else{for(let v=o;v<u;v++)this.paintVertexArray.emplace(v,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,u,f,g,v){const M=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,A=fe(this.expression.interpolationFactor(M,this.zoom,this.zoom+1),0,1);u.set(o,v,A)}getBinding(o,u){return new Qp(o)}}class ih{constructor(o,u,f,g,v){this.expression=o,this.layerId=v,this.paintVertexAttributes=(f==="array"?I1:C1).members;for(let M=0;M<u.length;++M);this.paintVertexArray=new g}populatePaintArray(o,u,f){const g=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(g,o,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(o,u,f,g,v,M){this._setPaintValues(o,u,f.patterns&&f.patterns[this.layerId],M)}_setPaintValues(o,u,f,g){if(!g||!f)return;const v=g[f];if(!v)return;const{tl:M,br:A,pixelRatio:D}=v;for(let z=o;z<u;z++)this.paintVertexArray.emplace(z,M[0],M[1],A[0],A[1],D)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class su{constructor(o,u,f=()=>!0){this.binders={},this._buffers=[];const g=[];for(const v in o.paint._values){if(!f(v))continue;const M=o.paint.get(v);if(!(M instanceof kt&&ml(M.property.specification)))continue;const A=L1(v,o.type),D=M.value,z=M.property.specification.type,W=M.property.useIntegerZoom,q=v==="line-dasharray"||v.endsWith("pattern"),X=v==="line-dasharray"&&o.layout.get("line-cap").value.kind!=="constant";if(D.kind!=="constant"||X)if(D.kind==="source"||X||q){const K=R1(v,z,"source");this.binders[v]=q?new ih(D,A,z,K,o.id):new bl(D,A,z,K),g.push(`/a_${v}`)}else{const K=R1(v,z,"composite");this.binders[v]=new va(D,A,z,W,u,K),g.push(`/z_${v}`)}else this.binders[v]=q?new ru(D.value,A):new wl(D.value,A,z),g.push(`/u_${v}`)}this.cacheKey=g.sort().join("")}getMaxValue(o){const u=this.binders[o];return u instanceof bl||u instanceof va?u.maxValue:0}populatePaintArrays(o,u,f,g,v,M){for(const A in this.binders){const D=this.binders[A];(D instanceof bl||D instanceof va||D instanceof ih)&&D.populatePaintArray(o,u,f,g,v,M)}}setConstantPatternPositions(o){for(const u in this.binders){const f=this.binders[u];f instanceof ru&&f.setConstantPatternPositions(o)}}updatePaintArrays(o,u,f,g,v,M){let A=!1;for(const D in o){const z=u.getPositions(D);for(const W of z){const q=f.feature(W.index);for(const X in this.binders){const K=this.binders[X];if((K instanceof bl||K instanceof va||K instanceof ih)&&K.expression.isStateDependent===!0){const ie=g.paint.get(X);K.expression=ie.value,K.updatePaintArray(W.start,W.end,q,o[D],v,M),A=!0}}}}return A}defines(){const o=[];for(const u in this.binders){const f=this.binders[u];(f instanceof wl||f instanceof ru)&&o.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return o}getBinderAttributes(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof bl||f instanceof va||f instanceof ih)for(let g=0;g<f.paintVertexAttributes.length;g++)o.push(f.paintVertexAttributes[g].name)}return o}getBinderUniforms(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof wl||f instanceof ru||f instanceof va)for(const g of f.uniformNames)o.push(g)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const u=[];for(const f in this.binders){const g=this.binders[f];if(g instanceof wl||g instanceof ru||g instanceof va)for(const v of g.uniformNames)u.push({name:v,property:f,binding:g.getBinding(o,v)})}return u}setUniforms(o,u,f,g,v){for(const{name:M,property:A,binding:D}of f)this.binders[A].setUniform(o,D,v,g.get(A),M)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const u=this.binders[o];(u instanceof bl||u instanceof va||u instanceof ih)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(o){for(const u in this.binders){const f=this.binders[u];(f instanceof bl||f instanceof va||f instanceof ih)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const u=this.binders[o];(u instanceof bl||u instanceof va||u instanceof ih)&&u.destroy()}}}class rh{constructor(o,u,f=()=>!0){this.programConfigurations={};for(const g of o)this.programConfigurations[g.id]=new su(g,u,f);this.needsUpload=!1,this._featureMap=new Bg,this._bufferOffset=0}populatePaintArrays(o,u,f,g,v,M,A){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(o,u,g,v,M,A);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,u,f,g,v){for(const M of f)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(o,this._featureMap,u,M,g,v)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const D1={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function L1(c,o){return D1[c]||[c.replace(`${o}-`,"").replace(/-/g,"_")]}const Qy={"line-pattern":{source:jr,composite:jr},"fill-pattern":{source:jr,composite:jr},"fill-extrusion-pattern":{source:jr,composite:jr},"line-dasharray":{source:Po,composite:Po}},iT={color:{source:Rg,composite:Ys},number:{source:ko,composite:Rg}};function R1(c,o,u){const f=Qy[c];return f&&f[u]||iT[o][u]}dn(wl,"ConstantBinder"),dn(ru,"PatternConstantBinder"),dn(bl,"SourceExpressionBinder"),dn(ih,"PatternCompositeBinder"),dn(va,"CompositeExpressionBinder"),dn(su,"ProgramConfiguration",{omit:["_buffers"]}),dn(rh,"ProgramConfigurationSet");const x="-transition";class b extends Fr{constructor(o,u){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&o.type!=="sky"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),u.layout&&(this._unevaluatedLayout=new gt(u.layout)),u.paint)){this._transitionablePaint=new bt(u.paint);for(const f in o.paint)this.setPaintProperty(f,o.paint[f],{validate:!1});for(const f in o.layout)this.setLayoutProperty(f,o.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Dt(u.paint)}}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,u,f={}){u!=null&&this._validate(Xs,`layers.${this.id}.layout.${o}`,o,u,f)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,u):this.visibility=u)}getPaintProperty(o){return Nt(o,x)?this._transitionablePaint.getTransition(o.slice(0,-x.length)):this._transitionablePaint.getValue(o)}setPaintProperty(o,u,f={}){if(u!=null&&this._validate(Io,`layers.${this.id}.paint.${o}`,o,u,f))return!1;if(Nt(o,x))return this._transitionablePaint.setTransition(o.slice(0,-x.length),u||void 0),!1;{const g=this._transitionablePaint._values[o],v=g.value.isDataDriven(),M=g.value;this._transitionablePaint.setValue(o,u),this._handleSpecialPaintPropertyUpdate(o);const A=this._transitionablePaint._values[o].value,D=A.isDataDriven(),z=Nt(o,"pattern")||o==="line-dasharray";return D||v||z||this._handleOverridablePaintPropertyUpdate(o,M,A)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,u,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,u){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,u)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),wn(o,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(o,u,f,g,v={}){return(!v||v.validate!==!1)&&Xp(this,o.call($p,{key:u,layerType:this.type,objectKey:f,value:g,styleSpec:wt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const u=this.paint.get(o);if(u instanceof kt&&ml(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Kc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const L=an([{name:"a_pos",components:2,type:"Int16"}],4),V=an([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Z{constructor(o=[]){this.segments=o}prepareSegment(o,u,f,g){let v=this.segments[this.segments.length-1];return o>Z.MAX_VERTEX_ARRAY_LENGTH&&At(`Max vertices per segment is ${Z.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!v||v.vertexLength+o>Z.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const o of this.segments)for(const u in o.vaos)o.vaos[u].destroy()}static simpleSegment(o,u,f,g){return new Z([{vertexOffset:o,primitiveOffset:u,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}Z.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dn(Z,"SegmentVector");var te=8192;class Ve{constructor(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof pt?new pt(o.lng,o.lat):pt.convert(o),this}setSouthWest(o){return this._sw=o instanceof pt?new pt(o.lng,o.lat):pt.convert(o),this}extend(o){const u=this._sw,f=this._ne;let g,v;if(o instanceof pt)g=o,v=o;else{if(!(o instanceof Ve))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Ve.convert(o)):this.extend(pt.convert(o)):typeof o=="object"&&o!==null&&o.hasOwnProperty("lat")&&o.hasOwnProperty("lon")?this.extend(pt.convert(o)):this;if(g=o._sw,v=o._ne,!g||!v)return this}return u||f?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),f.lng=Math.max(v.lng,f.lng),f.lat=Math.max(v.lat,f.lat)):(this._sw=new pt(g.lng,g.lat),this._ne=new pt(v.lng,v.lat)),this}getCenter(){return new pt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new pt(this.getWest(),this.getNorth())}getSouthEast(){return new pt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:u,lat:f}=pt.convert(o);let g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(o){return!o||o instanceof Ve?o:new Ve(o)}}const st=63710088e-1;class pt{constructor(o,u){if(isNaN(o)||isNaN(u))throw new Error(`Invalid LngLat object: (${o}, ${u})`);if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pt(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const u=Math.PI/180,f=this.lat*u,g=o.lat*u,v=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((o.lng-this.lng)*u);return st*Math.acos(Math.min(v,1))}toBounds(o=0){const u=360*o/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new Ve(new pt(this.lng-f,this.lat-u),new pt(this.lng+f,this.lat+u))}static convert(o){if(o instanceof pt)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new pt(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new pt(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ln=2*Math.PI*st;function Dn(c){return ln*Math.cos(c*Math.PI/180)}function Qn(c){return(180+c)/360}function Gn(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Ci(c,o){return c/Dn(o)}function In(c){return 360*c-180}function Hi(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function wa(c,o){return c*Dn(Hi(o))}const _t=85.051129;function ct(c){return 1/Math.cos(c*Math.PI/180)}class Mt{constructor(o,u,f=0){this.x=+o,this.y=+u,this.z=+f}static fromLngLat(o,u=0){const f=pt.convert(o);return new Mt(Qn(f.lng),Gn(f.lat),Ci(u,f.lat))}toLngLat(){return new pt(In(this.x),Hi(this.y))}toAltitude(){return wa(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ln*ct(Hi(this.y))}}function Mn(c,o,u,f,g,v,M,A,D){const z=(o+f)/2,W=(u+g)/2,q=new j(z,W);A(q),function(X,K,ie,he,ge,Re){const He=ie-ge,Le=he-Re;return Math.abs((he-K)*He-(ie-X)*Le)/Math.hypot(He,Le)}(q.x,q.y,v.x,v.y,M.x,M.y)>=D?(Mn(c,o,u,z,W,v,q,A,D),Mn(c,z,W,f,g,q,M,A,D)):c.push(M)}function Hn(c,o,u){let f=c[0],g=f.x,v=f.y;o(f);const M=[f];for(let A=1;A<c.length;A++){const D=c[A],{x:z,y:W}=D;o(D),Mn(M,g,v,z,W,f,D,o,u),g=z,v=W,f=D}return M}function pi(c,o,u,f){if(f(o,u)){const g=o.add(u)._mult(.5);pi(c,o,g,f),pi(c,g,u,f)}else c.push(u)}function di(c,o){let u=c[0];const f=[u];for(let g=1;g<c.length;g++){const v=c[g];pi(f,u,v,o),u=v}return f}const Ui=Math.pow(2,14)-1,Is=-Ui-1;function Xi(c,o){const u=Math.round(c.x*o),f=Math.round(c.y*o);return c.x=fe(u,Is,Ui),c.y=fe(f,Is,Ui),(u<c.x||u>c.x+1||f<c.y||f>c.y+1)&&At("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function xo(c,o,u){const f=c.loadGeometry(),g=c.extent,v=te/g;if(o&&u&&u.projection.isReprojectedInTileSpace){const M=1<<o.z,{scale:A,x:D,y:z,projection:W}=u,q=X=>{const K=In((o.x+X.x/g)/M),ie=Hi((o.y+X.y/g)/M),he=W.project(K,ie);X.x=(he.x*A-D)*g,X.y=(he.y*A-z)*g};for(let X=0;X<f.length;X++)if(c.type!==1)f[X]=Hn(f[X],q,1);else{const K=[];for(const ie of f[X])ie.x<0||ie.x>=g||ie.y<0||ie.y>=g||(q(ie),K.push(ie));f[X]=K}}for(const M of f)for(const A of M)Xi(A,v);return f}function rd(c,o){return{type:c.type,id:c.id,properties:c.properties,geometry:o?xo(c):[]}}function z1(c,o,u,f,g){c.emplaceBack(2*o+(f+1)/2,2*u+(g+1)/2)}function O1(c,o,u){c.emplaceBack(o.x,o.y,o.z,u[0]*16384,u[1]*16384,u[2]*16384)}class rT{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new bi,this.indexArray=new $i,this.segments=new Z,this.programConfigurations=new rh(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f,g){const v=this.layers[0],M=[];let A=null;v.type==="circle"&&(A=v.layout.get("circle-sort-key"));for(const{feature:z,id:W,index:q,sourceLayerIndex:X}of o){const K=this.layers[0]._featureFilter.needGeometry,ie=rd(z,K);if(!this.layers[0]._featureFilter.filter(new it(this.zoom),ie,f))continue;const he=A?A.evaluate(ie,{},f):void 0,ge={id:W,properties:z.properties,type:z.type,sourceLayerIndex:X,index:q,geometry:K?ie.geometry:xo(z,f,g),patterns:{},sortKey:he};M.push(ge)}A&&M.sort((z,W)=>z.sortKey-W.sortKey);let D=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new Zi,D=g.projection);for(const z of M){const{geometry:W,index:q,sourceLayerIndex:X}=z,K=o[q].feature;this.addFeature(z,W,q,u.availableImages,f,D),u.featureIndex.insert(K,W,q,X,this.index)}}update(o,u,f,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,L.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,V.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,u,f,g,v,M){for(const A of u)for(const D of A){const z=D.x,W=D.y;if(z<0||z>=te||W<0||W>=te)continue;if(M){const K=M.projectTilePoint(z,W,v),ie=M.upVector(v,z,W),he=this.globeExtVertexArray;O1(he,K,ie),O1(he,K,ie),O1(he,K,ie),O1(he,K,ie)}const q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),X=q.vertexLength;z1(this.layoutVertexArray,z,W,-1,-1),z1(this.layoutVertexArray,z,W,1,-1),z1(this.layoutVertexArray,z,W,1,1),z1(this.layoutVertexArray,z,W,-1,1),this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+2,X+3),q.vertexLength+=4,q.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},g,v)}}function Ok(c,o){for(let u=0;u<c.length;u++)if(em(o,c[u]))return!0;for(let u=0;u<o.length;u++)if(em(c,o[u]))return!0;return!!sT(c,o)}function p8(c,o,u){return!!em(c,o)||!!oT(o,c,u)}function Fk(c,o){if(c.length===1)return Nk(o,c[0]);for(let u=0;u<o.length;u++){const f=o[u];for(let g=0;g<f.length;g++)if(em(c,f[g]))return!0}for(let u=0;u<c.length;u++)if(Nk(o,c[u]))return!0;for(let u=0;u<o.length;u++)if(sT(c,o[u]))return!0;return!1}function m8(c,o,u){if(c.length>1){if(sT(c,o))return!0;for(let f=0;f<o.length;f++)if(oT(o[f],c,u))return!0}for(let f=0;f<c.length;f++)if(oT(c[f],o,u))return!0;return!1}function sT(c,o){if(c.length===0||o.length===0)return!1;for(let u=0;u<c.length-1;u++){const f=c[u],g=c[u+1];for(let v=0;v<o.length-1;v++)if(g8(f,g,o[v],o[v+1]))return!0}return!1}function g8(c,o,u,f){return Ot(c,u,f)!==Ot(o,u,f)&&Ot(c,o,u)!==Ot(c,o,f)}function oT(c,o,u){const f=u*u;if(o.length===1)return c.distSqr(o[0])<f;for(let g=1;g<o.length;g++)if(Bk(c,o[g-1],o[g])<f)return!0;return!1}function Bk(c,o,u){const f=o.distSqr(u);if(f===0)return c.distSqr(o);const g=((c.x-o.x)*(u.x-o.x)+(c.y-o.y)*(u.y-o.y))/f;return c.distSqr(g<0?o:g>1?u:u.sub(o)._mult(g)._add(o))}function Nk(c,o){let u,f,g,v=!1;for(let M=0;M<c.length;M++){u=c[M];for(let A=0,D=u.length-1;A<u.length;D=A++)f=u[A],g=u[D],f.y>o.y!=g.y>o.y&&o.x<(g.x-f.x)*(o.y-f.y)/(g.y-f.y)+f.x&&(v=!v)}return v}function em(c,o){let u=!1;for(let f=0,g=c.length-1;f<c.length;g=f++){const v=c[f],M=c[g];v.y>o.y!=M.y>o.y&&o.x<(M.x-v.x)*(o.y-v.y)/(M.y-v.y)+v.x&&(u=!u)}return u}function Uk(c,o,u,f,g){for(const M of c)if(o<=M.x&&u<=M.y&&f>=M.x&&g>=M.y)return!0;const v=[new j(o,u),new j(o,g),new j(f,g),new j(f,u)];if(c.length>2){for(const M of v)if(em(c,M))return!0}for(let M=0;M<c.length-1;M++)if(_8(c[M],c[M+1],v))return!0;return!1}function _8(c,o,u){const f=u[0],g=u[2];if(c.x<f.x&&o.x<f.x||c.x>g.x&&o.x>g.x||c.y<f.y&&o.y<f.y||c.y>g.y&&o.y>g.y)return!1;const v=Ot(c,o,u[0]);return v!==Ot(c,o,u[1])||v!==Ot(c,o,u[2])||v!==Ot(c,o,u[3])}function Ug(c,o,u){const f=o.paint.get(c).value;return f.kind==="constant"?f.value:u.programConfigurations.get(o.id).getMaxValue(c)}function F1(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Vk(c,o,u,f,g){if(!o[0]&&!o[1])return c;const v=j.convert(o)._mult(g);u==="viewport"&&v._rotate(-f);const M=[];for(let A=0;A<c.length;A++)M.push(c[A].sub(v));return M}function Gk(c,o,u,f){const g=j.convert(c)._mult(f);return o==="viewport"&&g._rotate(-u),g}dn(rT,"CircleBucket",{omit:["layers"]});const y8=new mn({"circle-sort-key":new at(wt.layout_circle["circle-sort-key"])});var x8={paint:new mn({"circle-radius":new at(wt.paint_circle["circle-radius"]),"circle-color":new at(wt.paint_circle["circle-color"]),"circle-blur":new at(wt.paint_circle["circle-blur"]),"circle-opacity":new at(wt.paint_circle["circle-opacity"]),"circle-translate":new Ye(wt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(wt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(wt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(wt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new at(wt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new at(wt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new at(wt.paint_circle["circle-stroke-opacity"])}),layout:y8},B1=1e-6,Ua=typeof Float32Array<"u"?Float32Array:Array;function Wk(){var c=new Ua(9);return Ua!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function Hk(c,o,u){var f=o[0],g=o[1],v=o[2],M=o[3],A=o[4],D=o[5],z=o[6],W=o[7],q=o[8],X=u[0],K=u[1],ie=u[2],he=u[3],ge=u[4],Re=u[5],He=u[6],Le=u[7],Ge=u[8];return c[0]=X*f+K*M+ie*z,c[1]=X*g+K*A+ie*W,c[2]=X*v+K*D+ie*q,c[3]=he*f+ge*M+Re*z,c[4]=he*g+ge*A+Re*W,c[5]=he*v+ge*D+Re*q,c[6]=He*f+Le*M+Ge*z,c[7]=He*g+Le*A+Ge*W,c[8]=He*v+Le*D+Ge*q,c}function ou(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function aT(c,o){var u=o[0],f=o[1],g=o[2],v=o[3],M=o[4],A=o[5],D=o[6],z=o[7],W=o[8],q=o[9],X=o[10],K=o[11],ie=o[12],he=o[13],ge=o[14],Re=o[15],He=u*A-f*M,Le=u*D-g*M,Ge=u*z-v*M,Xe=f*D-g*A,je=f*z-v*A,dt=g*z-v*D,ut=W*he-q*ie,Tt=W*ge-X*ie,Wt=W*Re-K*ie,yt=q*ge-X*he,Pt=q*Re-K*he,Rt=X*Re-K*ge,Bt=He*Rt-Le*Pt+Ge*yt+Xe*Wt-je*Tt+dt*ut;return Bt?(c[0]=(A*Rt-D*Pt+z*yt)*(Bt=1/Bt),c[1]=(g*Pt-f*Rt-v*yt)*Bt,c[2]=(he*dt-ge*je+Re*Xe)*Bt,c[3]=(X*je-q*dt-K*Xe)*Bt,c[4]=(D*Wt-M*Rt-z*Tt)*Bt,c[5]=(u*Rt-g*Wt+v*Tt)*Bt,c[6]=(ge*Ge-ie*dt-Re*Le)*Bt,c[7]=(W*dt-X*Ge+K*Le)*Bt,c[8]=(M*Pt-A*Wt+z*ut)*Bt,c[9]=(f*Wt-u*Pt-v*ut)*Bt,c[10]=(ie*je-he*Ge+Re*He)*Bt,c[11]=(q*Ge-W*je-K*He)*Bt,c[12]=(A*Tt-M*yt-D*ut)*Bt,c[13]=(u*yt-f*Tt+g*ut)*Bt,c[14]=(he*Le-ie*Xe-ge*He)*Bt,c[15]=(W*Xe-q*Le+X*He)*Bt,c):null}function tm(c,o,u){var f=o[0],g=o[1],v=o[2],M=o[3],A=o[4],D=o[5],z=o[6],W=o[7],q=o[8],X=o[9],K=o[10],ie=o[11],he=o[12],ge=o[13],Re=o[14],He=o[15],Le=u[0],Ge=u[1],Xe=u[2],je=u[3];return c[0]=Le*f+Ge*A+Xe*q+je*he,c[1]=Le*g+Ge*D+Xe*X+je*ge,c[2]=Le*v+Ge*z+Xe*K+je*Re,c[3]=Le*M+Ge*W+Xe*ie+je*He,c[4]=(Le=u[4])*f+(Ge=u[5])*A+(Xe=u[6])*q+(je=u[7])*he,c[5]=Le*g+Ge*D+Xe*X+je*ge,c[6]=Le*v+Ge*z+Xe*K+je*Re,c[7]=Le*M+Ge*W+Xe*ie+je*He,c[8]=(Le=u[8])*f+(Ge=u[9])*A+(Xe=u[10])*q+(je=u[11])*he,c[9]=Le*g+Ge*D+Xe*X+je*ge,c[10]=Le*v+Ge*z+Xe*K+je*Re,c[11]=Le*M+Ge*W+Xe*ie+je*He,c[12]=(Le=u[12])*f+(Ge=u[13])*A+(Xe=u[14])*q+(je=u[15])*he,c[13]=Le*g+Ge*D+Xe*X+je*ge,c[14]=Le*v+Ge*z+Xe*K+je*Re,c[15]=Le*M+Ge*W+Xe*ie+je*He,c}function e0(c,o,u){var f,g,v,M,A,D,z,W,q,X,K,ie,he=u[0],ge=u[1],Re=u[2];return o===c?(c[12]=o[0]*he+o[4]*ge+o[8]*Re+o[12],c[13]=o[1]*he+o[5]*ge+o[9]*Re+o[13],c[14]=o[2]*he+o[6]*ge+o[10]*Re+o[14],c[15]=o[3]*he+o[7]*ge+o[11]*Re+o[15]):(g=o[1],v=o[2],M=o[3],A=o[4],D=o[5],z=o[6],W=o[7],q=o[8],X=o[9],K=o[10],ie=o[11],c[0]=f=o[0],c[1]=g,c[2]=v,c[3]=M,c[4]=A,c[5]=D,c[6]=z,c[7]=W,c[8]=q,c[9]=X,c[10]=K,c[11]=ie,c[12]=f*he+A*ge+q*Re+o[12],c[13]=g*he+D*ge+X*Re+o[13],c[14]=v*he+z*ge+K*Re+o[14],c[15]=M*he+W*ge+ie*Re+o[15]),c}function nm(c,o,u){var f=u[0],g=u[1],v=u[2];return c[0]=o[0]*f,c[1]=o[1]*f,c[2]=o[2]*f,c[3]=o[3]*f,c[4]=o[4]*g,c[5]=o[5]*g,c[6]=o[6]*g,c[7]=o[7]*g,c[8]=o[8]*v,c[9]=o[9]*v,c[10]=o[10]*v,c[11]=o[11]*v,c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15],c}function lT(c,o,u){var f=Math.sin(u),g=Math.cos(u),v=o[4],M=o[5],A=o[6],D=o[7],z=o[8],W=o[9],q=o[10],X=o[11];return o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15]),c[4]=v*g+z*f,c[5]=M*g+W*f,c[6]=A*g+q*f,c[7]=D*g+X*f,c[8]=z*g-v*f,c[9]=W*g-M*f,c[10]=q*g-A*f,c[11]=X*g-D*f,c}function N1(c,o,u){var f=Math.sin(u),g=Math.cos(u),v=o[0],M=o[1],A=o[2],D=o[3],z=o[8],W=o[9],q=o[10],X=o[11];return o!==c&&(c[4]=o[4],c[5]=o[5],c[6]=o[6],c[7]=o[7],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15]),c[0]=v*g-z*f,c[1]=M*g-W*f,c[2]=A*g-q*f,c[3]=D*g-X*f,c[8]=v*f+z*g,c[9]=M*f+W*g,c[10]=A*f+q*g,c[11]=D*f+X*g,c}function jk(c,o){return c[0]=o[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=o[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=o[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function qk(c,o,u){var f,g,v,M=u[0],A=u[1],D=u[2],z=Math.hypot(M,A,D);return z<B1?null:(M*=z=1/z,A*=z,D*=z,f=Math.sin(o),g=Math.cos(o),c[0]=M*M*(v=1-g)+g,c[1]=A*M*v+D*f,c[2]=D*M*v-A*f,c[3]=0,c[4]=M*A*v-D*f,c[5]=A*A*v+g,c[6]=D*A*v+M*f,c[7]=0,c[8]=M*D*v+A*f,c[9]=A*D*v-M*f,c[10]=D*D*v+g,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}Math.hypot||(Math.hypot=function(){for(var c=0,o=arguments.length;o--;)c+=arguments[o]*arguments[o];return Math.sqrt(c)});var v8=tm;function cT(){var c=new Ua(3);return Ua!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Zk(c){var o=new Ua(3);return o[0]=c[0],o[1]=c[1],o[2]=c[2],o}function t0(c){return Math.hypot(c[0],c[1],c[2])}function Vg(c,o,u){var f=new Ua(3);return f[0]=c,f[1]=o,f[2]=u,f}function sd(c,o,u){return c[0]=o[0]+u[0],c[1]=o[1]+u[1],c[2]=o[2]+u[2],c}function uT(c,o,u){return c[0]=o[0]-u[0],c[1]=o[1]-u[1],c[2]=o[2]-u[2],c}function $k(c,o,u){return c[0]=o[0]*u[0],c[1]=o[1]*u[1],c[2]=o[2]*u[2],c}function n0(c,o,u){return c[0]=Math.min(o[0],u[0]),c[1]=Math.min(o[1],u[1]),c[2]=Math.min(o[2],u[2]),c}function i0(c,o,u){return c[0]=Math.max(o[0],u[0]),c[1]=Math.max(o[1],u[1]),c[2]=Math.max(o[2],u[2]),c}function Sl(c,o,u){return c[0]=o[0]*u,c[1]=o[1]*u,c[2]=o[2]*u,c}function r0(c,o,u,f){return c[0]=o[0]+u[0]*f,c[1]=o[1]+u[1]*f,c[2]=o[2]+u[2]*f,c}function Xo(c,o){var u=o[0],f=o[1],g=o[2],v=u*u+f*f+g*g;return v>0&&(v=1/Math.sqrt(v)),c[0]=o[0]*v,c[1]=o[1]*v,c[2]=o[2]*v,c}function ic(c,o){return c[0]*o[0]+c[1]*o[1]+c[2]*o[2]}function hT(c,o,u){var f=o[0],g=o[1],v=o[2],M=u[0],A=u[1],D=u[2];return c[0]=g*D-v*A,c[1]=v*M-f*D,c[2]=f*A-g*M,c}function qr(c,o,u){var f=o[0],g=o[1],v=o[2],M=u[3]*f+u[7]*g+u[11]*v+u[15];return c[0]=(u[0]*f+u[4]*g+u[8]*v+u[12])/(M=M||1),c[1]=(u[1]*f+u[5]*g+u[9]*v+u[13])/M,c[2]=(u[2]*f+u[6]*g+u[10]*v+u[14])/M,c}function Xk(c,o,u){var f=u[0],g=u[1],v=u[2],M=o[0],A=o[1],D=o[2],z=g*D-v*A,W=v*M-f*D,q=f*A-g*M,X=g*q-v*W,K=v*z-f*q,ie=f*W-g*z,he=2*u[3];return W*=he,q*=he,K*=2,ie*=2,c[0]=M+(z*=he)+(X*=2),c[1]=A+W+K,c[2]=D+q+ie,c}var s0,au=uT,w8=$k,b8=t0;function Yk(c,o,u){return c[0]=o[0]*u,c[1]=o[1]*u,c[2]=o[2]*u,c[3]=o[3]*u,c}function Jk(c,o){var u=o[0],f=o[1],g=o[2],v=o[3],M=u*u+f*f+g*g+v*v;return M>0&&(M=1/Math.sqrt(M)),c[0]=u*M,c[1]=f*M,c[2]=g*M,c[3]=v*M,c}function im(c,o,u){var f=o[0],g=o[1],v=o[2],M=o[3];return c[0]=u[0]*f+u[4]*g+u[8]*v+u[12]*M,c[1]=u[1]*f+u[5]*g+u[9]*v+u[13]*M,c[2]=u[2]*f+u[6]*g+u[10]*v+u[14]*M,c[3]=u[3]*f+u[7]*g+u[11]*v+u[15]*M,c}function Kk(){var c=new Ua(4);return Ua!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Qk(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function e3(c,o,u){u*=.5;var f=o[0],g=o[1],v=o[2],M=o[3],A=Math.sin(u),D=Math.cos(u);return c[0]=f*D+M*A,c[1]=g*D+v*A,c[2]=v*D-g*A,c[3]=M*D-f*A,c}function t3(c,o,u){u*=.5;var f=o[0],g=o[1],v=o[2],M=o[3],A=Math.sin(u),D=Math.cos(u);return c[0]=f*D-v*A,c[1]=g*D+M*A,c[2]=v*D+f*A,c[3]=M*D-g*A,c}cT(),s0=new Ua(4),Ua!=Float32Array&&(s0[0]=0,s0[1]=0,s0[2]=0,s0[3]=0);var S8=Jk;cT(),Vg(1,0,0),Vg(0,1,0),Kk(),Kk(),Wk();class dT{constructor(o,u){this.pos=o,this.dir=u}intersectsPlane(o,u,f){const g=ic(u,this.dir);if(Math.abs(g)<1e-6)return!1;const v=((o[0]-this.pos[0])*u[0]+(o[1]-this.pos[1])*u[1]+(o[2]-this.pos[2])*u[2])/g;return f[0]=this.pos[0]+this.dir[0]*v,f[1]=this.pos[1]+this.dir[1]*v,f[2]=this.pos[2]+this.dir[2]*v,!0}closestPointOnSphere(o,u,f){if(function(K,ie){var he=K[0],ge=K[1],Re=K[2],He=ie[0],Le=ie[1],Ge=ie[2];return Math.abs(he-He)<=B1*Math.max(1,Math.abs(he),Math.abs(He))&&Math.abs(ge-Le)<=B1*Math.max(1,Math.abs(ge),Math.abs(Le))&&Math.abs(Re-Ge)<=B1*Math.max(1,Math.abs(Re),Math.abs(Ge))}(this.pos,o)||u===0)return f[0]=f[1]=f[2]=0,!1;const[g,v,M]=this.dir,A=this.pos[0]-o[0],D=this.pos[1]-o[1],z=this.pos[2]-o[2],W=g*g+v*v+M*M,q=2*(A*g+D*v+z*M),X=q*q-4*W*(A*A+D*D+z*z-u*u);if(X<0){const K=Math.max(-q/2,0),ie=A+g*K,he=D+v*K,ge=z+M*K,Re=Math.hypot(ie,he,ge);return f[0]=ie*u/Re,f[1]=he*u/Re,f[2]=ge*u/Re,!1}{const K=(-q-Math.sqrt(X))/(2*W);if(K<0){const ie=Math.hypot(A,D,z);return f[0]=A*u/ie,f[1]=D*u/ie,f[2]=z*u/ie,!1}return f[0]=A+g*K,f[1]=D+v*K,f[2]=z+M*K,!0}}}class fT{constructor(o,u,f,g,v){this.TL=o,this.TR=u,this.BR=f,this.BL=g,this.horizon=v}static fromInvProjectionMatrix(o,u,f){const g=[-1,1,1],v=[1,1,1],M=[1,-1,1],A=[-1,-1,1],D=qr(g,g,o),z=qr(v,v,o),W=qr(M,M,o),q=qr(A,A,o);return new fT(D,z,W,q,u/f)}}class pT{constructor(o,u){this.points=o,this.planes=u}static fromInvProjectionMatrix(o,u,f,g){const v=Math.pow(2,f),M=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const z=im([],D,o),W=1/z[3]/u*v;return function(q,X,K){return q[0]=X[0]*K[0],q[1]=X[1]*K[1],q[2]=X[2]*K[2],q[3]=X[3]*K[3],q}(z,z,[W,W,g?1/z[3]:W,W])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const z=Xo([],hT([],au([],M[D[0]],M[D[1]]),au([],M[D[2]],M[D[1]]))),W=-ic(z,M[D[1]]);return z.concat(W)});return new pT(M,A)}}class Yo{static fromPoints(o){const u=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const g of o)n0(u,u,g),i0(f,f,g);return new Yo(u,f)}static applyTransform(o,u){const f=o.getCorners();for(let g=0;g<f.length;++g)qr(f[g],f[g],u);return Yo.fromPoints(f)}constructor(o,u){this.min=o,this.max=u,this.center=Sl([],sd([],this.min,this.max),.5)}quadrant(o){const u=[o%2==0,o<2],f=Zk(this.min),g=Zk(this.max);for(let v=0;v<u.length;v++)f[v]=u[v]?this.min[v]:this.center[v],g[v]=u[v]?this.center[v]:this.max[v];return g[2]=this.max[2],new Yo(f,g)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,u=this.max;return[[o[0],o[1],o[2]],[u[0],o[1],o[2]],[u[0],u[1],o[2]],[o[0],u[1],o[2]],[o[0],o[1],u[2]],[u[0],o[1],u[2]],[u[0],u[1],u[2]],[o[0],u[1],u[2]]]}intersects(o){const u=this.getCorners();let f=!0;for(let g=0;g<o.planes.length;g++){const v=o.planes[g];let M=0;for(let A=0;A<u.length;A++)M+=ic(v,u[A])+v[3]>=0;if(M===0)return 0;M!==u.length&&(f=!1)}if(f)return 2;for(let g=0;g<3;g++){let v=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let A=0;A<o.points.length;A++){const D=o.points[A][g]-this.min[g];v=Math.min(v,D),M=Math.max(M,D)}if(M<0||v>this.max[g]-this.min[g])return 0}return 1}}function n3(c,o,u,f,g,v,M,A,D){if(v&&c.queryGeometry.isAboveHorizon)return!1;v&&(D*=c.pixelToTileUnitsFactor);const z=c.tileID.canonical,W=u.projection.upVectorScale(z,u.center.lat,u.worldSize).metersToTile;for(const q of o)for(const X of q){const K=X.add(A),ie=g&&u.elevation?u.elevation.exaggeration()*g.getElevationAt(K.x,K.y,!0):0,he=u.projection.projectTilePoint(K.x,K.y,z);if(ie>0){const Le=u.projection.upVector(z,K.x,K.y);he.x+=Le[0]*W*ie,he.y+=Le[1]*W*ie,he.z+=Le[2]*W*ie}const ge=v?K:M8(he.x,he.y,he.z,f),Re=v?c.tilespaceRays.map(Le=>E8(Le,ie)):c.queryGeometry.screenGeometry,He=im([],[he.x,he.y,he.z,1],f);if(!M&&v?D*=He[3]/u.cameraToCenterDistance:M&&!v&&(D*=u.cameraToCenterDistance/He[3]),v){const Le=Hi((X.y/te+z.y)/(1<<z.z));D/=u.projection.pixelsPerMeter(Le,1)/Ci(1,Le)}if(p8(Re,ge,D))return!0}return!1}function M8(c,o,u,f){const g=im([],[c,o,u,1],f);return new j(g[0]/g[3],g[1]/g[3])}const i3=Vg(0,0,0),T8=Vg(0,0,1);function E8(c,o){const u=cT();return i3[2]=o,c.intersectsPlane(i3,T8,u),new j(u[0],u[1])}class r3 extends rT{}function s3(c,{width:o,height:u},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==o*u*f)throw new RangeError("mismatched image size")}else g=new Uint8Array(o*u*f);return c.width=o,c.height=u,c.data=g,c}function o3(c,o,u){const{width:f,height:g}=o;f===c.width&&g===c.height||(mT(c,o,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,f),height:Math.min(c.height,g)},u),c.width=f,c.height=g,c.data=o.data)}function mT(c,o,u,f,g,v){if(g.width===0||g.height===0)return o;if(g.width>c.width||g.height>c.height||u.x>c.width-g.width||u.y>c.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||f.x>o.width-g.width||f.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const M=c.data,A=o.data;for(let D=0;D<g.height;D++){const z=((u.y+D)*c.width+u.x)*v,W=((f.y+D)*o.width+f.x)*v;for(let q=0;q<g.width*v;q++)A[W+q]=M[z+q]}return o}dn(r3,"HeatmapBucket",{omit:["layers"]});class od{constructor(o,u){s3(this,o,1,u)}resize(o){o3(this,new od(o),1)}clone(){return new od({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,g,v){mT(o,u,f,g,v,1)}}class Va{constructor(o,u){s3(this,o,4,u)}resize(o){o3(this,new Va(o),4)}replace(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Va({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,g,v){mT(o,u,f,g,v,4)}}dn(od,"AlphaImage"),dn(Va,"RGBAImage");var A8={paint:new mn({"heatmap-radius":new at(wt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new at(wt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(wt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qt(wt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(wt.paint_heatmap["heatmap-opacity"])})};function gT(c){const o={},u=c.resolution||256,f=c.clips?c.clips.length:1,g=c.image||new Va({width:u,height:f}),v=(M,A,D)=>{o[c.evaluationKey]=D;const z=c.expression.evaluate(o);g.data[M+A+0]=Math.floor(255*z.r/z.a),g.data[M+A+1]=Math.floor(255*z.g/z.a),g.data[M+A+2]=Math.floor(255*z.b/z.a),g.data[M+A+3]=Math.floor(255*z.a)};if(c.clips)for(let M=0,A=0;M<f;++M,A+=4*u)for(let D=0,z=0;D<u;D++,z+=4){const W=D/(u-1),{start:q,end:X}=c.clips[M];v(A,z,q*(1-W)+X*W)}else for(let M=0,A=0;M<u;M++,A+=4)v(0,A,M/(u-1));return g}var C8={paint:new mn({"hillshade-illumination-direction":new Ye(wt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ye(wt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(wt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(wt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(wt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(wt.paint_hillshade["hillshade-accent-color"])})};const I8=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:P8}=I8;var o0={exports:{}};function U1(c,o,u){u=u||2;var f,g,v,M,A,D,z,W=o&&o.length,q=W?o[0]*u:c.length,X=a3(c,0,q,u,!0),K=[];if(!X||X.next===X.prev)return K;if(W&&(X=function(he,ge,Re,He){var Le,Ge,Xe,je=[];for(Le=0,Ge=ge.length;Le<Ge;Le++)(Xe=a3(he,ge[Le]*He,Le<Ge-1?ge[Le+1]*He:he.length,He,!1))===Xe.next&&(Xe.steiner=!0),je.push(B8(Xe));for(je.sort(z8),Le=0;Le<je.length;Le++)Re=O8(je[Le],Re);return Re}(c,o,X,u)),c.length>80*u){f=v=c[0],g=M=c[1];for(var ie=u;ie<q;ie+=u)(A=c[ie])<f&&(f=A),(D=c[ie+1])<g&&(g=D),A>v&&(v=A),D>M&&(M=D);z=(z=Math.max(v-f,M-g))!==0?32767/z:0}return a0(X,K,u,f,g,z,0),K}function a3(c,o,u,f,g){var v,M;if(g===xT(c,o,u,f)>0)for(v=o;v<u;v+=f)M=u3(v,c[v],c[v+1],M);else for(v=u-f;v>=o;v-=f)M=u3(v,c[v],c[v+1],M);return M&&V1(M,M.next)&&(c0(M),M=M.next),M}function rm(c,o){if(!c)return c;o||(o=c);var u,f=c;do if(u=!1,f.steiner||!V1(f,f.next)&&is(f.prev,f,f.next)!==0)f=f.next;else{if(c0(f),(f=o=f.prev)===f.next)break;u=!0}while(u||f!==o);return o}function a0(c,o,u,f,g,v,M){if(c){!M&&v&&function(W,q,X,K){var ie=W;do ie.z===0&&(ie.z=_T(ie.x,ie.y,q,X,K)),ie.prevZ=ie.prev,ie.nextZ=ie.next,ie=ie.next;while(ie!==W);ie.prevZ.nextZ=null,ie.prevZ=null,function(he){var ge,Re,He,Le,Ge,Xe,je,dt,ut=1;do{for(Re=he,he=null,Ge=null,Xe=0;Re;){for(Xe++,He=Re,je=0,ge=0;ge<ut&&(je++,He=He.nextZ);ge++);for(dt=ut;je>0||dt>0&&He;)je!==0&&(dt===0||!He||Re.z<=He.z)?(Le=Re,Re=Re.nextZ,je--):(Le=He,He=He.nextZ,dt--),Ge?Ge.nextZ=Le:he=Le,Le.prevZ=Ge,Ge=Le;Re=He}Ge.nextZ=null,ut*=2}while(Xe>1)}(ie)}(c,f,g,v);for(var A,D,z=c;c.prev!==c.next;)if(A=c.prev,D=c.next,v?D8(c,f,g,v):k8(c))o.push(A.i/u|0),o.push(c.i/u|0),o.push(D.i/u|0),c0(c),c=D.next,z=D.next;else if((c=D)===z){M?M===1?a0(c=L8(rm(c),o,u),o,u,f,g,v,2):M===2&&R8(c,o,u,f,g,v):a0(rm(c),o,u,f,g,v,1);break}}}function k8(c){var o=c.prev,u=c,f=c.next;if(is(o,u,f)>=0)return!1;for(var g=o.x,v=u.x,M=f.x,A=o.y,D=u.y,z=f.y,W=g<v?g<M?g:M:v<M?v:M,q=A<D?A<z?A:z:D<z?D:z,X=g>v?g>M?g:M:v>M?v:M,K=A>D?A>z?A:z:D>z?D:z,ie=f.next;ie!==o;){if(ie.x>=W&&ie.x<=X&&ie.y>=q&&ie.y<=K&&Gg(g,A,v,D,M,z,ie.x,ie.y)&&is(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function D8(c,o,u,f){var g=c.prev,v=c,M=c.next;if(is(g,v,M)>=0)return!1;for(var A=g.x,D=v.x,z=M.x,W=g.y,q=v.y,X=M.y,K=A<D?A<z?A:z:D<z?D:z,ie=W<q?W<X?W:X:q<X?q:X,he=A>D?A>z?A:z:D>z?D:z,ge=W>q?W>X?W:X:q>X?q:X,Re=_T(K,ie,o,u,f),He=_T(he,ge,o,u,f),Le=c.prevZ,Ge=c.nextZ;Le&&Le.z>=Re&&Ge&&Ge.z<=He;){if(Le.x>=K&&Le.x<=he&&Le.y>=ie&&Le.y<=ge&&Le!==g&&Le!==M&&Gg(A,W,D,q,z,X,Le.x,Le.y)&&is(Le.prev,Le,Le.next)>=0||(Le=Le.prevZ,Ge.x>=K&&Ge.x<=he&&Ge.y>=ie&&Ge.y<=ge&&Ge!==g&&Ge!==M&&Gg(A,W,D,q,z,X,Ge.x,Ge.y)&&is(Ge.prev,Ge,Ge.next)>=0))return!1;Ge=Ge.nextZ}for(;Le&&Le.z>=Re;){if(Le.x>=K&&Le.x<=he&&Le.y>=ie&&Le.y<=ge&&Le!==g&&Le!==M&&Gg(A,W,D,q,z,X,Le.x,Le.y)&&is(Le.prev,Le,Le.next)>=0)return!1;Le=Le.prevZ}for(;Ge&&Ge.z<=He;){if(Ge.x>=K&&Ge.x<=he&&Ge.y>=ie&&Ge.y<=ge&&Ge!==g&&Ge!==M&&Gg(A,W,D,q,z,X,Ge.x,Ge.y)&&is(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.nextZ}return!0}function L8(c,o,u){var f=c;do{var g=f.prev,v=f.next.next;!V1(g,v)&&l3(g,f,f.next,v)&&l0(g,v)&&l0(v,g)&&(o.push(g.i/u|0),o.push(f.i/u|0),o.push(v.i/u|0),c0(f),c0(f.next),f=c=v),f=f.next}while(f!==c);return rm(f)}function R8(c,o,u,f,g,v){var M=c;do{for(var A=M.next.next;A!==M.prev;){if(M.i!==A.i&&N8(M,A)){var D=c3(M,A);return M=rm(M,M.next),D=rm(D,D.next),a0(M,o,u,f,g,v,0),void a0(D,o,u,f,g,v,0)}A=A.next}M=M.next}while(M!==c)}function z8(c,o){return c.x-o.x}function O8(c,o){var u=function(g,v){var M,A=v,D=g.x,z=g.y,W=-1/0;do{if(z<=A.y&&z>=A.next.y&&A.next.y!==A.y){var q=A.x+(z-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(q<=D&&q>W&&(W=q,M=A.x<A.next.x?A:A.next,q===D))return M}A=A.next}while(A!==v);if(!M)return null;var X,K=M,ie=M.x,he=M.y,ge=1/0;A=M;do D>=A.x&&A.x>=ie&&D!==A.x&&Gg(z<he?D:W,z,ie,he,z<he?W:D,z,A.x,A.y)&&(X=Math.abs(z-A.y)/(D-A.x),l0(A,g)&&(X<ge||X===ge&&(A.x>M.x||A.x===M.x&&F8(M,A)))&&(M=A,ge=X)),A=A.next;while(A!==K);return M}(c,o);if(!u)return o;var f=c3(u,c);return rm(f,f.next),rm(u,u.next)}function F8(c,o){return is(c.prev,c,o.prev)<0&&is(o.next,c,c.next)<0}function _T(c,o,u,f,g){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-u)*g|0)|c<<8))|c<<4))|c<<2))|c<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function B8(c){var o=c,u=c;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==c);return u}function Gg(c,o,u,f,g,v,M,A){return(g-M)*(o-A)>=(c-M)*(v-A)&&(c-M)*(f-A)>=(u-M)*(o-A)&&(u-M)*(v-A)>=(g-M)*(f-A)}function N8(c,o){return c.next.i!==o.i&&c.prev.i!==o.i&&!function(u,f){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==f.i&&g.next.i!==f.i&&l3(g,g.next,u,f))return!0;g=g.next}while(g!==u);return!1}(c,o)&&(l0(c,o)&&l0(o,c)&&function(u,f){var g=u,v=!1,M=(u.x+f.x)/2,A=(u.y+f.y)/2;do g.y>A!=g.next.y>A&&g.next.y!==g.y&&M<(g.next.x-g.x)*(A-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==u);return v}(c,o)&&(is(c.prev,c,o.prev)||is(c,o.prev,o))||V1(c,o)&&is(c.prev,c,c.next)>0&&is(o.prev,o,o.next)>0)}function is(c,o,u){return(o.y-c.y)*(u.x-o.x)-(o.x-c.x)*(u.y-o.y)}function V1(c,o){return c.x===o.x&&c.y===o.y}function l3(c,o,u,f){var g=W1(is(c,o,u)),v=W1(is(c,o,f)),M=W1(is(u,f,c)),A=W1(is(u,f,o));return g!==v&&M!==A||!(g!==0||!G1(c,u,o))||!(v!==0||!G1(c,f,o))||!(M!==0||!G1(u,c,f))||!(A!==0||!G1(u,o,f))}function G1(c,o,u){return o.x<=Math.max(c.x,u.x)&&o.x>=Math.min(c.x,u.x)&&o.y<=Math.max(c.y,u.y)&&o.y>=Math.min(c.y,u.y)}function W1(c){return c>0?1:c<0?-1:0}function l0(c,o){return is(c.prev,c,c.next)<0?is(c,o,c.next)>=0&&is(c,c.prev,o)>=0:is(c,o,c.prev)<0||is(c,c.next,o)<0}function c3(c,o){var u=new yT(c.i,c.x,c.y),f=new yT(o.i,o.x,o.y),g=c.next,v=o.prev;return c.next=o,o.prev=c,u.next=g,g.prev=u,f.next=u,u.prev=f,v.next=f,f.prev=v,f}function u3(c,o,u,f){var g=new yT(c,o,u);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function c0(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function yT(c,o,u){this.i=c,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xT(c,o,u,f){for(var g=0,v=o,M=u-f;v<u;v+=f)g+=(c[M]-c[v])*(c[v+1]+c[M+1]),M=v;return g}function U8(c,o,u,f,g){h3(c,o,u||0,f||c.length-1,g||V8)}function h3(c,o,u,f,g){for(;f>u;){if(f-u>600){var v=f-u+1,M=o-u+1,A=Math.log(v),D=.5*Math.exp(2*A/3),z=.5*Math.sqrt(A*D*(v-D)/v)*(M-v/2<0?-1:1);h3(c,o,Math.max(u,Math.floor(o-M*D/v+z)),Math.min(f,Math.floor(o+(v-M)*D/v+z)),g)}var W=c[o],q=u,X=f;for(u0(c,u,o),g(c[f],W)>0&&u0(c,u,f);q<X;){for(u0(c,q,X),q++,X--;g(c[q],W)<0;)q++;for(;g(c[X],W)>0;)X--}g(c[u],W)===0?u0(c,u,X):u0(c,++X,f),X<=o&&(u=X+1),o<=X&&(f=X-1)}}function u0(c,o,u){var f=c[o];c[o]=c[u],c[u]=f}function V8(c,o){return c<o?-1:c>o?1:0}function vT(c,o){const u=c.length;if(u<=1)return[c];const f=[];let g,v;for(let M=0;M<u;M++){const A=Ft(c[M]);A!==0&&(c[M].area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(g&&f.push(g),g=[c[M]]):g.push(c[M]))}if(g&&f.push(g),o>1)for(let M=0;M<f.length;M++)f[M].length<=o||(U8(f[M],o,1,f[M].length-1,G8),f[M]=f[M].slice(0,o));return f}function G8(c,o){return o.area-c.area}function wT(c,o,u){const f=u.patternDependencies;let g=!1;for(const v of o){const M=v.paint.get(`${c}-pattern`);M.isConstant()||(g=!0);const A=M.constantOr(null);A&&(g=!0,f[A]=!0)}return g}function bT(c,o,u,f,g){const v=g.patternDependencies;for(const M of o){const A=M.paint.get(`${c}-pattern`).value;if(A.kind!=="constant"){let D=A.evaluate({zoom:f},u,{},g.availableImages);D=D&&D.name?D.name:D,v[D]=!0,u.patterns[M.id]=D}}return u}o0.exports=U1,o0.exports.default=U1,U1.deviation=function(c,o,u,f){var g=o&&o.length,v=Math.abs(xT(c,0,g?o[0]*u:c.length,u));if(g)for(var M=0,A=o.length;M<A;M++)v-=Math.abs(xT(c,o[M]*u,M<A-1?o[M+1]*u:c.length,u));var D=0;for(M=0;M<f.length;M+=3){var z=f[M]*u,W=f[M+1]*u,q=f[M+2]*u;D+=Math.abs((c[z]-c[q])*(c[W+1]-c[z+1])-(c[z]-c[W])*(c[q+1]-c[z+1]))}return v===0&&D===0?0:Math.abs((D-v)/v)},U1.flatten=function(c){for(var o=c[0][0].length,u={vertices:[],holes:[],dimensions:o},f=0,g=0;g<c.length;g++){for(var v=0;v<c[g].length;v++)for(var M=0;M<o;M++)u.vertices.push(c[g][v][M]);g>0&&u.holes.push(f+=c[g-1].length)}return u};class H1{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new bi,this.indexArray=new $i,this.indexArray2=new Zo,this.programConfigurations=new rh(o.layers,o.zoom),this.segments=new Z,this.segments2=new Z,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.projection=o.projection}populate(o,u,f,g){this.hasPattern=wT("fill",this.layers,u);const v=this.layers[0].layout.get("fill-sort-key"),M=[];for(const{feature:A,id:D,index:z,sourceLayerIndex:W}of o){const q=this.layers[0]._featureFilter.needGeometry,X=rd(A,q);if(!this.layers[0]._featureFilter.filter(new it(this.zoom),X,f))continue;const K=v?v.evaluate(X,{},f,u.availableImages):void 0,ie={id:D,properties:A.properties,type:A.type,sourceLayerIndex:W,index:z,geometry:q?X.geometry:xo(A,f,g),patterns:{},sortKey:K};M.push(ie)}v&&M.sort((A,D)=>A.sortKey-D.sortKey);for(const A of M){const{geometry:D,index:z,sourceLayerIndex:W}=A;if(this.hasPattern){const q=bT("fill",this.layers,A,this.zoom,u);this.patternFeatures.push(q)}else this.addFeature(A,D,z,f,{},u.availableImages);u.featureIndex.insert(o[z].feature,D,z,W,this.index)}}update(o,u,f,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,g)}addFeatures(o,u,f,g,v){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,u,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,P8),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,u,f,g,v,M=[]){for(const A of vT(u,500)){let D=0;for(const ie of A)D+=ie.length;const z=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),W=z.vertexLength,q=[],X=[];for(const ie of A){if(ie.length===0)continue;ie!==A[0]&&X.push(q.length/2);const he=this.segments2.prepareSegment(ie.length,this.layoutVertexArray,this.indexArray2),ge=he.vertexLength;this.layoutVertexArray.emplaceBack(ie[0].x,ie[0].y),this.indexArray2.emplaceBack(ge+ie.length-1,ge),q.push(ie[0].x),q.push(ie[0].y);for(let Re=1;Re<ie.length;Re++)this.layoutVertexArray.emplaceBack(ie[Re].x,ie[Re].y),this.indexArray2.emplaceBack(ge+Re-1,ge+Re),q.push(ie[Re].x),q.push(ie[Re].y);he.vertexLength+=ie.length,he.primitiveLength+=ie.length}const K=o0.exports(q,X);for(let ie=0;ie<K.length;ie+=3)this.indexArray.emplaceBack(W+K[ie],W+K[ie+1],W+K[ie+2]);z.vertexLength+=D,z.primitiveLength+=K.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,v,M,g)}}dn(H1,"FillBucket",{omit:["layers","patternFeatures"]});const W8=new mn({"fill-sort-key":new at(wt.layout_fill["fill-sort-key"])});var H8={paint:new mn({"fill-antialias":new Ye(wt.paint_fill["fill-antialias"]),"fill-opacity":new at(wt.paint_fill["fill-opacity"]),"fill-color":new at(wt.paint_fill["fill-color"]),"fill-outline-color":new at(wt.paint_fill["fill-outline-color"]),"fill-translate":new Ye(wt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(wt.paint_fill["fill-translate-anchor"]),"fill-pattern":new at(wt.paint_fill["fill-pattern"])}),layout:W8};const j8=an([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),q8=an([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Z8=an([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:$8}=j8;var j1={},X8=j,d3=Wg;function Wg(c,o,u,f,g){this.properties={},this.extent=u,this.type=0,this._pbf=c,this._geometry=-1,this._keys=f,this._values=g,c.readFields(Y8,this,o)}function Y8(c,o,u){c==1?o.id=u.readVarint():c==2?function(f,g){for(var v=f.readVarint()+f.pos;f.pos<v;){var M=g._keys[f.readVarint()],A=g._values[f.readVarint()];g.properties[M]=A}}(u,o):c==3?o.type=u.readVarint():c==4&&(o._geometry=u.pos)}function J8(c){for(var o,u,f=0,g=0,v=c.length,M=v-1;g<v;M=g++)f+=((u=c[M]).x-(o=c[g]).x)*(o.y+u.y);return f}Wg.types=["Unknown","Point","LineString","Polygon"],Wg.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var o,u=c.readVarint()+c.pos,f=1,g=0,v=0,M=0,A=[];c.pos<u;){if(g<=0){var D=c.readVarint();f=7&D,g=D>>3}if(g--,f===1||f===2)v+=c.readSVarint(),M+=c.readSVarint(),f===1&&(o&&A.push(o),o=[]),o.push(new X8(v,M));else{if(f!==7)throw new Error("unknown command "+f);o&&o.push(o[0].clone())}}return o&&A.push(o),A},Wg.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var o=c.readVarint()+c.pos,u=1,f=0,g=0,v=0,M=1/0,A=-1/0,D=1/0,z=-1/0;c.pos<o;){if(f<=0){var W=c.readVarint();u=7&W,f=W>>3}if(f--,u===1||u===2)(g+=c.readSVarint())<M&&(M=g),g>A&&(A=g),(v+=c.readSVarint())<D&&(D=v),v>z&&(z=v);else if(u!==7)throw new Error("unknown command "+u)}return[M,D,A,z]},Wg.prototype.toGeoJSON=function(c,o,u){var f,g,v=this.extent*Math.pow(2,u),M=this.extent*c,A=this.extent*o,D=this.loadGeometry(),z=Wg.types[this.type];function W(K){for(var ie=0;ie<K.length;ie++){var he=K[ie];K[ie]=[360*(he.x+M)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(he.y+A)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(f=0;f<D.length;f++)q[f]=D[f][0];W(D=q);break;case 2:for(f=0;f<D.length;f++)W(D[f]);break;case 3:for(D=function(K){var ie=K.length;if(ie<=1)return[K];for(var he,ge,Re=[],He=0;He<ie;He++){var Le=J8(K[He]);Le!==0&&(ge===void 0&&(ge=Le<0),ge===Le<0?(he&&Re.push(he),he=[K[He]]):he.push(K[He]))}return he&&Re.push(he),Re}(D),f=0;f<D.length;f++)for(g=0;g<D[f].length;g++)W(D[f][g])}D.length===1?D=D[0]:z="Multi"+z;var X={type:"Feature",geometry:{type:z,coordinates:D},properties:this.properties};return"id"in this&&(X.id=this.id),X};var K8=d3,f3=p3;function p3(c,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Q8,this,o),this.length=this._features.length}function Q8(c,o,u){c===15?o.version=u.readVarint():c===1?o.name=u.readString():c===5?o.extent=u.readVarint():c===2?o._features.push(u.pos):c===3?o._keys.push(u.readString()):c===4&&o._values.push(function(f){for(var g=null,v=f.readVarint()+f.pos;f.pos<v;){var M=f.readVarint()>>3;g=M===1?f.readString():M===2?f.readFloat():M===3?f.readDouble():M===4?f.readVarint64():M===5?f.readVarint():M===6?f.readSVarint():M===7?f.readBoolean():null}return g}(u))}p3.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var o=this._pbf.readVarint()+this._pbf.pos;return new K8(this._pbf,o,this.extent,this._keys,this._values)};var eG=f3;function tG(c,o,u){if(c===3){var f=new eG(u,u.readVarint()+u.pos);f.length&&(o[f.name]=f)}}var ST=j1.VectorTile=function(c,o){this.layers=c.readFields(tG,{},o)},q1=j1.VectorTileFeature=d3;function Z1(c,o,u,f){const g=[],v=f===0?(M,A,D,z,W,q)=>{M.push(new j(q,D+(q-A)/(z-A)*(W-D)))}:(M,A,D,z,W,q)=>{M.push(new j(A+(q-D)/(W-D)*(z-A),q))};for(const M of c){const A=[];for(const D of M){if(D.length<=2)continue;const z=[];for(let X=0;X<D.length-1;X++){const K=D[X].x,ie=D[X].y,he=D[X+1].x,ge=D[X+1].y,Re=f===0?K:ie,He=f===0?he:ge;Re<o?He>o&&v(z,K,ie,he,ge,o):Re>u?He<u&&v(z,K,ie,he,ge,u):z.push(D[X]),He<o&&Re>=o&&v(z,K,ie,he,ge,o),He>u&&Re<=u&&v(z,K,ie,he,ge,u)}let W=D[D.length-1];const q=f===0?W.x:W.y;q>=o&&q<=u&&z.push(W),z.length&&(W=z[z.length-1],z[0].x===W.x&&z[0].y===W.y||z.push(z[0]),A.push(z))}A.length&&g.push(A)}return g}j1.VectorTileLayer=f3;const nG=q1.types,iG=Math.pow(2,13);function h0(c,o,u,f,g,v,M,A){c.emplaceBack((o<<1)+M,(u<<1)+v,(Math.floor(f*iG)<<1)+g,Math.round(A))}function d0(c,o,u){c.emplaceBack(o.x,o.y,o.z,u[0]*16384,u[1]*16384,u[2]*16384)}class m3{constructor(){this.acc=new j(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new j(o.x,o.y),this.max=new j(o.x,o.y))}append(o,u){this.currentPolyCount.edges++,this.acc._add(o);const f=this.min,g=this.max;o.x<f.x?f.x=o.x:o.x>g.x&&(g.x=o.x),o.y<f.y?f.y=o.y:o.y>g.y&&(g.y=o.y),((o.x===0||o.x===te)&&o.x===u.x)!=((o.y===0||o.y===te)&&o.y===u.y)&&this.processBorderOverlap(o,u),u.x<0!=o.x<0&&this.addBorderIntersection(0,hi(u.y,o.y,(0-u.x)/(o.x-u.x))),u.x>te!=o.x>te&&this.addBorderIntersection(1,hi(u.y,o.y,(te-u.x)/(o.x-u.x))),u.y<0!=o.y<0&&this.addBorderIntersection(2,hi(u.x,o.x,(0-u.y)/(o.y-u.y))),u.y>te!=o.y>te&&this.addBorderIntersection(3,hi(u.x,o.x,(te-u.y)/(o.y-u.y)))}addBorderIntersection(o,u){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[o];u<f[0]&&(f[0]=u),u>f[1]&&(f[1]=u)}processBorderOverlap(o,u){if(o.x===u.x){if(o.y===u.y)return;const f=o.x===0?0:1;this.addBorderIntersection(f,u.y),this.addBorderIntersection(f,o.y)}else{const f=o.y===0?2:3;this.addBorderIntersection(f,u.x),this.addBorderIntersection(f,o.x)}}centroid(){const o=this.polyCount.reduce((u,f)=>u+f.edges,0);return o!==0?this.acc.div(o)._round():new j(0,0)}span(){return new j(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,u)=>o+ +(u[0]!==Number.MAX_VALUE),0)}}class f0{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new si,this.centroidVertexArray=new A1,this.indexArray=new $i,this.programConfigurations=new rh(o.layers,o.zoom),this.segments=new Z,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.enableTerrain=o.enableTerrain}populate(o,u,f,g){this.features=[],this.hasPattern=wT("fill-extrusion",this.layers,u),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(v){const M=Math.exp(Math.PI*(1-v.y/(1<<v.z)*2));return 80150034*M/(M*M+1)/te/(1<<v.z)}(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:v,id:M,index:A,sourceLayerIndex:D}of o){const z=this.layers[0]._featureFilter.needGeometry,W=rd(v,z);if(!this.layers[0]._featureFilter.filter(new it(this.zoom),W,f))continue;const q={id:M,sourceLayerIndex:D,index:A,geometry:z?W.geometry:xo(v,f,g),properties:v.properties,type:v.type,patterns:{}},X=this.layoutVertexArray.length;this.hasPattern?this.features.push(bT("fill-extrusion",this.layers,q,this.zoom,u)):this.addFeature(q,q.geometry,A,f,{},u.availableImages,g),u.featureIndex.insert(v,q.geometry,A,D,this.index,X)}this.sortBorders()}addFeatures(o,u,f,g,v){for(const M of this.features){const{geometry:A}=M;this.addFeature(M,A,M.index,u,f,g,v)}this.sortBorders()}update(o,u,f,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,$8),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,Z8.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,q8.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,u,f,g,v,M,A){const D=[new j(0,0),new j(te,te)],z=A.projection,W=z.name==="globe",q=this.enableTerrain&&!W?new m3:null,X=nG[o.type]==="Polygon";W&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Zi);const K=vT(u,500);for(let Re=K.length-1;Re>=0;Re--){const He=K[Re];(He.length===0||(ie=He[0]).every(Le=>Le.x<=0)||ie.every(Le=>Le.x>=te)||ie.every(Le=>Le.y<=0)||ie.every(Le=>Le.y>=te))&&K.splice(Re,1)}var ie;let he;if(W)he=b3(K,D,g);else{he=[];for(const Re of K)he.push({polygon:Re,bounds:D})}const ge=X?this.edgeRadius:0;for(const{polygon:Re,bounds:He}of he){let Le=0,Ge=0;for(const je of Re)X&&!je[0].equals(je[je.length-1])&&je.push(je[0]),Ge+=X?je.length-1:je.length;const Xe=this.segments.prepareSegment((X?5:4)*Ge,this.layoutVertexArray,this.indexArray);if(X){const je=[],dt=[];Le=Xe.vertexLength;for(const Tt of Re){let Wt,yt;Tt.length&&Tt!==Re[0]&&dt.push(je.length/2),Wt=Tt[1].sub(Tt[0])._perp()._unit();for(let Pt=1;Pt<Tt.length;Pt++){const Rt=Tt[Pt],Bt=Tt[Pt===Tt.length-1?1:Pt+1];let{x:jt,y:xt}=Rt;if(ge){yt=Bt.sub(Rt)._perp()._unit();const en=Wt.add(yt)._unit(),Wn=ge*Math.min(4,1/(Wt.x*en.x+Wt.y*en.y));jt+=Wn*en.x,xt+=Wn*en.y,Wt=yt}h0(this.layoutVertexArray,jt,xt,0,0,1,1,0),Xe.vertexLength++,je.push(Rt.x,Rt.y),W&&d0(this.layoutVertexExtArray,z.projectTilePoint(jt,xt,g),z.upVector(g,jt,xt))}}const ut=o0.exports(je,dt);for(let Tt=0;Tt<ut.length;Tt+=3)this.indexArray.emplaceBack(Le+ut[Tt],Le+ut[Tt+2],Le+ut[Tt+1]),Xe.primitiveLength++}for(const je of Re){q&&je.length&&q.startRing(je[0]);let dt,ut,Tt,Wt=je.length>4&&x3(je[je.length-2],je[0],je[1]),yt=ge?rG(je[je.length-2],je[0],je[1],ge):0;ut=je[1].sub(je[0])._perp()._unit();let Pt=!0;for(let Rt=1,Bt=0;Rt<je.length;Rt++){let jt=je[Rt-1],xt=je[Rt];const en=je[Rt===je.length-1?1:Rt+1];if(q&&X&&q.currentPolyCount.top++,y3(xt,jt,He)){ge&&(ut=en.sub(xt)._perp()._unit(),Pt=!Pt);continue}q&&q.append(xt,jt);const Wn=xt.sub(jt)._perp(),un=Wn.x/(Math.abs(Wn.x)+Math.abs(Wn.y)),Tn=Wn.y>0?1:0,rn=jt.dist(xt);if(Bt+rn>32768&&(Bt=0),ge){Tt=en.sub(xt)._perp()._unit();let ui=_3(jt,xt,en,g3(ut,Tt),ge);isNaN(ui)&&(ui=0);const Xn=xt.sub(jt)._unit();jt=jt.add(Xn.mult(yt))._round(),xt=xt.add(Xn.mult(-ui))._round(),yt=ui,ut=Tt}const jn=Xe.vertexLength,mi=je.length>4&&x3(jt,xt,en);let fi=v3(Bt,Wt,Pt);if(h0(this.layoutVertexArray,jt.x,jt.y,un,Tn,0,0,fi),h0(this.layoutVertexArray,jt.x,jt.y,un,Tn,0,1,fi),Bt+=rn,fi=v3(Bt,mi,!Pt),Wt=mi,h0(this.layoutVertexArray,xt.x,xt.y,un,Tn,0,0,fi),h0(this.layoutVertexArray,xt.x,xt.y,un,Tn,0,1,fi),Xe.vertexLength+=4,this.indexArray.emplaceBack(jn+0,jn+1,jn+2),this.indexArray.emplaceBack(jn+1,jn+3,jn+2),Xe.primitiveLength+=2,ge){const ui=Le+(Rt===1?je.length-2:Rt-2),Xn=Rt===1?Le:ui+1;if(this.indexArray.emplaceBack(jn+1,ui,jn+3),this.indexArray.emplaceBack(ui,Xn,jn+3),Xe.primitiveLength+=2,dt===void 0&&(dt=jn),!y3(en,je[Rt],He)){const Yi=Rt===je.length-1?dt:Xe.vertexLength;this.indexArray.emplaceBack(jn+2,jn+3,Yi),this.indexArray.emplaceBack(jn+3,Yi+1,Yi),this.indexArray.emplaceBack(jn+3,Xn,Yi+1),Xe.primitiveLength+=3}Pt=!Pt}if(W){const ui=this.layoutVertexExtArray,Xn=z.projectTilePoint(jt.x,jt.y,g),Yi=z.projectTilePoint(xt.x,xt.y,g),ei=z.upVector(g,jt.x,jt.y),gi=z.upVector(g,xt.x,xt.y);d0(ui,Xn,ei),d0(ui,Xn,ei),d0(ui,Yi,gi),d0(ui,Yi,gi)}}X&&(Le+=je.length-1)}}if(q&&q.polyCount.length>0){if(q.borders){q.vertexArrayOffset=this.centroidVertexArray.length;const Re=q.borders,He=this.featuresOnBorder.push(q)-1;for(let Le=0;Le<4;Le++)Re[Le][0]!==Number.MAX_VALUE&&this.borders[Le].push(He)}this.encodeCentroid(q.borders?void 0:q.centroid(),q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,v,M,g)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((u,f)=>this.featuresOnBorder[u].borders[o][0]-this.featuresOnBorder[f].borders[o][0])}encodeCentroid(o,u,f=!0){let g,v;if(o)if(o.y!==0){const A=u.span()._mult(this.tileToMeter);g=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(A.x/10)),v=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(A.y/10))}else g=Math.ceil(7*(o.x+450)),v=0;else g=0,v=+f;let M=f?this.centroidVertexArray.length:u.vertexArrayOffset;for(const A of u.polyCount){f&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*A.edges+A.top);for(let D=0;D<A.top;D++)this.centroidVertexArray.emplace(M++,g,v);for(let D=0;D<2*A.edges;D++)this.centroidVertexArray.emplace(M++,0,v),this.centroidVertexArray.emplace(M++,g,v)}}}function g3(c,o){const u=c.add(o)._unit();return c.x*u.x+c.y*u.y}function rG(c,o,u,f){const g=o.sub(c)._perp()._unit(),v=u.sub(o)._perp()._unit();return _3(c,o,u,g3(g,v),f)}function _3(c,o,u,f,g){const v=Math.sqrt(1-f*f);return Math.min(c.dist(o)/3,o.dist(u)/3,g*v/f)}function y3(c,o,u){return c.x<u[0].x&&o.x<u[0].x||c.x>u[1].x&&o.x>u[1].x||c.y<u[0].y&&o.y<u[0].y||c.y>u[1].y&&o.y>u[1].y}function x3(c,o,u){if(c.x<0||c.x>=te||o.x<0||o.x>=te||u.x<0||u.x>=te)return!1;const f=u.sub(o),g=f.perp(),v=c.sub(o);return(f.x*v.x+f.y*v.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(v.x*v.x+v.y*v.y))>-.866&&g.x*v.x+g.y*v.y<0}function v3(c,o,u){const f=o?2|c:-3&c;return u?1|f:-2&f}function w3(){const c=Math.PI/32,o=Math.tan(c),u=st;return u*Math.sqrt(1+2*o*o)-u}function b3(c,o,u){const f=1<<u.z,g=In(u.x/f),v=In((u.x+1)/f),M=Hi(u.y/f),A=Hi((u.y+1)/f);return function(D,z,W,q,X=0,K){const ie=[];if(!D.length||!W||!q)return ie;const he=(je,dt)=>{for(const ut of je)ie.push({polygon:ut,bounds:dt})},ge=Math.ceil(Math.log2(W)),Re=Math.ceil(Math.log2(q)),He=ge-Re,Le=[];for(let je=0;je<Math.abs(He);je++)Le.push(He>0?0:1);for(let je=0;je<Math.min(ge,Re);je++)Le.push(0),Le.push(1);let Ge=D;if(Ge=Z1(Ge,z[0].y-X,z[1].y+X,1),Ge=Z1(Ge,z[0].x-X,z[1].x+X,0),!Ge.length)return ie;const Xe=[];for(Le.length?Xe.push({polygons:Ge,bounds:z,depth:0}):he(Ge,z);Xe.length;){const je=Xe.pop(),dt=je.depth,ut=Le[dt],Tt=je.bounds[0],Wt=je.bounds[1],yt=ut===0?Tt.x:Tt.y,Pt=ut===0?Wt.x:Wt.y,Rt=K?K(ut,yt,Pt):.5*(yt+Pt),Bt=Z1(je.polygons,yt-X,Rt+X,ut),jt=Z1(je.polygons,Rt-X,Pt+X,ut);if(Bt.length){const xt=[Tt,new j(ut===0?Rt:Wt.x,ut===1?Rt:Wt.y)];Le.length>dt+1?Xe.push({polygons:Bt,bounds:xt,depth:dt+1}):he(Bt,xt)}if(jt.length){const xt=[new j(ut===0?Rt:Tt.x,ut===1?Rt:Tt.y),Wt];Le.length>dt+1?Xe.push({polygons:jt,bounds:xt,depth:dt+1}):he(jt,xt)}}return ie}(c,o,Math.ceil((v-g)/11.25),Math.ceil((M-A)/11.25),1,(D,z,W)=>{if(D===0)return .5*(z+W);{const q=Hi((u.y+z/te)/f);return(Gn(.5*(Hi((u.y+W/te)/f)+q))*f-u.y)*te}})}dn(f0,"FillExtrusionBucket",{omit:["layers","features"]}),dn(m3,"PartMetadata");const sG=new mn({"fill-extrusion-edge-radius":new Ye(wt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var oG={paint:new mn({"fill-extrusion-opacity":new Ye(wt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new at(wt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(wt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(wt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new at(wt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new at(wt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new at(wt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(wt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ye(wt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ye(wt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:sG};function S3(c,o,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[c*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class $1{constructor(o,u,f){this.z=o,this.x=u,this.y=f,this.key=p0(0,o,o,u,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,u){const f=function(v,M,A){var D=S3(256*v,256*(M=Math.pow(2,A)-M-1),A),z=S3(256*(v+1),256*(M+1),A);return D[0]+","+D[1]+","+z[0]+","+z[1]}(this.x,this.y,this.z),g=function(v,M,A){let D,z="";for(let W=v;W>0;W--)D=1<<W-1,z+=(M&D?1:0)+(A&D?2:0);return z}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class M3{constructor(o,u){this.wrap=o,this.canonical=u,this.key=p0(o,u.z,u.z,u.x,u.y)}}class Jo{constructor(o,u,f,g,v){this.overscaledZ=o,this.wrap=u,this.canonical=new $1(f,+g,+v),this.key=u===0&&o===f?this.canonical.key:p0(u,o,f,g,v)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const u=this.canonical.z-o;return o>this.canonical.z?new Jo(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jo(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(o,u=!0){if(this.overscaledZ===o&&u)return this.key;if(o>this.canonical.z)return p0(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-o;return p0(this.wrap*+u,o,o,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u}children(o){if(this.overscaledZ>=o)return[new Jo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Jo(u,this.wrap,u,f,g),new Jo(u,this.wrap,u,f+1,g),new Jo(u,this.wrap,u,f,g+1),new Jo(u,this.wrap,u,f+1,g+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Jo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Jo(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new M3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function p0(c,o,u,f,g){const v=1<<Math.min(u,22);let M=v*(g%v)+f%v;return c&&u<22&&(M+=v*v*((c<0?-2*c-1:2*c)%(1<<2*(22-u)))),16*(32*M+u)+(o-u)}dn($1,"CanonicalTileID"),dn(Jo,"OverscaledTileID",{omit:["projMatrix"]});class Hg extends j{constructor(o,u,f){super(o,u),this.z=f}}function m0(c,o){return c.x*o.x+c.y*o.y}function T3(c,o){if(c.length===1){let u=0;const f=o[u++];let g;for(;!g||f.equals(g);)if(g=o[u++],!g)return 1/0;for(;u<o.length;u++){const v=o[u],M=c[0],A=g.sub(f),D=v.sub(f),z=M.sub(f),W=m0(A,A),q=m0(A,D),X=m0(D,D),K=m0(z,A),ie=m0(z,D),he=W*X-q*q,ge=(X*K-q*ie)/he,Re=(W*ie-q*K)/he,He=f.z*(1-ge-Re)+g.z*ge+v.z*Re;if(isFinite(He))return He}return 1/0}{let u=1/0;for(const f of o)u=Math.min(u,f.z);return u}}function E3(c,o,u,f,g,v,M,A){const D=M*g.getElevationAt(c,o,!0,!0),z=v[0]!==0,W=z?v[1]===0?M*(v[0]/7-450):M*function(q,X,K){const ie=Math.floor(X[0]/8),he=Math.floor(X[1]/8),ge=10*(X[0]-8*ie),Re=10*(X[1]-8*he),He=q.getElevationAt(ie,he,!0,!0),Le=q.getMeterToDEM(K),Ge=Math.floor(.5*(ge*Le-1)),Xe=Math.floor(.5*(Re*Le-1)),je=q.tileCoordToPixel(ie,he),dt=2*Ge+1,ut=2*Xe+1,Tt=function(jt,xt,en,Wn,un){return[jt.getElevationAtPixel(xt,en,!0),jt.getElevationAtPixel(xt+un,en,!0),jt.getElevationAtPixel(xt,en+un,!0),jt.getElevationAtPixel(xt+Wn,en+un,!0)]}(q,je.x-Ge,je.y-Xe,dt,ut),Wt=Math.abs(Tt[0]-Tt[1]),yt=Math.abs(Tt[2]-Tt[3]),Pt=Math.abs(Tt[0]-Tt[2])+Math.abs(Tt[1]-Tt[3]),Rt=Math.min(.25,.5*Le*(Wt+yt)/dt),Bt=Math.min(.25,.5*Le*Pt/ut);return He+Math.max(Rt*ge,Bt*Re)}(g,v,A):D;return{base:D+(u===0)?-1:u,top:z?Math.max(W+f,D+u+2):D+f}}const aG=an([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:lG}=aG,cG=an([{name:"a_packed",components:4,type:"Float32"}]),{members:uG}=cG,hG=q1.types,dG=Math.cos(Math.PI/180*37.5);class X1{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Ns,this.layoutVertexArray2=new Ys,this.indexArray=new $i,this.programConfigurations=new rh(o.layers,o.zoom),this.segments=new Z,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f,g){this.hasPattern=wT("line",this.layers,u);const v=this.layers[0].layout.get("line-sort-key"),M=[];for(const{feature:W,id:q,index:X,sourceLayerIndex:K}of o){const ie=this.layers[0]._featureFilter.needGeometry,he=rd(W,ie);if(!this.layers[0]._featureFilter.filter(new it(this.zoom),he,f))continue;const ge=v?v.evaluate(he,{},f):void 0,Re={id:q,properties:W.properties,type:W.type,sourceLayerIndex:K,index:X,geometry:ie?he.geometry:xo(W,f,g),patterns:{},sortKey:ge};M.push(Re)}v&&M.sort((W,q)=>W.sortKey-q.sortKey);const{lineAtlas:A,featureIndex:D}=u,z=this.addConstantDashes(A);for(const W of M){const{geometry:q,index:X,sourceLayerIndex:K}=W;if(z&&this.addFeatureDashes(W,A),this.hasPattern){const ie=bT("line",this.layers,W,this.zoom,u);this.patternFeatures.push(ie)}else this.addFeature(W,q,X,f,A.positions,u.availableImages);D.insert(o[X].feature,q,X,K,this.index)}}addConstantDashes(o){let u=!1;for(const f of this.layers){const g=f.paint.get("line-dasharray").value,v=f.layout.get("line-cap").value;if(g.kind!=="constant"||v.kind!=="constant")u=!0;else{const M=v.value,A=g.value;if(!A)continue;o.addDash(A,M)}}return u}addFeatureDashes(o,u){const f=this.zoom;for(const g of this.layers){const v=g.paint.get("line-dasharray").value,M=g.layout.get("line-cap").value;if(v.kind==="constant"&&M.kind==="constant")continue;let A,D;if(v.kind==="constant"){if(A=v.value,!A)continue}else A=v.evaluate({zoom:f},o);D=M.kind==="constant"?M.value:M.evaluate({zoom:f},o),u.addDash(A,D),o.patterns[g.id]=u.getKey(A,D)}}update(o,u,f,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,g)}addFeatures(o,u,f,g,v){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,u,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,uG)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,lG),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,u,f,g,v,M){const A=this.layers[0].layout,D=A.get("line-join").evaluate(o,{}),z=A.get("line-cap").evaluate(o,{}),W=A.get("line-miter-limit"),q=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const X of u)this.addLine(X,o,D,z,W,q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,v,M,g)}addLine(o,u,f,g,v,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Re=0;Re<o.length-1;Re++)this.totalDistance+=o[Re].dist(o[Re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=hG[u.type]==="Polygon";let D=o.length;for(;D>=2&&o[D-1].equals(o[D-2]);)D--;let z=0;for(;z<D-1&&o[z].equals(o[z+1]);)z++;if(D<(A?3:2))return;f==="bevel"&&(v=1.05);const W=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let X,K,ie,he,ge;this.e1=this.e2=-1,A&&(X=o[D-2],ge=o[z].sub(X)._unit()._perp());for(let Re=z;Re<D;Re++){if(ie=Re===D-1?A?o[z+1]:void 0:o[Re+1],ie&&o[Re].equals(ie))continue;ge&&(he=ge),X&&(K=X),X=o[Re],ge=ie?ie.sub(X)._unit()._perp():he,he=he||ge;let He=he.add(ge);He.x===0&&He.y===0||He._unit();const Le=he.x*ge.x+he.y*ge.y,Ge=He.x*ge.x+He.y*ge.y,Xe=Ge!==0?1/Ge:1/0,je=2*Math.sqrt(2-2*Ge),dt=Ge<dG&&K&&ie,ut=he.x*ge.y-he.y*ge.x>0;if(dt&&Re>z){const yt=X.dist(K);if(yt>2*W){const Pt=X.sub(X.sub(K)._mult(W/yt)._round());this.updateDistance(K,Pt),this.addCurrentVertex(Pt,he,0,0,q),K=Pt}}const Tt=K&&ie;let Wt=Tt?f:A?"butt":g;if(Tt&&Wt==="round"&&(Xe<M?Wt="miter":Xe<=2&&(Wt="fakeround")),Wt==="miter"&&Xe>v&&(Wt="bevel"),Wt==="bevel"&&(Xe>2&&(Wt="flipbevel"),Xe<v&&(Wt="miter")),K&&this.updateDistance(K,X),Wt==="miter")He._mult(Xe),this.addCurrentVertex(X,He,0,0,q);else if(Wt==="flipbevel"){if(Xe>100)He=ge.mult(-1);else{const yt=Xe*he.add(ge).mag()/he.sub(ge).mag();He._perp()._mult(yt*(ut?-1:1))}this.addCurrentVertex(X,He,0,0,q),this.addCurrentVertex(X,He.mult(-1),0,0,q)}else if(Wt==="bevel"||Wt==="fakeround"){const yt=-Math.sqrt(Xe*Xe-1),Pt=ut?yt:0,Rt=ut?0:yt;if(K&&this.addCurrentVertex(X,he,Pt,Rt,q),Wt==="fakeround"){const Bt=Math.round(180*je/Math.PI/20);for(let jt=1;jt<Bt;jt++){let xt=jt/Bt;if(xt!==.5){const Wn=xt-.5;xt+=xt*Wn*(xt-1)*((1.0904+Le*(Le*(3.55645-1.43519*Le)-3.2452))*Wn*Wn+(.848013+Le*(.215638*Le-1.06021)))}const en=ge.sub(he)._mult(xt)._add(he)._unit()._mult(ut?-1:1);this.addHalfVertex(X,en.x,en.y,!1,ut,0,q)}}ie&&this.addCurrentVertex(X,ge,-Pt,-Rt,q)}else if(Wt==="butt")this.addCurrentVertex(X,He,0,0,q);else if(Wt==="square"){const yt=K?1:-1;K||this.addCurrentVertex(X,He,yt,yt,q),this.addCurrentVertex(X,He,0,0,q),K&&this.addCurrentVertex(X,He,yt,yt,q)}else Wt==="round"&&(K&&(this.addCurrentVertex(X,he,0,0,q),this.addCurrentVertex(X,he,1,1,q,!0)),ie&&(this.addCurrentVertex(X,ge,-1,-1,q,!0),this.addCurrentVertex(X,ge,0,0,q)));if(dt&&Re<D-1){const yt=X.dist(ie);if(yt>2*W){const Pt=X.add(ie.sub(X)._mult(W/yt)._round());this.updateDistance(X,Pt),this.addCurrentVertex(Pt,ge,0,0,q),X=Pt}}}}addCurrentVertex(o,u,f,g,v,M=!1){const A=u.y*g-u.x,D=-u.y-u.x*g;this.addHalfVertex(o,u.x+u.y*f,u.y-u.x*f,M,!1,f,v),this.addHalfVertex(o,A,D,M,!0,-g,v)}addHalfVertex({x:o,y:u},f,g,v,M,A,D){this.layoutVertexArray.emplaceBack((o<<1)+(v?1:0),(u<<1)+(M?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const z=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),D.primitiveLength++),M?this.e2=z:this.e1=z}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,u){this.distance+=o.dist(u),this.updateScaledDistance()}}dn(X1,"LineBucket",{omit:["layers","patternFeatures"]});const fG=new mn({"line-cap":new at(wt.layout_line["line-cap"]),"line-join":new at(wt.layout_line["line-join"]),"line-miter-limit":new Ye(wt.layout_line["line-miter-limit"]),"line-round-limit":new Ye(wt.layout_line["line-round-limit"]),"line-sort-key":new at(wt.layout_line["line-sort-key"])});var A3={paint:new mn({"line-opacity":new at(wt.paint_line["line-opacity"]),"line-color":new at(wt.paint_line["line-color"]),"line-translate":new Ye(wt.paint_line["line-translate"]),"line-translate-anchor":new Ye(wt.paint_line["line-translate-anchor"]),"line-width":new at(wt.paint_line["line-width"]),"line-gap-width":new at(wt.paint_line["line-gap-width"]),"line-offset":new at(wt.paint_line["line-offset"]),"line-blur":new at(wt.paint_line["line-blur"]),"line-dasharray":new at(wt.paint_line["line-dasharray"]),"line-pattern":new at(wt.paint_line["line-pattern"]),"line-gradient":new Qt(wt.paint_line["line-gradient"]),"line-trim-offset":new Ye(wt.paint_line["line-trim-offset"])}),layout:fG};const C3=new class extends at{possiblyEvaluate(c,o){return o=new it(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(c,o)}evaluate(c,o,u,f){return o=Pe({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(c,o,u,f)}}(A3.paint.properties["line-width"].specification);function I3(c,o){return o>0?o+2*c:c}C3.useIntegerZoom=!0;const pG=an([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),mG=an([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),gG=an([{name:"a_projected_pos",components:4,type:"Float32"}],4);an([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const _G=an([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),yG=an([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const P3=an([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xG=an([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);an([{name:"triangle",components:3,type:"Uint16"}]),an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),an([{type:"Float32",name:"offsetX"}]),an([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var vo=24;const sh=128;function MT(c,o){const{expression:u}=o;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new it(c+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=u;let v=0;for(;v<f.length&&f[v]<=c;)v++;v=Math.max(0,v-1);let M=v;for(;M<f.length&&f[M]<c+1;)M++;M=Math.min(f.length-1,M);const A=f[v],D=f[M];return u.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:D,interpolationType:g}:{kind:"camera",minZoom:A,maxZoom:D,minSize:u.evaluate(new it(A)),maxSize:u.evaluate(new it(D)),interpolationType:g}}}function Y1(c,{uSize:o,uSizeT:u},{lowerSize:f,upperSize:g}){return c.kind==="source"?f/sh:c.kind==="composite"?hi(f/sh,g/sh,u):o}function jg(c,o){let u=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:M}=c,A=g?fe(Go.interpolationFactor(g,o,v,M),0,1):0;c.kind==="camera"?f=hi(c.minSize,c.maxSize,A):u=A}return{uSizeT:u,uSize:f}}var vG=Object.freeze({__proto__:null,getSizeData:MT,evaluateSizeForFeature:Y1,evaluateSizeForZoom:jg,SIZE_PACK_FACTOR:sh});function wG(c,o,u){return c.sections.forEach(f=>{f.text=function(g,v,M){const A=v.layout.get("text-transform").evaluate(M,{});return A==="uppercase"?g=g.toLocaleUpperCase():A==="lowercase"&&(g=g.toLocaleLowerCase()),lt.applyArabicShaping&&(g=lt.applyArabicShaping(g)),g}(f.text,o,u)}),c}const g0={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function bG(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}function SG(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}var _0=ur,k3=function(c,o,u,f,g){var v,M,A=8*g-f-1,D=(1<<A)-1,z=D>>1,W=-7,q=u?g-1:0,X=u?-1:1,K=c[o+q];for(q+=X,v=K&(1<<-W)-1,K>>=-W,W+=A;W>0;v=256*v+c[o+q],q+=X,W-=8);for(M=v&(1<<-W)-1,v>>=-W,W+=f;W>0;M=256*M+c[o+q],q+=X,W-=8);if(v===0)v=1-z;else{if(v===D)return M?NaN:1/0*(K?-1:1);M+=Math.pow(2,f),v-=z}return(K?-1:1)*M*Math.pow(2,v-f)},D3=function(c,o,u,f,g,v){var M,A,D,z=8*v-g-1,W=(1<<z)-1,q=W>>1,X=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=f?0:v-1,ie=f?1:-1,he=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(A=isNaN(o)?1:0,M=W):(M=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-M))<1&&(M--,D*=2),(o+=M+q>=1?X/D:X*Math.pow(2,1-q))*D>=2&&(M++,D/=2),M+q>=W?(A=0,M=W):M+q>=1?(A=(o*D-1)*Math.pow(2,g),M+=q):(A=o*Math.pow(2,q-1)*Math.pow(2,g),M=0));g>=8;c[u+K]=255&A,K+=ie,A/=256,g-=8);for(M=M<<g|A,z+=g;z>0;c[u+K]=255&M,K+=ie,M/=256,z-=8);c[u+K-ie]|=128*he};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ur(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}ur.Varint=0,ur.Fixed64=1,ur.Bytes=2,ur.Fixed32=5;var TT=4294967296,L3=1/TT,R3=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ad(c){return c.type===ur.Bytes?c.readVarint()+c.pos:c.pos+1}function qg(c,o,u){return u?4294967296*o+(c>>>0):4294967296*(o>>>0)+(c>>>0)}function z3(c,o,u){var f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(f);for(var g=u.pos-1;g>=c;g--)u.buf[g+f]=u.buf[g]}function MG(c,o){for(var u=0;u<c.length;u++)o.writeVarint(c[u])}function TG(c,o){for(var u=0;u<c.length;u++)o.writeSVarint(c[u])}function EG(c,o){for(var u=0;u<c.length;u++)o.writeFloat(c[u])}function AG(c,o){for(var u=0;u<c.length;u++)o.writeDouble(c[u])}function CG(c,o){for(var u=0;u<c.length;u++)o.writeBoolean(c[u])}function IG(c,o){for(var u=0;u<c.length;u++)o.writeFixed32(c[u])}function PG(c,o){for(var u=0;u<c.length;u++)o.writeSFixed32(c[u])}function kG(c,o){for(var u=0;u<c.length;u++)o.writeFixed64(c[u])}function DG(c,o){for(var u=0;u<c.length;u++)o.writeSFixed64(c[u])}function J1(c,o){return(c[o]|c[o+1]<<8|c[o+2]<<16)+16777216*c[o+3]}function Zg(c,o,u){c[u]=o,c[u+1]=o>>>8,c[u+2]=o>>>16,c[u+3]=o>>>24}function O3(c,o){return(c[o]|c[o+1]<<8|c[o+2]<<16)+(c[o+3]<<24)}function LG(c,o,u){o.glyphs=[],c===1&&u.readMessage(RG,o)}function RG(c,o,u){if(c===3){const{id:f,bitmap:g,width:v,height:M,left:A,top:D,advance:z}=u.readMessage(zG,{});o.glyphs.push({id:f,bitmap:new od({width:v+6,height:M+6},g),metrics:{width:v,height:M,left:A,top:D,advance:z}})}else c===4?o.ascender=u.readSVarint():c===5&&(o.descender=u.readSVarint())}function zG(c,o,u){c===1?o.id=u.readVarint():c===2?o.bitmap=u.readBytes():c===3?o.width=u.readVarint():c===4?o.height=u.readVarint():c===5?o.left=u.readSVarint():c===6?o.top=u.readSVarint():c===7&&(o.advance=u.readVarint())}function ET(c){let o=0,u=0;for(const M of c)o+=M.w*M.h,u=Math.max(u,M.w);c.sort((M,A)=>A.h-M.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}];let g=0,v=0;for(const M of c)for(let A=f.length-1;A>=0;A--){const D=f[A];if(!(M.w>D.w||M.h>D.h)){if(M.x=D.x,M.y=D.y,v=Math.max(v,M.y+M.h),g=Math.max(g,M.x+M.w),M.w===D.w&&M.h===D.h){const z=f.pop();A<f.length&&(f[A]=z)}else M.h===D.h?(D.x+=M.w,D.w-=M.w):M.w===D.w?(D.y+=M.h,D.h-=M.h):(f.push({x:D.x+M.w,y:D.y,w:D.w-M.w,h:M.h}),D.y+=M.h,D.h-=M.h);break}}return{w:g,h:v,fill:o/(g*v)||0}}ur.prototype={destroy:function(){this.buf=null},readFields:function(c,o,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),g=f>>3,v=this.pos;this.type=7&f,c(g,o,this),this.pos===v&&this.skip(f)}return o},readMessage:function(c,o){return this.readFields(c,o,this.readVarint()+this.pos)},readFixed32:function(){var c=J1(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=O3(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=J1(this.buf,this.pos)+J1(this.buf,this.pos+4)*TT;return this.pos+=8,c},readSFixed64:function(){var c=J1(this.buf,this.pos)+O3(this.buf,this.pos+4)*TT;return this.pos+=8,c},readFloat:function(){var c=k3(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=k3(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var o,u,f=this.buf;return o=127&(u=f[this.pos++]),u<128?o:(o|=(127&(u=f[this.pos++]))<<7,u<128?o:(o|=(127&(u=f[this.pos++]))<<14,u<128?o:(o|=(127&(u=f[this.pos++]))<<21,u<128?o:function(g,v,M){var A,D,z=M.buf;if(A=(112&(D=z[M.pos++]))>>4,D<128||(A|=(127&(D=z[M.pos++]))<<3,D<128)||(A|=(127&(D=z[M.pos++]))<<10,D<128)||(A|=(127&(D=z[M.pos++]))<<17,D<128)||(A|=(127&(D=z[M.pos++]))<<24,D<128)||(A|=(1&(D=z[M.pos++]))<<31,D<128))return qg(g,A,v);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=f[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var c=this.readVarint()+this.pos,o=this.pos;return this.pos=c,c-o>=12&&R3?function(u,f,g){return R3.decode(u.subarray(f,g))}(this.buf,o,c):function(u,f,g){for(var v="",M=f;M<g;){var A,D,z,W=u[M],q=null,X=W>239?4:W>223?3:W>191?2:1;if(M+X>g)break;X===1?W<128&&(q=W):X===2?(192&(A=u[M+1]))==128&&(q=(31&W)<<6|63&A)<=127&&(q=null):X===3?(D=u[M+2],(192&(A=u[M+1]))==128&&(192&D)==128&&((q=(15&W)<<12|(63&A)<<6|63&D)<=2047||q>=55296&&q<=57343)&&(q=null)):X===4&&(D=u[M+2],z=u[M+3],(192&(A=u[M+1]))==128&&(192&D)==128&&(192&z)==128&&((q=(15&W)<<18|(63&A)<<12|(63&D)<<6|63&z)<=65535||q>=1114112)&&(q=null)),q===null?(q=65533,X=1):q>65535&&(q-=65536,v+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),v+=String.fromCharCode(q),M+=X}return v}(this.buf,o,c)},readBytes:function(){var c=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,c);return this.pos=c,o},readPackedVarint:function(c,o){if(this.type!==ur.Bytes)return c.push(this.readVarint(o));var u=ad(this);for(c=c||[];this.pos<u;)c.push(this.readVarint(o));return c},readPackedSVarint:function(c){if(this.type!==ur.Bytes)return c.push(this.readSVarint());var o=ad(this);for(c=c||[];this.pos<o;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==ur.Bytes)return c.push(this.readBoolean());var o=ad(this);for(c=c||[];this.pos<o;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==ur.Bytes)return c.push(this.readFloat());var o=ad(this);for(c=c||[];this.pos<o;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==ur.Bytes)return c.push(this.readDouble());var o=ad(this);for(c=c||[];this.pos<o;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==ur.Bytes)return c.push(this.readFixed32());var o=ad(this);for(c=c||[];this.pos<o;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==ur.Bytes)return c.push(this.readSFixed32());var o=ad(this);for(c=c||[];this.pos<o;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==ur.Bytes)return c.push(this.readFixed64());var o=ad(this);for(c=c||[];this.pos<o;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==ur.Bytes)return c.push(this.readSFixed64());var o=ad(this);for(c=c||[];this.pos<o;)c.push(this.readSFixed64());return c},skip:function(c){var o=7&c;if(o===ur.Varint)for(;this.buf[this.pos++]>127;);else if(o===ur.Bytes)this.pos=this.readVarint()+this.pos;else if(o===ur.Fixed32)this.pos+=4;else{if(o!==ur.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(c,o){this.writeVarint(c<<3|o)},realloc:function(c){for(var o=this.length||16;o<this.pos+c;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Zg(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Zg(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Zg(this.buf,-1&c,this.pos),Zg(this.buf,Math.floor(c*L3),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Zg(this.buf,-1&c,this.pos),Zg(this.buf,Math.floor(c*L3),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(o,u){var f,g;if(o>=0?(f=o%4294967296|0,g=o/4294967296|0):(g=~(-o/4294967296),4294967295^(f=~(-o%4294967296))?f=f+1|0:(f=0,g=g+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(v,M,A){A.buf[A.pos++]=127&v|128,v>>>=7,A.buf[A.pos++]=127&v|128,v>>>=7,A.buf[A.pos++]=127&v|128,v>>>=7,A.buf[A.pos++]=127&v|128,A.buf[A.pos]=127&(v>>>=7)}(f,0,u),function(v,M){var A=(7&v)<<4;M.buf[M.pos++]|=A|((v>>>=3)?128:0),v&&(M.buf[M.pos++]=127&v|((v>>>=7)?128:0),v&&(M.buf[M.pos++]=127&v|((v>>>=7)?128:0),v&&(M.buf[M.pos++]=127&v|((v>>>=7)?128:0),v&&(M.buf[M.pos++]=127&v|((v>>>=7)?128:0),v&&(M.buf[M.pos++]=127&v)))))}(g,u)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(Boolean(c))},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var o=this.pos;this.pos=function(f,g,v){for(var M,A,D=0;D<g.length;D++){if((M=g.charCodeAt(D))>55295&&M<57344){if(!A){M>56319||D+1===g.length?(f[v++]=239,f[v++]=191,f[v++]=189):A=M;continue}if(M<56320){f[v++]=239,f[v++]=191,f[v++]=189,A=M;continue}M=A-55296<<10|M-56320|65536,A=null}else A&&(f[v++]=239,f[v++]=191,f[v++]=189,A=null);M<128?f[v++]=M:(M<2048?f[v++]=M>>6|192:(M<65536?f[v++]=M>>12|224:(f[v++]=M>>18|240,f[v++]=M>>12&63|128),f[v++]=M>>6&63|128),f[v++]=63&M|128)}return v}(this.buf,c,this.pos);var u=this.pos-o;u>=128&&z3(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(c){this.realloc(4),D3(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),D3(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var o=c.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=c[u]},writeRawMessage:function(c,o){this.pos++;var u=this.pos;c(o,this);var f=this.pos-u;f>=128&&z3(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(c,o,u){this.writeTag(c,ur.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(c,o){o.length&&this.writeMessage(c,MG,o)},writePackedSVarint:function(c,o){o.length&&this.writeMessage(c,TG,o)},writePackedBoolean:function(c,o){o.length&&this.writeMessage(c,CG,o)},writePackedFloat:function(c,o){o.length&&this.writeMessage(c,EG,o)},writePackedDouble:function(c,o){o.length&&this.writeMessage(c,AG,o)},writePackedFixed32:function(c,o){o.length&&this.writeMessage(c,IG,o)},writePackedSFixed32:function(c,o){o.length&&this.writeMessage(c,PG,o)},writePackedFixed64:function(c,o){o.length&&this.writeMessage(c,kG,o)},writePackedSFixed64:function(c,o){o.length&&this.writeMessage(c,DG,o)},writeBytesField:function(c,o){this.writeTag(c,ur.Bytes),this.writeBytes(o)},writeFixed32Field:function(c,o){this.writeTag(c,ur.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(c,o){this.writeTag(c,ur.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(c,o){this.writeTag(c,ur.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(c,o){this.writeTag(c,ur.Fixed64),this.writeSFixed64(o)},writeVarintField:function(c,o){this.writeTag(c,ur.Varint),this.writeVarint(o)},writeSVarintField:function(c,o){this.writeTag(c,ur.Varint),this.writeSVarint(o)},writeStringField:function(c,o){this.writeTag(c,ur.Bytes),this.writeString(o)},writeFloatField:function(c,o){this.writeTag(c,ur.Fixed32),this.writeFloat(o)},writeDoubleField:function(c,o){this.writeTag(c,ur.Fixed64),this.writeDouble(o)},writeBooleanField:function(c,o){this.writeVarintField(c,Boolean(o))}};class AT{constructor(o,{pixelRatio:u,version:f,stretchX:g,stretchY:v,content:M}){this.paddedRect=o,this.pixelRatio=u,this.stretchX=g,this.stretchY=v,this.content=M,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class F3{constructor(o,u){const f={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(o,f,v),this.addImages(u,g,v);const{w:M,h:A}=ET(v),D=new Va({width:M||1,height:A||1});for(const z in o){const W=o[z],q=f[z].paddedRect;Va.copy(W.data,D,{x:0,y:0},{x:q.x+1,y:q.y+1},W.data)}for(const z in u){const W=u[z],q=g[z].paddedRect,X=q.x+1,K=q.y+1,ie=W.data.width,he=W.data.height;Va.copy(W.data,D,{x:0,y:0},{x:X,y:K},W.data),Va.copy(W.data,D,{x:0,y:he-1},{x:X,y:K-1},{width:ie,height:1}),Va.copy(W.data,D,{x:0,y:0},{x:X,y:K+he},{width:ie,height:1}),Va.copy(W.data,D,{x:ie-1,y:0},{x:X-1,y:K},{width:1,height:he}),Va.copy(W.data,D,{x:0,y:0},{x:X+ie,y:K},{width:1,height:he})}this.image=D,this.iconPositions=f,this.patternPositions=g}addImages(o,u,f){for(const g in o){const v=o[g],M={x:0,y:0,w:v.data.width+2,h:v.data.height+2};f.push(M),u[g]=new AT(M,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>o.hasImage(f)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),u)}patchUpdatedImage(o,u,f){if(!o||!u||o.version===u.version)return;o.version=u.version;const[g,v]=o.tl;f.update(u.data,void 0,{x:g,y:v})}}dn(AT,"ImagePosition"),dn(F3,"ImageAtlas");const Ml={horizontal:1,vertical:2,horizontalOnly:3};class y0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,u){const f=new y0;return f.scale=o||1,f.fontStack=u,f}static forImage(o){const u=new y0;return u.imageName=o,u}}class $g{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,u){const f=new $g;for(let g=0;g<o.sections.length;g++){const v=o.sections[g];v.image?f.addImageSection(v):f.addTextSection(v,u)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(u,f){let g="";for(let v=0;v<u.length;v++){const M=u.charCodeAt(v+1)||null,A=u.charCodeAt(v-1)||null;g+=!f&&(M&&Y(M)&&!g0[u[v+1]]||A&&Y(A)&&!g0[u[v-1]])||!g0[u[v]]?u[v]:g0[u[v]]}return g}(this.text,o)}trim(){let o=0;for(let f=0;f<this.text.length&&K1[this.text.charCodeAt(f)];f++)o++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&K1[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(o,u),this.sectionIndex=this.sectionIndex.slice(o,u)}substring(o,u){const f=new $g;return f.text=this.text.substring(o,u),f.sectionIndex=this.sectionIndex.slice(o,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,u)=>Math.max(o,this.sections[u].scale),0)}addTextSection(o,u){this.text+=o.text,this.sections.push(y0.forText(o.scale,o.fontStack||u));const f=this.sections.length-1;for(let g=0;g<o.text.length;++g)this.sectionIndex.push(f)}addImageSection(o){const u=o.image?o.image.name:"";if(u.length===0)return void At("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(y0.forImage(u)),this.sectionIndex.push(this.sections.length-1)):At("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function CT(c,o,u,f,g,v,M,A,D,z,W,q,X,K,ie){const he=$g.fromFeature(c,g);q===Ml.vertical&&he.verticalizePunctuation(X);let ge=[];const Re=function(je,dt,ut,Tt,Wt,yt){if(!je)return[];const Pt=[],Rt=function(en,Wn,un,Tn,rn,jn){let mi=0;for(let fi=0;fi<en.length();fi++){const ui=en.getSection(fi);mi+=B3(en.getCharCode(fi),ui,Tn,rn,Wn,jn)}return mi/Math.max(1,Math.ceil(mi/un))}(je,dt,ut,Tt,Wt,yt),Bt=je.text.indexOf("")>=0;let jt=0;for(let en=0;en<je.length();en++){const Wn=je.getSection(en),un=je.getCharCode(en);if(K1[un]||(jt+=B3(un,Wn,Tt,Wt,dt,yt)),en<je.length()-1){const Tn=!((xt=un)<11904||!(ya(xt)||Jp(xt)||p(xt)||nd(xt)||ec(xt)||Qh(xt)||kg(xt)||vl(xt)||Lg(xt)||xn(xt)||ed(xt)||I(xt)||Ku(xt)||mf(xt)||pf(xt)||Dg(xt)||Qu(xt)||h(xt)||gf(xt)||td(xt)));(OG[un]||Tn||Wn.imageName)&&Pt.push(U3(en+1,jt,Rt,Pt,FG(un,je.getCharCode(en+1),Tn&&Bt),!1))}}var xt;return V3(U3(je.length(),jt,Rt,Pt,0,!0))}(he,z,v,o,f,K),{processBidirectionalText:He,processStyledBidirectionalText:Le}=lt;if(He&&he.sections.length===1){const je=He(he.toString(),Re);for(const dt of je){const ut=new $g;ut.text=dt,ut.sections=he.sections;for(let Tt=0;Tt<dt.length;Tt++)ut.sectionIndex.push(0);ge.push(ut)}}else if(Le){const je=Le(he.text,he.sectionIndex,Re);for(const dt of je){const ut=new $g;ut.text=dt[0],ut.sectionIndex=dt[1],ut.sections=he.sections,ge.push(ut)}}else ge=function(je,dt){const ut=[],Tt=je.text;let Wt=0;for(const yt of dt)ut.push(je.substring(Wt,yt)),Wt=yt;return Wt<Tt.length&&ut.push(je.substring(Wt,Tt.length)),ut}(he,Re);const Ge=[],Xe={positionedLines:Ge,text:he.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:q,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(je,dt,ut,Tt,Wt,yt,Pt,Rt,Bt,jt,xt,en){let Wn=0,un=0,Tn=0;const rn=Rt==="right"?1:Rt==="left"?0:.5;let jn=!1;for(const ei of Wt){const gi=ei.getSections();for(const nr of gi){if(nr.imageName)continue;const fr=dt[nr.fontStack];if(fr&&(jn=fr.ascender!==void 0&&fr.descender!==void 0,!jn))break}if(!jn)break}let mi=0;for(const ei of Wt){ei.trim();const gi=ei.getMaxScale(),nr=(gi-1)*vo,fr={positionedGlyphs:[],lineOffset:0};je.positionedLines[mi]=fr;const hr=fr.positionedGlyphs;let pr=0;if(!ei.length()){un+=yt,++mi;continue}let wr=0,Vr=0;for(let Ji=0;Ji<ei.length();Ji++){const gs=ei.getSection(Ji),rs=ei.getSectionIndex(Ji),Li=ei.getCharCode(Ji);let Ir=gs.scale,Ps=null,ir=null,Zr=null,Do=vo,Ks=0;const Qs=!(Bt===Ml.horizontal||!xt&&!J(Li)||xt&&(K1[Li]||(fi=Li,Ju(fi)||Kh(fi)||ff(fi)||y(fi)||E(fi))));if(gs.imageName){const Ko=Tt[gs.imageName];if(!Ko)continue;Zr=gs.imageName,je.iconsInText=je.iconsInText||!0,ir=Ko.paddedRect;const eo=Ko.displaySize;Ir=Ir*vo/en,Ps={width:eo[0],height:eo[1],left:1,top:-3,advance:Qs?eo[1]:eo[0],localGlyph:!1},Ks=jn?-Ps.height*Ir:gi*vo-17-eo[1]*Ir,Do=Ps.advance;const ud=(Qs?eo[0]:eo[1])*Ir-vo*gi;ud>0&&ud>pr&&(pr=ud)}else{const Ko=ut[gs.fontStack];if(!Ko)continue;Ko[Li]&&(ir=Ko[Li]);const eo=dt[gs.fontStack];if(!eo)continue;const ud=eo.glyphs[Li];if(!ud)continue;if(Ps=ud.metrics,Do=Li!==8203?vo:0,jn){const i_=eo.ascender!==void 0?Math.abs(eo.ascender):0,P0=eo.descender!==void 0?Math.abs(eo.descender):0,k0=(i_+P0)*Ir;wr<k0&&(wr=k0,Vr=(i_-P0)/2*Ir),Ks=-i_*Ir}else Ks=(gi-Ir)*vo-17}Qs?(je.verticalizable=!0,hr.push({glyph:Li,imageName:Zr,x:Wn,y:un+Ks,vertical:Qs,scale:Ir,localGlyph:Ps.localGlyph,fontStack:gs.fontStack,sectionIndex:rs,metrics:Ps,rect:ir}),Wn+=Do*Ir+jt):(hr.push({glyph:Li,imageName:Zr,x:Wn,y:un+Ks,vertical:Qs,scale:Ir,localGlyph:Ps.localGlyph,fontStack:gs.fontStack,sectionIndex:rs,metrics:Ps,rect:ir}),Wn+=Ps.advance*Ir+jt)}hr.length!==0&&(Tn=Math.max(Wn-jt,Tn),jn?G3(hr,rn,pr,Vr,yt*gi/2):G3(hr,rn,pr,0,yt/2)),Wn=0;const Js=yt*gi+pr;fr.lineOffset=Math.max(pr,nr),un+=Js,++mi}var fi;const ui=un,{horizontalAlign:Xn,verticalAlign:Yi}=IT(Pt);(function(ei,gi,nr,fr,hr,pr){const wr=(gi-nr)*hr,Vr=-pr*fr;for(const Js of ei)for(const Ji of Js.positionedGlyphs)Ji.x+=wr,Ji.y+=Vr})(je.positionedLines,rn,Xn,Yi,Tn,ui),je.top+=-Yi*ui,je.bottom=je.top+ui,je.left+=-Xn*Tn,je.right=je.left+Tn,je.hasBaseline=jn}(Xe,o,u,f,ge,M,A,D,q,z,X,ie),!function(je){for(const dt of je)if(dt.positionedGlyphs.length!==0)return!1;return!0}(Ge)&&Xe}const K1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},OG={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function B3(c,o,u,f,g,v){if(o.imageName){const M=f[o.imageName];return M?M.displaySize[0]*o.scale*vo/v+g:0}{const M=u[o.fontStack],A=M&&M.glyphs[c];return A?A.metrics.advance*o.scale+g:0}}function N3(c,o,u,f){const g=Math.pow(c-o,2);return f?c<o?g/2:2*g:g+Math.abs(u)*u}function FG(c,o,u){let f=0;return c===10&&(f-=1e4),u&&(f+=150),c!==40&&c!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function U3(c,o,u,f,g,v){let M=null,A=N3(o,u,g,v);for(const D of f){const z=N3(o-D.x,u,g,v)+D.badness;z<=A&&(M=D,A=z)}return{index:c,x:o,priorBreak:M,badness:A}}function V3(c){return c?V3(c.priorBreak).concat(c.index):[]}function IT(c){let o=.5,u=.5;switch(c){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function G3(c,o,u,f,g){if(!(o||u||f||g))return;const v=c.length-1,M=c[v],A=(M.x+M.metrics.advance*M.scale)*o;for(let D=0;D<=v;D++)c[D].x-=A,c[D].y+=u+f+g}function BG(c,o,u){const{horizontalAlign:f,verticalAlign:g}=IT(u),v=o[0]-c.displaySize[0]*f,M=o[1]-c.displaySize[1]*g;return{image:c,top:M,bottom:M+c.displaySize[1],left:v,right:v+c.displaySize[0]}}function W3(c,o,u,f,g,v){const M=c.image;let A;if(M.content){const ge=M.content,Re=M.pixelRatio||1;A=[ge[0]/Re,ge[1]/Re,M.displaySize[0]-ge[2]/Re,M.displaySize[1]-ge[3]/Re]}const D=o.left*v,z=o.right*v;let W,q,X,K;u==="width"||u==="both"?(K=g[0]+D-f[3],q=g[0]+z+f[1]):(K=g[0]+(D+z-M.displaySize[0])/2,q=K+M.displaySize[0]);const ie=o.top*v,he=o.bottom*v;return u==="height"||u==="both"?(W=g[1]+ie-f[0],X=g[1]+he+f[2]):(W=g[1]+(ie+he-M.displaySize[1])/2,X=W+M.displaySize[1]),{image:M,top:W,right:q,bottom:X,left:K,collisionPadding:A}}class ld extends j{constructor(o,u,f,g,v){super(o,u),this.angle=g,this.z=f,v!==void 0&&(this.segment=v)}clone(){return new ld(this.x,this.y,this.z,this.angle,this.segment)}}function H3(c,o,u,f,g){if(o.segment===void 0)return!0;let v=o,M=o.segment+1,A=0;for(;A>-u/2;){if(M--,M<0)return!1;A-=c[M].dist(v),v=c[M]}A+=c[M].dist(c[M+1]),M++;const D=[];let z=0;for(;A<u/2;){const W=c[M],q=c[M+1];if(!q)return!1;let X=c[M-1].angleTo(W)-W.angleTo(q);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:A,angleDelta:X}),z+=X;A-D[0].distance>f;)z-=D.shift().angleDelta;if(z>g)return!1;M++,A+=W.dist(q)}return!0}function j3(c){let o=0;for(let u=0;u<c.length-1;u++)o+=c[u].dist(c[u+1]);return o}function q3(c,o,u){return c?.6*o*u:0}function Z3(c,o){return Math.max(c?c.right-c.left:0,o?o.right-o.left:0)}function NG(c,o,u,f,g,v){const M=q3(u,g,v),A=Z3(u,f)*v;let D=0;const z=j3(c)/2;for(let W=0;W<c.length-1;W++){const q=c[W],X=c[W+1],K=q.dist(X);if(D+K>z){const ie=(z-D)/K,he=hi(q.x,X.x,ie),ge=hi(q.y,X.y,ie),Re=new ld(he,ge,0,X.angleTo(q),W);return!M||H3(c,Re,A,M,o)?Re:void 0}D+=K}}function UG(c,o,u,f,g,v,M,A,D){const z=q3(f,v,M),W=Z3(f,g),q=W*M,X=c[0].x===0||c[0].x===D||c[0].y===0||c[0].y===D;return o-q<o/4&&(o=q+o/4),$3(c,X?o/2*A%o:(W/2+2*v)*M*A%o,o,z,u,q,X,!1,D)}function $3(c,o,u,f,g,v,M,A,D){const z=v/2,W=j3(c);let q=0,X=o-u,K=[];for(let ie=0;ie<c.length-1;ie++){const he=c[ie],ge=c[ie+1],Re=he.dist(ge),He=ge.angleTo(he);for(;X+u<q+Re;){X+=u;const Le=(X-q)/Re,Ge=hi(he.x,ge.x,Le),Xe=hi(he.y,ge.y,Le);if(Ge>=0&&Ge<D&&Xe>=0&&Xe<D&&X-z>=0&&X+z<=W){const je=new ld(Ge,Xe,0,He,ie);je._round(),f&&!H3(c,je,v,f,g)||K.push(je)}}q+=Re}return A||K.length||M||(K=$3(c,q/2,u,f,g,v,M,!0,D)),K}function X3(c,o,u,f,g){const v=[];for(let M=0;M<c.length;M++){const A=c[M];let D;for(let z=0;z<A.length-1;z++){let W=A[z],q=A[z+1];W.x<o&&q.x<o||(W.x<o?W=new j(o,W.y+(o-W.x)/(q.x-W.x)*(q.y-W.y))._round():q.x<o&&(q=new j(o,W.y+(o-W.x)/(q.x-W.x)*(q.y-W.y))._round()),W.y<u&&q.y<u||(W.y<u?W=new j(W.x+(u-W.y)/(q.y-W.y)*(q.x-W.x),u)._round():q.y<u&&(q=new j(W.x+(u-W.y)/(q.y-W.y)*(q.x-W.x),u)._round()),W.x>=f&&q.x>=f||(W.x>=f?W=new j(f,W.y+(f-W.x)/(q.x-W.x)*(q.y-W.y))._round():q.x>=f&&(q=new j(f,W.y+(f-W.x)/(q.x-W.x)*(q.y-W.y))._round()),W.y>=g&&q.y>=g||(W.y>=g?W=new j(W.x+(g-W.y)/(q.y-W.y)*(q.x-W.x),g)._round():q.y>=g&&(q=new j(W.x+(g-W.y)/(q.y-W.y)*(q.x-W.x),g)._round()),D&&W.equals(D[D.length-1])||(D=[W],v.push(D)),D.push(q)))))}}return v}dn(ld,"Anchor");const x0=1e20;function Y3(c,o,u,f,g,v,M,A,D){for(let z=o;z<o+f;z++)J3(c,u*v+z,v,g,M,A,D);for(let z=u;z<u+g;z++)J3(c,z*v+o,1,f,M,A,D)}function J3(c,o,u,f,g,v,M){v[0]=0,M[0]=-x0,M[1]=x0,g[0]=c[o];for(let A=1,D=0,z=0;A<f;A++){g[A]=c[o+A*u];const W=A*A;do{const q=v[D];z=(g[A]-g[q]+W-q*q)/(A-q)/2}while(z<=M[D]&&--D>-1);D++,v[D]=A,M[D]=z,M[D+1]=x0}for(let A=0,D=0;A<f;A++){for(;M[D+1]<A;)D++;const z=v[D],W=A-z;c[o+A*u]=g[z]+W*W}}const PT={none:0,ideographs:1,all:2};class Xg{constructor(o,u,f){this.requestManager=o,this.localGlyphMode=u,this.localFontFamily=f,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,u){const f=[];for(const g in o)for(const v of o[g])f.push({stack:g,id:v});ce(f,({stack:g,id:v},M)=>{let A=this.entries[g];A||(A=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=A.glyphs[v];if(D!==void 0)return void M(null,{stack:g,id:v,glyph:D});if(D=this._tinySDF(A,g,v),D)return A.glyphs[v]=D,void M(null,{stack:g,id:v,glyph:D});const z=Math.floor(v/256);if(256*z>65535)return void M(new Error("glyphs > 65535 not supported"));if(A.ranges[z])return void M(null,{stack:g,id:v,glyph:D});let W=A.requests[z];W||(W=A.requests[z]=[],Xg.loadGlyphRange(g,z,this.url,this.requestManager,(q,X)=>{if(X){A.ascender=X.ascender,A.descender=X.descender;for(const K in X.glyphs)this._doesCharSupportLocalGlyph(+K)||(A.glyphs[+K]=X.glyphs[+K]);A.ranges[z]=!0}for(const K of W)K(q,X);delete A.requests[z]})),W.push((q,X)=>{q?M(q):X&&M(null,{stack:g,id:v,glyph:X.glyphs[v]||null})})},(g,v)=>{if(g)u(g);else if(v){const M={};for(const{stack:A,id:D,glyph:z}of v)M[A]===void 0&&(M[A]={}),M[A].glyphs===void 0&&(M[A].glyphs={}),M[A].glyphs[D]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics},M[A].ascender=this.entries[A].ascender,M[A].descender=this.entries[A].descender;u(null,M)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==PT.none&&(this.localGlyphMode===PT.all?!!this.localFontFamily:!!this.localFontFamily&&(xn(o)||_f(o)||Ku(o)||Qu(o)||vl(o)))}_tinySDF(o,u,f){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(f))return;let v=o.tinySDF;if(!v){let he="400";/bold/i.test(u)?he="900":/medium/i.test(u)?he="500":/light/i.test(u)&&(he="200"),v=o.tinySDF=new Xg.TinySDF({fontFamily:g,fontWeight:he,fontSize:48,buffer:6,radius:16}),v.fontWeight=he}if(this.localGlyphs[v.fontWeight][f])return this.localGlyphs[v.fontWeight][f];const M=String.fromCharCode(f),{data:A,width:D,height:z,glyphWidth:W,glyphHeight:q,glyphLeft:X,glyphTop:K,glyphAdvance:ie}=v.draw(M);return this.localGlyphs[v.fontWeight][f]={id:f,bitmap:new od({width:D,height:z},A),metrics:{width:W/2,height:q/2,left:X/2,top:K/2-27,advance:ie/2,localGlyph:!0}}}}function K3(c,o,u,f){const g=[],v=c.image,M=v.pixelRatio,A=v.paddedRect.w-2,D=v.paddedRect.h-2,z=c.right-c.left,W=c.bottom-c.top,q=v.stretchX||[[0,A]],X=v.stretchY||[[0,D]],K=(yt,Pt)=>yt+Pt[1]-Pt[0],ie=q.reduce(K,0),he=X.reduce(K,0),ge=A-ie,Re=D-he;let He=0,Le=ie,Ge=0,Xe=he,je=0,dt=ge,ut=0,Tt=Re;if(v.content&&f){const yt=v.content;He=Q1(q,0,yt[0]),Ge=Q1(X,0,yt[1]),Le=Q1(q,yt[0],yt[2]),Xe=Q1(X,yt[1],yt[3]),je=yt[0]-He,ut=yt[1]-Ge,dt=yt[2]-yt[0]-Le,Tt=yt[3]-yt[1]-Xe}const Wt=(yt,Pt,Rt,Bt)=>{const jt=ew(yt.stretch-He,Le,z,c.left),xt=tw(yt.fixed-je,dt,yt.stretch,ie),en=ew(Pt.stretch-Ge,Xe,W,c.top),Wn=tw(Pt.fixed-ut,Tt,Pt.stretch,he),un=ew(Rt.stretch-He,Le,z,c.left),Tn=tw(Rt.fixed-je,dt,Rt.stretch,ie),rn=ew(Bt.stretch-Ge,Xe,W,c.top),jn=tw(Bt.fixed-ut,Tt,Bt.stretch,he),mi=new j(jt,en),fi=new j(un,en),ui=new j(un,rn),Xn=new j(jt,rn),Yi=new j(xt/M,Wn/M),ei=new j(Tn/M,jn/M),gi=o*Math.PI/180;if(gi){const hr=Math.sin(gi),pr=Math.cos(gi),wr=[pr,-hr,hr,pr];mi._matMult(wr),fi._matMult(wr),Xn._matMult(wr),ui._matMult(wr)}const nr=yt.stretch+yt.fixed,fr=Pt.stretch+Pt.fixed;return{tl:mi,tr:fi,bl:Xn,br:ui,tex:{x:v.paddedRect.x+1+nr,y:v.paddedRect.y+1+fr,w:Rt.stretch+Rt.fixed-nr,h:Bt.stretch+Bt.fixed-fr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yi,pixelOffsetBR:ei,minFontScaleX:dt/M/z,minFontScaleY:Tt/M/W,isSDF:u}};if(f&&(v.stretchX||v.stretchY)){const yt=Q3(q,ge,ie),Pt=Q3(X,Re,he);for(let Rt=0;Rt<yt.length-1;Rt++){const Bt=yt[Rt],jt=yt[Rt+1];for(let xt=0;xt<Pt.length-1;xt++)g.push(Wt(Bt,Pt[xt],jt,Pt[xt+1]))}}else g.push(Wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:D+1}));return g}function Q1(c,o,u){let f=0;for(const g of c)f+=Math.max(o,Math.min(u,g[1]))-Math.max(o,Math.min(u,g[0]));return f}function Q3(c,o,u){const f=[{fixed:-1,stretch:0}];for(const[g,v]of c){const M=f[f.length-1];f.push({fixed:g-M.stretch,stretch:M.stretch}),f.push({fixed:g-M.stretch,stretch:M.stretch+(v-g)})}return f.push({fixed:o+1,stretch:u}),f}function ew(c,o,u,f){return c/o*u+f}function tw(c,o,u,f){return c-o*u/f}function VG(c,o,u,f){const g=o+c.positionedLines[f].lineOffset;return f===0?u+g/2:u+(g+(o+c.positionedLines[f-1].lineOffset))/2}Xg.loadGlyphRange=function(c,o,u,f,g){const v=256*o,M=v+255,A=f.transformRequest(f.normalizeGlyphsURL(u).replace("{fontstack}",c).replace("{range}",`${v}-${M}`),Lt.Glyphs);Zt(A,(D,z)=>{if(D)g(D);else if(z){const W={},q=function(X){return new _0(X).readFields(LG,{})}(z);for(const X of q.glyphs)W[X.id]=X;g(null,{glyphs:W,ascender:q.ascender,descender:q.descender})}})},Xg.TinySDF=class{constructor({fontSize:c=24,buffer:o=3,radius:u=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:v="normal",fontStyle:M="normal"}={}){this.buffer=o,this.cutoff=f,this.radius=u;const A=this.size=c+4*o,D=this._createCanvas(A),z=this.ctx=D.getContext("2d",{willReadFrequently:!0});z.font=`${M} ${v} ${c}px ${g}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(c){const o=document.createElement("canvas");return o.width=o.height=c,o}draw(c){const{width:o,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:g,actualBoundingBoxRight:v}=this.ctx.measureText(c),M=Math.ceil(u),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-g))),D=Math.min(this.size-this.buffer,M+Math.ceil(f)),z=A+2*this.buffer,W=D+2*this.buffer,q=Math.max(z*W,0),X=new Uint8ClampedArray(q),K={data:X,width:z,height:W,glyphWidth:A,glyphHeight:D,glyphTop:M,glyphLeft:0,glyphAdvance:o};if(A===0||D===0)return K;const{ctx:ie,buffer:he,gridInner:ge,gridOuter:Re}=this;ie.clearRect(he,he,A,D),ie.fillText(c,he,he+M);const He=ie.getImageData(he,he,A,D);Re.fill(x0,0,q),ge.fill(0,0,q);for(let Le=0;Le<D;Le++)for(let Ge=0;Ge<A;Ge++){const Xe=He.data[4*(Le*A+Ge)+3]/255;if(Xe===0)continue;const je=(Le+he)*z+Ge+he;if(Xe===1)Re[je]=0,ge[je]=x0;else{const dt=.5-Xe;Re[je]=dt>0?dt*dt:0,ge[je]=dt<0?dt*dt:0}}Y3(Re,0,0,z,W,z,this.f,this.v,this.z),Y3(ge,he,he,A,D,z,this.f,this.v,this.z);for(let Le=0;Le<q;Le++){const Ge=Math.sqrt(Re[Le])-Math.sqrt(ge[Le]);X[Le]=Math.round(255-255*(Ge/this.radius+this.cutoff))}return K}};class GG{constructor(o=[],u=WG){if(this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:u,compare:f}=this,g=u[o];for(;o>0;){const v=o-1>>1,M=u[v];if(f(g,M)>=0)break;u[o]=M,o=v}u[o]=g}_down(o){const{data:u,compare:f}=this,g=this.length>>1,v=u[o];for(;o<g;){let M=1+(o<<1),A=u[M];const D=M+1;if(D<this.length&&f(u[D],A)<0&&(M=D,A=u[D]),f(A,v)>=0)break;u[o]=A,o=M}u[o]=v}}function WG(c,o){return c<o?-1:c>o?1:0}function HG(c,o=1,u=!1){let f=1/0,g=1/0,v=-1/0,M=-1/0;const A=c[0];for(let K=0;K<A.length;K++){const ie=A[K];(!K||ie.x<f)&&(f=ie.x),(!K||ie.y<g)&&(g=ie.y),(!K||ie.x>v)&&(v=ie.x),(!K||ie.y>M)&&(M=ie.y)}const D=Math.min(v-f,M-g);let z=D/2;const W=new GG([],jG);if(D===0)return new j(f,g);for(let K=f;K<v;K+=D)for(let ie=g;ie<M;ie+=D)W.push(new Yg(K+z,ie+z,z,c));let q=function(K){let ie=0,he=0,ge=0;const Re=K[0];for(let He=0,Le=Re.length,Ge=Le-1;He<Le;Ge=He++){const Xe=Re[He],je=Re[Ge],dt=Xe.x*je.y-je.x*Xe.y;he+=(Xe.x+je.x)*dt,ge+=(Xe.y+je.y)*dt,ie+=3*dt}return new Yg(he/ie,ge/ie,0,K)}(c),X=W.length;for(;W.length;){const K=W.pop();(K.d>q.d||!q.d)&&(q=K,u&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,X)),K.max-q.d<=o||(z=K.h/2,W.push(new Yg(K.p.x-z,K.p.y-z,z,c)),W.push(new Yg(K.p.x+z,K.p.y-z,z,c)),W.push(new Yg(K.p.x-z,K.p.y+z,z,c)),W.push(new Yg(K.p.x+z,K.p.y+z,z,c)),X+=4)}return u&&(console.log(`num probes: ${X}`),console.log(`best distance: ${q.d}`)),q.p}function jG(c,o){return o.max-c.max}function Yg(c,o,u,f){this.p=new j(c,o),this.h=u,this.d=function(g,v){let M=!1,A=1/0;for(let D=0;D<v.length;D++){const z=v[D];for(let W=0,q=z.length,X=q-1;W<q;X=W++){const K=z[W],ie=z[X];K.y>g.y!=ie.y>g.y&&g.x<(ie.x-K.x)*(g.y-K.y)/(ie.y-K.y)+K.x&&(M=!M),A=Math.min(A,Bk(g,K,ie))}}return(M?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const kT=Number.POSITIVE_INFINITY,qG=Math.sqrt(2);function eD(c,[o,u]){let f=0,g=0;if(u===kT){o<0&&(o=0);const v=o/qG;switch(c){case"top-right":case"top-left":g=v-7;break;case"bottom-right":case"bottom-left":g=7-v;break;case"bottom":g=7-o;break;case"top":g=o-7}switch(c){case"top-right":case"bottom-right":f=-v;break;case"top-left":case"bottom-left":f=v;break;case"left":f=o;break;case"right":f=-o}}else{switch(o=Math.abs(o),u=Math.abs(u),c){case"top-right":case"top-left":case"top":g=u-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-u}switch(c){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}}return[f,g]}function ZG(c,o,u,f,g,v,M,A,D,z){c.createArrays(),c.tilePixelRatio=te/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const W=c.layers[0].layout,q=c.layers[0]._unevaluatedLayout._values,X={};if(c.textSizeData.kind==="composite"){const{minZoom:he,maxZoom:ge}=c.textSizeData;X.compositeTextSizes=[q["text-size"].possiblyEvaluate(new it(he),A),q["text-size"].possiblyEvaluate(new it(ge),A)]}if(c.iconSizeData.kind==="composite"){const{minZoom:he,maxZoom:ge}=c.iconSizeData;X.compositeIconSizes=[q["icon-size"].possiblyEvaluate(new it(he),A),q["icon-size"].possiblyEvaluate(new it(ge),A)]}X.layoutTextSize=q["text-size"].possiblyEvaluate(new it(D+1),A),X.layoutIconSize=q["icon-size"].possiblyEvaluate(new it(D+1),A),X.textMaxSize=q["text-size"].possiblyEvaluate(new it(18),A);const K=W.get("text-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",ie=W.get("text-size");for(const he of c.features){const ge=W.get("text-font").evaluate(he,{},A).join(","),Re=ie.evaluate(he,{},A),He=X.layoutTextSize.evaluate(he,{},A),Le=(X.layoutIconSize.evaluate(he,{},A),{horizontal:{},vertical:void 0}),Ge=he.text;let Xe,je=[0,0];if(Ge){const Tt=Ge.toString(),Wt=W.get("text-letter-spacing").evaluate(he,{},A)*vo,yt=W.get("text-line-height").evaluate(he,{},A)*vo,Pt=U(Tt)?Wt:0,Rt=W.get("text-anchor").evaluate(he,{},A),Bt=W.get("text-variable-anchor");if(!Bt){const un=W.get("text-radial-offset").evaluate(he,{},A);je=un?eD(Rt,[un*vo,kT]):W.get("text-offset").evaluate(he,{},A).map(Tn=>Tn*vo)}let jt=K?"center":W.get("text-justify").evaluate(he,{},A);const xt=W.get("symbol-placement")==="point",en=xt?W.get("text-max-width").evaluate(he,{},A)*vo:1/0,Wn=un=>{c.allowVerticalPlacement&&B(Tt)&&(Le.vertical=CT(Ge,o,u,g,ge,en,yt,Rt,un,Pt,je,Ml.vertical,!0,He,Re))};if(!K&&Bt){const un=jt==="auto"?Bt.map(rn=>DT(rn)):[jt];let Tn=!1;for(let rn=0;rn<un.length;rn++){const jn=un[rn];if(!Le.horizontal[jn])if(Tn)Le.horizontal[jn]=Le.horizontal[0];else{const mi=CT(Ge,o,u,g,ge,en,yt,"center",jn,Pt,je,Ml.horizontal,!1,He,Re);mi&&(Le.horizontal[jn]=mi,Tn=mi.positionedLines.length===1)}}Wn("left")}else{if(jt==="auto"&&(jt=DT(Rt)),xt||W.get("text-writing-mode").indexOf("horizontal")>=0||!B(Tt)){const un=CT(Ge,o,u,g,ge,en,yt,Rt,jt,Pt,je,Ml.horizontal,!1,He,Re);un&&(Le.horizontal[jt]=un)}Wn(xt?"left":jt)}}let dt=!1;if(he.icon&&he.icon.name){const Tt=f[he.icon.name];Tt&&(Xe=BG(g[he.icon.name],W.get("icon-offset").evaluate(he,{},A),W.get("icon-anchor").evaluate(he,{},A)),dt=Tt.sdf,c.sdfIcons===void 0?c.sdfIcons=Tt.sdf:c.sdfIcons!==Tt.sdf&&At("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Tt.pixelRatio!==c.pixelRatio||W.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const ut=nD(Le.horizontal)||Le.vertical;c.iconsInText||(c.iconsInText=!!ut&&ut.iconsInText),(ut||Xe)&&$G(c,he,Le,Xe,f,X,He,0,je,dt,M,A,z)}v&&c.generateCollisionDebugBuffers(D,c.collisionBoxArray)}function DT(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $G(c,o,u,f,g,v,M,A,D,z,W,q,X){let K=v.textMaxSize.evaluate(o,{},q);K===void 0&&(K=M);const ie=c.layers[0].layout,he=ie.get("icon-offset").evaluate(o,{},q),ge=nD(u.horizontal)||u.vertical,Re=X.name==="globe",He=M/24,Le=c.tilePixelRatio*K/24,Ge=(Pt=c.overscaling,c.zoom>18&&Pt>2&&(Pt>>=1),Math.max(te/(512*Pt),1)*ie.get("symbol-spacing")),Xe=ie.get("text-padding")*c.tilePixelRatio,je=ie.get("icon-padding")*c.tilePixelRatio,dt=ne(ie.get("text-max-angle")),ut=ie.get("text-rotation-alignment")==="map"&&ie.get("symbol-placement")!=="point",Tt=ie.get("icon-rotation-alignment")==="map"&&ie.get("symbol-placement")!=="point",Wt=ie.get("symbol-placement"),yt=Ge/2;var Pt;const Rt=ie.get("icon-text-fit");let Bt;f&&Rt!=="none"&&(c.allowVerticalPlacement&&u.vertical&&(Bt=W3(f,u.vertical,Rt,ie.get("icon-text-fit-padding"),he,He)),ge&&(f=W3(f,ge,Rt,ie.get("icon-text-fit-padding"),he,He)));const jt=(xt,en,Wn)=>{if(en.x<0||en.x>=te||en.y<0||en.y>=te)return;let un=null;if(Re){const{x:Tn,y:rn,z:jn}=X.projectTilePoint(en.x,en.y,Wn);un={anchor:new ld(Tn,rn,jn,0,void 0),up:X.upVector(Wn,en.x,en.y)}}(function(Tn,rn,jn,mi,fi,ui,Xn,Yi,ei,gi,nr,fr,hr,pr,wr,Vr,Js,Ji,gs,rs,Li,Ir,Ps,ir,Zr){const Do=Tn.addToLineVertexArray(rn,mi);let Ks,Qs,Ko,eo,ud,i_,P0,k0=0,UD=0,VD=0,GD=0,XT=-1,YT=-1;const uh={};let WD=Na.exports("");const lm=jn?jn.anchor:rn;let JT=0,KT=0;if(ei._unevaluatedLayout.getValue("text-radial-offset")===void 0?[JT,KT]=ei.layout.get("text-offset").evaluate(Li,{},Zr).map(Ga=>Ga*vo):(JT=ei.layout.get("text-radial-offset").evaluate(Li,{},Zr)*vo,KT=kT),Tn.allowVerticalPlacement&&fi.vertical){const Ga=fi.vertical;if(wr)i_=LT(Ga),Yi&&(P0=LT(Yi));else{const Wa=ei.layout.get("text-rotate").evaluate(Li,{},Zr)+90;Ko=nw(gi,lm,rn,nr,fr,hr,Ga,pr,Wa,Vr),Yi&&(eo=nw(gi,lm,rn,nr,fr,hr,Yi,Ji,Wa))}}if(ui){const Ga=ei.layout.get("icon-rotate").evaluate(Li,{},Zr),Wa=ei.layout.get("icon-text-fit")!=="none",D0=K3(ui,Ga,Ps,Wa),e2=Yi?K3(Yi,Ga,Ps,Wa):void 0;Qs=nw(gi,lm,rn,nr,fr,hr,ui,Ji,Ga),k0=4*D0.length;const HD=Tn.iconSizeData;let cm=null;HD.kind==="source"?(cm=[sh*ei.layout.get("icon-size").evaluate(Li,{},Zr)],cm[0]>xf&&At(`${Tn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):HD.kind==="composite"&&(cm=[sh*Ir.compositeIconSizes[0].evaluate(Li,{},Zr),sh*Ir.compositeIconSizes[1].evaluate(Li,{},Zr)],(cm[0]>xf||cm[1]>xf)&&At(`${Tn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Tn.addSymbols(Tn.icon,D0,cm,rs,gs,Li,!1,jn,rn,Do.lineStartIndex,Do.lineLength,-1,ir,Zr),XT=Tn.icon.placedSymbolArray.length-1,e2&&(UD=4*e2.length,Tn.addSymbols(Tn.icon,e2,cm,rs,gs,Li,Ml.vertical,jn,rn,Do.lineStartIndex,Do.lineLength,-1,ir,Zr),YT=Tn.icon.placedSymbolArray.length-1)}for(const Ga in fi.horizontal){const Wa=fi.horizontal[Ga];Ks||(WD=Na.exports(Wa.text),wr?ud=LT(Wa):Ks=nw(gi,lm,rn,nr,fr,hr,Wa,pr,ei.layout.get("text-rotate").evaluate(Li,{},Zr),Vr));const D0=Wa.positionedLines.length===1;if(VD+=tD(Tn,jn,rn,Wa,Xn,ei,wr,Li,Vr,Do,fi.vertical?Ml.horizontal:Ml.horizontalOnly,D0?Object.keys(fi.horizontal):[Ga],uh,XT,Ir,ir,Zr),D0)break}fi.vertical&&(GD+=tD(Tn,jn,rn,fi.vertical,Xn,ei,wr,Li,Vr,Do,Ml.vertical,["vertical"],uh,YT,Ir,ir,Zr));let Tf=-1;const QT=(Ga,Wa)=>Ga?Math.max(Ga,Wa):Wa;Tf=QT(ud,Tf),Tf=QT(i_,Tf),Tf=QT(P0,Tf);const EW=Tf>-1?1:0;Tn.glyphOffsetArray.length>=wf.MAX_GLYPHS&&At("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Li.sortKey!==void 0&&Tn.addToSortKeyRanges(Tn.symbolInstances.length,Li.sortKey),Tn.symbolInstances.emplaceBack(lm.x,lm.y,lm.z,rn.x,rn.y,uh.right>=0?uh.right:-1,uh.center>=0?uh.center:-1,uh.left>=0?uh.left:-1,uh.vertical>=0?uh.vertical:-1,XT,YT,WD,Ks!==void 0?Ks:Tn.collisionBoxArray.length,Ks!==void 0?Ks+1:Tn.collisionBoxArray.length,Ko!==void 0?Ko:Tn.collisionBoxArray.length,Ko!==void 0?Ko+1:Tn.collisionBoxArray.length,Qs!==void 0?Qs:Tn.collisionBoxArray.length,Qs!==void 0?Qs+1:Tn.collisionBoxArray.length,eo||Tn.collisionBoxArray.length,eo?eo+1:Tn.collisionBoxArray.length,nr,VD,GD,k0,UD,EW,0,JT,KT,Tf)})(c,en,un,xt,u,f,g,Bt,c.layers[0],c.collisionBoxArray,o.index,o.sourceLayerIndex,c.index,Xe,ut,D,0,je,Tt,he,o,v,z,W,q)};if(Wt==="line")for(const xt of X3(o.geometry,0,0,te,te)){const en=UG(xt,Ge,dt,u.vertical||ge,f,24,Le,c.overscaling,te);for(const Wn of en){const un=ge;un&&XG(c,un.text,yt,Wn)||jt(xt,Wn,q)}}else if(Wt==="line-center"){for(const xt of o.geometry)if(xt.length>1){const en=NG(xt,dt,u.vertical||ge,f,24,Le);en&&jt(xt,en,q)}}else if(o.type==="Polygon")for(const xt of vT(o.geometry,0)){const en=HG(xt,16);jt(xt[0],new ld(en.x,en.y,0,0,void 0),q)}else if(o.type==="LineString")for(const xt of o.geometry)jt(xt,new ld(xt[0].x,xt[0].y,0,0,void 0),q);else if(o.type==="Point")for(const xt of o.geometry)for(const en of xt)jt([en],new ld(en.x,en.y,0,0,void 0),q)}const xf=32640;function tD(c,o,u,f,g,v,M,A,D,z,W,q,X,K,ie,he,ge){const Re=function(Ge,Xe,je,dt,ut,Tt,Wt,yt){const Pt=[];if(Xe.positionedLines.length===0)return Pt;const Rt=dt.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,Bt=function(un){const Tn=un[0],rn=un[1],jn=Tn*rn;return jn>0?[Tn,-rn]:jn<0?[-Tn,rn]:Tn===0?[rn,Tn]:[rn,-Tn]}(je);let jt=Math.abs(Xe.top-Xe.bottom);for(const un of Xe.positionedLines)jt-=un.lineOffset;const xt=Xe.positionedLines.length,en=jt/xt;let Wn=Xe.top-je[1];for(let un=0;un<xt;++un){const Tn=Xe.positionedLines[un];Wn=VG(Xe,en,Wn,un);for(const rn of Tn.positionedGlyphs){if(!rn.rect)continue;const jn=rn.rect||{};let mi=4,fi=!0,ui=1,Xn=0;if(rn.imageName){const ir=Wt[rn.imageName];if(!ir)continue;if(ir.sdf){At("SDF images are not supported in formatted text and will be ignored.");continue}fi=!1,ui=ir.pixelRatio,mi=1/ui}const Yi=(ut||yt)&&rn.vertical,ei=rn.metrics.advance*rn.scale/2,gi=rn.metrics,nr=rn.rect;if(nr===null)continue;yt&&Xe.verticalizable&&(Xn=rn.imageName?ei-rn.metrics.width*rn.scale/2:0);const fr=ut?[rn.x+ei,rn.y]:[0,0];let hr=[0,0],pr=[0,0],wr=!1;ut||(Yi?(pr=[rn.x+ei+Bt[0],rn.y+Bt[1]-Xn],wr=!0):hr=[rn.x+ei+je[0],rn.y+je[1]-Xn]);const Vr=nr.w*rn.scale/(ui*(rn.localGlyph?2:1)),Js=nr.h*rn.scale/(ui*(rn.localGlyph?2:1));let Ji,gs,rs,Li;if(Yi){const ir=rn.y-Wn,Zr=new j(-ei,ei-ir),Do=-Math.PI/2,Ks=new j(...pr);Ji=new j(-ei+hr[0],hr[1]),Ji._rotateAround(Do,Zr)._add(Ks),Ji.x+=-ir+ei,Ji.y-=(gi.left-mi)*rn.scale;const Qs=rn.imageName?gi.advance*rn.scale:vo*rn.scale,Ko=String.fromCharCode(rn.glyph);bG(Ko)?Ji.x+=(1-mi)*rn.scale:SG(Ko)?Ji.x+=Qs-gi.height*rn.scale+(-mi-1)*rn.scale:Ji.x+=rn.imageName||gi.width+2*mi===nr.w&&gi.height+2*mi===nr.h?(Qs-Js)/2:(Qs-(gi.height+2*mi)*rn.scale)/2,gs=new j(Ji.x,Ji.y-Vr),rs=new j(Ji.x+Js,Ji.y),Li=new j(Ji.x+Js,Ji.y-Vr)}else{const ir=(gi.left-mi)*rn.scale-ei+hr[0],Zr=(-gi.top-mi)*rn.scale+hr[1],Do=ir+Vr,Ks=Zr+Js;Ji=new j(ir,Zr),gs=new j(Do,Zr),rs=new j(ir,Ks),Li=new j(Do,Ks)}if(Rt){let ir;ir=ut?new j(0,0):wr?new j(Bt[0],Bt[1]):new j(je[0],je[1]),Ji._rotateAround(Rt,ir),gs._rotateAround(Rt,ir),rs._rotateAround(Rt,ir),Li._rotateAround(Rt,ir)}const Ir=new j(0,0),Ps=new j(0,0);Pt.push({tl:Ji,tr:gs,bl:rs,br:Li,tex:jn,writingMode:Xe.writingMode,glyphOffset:fr,sectionIndex:rn.sectionIndex,isSDF:fi,pixelOffsetTL:Ir,pixelOffsetBR:Ps,minFontScaleX:0,minFontScaleY:0})}}return Pt}(0,f,D,v,M,A,g,c.allowVerticalPlacement),He=c.textSizeData;let Le=null;He.kind==="source"?(Le=[sh*v.layout.get("text-size").evaluate(A,{},ge)],Le[0]>xf&&At(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):He.kind==="composite"&&(Le=[sh*ie.compositeTextSizes[0].evaluate(A,{},ge),sh*ie.compositeTextSizes[1].evaluate(A,{},ge)],(Le[0]>xf||Le[1]>xf)&&At(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,Re,Le,D,M,A,W,o,u,z.lineStartIndex,z.lineLength,K,he,ge);for(const Ge of q)X[Ge]=c.text.placedSymbolArray.length-1;return 4*Re.length}function nD(c){for(const o in c)return c[o];return null}function nw(c,o,u,f,g,v,M,A,D,z){let W=M.top,q=M.bottom,X=M.left,K=M.right;const ie=M.collisionPadding;if(ie&&(X-=ie[0],W-=ie[1],K+=ie[2],q+=ie[3]),D){const he=new j(X,W),ge=new j(K,W),Re=new j(X,q),He=new j(K,q),Le=ne(D);let Ge=new j(0,0);z&&(Ge=new j(z[0],z[1])),he._rotateAround(Le,Ge),ge._rotateAround(Le,Ge),Re._rotateAround(Le,Ge),He._rotateAround(Le,Ge),X=Math.min(he.x,ge.x,Re.x,He.x),K=Math.max(he.x,ge.x,Re.x,He.x),W=Math.min(he.y,ge.y,Re.y,He.y),q=Math.max(he.y,ge.y,Re.y,He.y)}return c.emplaceBack(o.x,o.y,o.z,u.x,u.y,X,W,K,q,A,f,g,v),c.length-1}function LT(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const o=c.bottom-c.top;return o>0?Math.max(10,o):null}function XG(c,o,u,f){const g=c.compareText;if(o in g){const v=g[o];for(let M=v.length-1;M>=0;M--)if(f.dist(v[M])<u)return!0}else g[o]=[];return g[o].push(f),!1}const YG=an([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:iD}=YG,rD=an([{name:"a_pos_3",components:3,type:"Int16"}]);var v0=an([{name:"a_pos",type:"Int16",components:2}]);const cd=te/Math.PI/2,RT=2*Ci(1,0)*cd*Math.PI,Jg=64,Kg=[Jg,32,16],rc=-cd,sc=cd,JG=[new Yo([rc,rc,rc],[sc,sc,sc]),new Yo([rc,rc,rc],[0,0,sc]),new Yo([0,rc,rc],[sc,0,sc]),new Yo([rc,0,rc],[0,sc,sc]),new Yo([0,0,rc],[sc,sc,sc])];function sD(c,o,u,f=!0){const g=Sl([],c._camera.position,c.worldSize),v=[o,u,1,1];im(v,v,c.pixelMatrixInverse),Yk(v,v,1/v[3]);const M=Xo([],au([],v,g)),A=c.globeMatrix,D=[A[12],A[13],A[14]],z=au([],D,g),W=t0(z),q=Xo([],z),X=c.worldSize/(2*Math.PI),K=ic(q,M),ie=Math.asin(X/W);if(ie<Math.acos(K)){if(!f)return null;const Wt=[],yt=[];Sl(Wt,M,W/K),Xo(yt,au(yt,Wt,z)),Xo(M,sd(M,z,Sl(M,yt,Math.tan(ie)*W)))}const he=[];new dT(g,M).closestPointOnSphere(D,X,he);const ge=Xo([],ai(A,0)),Re=Xo([],ai(A,1)),He=Xo([],ai(A,2)),Le=ic(ge,he),Ge=ic(Re,he),Xe=ic(He,he),je=ue(Math.asin(-Ge/X));let dt=ue(Math.atan2(Le,Xe));dt=c.center.lng+function(Wt,yt){const Pt=(yt-Wt+180)%360-180;return Pt<-180?Pt+360:Pt}(c.center.lng,dt);const ut=Qn(dt),Tt=fe(Gn(je),0,1);return new Mt(ut,Tt)}class KG{constructor(o,u,f){this.a=au([],o,f),this.b=au([],u,f),this.center=f;const g=Xo([],this.a),v=Xo([],this.b);this.angle=Math.acos(ic(g,v))}}function zT(c,o){if(c.angle===0)return null;let u;return u=c.a[o]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[o]/c.a[o]/Math.sin(c.angle)-1/Math.tan(c.angle)),u<0||u>1?null:function(f,g,v,M){const A=Math.sin(v);return f*(Math.sin((1-M)*v)/A)+g*(Math.sin(M*v)/A)}(c.a[o],c.b[o],c.angle,fe(u,0,1))+c.center[o]}function oh(c){if(c.z<=1)return JG[c.z+2*c.y+c.x];const o=OT(iw(c));return Yo.fromPoints(o)}function sm(c,o,u){return Sl(c,c,1-u),r0(c,c,o,u)}function oD(c,o){const u=e_(o.zoom);if(u===0)return oh(c);const f=iw(c),g=OT(f),v=Qn(f.getWest())*o.worldSize,M=Qn(f.getEast())*o.worldSize,A=Gn(f.getNorth())*o.worldSize,D=Gn(f.getSouth())*o.worldSize,z=[v,A,0],W=[M,A,0],q=[v,D,0],X=[M,D,0],K=aT([],o.globeMatrix);return qr(z,z,K),qr(W,W,K),qr(q,q,K),qr(X,X,K),g[0]=sm(g[0],q,u),g[1]=sm(g[1],X,u),g[2]=sm(g[2],W,u),g[3]=sm(g[3],z,u),Yo.fromPoints(g)}function aD(c,o,u){for(const f of c)qr(f,f,o),Sl(f,f,u)}function QG(c,o,u){const f=o/c.worldSize,g=c.globeMatrix;if(u.z<=1){const ut=oh(u).getCorners();return aD(ut,g,f),Yo.fromPoints(ut)}const v=iw(u),M=OT(v);aD(M,g,f);const A=Number.MAX_VALUE,D=[-A,-A,-A],z=[A,A,A];if(v.contains(c.center)){for(const Wt of M)n0(z,z,Wt),i0(D,D,Wt);D[2]=0;const ut=c.point,Tt=[ut.x*f,ut.y*f,0];return n0(z,z,Tt),i0(D,D,Tt),new Yo(z,D)}const W=[g[12]*f,g[13]*f,g[14]*f],q=v.getCenter(),X=fe(c.center.lat,-85.051129,_t),K=fe(q.lat,-85.051129,_t),ie=Qn(c.center.lng),he=Gn(X);let ge=ie-Qn(q.lng);const Re=he-Gn(K);ge>.5?ge-=1:ge<-.5&&(ge+=1);let He=0;Math.abs(ge)>Math.abs(Re)?He=ge>=0?1:3:(He=Re>=0?0:2,r0(W,W,[g[4]*f,g[5]*f,g[6]*f],-Math.sin(ne(Re>=0?v.getSouth():v.getNorth()))*cd));const Le=M[He],Ge=M[(He+1)%4],Xe=new KG(Le,Ge,W),je=[zT(Xe,0)||Le[0],zT(Xe,1)||Le[1],zT(Xe,2)||Le[2]],dt=e_(c.zoom);if(dt>0){const ut=function({x:Wt,y:yt,z:Pt},Rt,Bt,jt,xt){const en=1/(1<<Pt);let Wn=Wt*en,un=Wn+en,Tn=yt*en,rn=Tn+en,jn=0;const mi=(Wn+un)/2-jt;return mi>.5?jn=-1:mi<-.5&&(jn=1),Wn=((Wn+jn)*Rt-(jt*=Rt))*Bt+jt,un=((un+jn)*Rt-jt)*Bt+jt,Tn=(Tn*Rt-(xt*=Rt))*Bt+xt,rn=(rn*Rt-xt)*Bt+xt,[[Wn,rn,0],[un,rn,0],[un,Tn,0],[Wn,Tn,0]]}(u,o,c._pixelsPerMercatorPixel,ie,he);for(let Wt=0;Wt<M.length;Wt++)sm(M[Wt],ut[Wt],dt);const Tt=sd([],ut[He],ut[(He+1)%4]);Sl(Tt,Tt,.5),sm(je,Tt,dt)}for(const ut of M)n0(z,z,ut),i0(D,D,ut);return z[2]=Math.min(Le[2],Ge[2]),n0(z,z,je),i0(D,D,je),new Yo(z,D)}function iw({x:c,y:o,z:u}){const f=1/(1<<u),g=new pt(In(c*f),Hi((o+1)*f)),v=new pt(In((c+1)*f),Hi(o*f));return new Ve(g,v)}function OT(c){const o=ne(c.getNorth()),u=ne(c.getSouth()),f=Math.cos(o),g=Math.cos(u),v=Math.sin(o),M=Math.sin(u),A=c.getWest(),D=c.getEast();return[Qg(g,M,A),Qg(g,M,D),Qg(f,v,D),Qg(f,v,A)]}function Qg(c,o,u,f=cd){return u=ne(u),[c*Math.sin(u)*f,-o*f,c*Math.cos(u)*f]}function w0(c,o,u){return Qg(Math.cos(ne(c)),Math.sin(ne(c)),o,u)}function b0(c,o,u,f){const g=1<<u.z,v=(c/te+u.x)/g;return w0(Hi((o/te+u.y)/g),In(v),f)}function rw({min:c,max:o}){return 16383/Math.max(o[0]-c[0],o[1]-c[1],o[2]-c[2])}const lD=new Float64Array(16);function S0(c){const o=rw(c),u=jk(lD,[o,o,o]);return e0(u,u,((f=[])[0]=-(g=c.min)[0],f[1]=-g[1],f[2]=-g[2],f));var f,g}function FT(c){const o=(f=c.min,(u=lD)[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=f[0],u[13]=f[1],u[14]=f[2],u[15]=1,u);var u,f;const g=1/rw(c);return nm(o,o,[g,g,g])}function cD(c,o,u,f,g){const v=function(D){const z=te/(2*Math.PI);return D/(2*Math.PI)/z}(u),M=[c,o,-u/(2*Math.PI)],A=ou(new Float64Array(16));return e0(A,A,M),nm(A,A,[v,v,v]),lT(A,A,ne(-g)),N1(A,A,ne(-f)),A}function e_(c){return Oe(5,6,c)}function uD(c,o){const u=w0(o.lat,o.lng),f=function(ie){const he=w0(ie._center.lat,ie._center.lng);let ge=hT([],Vg(0,1,0),he);const Re=qk([],-ie.angle,he);ge=qr(ge,ge,Re),qk(Re,-ie._pitch,ge);const He=Xo([],he);return Sl(He,He,ie.cameraToCenterDistance/ie.pixelsPerMeter*RT),qr(He,He,Re),sd([],he,He)}(c);return M=(g=uT([],f,u))[0],A=g[1],D=g[2],z=(v=u)[0],W=v[1],q=v[2],K=(X=Math.sqrt(M*M+A*A+D*D)*Math.sqrt(z*z+W*W+q*q))&&ic(g,v)/X,Math.acos(Math.min(Math.max(K,-1),1));var g,v,M,A,D,z,W,q,X,K}function BT(c,o){return uD(c,o)>Math.PI/2*1.01}const hD=ne(85),eW=Math.cos(hD),tW=Math.sin(hD);function dD(c,o){const u=c.fovAboveCenter,f=c.elevation?c.elevation.getMinElevationBelowMSL()*o:0,g=(c._camera.position[2]*c.worldSize-f)/Math.cos(c._pitch),v=Math.sin(u)*g/Math.sin(Math.max(Math.PI/2-c._pitch-u,.01)),M=Math.sin(c._pitch)*v+g;return Math.min(1.01*M,g*(1/c._horizonShift))}function om(c,o){if(!o.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:o};const u=Math.pow(2,-c.z),f=c.x*u,g=(c.x+1)*u,v=c.y*u,M=(c.y+1)*u,A=In(f),D=In(g),z=Hi(v),W=Hi(M),q=o.project(A,z),X=o.project(D,z),K=o.project(D,W),ie=o.project(A,W);let he=Math.min(q.x,X.x,K.x,ie.x),ge=Math.min(q.y,X.y,K.y,ie.y),Re=Math.max(q.x,X.x,K.x,ie.x),He=Math.max(q.y,X.y,K.y,ie.y);const Le=u/16;function Ge(je,dt,ut,Tt,Wt,yt){const Pt=(ut+Wt)/2,Rt=(Tt+yt)/2,Bt=o.project(In(Pt),Hi(Rt)),jt=Math.max(0,he-Bt.x,ge-Bt.y,Bt.x-Re,Bt.y-He);he=Math.min(he,Bt.x),Re=Math.max(Re,Bt.x),ge=Math.min(ge,Bt.y),He=Math.max(He,Bt.y),jt>Le&&(Ge(je,Bt,ut,Tt,Pt,Rt),Ge(Bt,dt,Pt,Rt,Wt,yt))}Ge(q,X,f,v,g,v),Ge(X,K,g,v,g,M),Ge(K,ie,g,M,f,M),Ge(ie,q,f,M,f,v),he-=Le,ge-=Le,Re+=Le,He+=Le;const Xe=1/Math.max(Re-he,He-ge);return{scale:Xe,x:he*Xe,y:ge*Xe,x2:Re*Xe,y2:He*Xe,projection:o}}const nW=ou(new Float32Array(16));class vf{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,u){return{x:0,y:0,z:0}}unproject(o,u){return new pt(0,0)}projectTilePoint(o,u,f){return{x:o,y:u,z:0}}locationPoint(o,u,f=!0){return o._coordinatePoint(o.locationCoordinate(u),f)}pixelsPerMeter(o,u){return Ci(1,o)*u}pixelSpaceConversion(o,u,f){return 1}farthestPixelDistance(o){return dD(o,o.pixelsPerMeter)}pointCoordinate(o,u,f,g){const v=o.horizonLineFromTop(!1),M=new j(u,Math.max(v,f));return o.rayIntersectionCoordinate(o.pointRayIntersection(M,g))}pointCoordinate3D(o,u,f){const g=new j(u,f);if(o.elevation)return o.elevation.pointCoordinate(g);{const v=this.pointCoordinate(o,g.x,g.y,0);return[v.x,v.y,v.z]}}isPointAboveHorizon(o,u){if(o.elevation)return!this.pointCoordinate3D(o,u.x,u.y);const f=o.horizonLineFromTop();return u.y<f}createInversionMatrix(o,u){return nW}createTileMatrix(o,u,f){let g,v,M;const A=f.canonical,D=ou(new Float64Array(16));if(this.isReprojectedInTileSpace){const z=om(A,this);g=1,v=z.x+f.wrap*z.scale,M=z.y,nm(D,D,[g/z.scale,g/z.scale,o.pixelsPerMeter/u])}else g=u/o.zoomScale(A.z),v=(A.x+Math.pow(2,A.z)*f.wrap)*g,M=A.y*g;return e0(D,D,[v,M,0]),nm(D,D,[g/te,g/te,1]),D}upVector(o,u,f){return[0,0,1]}upVectorScale(o,u,f){return{metersToTile:1}}}class iW extends vf{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[u,f]=this.parallels=o.parallels||[29.5,45.5],g=Math.sin(ne(u));this.n=(g+Math.sin(ne(f)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(o,u){const{n:f,c:g,r0:v}=this,M=ne(o-this.center[0]),A=ne(u),D=Math.sqrt(g-2*f*Math.sin(A))/f;return{x:D*Math.sin(M*f),y:D*Math.cos(M*f)-v,z:0}}unproject(o,u){const{n:f,c:g,r0:v}=this,M=v+u;let A=Math.atan2(o,Math.abs(M))*Math.sign(M);M*f<0&&(A-=Math.PI*Math.sign(o)*Math.sign(M));const D=ne(this.center[0])*f;A=We(A,-Math.PI-D,Math.PI-D);const z=fe(ue(A/f)+this.center[0],-180,180),W=Math.asin(fe((g-(o*o+M*M)*f*f)/(2*f),-1,1)),q=fe(ue(W),-85.051129,_t);return new pt(z,q)}}const M0=1.340264,T0=-.081106,E0=893e-6,A0=.003796,sw=Math.sqrt(3)/2;class rW extends vf{project(o,u){u=u/180*Math.PI,o=o/180*Math.PI;const f=Math.asin(sw*Math.sin(u)),g=f*f,v=g*g*g;return{x:.5*(o*Math.cos(f)/(sw*(M0+3*T0*g+v*(7*E0+9*A0*g)))/Math.PI+.5),y:1-.5*(f*(M0+T0*g+v*(E0+A0*g))/Math.PI+1),z:0}}unproject(o,u){o=(2*o-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,g=f*f,v=g*g*g;for(let W,q,X,K=0;K<12&&(q=f*(M0+T0*g+v*(E0+A0*g))-u,X=M0+3*T0*g+v*(7*E0+9*A0*g),W=q/X,f=fe(f-W,-Math.PI/3,Math.PI/3),g=f*f,v=g*g*g,!(Math.abs(W)<1e-12));++K);const M=sw*o*(M0+3*T0*g+v*(7*E0+9*A0*g))/Math.cos(f),A=Math.asin(Math.sin(f)/sw),D=fe(180*M/Math.PI,-180,180),z=fe(180*A/Math.PI,-85.051129,_t);return new pt(D,z)}}class sW extends vf{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,u){return{x:.5+o/360,y:.5-u/360,z:0}}unproject(o,u){const f=360*(o-.5),g=fe(360*(.5-u),-85.051129,_t);return new pt(f,g)}}const t_=Math.PI/2;function ow(c){return Math.tan((t_+c)/2)}class oW extends vf{constructor(o){super(o),this.center=o.center||[0,30];const[u,f]=this.parallels=o.parallels||[30,30];let g=ne(u),v=ne(f);this.southernCenter=g+v<0,this.southernCenter&&(g=-g,v=-v);const M=Math.cos(g),A=ow(g);this.n=g===v?Math.sin(g):Math.log(M/Math.cos(v))/Math.log(ow(v)/A),this.f=M*Math.pow(ow(g),this.n)/this.n}project(o,u){u=ne(u),this.southernCenter&&(u=-u),o=ne(o-this.center[0]);const f=1e-6,{n:g,f:v}=this;v>0?u<-t_+f&&(u=-t_+f):u>t_-f&&(u=t_-f);const M=v/Math.pow(ow(u),g);let A=M*Math.sin(g*o),D=v-M*Math.cos(g*o);return A=.5*(A/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:A,y:this.southernCenter?D:1-D,z:0}}unproject(o,u){o=(2*o-.5)*Math.PI,this.southernCenter&&(u=1-u),u=(2*(1-u)-.5)*Math.PI;const{n:f,f:g}=this,v=g-u,M=Math.sign(v),A=Math.sign(f)*Math.sqrt(o*o+v*v);let D=Math.atan2(o,Math.abs(v))*M;v*f<0&&(D-=Math.PI*Math.sign(o)*M);const z=fe(ue(D/f)+this.center[0],-180,180),W=fe(ue(2*Math.atan(Math.pow(g/A,1/f))-t_),-85.051129,_t);return new pt(z,this.southernCenter?-W:W)}}class fD extends vf{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,u){return{x:Qn(o),y:Gn(u),z:0}}unproject(o,u){const f=In(o),g=Hi(u);return new pt(f,g)}}const pD=ne(_t);class aW extends vf{project(o,u){const f=(u=ne(u))*u,g=f*f;return{x:.5*((o=ne(o))*(.8707-.131979*f+g*(g*(.003971*f-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(u*(1.007226+f*(.015085+g*(.028874*f-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(o,u){o=(2*o-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,g=25,v=0,M=f*f;do{M=f*f;const z=M*M;v=(f*(1.007226+M*(.015085+z*(.028874*M-.044475-.005916*z)))-u)/(1.007226+M*(.045255+z*(.259866*M-.311325-.005916*11*z))),f=fe(f-v,-pD,pD)}while(Math.abs(v)>1e-6&&--g>0);M=f*f;const A=fe(ue(o/(.8707+M*(M*(M*M*M*(.003971-.001529*M)-.013791)-.131979))),-180,180),D=ue(f);return new pt(A,D)}}const mD=ne(_t);class lW extends vf{project(o,u){u=ne(u),o=ne(o);const f=Math.cos(u),g=2/Math.PI,v=Math.acos(f*Math.cos(o/2)),M=Math.sin(v)/v,A=.5*(o*g+2*f*Math.sin(o/2)/M)||0,D=.5*(u+Math.sin(u)/M)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(o,u){let f=o=(2*o-.5)*Math.PI,g=u=(2*(1-u)-1)*Math.PI,v=25;const M=1e-6;let A=0,D=0;do{const z=Math.cos(g),W=Math.sin(g),q=2*W*z,X=W*W,K=z*z,ie=Math.cos(f/2),he=Math.sin(f/2),ge=2*ie*he,Re=he*he,He=1-K*ie*ie,Le=He?1/He:0,Ge=He?Math.acos(z*ie)*Math.sqrt(1/He):0,Xe=.5*(2*Ge*z*he+2*f/Math.PI)-o,je=.5*(Ge*W+g)-u,dt=.5*Le*(K*Re+Ge*z*ie*X)+1/Math.PI,ut=Le*(ge*q/4-Ge*W*he),Tt=.125*Le*(q*he-Ge*W*K*ge),Wt=.5*Le*(X*ie+Ge*Re*z)+.5,yt=ut*Tt-Wt*dt;A=(je*ut-Xe*Wt)/yt,D=(Xe*Tt-je*dt)/yt,f=fe(f-A,-Math.PI,Math.PI),g=fe(g-D,-mD,mD)}while((Math.abs(A)>M||Math.abs(D)>M)&&--v>0);return new pt(ue(f),ue(g))}}class gD extends vf{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ne(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,u){const{scale:f,cosPhi:g}=this;return{x:ne(o)*g*f+.5,y:-Math.sin(ne(u))/g*f+.5,z:0}}unproject(o,u){const{scale:f,cosPhi:g}=this,v=-(u-.5)/f,M=fe(ue((o-.5)/f)/g,-180,180),A=Math.asin(fe(v*g,-1,1)),D=fe(ue(A),-85.051129,_t);return new pt(M,D)}}class cW extends fD{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(o,u,f){const g=b0(o,u,f);return qr(g,g,S0(oh(f))),{x:g[0],y:g[1],z:g[2]}}locationPoint(o,u){const f=w0(u.lat,u.lng),g=Xo([],f),v=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(u),o._centerAltitude):o._centerAltitude;r0(f,f,g,Ci(1,0)*te*v);const M=ou(new Float64Array(16));return tm(M,o.pixelMatrix,o.globeMatrix),qr(f,f,M),new j(f[0],f[1])}pixelsPerMeter(o,u){return Ci(1,0)*u}pixelSpaceConversion(o,u,f){const g=Ci(1,o)*u,v=hi(Ci(1,45)*u,g,f);return this.pixelsPerMeter(o,u)/v}createTileMatrix(o,u,f){const g=FT(oh(f.canonical));return tm(new Float64Array(16),o.globeMatrix,g)}createInversionMatrix(o,u){const{center:f}=o,g=S0(oh(u));return N1(g,g,ne(f.lng)),lT(g,g,ne(f.lat)),nm(g,g,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(o,u,f,g){return sD(o,u,f,!0)||new Mt(0,0)}pointCoordinate3D(o,u,f){const g=this.pointCoordinate(o,u,f,0);return[g.x,g.y,g.z]}isPointAboveHorizon(o,u){return!sD(o,u.x,u.y,!1)}farthestPixelDistance(o){const u=function(g,v){const M=g.cameraToCenterDistance,A=g._centerAltitude*v,D=g._camera,z=g._camera.forward(),W=sd([],Sl([],z,-M),[0,0,A]),q=g.worldSize/(2*Math.PI),X=[0,0,-q],K=g.width/g.height,ie=Math.tan(g.fovAboveCenter),he=Sl([],D.up(),ie),ge=Sl([],D.right(),ie*K),Re=Xo([],sd([],sd([],z,he),ge)),He=[];let Le;if(new dT(W,Re).closestPointOnSphere(X,q,He)){const Ge=sd([],He,X),Xe=au([],Ge,W);Le=Math.cos(g.fovAboveCenter)*t0(Xe)}else{const Ge=au([],W,X),Xe=au([],X,W);Xo(Xe,Xe);const je=t0(Ge)-q;Le=Math.sqrt(je*(je+2*q));const dt=Math.acos(Le/(q+je))-Math.acos(ic(z,Xe));Le*=Math.cos(dt)}return 1.01*Le}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),f=e_(o.zoom);if(f>0){const g=dD(o,Ci(1,o.center.lat)*o.worldSize),v=o.worldSize/(2*Math.PI),M=Math.max(o.width,o.height)/o.worldSize*Math.PI;return hi(u,g+v*(1-Math.cos(M)),Math.pow(f,10))}return u}upVector(o,u,f){return b0(u,f,o,1)}upVectorScale(o){return{metersToTile:RT*rw(oh(o))}}}function _D(c){const o=c.parallels,u=!!o&&Math.abs(o[0]+o[1])<.01;switch(c.name){case"mercator":return new fD(c);case"equirectangular":return new sW(c);case"naturalEarth":return new aW(c);case"equalEarth":return new rW(c);case"winkelTripel":return new lW(c);case"albers":return u?new gD(c):new iW(c);case"lambertConformalConic":return u?new gD(c):new oW(c);case"globe":return new cW(c)}throw new Error(`Invalid projection name: ${c.name}`)}const uW=q1.types,hW=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function aw(c,o,u,f,g,v,M,A,D,z,W,q,X){const K=A?Math.min(xf,Math.round(A[0])):0,ie=A?Math.min(xf,Math.round(A[1])):0;c.emplaceBack(o,u,Math.round(32*f),Math.round(32*g),v,M,(K<<1)+(D?1:0),ie,16*z,16*W,256*q,256*X)}function lw(c,o,u,f,g,v,M){c.emplaceBack(o,u,f,g,v,M)}function cw(c,o,u,f,g){c.emplaceBack(o,u,f,g),c.emplaceBack(o,u,f,g),c.emplaceBack(o,u,f,g),c.emplaceBack(o,u,f,g)}function dW(c){for(const o of c.sections)if(be(o.text))return!0;return!1}class NT{constructor(o){this.layoutVertexArray=new Si,this.indexArray=new $i,this.programConfigurations=o,this.segments=new Z,this.dynamicLayoutVertexArray=new Ys,this.opacityVertexArray=new tr,this.placedSymbolArray=new Og,this.globeExtVertexArray=new yi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,u,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,pG.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,gG.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,hW,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,mG.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}dn(NT,"SymbolBuffers");class UT{constructor(o,u,f){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Z,this.collisionVertexArray=new tc,this.collisionVertexArrayExt=new qo}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,_G.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,yG.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}dn(UT,"CollisionBuffers");class wf{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(M=>M.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ou([]),this.placementViewportMatrix=ou([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=MT(this.zoom,u["text-size"]),this.iconSizeData=MT(this.zoom,u["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(M=>Ml[M]),this.stateDependentLayerIds=this.layers.filter(M=>M.isStateDependent()).map(M=>M.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new NT(new rh(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new NT(new rh(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new $y,this.lineVertexArray=new Fg,this.symbolInstances=new Zy}calculateGlyphDependencies(o,u,f,g,v){for(let M=0;M<o.length;M++)if(u[o.charCodeAt(M)]=!0,g&&v){const A=g0[o.charAt(M)];A&&(u[A.charCodeAt(0)]=!0)}}populate(o,u,f,g){const v=this.layers[0],M=v.layout,A=this.projection.name==="globe",D=M.get("text-font"),z=M.get("text-field"),W=M.get("icon-image"),q=(z.value.kind!=="constant"||z.value.value instanceof Qr&&!z.value.value.isEmpty()||z.value.value.toString().length>0)&&(D.value.kind!=="constant"||D.value.value.length>0),X=W.value.kind!=="constant"||!!W.value.value||Object.keys(W.parameters).length>0,K=M.get("symbol-sort-key");if(this.features=[],!q&&!X)return;const ie=u.iconDependencies,he=u.glyphDependencies,ge=u.availableImages,Re=new it(this.zoom);for(const{feature:He,id:Le,index:Ge,sourceLayerIndex:Xe}of o){const je=v._featureFilter.needGeometry,dt=rd(He,je);if(!v._featureFilter.filter(Re,dt,f))continue;if(je||(dt.geometry=xo(He,f,g)),A&&He.type!==1&&f.z<=5){const yt=dt.geometry,Pt=.98078528056,Rt=(Bt,jt)=>ic(b0(Bt.x,Bt.y,f,1),b0(jt.x,jt.y,f,1))<Pt;for(let Bt=0;Bt<yt.length;Bt++)yt[Bt]=di(yt[Bt],Rt)}let ut,Tt;if(q){const yt=v.getValueAndResolveTokens("text-field",dt,f,ge),Pt=Qr.factory(yt);dW(Pt)&&(this.hasRTLText=!0),(!this.hasRTLText||tt()==="unavailable"||this.hasRTLText&&lt.isParsed())&&(ut=wG(Pt,v,dt))}if(X){const yt=v.getValueAndResolveTokens("icon-image",dt,f,ge);Tt=yt instanceof To?yt:To.fromString(yt)}if(!ut&&!Tt)continue;const Wt=this.sortFeaturesByKey?K.evaluate(dt,{},f):void 0;if(this.features.push({id:Le,text:ut,icon:Tt,index:Ge,sourceLayerIndex:Xe,geometry:dt.geometry,properties:He.properties,type:uW[He.type],sortKey:Wt}),Tt&&(ie[Tt.name]=!0),ut){const yt=D.evaluate(dt,{},f).join(","),Pt=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ml.vertical)>=0;for(const Rt of ut.sections)if(Rt.image)ie[Rt.image.name]=!0;else{const Bt=B(ut.toString()),jt=Rt.fontStack||yt,xt=he[jt]=he[jt]||{};this.calculateGlyphDependencies(Rt.text,xt,Pt,this.allowVerticalPlacement,Bt)}}}M.get("symbol-placement")==="line"&&(this.features=function(He){const Le={},Ge={},Xe=[];let je=0;function dt(yt){Xe.push(He[yt]),je++}function ut(yt,Pt,Rt){const Bt=Ge[yt];return delete Ge[yt],Ge[Pt]=Bt,Xe[Bt].geometry[0].pop(),Xe[Bt].geometry[0]=Xe[Bt].geometry[0].concat(Rt[0]),Bt}function Tt(yt,Pt,Rt){const Bt=Le[Pt];return delete Le[Pt],Le[yt]=Bt,Xe[Bt].geometry[0].shift(),Xe[Bt].geometry[0]=Rt[0].concat(Xe[Bt].geometry[0]),Bt}function Wt(yt,Pt,Rt){const Bt=Rt?Pt[0][Pt[0].length-1]:Pt[0][0];return`${yt}:${Bt.x}:${Bt.y}`}for(let yt=0;yt<He.length;yt++){const Pt=He[yt],Rt=Pt.geometry,Bt=Pt.text?Pt.text.toString():null;if(!Bt){dt(yt);continue}const jt=Wt(Bt,Rt),xt=Wt(Bt,Rt,!0);if(jt in Ge&&xt in Le&&Ge[jt]!==Le[xt]){const en=Tt(jt,xt,Rt),Wn=ut(jt,xt,Xe[en].geometry);delete Le[jt],delete Ge[xt],Ge[Wt(Bt,Xe[Wn].geometry,!0)]=Wn,Xe[en].geometry=null}else jt in Ge?ut(jt,xt,Rt):xt in Le?Tt(jt,xt,Rt):(dt(yt),Le[jt]=je-1,Ge[xt]=je-1)}return Xe.filter(yt=>yt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((He,Le)=>He.sortKey-Le.sortKey)}update(o,u,f,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,f,g),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,f,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_D(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,u){const f=this.lineVertexArray.length;if(o.segment!==void 0)for(const{x:g,y:v}of u)this.lineVertexArray.emplaceBack(g,v);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,u,f,g,v,M,A,D,z,W,q,X,K,ie){const he=o.indexArray,ge=o.layoutVertexArray,Re=o.globeExtVertexArray,He=o.segments.prepareSegment(4*u.length,ge,he,this.canOverlap?M.sortKey:void 0),Le=this.glyphOffsetArray.length,Ge=He.vertexLength,Xe=this.allowVerticalPlacement&&A===Ml.vertical?Math.PI/2:0,je=M.text&&M.text.sections;for(let ut=0;ut<u.length;ut++){const{tl:Tt,tr:Wt,bl:yt,br:Pt,tex:Rt,pixelOffsetTL:Bt,pixelOffsetBR:jt,minFontScaleX:xt,minFontScaleY:en,glyphOffset:Wn,isSDF:un,sectionIndex:Tn}=u[ut],rn=He.vertexLength,jn=Wn[1];if(aw(ge,z.x,z.y,Tt.x,jn+Tt.y,Rt.x,Rt.y,f,un,Bt.x,Bt.y,xt,en),aw(ge,z.x,z.y,Wt.x,jn+Wt.y,Rt.x+Rt.w,Rt.y,f,un,jt.x,Bt.y,xt,en),aw(ge,z.x,z.y,yt.x,jn+yt.y,Rt.x,Rt.y+Rt.h,f,un,Bt.x,jt.y,xt,en),aw(ge,z.x,z.y,Pt.x,jn+Pt.y,Rt.x+Rt.w,Rt.y+Rt.h,f,un,jt.x,jt.y,xt,en),D){const{x:mi,y:fi,z:ui}=D.anchor,[Xn,Yi,ei]=D.up;lw(Re,mi,fi,ui,Xn,Yi,ei),lw(Re,mi,fi,ui,Xn,Yi,ei),lw(Re,mi,fi,ui,Xn,Yi,ei),lw(Re,mi,fi,ui,Xn,Yi,ei),cw(o.dynamicLayoutVertexArray,mi,fi,ui,Xe)}else cw(o.dynamicLayoutVertexArray,z.x,z.y,z.z,Xe);he.emplaceBack(rn,rn+1,rn+2),he.emplaceBack(rn+1,rn+2,rn+3),He.vertexLength+=4,He.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wn[0]),ut!==u.length-1&&Tn===u[ut+1].sectionIndex||o.programConfigurations.populatePaintArrays(ge.length,M,M.index,{},K,ie,je&&je[Tn])}const dt=D?D.anchor:z;o.placedSymbolArray.emplaceBack(dt.x,dt.y,dt.z,z.x,z.y,Le,this.glyphOffsetArray.length-Le,Ge,W,q,z.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],A,0,!1,0,X,0)}_commitLayoutVertex(o,u,f,g,v,M,A){o.emplaceBack(u,f,g,v,M,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(o,u,f,g,v,M,A){const D=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),z=D.vertexLength,W=A.tileAnchorX,q=A.tileAnchorY;for(let K=0;K<4;K++)f.collisionVertexArray.emplaceBack(0,0,0,0);f.collisionVertexArrayExt.emplaceBack(u,-o.padding,-o.padding),f.collisionVertexArrayExt.emplaceBack(u,o.padding,-o.padding),f.collisionVertexArrayExt.emplaceBack(u,o.padding,o.padding),f.collisionVertexArrayExt.emplaceBack(u,-o.padding,o.padding),this._commitLayoutVertex(f.layoutVertexArray,g,v,M,W,q,new j(o.x1,o.y1)),this._commitLayoutVertex(f.layoutVertexArray,g,v,M,W,q,new j(o.x2,o.y1)),this._commitLayoutVertex(f.layoutVertexArray,g,v,M,W,q,new j(o.x2,o.y2)),this._commitLayoutVertex(f.layoutVertexArray,g,v,M,W,q,new j(o.x1,o.y2)),D.vertexLength+=4;const X=f.indexArray;X.emplaceBack(z,z+1),X.emplaceBack(z+1,z+2),X.emplaceBack(z+2,z+3),X.emplaceBack(z+3,z),D.primitiveLength+=4}_addTextDebugCollisionBoxes(o,u,f,g,v,M){for(let A=g;A<v;A++){const D=f.get(A),z=this.getSymbolInstanceTextSize(o,M,u,A);this._addCollisionDebugVertices(D,z,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,M)}}_addIconDebugCollisionBoxes(o,u,f,g,v,M){for(let A=g;A<v;A++){const D=f.get(A),z=this.getSymbolInstanceIconSize(o,u,M.placedIconSymbolIndex);this._addCollisionDebugVertices(D,z,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,M)}}generateCollisionDebugBuffers(o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new UT(Oi,P3.members,Zo),this.iconCollisionBox=new UT(Oi,P3.members,Zo);const f=jg(this.iconSizeData,o),g=jg(this.textSizeData,o);for(let v=0;v<this.symbolInstances.length;v++){const M=this.symbolInstances.get(v);this._addTextDebugCollisionBoxes(g,o,u,M.textBoxStartIndex,M.textBoxEndIndex,M),this._addTextDebugCollisionBoxes(g,o,u,M.verticalTextBoxStartIndex,M.verticalTextBoxEndIndex,M),this._addIconDebugCollisionBoxes(f,o,u,M.iconBoxStartIndex,M.iconBoxEndIndex,M),this._addIconDebugCollisionBoxes(f,o,u,M.verticalIconBoxStartIndex,M.verticalIconBoxEndIndex,M)}}getSymbolInstanceTextSize(o,u,f,g){const v=this.text.placedSymbolArray.get(u.rightJustifiedTextSymbolIndex>=0?u.rightJustifiedTextSymbolIndex:u.centerJustifiedTextSymbolIndex>=0?u.centerJustifiedTextSymbolIndex:u.leftJustifiedTextSymbolIndex>=0?u.leftJustifiedTextSymbolIndex:u.verticalPlacedTextSymbolIndex>=0?u.verticalPlacedTextSymbolIndex:g),M=Y1(this.textSizeData,o,v)/vo;return this.tilePixelRatio*M}getSymbolInstanceIconSize(o,u,f){const g=this.icon.placedSymbolArray.get(f),v=Y1(this.iconSizeData,o,g);return this.tilePixelRatio*v}_commitDebugCollisionVertexUpdate(o,u,f){o.emplaceBack(u,-f,-f),o.emplaceBack(u,f,-f),o.emplaceBack(u,f,f),o.emplaceBack(u,-f,f)}_updateTextDebugCollisionBoxes(o,u,f,g,v,M){for(let A=g;A<v;A++){const D=f.get(A),z=this.getSymbolInstanceTextSize(o,M,u,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,z,D.padding)}}_updateIconDebugCollisionBoxes(o,u,f,g,v,M){for(let A=g;A<v;A++){const D=f.get(A),z=this.getSymbolInstanceIconSize(o,u,M);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,z,D.padding)}}updateCollisionDebugBuffers(o,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=jg(this.iconSizeData,o),g=jg(this.textSizeData,o);for(let v=0;v<this.symbolInstances.length;v++){const M=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(g,o,u,M.textBoxStartIndex,M.textBoxEndIndex,M),this._updateTextDebugCollisionBoxes(g,o,u,M.verticalTextBoxStartIndex,M.verticalTextBoxEndIndex,M),this._updateIconDebugCollisionBoxes(f,o,u,M.iconBoxStartIndex,M.iconBoxEndIndex,M.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(f,o,u,M.verticalIconBoxStartIndex,M.verticalIconBoxEndIndex,M.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,u,f,g,v,M,A,D,z){const W={};if(u<f){const{x1:q,y1:X,x2:K,y2:ie,padding:he,projectedAnchorX:ge,projectedAnchorY:Re,projectedAnchorZ:He,tileAnchorX:Le,tileAnchorY:Ge,featureIndex:Xe}=o.get(u);W.textBox={x1:q,y1:X,x2:K,y2:ie,padding:he,projectedAnchorX:ge,projectedAnchorY:Re,projectedAnchorZ:He,tileAnchorX:Le,tileAnchorY:Ge},W.textFeatureIndex=Xe}if(g<v){const{x1:q,y1:X,x2:K,y2:ie,padding:he,projectedAnchorX:ge,projectedAnchorY:Re,projectedAnchorZ:He,tileAnchorX:Le,tileAnchorY:Ge,featureIndex:Xe}=o.get(g);W.verticalTextBox={x1:q,y1:X,x2:K,y2:ie,padding:he,projectedAnchorX:ge,projectedAnchorY:Re,projectedAnchorZ:He,tileAnchorX:Le,tileAnchorY:Ge},W.verticalTextFeatureIndex=Xe}if(M<A){const{x1:q,y1:X,x2:K,y2:ie,padding:he,projectedAnchorX:ge,projectedAnchorY:Re,projectedAnchorZ:He,tileAnchorX:Le,tileAnchorY:Ge,featureIndex:Xe}=o.get(M);W.iconBox={x1:q,y1:X,x2:K,y2:ie,padding:he,projectedAnchorX:ge,projectedAnchorY:Re,projectedAnchorZ:He,tileAnchorX:Le,tileAnchorY:Ge},W.iconFeatureIndex=Xe}if(D<z){const{x1:q,y1:X,x2:K,y2:ie,padding:he,projectedAnchorX:ge,projectedAnchorY:Re,projectedAnchorZ:He,tileAnchorX:Le,tileAnchorY:Ge,featureIndex:Xe}=o.get(D);W.verticalIconBox={x1:q,y1:X,x2:K,y2:ie,padding:he,projectedAnchorX:ge,projectedAnchorY:Re,projectedAnchorZ:He,tileAnchorX:Le,tileAnchorY:Ge},W.verticalIconFeatureIndex=Xe}return W}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,u){const f=o.placedSymbolArray.get(u),g=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<g;v+=4)o.indexArray.emplaceBack(v,v+1,v+2),o.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(o),f=Math.cos(o),g=[],v=[],M=[];for(let A=0;A<this.symbolInstances.length;++A){M.push(A);const D=this.symbolInstances.get(A);g.push(0|Math.round(u*D.tileAnchorX+f*D.tileAnchorY)),v.push(D.featureIndex)}return M.sort((A,D)=>g[A]-g[D]||v[D]-v[A]),M}addToSortKeyRanges(o,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:v,leftJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:z}=f;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&v!==g&&this.addIndicesForPlacedSymbol(this.text,v),M>=0&&M!==v&&M!==g&&this.addIndicesForPlacedSymbol(this.text,M),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),z>=0&&this.addIndicesForPlacedSymbol(this.icon,z)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}dn(wf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),wf.MAX_GLYPHS=65535,wf.addDynamicAttributes=cw;const fW=new mn({"symbol-placement":new Ye(wt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(wt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(wt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new at(wt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(wt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(wt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ye(wt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(wt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(wt.layout_symbol["icon-rotation-alignment"]),"icon-size":new at(wt.layout_symbol["icon-size"]),"icon-text-fit":new Ye(wt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(wt.layout_symbol["icon-text-fit-padding"]),"icon-image":new at(wt.layout_symbol["icon-image"]),"icon-rotate":new at(wt.layout_symbol["icon-rotate"]),"icon-padding":new Ye(wt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(wt.layout_symbol["icon-keep-upright"]),"icon-offset":new at(wt.layout_symbol["icon-offset"]),"icon-anchor":new at(wt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(wt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(wt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(wt.layout_symbol["text-rotation-alignment"]),"text-field":new at(wt.layout_symbol["text-field"]),"text-font":new at(wt.layout_symbol["text-font"]),"text-size":new at(wt.layout_symbol["text-size"]),"text-max-width":new at(wt.layout_symbol["text-max-width"]),"text-line-height":new at(wt.layout_symbol["text-line-height"]),"text-letter-spacing":new at(wt.layout_symbol["text-letter-spacing"]),"text-justify":new at(wt.layout_symbol["text-justify"]),"text-radial-offset":new at(wt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(wt.layout_symbol["text-variable-anchor"]),"text-anchor":new at(wt.layout_symbol["text-anchor"]),"text-max-angle":new Ye(wt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(wt.layout_symbol["text-writing-mode"]),"text-rotate":new at(wt.layout_symbol["text-rotate"]),"text-padding":new Ye(wt.layout_symbol["text-padding"]),"text-keep-upright":new Ye(wt.layout_symbol["text-keep-upright"]),"text-transform":new at(wt.layout_symbol["text-transform"]),"text-offset":new at(wt.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(wt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ye(wt.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(wt.layout_symbol["text-optional"])});var VT={paint:new mn({"icon-opacity":new at(wt.paint_symbol["icon-opacity"]),"icon-color":new at(wt.paint_symbol["icon-color"]),"icon-halo-color":new at(wt.paint_symbol["icon-halo-color"]),"icon-halo-width":new at(wt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new at(wt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(wt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(wt.paint_symbol["icon-translate-anchor"]),"text-opacity":new at(wt.paint_symbol["text-opacity"]),"text-color":new at(wt.paint_symbol["text-color"],{runtimeType:lo,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new at(wt.paint_symbol["text-halo-color"]),"text-halo-width":new at(wt.paint_symbol["text-halo-width"]),"text-halo-blur":new at(wt.paint_symbol["text-halo-blur"]),"text-translate":new Ye(wt.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(wt.paint_symbol["text-translate-anchor"])}),layout:fW};class yD{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:qi,this.defaultValue=o}evaluate(o){if(o.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}dn(yD,"FormatSectionOverride",{omit:["defaultValue"]});class uw extends b{constructor(o){super(o,VT)}recalculate(o,u){super.recalculate(o,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const v of f)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,u,f,g){const v=this.layout.get(o).evaluate(u,{},f,g),M=this._unevaluatedLayout._values[o];return M.isDataDriven()||$c(M.value)||!v?v:function(A,D){return D.replace(/{([^{}]+)}/g,(z,W)=>W in A?String(A[W]):"")}(u.properties,v)}createBucket(o){return new wf(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of VT.paint.overridableProperties){if(!uw.hasPaintOverride(this.layout,o))continue;const u=this.paint.get(o),f=new yD(u),g=new qh(f,u.property.specification);let v=null;v=u.value.kind==="constant"||u.value.kind==="source"?new _l("source",g):new Xc("composite",g,u.value.zoomStops,u.value._interpolationType),this.paint._values[o]=new kt(u.property,v,u.parameters)}}_handleOverridablePaintPropertyUpdate(o,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&uw.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,u){const f=o.get("text-field"),g=VT.paint.properties[u];let v=!1;const M=A=>{for(const D of A)if(g.overrides&&g.overrides.hasOverride(D))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Qr)M(f.value.value.sections);else if(f.value.kind==="source"){const A=z=>{v||(z instanceof zc&&wi(z.value)===kc?M(z.value.sections):z instanceof Eh?M(z.sections):z.eachChild(A))},D=f.value;D._styleExpression&&A(D._styleExpression.expression)}return v}getProgramConfiguration(o){return new su(this,o)}}var pW={paint:new mn({"background-color":new Ye(wt.paint_background["background-color"]),"background-pattern":new Ye(wt.paint_background["background-pattern"]),"background-opacity":new Ye(wt.paint_background["background-opacity"])})},mW={paint:new mn({"raster-opacity":new Ye(wt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(wt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(wt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(wt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(wt.paint_raster["raster-saturation"]),"raster-contrast":new Ye(wt.paint_raster["raster-contrast"]),"raster-resampling":new Ye(wt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(wt.paint_raster["raster-fade-duration"])})};class gW extends b{constructor(o){super(o,{}),this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var _W={paint:new mn({"sky-type":new Ye(wt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ye(wt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ye(wt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ye(wt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ye(wt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Qt(wt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ye(wt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ye(wt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ye(wt.paint_sky["sky-opacity"])})};function GT(c,o,u){const f=[0,0,1],g=Qk([]);return t3(g,g,u?-ne(c)+Math.PI:ne(c)),e3(g,g,-ne(o)),Xk(f,f,g),Xo(f,f)}const yW={circle:class extends b{constructor(c){super(c,x8)}createBucket(c){return new rT(c)}queryRadius(c){const o=c;return Ug("circle-radius",this,o)+Ug("circle-stroke-width",this,o)+F1(this.paint.get("circle-translate"))}queryIntersectsFeature(c,o,u,f,g,v,M,A){const D=Gk(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,c.pixelToTileUnitsFactor),z=this.paint.get("circle-radius").evaluate(o,u)+this.paint.get("circle-stroke-width").evaluate(o,u);return n3(c,f,v,M,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",D,z)}getProgramIds(){return["circle"]}getProgramConfiguration(c){return new su(this,c)}},heatmap:class extends b{createBucket(c){return new r3(c)}constructor(c){super(c,A8),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gT({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return Ug("heatmap-radius",this,c)}queryIntersectsFeature(c,o,u,f,g,v,M,A){const D=this.paint.get("heatmap-radius").evaluate(o,u);return n3(c,f,v,M,A,!0,!0,new j(0,0),D)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(c){return new su(this,c)}},hillshade:class extends b{constructor(c){super(c,C8)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends b{constructor(c){super(c,H8)}getProgramIds(){const c=this.paint.get("fill-pattern"),o=c&&c.constantOr(1),u=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&u.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),u}getProgramConfiguration(c){return new su(this,c)}recalculate(c,o){super.recalculate(c,o);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new H1(c)}queryRadius(){return F1(this.paint.get("fill-translate"))}queryIntersectsFeature(c,o,u,f,g,v){return!c.queryGeometry.isAboveHorizon&&Fk(Vk(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,c.pixelToTileUnitsFactor),f)}isTileClipped(){return!0}},"fill-extrusion":class extends b{constructor(c){super(c,oG)}createBucket(c){return new f0(c)}queryRadius(){return F1(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(c){return new su(this,c)}queryIntersectsFeature(c,o,u,f,g,v,M,A,D){const z=Gk(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,c.pixelToTileUnitsFactor),W=this.paint.get("fill-extrusion-height").evaluate(o,u),q=this.paint.get("fill-extrusion-base").evaluate(o,u),X=[0,0],K=A&&v.elevation,ie=v.elevation?v.elevation.exaggeration():1,he=c.tile.getBucket(this);if(K&&he instanceof f0){const Ge=he.centroidVertexArray,Xe=D+1;Xe<Ge.length&&(X[0]=Ge.geta_centroid_pos0(Xe),X[1]=Ge.geta_centroid_pos1(Xe))}if(X[0]===0&&X[1]===1)return!1;v.projection.name==="globe"&&(f=b3([f],[new j(0,0),new j(te,te)],c.tileID.canonical).map(Ge=>Ge.polygon).flat());const ge=K?A:null,[Re,He]=function(Ge,Xe,je,dt,ut,Tt,Wt,yt,Pt,Rt,Bt){return Ge.projection.name==="globe"?function(jt,xt,en,Wn,un,Tn,rn,jn,mi,fi,ui){const Xn=[],Yi=[],ei=jt.projection.upVectorScale(ui,jt.center.lat,jt.worldSize).metersToTile,gi=[0,0,0,1],nr=[0,0,0,1],fr=(pr,wr,Vr,Js)=>{pr[0]=wr,pr[1]=Vr,pr[2]=Js,pr[3]=1},hr=w3();en>0&&(en+=hr),Wn+=hr;for(const pr of xt){const wr=[],Vr=[];for(const Js of pr){const Ji=Js.x+un.x,gs=Js.y+un.y,rs=jt.projection.projectTilePoint(Ji,gs,ui),Li=jt.projection.upVector(ui,Js.x,Js.y);let Ir=en,Ps=Wn;if(rn){const ir=E3(Ji,gs,en,Wn,rn,jn,mi,fi);Ir+=ir.base,Ps+=ir.top}en!==0?fr(gi,rs.x+Li[0]*ei*Ir,rs.y+Li[1]*ei*Ir,rs.z+Li[2]*ei*Ir):fr(gi,rs.x,rs.y,rs.z),fr(nr,rs.x+Li[0]*ei*Ps,rs.y+Li[1]*ei*Ps,rs.z+Li[2]*ei*Ps),qr(gi,gi,Tn),qr(nr,nr,Tn),wr.push(new Hg(gi[0],gi[1],gi[2])),Vr.push(new Hg(nr[0],nr[1],nr[2]))}Xn.push(wr),Yi.push(Vr)}return[Xn,Yi]}(Ge,Xe,je,dt,ut,Tt,Wt,yt,Pt,Rt,Bt):Wt?function(jt,xt,en,Wn,un,Tn,rn,jn,mi){const fi=[],ui=[],Xn=[0,0,0,1];for(const Yi of jt){const ei=[],gi=[];for(const nr of Yi){const fr=nr.x+Wn.x,hr=nr.y+Wn.y,pr=E3(fr,hr,xt,en,Tn,rn,jn,mi);Xn[0]=fr,Xn[1]=hr,Xn[2]=pr.base,Xn[3]=1,im(Xn,Xn,un),Xn[3]=Math.max(Xn[3],1e-5);const wr=new Hg(Xn[0]/Xn[3],Xn[1]/Xn[3],Xn[2]/Xn[3]);Xn[0]=fr,Xn[1]=hr,Xn[2]=pr.top,Xn[3]=1,im(Xn,Xn,un),Xn[3]=Math.max(Xn[3],1e-5);const Vr=new Hg(Xn[0]/Xn[3],Xn[1]/Xn[3],Xn[2]/Xn[3]);ei.push(wr),gi.push(Vr)}fi.push(ei),ui.push(gi)}return[fi,ui]}(Xe,je,dt,ut,Tt,Wt,yt,Pt,Rt):function(jt,xt,en,Wn,un){const Tn=[],rn=[],jn=un[8]*xt,mi=un[9]*xt,fi=un[10]*xt,ui=un[11]*xt,Xn=un[8]*en,Yi=un[9]*en,ei=un[10]*en,gi=un[11]*en;for(const nr of jt){const fr=[],hr=[];for(const pr of nr){const wr=pr.x+Wn.x,Vr=pr.y+Wn.y,Js=un[0]*wr+un[4]*Vr+un[12],Ji=un[1]*wr+un[5]*Vr+un[13],gs=un[2]*wr+un[6]*Vr+un[14],rs=un[3]*wr+un[7]*Vr+un[15],Li=Js+jn,Ir=Ji+mi,Ps=gs+fi,ir=Math.max(rs+ui,1e-5),Zr=Js+Xn,Do=Ji+Yi,Ks=gs+ei,Qs=Math.max(rs+gi,1e-5);fr.push(new Hg(Li/ir,Ir/ir,Ps/ir)),hr.push(new Hg(Zr/Qs,Do/Qs,Ks/Qs))}Tn.push(fr),rn.push(hr)}return[Tn,rn]}(Xe,je,dt,ut,Tt)}(v,f,q,W,z,M,ge,X,ie,v.center.lat,c.tileID.canonical),Le=c.queryGeometry;return function(Ge,Xe,je){let dt=1/0;Fk(je,Xe)&&(dt=T3(je,Xe[0]));for(let ut=0;ut<Xe.length;ut++){const Tt=Xe[ut],Wt=Ge[ut];for(let yt=0;yt<Tt.length-1;yt++){const Pt=Tt[yt],Rt=[Pt,Tt[yt+1],Wt[yt+1],Wt[yt],Pt];Ok(je,Rt)&&(dt=Math.min(dt,T3(je,Rt)))}}return dt!==1/0&&dt}(Re,He,Le.isPointQuery()?Le.screenBounds:Le.screenGeometry)}},line:class extends b{constructor(c){super(c,A3),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Nu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,o){super.recalculate(c,o),this.paint._values["line-floorwidth"]=C3.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new X1(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(c){return new su(this,c)}queryRadius(c){const o=c,u=I3(Ug("line-width",this,o),Ug("line-gap-width",this,o)),f=Ug("line-offset",this,o);return u/2+Math.abs(f)+F1(this.paint.get("line-translate"))}queryIntersectsFeature(c,o,u,f,g,v){if(c.queryGeometry.isAboveHorizon)return!1;const M=Vk(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,c.pixelToTileUnitsFactor),A=c.pixelToTileUnitsFactor/2*I3(this.paint.get("line-width").evaluate(o,u),this.paint.get("line-gap-width").evaluate(o,u)),D=this.paint.get("line-offset").evaluate(o,u);return D&&(f=function(z,W){const q=[],X=new j(0,0);for(let K=0;K<z.length;K++){const ie=z[K],he=[];for(let ge=0;ge<ie.length;ge++){const Re=ie[ge-1],He=ie[ge],Le=ie[ge+1],Ge=ge===0?X:He.sub(Re)._unit()._perp(),Xe=ge===ie.length-1?X:Le.sub(He)._unit()._perp(),je=Ge._add(Xe)._unit();je._mult(1/(je.x*Xe.x+je.y*Xe.y)),he.push(je._mult(W)._add(He))}q.push(he)}return q}(f,D*c.pixelToTileUnitsFactor)),function(z,W,q){for(let X=0;X<W.length;X++){const K=W[X];if(z.length>=3){for(let ie=0;ie<K.length;ie++)if(em(z,K[ie]))return!0}if(m8(z,K,q))return!0}return!1}(M,f,A)}isTileClipped(){return!0}},symbol:uw,background:class extends b{constructor(c){super(c,pW)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends b{constructor(c){super(c,mW)}getProgramIds(){return["raster"]}},sky:class extends b{constructor(c){super(c,_W),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=gT({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(c,o){if(this.paint.get("sky-type")==="atmosphere"){const f=this.paint.get("sky-atmosphere-sun"),g=!f,v=c.style.light,M=v.properties.get("position");return g&&v.properties.get("anchor")==="viewport"&&At("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?GT(M.azimuthal,90-M.polar,o):GT(f[0],90-f[1],o)}const u=this.paint.get("sky-gradient-center");return GT(u[0],90-u[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}}};class C0{constructor(o,u,f,g){this.context=o,this.format=f,this.texture=o.gl.createTexture(),this.update(u,g)}update(o,u,f){const{width:g,height:v}=o,{context:M}=this,{gl:A}=M,{HTMLImageElement:D,HTMLCanvasElement:z,HTMLVideoElement:W,ImageData:q,ImageBitmap:X}=d;if(A.bindTexture(A.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!u||u.premultiply!==!1)),f||this.size&&this.size[0]===g&&this.size[1]===v){const{x:K,y:ie}=f||{x:0,y:0};o instanceof D||o instanceof z||o instanceof W||o instanceof q||X&&o instanceof X?A.texSubImage2D(A.TEXTURE_2D,0,K,ie,A.RGBA,A.UNSIGNED_BYTE,o):A.texSubImage2D(A.TEXTURE_2D,0,K,ie,g,v,A.RGBA,A.UNSIGNED_BYTE,o.data)}else this.size=[g,v],o instanceof D||o instanceof z||o instanceof W||o instanceof q||X&&o instanceof X?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,o):A.texImage2D(A.TEXTURE_2D,0,this.format,g,v,0,this.format,A.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(u&&u.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&A.generateMipmap(A.TEXTURE_2D)}bind(o,u){const{context:f}=this,{gl:g}=f;g.bindTexture(g.TEXTURE_2D,this.texture),o!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?o===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_NEAREST:o),this.filter=o),u!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class xW{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class vW{constructor(){this.tasks={},this.taskQueue=[],Et(["process"],this),this.invoker=new xW(this.process),this.nextId=0}add(o,u){const f=this.nextId++,g=function({type:v,isSymbolTile:M,zoom:A}){return A=A||0,v==="message"?0:v!=="maybePrepare"||M?v!=="parseTile"||M?v==="parseTile"&&M?300-A:v==="maybePrepare"&&M?400-A:500:200-A:100-A}(u);if(g===0){An();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[f]={fn:o,metadata:u,priority:g,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){An();try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const o=this.pick();if(o===null)return;const u=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!u)return;u.fn()}finally{}}pick(){let o=null,u=1/0;for(let g=0;g<this.taskQueue.length;g++){const v=this.tasks[this.taskQueue[g]];v.priority<u&&(u=v.priority,o=g)}if(o===null)return null;const f=this.taskQueue[o];return this.taskQueue.splice(o,1),f}remove(){this.invoker.remove()}}class xD{constructor(o){this._stringToNumber={},this._numberToString=[];for(let u=0;u<o.length;u++){const f=o[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const wW=["tile","layer","source","sourceLayer","state"];class vD{constructor(o,u,f,g,v){this.type="Feature",this._vectorTileFeature=o,this._z=u,this._x=f,this._y=g,this.properties=o.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(o.id=this.id);for(const u of wW)this[u]!==void 0&&(o[u]=this[u]);return o}}const oc=32,ah=33,bf=new Uint16Array(8184);for(let c=0;c<2046;c++){let o=c+2,u=0,f=0,g=0,v=0,M=0,A=0;for(1&o?g=v=M=oc:u=f=A=oc;(o>>=1)>1;){const z=u+g>>1,W=f+v>>1;1&o?(g=u,v=f,u=M,f=A):(u=g,f=v,g=M,v=A),M=z,A=W}const D=4*c;bf[D+0]=u,bf[D+1]=f,bf[D+2]=g,bf[D+3]=v}const lh=new Uint16Array(2178),Sf=new Uint8Array(1089),hw=new Uint16Array(1089);function wD(c){return c===0?-.03125:c===32?.03125:0}var bD=an([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const SD={type:2,extent:te,loadGeometry:()=>[[new j(0,0),new j(8193,0),new j(8193,8193),new j(0,8193),new j(0,0)]]};class WT{constructor(o,u,f,g,v){this.tileID=o,this.uid=Ne(),this.uses=0,this.tileSize=u,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(o){const u=o+this.timeAdded;u<Sn.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=om(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,u,f){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(g,v){const M={};if(!v)return M;for(const A of g){const D=A.layerIds.map(z=>v.getLayer(z)).filter(Boolean);if(D.length!==0){A.layers=D,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(z=>D.filter(W=>W.id===z)[0]));for(const z of D)M[z.id]=A}}return M}(o.buckets,u.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const v=this.buckets[g];if(v instanceof wf){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const v=this.buckets[g];if(v instanceof wf&&v.hasRTLText){this.hasRTLText=!0,lt.isLoading()||lt.isLoaded()||tt()!=="deferred"||ft();break}}this.queryPadding=0;for(const g in this.buckets){const v=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(g).queryRadius(v))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new zg}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const f in this.buckets){const g=this.buckets[f];g.uploadPending()&&g.upload(o)}const u=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new C0(o,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new C0(o,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new C0(o,this.lineAtlas.image,u.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,u,f,g,v,M,A,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:A,transform:M,params:v,tileTransform:this.tileTransform},o,u,f):{}}querySourceFeatures(o,u){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),v=u?u.sourceLayer:"",M=g._geojsonTileLayer||g[v];if(!M)return;const A=Kc(u&&u.filter),{z:D,x:z,y:W}=this.tileID.canonical,q={z:D,x:z,y:W};for(let X=0;X<M.length;X++){const K=M.feature(X);if(A.needGeometry){const ge=rd(K,!0);if(!A.filter(new it(this.tileID.overscaledZ),ge,this.tileID.canonical))continue}else if(!A.filter(new it(this.tileID.overscaledZ),K))continue;const ie=f.getId(K,v),he=new vD(K,D,z,W,ie);he.tile=q,o.push(he)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const u=this.expirationTime;if(o.cacheControl){const f=pn(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(u)if(this.expirationTime<u)g=!0;else{const v=this.expirationTime-u;v?this.expirationTime=f+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0||!u)return;const f=this.latestFeatureIndex.loadVTLayers(),g=u.style.listImages();for(const v in this.buckets){if(!u.style.hasLayer(v))continue;const M=this.buckets[v],A=M.layers[0].sourceLayer||"_geojsonTileLayer",D=f[A],z=o[A];if(!D||!z||Object.keys(z).length===0)continue;if(M.update(z,D,g,this.imageAtlas&&this.imageAtlas.patternPositions||{}),M instanceof X1||M instanceof H1){const q=u.style._getSourceCache(M.layers[0].source);u._terrain&&u._terrain.enabled&&q&&M.programConfigurations.needsUpload&&u._terrain._clearRenderCacheForTile(q.id,this.tileID)}const W=u&&u.style&&u.style.getLayer(v);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Sn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=Sn.now()+o}setTexture(o,u){const f=u.context,g=f.gl;this.texture=this.texture||u.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new C0(f,o,g.RGBA,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),f.extTextureFilterAnisotropic&&g.texParameterf(g.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax))}setDependencies(o,u){const f={};for(const g of u)f[g]=!0;this.dependencies[o]=f}hasDependency(o,u){for(const f of o){const g=this.dependencies[f];if(g){for(const v of u)if(g[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const f=xo(SD,this.tileID.canonical,this.tileTransform)[0],g=new bi,v=new id;for(let M=0;M<f.length;M++){const{x:A,y:D}=f[M];g.emplaceBack(A,D),v.emplaceBack(M)}v.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(v),this._tileDebugBuffer=o.createVertexBuffer(g,v0.members),this._tileDebugSegments=Z.simpleSegment(0,0,g.length,v.length)}_makeTileBoundsBuffers(o,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const f=xo(SD,this.tileID.canonical,this.tileTransform)[0];let g,v;if(this.isRaster){const M=function(A,D){const z=om(A,D),W=Math.pow(2,A.z);for(let ge=0;ge<ah;ge++)for(let Re=0;Re<ah;Re++){const He=In((A.x+(Re+wD(Re))/oc)/W),Le=Hi((A.y+(ge+wD(ge))/oc)/W),Ge=D.project(He,Le),Xe=ge*ah+Re;lh[2*Xe+0]=Math.round((Ge.x*z.scale-z.x)*te),lh[2*Xe+1]=Math.round((Ge.y*z.scale-z.y)*te)}Sf.fill(0),hw.fill(0);for(let ge=2045;ge>=0;ge--){const Re=4*ge,He=bf[Re+0],Le=bf[Re+1],Ge=bf[Re+2],Xe=bf[Re+3],je=He+Ge>>1,dt=Le+Xe>>1,ut=je+dt-Le,Tt=dt+He-je,Wt=Le*ah+He,yt=Xe*ah+Ge,Pt=dt*ah+je,Rt=Math.hypot((lh[2*Wt+0]+lh[2*yt+0])/2-lh[2*Pt+0],(lh[2*Wt+1]+lh[2*yt+1])/2-lh[2*Pt+1])>=16;if(Sf[Pt]=Sf[Pt]||(Rt?1:0),ge<1022){const Bt=(Le+Tt>>1)*ah+(He+ut>>1),jt=(Xe+Tt>>1)*ah+(Ge+ut>>1);Sf[Pt]=Sf[Pt]||Sf[Bt]||Sf[jt]}}const q=new si,X=new $i;let K=0;function ie(ge,Re){const He=Re*ah+ge;return hw[He]===0&&(q.emplaceBack(lh[2*He+0],lh[2*He+1],ge*te/oc,Re*te/oc),hw[He]=++K),hw[He]-1}function he(ge,Re,He,Le,Ge,Xe){const je=ge+He>>1,dt=Re+Le>>1;if(Math.abs(ge-Ge)+Math.abs(Re-Xe)>1&&Sf[dt*ah+je])he(Ge,Xe,ge,Re,je,dt),he(He,Le,Ge,Xe,je,dt);else{const ut=ie(ge,Re),Tt=ie(He,Le),Wt=ie(Ge,Xe);X.emplaceBack(ut,Tt,Wt)}}return he(0,0,oc,oc,oc,0),he(oc,oc,0,0,0,oc),{vertices:q,indices:X}}(this.tileID.canonical,u);g=M.vertices,v=M.indices}else{g=new si,v=new $i;for(const{x:A,y:D}of f)g.emplaceBack(A,D,0,0);const M=o0.exports(g.int16,void 0,4);for(let A=0;A<M.length;A+=3)v.emplaceBack(M[A],M[A+1],M[A+2])}this._tileBoundsBuffer=o.createVertexBuffer(g,bD.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(v),this._tileBoundsSegments=Z.simpleSegment(0,0,g.length,v.length)}_makeGlobeTileDebugBuffers(o,u){const f=u.projection;if(!f||f.name!=="globe"||u.freezeTileCoverage)return;const g=this.tileID.canonical,v=S0(oD(g,u)),M=e_(u.zoom);let A;M>0&&(A=aT(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,g,u,v,A,M),this._makeGlobeTileDebugTextBuffer(o,g,u,v,A,M)}_globePoint(o,u,f,g,v,M,A){let D=b0(o,u,f);if(M){const z=1<<f.z,W=Qn(g.center.lng),q=Gn(g.center.lat),X=(f.x+.5)/z-W;let K=0;X>.5?K=-1:X<-.5&&(K=1);let ie=(o/te+f.x)/z+K,he=(u/te+f.y)/z;ie=(ie-W)*g._pixelsPerMercatorPixel+W,he=(he-q)*g._pixelsPerMercatorPixel+q;const ge=[ie*g.worldSize,he*g.worldSize,0];qr(ge,ge,M),D=sm(D,ge,A)}return qr(D,D,v)}_makeGlobeTileDebugBorderBuffer(o,u,f,g,v,M){const A=new bi,D=new id,z=new Di,W=(X,K,ie,he,ge)=>{const Re=(ie-X)/(ge-1),He=(he-K)/(ge-1),Le=A.length;for(let Ge=0;Ge<ge;Ge++){const Xe=X+Ge*Re,je=K+Ge*He;A.emplaceBack(Xe,je);const dt=this._globePoint(Xe,je,u,f,g,v,M);z.emplaceBack(dt[0],dt[1],dt[2]),D.emplaceBack(Le+Ge)}},q=te;W(0,0,q,0,16),W(q,0,q,q,16),W(q,q,0,q,16),W(0,q,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(D),this._tileDebugBuffer=o.createVertexBuffer(A,v0.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(z,rD.members),this._tileDebugSegments=Z.simpleSegment(0,0,A.length,D.length)}_makeGlobeTileDebugTextBuffer(o,u,f,g,v,M){const A=new bi,D=new $i,z=new Di,W=25;D.reserve(32),A.reserve(W),z.reserve(W);const q=(X,K)=>W*X+K;for(let X=0;X<W;X++){const K=2048*X;for(let ie=0;ie<W;ie++){const he=2048*ie;A.emplaceBack(he,K);const ge=this._globePoint(he,K,u,f,g,v,M);z.emplaceBack(ge[0],ge[1],ge[2])}}for(let X=0;X<4;X++)for(let K=0;K<4;K++){const ie=q(X,K),he=q(X,K+1),ge=q(X+1,K),Re=q(X+1,K+1);D.emplaceBack(ie,he,ge),D.emplaceBack(ge,he,Re)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(D),this._tileDebugTextBuffer=o.createVertexBuffer(A,v0.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(z,rD.members),this._tileDebugTextSegments=Z.simpleSegment(0,0,W,32)}}class bW{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,f){const g=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][g]=this.stateChanges[o][g]||{},Pe(this.stateChanges[o][g],f),this.deletedStates[o]===null){this.deletedStates[o]={};for(const v in this.state[o])v!==g&&(this.deletedStates[o][v]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][g]===null){this.deletedStates[o][g]={};for(const v in this.state[o][g])f[v]||(this.deletedStates[o][g][v]=null)}else for(const v in f)this.deletedStates[o]&&this.deletedStates[o][g]&&this.deletedStates[o][g][v]===null&&delete this.deletedStates[o][g][v]}removeFeatureState(o,u,f){if(this.deletedStates[o]===null)return;const g=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&u!==void 0)this.deletedStates[o][g]!==null&&(this.deletedStates[o][g]=this.deletedStates[o][g]||{},this.deletedStates[o][g][f]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][g])for(f in this.deletedStates[o][g]={},this.stateChanges[o][g])this.deletedStates[o][g][f]=null;else this.deletedStates[o][g]=null;else this.deletedStates[o]=null}getState(o,u){const f=String(u),g=Pe({},(this.state[o]||{})[f],(this.stateChanges[o]||{})[f]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const v=this.deletedStates[o][u];if(v===null)return{};for(const M in v)delete g[M]}return g}initializeTileState(o,u){o.setFeatureState(this.state,u)}coalesceChanges(o,u){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const v={};for(const M in this.stateChanges[g])this.state[g][M]||(this.state[g][M]={}),Pe(this.state[g][M],this.stateChanges[g][M]),v[M]=this.state[g][M];f[g]=v}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const v={};if(this.deletedStates[g]===null)for(const M in this.state[g])v[M]={},this.state[g][M]={};else for(const M in this.deletedStates[g]){if(this.deletedStates[g][M]===null)this.state[g][M]={};else for(const A of Object.keys(this.deletedStates[g][M]))delete this.state[g][M][A];v[M]=this.state[g][M]}f[g]=f[g]||{},Pe(f[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const g in o)o[g].setFeatureState(f,u)}}class MD{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,u){const f=this.toIdx(o,u);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(o,u){return this.leaves[this.toIdx(o,u)]}toIdx(o,u){return u*this.size+o}}function TD(c,o,u,f){let g=0,v=Number.MAX_VALUE;for(let M=0;M<3;M++)if(Math.abs(f[M])<1e-15){if(u[M]<c[M]||u[M]>o[M])return null}else{const A=1/f[M];let D=(c[M]-u[M])*A,z=(o[M]-u[M])*A;if(D>z){const W=D;D=z,z=W}if(D>g&&(g=D),z<v&&(v=z),g>v)return null}return g}function ED(c,o,u,f,g,v,M,A,D,z,W){const q=f-c,X=g-o,K=v-u,ie=M-c,he=A-o,ge=D-u,Re=W[1]*ge-W[2]*he,He=W[2]*ie-W[0]*ge,Le=W[0]*he-W[1]*ie,Ge=q*Re+X*He+K*Le;if(Math.abs(Ge)<1e-15)return null;const Xe=1/Ge,je=z[0]-c,dt=z[1]-o,ut=z[2]-u,Tt=(je*Re+dt*He+ut*Le)*Xe;if(Tt<0||Tt>1)return null;const Wt=dt*K-ut*X,yt=ut*q-je*K,Pt=je*X-dt*q,Rt=(W[0]*Wt+W[1]*yt+W[2]*Pt)*Xe;return Rt<0||Tt+Rt>1?null:(ie*Wt+he*yt+ge*Pt)*Xe}function AD(c,o,u){return(c-o)/(u-o)}function CD(c,o,u,f,g,v,M,A,D){const z=1<<u,W=v-f,q=M-g,X=(c+1)/z*W+f,K=(o+0)/z*q+g,ie=(o+1)/z*q+g;A[0]=(c+0)/z*W+f,A[1]=K,D[0]=X,D[1]=ie}class ID{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const u=function(v){const M=Math.ceil(Math.log2(v.dim/8)),A=[];let D=Math.ceil(Math.pow(2,M));const z=1/D,W=(K,ie,he,ge,Re)=>{const He=ge?1:0,Le=(K+1)*he-He,Ge=ie*he,Xe=(ie+1)*he-He;Re[0]=K*he,Re[1]=Ge,Re[2]=Le,Re[3]=Xe};let q=new MD(D);const X=[];for(let K=0;K<D*D;K++){W(K%D,Math.floor(K/D),z,!1,X);const ie=Mf(X[0],X[1],v),he=Mf(X[2],X[1],v),ge=Mf(X[2],X[3],v),Re=Mf(X[0],X[3],v);q.minimums.push(Math.min(ie,he,ge,Re)),q.maximums.push(Math.max(ie,he,ge,Re)),q.leaves.push(1)}for(A.push(q),D/=2;D>=1;D/=2){const K=A[A.length-1];q=new MD(D);for(let ie=0;ie<D*D;ie++){W(ie%D,Math.floor(ie/D),2,!0,X);const he=K.getElevation(X[0],X[1]),ge=K.getElevation(X[2],X[1]),Re=K.getElevation(X[2],X[3]),He=K.getElevation(X[0],X[3]),Le=K.isLeaf(X[0],X[1]),Ge=K.isLeaf(X[2],X[1]),Xe=K.isLeaf(X[2],X[3]),je=K.isLeaf(X[0],X[3]),dt=Math.min(he.min,ge.min,Re.min,He.min),ut=Math.max(he.max,ge.max,Re.max,He.max),Tt=Le&&Ge&&Xe&&je;q.maximums.push(ut),q.minimums.push(dt),q.leaves.push(ut-dt<=5&&Tt?1:0)}A.push(q)}return A}(this.dem),f=u.length-1,g=u[f];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(u,0,0,f,0)}raycastRoot(o,u,f,g,v,M,A=1){return TD([o,u,-100],[f,g,this.maximums[0]*A],v,M)}raycast(o,u,f,g,v,M,A=1){if(!this.nodeCount)return null;const D=this.raycastRoot(o,u,f,g,v,M,A);if(D==null)return null;const z=[],W=[],q=[],X=[],K=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;K.length>0;){const{idx:ie,t:he,nodex:ge,nodey:Re,depth:He}=K.pop();if(this.leaves[ie]){CD(ge,Re,He,o,u,f,g,q,X);const Ge=1<<He,Xe=(ge+0)/Ge,je=(ge+1)/Ge,dt=(Re+0)/Ge,ut=(Re+1)/Ge,Tt=Mf(Xe,dt,this.dem)*A,Wt=Mf(je,dt,this.dem)*A,yt=Mf(je,ut,this.dem)*A,Pt=Mf(Xe,ut,this.dem)*A,Rt=ED(q[0],q[1],Tt,X[0],q[1],Wt,X[0],X[1],yt,v,M),Bt=ED(X[0],X[1],yt,q[0],X[1],Pt,q[0],q[1],Tt,v,M),jt=Math.min(Rt!==null?Rt:Number.MAX_VALUE,Bt!==null?Bt:Number.MAX_VALUE);if(jt!==Number.MAX_VALUE)return jt;{const xt=r0([],v,M,he);if(PD(Tt,Wt,Pt,yt,AD(xt[0],q[0],X[0]),AD(xt[1],q[1],X[1]))>=xt[2])return he}continue}let Le=0;for(let Ge=0;Ge<this._siblingOffset.length;Ge++){CD((ge<<1)+this._siblingOffset[Ge][0],(Re<<1)+this._siblingOffset[Ge][1],He+1,o,u,f,g,q,X),q[2]=-100,X[2]=this.maximums[this.childOffsets[ie]+Ge]*A;const Xe=TD(q,X,v,M);if(Xe!=null){const je=Xe;z[Ge]=je;let dt=!1;for(let ut=0;ut<Le&&!dt;ut++)je>=z[W[ut]]&&(W.splice(ut,0,Ge),dt=!0);dt||(W[Le]=Ge),Le++}}for(let Ge=0;Ge<Le;Ge++){const Xe=W[Ge];K.push({idx:this.childOffsets[ie]+Xe,t:z[Xe],nodex:(ge<<1)+this._siblingOffset[Xe][0],nodey:(Re<<1)+this._siblingOffset[Xe][1],depth:He+1})}}return null}_addNode(o,u,f){return this.minimums.push(o),this.maximums.push(u),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(o,u,f,g,v){if(o[g].isLeaf(u,f)===1)return;this.childOffsets[v]||(this.childOffsets[v]=this.nodeCount);const M=g-1,A=o[M];let D=0,z=0;for(let W=0;W<this._siblingOffset.length;W++){const q=2*u+this._siblingOffset[W][0],X=2*f+this._siblingOffset[W][1],K=A.getElevation(q,X),ie=A.isLeaf(q,X),he=this._addNode(K.min,K.max,ie);ie&&(D|=1<<W),z||(z=he)}for(let W=0;W<this._siblingOffset.length;W++)D&1<<W||this._construct(o,2*u+this._siblingOffset[W][0],2*f+this._siblingOffset[W][1],M,z+W)}}function PD(c,o,u,f,g,v){return hi(hi(c,u,v),hi(o,f,v),g)}function Mf(c,o,u){const f=u.dim,g=fe(c*f-.5,0,f-1),v=fe(o*f-.5,0,f-1),M=Math.floor(g),A=Math.floor(v),D=Math.min(M+1,f-1),z=Math.min(A+1,f-1);return PD(u.get(M,A),u.get(D,A),u.get(M,z),u.get(D,z),g-M,v-A)}const kD={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class dw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,u,f,g=!1,v=!1){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return At(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const M=this.dim=u.height-2,A=new Uint32Array(u.data.buffer);if(this.pixels=new Uint8Array(u.data.buffer),this.encoding=f||"mapbox",this.borderReady=g,!g){for(let D=0;D<M;D++)A[this._idx(-1,D)]=A[this._idx(0,D)],A[this._idx(M,D)]=A[this._idx(M-1,D)],A[this._idx(D,-1)]=A[this._idx(D,0)],A[this._idx(D,M)]=A[this._idx(D,M-1)];A[this._idx(-1,-1)]=A[this._idx(0,0)],A[this._idx(M,-1)]=A[this._idx(M-1,0)],A[this._idx(-1,M)]=A[this._idx(0,M-1)],A[this._idx(M,M)]=A[this._idx(M-1,M-1)],v&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new ID(this)}get(o,u,f=!1){f&&(o=fe(o,-1,this.dim),u=fe(u,-1,this.dim));const g=4*this._idx(o,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[g],this.pixels[g+1],this.pixels[g+2])}static getUnpackVector(o){return kD[o]}get unpackVector(){return kD[this.encoding]}_idx(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)}_unpackMapbox(o,u,f){return(256*o*256+256*u+f)/10-1e4}_unpackTerrarium(o,u,f){return 256*o+u+f/256-32768}static pack(o,u){const f=[0,0,0,0],g=dw.getUnpackVector(u);let v=Math.floor((o+g[3])/g[2]);return f[2]=v%256,v=Math.floor(v/256),f[1]=v%256,v=Math.floor(v/256),f[0]=v,f}getPixels(){return new Va({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,u,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let g=u*this.dim,v=u*this.dim+this.dim,M=f*this.dim,A=f*this.dim+this.dim;switch(u){case-1:g=v-1;break;case 1:v=g+1}switch(f){case-1:M=A-1;break;case 1:A=M+1}const D=-u*this.dim,z=-f*this.dim;for(let W=M;W<A;W++)for(let q=g;q<v;q++){const X=4*this._idx(q,W),K=4*this._idx(q+D,W+z);this.pixels[X+0]=o.pixels[K+0],this.pixels[X+1]=o.pixels[K+1],this.pixels[X+2]=o.pixels[K+2],this.pixels[X+3]=o.pixels[K+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}dn(dw,"DEMData"),dn(ID,"DemMinMaxQuadTree",{omit:["dem"]});class SW{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(const o in this.data)for(const u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,f){const g=o.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const v={value:u,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(o,v)},f)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){const u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;const f=o.wrapped().key,g=u===void 0?0:this.data[f].indexOf(u),v=this.data[f][g];return this.data[f].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){const u=[];for(const f in this.data)for(const g of this.data[f])o(g.value)||u.push(g);for(const f of u)this.remove(f.value.tileID,f)}}class n_{constructor(o,u,f){this.func=o,this.mask=u,this.range=f}}n_.ReadOnly=!1,n_.ReadWrite=!0,n_.disabled=new n_(519,n_.ReadOnly,[0,1]);const HT=7680;class jT{constructor(o,u,f,g,v,M){this.test=o,this.ref=u,this.mask=f,this.fail=g,this.depthFail=v,this.pass=M}}jT.disabled=new jT({func:519,mask:0},0,0,HT,HT,HT);class ch{constructor(o,u,f){this.blendFunction=o,this.blendColor=u,this.mask=f}}ch.Replace=[1,0],ch.disabled=new ch(ch.Replace,vr.transparent,[!1,!1,!1,!1]),ch.unblended=new ch(ch.Replace,vr.transparent,[!0,!0,!0,!0]),ch.alphaBlended=new ch([1,771],vr.transparent,[!0,!0,!0,!0]);const qT=1029,ZT=2305;class lu{constructor(o,u,f){this.enable=o,this.mode=u,this.frontFace=f}}lu.disabled=new lu(!1,qT,ZT),lu.backCCW=new lu(!0,qT,ZT),lu.backCW=new lu(!0,qT,2304),lu.frontCW=new lu(!0,1028,2304),lu.frontCCW=new lu(!0,1028,ZT);class am extends Fr{constructor(o,u,f){super(),this.id=o,this._onlySymbols=f,u.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new SW(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new bW,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const u=this._tiles[o];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,u){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,u)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const f=this._tiles[u];f.upload(o),f.prepare(this.map.style.imageManager)}}getIds(){return Te(this._tiles).map(o=>o.tileID).sort(DD).map(o=>o.key)}getRenderableIds(o){const u=[];for(const f in this._tiles)this._isIdRenderable(+f,o)&&u.push(this._tiles[f]);return o?u.sort((f,g)=>{const v=f.tileID,M=g.tileID,A=new j(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),D=new j(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-M.overscaledZ||D.y-A.y||D.x-A.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(DD).map(f=>f.key)}hasRenderableParent(o){const u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,u){const f=this._tiles[o];f&&(f.state!=="loading"&&(f.state=u),this._loadTile(f,this._tileLoaded.bind(this,f,o,u)))}_tileLoaded(o,u,f,g){if(g)if(o.state="errored",g.status!==404)this._source.fire(new Qi(g,{tile:o}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=Sn.now(),f==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new hs("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const u=this.getRenderableIds();for(let g=0;g<u.length;g++){const v=u[g];if(o.neighboringTiles&&o.neighboringTiles[v]){const M=this.getTileByID(v);f(o,M),f(M,o)}}function f(g,v){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let M=v.tileID.canonical.x-g.tileID.canonical.x;const A=v.tileID.canonical.y-g.tileID.canonical.y,D=Math.pow(2,g.tileID.canonical.z),z=v.tileID.key;M===0&&A===0||Math.abs(A)>1||(Math.abs(M)>1&&(Math.abs(M+D)===1?M+=D:Math.abs(M-D)===1&&(M-=D)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,M,A),g.neighboringTiles&&g.neighboringTiles[z]&&(g.neighboringTiles[z].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,f,g){for(const v in this._tiles){let M=this._tiles[v];if(g[v]||!M.hasData()||M.tileID.overscaledZ<=u||M.tileID.overscaledZ>f)continue;let A=M.tileID;for(;M&&M.tileID.overscaledZ>u+1;){const z=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[z.key],M&&M.hasData()&&(A=z)}let D=A;for(;D.overscaledZ>u;)if(D=D.scaledTo(D.overscaledZ-1),o[D.key]){g[A.key]=A;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){const f=this._loadedParentTiles[o.key];return f&&f.tileID.overscaledZ>=u?f:null}for(let f=o.overscaledZ-1;f>=u;f--){const g=o.scaledTo(f),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(o){const u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,u){u=u||this._source.tileSize;const f=Math.ceil(o.width/u)+1,g=Math.ceil(o.height/u)+1,v=Math.floor(f*g*5),M=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(A)}handleWrapJump(o){const u=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,u){const f={};for(const g in this._tiles){const v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+u),f[v.tileID.key]=v}this._tiles=f;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(o,u,f){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let g;this.updateCacheSize(o,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new Jo(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(g=o.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(g=g.filter(A=>this._source.hasTile(A)))):g=[];const v=this._updateRetainedTiles(g);if(LD(this._source.type)&&g.length!==0){const A={},D={},z=Object.keys(v);for(const q of z){const X=v[q],K=this._tiles[q];if(!K||K.fadeEndTime&&K.fadeEndTime<=Sn.now())continue;const ie=this.findLoadedParent(X,Math.max(X.overscaledZ-am.maxOverzooming,this._source.minzoom));ie&&(this._addTile(ie.tileID),A[ie.tileID.key]=ie.tileID),D[q]=X}const W=g[g.length-1].overscaledZ;for(const q in this._tiles){const X=this._tiles[q];if(v[q]||!X.hasData())continue;let K=X.tileID;for(;K.overscaledZ>W;){K=K.scaledTo(K.overscaledZ-1);const ie=this._tiles[K.key];if(ie&&ie.hasData()&&D[K.key]){v[q]=X.tileID;break}}}for(const q in A)v[q]||(this._coveredTiles[q]=!0,v[q]=A[q])}for(const A in v)this._tiles[A].clearFadeHold();const M=function(A,D){const z=[];for(const W in A)W in D||z.push(W);return z}(this._tiles,v);for(const A of M){const D=this._tiles[A];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+A)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const u={};if(o.length===0)return u;const f={},g=o.reduce((z,W)=>Math.min(z,W.overscaledZ),1/0),v=o[0].overscaledZ,M=Math.max(v-am.maxOverzooming,this._source.minzoom),A=Math.max(v+am.maxUnderzooming,this._source.minzoom),D={};for(const z of o){const W=this._addTile(z);u[z.key]=z,W.hasData()||g<this._source.maxzoom&&(D[z.key]=z)}this._retainLoadedChildren(D,g,A,u);for(const z of o){let W=this._tiles[z.key];if(W.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const X=z.children(this._source.maxzoom)[0],K=this.getTile(X);if(K&&K.hasData()){u[X.key]=X;continue}}else{const X=z.children(this._source.maxzoom);if(u[X[0].key]&&u[X[1].key]&&u[X[2].key]&&u[X[3].key])continue}let q=W.wasRequested();for(let X=z.overscaledZ-1;X>=M;--X){const K=z.scaledTo(X);if(f[K.key]||(f[K.key]=!0,W=this.getTile(K),!W&&q&&(W=this._addTile(K)),W&&(u[K.key]=K,q=W.wasRequested(),W.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const u=[];let f,g=this._tiles[o].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}u.push(g.key);const v=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;g=v}for(const v of u)this._loadedParentTiles[v]=f}}_addTile(o){let u=this._tiles[o.key];if(u)return u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));const f=Boolean(u);if(!f){const g=this.map?this.map.painter:null;u=new WT(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,g,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,o.key,u.state))}return u?(u.uses++,this._tiles[o.key]=u,f||this._source.fire(new hs("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u):null}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const f=u.getExpiryTimeout();f&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},f))}_removeTile(o){const u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,u,f){const g=[],v=this.transform;if(!v)return g;const M=v.projection.name==="globe",A=Qn(v.center.lng);for(const D in this._tiles){const z=this._tiles[D];if(f&&z.clearQueryDebugViz(),z.holdingForFade())continue;let W;if(M){const q=z.tileID.canonical;if(q.z===0){const X=[Math.abs(fe(A,...I0(q,-1))-A),Math.abs(fe(A,...I0(q,1))-A)];W=[0,2*X.indexOf(Math.min(...X))-1]}else{const X=[Math.abs(fe(A,...I0(q,-1))-A),Math.abs(fe(A,...I0(q,0))-A),Math.abs(fe(A,...I0(q,1))-A)];W=[X.indexOf(Math.min(...X))-1]}}else W=[0];for(const q of W){const X=o.containsTile(z,v,u,q);X&&g.push(X)}}return g}getVisibleCoordinates(o){const u=this.getRenderableIds(o).map(f=>this._tiles[f].tileID);for(const f of u)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(LD(this._source.type))for(const o in this._tiles){const u=this._tiles[o];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=Sn.now())return!0}return!1}setFeatureState(o,u,f){this._state.updateState(o=o||"_geojsonTileLayer",u,f)}removeFeatureState(o,u,f){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,f)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,f){const g=this._tiles[o];g&&g.setDependencies(u,f)}reloadTilesForDependencies(o,u){for(const f in this._tiles)this._tiles[f].hasDependency(o,u)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(o,u))}_preloadTiles(o,u){const f=new Map,g=Array.isArray(o)?o:[o],v=this.map.painter.terrain,M=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const A of g){const D=A.coveringTiles({tileSize:M,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of D)f.set(z.key,z);this.usedForTerrain&&A.updateElevation(!1)}ce(Array.from(f.values()),(A,D)=>{const z=new WT(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,W=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),D(W,z)})},u)}}function DD(c,o){const u=Math.abs(2*c.wrap)-+(c.wrap<0),f=Math.abs(2*o.wrap)-+(o.wrap<0);return c.overscaledZ-o.overscaledZ||f-u||o.canonical.y-c.canonical.y||o.canonical.x-c.canonical.x}function LD(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function I0(c,o){const u=1<<c.z;return[c.x/u+o,(c.x+1)/u+o]}am.maxOverzooming=10,am.maxUnderzooming=3;class fw{constructor(o,u,f){this._demTile=o,this._dem=this._demTile.dem,this._scale=u,this._offset=f}static create(o,u,f){const g=f||o.findDEMTileFor(u);if(!g||!g.dem)return;const v=g.dem,M=g.tileID,A=1<<u.canonical.z-M.canonical.z;return new fw(g,g.tileSize/te/A,[(u.canonical.x/A-M.canonical.x)*v.dim,(u.canonical.y/A-M.canonical.y)*v.dim])}tileCoordToPixel(o,u){const f=u*this._scale+this._offset[1],g=Math.floor(o*this._scale+this._offset[0]),v=Math.floor(f);return new j(g,v)}getElevationAt(o,u,f,g){const v=o*this._scale+this._offset[0],M=u*this._scale+this._offset[1],A=Math.floor(v),D=Math.floor(M),z=this._dem;return g=!!g,f?hi(hi(z.get(A,D,g),z.get(A,D+1,g),M-D),hi(z.get(A+1,D,g),z.get(A+1,D+1,g),M-D),v-A):z.get(A,D,g)}getElevationAtPixel(o,u,f){return this._dem.get(o,u,!!f)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Ci(1,o)*this._dem.stride}}class RD{constructor(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new tu(te,16,0),this.featureIndexArray=new E1,this.promoteId=u}insert(o,u,f,g,v,M=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,v,M);const D=this.grid;for(let z=0;z<u.length;z++){const W=u[z],q=[1/0,1/0,-1/0,-1/0];for(let X=0;X<W.length;X++){const K=W[X];q[0]=Math.min(q[0],K.x),q[1]=Math.min(q[1],K.y),q[2]=Math.max(q[2],K.x),q[3]=Math.max(q[3],K.y)}q[0]<te&&q[1]<te&&q[2]>=0&&q[3]>=0&&D.insert(A,q[0],q[1],q[2],q[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ST(new _0(this.rawTileData)).layers,this.sourceLayerCoder=new xD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,u,f,g){this.loadVTLayers();const v=o.params||{},M=Kc(v.filter),A=o.tileResult,D=o.transform,z=A.bufferedTilespaceBounds,W=this.grid.query(z.min.x,z.min.y,z.max.x,z.max.y,(ie,he,ge,Re)=>Uk(A.bufferedTilespaceGeometry,ie,he,ge,Re));W.sort(MW);let q=null;D.elevation&&W.length>0&&(q=fw.create(D.elevation,this.tileID));const X={};let K;for(let ie=0;ie<W.length;ie++){const he=W[ie];if(he===K)continue;K=he;const ge=this.featureIndexArray.get(he);let Re=null;this.loadMatchingFeature(X,ge,M,v.layers,v.availableImages,u,f,g,(He,Le,Ge,Xe=0)=>(Re||(Re=xo(He,this.tileID.canonical,o.tileTransform)),Le.queryIntersectsFeature(A,He,Ge,Re,this.z,o.transform,o.pixelPosMatrix,q,Xe)))}return X}loadMatchingFeature(o,u,f,g,v,M,A,D,z){const{featureIndex:W,bucketIndex:q,sourceLayerIndex:X,layoutVertexArrayOffset:K}=u,ie=this.bucketLayerIDs[q];if(g&&!function(He,Le){for(let Ge=0;Ge<He.length;Ge++)if(Le.indexOf(He[Ge])>=0)return!0;return!1}(g,ie))return;const he=this.sourceLayerCoder.decode(X),ge=this.vtLayers[he].feature(W);if(f.needGeometry){const He=rd(ge,!0);if(!f.filter(new it(this.tileID.overscaledZ),He,this.tileID.canonical))return}else if(!f.filter(new it(this.tileID.overscaledZ),ge))return;const Re=this.getId(ge,he);for(let He=0;He<ie.length;He++){const Le=ie[He];if(g&&g.indexOf(Le)<0)continue;const Ge=M[Le];if(!Ge)continue;let Xe={};Re!==void 0&&D&&(Xe=D.getState(Ge.sourceLayer||"_geojsonTileLayer",Re));const je=Pe({},A[Le]);je.paint=zD(je.paint,Ge.paint,ge,Xe,v),je.layout=zD(je.layout,Ge.layout,ge,Xe,v);const dt=!z||z(ge,Ge,Xe,K);if(!dt)continue;const ut=new vD(ge,this.z,this.x,this.y,Re);ut.layer=je;let Tt=o[Le];Tt===void 0&&(Tt=o[Le]=[]),Tt.push({featureIndex:W,feature:ut,intersectionZ:dt})}}lookupSymbolFeatures(o,u,f,g,v,M,A,D){const z={};this.loadVTLayers();const W=Kc(v);for(const q of o)this.loadMatchingFeature(z,{bucketIndex:f,sourceLayerIndex:g,featureIndex:q,layoutVertexArrayOffset:0},W,M,A,D,u);return z}loadFeature(o){const{featureIndex:u,sourceLayerIndex:f}=o;this.loadVTLayers();const g=this.sourceLayerCoder.decode(f),v=this.vtFeatures[g];if(v[u])return v[u];const M=this.vtLayers[g].feature(u);return v[u]=M,M}hasLayer(o){for(const u of this.bucketLayerIDs)for(const f of u)if(o===f)return!0;return!1}getId(o,u){let f=o.id;if(this.promoteId){const g=typeof this.promoteId=="string"?this.promoteId:this.promoteId[u];g!=null&&(f=o.properties[g]),typeof f=="boolean"&&(f=Number(f))}return f}}function zD(c,o,u,f,g){return qt(c,(v,M)=>{const A=o instanceof Dt?o.get(M):null;return A&&A.evaluate?A.evaluate(u,f,g):A})}function MW(c,o){return o-c}dn(RD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class OD{constructor(o,u){this.width=o,this.height=u,this.nextRow=0,this.image=new od({width:o,height:u}),this.positions={},this.uploaded=!1}getDash(o,u){const f=this.getKey(o,u);return this.positions[f]}trim(){const o=this.width,u=this.height=ze(this.nextRow);this.image.resize({width:o,height:u})}getKey(o,u){return o.join(",")+u}getDashRanges(o,u,f){const g=[];let v=o.length%2==1?-o[o.length-1]*f:0,M=o[0]*f,A=!0;g.push({left:v,right:M,isDash:A,zeroLength:o[0]===0});let D=o[0];for(let z=1;z<o.length;z++){A=!A;const W=o[z];v=D*f,D+=W,M=D*f,g.push({left:v,right:M,isDash:A,zeroLength:W===0})}return g}addRoundDash(o,u,f){const g=u/2;for(let v=-f;v<=f;v++){const M=this.width*(this.nextRow+f+v);let A=0,D=o[A];for(let z=0;z<this.width;z++){z/D.right>1&&(D=o[++A]);const W=Math.abs(z-D.left),q=Math.abs(z-D.right),X=Math.min(W,q);let K;const ie=v/f*(g+1);if(D.isDash){const he=g-Math.abs(ie);K=Math.sqrt(X*X+he*he)}else K=g-Math.sqrt(X*X+ie*ie);this.image.data[M+z]=Math.max(0,Math.min(255,K+128))}}}addRegularDash(o,u){for(let D=o.length-1;D>=0;--D){const z=o[D],W=o[D+1];z.zeroLength?o.splice(D,1):W&&W.isDash===z.isDash&&(W.left=z.left,o.splice(D,1))}const f=o[0],g=o[o.length-1];f.isDash===g.isDash&&(f.left=g.left-this.width,g.right=f.right+this.width);const v=this.width*this.nextRow;let M=0,A=o[M];for(let D=0;D<this.width;D++){D/A.right>1&&(A=o[++M]);const z=Math.abs(D-A.left),W=Math.abs(D-A.right),q=Math.min(z,W);this.image.data[v+D]=Math.max(0,Math.min(255,(A.isDash?q:-q)+u+128))}}addDash(o,u){const f=this.getKey(o,u);if(this.positions[f])return this.positions[f];const g=u==="round",v=g?7:0,M=2*v+1;if(this.nextRow+M>this.height)return At("LineAtlas out of space"),null;o.length===0&&o.push(1);let A=0;for(let W=0;W<o.length;W++)o[W]<0&&(At("Negative value is found in line dasharray, replacing values with 0"),o[W]=0),A+=o[W];if(A!==0){const W=this.width/A,q=this.getDashRanges(o,this.width,W);g?this.addRoundDash(q,W,v):this.addRegularDash(q,u==="square"?.5*W:0)}const D=this.nextRow+v;this.nextRow+=M;const z={tl:[D,v],br:[A,0]};return this.positions[f]=z,z}}dn(OD,"LineAtlas");class FD{constructor(o){const u={},f=[];for(const A in o){const D=o[A],z=u[A]={};for(const W in D.glyphs){const q=D.glyphs[+W];if(!q||q.bitmap.width===0||q.bitmap.height===0)continue;const X=q.metrics.localGlyph?2:1,K={x:0,y:0,w:q.bitmap.width+2*X,h:q.bitmap.height+2*X};f.push(K),z[W]=K}}const{w:g,h:v}=ET(f),M=new od({width:g||1,height:v||1});for(const A in o){const D=o[A];for(const z in D.glyphs){const W=D.glyphs[+z];if(!W||W.bitmap.width===0||W.bitmap.height===0)continue;const q=u[A][z],X=W.metrics.localGlyph?2:1;od.copy(W.bitmap,M,{x:0,y:0},{x:q.x+X,y:q.y+X},W.bitmap)}}this.image=M,this.positions=u}}dn(FD,"GlyphAtlas");class TW{constructor(o){this.tileID=new Jo(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=om(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,u,f,g,v){this.status="parsing",this.data=o,this.collisionBoxArray=new zg;const M=new xD(Object.keys(o.layers).sort()),A=new RD(this.tileID,this.promoteId);A.bucketLayerIDs=[];const D={},z=new OD(256,256),W={featureIndex:A,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:z,availableImages:f},q=u.familiesBySource[this.source];for(const Xe in q){const je=o.layers[Xe];if(!je)continue;let dt=!1,ut=!1;for(const yt of q[Xe])yt[0].type==="symbol"?dt=!0:ut=!0;if(this.isSymbolTile===!0&&!dt||this.isSymbolTile===!1&&!ut)continue;je.version===1&&At(`Vector tile source "${this.source}" layer "${Xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Tt=M.encode(Xe),Wt=[];for(let yt=0;yt<je.length;yt++){const Pt=je.feature(yt),Rt=A.getId(Pt,Xe);Wt.push({feature:Pt,id:Rt,index:yt,sourceLayerIndex:Tt})}for(const yt of q[Xe]){const Pt=yt[0];this.isSymbolTile!==void 0&&Pt.type==="symbol"!==this.isSymbolTile||Pt.minzoom&&this.zoom<Math.floor(Pt.minzoom)||Pt.maxzoom&&this.zoom>=Pt.maxzoom||Pt.visibility!=="none"&&($T(yt,this.zoom,f),(D[Pt.id]=Pt.createBucket({index:A.bucketLayerIDs.length,layers:yt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Tt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:f})).populate(Wt,W,this.tileID.canonical,this.tileTransform),A.bucketLayerIDs.push(yt.map(Rt=>Rt.id)))}}let X,K,ie,he;z.trim();const ge={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Re=qt(W.glyphDependencies,Xe=>Object.keys(Xe).map(Number));Object.keys(Re).length?g.send("getGlyphs",{uid:this.uid,stacks:Re},(Xe,je)=>{X||(X=Xe,K=je,Ge.call(this))},void 0,!1,ge):K={};const He=Object.keys(W.iconDependencies);He.length?g.send("getImages",{icons:He,source:this.source,tileID:this.tileID,type:"icons"},(Xe,je)=>{X||(X=Xe,ie=je,Ge.call(this))},void 0,!1,ge):ie={};const Le=Object.keys(W.patternDependencies);function Ge(){if(X)return v(X);if(K&&ie&&he){const Xe=new FD(K),je=new F3(ie,he);for(const dt in D){const ut=D[dt];ut instanceof wf?($T(ut.layers,this.zoom,f),ZG(ut,K,Xe.positions,ie,je.iconPositions,this.showCollisionBoxes,f,this.tileID.canonical,this.tileZoom,this.projection)):ut.hasPattern&&(ut instanceof X1||ut instanceof H1||ut instanceof f0)&&($T(ut.layers,this.zoom,f),ut.addFeatures(W,this.tileID.canonical,je.patternPositions,f,this.tileTransform))}this.status="done",v(null,{buckets:Te(D).filter(dt=>!dt.isEmpty()),featureIndex:A,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Xe.image,lineAtlas:z,imageAtlas:je,glyphMap:this.returnDependencies?K:null,iconMap:this.returnDependencies?ie:null,glyphPositions:this.returnDependencies?Xe.positions:null})}}Le.length?g.send("getImages",{icons:Le,source:this.source,tileID:this.tileID,type:"patterns"},(Xe,je)=>{X||(X=Xe,he=je,Ge.call(this))},void 0,!1,ge):he={},Ge.call(this)}}function $T(c,o,u){const f=new it(o);for(const g of c)g.recalculate(f,u)}class BD{constructor(o){this.entries={},this.scheduler=o}request(o,u,f,g){const v=this.entries[o]=this.entries[o]||{callbacks:[]};if(v.result){const[M,A]=v.result;return this.scheduler?this.scheduler.add(()=>{g(M,A)},u):g(M,A),()=>{}}return v.callbacks.push(g),v.cancel||(v.cancel=f((M,A)=>{v.result=[M,A];for(const D of v.callbacks)this.scheduler?this.scheduler.add(()=>{D(M,A)},u):D(M,A);setTimeout(()=>delete this.entries[o],3e3)})),()=>{v.result||(v.callbacks=v.callbacks.filter(M=>M!==g),v.callbacks.length||(v.cancel(),delete this.entries[o]))}}}function ND(c,o,u){const f=JSON.stringify(c.request);return c.data&&(this.deduped.entries[f]={result:[null,c.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},g=>{const v=Zt(c.request,(M,A,D,z)=>{M?g(M):A&&g(null,{vectorTile:u?void 0:new ST(new _0(A)),rawData:A,cacheControl:D,expires:z})});return()=>{v.cancel(),g()}},o)}s.ARRAY_TYPE=Ua,s.AUTH_ERR_MSG=Ct,s.Aabb=Yo,s.Actor=class{constructor(c,o,u){this.target=c,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Et(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=An()?c:d,this.scheduler=new vW}send(c,o,u,f,g=!1,v){const M=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=v,this.callbacks[M]=u);const A=On(this.globalScope)?void 0:[];return this.target.postMessage({id:M,type:c,hasCallback:!!u,targetMapId:f,mustQueue:g,sourceMapId:this.mapId,data:xl(o,A)},A),{cancel:()=>{u&&delete this.callbacks[M],this.target.postMessage({id:M,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(c){const o=c.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f.cancel()}else if(o.mustQueue||An()){const f=this.callbacks[u];this.cancelCallbacks[u]=this.scheduler.add(()=>this.processTask(u,o),f&&f.metadata||{type:"message"})}else this.processTask(u,o)}processTask(c,o){if(o.type==="<response>"){const u=this.callbacks[c];delete this.callbacks[c],u&&(o.error?u(Yu(o.error)):u(null,Yu(o.data)))}else{const u=On(this.globalScope)?void 0:[],f=o.hasCallback?(v,M)=>{delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:v?xl(v):null,data:xl(M,u)},u)}:v=>{},g=Yu(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,g,f);else if(this.parent.getWorkerSource){const v=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,v[0],g.source)[v[1]](g,f)}else f(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=$1,s.Color=vr,s.ColorMode=ch,s.CullFaceMode=lu,s.DEMData=dw,s.DataConstantProperty=Ye,s.DedupedRequest=BD,s.DepthMode=n_,s.EXTENT=te,s.Elevation=class{isDataAvailableAtPoint(c){const o=this._source();if(this.isUsingMockSource()||!o||c.y<0||c.y>1)return!1;const u=o.getSource().maxzoom,f=1<<u,g=Math.floor(c.x),v=Math.floor((c.x-g)*f),M=Math.floor(c.y*f),A=this.findDEMTileFor(new Jo(u,g,u,v,M));return!(!A||!A.dem)}getAtPointOrZero(c,o=0){return this.getAtPoint(c,o)||0}getAtPoint(c,o,u=!0){if(this.isUsingMockSource())return null;o==null&&(o=null);const f=this._source();if(!f||c.y<0||c.y>1)return o;const g=f.getSource().maxzoom,v=1<<g,M=Math.floor(c.x),A=c.x-M,D=new Jo(g,M,g,Math.floor(A*v),Math.floor(c.y*v)),z=this.findDEMTileFor(D);if(!z||!z.dem)return o;const W=z.dem,q=1<<z.tileID.canonical.z,X=(A*q-z.tileID.canonical.x)*W.dim,K=(c.y*q-z.tileID.canonical.y)*W.dim,ie=Math.floor(X),he=Math.floor(K);return(u?this.exaggeration():1)*hi(hi(W.get(ie,he),W.get(ie,he+1),K-he),hi(W.get(ie+1,he),W.get(ie+1,he+1),K-he),X-ie)}getAtTileOffset(c,o,u){const f=1<<c.canonical.z;return this.getAtPointOrZero(new Mt(c.wrap+(c.canonical.x+o/te)/f,(c.canonical.y+u/te)/f))}getAtTileOffsetFunc(c,o,u,f){return g=>{const v=this.getAtTileOffset(c,g.x,g.y),M=f.upVector(c.canonical,g.x,g.y);return Sl(M,M,v*f.upVectorScale(c.canonical,o,u).metersToTile),M}}getForTilePoints(c,o,u,f){if(this.isUsingMockSource())return!1;const g=fw.create(this,c,f);return!!g&&(o.forEach(v=>{v[2]=this.exaggeration()*g.getElevationAt(v[0],v[1],u)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(c);if(!o||!o.dem)return null;const u=o.dem.tree,f=o.tileID,g=1<<c.canonical.z-f.canonical.z;let v=c.canonical.x/g-f.canonical.x,M=c.canonical.y/g-f.canonical.y,A=0;for(let D=0;D<c.canonical.z-f.canonical.z&&!u.leaves[A];D++){v*=2,M*=2;const z=2*Math.floor(M)+Math.floor(v);A=u.childOffsets[A]+z,v%=1,M%=1}return{min:this.exaggeration()*u.minimums[A],max:this.exaggeration()*u.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,o,u){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Qi,s.EvaluationParameters=it,s.Event=hs,s.Evented=Fr,s.FillExtrusionBucket=f0,s.Frustum=pT,s.FrustumCorners=fT,s.GLOBE_METERS_TO_ECEF=RT,s.GLOBE_RADIUS=cd,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const c of this._wireframeSegments)c.destroy()}}_createGrid(c){const o=new bi,u=new $i,f=65;for(let g=0;g<f;g++)for(let v=0;v<f;v++)o.emplaceBack(v,g);this._gridSegments=[];for(let g=0,v=0;g<Kg.length;g++){const M=Kg[g];for(let D=0;D<M;D++)for(let z=0;z<64;z++){const W=D*f+z;u.emplaceBack(W+1,W,W+f),u.emplaceBack(W+f,W+f+1,W+1)}const A=64*M*2;this._gridSegments.push(Z.simpleSegment(0,v,(M+1)*f,A)),v+=A}this._gridBuffer=c.createVertexBuffer(o,v0.members),this._gridIndexBuffer=c.createIndexBuffer(u,!0)}_createPoles(c){const o=new $i;for(let g=0;g<=Jg;g++)o.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=c.createIndexBuffer(o,!0);const u=new ms,f=new ms;this._poleSegments=[];for(let g=0,v=0;g<5;g++){const M=360/(1<<g);u.emplaceBack(0,-cd,0,.5,0),f.emplaceBack(0,-cd,0,.5,1);for(let A=0;A<=Jg;A++){const D=A/Jg,z=hi(0,M,D),[W,q,X]=Qg(eW,tW,z,cd);u.emplaceBack(W,q,X,D,0),f.emplaceBack(W,q,X,D,1)}this._poleSegments.push(Z.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(u,iD,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(f,iD,!1)}getGridBuffers(c){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[c]]}getPoleBuffers(c){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}getWirefameBuffers(c,o){if(!this._wireframeSegments){const u=new Zo,f=Jg,g=f+1;this._wireframeSegments=[];for(let v=0,M=0;v<Kg.length;v++){const A=Kg[v];for(let z=0;z<A;z++)for(let W=0;W<f;W++){const q=z*g+W;u.emplaceBack(q,q+1),u.emplaceBack(q,q+g),u.emplaceBack(q,q+g+1)}const D=A*f*3;this._wireframeSegments.push(Z.simpleSegment(0,M,(A+1)*g,D)),M+=D}this._wireframeIndexBuffer=c.createIndexBuffer(u)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},s.GlyphManager=Xg,s.ImagePosition=AT,s.LivePerformanceUtils=zt,s.LngLat=pt,s.LngLatBounds=Ve,s.LocalGlyphMode=PT,s.MAX_MERCATOR_LATITUDE=_t,s.MercatorCoordinate=Mt,s.ONE_EM=vo,s.OverscaledTileID=Jo,s.PerformanceMarkers=ht,s.Properties=mn,s.RGBAImage=Va,s.Ray=dT,s.RequestManager=class{constructor(c,o,u){this._transformRequestFn=c,this._customAccessToken=o,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const c=function(){let o="";for(let u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",F,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=c.token,this._skuTokenExpiresAt=c.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(c,o){return this._transformRequestFn&&this._transformRequestFn(c,o)||{url:c}}normalizeStyleURL(c,o){if(!Vt(c))return c;const u=Cr(c);return u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeGlyphsURL(c,o){if(!Vt(c))return c;const u=Cr(c);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeSourceURL(c,o,u,f){if(!Vt(c))return c;const g=Cr(c);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),u&&g.params.push(`language=${u}`),f&&g.params.push(`worldview=${f}`),this._makeAPIURL(g,this._customAccessToken||o)}normalizeSpriteURL(c,o,u,f){const g=Cr(c);return Vt(c)?(g.path=`/styles/v1${g.path}/sprite${o}${u}`,this._makeAPIURL(g,this._customAccessToken||f)):(g.path+=`${o}${u}`,Gi(g))}normalizeTileURL(c,o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),c&&!Vt(c))return c;const f=Cr(c);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||u&&f.authority!=="raster"&&u===512?"@2x":""}${T.supported?".webp":"$1"}`),f.authority==="raster"?f.path=`/${S.RASTER_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${S.TILE_URL_VERSION}${f.path}`);const g=this._customAccessToken||function(v){for(const M of v){const A=M.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(f.params)||S.ACCESS_TOKEN;return S.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,g)}canonicalizeTileURL(c,o){const u=Cr(c);if(!u.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!u.path.match(/\.[\w]+$/))return c;let f="mapbox://";u.path.match(/^\/raster\/v1\//)?f+=`raster/${u.path.replace(`/${S.RASTER_URL_PREFIX}/`,"")}`:f+=`tiles/${u.path.replace(`/${S.TILE_URL_VERSION}/`,"")}`;let g=u.params;return o&&(g=g.filter(v=>!v.match(/^access_token=/))),g.length&&(f+=`?${g.join("&")}`),f}canonicalizeTileset(c,o){const u=!!o&&Vt(o),f=[];for(const g of c.tiles||[])bn(g)?f.push(this.canonicalizeTileURL(g,u)):f.push(g);return f}_makeAPIURL(c,o){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=Cr(S.API_URL);if(c.protocol=f.protocol,c.authority=f.authority,c.protocol==="http"){const g=c.params.indexOf("secure");g>=0&&c.params.splice(g,1)}if(f.path!=="/"&&(c.path=`${f.path}${c.path}`),!S.REQUIRE_ACCESS_TOKEN)return Gi(c);if(o=o||S.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return c.params=c.params.filter(g=>g.indexOf("access_token")===-1),c.params.push(`access_token=${o||""}`),Gi(c)}},s.ResourceType=Lt,s.SegmentVector=Z,s.SourceCache=am,s.StencilMode=jT,s.StructArrayLayout1ui2=id,s.StructArrayLayout2f1f2i16=Cs,s.StructArrayLayout2i4=bi,s.StructArrayLayout2ui4=Zo,s.StructArrayLayout3f12=qo,s.StructArrayLayout3ui6=$i,s.StructArrayLayout4i8=si,s.StructArrayLayout5f20=ms,s.Texture=C0,s.Tile=WT,s.Transitionable=bt,s.Uniform1f=Qp,s.Uniform1i=class extends nc{constructor(c){super(c),this.current=0}set(c,o,u){this.fetchUniformLocation(c,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},s.Uniform2f=class extends nc{constructor(c){super(c),this.current=[0,0]}set(c,o,u){this.fetchUniformLocation(c,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}},s.Uniform3f=class extends nc{constructor(c){super(c),this.current=[0,0,0]}set(c,o,u){this.fetchUniformLocation(c,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}},s.Uniform4f=k1,s.UniformColor=xa,s.UniformMatrix2f=class extends nc{constructor(c){super(c),this.current=nh}set(c,o,u){if(this.fetchUniformLocation(c,o)){for(let f=0;f<4;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}},s.UniformMatrix3f=class extends nc{constructor(c){super(c),this.current=nT}set(c,o,u){if(this.fetchUniformLocation(c,o)){for(let f=0;f<9;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix3fv(this.location,!1,u);break}}}},s.UniformMatrix4f=class extends nc{constructor(c){super(c),this.current=Ky}set(c,o,u){if(this.fetchUniformLocation(c,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let f=1;f<16;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}},s.UnwrappedTileID=M3,s.ValidationError=hn,s.VectorTileFeature=q1,s.VectorTileWorkerSource=class extends Fr{constructor(c,o,u,f,g){super(),this.actor=c,this.layerIndex=o,this.availableImages=u,this.loadVectorData=g||ND,this.loading={},this.loaded={},this.deduped=new BD(c.scheduler),this.isSpriteLoaded=f,this.scheduler=c.scheduler}loadTile(c,o){const u=c.uid,f=c&&c.request,g=f&&f.collectResourceTiming,v=this.loading[u]=new TW(c);v.abort=this.loadVectorData(c,(M,A)=>{const D=!this.loading[u];if(delete this.loading[u],D||M||!A)return v.status="done",D||(this.loaded[u]=v),o(M);const z=A.rawData,W={};A.expires&&(W.expires=A.expires),A.cacheControl&&(W.cacheControl=A.cacheControl),v.vectorTile=A.vectorTile||new ST(new _0(z));const q=()=>{v.parse(v.vectorTile,this.layerIndex,this.availableImages,this.actor,(X,K)=>{if(X||!K)return o(X);const ie={};if(g){const he=Yt(f);he.length>0&&(ie.resourceTiming=JSON.parse(JSON.stringify(he)))}o(null,Pe({rawTileData:z.slice(0)},K,W,ie))})};this.isSpriteLoaded?q():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(q,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom}):q()}),this.loaded=this.loaded||{},this.loaded[u]=v})}reloadTile(c,o){const u=this.loaded,f=c.uid,g=this;if(u&&u[f]){const v=u[f];v.showCollisionBoxes=c.showCollisionBoxes,v.enableTerrain=!!c.enableTerrain,v.projection=c.projection,v.tileTransform=om(c.tileID.canonical,c.projection);const M=(A,D)=>{const z=v.reloadCallback;z&&(delete v.reloadCallback,v.parse(v.vectorTile,g.layerIndex,this.availableImages,g.actor,z)),o(A,D)};v.status==="parsing"?v.reloadCallback=M:v.status==="done"&&(v.vectorTile?v.parse(v.vectorTile,this.layerIndex,this.availableImages,this.actor,M):M())}}abortTile(c,o){const u=c.uid,f=this.loading[u];f&&(f.abort&&f.abort(),delete this.loading[u]),o()}removeTile(c,o){const u=this.loaded,f=c.uid;u&&u[f]&&delete u[f],o()}},s.WritingMode=Ml,s.add=sd,s.addDynamicAttributes=cw,s.adjoint=function(c,o){var u=o[0],f=o[1],g=o[2],v=o[3],M=o[4],A=o[5],D=o[6],z=o[7],W=o[8];return c[0]=M*W-A*z,c[1]=g*z-f*W,c[2]=f*A-g*M,c[3]=A*D-v*W,c[4]=u*W-g*D,c[5]=g*v-u*A,c[6]=v*z-M*D,c[7]=f*D-u*z,c[8]=u*M-f*v,c},s.asyncAll=ce,s.bezier=ae,s.bindAll=Et,s.boundsAttributes=bD,s.bufferConvexPolygon=function(c,o){const u=[];for(let f=0;f<c.length;f++){const g=We(f-1,-1,c.length-1),v=We(f+1,-1,c.length-1),M=c[f],A=c[v],D=c[g].sub(M).unit(),z=A.sub(M).unit(),W=z.angleWithSep(D.x,D.y),q=D.add(z).unit().mult(-1*o/Math.sin(W/2));u.push(M.add(q))}return u},s.cacheEntryPossiblyAdded=function(c){yn++,yn>tn&&(c.getActor().send("enforceCacheSizeLimit",St),yn=0)},s.calculateGlobeLabelMatrix=function(c,o){const{x:u,y:f}=c.point,g=cD(u,f,c.worldSize/c._pixelsPerMercatorPixel,0,0);return tm(g,g,FT(oh(o)))},s.calculateGlobeMatrix=function(c){const{x:o,y:u}=c.point,{lng:f,lat:g}=c._center;return cD(o,u,c.worldSize,f,g)},s.calculateGlobeMercatorMatrix=function(c){const o=c.pixelsPerMeter,u=o/Ci(1,c.center.lat),f=ou(new Float64Array(16));return e0(f,f,[c.point.x,c.point.y,0]),nm(f,f,[u,u,o]),Float32Array.from(f)},s.circumferenceAtLatitude=Dn,s.clamp=fe,s.clearTileCache=function(c){if(!nn())return;const o=d.caches.delete(Ti);c&&o.catch(c).then(()=>c())},s.clipLine=X3,s.clone=function(c){var o=new Ua(16);return o[0]=c[0],o[1]=c[1],o[2]=c[2],o[3]=c[3],o[4]=c[4],o[5]=c[5],o[6]=c[6],o[7]=c[7],o[8]=c[8],o[9]=c[9],o[10]=c[10],o[11]=c[11],o[12]=c[12],o[13]=c[13],o[14]=c[14],o[15]=c[15],o},s.clone$1=_n,s.collisionCircleLayout=xG,s.config=S,s.conjugate=function(c,o){return c[0]=-o[0],c[1]=-o[1],c[2]=-o[2],c[3]=o[3],c},s.create=function(){var c=new Ua(16);return Ua!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},s.create$1=Wk,s.createExpression=jo,s.createLayout=an,s.createStyleLayer=function(c){return c.type==="custom"?new gW(c):new yW[c.type](c)},s.cross=hT,s.degToRad=ne,s.distance=function(c,o){return Math.hypot(o[0]-c[0],o[1]-c[1],o[2]-c[2])},s.div=function(c,o,u){return c[0]=o[0]/u[0],c[1]=o[1]/u[1],c[2]=o[2]/u[2],c},s.dot=ic,s.earthRadius=st,s.ease=le,s.easeCubicInOut=$e,s.ecefToLatLng=function([c,o,u]){const f=Math.hypot(c,o,u),g=Math.atan2(c,u),v=.5*Math.PI-Math.acos(-o/f);return new pt(ue(g),ue(v))},s.emitValidationErrors=Xp,s.endsWith=Nt,s.enforceCacheSizeLimit=function(c){fn(),Be&&Be.then(o=>{o.keys().then(u=>{for(let f=0;f<u.length-c;f++)o.delete(u[f])})})},s.evaluateSizeForFeature=Y1,s.evaluateSizeForZoom=jg,s.evaluateVariableOffset=eD,s.evented=qe,s.exactEquals=function(c,o){return c[0]===o[0]&&c[1]===o[1]&&c[2]===o[2]&&c[3]===o[3]},s.exactEquals$1=function(c,o){return c[0]===o[0]&&c[1]===o[1]&&c[2]===o[2]},s.exported=Sn,s.exported$1=T,s.extend=Pe,s.extend$1=Ss,s.fillExtrusionHeightLift=w3,s.filterObject=wn,s.fromMat4=function(c,o){return c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[4],c[4]=o[5],c[5]=o[6],c[6]=o[8],c[7]=o[9],c[8]=o[10],c},s.fromQuat=function(c,o){var u=o[0],f=o[1],g=o[2],v=o[3],M=u+u,A=f+f,D=g+g,z=u*M,W=f*M,q=f*A,X=g*M,K=g*A,ie=g*D,he=v*M,ge=v*A,Re=v*D;return c[0]=1-q-ie,c[1]=W+Re,c[2]=X-ge,c[3]=0,c[4]=W-Re,c[5]=1-z-ie,c[6]=K+he,c[7]=0,c[8]=X+ge,c[9]=K-he,c[10]=1-z-q,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},s.fromRotation=function(c,o){var u=Math.sin(o),f=Math.cos(o);return c[0]=f,c[1]=u,c[2]=0,c[3]=-u,c[4]=f,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},s.fromScaling=jk,s.furthestTileCorner=function(c){const o=Math.round((c+45+360)%360/90)%4;return De[o]},s.getAABBPointSquareDist=function(c,o,u){let f=0;for(let g=0;g<2;++g){const v=u?u[g]:0;c[g]>v&&(f+=(c[g]-v)*(c[g]-v)),o[g]<v&&(f+=(v-o[g])*(v-o[g]))}return f},s.getAnchorAlignment=IT,s.getAnchorJustification=DT,s.getBounds=function(c){let o=1/0,u=1/0,f=-1/0,g=-1/0;for(const v of c)o=Math.min(o,v.x),u=Math.min(u,v.y),f=Math.max(f,v.x),g=Math.max(g,v.y);return{min:new j(o,u),max:new j(f,g)}},s.getColumn=ai,s.getGridMatrix=function(c,o,u,f){const g=o.getNorth(),v=o.getSouth(),M=o.getWest(),A=o.getEast(),D=1<<c.z,z=A-M,W=g-v,q=z/Jg,X=-W/Kg[u],K=[0,q,0,X,0,0,g,M,0];if(c.z>0){const ie=180/f;Hk(K,K,[ie/z+1,0,0,0,ie/W+1,0,-.5*ie/q,.5*ie/X,1])}return K[2]=D,K[5]=c.x,K[8]=c.y,K},s.getImage=rt,s.getJSON=function(c,o){return It(Pe(c,{type:"json"}),o)},s.getLatitudinalLod=function(c){const o=80.051129;c=fe(c,-80.051129,o)/o*90;const u=Math.pow(Math.abs(Math.sin(ne(c))),3);return Math.round(u*(Kg.length-1))},s.getMapSessionAPI=ve,s.getPerformanceMeasurement=Yt,s.getProjection=_D,s.getRTLTextPluginStatus=tt,s.getReferrer=Ke,s.getTilePoint=function(c,{x:o,y:u},f=0){return new j(((o-f)*c.scale-c.x)*te,(u*c.scale-c.y)*te)},s.getTileVec3=function(c,o,u=0){return Vg(((o.x-u)*c.scale-c.x)*te,(o.y*c.scale-c.y)*te,wa(o.z,o.y))},s.getVideo=function(c,o){const u=d.document.createElement("video");u.muted=!0,u.onloadstart=function(){o(null,u)};for(let f=0;f<c.length;f++){const g=d.document.createElement("source");sn(c[f])||(u.crossOrigin="Anonymous"),g.src=c[f],u.appendChild(g)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(c){const o=[0,0,0],u=ou(new Float64Array(16));return tm(u,c.pixelMatrix,c.globeMatrix),qr(o,o,u),new j(o[0],o[1])},s.globeDenormalizeECEF=FT,s.globeECEFOrigin=function(c,o){const u=[0,0,0];return qr(u,u,S0(oh(o.canonical))),qr(u,u,c),u},s.globeNormalizeECEF=S0,s.globePixelsToTileUnits=function(c,o){return te/(512*Math.pow(2,c))*rw(oh(o))},s.globePoleMatrixForTile=function(c,o,u){const f=ou(new Float64Array(16)),g=(o/(1<<c)-.5)*Math.PI*2;return N1(f,u.globeMatrix,g),Float32Array.from(f)},s.globeTileBounds=oh,s.globeTiltAtLngLat=uD,s.globeToMercatorTransition=e_,s.globeUseCustomAntiAliasing=function(c,o,u){const f=e_(u.zoom),g=c.style.map._antialias,v=!!o.extStandardDerivatives,M=o.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return f===0&&!g&&!M&&v},s.identity=ou,s.identity$1=Qk,s.invert=aT,s.isFullscreen=function(){return!!d.document.fullscreenElement||!!d.document.webkitFullscreenElement},s.isLngLatBehindGlobe=BT,s.isMapAuthenticated=function(c){return Je.has(c)},s.isMapboxURL=Vt,s.isSafariWithAntialiasingBug=function(c){const o=c.navigator?c.navigator.userAgent:null;return!!On(c)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Hi,s.latLngToECEF=w0,s.len=b8,s.length=t0,s.length$1=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},s.lngFromMercatorX=In,s.loadVectorTile=ND,s.makeRequest=It,s.mapValue=function(c,o,u,f,g){return fe((c-o)/(u-o)*(g-f)+f,f,g)},s.mercatorScale=ct,s.mercatorXfromLng=Qn,s.mercatorYfromLat=Gn,s.mercatorZfromAltitude=Ci,s.mul=v8,s.mul$1=w8,s.multiply=tm,s.multiply$1=Hk,s.multiply$2=$k,s.nextPowerOfTwo=ze,s.normalize=Xo,s.normalize$1=S8,s.normalize$2=Jk,s.number=hi,s.ortho=function(c,o,u,f,g,v,M){var A=1/(o-u),D=1/(f-g),z=1/(v-M);return c[0]=-2*A,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*D,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*z,c[11]=0,c[12]=(o+u)*A,c[13]=(g+f)*D,c[14]=(M+v)*z,c[15]=1,c},s.pbf=_0,s.perspective=function(c,o,u,f,g){var v,M=1/Math.tan(o/2);return c[0]=M/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=M,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,g!=null&&g!==1/0?(c[10]=(g+f)*(v=1/(f-g)),c[14]=2*g*f*v):(c[10]=-1,c[14]=-2*f),c},s.pick=function(c,o){const u={};for(let f=0;f<o.length;f++){const g=o[f];g in c&&(u[g]=c[g])}return u},s.plugin=lt,s.pointGeometry=j,s.polesInViewport=function(c){const o=ou(new Float64Array(16));tm(o,c.pixelMatrix,c.globeMatrix);const u=[0,rc,0],f=[0,sc,0];return qr(u,u,o),qr(f,f,o),[u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!BT(c,new pt(c.center.lat,90)),f[0]>0&&f[0]<=c.width&&f[1]>0&&f[1]<=c.height&&!BT(c,new pt(c.center.lat,-90))]},s.polygonContainsPoint=em,s.polygonIntersectsBox=Uk,s.polygonIntersectsPolygon=Ok,s.polygonizeBounds=function(c,o,u=0,f=!0){const g=new j(u,u),v=c.sub(g),M=o.add(g),A=[v,new j(M.x,v.y),M,new j(v.x,M.y)];return f&&A.push(v.clone()),A},s.posAttributes=v0,s.postMapLoadEvent=ee,s.postPerformanceEvent=Ae,s.postTurnstileEvent=de,s.potpack=ET,s.prevPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},s.radToDeg=ue,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(c){return c({pluginStatus:ke,pluginURL:Ce}),qe.on("pluginStateChange",c),c},s.removeAuthState=function(c){Je.delete(c)},s.renderColorRamp=gT,s.resample=Hn,s.rotateX=lT,s.rotateX$1=e3,s.rotateY=N1,s.rotateY$1=t3,s.rotateZ=function(c,o,u){var f=Math.sin(u),g=Math.cos(u),v=o[0],M=o[1],A=o[2],D=o[3],z=o[4],W=o[5],q=o[6],X=o[7];return o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10],c[11]=o[11],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15]),c[0]=v*g+z*f,c[1]=M*g+W*f,c[2]=A*g+q*f,c[3]=D*g+X*f,c[4]=z*g-v*f,c[5]=W*g-M*f,c[6]=q*g-A*f,c[7]=X*g-D*f,c},s.rotateZ$1=function(c,o,u){u*=.5;var f=o[0],g=o[1],v=o[2],M=o[3],A=Math.sin(u),D=Math.cos(u);return c[0]=f*D+g*A,c[1]=g*D-f*A,c[2]=v*D+M*A,c[3]=M*D-v*A,c},s.scale=nm,s.scale$1=Yk,s.scale$2=Sl,s.scaleAndAdd=r0,s.set=function(c,o,u,f){return c[0]=o,c[1]=u,c[2]=f,c},s.setCacheLimits=function(c,o){St=c,tn=o},s.setColumn=function(c,o,u){c[4*o+0]=u[0],c[4*o+1]=u[1],c[4*o+2]=u[2],c[4*o+3]=u[3]},s.setRTLTextPlugin=function(c,o,u=!1){if(ke===we||ke===Me||ke===_e)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ce=Sn.resolveURL(c),ke=we,xe=o,Ze(),u||ft()},s.smoothstep=Oe,s.spec=wt,s.squaredLength=function(c){var o=c[0],u=c[1],f=c[2];return o*o+u*u+f*f},s.storeAuthState=function(c,o){o?Je.add(c):Je.delete(c)},s.sub=au,s.subtract=uT,s.symbolSize=vG,s.tileAABB=function(c,o,u,f,g,v,M,A,D){if(D.name==="globe")return QG(c,o,new $1(u,f,g));const z=om({z:u,x:f,y:g},D);return new Yo([(v+z.x/z.scale)*o,o*(z.y/z.scale),M],[(v+z.x2/z.scale)*o,o*(z.y2/z.scale),A])},s.tileCornersToBounds=iw,s.tileTransform=om,s.transformMat3=function(c,o,u){var f=o[0],g=o[1],v=o[2];return c[0]=f*u[0]+g*u[3]+v*u[6],c[1]=f*u[1]+g*u[4]+v*u[7],c[2]=f*u[2]+g*u[5]+v*u[8],c},s.transformMat4=qr,s.transformMat4$1=im,s.transformQuat=Xk,s.transitionTileAABBinECEF=oD,s.translate=e0,s.transpose=function(c,o){if(c===o){var u=o[1],f=o[2],g=o[5];c[1]=o[3],c[2]=o[6],c[3]=u,c[5]=o[7],c[6]=f,c[7]=g}else c[0]=o[0],c[1]=o[3],c[2]=o[6],c[3]=o[1],c[4]=o[4],c[5]=o[7],c[6]=o[2],c[7]=o[5],c[8]=o[8];return c},s.triggerPluginCompletionEvent=Ue,s.uniqueId=Ne,s.updateGlobeVertexNormal=function(c,o,u,f,g){const v=5*o+2;c.float32[v+0]=u,c.float32[v+1]=f,c.float32[v+2]=g},s.validateCustomStyleLayer=function(c){const o=[],u=c.id;return u===void 0&&o.push({message:`layers.${u}: missing required property "id"`}),c.render===void 0&&o.push({message:`layers.${u}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&o.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),o},s.validateFilter=c=>Ba($h(c)),s.validateFog=c=>Ba(Zp(c)),s.validateLayer=c=>Ba(Xh(c)),s.validateLight=c=>Ba(Yh(c)),s.validateSource=c=>Ba(Zu(c)),s.validateStyle=$p,s.validateTerrain=c=>Ba(eu(c)),s.values=Te,s.vectorTile=j1,s.version=m,s.warnOnce=At,s.window=d,s.wrap=We}),a(["./shared"],function(s){function d(Ee){if(typeof Ee=="number"||typeof Ee=="boolean"||typeof Ee=="string"||Ee==null)return JSON.stringify(Ee);if(Array.isArray(Ee)){let de="[";for(const Ie of Ee)de+=`${d(Ie)},`;return`${de}]`}let se="{";for(const de of Object.keys(Ee).sort())se+=`${de}:${d(Ee[de])},`;return`${se}}`}function m(Ee){let se="";for(const de of s.refProperties)se+=`/${d(Ee[de])}`;return se}class _{constructor(se){this.keyCache={},se&&this.replace(se)}replace(se){this._layerConfigs={},this._layers={},this.update(se,[])}update(se,de){for(const ee of se)this._layerConfigs[ee.id]=ee,(this._layers[ee.id]=s.createStyleLayer(ee)).compileFilter(),this.keyCache[ee.id]&&delete this.keyCache[ee.id];for(const ee of de)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const Ie=function(ee,pe){const Ae={};for(let ve=0;ve<ee.length;ve++){const Je=pe&&pe[ee[ve].id]||m(ee[ve]);pe&&(pe[ee[ve].id]=Je);let ht=Ae[Je];ht||(ht=Ae[Je]=[]),ht.push(ee[ve])}const ye=[];for(const ve in Ae)ye.push(Ae[ve]);return ye}(s.values(this._layerConfigs),this.keyCache);for(const ee of Ie){const pe=ee.map(zt=>this._layers[zt.id]),Ae=pe[0];if(Ae.visibility==="none")continue;const ye=Ae.source||"";let ve=this.familiesBySource[ye];ve||(ve=this.familiesBySource[ye]={});const Je=Ae.sourceLayer||"_geojsonTileLayer";let ht=ve[Je];ht||(ht=ve[Je]=[]),ht.push(pe)}}}class S{loadTile(se,de){const{uid:Ie,encoding:ee,rawImageData:pe,padding:Ae,buildQuadTree:ye}=se,ve=s.window.ImageBitmap&&pe instanceof s.window.ImageBitmap?this.getImageData(pe,Ae):pe;de(null,new s.DEMData(Ie,ve,ee,Ae<1,ye))}getImageData(se,de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const Ie=this.offscreenCanvasContext.getImageData(-de,-de,se.width+2*de,se.height+2*de);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ie}}var T=function Ee(se,de){var Ie,ee=se&&se.type;if(ee==="FeatureCollection")for(Ie=0;Ie<se.features.length;Ie++)Ee(se.features[Ie],de);else if(ee==="GeometryCollection")for(Ie=0;Ie<se.geometries.length;Ie++)Ee(se.geometries[Ie],de);else if(ee==="Feature")Ee(se.geometry,de);else if(ee==="Polygon")C(se.coordinates,de);else if(ee==="MultiPolygon")for(Ie=0;Ie<se.coordinates.length;Ie++)C(se.coordinates[Ie],de);return se};function C(Ee,se){if(Ee.length!==0){P(Ee[0],se);for(var de=1;de<Ee.length;de++)P(Ee[de],!se)}}function P(Ee,se){for(var de=0,Ie=0,ee=0,pe=Ee.length,Ae=pe-1;ee<pe;Ae=ee++){var ye=(Ee[ee][0]-Ee[Ae][0])*(Ee[Ae][1]+Ee[ee][1]),ve=de+ye;Ie+=Math.abs(de)>=Math.abs(ye)?de-ve+ye:ye-ve+de,de=ve}de+Ie>=0!=!!se&&Ee.reverse()}const k=s.VectorTileFeature.prototype.toGeoJSON;class R{constructor(se){this._feature=se,this.extent=s.EXTENT,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const de of this._feature.geometry)se.push([new s.pointGeometry(de[0],de[1])]);return se}{const se=[];for(const de of this._feature.geometry){const Ie=[];for(const ee of de)Ie.push(new s.pointGeometry(ee[0],ee[1]));se.push(Ie)}return se}}toGeoJSON(se,de,Ie){return k.call(this,se,de,Ie)}}class O{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=se.length,this._features=se}feature(se){return new R(this._features[se])}}var F={exports:{}},N=s.pointGeometry,G=s.vectorTile.VectorTileFeature,j=Q;function Q(Ee,se){this.options=se||{},this.features=Ee,this.length=Ee.length}function re(Ee,se){this.id=typeof Ee.id=="number"?Ee.id:void 0,this.type=Ee.type,this.rawGeometry=Ee.type===1?[Ee.geometry]:Ee.geometry,this.properties=Ee.tags,this.extent=se||4096}Q.prototype.feature=function(Ee){return new re(this.features[Ee],this.options.extent)},re.prototype.loadGeometry=function(){var Ee=this.rawGeometry;this.geometry=[];for(var se=0;se<Ee.length;se++){for(var de=Ee[se],Ie=[],ee=0;ee<de.length;ee++)Ie.push(new N(de[ee][0],de[ee][1]));this.geometry.push(Ie)}return this.geometry},re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ee=this.geometry,se=1/0,de=-1/0,Ie=1/0,ee=-1/0,pe=0;pe<Ee.length;pe++)for(var Ae=Ee[pe],ye=0;ye<Ae.length;ye++){var ve=Ae[ye];se=Math.min(se,ve.x),de=Math.max(de,ve.x),Ie=Math.min(Ie,ve.y),ee=Math.max(ee,ve.y)}return[se,Ie,de,ee]},re.prototype.toGeoJSON=G.prototype.toGeoJSON;var $=s.pbf,ne=j;function ue(Ee){var se=new $;return function(de,Ie){for(var ee in de.layers)Ie.writeMessage(3,De,de.layers[ee])}(Ee,se),se.finish()}function De(Ee,se){var de;se.writeVarintField(15,Ee.version||1),se.writeStringField(1,Ee.name||""),se.writeVarintField(5,Ee.extent||4096);var Ie={keys:[],values:[],keycache:{},valuecache:{}};for(de=0;de<Ee.length;de++)Ie.feature=Ee.feature(de),se.writeMessage(2,$e,Ie);var ee=Ie.keys;for(de=0;de<ee.length;de++)se.writeStringField(3,ee[de]);var pe=Ie.values;for(de=0;de<pe.length;de++)se.writeMessage(4,We,pe[de])}function $e(Ee,se){var de=Ee.feature;de.id!==void 0&&se.writeVarintField(1,de.id),se.writeMessage(2,ae,Ee),se.writeVarintField(3,de.type),se.writeMessage(4,Oe,de)}function ae(Ee,se){var de=Ee.feature,Ie=Ee.keys,ee=Ee.values,pe=Ee.keycache,Ae=Ee.valuecache;for(var ye in de.properties){var ve=de.properties[ye],Je=pe[ye];if(ve!==null){Je===void 0&&(Ie.push(ye),pe[ye]=Je=Ie.length-1),se.writeVarint(Je);var ht=typeof ve;ht!=="string"&&ht!=="boolean"&&ht!=="number"&&(ve=JSON.stringify(ve));var zt=ht+":"+ve,vt=Ae[zt];vt===void 0&&(ee.push(ve),Ae[zt]=vt=ee.length-1),se.writeVarint(vt)}}}function le(Ee,se){return(se<<3)+(7&Ee)}function fe(Ee){return Ee<<1^Ee>>31}function Oe(Ee,se){for(var de=Ee.loadGeometry(),Ie=Ee.type,ee=0,pe=0,Ae=de.length,ye=0;ye<Ae;ye++){var ve=de[ye],Je=1;Ie===1&&(Je=ve.length),se.writeVarint(le(1,Je));for(var ht=Ie===3?ve.length-1:ve.length,zt=0;zt<ht;zt++){zt===1&&Ie!==1&&se.writeVarint(le(2,ht-1));var vt=ve[zt].x-ee,Kt=ve[zt].y-pe;se.writeVarint(fe(vt)),se.writeVarint(fe(Kt)),ee+=vt,pe+=Kt}Ie===3&&se.writeVarint(le(7,1))}}function We(Ee,se){var de=typeof Ee;de==="string"?se.writeStringField(1,Ee):de==="boolean"?se.writeBooleanField(7,Ee):de==="number"&&(Ee%1!=0?se.writeDoubleField(3,Ee):Ee<0?se.writeSVarintField(6,Ee):se.writeVarintField(5,Ee))}function ce(Ee,se,de,Ie,ee,pe){if(ee-Ie<=de)return;const Ae=Ie+ee>>1;Te(Ee,se,Ae,Ie,ee,pe%2),ce(Ee,se,de,Ie,Ae-1,pe+1),ce(Ee,se,de,Ae+1,ee,pe+1)}function Te(Ee,se,de,Ie,ee,pe){for(;ee>Ie;){if(ee-Ie>600){const Je=ee-Ie+1,ht=de-Ie+1,zt=Math.log(Je),vt=.5*Math.exp(2*zt/3),Kt=.5*Math.sqrt(zt*vt*(Je-vt)/Je)*(ht-Je/2<0?-1:1);Te(Ee,se,de,Math.max(Ie,Math.floor(de-ht*vt/Je+Kt)),Math.min(ee,Math.floor(de+(Je-ht)*vt/Je+Kt)),pe)}const Ae=se[2*de+pe];let ye=Ie,ve=ee;for(Pe(Ee,se,Ie,de),se[2*ee+pe]>Ae&&Pe(Ee,se,Ie,ee);ye<ve;){for(Pe(Ee,se,ye,ve),ye++,ve--;se[2*ye+pe]<Ae;)ye++;for(;se[2*ve+pe]>Ae;)ve--}se[2*Ie+pe]===Ae?Pe(Ee,se,Ie,ve):(ve++,Pe(Ee,se,ve,ee)),ve<=de&&(Ie=ve+1),de<=ve&&(ee=ve-1)}}function Pe(Ee,se,de,Ie){Qe(Ee,de,Ie),Qe(se,2*de,2*Ie),Qe(se,2*de+1,2*Ie+1)}function Qe(Ee,se,de){const Ie=Ee[se];Ee[se]=Ee[de],Ee[de]=Ie}function Ne(Ee,se,de,Ie){const ee=Ee-de,pe=se-Ie;return ee*ee+pe*pe}F.exports=ue,F.exports.fromVectorTileJs=ue,F.exports.fromGeojsonVt=function(Ee,se){se=se||{};var de={};for(var Ie in Ee)de[Ie]=new ne(Ee[Ie].features,se),de[Ie].name=Ie,de[Ie].version=se.version,de[Ie].extent=se.extent;return ue({layers:de})},F.exports.GeoJSONWrapper=ne;const nt=Ee=>Ee[0],ze=Ee=>Ee[1];class et{constructor(se,de=nt,Ie=ze,ee=64,pe=Float64Array){this.nodeSize=ee,this.points=se;const Ae=se.length<65536?Uint16Array:Uint32Array,ye=this.ids=new Ae(se.length),ve=this.coords=new pe(2*se.length);for(let Je=0;Je<se.length;Je++)ye[Je]=Je,ve[2*Je]=de(se[Je]),ve[2*Je+1]=Ie(se[Je]);ce(ye,ve,ee,0,ye.length-1,0)}range(se,de,Ie,ee){return function(pe,Ae,ye,ve,Je,ht,zt){const vt=[0,pe.length-1,0],Kt=[];let Yt,Xt;for(;vt.length;){const gn=vt.pop(),$n=vt.pop(),ii=vt.pop();if($n-ii<=zt){for(let kn=ii;kn<=$n;kn++)Yt=Ae[2*kn],Xt=Ae[2*kn+1],Yt>=ye&&Yt<=Je&&Xt>=ve&&Xt<=ht&&Kt.push(pe[kn]);continue}const Sn=Math.floor((ii+$n)/2);Yt=Ae[2*Sn],Xt=Ae[2*Sn+1],Yt>=ye&&Yt<=Je&&Xt>=ve&&Xt<=ht&&Kt.push(pe[Sn]);const Kn=(gn+1)%2;(gn===0?ye<=Yt:ve<=Xt)&&(vt.push(ii),vt.push(Sn-1),vt.push(Kn)),(gn===0?Je>=Yt:ht>=Xt)&&(vt.push(Sn+1),vt.push($n),vt.push(Kn))}return Kt}(this.ids,this.coords,se,de,Ie,ee,this.nodeSize)}within(se,de,Ie){return function(ee,pe,Ae,ye,ve,Je){const ht=[0,ee.length-1,0],zt=[],vt=ve*ve;for(;ht.length;){const Kt=ht.pop(),Yt=ht.pop(),Xt=ht.pop();if(Yt-Xt<=Je){for(let Kn=Xt;Kn<=Yt;Kn++)Ne(pe[2*Kn],pe[2*Kn+1],Ae,ye)<=vt&&zt.push(ee[Kn]);continue}const gn=Math.floor((Xt+Yt)/2),$n=pe[2*gn],ii=pe[2*gn+1];Ne($n,ii,Ae,ye)<=vt&&zt.push(ee[gn]);const Sn=(Kt+1)%2;(Kt===0?Ae-ve<=$n:ye-ve<=ii)&&(ht.push(Xt),ht.push(gn-1),ht.push(Sn)),(Kt===0?Ae+ve>=$n:ye+ve>=ii)&&(ht.push(gn+1),ht.push(Yt),ht.push(Sn))}return zt}(this.ids,this.coords,se,de,Ie,this.nodeSize)}}const Et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},Nt=Math.fround||(qt=new Float32Array(1),Ee=>(qt[0]=+Ee,qt[0]));var qt;class wn{constructor(se){this.options=Vn(Object.create(Et),se),this.trees=new Array(this.options.maxZoom+1)}load(se){const{log:de,minZoom:Ie,maxZoom:ee,nodeSize:pe}=this.options;de&&console.time("total time");const Ae=`prepare ${se.length} points`;de&&console.time(Ae),this.points=se;let ye=[];for(let ve=0;ve<se.length;ve++)se[ve].geometry&&ye.push(Ln(se[ve],ve));this.trees[ee+1]=new et(ye,On,Zn,pe,Float32Array),de&&console.timeEnd(Ae);for(let ve=ee;ve>=Ie;ve--){const Je=+Date.now();ye=this._cluster(ye,ve),this.trees[ve]=new et(ye,On,Zn,pe,Float32Array),de&&console.log("z%d: %d clusters in %dms",ve,ye.length,+Date.now()-Je)}return de&&console.timeEnd("total time"),this}getClusters(se,de){let Ie=((se[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,se[1]));let pe=se[2]===180?180:((se[2]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)Ie=-180,pe=180;else if(Ie>pe){const ht=this.getClusters([Ie,ee,180,Ae],de),zt=this.getClusters([-180,ee,pe,Ae],de);return ht.concat(zt)}const ye=this.trees[this._limitZoom(de)],ve=ye.range(Ft(Ie),An(Ae),Ft(pe),An(ee)),Je=[];for(const ht of ve){const zt=ye.points[ht];Je.push(zt.numPoints?At(zt):this.points[zt.index])}return Je}getChildren(se){const de=this._getOriginId(se),Ie=this._getOriginZoom(se),ee="No cluster with the specified id.",pe=this.trees[Ie];if(!pe)throw new Error(ee);const Ae=pe.points[de];if(!Ae)throw new Error(ee);const ye=this.options.radius/(this.options.extent*Math.pow(2,Ie-1)),ve=pe.within(Ae.x,Ae.y,ye),Je=[];for(const ht of ve){const zt=pe.points[ht];zt.parentId===se&&Je.push(zt.numPoints?At(zt):this.points[zt.index])}if(Je.length===0)throw new Error(ee);return Je}getLeaves(se,de,Ie){const ee=[];return this._appendLeaves(ee,se,de=de||10,Ie=Ie||0,0),ee}getTile(se,de,Ie){const ee=this.trees[this._limitZoom(se)],pe=Math.pow(2,se),{extent:Ae,radius:ye}=this.options,ve=ye/Ae,Je=(Ie-ve)/pe,ht=(Ie+1+ve)/pe,zt={features:[]};return this._addTileFeatures(ee.range((de-ve)/pe,Je,(de+1+ve)/pe,ht),ee.points,de,Ie,pe,zt),de===0&&this._addTileFeatures(ee.range(1-ve/pe,Je,1,ht),ee.points,pe,Ie,pe,zt),de===pe-1&&this._addTileFeatures(ee.range(0,Je,ve/pe,ht),ee.points,-1,Ie,pe,zt),zt.features.length?zt:null}getClusterExpansionZoom(se){let de=this._getOriginZoom(se)-1;for(;de<=this.options.maxZoom;){const Ie=this.getChildren(se);if(de++,Ie.length!==1)break;se=Ie[0].properties.cluster_id}return de}_appendLeaves(se,de,Ie,ee,pe){const Ae=this.getChildren(de);for(const ye of Ae){const ve=ye.properties;if(ve&&ve.cluster?pe+ve.point_count<=ee?pe+=ve.point_count:pe=this._appendLeaves(se,ve.cluster_id,Ie,ee,pe):pe<ee?pe++:se.push(ye),se.length===Ie)break}return pe}_addTileFeatures(se,de,Ie,ee,pe,Ae){for(const ye of se){const ve=de[ye],Je=ve.numPoints;let ht,zt,vt;if(Je)ht=Ot(ve),zt=ve.x,vt=ve.y;else{const Xt=this.points[ve.index];ht=Xt.properties,zt=Ft(Xt.geometry.coordinates[0]),vt=An(Xt.geometry.coordinates[1])}const Kt={type:1,geometry:[[Math.round(this.options.extent*(zt*pe-Ie)),Math.round(this.options.extent*(vt*pe-ee))]],tags:ht};let Yt;Je?Yt=ve.id:this.options.generateId?Yt=ve.index:this.points[ve.index].id&&(Yt=this.points[ve.index].id),Yt!==void 0&&(Kt.id=Yt),Ae.features.push(Kt)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,de){const Ie=[],{radius:ee,extent:pe,reduce:Ae,minPoints:ye}=this.options,ve=ee/(pe*Math.pow(2,de));for(let Je=0;Je<se.length;Je++){const ht=se[Je];if(ht.zoom<=de)continue;ht.zoom=de;const zt=this.trees[de+1],vt=zt.within(ht.x,ht.y,ve),Kt=ht.numPoints||1;let Yt=Kt;for(const Xt of vt){const gn=zt.points[Xt];gn.zoom>de&&(Yt+=gn.numPoints||1)}if(Yt>Kt&&Yt>=ye){let Xt=ht.x*Kt,gn=ht.y*Kt,$n=Ae&&Kt>1?this._map(ht,!0):null;const ii=(Je<<5)+(de+1)+this.points.length;for(const Sn of vt){const Kn=zt.points[Sn];if(Kn.zoom<=de)continue;Kn.zoom=de;const kn=Kn.numPoints||1;Xt+=Kn.x*kn,gn+=Kn.y*kn,Kn.parentId=ii,Ae&&($n||($n=this._map(ht,!0)),Ae($n,this._map(Kn)))}ht.parentId=ii,Ie.push(_n(Xt/Yt,gn/Yt,ii,Yt,$n))}else if(Ie.push(ht),Yt>1)for(const Xt of vt){const gn=zt.points[Xt];gn.zoom<=de||(gn.zoom=de,Ie.push(gn))}}return Ie}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,de){if(se.numPoints)return de?Vn({},se.properties):se.properties;const Ie=this.points[se.index].properties,ee=this.options.map(Ie);return de&&ee===Ie?Vn({},ee):ee}}function _n(Ee,se,de,Ie,ee){return{x:Nt(Ee),y:Nt(se),zoom:1/0,id:de,parentId:-1,numPoints:Ie,properties:ee}}function Ln(Ee,se){const[de,Ie]=Ee.geometry.coordinates;return{x:Nt(Ft(de)),y:Nt(An(Ie)),zoom:1/0,index:se,parentId:-1}}function At(Ee){return{type:"Feature",id:Ee.id,properties:Ot(Ee),geometry:{type:"Point",coordinates:[(se=Ee.x,360*(se-.5)),pn(Ee.y)]}};var se}function Ot(Ee){const se=Ee.numPoints,de=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se;return Vn(Vn({},Ee.properties),{cluster:!0,cluster_id:Ee.id,point_count:se,point_count_abbreviated:de})}function Ft(Ee){return Ee/360+.5}function An(Ee){const se=Math.sin(Ee*Math.PI/180),de=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return de<0?0:de>1?1:de}function pn(Ee){const se=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function Vn(Ee,se){for(const de in se)Ee[de]=se[de];return Ee}function On(Ee){return Ee.x}function Zn(Ee){return Ee.y}function ai(Ee,se,de,Ie){for(var ee,pe=Ie,Ae=de-se>>1,ye=de-se,ve=Ee[se],Je=Ee[se+1],ht=Ee[de],zt=Ee[de+1],vt=se+3;vt<de;vt+=3){var Kt=Ti(Ee[vt],Ee[vt+1],ve,Je,ht,zt);if(Kt>pe)ee=vt,pe=Kt;else if(Kt===pe){var Yt=Math.abs(vt-Ae);Yt<ye&&(ee=vt,ye=Yt)}}pe>Ie&&(ee-se>3&&ai(Ee,se,ee,Ie),Ee[ee+2]=pe,de-ee>3&&ai(Ee,ee,de,Ie))}function Ti(Ee,se,de,Ie,ee,pe){var Ae=ee-de,ye=pe-Ie;if(Ae!==0||ye!==0){var ve=((Ee-de)*Ae+(se-Ie)*ye)/(Ae*Ae+ye*ye);ve>1?(de=ee,Ie=pe):ve>0&&(de+=Ae*ve,Ie+=ye*ve)}return(Ae=Ee-de)*Ae+(ye=se-Ie)*ye}function Be(Ee,se,de,Ie){var ee={id:Ee===void 0?null:Ee,type:se,geometry:de,tags:Ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pe){var Ae=pe.geometry,ye=pe.type;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Se(pe,Ae);else if(ye==="Polygon"||ye==="MultiLineString")for(var ve=0;ve<Ae.length;ve++)Se(pe,Ae[ve]);else if(ye==="MultiPolygon")for(ve=0;ve<Ae.length;ve++)for(var Je=0;Je<Ae[ve].length;Je++)Se(pe,Ae[ve][Je])}(ee),ee}function Se(Ee,se){for(var de=0;de<se.length;de+=3)Ee.minX=Math.min(Ee.minX,se[de]),Ee.minY=Math.min(Ee.minY,se[de+1]),Ee.maxX=Math.max(Ee.maxX,se[de]),Ee.maxY=Math.max(Ee.maxY,se[de+1])}function St(Ee,se,de,Ie){if(se.geometry){var ee=se.geometry.coordinates,pe=se.geometry.type,Ae=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2),ye=[],ve=se.id;if(de.promoteId?ve=se.properties[de.promoteId]:de.generateId&&(ve=Ie||0),pe==="Point")tn(ee,ye);else if(pe==="MultiPoint")for(var Je=0;Je<ee.length;Je++)tn(ee[Je],ye);else if(pe==="LineString")nn(ee,ye,Ae,!1);else if(pe==="MultiLineString"){if(de.lineMetrics){for(Je=0;Je<ee.length;Je++)nn(ee[Je],ye=[],Ae,!1),Ee.push(Be(ve,"LineString",ye,se.properties));return}fn(ee,ye,Ae,!1)}else if(pe==="Polygon")fn(ee,ye,Ae,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(Je=0;Je<se.geometry.geometries.length;Je++)St(Ee,{id:ve,geometry:se.geometry.geometries[Je],properties:se.properties},de,Ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Je=0;Je<ee.length;Je++){var ht=[];fn(ee[Je],ht,Ae,!0),ye.push(ht)}}Ee.push(Be(ve,pe,ye,se.properties))}}function tn(Ee,se){se.push(Nn(Ee[0])),se.push(yn(Ee[1])),se.push(0)}function nn(Ee,se,de,Ie){for(var ee,pe,Ae=0,ye=0;ye<Ee.length;ye++){var ve=Nn(Ee[ye][0]),Je=yn(Ee[ye][1]);se.push(ve),se.push(Je),se.push(0),ye>0&&(Ae+=Ie?(ee*Je-ve*pe)/2:Math.sqrt(Math.pow(ve-ee,2)+Math.pow(Je-pe,2))),ee=ve,pe=Je}var ht=se.length-3;se[2]=1,ai(se,0,ht,de),se[ht+2]=1,se.size=Math.abs(Ae),se.start=0,se.end=se.size}function fn(Ee,se,de,Ie){for(var ee=0;ee<Ee.length;ee++){var pe=[];nn(Ee[ee],pe,de,Ie),se.push(pe)}}function Nn(Ee){return Ee/360+.5}function yn(Ee){var se=Math.sin(Ee*Math.PI/180),de=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return de<0?0:de>1?1:de}function Lt(Ee,se,de,Ie,ee,pe,Ae,ye){if(Ie/=se,pe>=(de/=se)&&Ae<Ie)return Ee;if(Ae<de||pe>=Ie)return null;for(var ve=[],Je=0;Je<Ee.length;Je++){var ht=Ee[Je],zt=ht.geometry,vt=ht.type,Kt=ee===0?ht.minX:ht.minY,Yt=ee===0?ht.maxX:ht.maxY;if(Kt>=de&&Yt<Ie)ve.push(ht);else if(!(Yt<de||Kt>=Ie)){var Xt=[];if(vt==="Point"||vt==="MultiPoint")Un(zt,Xt,de,Ie,ee);else if(vt==="LineString")Ke(zt,Xt,de,Ie,ee,!1,ye.lineMetrics);else if(vt==="MultiLineString")Zt(zt,Xt,de,Ie,ee,!1);else if(vt==="Polygon")Zt(zt,Xt,de,Ie,ee,!0);else if(vt==="MultiPolygon")for(var gn=0;gn<zt.length;gn++){var $n=[];Zt(zt[gn],$n,de,Ie,ee,!0),$n.length&&Xt.push($n)}if(Xt.length){if(ye.lineMetrics&&vt==="LineString"){for(gn=0;gn<Xt.length;gn++)ve.push(Be(ht.id,vt,Xt[gn],ht.tags));continue}vt!=="LineString"&&vt!=="MultiLineString"||(Xt.length===1?(vt="LineString",Xt=Xt[0]):vt="MultiLineString"),vt!=="Point"&&vt!=="MultiPoint"||(vt=Xt.length===3?"Point":"MultiPoint"),ve.push(Be(ht.id,vt,Xt,ht.tags))}}}return ve.length?ve:null}function Un(Ee,se,de,Ie,ee){for(var pe=0;pe<Ee.length;pe+=3){var Ae=Ee[pe+ee];Ae>=de&&Ae<=Ie&&(se.push(Ee[pe]),se.push(Ee[pe+1]),se.push(Ee[pe+2]))}}function Ke(Ee,se,de,Ie,ee,pe,Ae){for(var ye,ve,Je=It(Ee),ht=ee===0?Yn:li,zt=Ee.start,vt=0;vt<Ee.length-3;vt+=3){var Kt=Ee[vt],Yt=Ee[vt+1],Xt=Ee[vt+2],gn=Ee[vt+3],$n=Ee[vt+4],ii=ee===0?Kt:Yt,Sn=ee===0?gn:$n,Kn=!1;Ae&&(ye=Math.sqrt(Math.pow(Kt-gn,2)+Math.pow(Yt-$n,2))),ii<de?Sn>de&&(ve=ht(Je,Kt,Yt,gn,$n,de),Ae&&(Je.start=zt+ye*ve)):ii>Ie?Sn<Ie&&(ve=ht(Je,Kt,Yt,gn,$n,Ie),Ae&&(Je.start=zt+ye*ve)):sn(Je,Kt,Yt,Xt),Sn<de&&ii>=de&&(ve=ht(Je,Kt,Yt,gn,$n,de),Kn=!0),Sn>Ie&&ii<=Ie&&(ve=ht(Je,Kt,Yt,gn,$n,Ie),Kn=!0),!pe&&Kn&&(Ae&&(Je.end=zt+ye*ve),se.push(Je),Je=It(Ee)),Ae&&(zt+=ye)}var kn=Ee.length-3;Kt=Ee[kn],Yt=Ee[kn+1],Xt=Ee[kn+2],(ii=ee===0?Kt:Yt)>=de&&ii<=Ie&&sn(Je,Kt,Yt,Xt),kn=Je.length-3,pe&&kn>=3&&(Je[kn]!==Je[0]||Je[kn+1]!==Je[1])&&sn(Je,Je[0],Je[1],Je[2]),Je.length&&se.push(Je)}function It(Ee){var se=[];return se.size=Ee.size,se.start=Ee.start,se.end=Ee.end,se}function Zt(Ee,se,de,Ie,ee,pe){for(var Ae=0;Ae<Ee.length;Ae++)Ke(Ee[Ae],se,de,Ie,ee,pe,!1)}function sn(Ee,se,de,Ie){Ee.push(se),Ee.push(de),Ee.push(Ie)}function Yn(Ee,se,de,Ie,ee,pe){var Ae=(pe-se)/(Ie-se);return Ee.push(pe),Ee.push(de+(ee-de)*Ae),Ee.push(1),Ae}function li(Ee,se,de,Ie,ee,pe){var Ae=(pe-de)/(ee-de);return Ee.push(se+(Ie-se)*Ae),Ee.push(pe),Ee.push(1),Ae}function Bi(Ee,se){for(var de=[],Ie=0;Ie<Ee.length;Ie++){var ee,pe=Ee[Ie],Ae=pe.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")ee=rt(pe.geometry,se);else if(Ae==="MultiLineString"||Ae==="Polygon"){ee=[];for(var ye=0;ye<pe.geometry.length;ye++)ee.push(rt(pe.geometry[ye],se))}else if(Ae==="MultiPolygon")for(ee=[],ye=0;ye<pe.geometry.length;ye++){for(var ve=[],Je=0;Je<pe.geometry[ye].length;Je++)ve.push(rt(pe.geometry[ye][Je],se));ee.push(ve)}de.push(Be(pe.id,Ae,ee,pe.tags))}return de}function rt(Ee,se){var de=[];de.size=Ee.size,Ee.start!==void 0&&(de.start=Ee.start,de.end=Ee.end);for(var Ie=0;Ie<Ee.length;Ie+=3)de.push(Ee[Ie]+se,Ee[Ie+1],Ee[Ie+2]);return de}function Ct(Ee,se){if(Ee.transformed)return Ee;var de,Ie,ee,pe=1<<Ee.z,Ae=Ee.x,ye=Ee.y;for(de=0;de<Ee.features.length;de++){var ve=Ee.features[de],Je=ve.geometry,ht=ve.type;if(ve.geometry=[],ht===1)for(Ie=0;Ie<Je.length;Ie+=2)ve.geometry.push(Vt(Je[Ie],Je[Ie+1],se,pe,Ae,ye));else for(Ie=0;Ie<Je.length;Ie++){var zt=[];for(ee=0;ee<Je[Ie].length;ee+=2)zt.push(Vt(Je[Ie][ee],Je[Ie][ee+1],se,pe,Ae,ye));ve.geometry.push(zt)}}return Ee.transformed=!0,Ee}function Vt(Ee,se,de,Ie,ee,pe){return[Math.round(de*(Ee*Ie-ee)),Math.round(de*(se*Ie-pe))]}function bn(Ee,se,de,Ie,ee){for(var pe=se===ee.maxZoom?0:ee.tolerance/((1<<se)*ee.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:de,y:Ie,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ye=0;ye<Ee.length;ye++){Ae.numFeatures++,Pn(Ae,Ee[ye],pe,ee);var ve=Ee[ye].minX,Je=Ee[ye].minY,ht=Ee[ye].maxX,zt=Ee[ye].maxY;ve<Ae.minX&&(Ae.minX=ve),Je<Ae.minY&&(Ae.minY=Je),ht>Ae.maxX&&(Ae.maxX=ht),zt>Ae.maxY&&(Ae.maxY=zt)}return Ae}function Pn(Ee,se,de,Ie){var ee=se.geometry,pe=se.type,Ae=[];if(pe==="Point"||pe==="MultiPoint")for(var ye=0;ye<ee.length;ye+=3)Ae.push(ee[ye]),Ae.push(ee[ye+1]),Ee.numPoints++,Ee.numSimplified++;else if(pe==="LineString")Ri(Ae,ee,Ee,de,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(ye=0;ye<ee.length;ye++)Ri(Ae,ee[ye],Ee,de,pe==="Polygon",ye===0);else if(pe==="MultiPolygon")for(var ve=0;ve<ee.length;ve++){var Je=ee[ve];for(ye=0;ye<Je.length;ye++)Ri(Ae,Je[ye],Ee,de,!0,ye===0)}if(Ae.length){var ht=se.tags||null;if(pe==="LineString"&&Ie.lineMetrics){for(var zt in ht={},se.tags)ht[zt]=se.tags[zt];ht.mapbox_clip_start=ee.start/ee.size,ht.mapbox_clip_end=ee.end/ee.size}var vt={geometry:Ae,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:ht};se.id!==null&&(vt.id=se.id),Ee.features.push(vt)}}function Ri(Ee,se,de,Ie,ee,pe){var Ae=Ie*Ie;if(Ie>0&&se.size<(ee?Ae:Ie))de.numPoints+=se.length/3;else{for(var ye=[],ve=0;ve<se.length;ve+=3)(Ie===0||se[ve+2]>Ae)&&(de.numSimplified++,ye.push(se[ve]),ye.push(se[ve+1])),de.numPoints++;ee&&function(Je,ht){for(var zt=0,vt=0,Kt=Je.length,Yt=Kt-2;vt<Kt;Yt=vt,vt+=2)zt+=(Je[vt]-Je[Yt])*(Je[vt+1]+Je[Yt+1]);if(zt>0===ht)for(vt=0,Kt=Je.length;vt<Kt/2;vt+=2){var Xt=Je[vt],gn=Je[vt+1];Je[vt]=Je[Kt-2-vt],Je[vt+1]=Je[Kt-1-vt],Je[Kt-2-vt]=Xt,Je[Kt-1-vt]=gn}}(ye,pe),Ee.push(ye)}}function cr(Ee,se){var de=(se=this.options=function(ee,pe){for(var Ae in pe)ee[Ae]=pe[Ae];return ee}(Object.create(this.options),se)).debug;if(de&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ie=function(ee,pe){var Ae=[];if(ee.type==="FeatureCollection")for(var ye=0;ye<ee.features.length;ye++)St(Ae,ee.features[ye],pe,ye);else St(Ae,ee.type==="Feature"?ee:{geometry:ee},pe);return Ae}(Ee,se);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ie=function(ee,pe){var Ae=pe.buffer/pe.extent,ye=ee,ve=Lt(ee,1,-1-Ae,Ae,0,-1,2,pe),Je=Lt(ee,1,1-Ae,2+Ae,0,-1,2,pe);return(ve||Je)&&(ye=Lt(ee,1,-Ae,1+Ae,0,-1,2,pe)||[],ve&&(ye=Bi(ve,1).concat(ye)),Je&&(ye=ye.concat(Bi(Je,-1)))),ye}(Ie,se),Ie.length&&this.splitTile(Ie,0,0,0),de&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Or(Ee,se,de){return 32*((1<<Ee)*de+se)+Ee}function Cr(Ee,se){const de=Ee.tileID.canonical;if(!this._geoJSONIndex)return se(null,null);const Ie=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!Ie)return se(null,null);const ee=new O(Ie.features);let pe=F.exports(ee);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),se(null,{vectorTile:ee,rawData:pe.buffer})}cr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},cr.prototype.splitTile=function(Ee,se,de,Ie,ee,pe,Ae){for(var ye=[Ee,se,de,Ie],ve=this.options,Je=ve.debug;ye.length;){Ie=ye.pop(),de=ye.pop(),se=ye.pop(),Ee=ye.pop();var ht=1<<se,zt=Or(se,de,Ie),vt=this.tiles[zt];if(!vt&&(Je>1&&console.time("creation"),vt=this.tiles[zt]=bn(Ee,se,de,Ie,ve),this.tileCoords.push({z:se,x:de,y:Ie}),Je)){Je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,de,Ie,vt.numFeatures,vt.numPoints,vt.numSimplified),console.timeEnd("creation"));var Kt="z"+se;this.stats[Kt]=(this.stats[Kt]||0)+1,this.total++}if(vt.source=Ee,ee){if(se===ve.maxZoom||se===ee)continue;var Yt=1<<ee-se;if(de!==Math.floor(pe/Yt)||Ie!==Math.floor(Ae/Yt))continue}else if(se===ve.indexMaxZoom||vt.numPoints<=ve.indexMaxPoints)continue;if(vt.source=null,Ee.length!==0){Je>1&&console.time("clipping");var Xt,gn,$n,ii,Sn,Kn,kn=.5*ve.buffer/ve.extent,hs=.5-kn,Qi=.5+kn,Fr=1+kn;Xt=gn=$n=ii=null,Sn=Lt(Ee,ht,de-kn,de+Qi,0,vt.minX,vt.maxX,ve),Kn=Lt(Ee,ht,de+hs,de+Fr,0,vt.minX,vt.maxX,ve),Ee=null,Sn&&(Xt=Lt(Sn,ht,Ie-kn,Ie+Qi,1,vt.minY,vt.maxY,ve),gn=Lt(Sn,ht,Ie+hs,Ie+Fr,1,vt.minY,vt.maxY,ve),Sn=null),Kn&&($n=Lt(Kn,ht,Ie-kn,Ie+Qi,1,vt.minY,vt.maxY,ve),ii=Lt(Kn,ht,Ie+hs,Ie+Fr,1,vt.minY,vt.maxY,ve),Kn=null),Je>1&&console.timeEnd("clipping"),ye.push(Xt||[],se+1,2*de,2*Ie),ye.push(gn||[],se+1,2*de,2*Ie+1),ye.push($n||[],se+1,2*de+1,2*Ie),ye.push(ii||[],se+1,2*de+1,2*Ie+1)}}},cr.prototype.getTile=function(Ee,se,de){var Ie=this.options,ee=Ie.extent,pe=Ie.debug;if(Ee<0||Ee>24)return null;var Ae=1<<Ee,ye=Or(Ee,se=(se%Ae+Ae)%Ae,de);if(this.tiles[ye])return Ct(this.tiles[ye],ee);pe>1&&console.log("drilling down to z%d-%d-%d",Ee,se,de);for(var ve,Je=Ee,ht=se,zt=de;!ve&&Je>0;)Je--,ht=Math.floor(ht/2),zt=Math.floor(zt/2),ve=this.tiles[Or(Je,ht,zt)];return ve&&ve.source?(pe>1&&console.log("found parent tile z%d-%d-%d",Je,ht,zt),pe>1&&console.time("drilling down"),this.splitTile(ve.source,Je,ht,zt,Ee,se,de),pe>1&&console.timeEnd("drilling down"),this.tiles[ye]?Ct(this.tiles[ye],ee):null):null};class Gi extends s.VectorTileWorkerSource{constructor(se,de,Ie,ee,pe){super(se,de,Ie,ee,Cr),pe&&(this.loadGeoJSON=pe)}loadData(se,de){const Ie=se&&se.request,ee=Ie&&Ie.collectResourceTiming;this.loadGeoJSON(se,(pe,Ae)=>{if(pe||!Ae)return de(pe);if(typeof Ae!="object")return de(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{T(Ae,!0);try{if(se.filter){const ve=s.createExpression(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));Ae={type:"FeatureCollection",features:Ae.features.filter(ht=>ve.value.evaluate({zoom:0},ht))}}this._geoJSONIndex=se.cluster?new wn(function({superclusterOptions:ve,clusterProperties:Je}){if(!Je||!ve)return ve;const ht={},zt={},vt={accumulated:null,zoom:0},Kt={properties:null},Yt=Object.keys(Je);for(const Xt of Yt){const[gn,$n]=Je[Xt],ii=s.createExpression($n),Sn=s.createExpression(typeof gn=="string"?[gn,["accumulated"],["get",Xt]]:gn);ht[Xt]=ii.value,zt[Xt]=Sn.value}return ve.map=Xt=>{Kt.properties=Xt;const gn={};for(const $n of Yt)gn[$n]=ht[$n].evaluate(vt,Kt);return gn},ve.reduce=(Xt,gn)=>{Kt.properties=gn;for(const $n of Yt)vt.accumulated=Xt[$n],Xt[$n]=zt[$n].evaluate(vt,Kt)},ve}(se)).load(Ae.features):function(ve,Je){return new cr(ve,Je)}(Ae,se.geojsonVtOptions)}catch(ve){return de(ve)}this.loaded={};const ye={};if(ee){const ve=s.getPerformanceMeasurement(Ie);ve&&(ye.resourceTiming={},ye.resourceTiming[se.source]=JSON.parse(JSON.stringify(ve)))}de(null,ye)}})}reloadTile(se,de){const Ie=this.loaded;return Ie&&Ie[se.uid]?super.reloadTile(se,de):this.loadTile(se,de)}loadGeoJSON(se,de){if(se.request)s.getJSON(se.request,de);else{if(typeof se.data!="string")return de(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));try{return de(null,JSON.parse(se.data))}catch{return de(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(se,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(Ie){de(Ie)}}getClusterChildren(se,de){try{de(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(Ie){de(Ie)}}getClusterLeaves(se,de){try{de(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(Ie){de(Ie)}}}class Kr{constructor(se){this.self=se,this.actor=new s.Actor(se,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Gi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(de,Ie)=>{if(this.workerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.workerSourceTypes[de]=Ie},this.self.registerRTLTextPlugin=de=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=de.applyArabicShaping,s.plugin.processBidirectionalText=de.processBidirectionalText,s.plugin.processStyledBidirectionalText=de.processStyledBidirectionalText}}clearCaches(se,de,Ie){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se],Ie()}checkIfReady(se,de,Ie){Ie()}setReferrer(se,de){this.referrer=de}spriteLoaded(se,de){this.isSpriteLoaded[se]=de;for(const Ie in this.workerSources[se]){const ee=this.workerSources[se][Ie];for(const pe in ee)ee[pe]instanceof s.VectorTileWorkerSource&&(ee[pe].isSpriteLoaded=de,ee[pe].fire(new s.Event("isSpriteLoaded")))}}setImages(se,de,Ie){this.availableImages[se]=de;for(const ee in this.workerSources[se]){const pe=this.workerSources[se][ee];for(const Ae in pe)pe[Ae].availableImages=de}Ie()}enableTerrain(se,de,Ie){this.terrain=de,Ie()}setProjection(se,de){this.projections[se]=s.getProjection(de)}setLayers(se,de,Ie){this.getLayerIndex(se).replace(de),Ie()}updateLayers(se,de,Ie){this.getLayerIndex(se).update(de.layers,de.removedIds),Ie()}loadTile(se,de,Ie){const ee=this.enableTerrain?s.extend({enableTerrain:this.terrain},de):de;ee.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,de.type,de.source).loadTile(ee,Ie)}loadDEMTile(se,de,Ie){const ee=this.enableTerrain?s.extend({buildQuadTree:this.terrain},de):de;this.getDEMWorkerSource(se,de.source).loadTile(ee,Ie)}reloadTile(se,de,Ie){const ee=this.enableTerrain?s.extend({enableTerrain:this.terrain},de):de;ee.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,de.type,de.source).reloadTile(ee,Ie)}abortTile(se,de,Ie){this.getWorkerSource(se,de.type,de.source).abortTile(de,Ie)}removeTile(se,de,Ie){this.getWorkerSource(se,de.type,de.source).removeTile(de,Ie)}removeSource(se,de,Ie){if(!this.workerSources[se]||!this.workerSources[se][de.type]||!this.workerSources[se][de.type][de.source])return;const ee=this.workerSources[se][de.type][de.source];delete this.workerSources[se][de.type][de.source],ee.removeSource!==void 0?ee.removeSource(de,Ie):Ie()}loadWorkerSource(se,de,Ie){try{this.self.importScripts(de.url),Ie()}catch(ee){Ie(ee.toString())}}syncRTLPluginState(se,de,Ie){try{s.plugin.setState(de);const ee=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);const pe=s.plugin.isParsed();Ie(pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ee}`),pe)}}catch(ee){Ie(ee.toString())}}getAvailableImages(se){let de=this.availableImages[se];return de||(de=[]),de}getLayerIndex(se){let de=this.layerIndexes[se];return de||(de=this.layerIndexes[se]=new _),de}getWorkerSource(se,de,Ie){if(this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][de]||(this.workerSources[se][de]={}),!this.workerSources[se][de][Ie]){const ee={send:(pe,Ae,ye,ve,Je,ht)=>{this.actor.send(pe,Ae,ye,se,Je,ht)},scheduler:this.actor.scheduler};this.workerSources[se][de][Ie]=new this.workerSourceTypes[de](ee,this.getLayerIndex(se),this.getAvailableImages(se),this.isSpriteLoaded[se])}return this.workerSources[se][de][Ie]}getDEMWorkerSource(se,de){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][de]||(this.demWorkerSources[se][de]=new S),this.demWorkerSources[se][de]}enforceCacheSizeLimit(se,de){s.enforceCacheSizeLimit(de)}getWorkerPerformanceMetrics(se,de,Ie){Ie(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Kr(self)),Kr}),a(["./shared"],function(s){function d(y,h){if(Array.isArray(y)){if(!Array.isArray(h)||y.length!==h.length)return!1;for(let p=0;p<y.length;p++)if(!d(y[p],h[p]))return!1;return!0}if(typeof y=="object"&&y!==null&&h!==null){if(typeof h!="object"||Object.keys(y).length!==Object.keys(h).length)return!1;for(const p in y)if(!d(y[p],h[p]))return!1;return!0}return y===h}var m=_;function _(y){return!function(h){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,E,I=new Blob([""],{type:"text/javascript"}),B=URL.createObjectURL(I);try{E=new Worker(B),w=!0}catch{w=!1}return E&&E.terminate(),URL.revokeObjectURL(B),w}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var w=document.createElement("canvas");w.width=w.height=1;var E=w.getContext("2d");if(!E)return!1;var I=E.getImageData(0,0,1,1);return I&&I.width===w.width}()?(S[p=h&&h.failIfMajorPerformanceCaveat]===void 0&&(S[p]=function(w){var E,I=function(B){var U=document.createElement("canvas"),H=Object.create(_.webGLContextAttributes);return H.failIfMajorPerformanceCaveat=B,U.getContext("webgl",H)||U.getContext("experimental-webgl",H)}(w);if(!I)return!1;try{E=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!E||I.isContextLost())&&(I.shaderSource(E,"void main() {}"),I.compileShader(E),I.getShaderParameter(E,I.COMPILE_STATUS)===!0)}(p)),S[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var p}(y)}var S={};function T(y,h,p){const w=s.window.document.createElement(y);return h!==void 0&&(w.className=h),p&&p.appendChild(w),w}function C(y,h,p){const w=s.window.document.createElementNS("http://www.w3.org/2000/svg",y);for(const E of Object.keys(h))w.setAttributeNS(null,E,h[E]);return p&&p.appendChild(w),w}_.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const P=s.window.document&&s.window.document.documentElement.style,k=P&&P.userSelect!==void 0?"userSelect":"WebkitUserSelect";let R;function O(){P&&k&&(R=P[k],P[k]="none")}function F(){P&&k&&(P[k]=R)}function N(y){y.preventDefault(),y.stopPropagation(),s.window.removeEventListener("click",N,!0)}function G(){s.window.addEventListener("click",N,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",N,!0)},0)}function j(y,h){const p=y.getBoundingClientRect();return $(y,p,h)}function Q(y,h){const p=y.getBoundingClientRect(),w=[];for(let E=0;E<h.length;E++)w.push($(y,p,h[E]));return w}function re(y){return s.window.InstallTrigger!==void 0&&y.button===2&&y.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button}function $(y,h,p){const w=y.offsetWidth===h.width?1:y.offsetWidth/h.width;return new s.pointGeometry((p.clientX-h.left)*w,(p.clientY-h.top)*w)}function ne(y,h){var p=h[0],w=h[1],E=h[2],I=h[3],B=p*I-E*w;return B?(y[0]=I*(B=1/B),y[1]=-w*B,y[2]=-E*B,y[3]=p*B,y):null}function ue(y){const{userImage:h}=y;return!!(h&&h.render&&h.render())&&(y.data.replace(new Uint8Array(h.data.buffer)),!0)}class De extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(h){if(this.loaded!==h&&(this.loaded=h,h)){for(const{ids:p,callback:w}of this.requestors)this._notify(p,w);this.requestors=[]}}hasImage(h){return!!this.getImage(h)}getImage(h){return this.images[h]}addImage(h,p){this._validate(h,p)&&(this.images[h]=p)}_validate(h,p){let w=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${h}" has invalid "stretchX" value`))),w=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${h}" has invalid "stretchY" value`))),w=!1),this._validateContent(p.content,p)||(this.fire(new s.ErrorEvent(new Error(`Image "${h}" has invalid "content" value`))),w=!1),w}_validateStretch(h,p){if(!h)return!0;let w=0;for(const E of h){if(E[0]<w||E[1]<E[0]||p<E[1])return!1;w=E[1]}return!0}_validateContent(h,p){return!(h&&(h.length!==4||h[0]<0||p.data.width<h[0]||h[1]<0||p.data.height<h[1]||h[2]<0||p.data.width<h[2]||h[3]<0||p.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))}updateImage(h,p){p.version=this.images[h].version+1,this.images[h]=p,this.updatedImages[h]=!0}removeImage(h){const p=this.images[h];delete this.images[h],delete this.patterns[h],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(h,p){let w=!0;if(!this.isLoaded())for(const E of h)this.images[E]||(w=!1);this.isLoaded()||w?this._notify(h,p):this.requestors.push({ids:h,callback:p})}_notify(h,p){const w={};for(const E of h){this.images[E]||this.fire(new s.Event("styleimagemissing",{id:E}));const I=this.images[E];I?w[E]={data:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:Boolean(I.userImage&&I.userImage.render)}:s.warnOnce(`Image "${E}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,w)}getPixelSize(){const{width:h,height:p}=this.atlasImage;return{width:h,height:p}}getPattern(h){const p=this.patterns[h],w=this.getImage(h);if(!w)return null;if(p&&p.position.version===w.version)return p.position;if(p)p.position.version=w.version;else{const E={w:w.data.width+2,h:w.data.height+2,x:0,y:0},I=new s.ImagePosition(E,w);this.patterns[h]={bin:E,position:I}}return this._updatePatternAtlas(),this.patterns[h].position}bind(h){const p=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(h,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const h=[];for(const I in this.patterns)h.push(this.patterns[I].bin);const{w:p,h:w}=s.potpack(h),E=this.atlasImage;E.resize({width:p||1,height:w||1});for(const I in this.patterns){const{bin:B}=this.patterns[I],U=B.x+1,H=B.y+1,J=this.images[I].data,Y=J.width,oe=J.height;s.RGBAImage.copy(J,E,{x:0,y:0},{x:U,y:H},{width:Y,height:oe}),s.RGBAImage.copy(J,E,{x:0,y:oe-1},{x:U,y:H-1},{width:Y,height:1}),s.RGBAImage.copy(J,E,{x:0,y:0},{x:U,y:H+oe},{width:Y,height:1}),s.RGBAImage.copy(J,E,{x:Y-1,y:0},{x:U-1,y:H},{width:1,height:oe}),s.RGBAImage.copy(J,E,{x:0,y:0},{x:U+Y,y:H},{width:1,height:oe})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(h){for(const p of h){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const w=this.images[p];ue(w)&&this.updateImage(p,w)}}}const $e=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(y,h){return function([p,w,E]){const I=s.degToRad(w+90),B=s.degToRad(E);return{x:p*Math.cos(I)*Math.sin(B),y:p*Math.sin(I)*Math.sin(B),z:p*Math.cos(B),azimuthal:w,polar:E}}(y.expression.evaluate(h))}interpolate(y,h,p){return{x:s.number(y.x,h.x,p),y:s.number(y.y,h.y,p),z:s.number(y.z,h.z,p),azimuthal:s.number(y.azimuthal,h.azimuthal,p),polar:s.number(y.polar,h.polar,p)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),ae="-transition";class le extends s.Evented{constructor(h){super(),this._transitionable=new s.Transitionable($e),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(h,p={}){if(!this._validate(s.validateLight,h,p))for(const w in h){const E=h[w];s.endsWith(w,ae)?this._transitionable.setTransition(w.slice(0,-ae.length),E):this._transitionable.setValue(w,E)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,p,w){return(!w||w.validate!==!1)&&s.emitValidationErrors(this,h.call(s.validateStyle,s.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const fe=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Oe="-transition";class We extends s.Evented{constructor(h,p){super(),this._transitionable=new s.Transitionable(fe),this.set(h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=p}get(){return this._transitionable.serialize()}set(h){for(const p in h){const w=h[p];s.endsWith(p,Oe)?this._transitionable.setTransition(p.slice(0,-Oe.length),w):this._transitionable.setValue(p,w)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}}function ce(y,h,p,w){const E=s.smoothstep(45,65,p),[I,B]=Te(y,w),U=s.length(h);let H=1-Math.min(1,Math.exp((U-I)/(B-I)*-6));return H*=H*H,H=Math.min(1,1.00747*H),H*E*y.alpha}function Te(y,h){const p=.5/Math.tan(.5*h);return[y.range[0]+p,y.range[1]+p]}const Pe=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),Qe="-transition";class Ne extends s.Evented{constructor(h,p){super(),this._transitionable=new s.Transitionable(Pe),this.set(h),this._transitioning=this._transitionable.untransitioned(),this._transform=p}get state(){const h=this._transform,p=h.projection.name==="globe",w=s.globeToMercatorTransition(h.zoom),E=this.properties.get("range"),I=[.5,3];return{range:p?[s.number(I[0],E[0],w),s.number(I[1],E[1],w)]:E,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(h,p={}){if(!this._validate(s.validateFog,h,p)){for(const w of Object.keys(s.spec.fog))h&&h[w]===void 0&&(h[w]=s.spec.fog[w].default);for(const w in h){const E=h[w];s.endsWith(w,Qe)?this._transitionable.setTransition(w.slice(0,-Qe.length),E):this._transitionable.setValue(w,E)}}}getOpacity(h){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,h))*p.a}getOpacityAtLatLng(h,p){return this._transform.projection.supportsFog?function(w,E,I){const B=s.MercatorCoordinate.fromLngLat(E),U=I.elevation?I.elevation.getAtPointOrZero(B):0,H=[B.x,B.y,U];return s.transformMat4(H,H,I.mercatorFogMatrix),ce(w,H,I.pitch,I._fov)}(this.state,h,p):0}getFovAdjustedRange(h){return this._transform.projection.supportsFog?Te(this.state,h):[0,1]}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,p,w){return(!w||w.validate!==!1)&&s.emitValidationErrors(this,h.call(s.validateStyle,s.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class nt{constructor(h,p){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const w=this.workerPool.acquire(this.id);for(let E=0;E<w.length;E++){const I=new nt.Actor(w[E],p,this.id);I.name=`Worker ${E}`,this.actors.push(I)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(h,p,w){s.asyncAll(this.actors,(E,I)=>{E.send(h,p,I)},w=w||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(h=>{h.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ze(y,h,p){return h*(s.EXTENT/(y.tileSize*Math.pow(2,p-y.tileID.overscaledZ)))}nt.Actor=s.Actor;class et{constructor(h,p,w,E){this.screenBounds=h,this.cameraPoint=p,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=w,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,E)}static createFromScreenPoints(h,p){let w,E;if(h instanceof s.pointGeometry||typeof h[0]=="number"){const I=s.pointGeometry.convert(h);w=[I],E=p.isPointAboveHorizon(I)}else{const I=s.pointGeometry.convert(h[0]),B=s.pointGeometry.convert(h[1]);w=[I,B],E=s.polygonizeBounds(I,B).every(U=>p.isPointAboveHorizon(U))}return new et(w,p.getCameraPoint(),E,p)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(h){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],h)}bufferedCameraGeometry(h){const p=this.screenBounds[0],w=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],E=s.polygonizeBounds(p,w,0,!1);return this.cameraPoint.y>w.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<w.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=w.x?E[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(E[3]=this.cameraPoint)),s.bufferConvexPolygon(E,h)}bufferedCameraGeometryGlobe(h){const p=this.screenBounds[0],w=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],E=s.polygonizeBounds(p,w,h),I=this.cameraPoint.clone();switch(3*((I.y>p.y)+(I.y>w.y))+((I.x>p.x)+(I.x>w.x))){case 0:E[0]=I,E[4]=I.clone();break;case 1:E.splice(1,0,I);break;case 2:E[1]=I;break;case 3:E.splice(4,0,I);break;case 5:E.splice(2,0,I);break;case 6:E[3]=I;break;case 7:E.splice(3,0,I);break;case 8:E[2]=I}return E}containsTile(h,p,w,E=0){const I=h.queryPadding/p._pixelsPerMercatorPixel+1,B=w?this._bufferedCameraMercator(I,p):this._bufferedScreenMercator(I,p);let U=h.tileID.wrap+(B.unwrapped?E:0);const H=B.polygon.map(_e=>s.getTilePoint(h.tileTransform,_e,U));if(!s.polygonIntersectsBox(H,0,0,s.EXTENT,s.EXTENT))return;U=h.tileID.wrap+(this.screenGeometryMercator.unwrapped?E:0);const J=this.screenGeometryMercator.polygon.map(_e=>s.getTileVec3(h.tileTransform,_e,U)),Y=J.map(_e=>new s.pointGeometry(_e[0],_e[1])),oe=p.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),me=s.getTileVec3(h.tileTransform,oe,U),be=J.map(_e=>{const xe=s.sub(_e,_e,me);return s.normalize(xe,xe),new s.Ray(me,xe)}),we=ze(h,1,p.zoom)*p._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Y,tilespaceRays:be,bufferedTilespaceGeometry:H,bufferedTilespaceBounds:(Me=s.getBounds(H),Me.min.x=s.clamp(Me.min.x,0,s.EXTENT),Me.min.y=s.clamp(Me.min.y,0,s.EXTENT),Me.max.x=s.clamp(Me.max.x,0,s.EXTENT),Me.max.y=s.clamp(Me.max.y,0,s.EXTENT),Me),tile:h,tileID:h.tileID,pixelToTileUnitsFactor:we};var Me}_bufferedScreenMercator(h,p){const w=qt(h);if(this._screenRaycastCache[w])return this._screenRaycastCache[w];{let E;return E=p.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(h),p):{polygon:this.bufferedScreenGeometry(h).map(I=>p.pointCoordinate3D(I)),unwrapped:!0},this._screenRaycastCache[w]=E,E}}_bufferedCameraMercator(h,p){const w=qt(h);if(this._cameraRaycastCache[w])return this._cameraRaycastCache[w];{let E;return E=p.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(h),p):{polygon:this.bufferedCameraGeometry(h).map(I=>p.pointCoordinate3D(I)),unwrapped:!0},this._cameraRaycastCache[w]=E,E}}_projectAndResample(h,p){const w=function(I,B){const U=s.multiply([],B.pixelMatrix,B.globeMatrix),H=[0,-s.GLOBE_RADIUS,0,1],J=[0,s.GLOBE_RADIUS,0,1],Y=[0,0,0,1];s.transformMat4$1(H,H,U),s.transformMat4$1(J,J,U),s.transformMat4$1(Y,Y,U);const oe=new s.pointGeometry(H[0]/H[3],H[1]/H[3]),me=new s.pointGeometry(J[0]/J[3],J[1]/J[3]),be=s.polygonContainsPoint(I,oe)&&H[3]<Y[3],we=s.polygonContainsPoint(I,me)&&J[3]<Y[3];if(!be&&!we)return null;const Me=function(tt,ft,lt){for(let it=1;it<tt.length;it++){const Gt=Nt(ft.pointCoordinate3D(tt[it-1]).x),ot=Nt(ft.pointCoordinate3D(tt[it]).x);if(lt<0){if(Gt<ot)return{idx:it,t:-Gt/(ot-1-Gt)}}else if(ot<Gt)return{idx:it,t:(1-Gt)/(ot+1-Gt)}}return null}(I,B,be?-1:1);if(!Me)return null;const{idx:_e,t:xe}=Me;let ke=_e>1?Et(I.slice(0,_e),B):[],Ce=_e<I.length?Et(I.slice(_e),B):[];ke=ke.map(tt=>new s.pointGeometry(Nt(tt.x),tt.y)),Ce=Ce.map(tt=>new s.pointGeometry(Nt(tt.x),tt.y));const Ue=[...ke];Ue.length===0&&Ue.push(Ce[Ce.length-1]);const Ze=s.number(Ue[Ue.length-1].y,(Ce.length===0?ke[0]:Ce[0]).y,xe);let qe;return qe=be?[new s.pointGeometry(0,Ze),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,Ze)]:[new s.pointGeometry(1,Ze),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,Ze)],Ue.push(...qe),Ce.length===0?Ue.push(ke[0]):Ue.push(...Ce),{polygon:Ue.map(tt=>new s.MercatorCoordinate(tt.x,tt.y)),unwrapped:!1}}(h,p);if(w)return w;const E=function(I,B){let U=!1,H=-1/0,J=0;for(let oe=0;oe<I.length-1;oe++)I[oe].x>H&&(H=I[oe].x,J=oe);for(let oe=0;oe<I.length-1;oe++){const me=(J+oe)%(I.length-1),be=I[me],we=I[me+1];Math.abs(be.x-we.x)>.5&&(be.x<we.x?(be.x+=1,me===0&&(I[I.length-1].x+=1)):(we.x+=1,me+1===I.length-1&&(I[0].x+=1)),U=!0)}const Y=s.mercatorXfromLng(B.center.lng);return U&&Y<Math.abs(Y-1)&&I.forEach(oe=>{oe.x-=1}),{polygon:I,unwrapped:U}}(Et(h,p).map(I=>new s.pointGeometry(Nt(I.x),I.y)),p);return{polygon:E.polygon.map(I=>new s.MercatorCoordinate(I.x,I.y)),unwrapped:E.unwrapped}}}function Et(y,h){return s.resample(y,p=>{const w=h.pointCoordinate3D(p);p.x=w.x,p.y=w.y},1/256)}function Nt(y){return y<0?1+y%1:y%1}function qt(y){return 100*y|0}function wn(y,h,p,w,E){const I=function(B,U){if(B)return E(B);if(U){y.url&&U.tiles&&y.tiles&&delete y.tiles;const H=s.pick(s.extend(U,y),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);U.vector_layers&&(H.vectorLayers=U.vector_layers,H.vectorLayerIds=H.vectorLayers.map(J=>J.id)),H.tiles=h.canonicalizeTileset(H,y.url),E(null,H)}};return y.url?s.getJSON(h.transformRequest(h.normalizeSourceURL(y.url,null,p,w),s.ResourceType.Source),I):s.exported.frame(()=>I(null,y))}class _n{constructor(h,p,w){this.bounds=s.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=p||0,this.maxzoom=w||24}validateBounds(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]}contains(h){const p=Math.pow(2,h.z),w=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*p),E=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*p),I=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*p),B=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*p);return h.x>=w&&h.x<I&&h.y>=E&&h.y<B}}class Ln{constructor(h,p,w){this.context=h;const E=h.gl;this.buffer=E.createBuffer(),this.dynamicDraw=Boolean(w),this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(h){const p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const At={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ot{constructor(h,p,w,E){this.length=p.length,this.attributes=w,this.itemSize=p.bytesPerElement,this.dynamicDraw=E,this.context=h;const I=h.gl;this.buffer=I.createBuffer(),h.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||p.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(h){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,h.arrayBuffer)}enableAttributes(h,p){for(let w=0;w<this.attributes.length;w++){const E=p.attributes[this.attributes[w].name];E!==void 0&&h.enableVertexAttribArray(E)}}setVertexAttribPointers(h,p,w){for(let E=0;E<this.attributes.length;E++){const I=this.attributes[E],B=p.attributes[I.name];B!==void 0&&h.vertexAttribPointer(B,I.components,h[At[I.type]],!1,this.itemSize,I.offset+this.itemSize*(w||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ft{constructor(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(h){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class An extends Ft{getDefault(){return s.Color.transparent}set(h){const p=this.current;(h.r!==p.r||h.g!==p.g||h.b!==p.b||h.a!==p.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class pn extends Ft{getDefault(){return 1}set(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)}}class Vn extends Ft{getDefault(){return 0}set(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)}}class On extends Ft{getDefault(){return[!0,!0,!0,!0]}set(h){const p=this.current;(h[0]!==p[0]||h[1]!==p[1]||h[2]!==p[2]||h[3]!==p[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class Zn extends Ft{getDefault(){return!0}set(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)}}class ai extends Ft{getDefault(){return 255}set(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)}}class Ti extends Ft{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(h){const p=this.current;(h.func!==p.func||h.ref!==p.ref||h.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)}}class Be extends Ft{getDefault(){const h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]}set(h){const p=this.current;(h[0]!==p[0]||h[1]!==p[1]||h[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)}}class Se extends Ft{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;h?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=h,this.dirty=!1}}class St extends Ft{getDefault(){return[0,1]}set(h){const p=this.current;(h[0]!==p[0]||h[1]!==p[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)}}class tn extends Ft{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;h?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=h,this.dirty=!1}}class nn extends Ft{getDefault(){return this.gl.LESS}set(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)}}class fn extends Ft{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;h?p.enable(p.BLEND):p.disable(p.BLEND),this.current=h,this.dirty=!1}}class Nn extends Ft{getDefault(){const h=this.gl;return[h.ONE,h.ZERO]}set(h){const p=this.current;(h[0]!==p[0]||h[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)}}class yn extends Ft{getDefault(){return s.Color.transparent}set(h){const p=this.current;(h.r!==p.r||h.g!==p.g||h.b!==p.b||h.a!==p.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class Lt extends Ft{getDefault(){return this.gl.FUNC_ADD}set(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)}}class Un extends Ft{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;h?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=h,this.dirty=!1}}class Ke extends Ft{getDefault(){return this.gl.BACK}set(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)}}class It extends Ft{getDefault(){return this.gl.CCW}set(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)}}class Zt extends Ft{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}}class sn extends Ft{getDefault(){return this.gl.TEXTURE0}set(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)}}class Yn extends Ft{getDefault(){const h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]}set(h){const p=this.current;(h[0]!==p[0]||h[1]!==p[1]||h[2]!==p[2]||h[3]!==p[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class li extends Ft{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,h),this.current=h,this.dirty=!1}}class Bi extends Ft{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class rt extends Ft{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,h),this.current=h,this.dirty=!1}}class Ct extends Ft{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class Vt extends Ft{getDefault(){return null}set(h){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class bn extends Ft{constructor(h){super(h),this.vao=h.extVertexArrayObject}getDefault(){return null}set(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)}}class Pn extends Ft{getDefault(){return 4}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}}class Ri extends Ft{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}}class cr extends Ft{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}}class Or extends Ft{constructor(h,p){super(h),this.context=h,this.parent=p}getDefault(){return null}}class Cr extends Or{setDirty(){this.dirty=!0}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}}class Gi extends Or{attachment(){return this.gl.DEPTH_ATTACHMENT}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class Kr extends Gi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ee{constructor(h,p,w,E){this.context=h,this.width=p,this.height=w;const I=this.framebuffer=h.gl.createFramebuffer();this.colorAttachment=new Cr(h,I),E&&(this.depthAttachment=new Gi(h,I))}destroy(){const h=this.context.gl,p=this.colorAttachment.get();if(p&&h.deleteTexture(p),this.depthAttachment){const w=this.depthAttachment.get();w&&h.deleteRenderbuffer(w)}h.deleteFramebuffer(this.framebuffer)}}class se{constructor(h){this.gl=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new An(this),this.clearDepth=new pn(this),this.clearStencil=new Vn(this),this.colorMask=new On(this),this.depthMask=new Zn(this),this.stencilMask=new ai(this),this.stencilFunc=new Ti(this),this.stencilOp=new Be(this),this.stencilTest=new Se(this),this.depthRange=new St(this),this.depthTest=new tn(this),this.depthFunc=new nn(this),this.blend=new fn(this),this.blendFunc=new Nn(this),this.blendColor=new yn(this),this.blendEquation=new Lt(this),this.cullFace=new Un(this),this.cullFaceSide=new Ke(this),this.frontFace=new It(this),this.program=new Zt(this),this.activeTexture=new sn(this),this.viewport=new Yn(this),this.bindFramebuffer=new li(this),this.bindRenderbuffer=new Bi(this),this.bindTexture=new rt(this),this.bindVertexBuffer=new Ct(this),this.bindElementBuffer=new Vt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new bn(this),this.pixelStoreUnpack=new Pn(this),this.pixelStoreUnpackPremultiplyAlpha=new Ri(this),this.pixelStoreUnpackFlipY=new cr(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=h.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=h.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=h.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=h.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(h.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h.getExtension("OES_standard_derivatives"),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(h,p){return new Ln(this,h,p)}createVertexBuffer(h,p,w){return new Ot(this,h,p,w)}createRenderbuffer(h,p,w){const E=this.gl,I=E.createRenderbuffer();return this.bindRenderbuffer.set(I),E.renderbufferStorage(E.RENDERBUFFER,h,p,w),this.bindRenderbuffer.set(null),I}createFramebuffer(h,p,w){return new Ee(this,h,p,w)}clear({color:h,depth:p,stencil:w}){const E=this.gl;let I=0;h&&(I|=E.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(I|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),w!==void 0&&(I|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(w),this.stencilMask.set(255)),E.clear(I)}setCullFace(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))}setDepthMode(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)}setStencilMode(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)}setColorMode(h){d(h.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class de extends s.Evented{constructor(h,p,w,E){super(),this.id=h,this.dispatcher=w,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},p),s.extend(this,s.pick(p,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wn(this._options,this.map._requestManager,null,null,(h,p)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new s.ErrorEvent(h)):p&&(s.extend(this,p),p.bounds&&(this.tileBounds=new _n(p.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(p.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(h){this.map=h,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,p){const w=s.exported.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),w,this.tileSize);h.request=s.getImage(this.map._requestManager.transformRequest(E,s.ResourceType.Tile),(I,B,U,H)=>(delete h.request,h.aborted?(h.state="unloaded",p(null)):I?(h.state="errored",p(I)):B?(this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:U,expires:H}),h.setTexture(B,this.map.painter),h.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void p(null)):p(null)))}static loadTileData(h,p,w){h.setTexture(p,w)}static unloadTileData(h,p){h.texture&&p.saveTileTexture(h.texture)}abortTile(h,p){h.request&&(h.request.cancel(),delete h.request),p()}unloadTile(h,p){h.texture&&this.map.painter.saveTileTexture(h.texture),p()}hasTransition(){return!1}}let Ie;function ee(y,h,p,w,E,I,B,U){const H=[y,p,E,h,w,I,1,1,1],J=[B,U,1],Y=s.adjoint([],H),[oe,me,be]=s.transformMat3(J,J,s.transpose(Y,Y));return s.multiply$1(H,[oe,0,0,0,me,0,0,0,be],H)}class pe extends s.Evented{constructor(h,p,w,E){super(),this.id=h,this.dispatcher=w,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=p,this._dirty=!1}load(h,p){this._loaded=p||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(w,E)=>{if(this._imageRequest=null,this._loaded=!0,w)this.fire(new s.ErrorEvent(w));else if(E){const{HTMLImageElement:I}=s.window;this.image=E instanceof I?s.exported.getImageData(E):E,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,h&&(this.coordinates=h),this._finishLoading()}})}loaded(){return this._loaded}updateImage(h){return this.image&&h.url?(this._imageRequest&&h.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=h.url,this.load(h.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(h){this.map=h,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(h){this.coordinates=h,this._boundsArray=void 0;const p=h.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(w){let E=1/0,I=1/0,B=-1/0,U=-1/0;for(const oe of w)E=Math.min(E,oe.x),I=Math.min(I,oe.y),B=Math.max(B,oe.x),U=Math.max(U,oe.y);const H=Math.max(B-E,U-I),J=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),Y=Math.pow(2,J);return new s.CanonicalTileID(J,Math.floor((E+B)/2*Y),Math.floor((I+U)/2*Y))}(p),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(h){for(const H in this.tiles){const J=this.tiles[H];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture)}if(this._boundsArray)return;const p=s.tileTransform(this.tileID,this.map.transform.projection),[w,E,I,B]=this.coordinates.map(H=>{const J=p.projection.project(H[0],H[1]);return s.getTilePoint(p,J)._round()});this.perspectiveTransform=function(H,J,Y,oe,me,be,we,Me,_e,xe){const ke=ee(0,0,H,0,0,J,H,J),Ce=ee(Y,oe,me,be,we,Me,_e,xe);return s.multiply$1(Ce,s.adjoint(ke,ke),Ce),[Ce[6]/Ce[8]*H/s.EXTENT,Ce[7]/Ce[8]*J/s.EXTENT]}(this.width,this.height,w.x,w.y,E.x,E.y,B.x,B.y,I.x,I.y);const U=this._boundsArray=new s.StructArrayLayout4i8;U.emplaceBack(w.x,w.y,0,0),U.emplaceBack(E.x,E.y,s.EXTENT,0),U.emplaceBack(B.x,B.y,0,s.EXTENT),U.emplaceBack(I.x,I.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=h.createVertexBuffer(U,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const h=this.map.painter.context,p=h.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(h,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(h)}loadTile(h,p){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},p(null)):(h.state="errored",p(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ae={vector:class extends s.Evented{constructor(y,h,p,w){if(super(),this.id=y,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(h,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(y){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=wn(this._options,this.map._requestManager,h,p,(w,E)=>{this._tileJSONRequest=null,this._loaded=!0,w?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.ErrorEvent(w))):E&&(s.extend(this,E),E.bounds&&(this.tileBounds=new _n(E.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),y&&y(w)})}loaded(){return this._loaded}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}onAdd(y){this.map=y,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const y=this.map.style._getSourceCaches(this.id);for(const h of y)h.clearTiles()})}setSourceProperty(y){y(),this.reload()}setTiles(y){return this._options.tiles=y,this.reload(),this}setUrl(y){return this.url=y,this._options.url=y,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(y,h){const p=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(p,s.ResourceType.Tile),data:void 0,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,tileSize:this.tileSize*y.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:y.isSymbolTile};if(w.request.collectResourceTiming=this._collectResourceTiming,y.actor&&y.state!=="expired")y.state==="loading"?y.reloadCallback=h:y.request=y.actor.send("reloadTile",w,E.bind(this));else if(y.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)y.request=y.actor.send("loadTile",w,E.bind(this),void 0,!0);else{const I=s.loadVectorTile.call({deduped:this._deduped},w,(B,U)=>{B||!U?E.call(this,B):(w.data={cacheControl:U.cacheControl,expires:U.expires,rawData:U.rawData.slice(0)},y.actor&&y.actor.send("loadTile",w,E.bind(this),void 0,!0))},!0);y.request={cancel:I}}function E(I,B){return delete y.request,y.aborted?h(null):I&&I.status!==404?h(I):(B&&B.resourceTiming&&(y.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&y.setExpiryData(B),y.loadVectorData(B,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(y.reloadCallback&&(this.loadTile(y,y.reloadCallback),y.reloadCallback=null)))}}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.actor&&y.actor.send("abortTile",{uid:y.uid,type:this.type,source:this.id})}unloadTile(y){y.unloadVectorData(),y.actor&&y.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:de,"raster-dem":class extends de{constructor(y,h,p,w){super(y,h,p,w),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}loadTile(y,h){const p=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function w(E,I){E&&(y.state="errored",h(E)),I&&(y.dem=I,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",h(null))}y.request=s.getImage(this.map._requestManager.transformRequest(p,s.ResourceType.Tile),function(E,I,B,U){if(delete y.request,y.aborted)y.state="unloaded",h(null);else if(E)y.state="errored",h(E);else if(I){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:B,expires:U});const H=s.window.ImageBitmap&&I instanceof s.window.ImageBitmap&&(Ie==null&&(Ie=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),Ie),J=1-(I.width-s.prevPowerOfTwo(I.width))/2;J<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const Y=H?I:s.exported.getImageData(I,J),oe={uid:y.uid,coord:y.tileID,source:this.id,rawImageData:Y,encoding:this.encoding,padding:J};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadDEMTile",oe,w.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(y){const h=y.canonical,p=Math.pow(2,h.z),w=(h.x-1+p)%p,E=h.x===0?y.wrap-1:y.wrap,I=(h.x+1+p)%p,B=h.x+1===p?y.wrap+1:y.wrap,U={};return U[new s.OverscaledTileID(y.overscaledZ,E,h.z,w,h.y).key]={backfilled:!1},U[new s.OverscaledTileID(y.overscaledZ,B,h.z,I,h.y).key]={backfilled:!1},h.y>0&&(U[new s.OverscaledTileID(y.overscaledZ,E,h.z,w,h.y-1).key]={backfilled:!1},U[new s.OverscaledTileID(y.overscaledZ,y.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},U[new s.OverscaledTileID(y.overscaledZ,B,h.z,I,h.y-1).key]={backfilled:!1}),h.y+1<p&&(U[new s.OverscaledTileID(y.overscaledZ,E,h.z,w,h.y+1).key]={backfilled:!1},U[new s.OverscaledTileID(y.overscaledZ,y.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},U[new s.OverscaledTileID(y.overscaledZ,B,h.z,I,h.y+1).key]={backfilled:!1}),U}unloadTile(y){y.demTexture&&this.map.painter.saveTileTexture(y.demTexture),y.fbo&&(y.fbo.destroy(),delete y.fbo),y.dem&&delete y.dem,delete y.neighboringTiles,y.state="unloaded"}},geojson:class extends s.Evented{constructor(y,h,p,w){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(w),this._data=h.data,this._options=s.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const E=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*E,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*E,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:s.EXTENT,radius:(h.clusterRadius!==void 0?h.clusterRadius:50)*E,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}getClusterExpansionZoom(y,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id},h),this}getClusterChildren(y,h){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id},h),this}getClusterLeaves(y,h,p,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:y,limit:h,offset:p},w),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const y=s.extend({},this.workerOptions),h=this._data;typeof h=="string"?(y.request=this.map._requestManager.transformRequest(s.exported.resolveURL(h),s.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,y,(p,w)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.ErrorEvent(p));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(E.resourceTiming=w.resourceTiming[this.id]),this.fire(new s.Event("data",E)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(y,h){const p=y.actor?"reloadTile":"loadTile";y.actor=this.actor,y.request=this.actor.send(p,{type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(w,E)=>(delete y.request,y.unloadVectorData(),y.aborted?h(null):w?h(w):(y.loadVectorData(E,this.map.painter,p==="reloadTile"),h(null))),void 0,p==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y){y.unloadVectorData(),this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pe{constructor(y,h,p,w){super(y,h,p,w),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const h of y.urls)this.urls.push(this.map._requestManager.transformRequest(h,s.ResourceType.Source).url);s.getVideo(this.urls,(h,p)=>{this._loaded=!0,h?this.fire(new s.ErrorEvent(h)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const h=this.video.seekable;y<h.start(0)||y>h.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,h=y.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(y,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pe,canvas:class extends pe{constructor(y,h,p,w){super(y,h,p,w),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(I=>typeof I!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context;this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(h,this.canvas,h.gl.RGBA,{premultiply:!0}),this._prepareData(h)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends s.Evented{constructor(y,h,p,w){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=p,this._implementation=h,this.setEventedParent(w),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _n(this._implementation.bounds,this.minzoom,this.maxzoom)),h.update=this._update.bind(this),h.clearTiles=this._clearTiles.bind(this),h.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(h,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this._map=y,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:h,y:p,z:w}=y.canonical;return this._implementation.hasTile({x:h,y:p,z:w})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,h){const{x:p,y:w,z:E}=y.tileID.canonical,I=new s.window.AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:p,y:w,z:E},{signal:I.signal})).then(function(B){return delete y.request,y.aborted?(y.state="unloaded",h(null)):B===void 0?(y.state="errored",h(null)):B===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",h(null)):function(U){return U instanceof s.window.ImageData||U instanceof s.window.HTMLCanvasElement||U instanceof s.window.ImageBitmap||U instanceof s.window.HTMLImageElement}(B)?(this.loadTileData(y,B),y.state="loaded",void h(null)):(y.state="errored",h(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(B=>{B.code!==20&&(y.state="errored",h(B))}),y.request.cancel=()=>I.abort()}loadTileData(y,h){de.loadTileData(y,h,this._map.painter)}unloadTileData(y){de.unloadTileData(y,this._map.painter)}unloadTile(y,h){if(this.unloadTileData(y),this._implementation.unloadTile){const{x:p,y:w,z:E}=y.tileID.canonical;this._implementation.unloadTile({x:p,y:w,z:E})}h()}abortTile(y,h){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),h()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ye=function(y,h,p,w){const E=new Ae[h.type](y,h,p,w);if(E.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${E.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],E),E};function ve(y,h){const p=s.identity([]);return s.scale(p,p,[.5*y.width,.5*-y.height,1]),s.translate(p,p,[1,-1,0]),s.multiply(p,p,y.calculateProjMatrix(h.toUnwrapped())),Float32Array.from(p)}function Je(y,h,p,w,E,I,B,U=!1){const H=y.tilesIn(w,B,U);H.sort(zt);const J=[];for(const oe of H)J.push({wrappedTileID:oe.tile.tileID.wrapped().key,queryResults:oe.tile.queryRenderedFeatures(h,p,y._state,oe,E,I,ve(y.transform,oe.tile.tileID),U)});const Y=function(oe){const me={},be={};for(const we of oe){const Me=we.queryResults,_e=we.wrappedTileID,xe=be[_e]=be[_e]||{};for(const ke in Me){const Ce=Me[ke],Ue=xe[ke]=xe[ke]||{},Ze=me[ke]=me[ke]||[];for(const qe of Ce)Ue[qe.featureIndex]||(Ue[qe.featureIndex]=!0,Ze.push(qe))}}return me}(J);for(const oe in Y)Y[oe].forEach(me=>{const be=me.feature,we=be.layer;we&&we.type!=="background"&&we.type!=="sky"&&(be.source=we.source,we["source-layer"]&&(be.sourceLayer=we["source-layer"]),be.state=be.id!==void 0?y.getFeatureState(we["source-layer"],be.id):{})});return Y}function ht(y,h){const p=y.getRenderableIds().map(I=>y.getTileByID(I)),w=[],E={};for(let I=0;I<p.length;I++){const B=p[I],U=B.tileID.canonical.key;E[U]||(E[U]=!0,B.querySourceFeatures(w,h))}return w}function zt(y,h){const p=y.tileID,w=h.tileID;return p.overscaledZ-w.overscaledZ||p.canonical.y-w.canonical.y||p.wrap-w.wrap||p.canonical.x-w.canonical.x}function vt(){return nd.workerClass!=null?new nd.workerClass:new s.window.Worker(nd.workerUrl)}const Kt="mapboxgl_preloaded_worker_pool";class Yt{constructor(){this.active={}}acquire(h){if(!this.workers)for(this.workers=[];this.workers.length<Yt.workerCount;)this.workers.push(new vt);return this.active[h]=!0,this.workers.slice()}release(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Kt]}numActive(){return Object.keys(this.active).length}}let Xt;function gn(){return Xt||(Xt=new Yt),Xt}function $n(y,h){const p={};for(const w in y)w!=="ref"&&(p[w]=y[w]);return s.refProperties.forEach(w=>{w in h&&(p[w]=h[w])}),p}function ii(y){y=y.slice();const h=Object.create(null);for(let p=0;p<y.length;p++)h[y[p].id]=y[p];for(let p=0;p<y.length;p++)"ref"in y[p]&&(y[p]=$n(y[p],h[y[p].ref]));return y}Yt.workerCount=2;const Sn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Kn(y,h,p){p.push({command:Sn.addSource,args:[y,h[y]]})}function kn(y,h,p){h.push({command:Sn.removeSource,args:[y]}),p[y]=!0}function hs(y,h,p,w){kn(y,p,w),Kn(y,h,p)}function Qi(y,h,p){let w;for(w in y[p])if(y[p].hasOwnProperty(w)&&w!=="data"&&!d(y[p][w],h[p][w]))return!1;for(w in h[p])if(h[p].hasOwnProperty(w)&&w!=="data"&&!d(y[p][w],h[p][w]))return!1;return!0}function Fr(y,h,p,w,E,I){let B;for(B in h=h||{},y=y||{})y.hasOwnProperty(B)&&(d(y[B],h[B])||p.push({command:I,args:[w,B,h[B],E]}));for(B in h)h.hasOwnProperty(B)&&!y.hasOwnProperty(B)&&(d(y[B],h[B])||p.push({command:I,args:[w,B,h[B],E]}))}function wt(y){return y.id}function Ss(y,h){return y[h.id]=h,y}class er{constructor(h,p){this.reset(h,p)}reset(h,p){this.points=h||[],this._distances=[0];for(let w=1;w<this.points.length;w++)this._distances[w]=this._distances[w-1]+this.points[w].dist(this.points[w-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(h){if(this.points.length===1)return this.points[0];h=s.clamp(h,0,1);let p=1,w=this._distances[p];const E=h*this.paddedLength+this.padding;for(;w<E&&p<this._distances.length;)w=this._distances[++p];const I=p-1,B=this._distances[I],U=w-B,H=U>0?(E-B)/U:0;return this.points[I].mult(1-H).add(this.points[p].mult(H))}}class Ni{constructor(h,p,w){const E=this.boxCells=[],I=this.circleCells=[];this.xCellCount=Math.ceil(h/w),this.yCellCount=Math.ceil(p/w);for(let B=0;B<this.xCellCount*this.yCellCount;B++)E.push([]),I.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=p,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(h,p,w,E,I){this._forEachCell(p,w,E,I,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(p),this.bboxes.push(w),this.bboxes.push(E),this.bboxes.push(I)}insertCircle(h,p,w,E){this._forEachCell(p-E,w-E,p+E,w+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(p),this.circles.push(w),this.circles.push(E)}_insertBoxCell(h,p,w,E,I,B){this.boxCells[I].push(B)}_insertCircleCell(h,p,w,E,I,B){this.circleCells[I].push(B)}_query(h,p,w,E,I,B){if(w<0||h>this.width||E<0||p>this.height)return!I&&[];const U=[];if(h<=0&&p<=0&&this.width<=w&&this.height<=E){if(I)return!0;for(let H=0;H<this.boxKeys.length;H++)U.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const J=this.circles[3*H],Y=this.circles[3*H+1],oe=this.circles[3*H+2];U.push({key:this.circleKeys[H],x1:J-oe,y1:Y-oe,x2:J+oe,y2:Y+oe})}return B?U.filter(B):U}return this._forEachCell(h,p,w,E,this._queryCell,U,{hitTest:I,seenUids:{box:{},circle:{}}},B),I?U.length>0:U}_queryCircle(h,p,w,E,I){const B=h-w,U=h+w,H=p-w,J=p+w;if(U<0||B>this.width||J<0||H>this.height)return!E&&[];const Y=[];return this._forEachCell(B,H,U,J,this._queryCellCircle,Y,{hitTest:E,circle:{x:h,y:p,radius:w},seenUids:{box:{},circle:{}}},I),E?Y.length>0:Y}query(h,p,w,E,I){return this._query(h,p,w,E,!1,I)}hitTest(h,p,w,E,I){return this._query(h,p,w,E,!0,I)}hitTestCircle(h,p,w,E){return this._queryCircle(h,p,w,!0,E)}_queryCell(h,p,w,E,I,B,U,H){const J=U.seenUids,Y=this.boxCells[I];if(Y!==null){const me=this.bboxes;for(const be of Y)if(!J.box[be]){J.box[be]=!0;const we=4*be;if(h<=me[we+2]&&p<=me[we+3]&&w>=me[we+0]&&E>=me[we+1]&&(!H||H(this.boxKeys[be]))){if(U.hitTest)return B.push(!0),!0;B.push({key:this.boxKeys[be],x1:me[we],y1:me[we+1],x2:me[we+2],y2:me[we+3]})}}}const oe=this.circleCells[I];if(oe!==null){const me=this.circles;for(const be of oe)if(!J.circle[be]){J.circle[be]=!0;const we=3*be;if(this._circleAndRectCollide(me[we],me[we+1],me[we+2],h,p,w,E)&&(!H||H(this.circleKeys[be]))){if(U.hitTest)return B.push(!0),!0;{const Me=me[we],_e=me[we+1],xe=me[we+2];B.push({key:this.circleKeys[be],x1:Me-xe,y1:_e-xe,x2:Me+xe,y2:_e+xe})}}}}}_queryCellCircle(h,p,w,E,I,B,U,H){const J=U.circle,Y=U.seenUids,oe=this.boxCells[I];if(oe!==null){const be=this.bboxes;for(const we of oe)if(!Y.box[we]){Y.box[we]=!0;const Me=4*we;if(this._circleAndRectCollide(J.x,J.y,J.radius,be[Me+0],be[Me+1],be[Me+2],be[Me+3])&&(!H||H(this.boxKeys[we])))return B.push(!0),!0}}const me=this.circleCells[I];if(me!==null){const be=this.circles;for(const we of me)if(!Y.circle[we]){Y.circle[we]=!0;const Me=3*we;if(this._circlesCollide(be[Me],be[Me+1],be[Me+2],J.x,J.y,J.radius)&&(!H||H(this.circleKeys[we])))return B.push(!0),!0}}}_forEachCell(h,p,w,E,I,B,U,H){const J=this._convertToXCellCoord(h),Y=this._convertToYCellCoord(p),oe=this._convertToXCellCoord(w),me=this._convertToYCellCoord(E);for(let be=J;be<=oe;be++)for(let we=Y;we<=me;we++)if(I.call(this,h,p,w,E,this.xCellCount*we+be,B,U,H))return}_convertToXCellCoord(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))}_convertToYCellCoord(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))}_circlesCollide(h,p,w,E,I,B){const U=E-h,H=I-p,J=w+B;return J*J>U*U+H*H}_circleAndRectCollide(h,p,w,E,I,B,U){const H=(B-E)/2,J=Math.abs(h-(E+H));if(J>H+w)return!1;const Y=(U-I)/2,oe=Math.abs(p-(I+Y));if(oe>Y+w)return!1;if(J<=H||oe<=Y)return!0;const me=J-H,be=oe-Y;return me*me+be*be<=w*w}}const zi=Math.tan(85*Math.PI/180);function ci(y,h,p,w,E,I,B){const U=s.create();if(p)if(I.name==="globe"){const H=s.calculateGlobeLabelMatrix(E,h);s.multiply(U,U,H)}else{const H=ne([],B);U[0]=H[0],U[1]=H[1],U[4]=H[2],U[5]=H[3],w||s.rotateZ(U,U,E.angle)}else s.multiply(U,E.labelPlaneMatrix,y);return U}function yr(y,h,p,w,E,I,B){const U=ci(y,h,p,w,E,I,B);return I.name==="globe"&&p||(U[2]=U[6]=U[10]=U[14]=0),U}function Nr(y,h,p,w,E,I,B){if(p){if(I.name==="globe"){const U=ci(y,h,p,w,E,I,B);return s.invert(U,U),s.multiply(U,y,U),U}{const U=s.clone(y),H=s.identity([]);return H[0]=B[0],H[1]=B[1],H[4]=B[2],H[5]=B[3],s.multiply(U,U,H),w||s.rotateZ(U,U,-E.angle),U}}return E.glCoordMatrix}function qi(y,h,p,w){const E=[y,h,p,1];p?s.transformMat4$1(E,E,w):xr(E,E,w);const I=E[3];return E[0]/=I,E[1]/=I,E[2]/=I,E}function Jt(y,h){return Math.min(.5+y/h*.5,1.5)}function ni(y,h){const p=y[0]/y[3],w=y[1]/y[3];return p>=-h[0]&&p<=h[0]&&w>=-h[1]&&w<=h[1]}function Jn(y,h,p,w,E,I,B,U,H,J){const Y=p.transform,oe=w?y.textSizeData:y.iconSizeData,me=s.evaluateSizeForZoom(oe,p.transform.zoom),be=Y.projection.name==="globe",we=[256/p.width*2+1,256/p.height*2+1],Me=w?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;Me.clear();let _e=null;be&&(_e=w?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const xe=y.lineVertexArray,ke=w?y.text.placedSymbolArray:y.icon.placedSymbolArray,Ce=p.transform.width/p.transform.height;let Ue,Ze=!1;for(let qe=0;qe<ke.length;qe++){const tt=ke.get(qe),{numGlyphs:ft,writingMode:lt}=tt;if(lt!==s.WritingMode.vertical||Ze||Ue===s.WritingMode.horizontal||(Ze=!0),Ue=lt,(tt.hidden||lt===s.WritingMode.vertical)&&!Ze){Ms(ft,Me);continue}Ze=!1;const it=new s.pointGeometry(tt.tileAnchorX,tt.tileAnchorY);let{x:Gt,y:ot,z:bt}=Y.projection.projectTilePoint(it.x,it.y,J.canonical);if(H){const[mn,cn,Fn]=H(it);Gt+=mn,ot+=cn,bt+=Fn}const mt=[Gt,ot,bt,1];if(s.transformMat4$1(mt,mt,h),!ni(mt,we)){Ms(ft,Me);continue}const Ut=Jt(p.transform.cameraToCenterDistance,mt[3]),gt=s.evaluateSizeForFeature(oe,me,tt),kt=B?gt/Ut:gt*Ut,Dt=qi(Gt,ot,bt,E);if(Dt[3]<=0){Ms(ft,Me);continue}let Ye={};const at=B?null:H,Qt=ri(tt,kt,!1,U,h,E,I,y.glyphOffsetArray,xe,Me,_e,Dt,it,Ye,Ce,at,Y.projection,J,B);Ze=Qt.useVertical,at&&Qt.needsFlipping&&(Ye={}),(Qt.notEnoughRoom||Ze||Qt.needsFlipping&&ri(tt,kt,!0,U,h,E,I,y.glyphOffsetArray,xe,Me,_e,Dt,it,Ye,Ce,at,Y.projection,J,B).notEnoughRoom)&&Ms(ft,Me)}w?(y.text.dynamicLayoutVertexBuffer.updateData(Me),_e&&y.text.globeExtVertexBuffer.updateData(_e)):(y.icon.dynamicLayoutVertexBuffer.updateData(Me),_e&&y.icon.globeExtVertexBuffer.updateData(_e))}function lo(y,h,p,w,E,I,B,U,H,J,Y,oe,me,be,we,Me){const{lineStartIndex:_e,glyphStartIndex:xe,segment:ke}=U,Ce=xe+U.numGlyphs,Ue=_e+U.lineLength,Ze=h.getoffsetX(xe),qe=h.getoffsetX(Ce-1),tt=ds(y*Ze,p,w,E,I,B,ke,_e,Ue,H,J,Y,oe,me,!0,be,we,Me);if(!tt)return null;const ft=ds(y*qe,p,w,E,I,B,ke,_e,Ue,H,J,Y,oe,me,!0,be,we,Me);return ft?{first:tt,last:ft}:null}function Vl(y,h,p,w){return y===s.WritingMode.horizontal&&Math.abs(w)>Math.abs(p)?{useVertical:!0}:y===s.WritingMode.vertical?w>0?{needsFlipping:!0}:null:h!==0&&function(E,I){return E===0||Math.abs(I/E)>zi}(p,w)?h===1?{needsFlipping:!0}:null:p<0?{needsFlipping:!0}:null}function ri(y,h,p,w,E,I,B,U,H,J,Y,oe,me,be,we,Me,_e,xe,ke){const Ce=h/24,Ue=y.lineOffsetX*Ce,Ze=y.lineOffsetY*Ce,{lineStartIndex:qe,glyphStartIndex:tt,numGlyphs:ft,segment:lt,writingMode:it,flipState:Gt}=y,ot=qe+y.lineLength,bt=mt=>{if(Y){const[Dt,Ye,at]=mt.up,Qt=J.length;s.updateGlobeVertexNormal(Y,Qt+0,Dt,Ye,at),s.updateGlobeVertexNormal(Y,Qt+1,Dt,Ye,at),s.updateGlobeVertexNormal(Y,Qt+2,Dt,Ye,at),s.updateGlobeVertexNormal(Y,Qt+3,Dt,Ye,at)}const[Ut,gt,kt]=mt.point;s.addDynamicAttributes(J,Ut,gt,kt,mt.angle)};if(ft>1){const mt=lo(Ce,U,Ue,Ze,p,oe,me,y,H,I,be,Me,!1,_e,xe,ke);if(!mt)return{notEnoughRoom:!0};if(w&&!p){let[Ut,gt,kt]=mt.first.point,[Dt,Ye,at]=mt.last.point;[Ut,gt]=qi(Ut,gt,kt,B),[Dt,Ye]=qi(Dt,Ye,at,B);const Qt=Vl(it,Gt,(Dt-Ut)*we,Ye-gt);if(y.flipState=Qt&&Qt.needsFlipping?1:2,Qt)return Qt}bt(mt.first);for(let Ut=tt+1;Ut<tt+ft-1;Ut++){const gt=ds(Ce*U.getoffsetX(Ut),Ue,Ze,p,oe,me,lt,qe,ot,H,I,be,Me,!1,!1,_e,xe,ke);if(!gt)return J.length-=4*(Ut-tt),{notEnoughRoom:!0};bt(gt)}bt(mt.last)}else{if(w&&!p){const Ut=qi(me.x,me.y,0,E),gt=qe+lt+1,kt=new s.pointGeometry(H.getx(gt),H.gety(gt)),Dt=qi(kt.x,kt.y,0,E),Ye=Dt[3]>0?Dt:kc(me,kt,Ut,1,E,void 0,_e,xe.canonical),at=Vl(it,Gt,(Ye[0]-Ut[0])*we,Ye[1]-Ut[1]);if(y.flipState=at&&at.needsFlipping?1:2,at)return at}const mt=ds(Ce*U.getoffsetX(tt),Ue,Ze,p,oe,me,lt,qe,ot,H,I,be,Me,!1,!1,_e,xe,ke);if(!mt)return{notEnoughRoom:!0};bt(mt)}return{}}function Gl(y,h,p,w,E){const{x:I,y:B,z:U}=w.projectTilePoint(y.x,y.y,h);if(!E)return qi(I,B,U,p);const[H,J,Y]=E(y);return qi(I+H,B+J,U+Y,p)}function kc(y,h,p,w,E,I,B,U){const H=Gl(y.sub(h)._unit()._add(y),U,E,B,I);return s.sub(H,p,H),s.normalize(H,H),s.scaleAndAdd(H,p,H,w)}function ds(y,h,p,w,E,I,B,U,H,J,Y,oe,me,be,we,Me,_e,xe){const ke=w?y-h:y+h;let Ce=ke>0?1:-1,Ue=0;w&&(Ce*=-1,Ue=Math.PI),Ce<0&&(Ue+=Math.PI);let Ze=U+B+(Ce>0?0:1)|0,qe=E,tt=E,ft=0,lt=0;const it=Math.abs(ke),Gt=[],ot=[];let bt=I,mt=bt;const Ut=()=>kc(mt,bt,tt,it-ft+1,Y,me,Me,_e.canonical);for(;ft+lt<=it;){if(Ze+=Ce,Ze<U||Ze>=H)return null;if(tt=qe,mt=bt,Gt.push(tt),be&&ot.push(mt),bt=new s.pointGeometry(J.getx(Ze),J.gety(Ze)),qe=oe[Ze],!qe){const Fn=Gl(bt,_e.canonical,Y,Me,me);qe=Fn[3]>0?oe[Ze]=Fn:Ut()}ft+=lt,lt=s.distance(tt,qe)}we&&me&&(oe[Ze]&&(qe=Ut(),lt=s.distance(tt,qe)),oe[Ze]=qe);const gt=(it-ft)/lt,kt=bt.sub(mt)._mult(gt)._add(mt),Dt=s.sub([],qe,tt),Ye=s.scaleAndAdd([],tt,Dt,gt);let at=[0,0,1],Qt=Dt[0],mn=Dt[1];if(xe&&(at=Me.upVector(_e.canonical,kt.x,kt.y),at[0]!==0||at[1]!==0||at[2]!==1)){const Fn=[at[2],0,-at[0]],Rn=s.cross([],at,Fn);s.normalize(Fn,Fn),s.normalize(Rn,Rn),Qt=s.dot(Dt,Fn),mn=s.dot(Dt,Rn)}if(p){const Fn=s.cross([],at,Dt);s.normalize(Fn,Fn),s.scaleAndAdd(Ye,Ye,Fn,p*Ce)}const cn=Ue+Math.atan2(mn,Qt);return Gt.push(Ye),be&&ot.push(kt),{point:Ye,angle:cn,path:Gt,tilePath:ot,up:at}}function Ms(y,h){const p=h.length,w=p+4*y;h.resize(w),h.float32.fill(-1/0,4*p,4*w)}function xr(y,h,p){const w=h[0],E=h[1];return y[0]=p[0]*w+p[4]*E+p[12],y[1]=p[1]*w+p[5]*E+p[13],y[3]=p[3]*w+p[7]*E+p[15],y}const Da=100;class Wl{constructor(h,p,w=new Ni(h.width+200,h.height+200,25),E=new Ni(h.width+200,h.height+200,25)){this.transform=h,this.grid=w,this.ignoredGrid=E,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+Da,this.screenBottomBoundary=h.height+Da,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200,this.fogState=p}placeCollisionBox(h,p,w,E,I,B,U,H){let J=w.projectedAnchorX,Y=w.projectedAnchorY,oe=w.projectedAnchorZ;const me=w.elevation,be=w.tileID,we=h.getProjection();if(me&&be){const[qe,tt,ft]=we.upVector(be.canonical,w.tileAnchorX,w.tileAnchorY),lt=we.upVectorScale(be.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;J+=qe*me*lt,Y+=tt*me*lt,oe+=ft*me*lt}const Me=this.projectAndGetPerspectiveRatio(U,J,Y,oe,w.tileID,we.name==="globe"||!!me||this.transform.pitch>0,we),_e=B*Me.perspectiveRatio,xe=(w.x1*p+E.x-w.padding)*_e+Me.point.x,ke=(w.y1*p+E.y-w.padding)*_e+Me.point.y,Ce=(w.x2*p+E.x+w.padding)*_e+Me.point.x,Ue=(w.y2*p+E.y+w.padding)*_e+Me.point.y,Ze=Me.perspectiveRatio<=.55||Me.occluded;return!this.isInsideGrid(xe,ke,Ce,Ue)||!I&&this.grid.hitTest(xe,ke,Ce,Ue,H)||Ze?{box:[],offscreen:!1,occluded:Me.occluded}:{box:[xe,ke,Ce,Ue],offscreen:this.isOffscreen(xe,ke,Ce,Ue),occluded:!1}}placeCollisionCircles(h,p,w,E,I,B,U,H,J,Y,oe,me,be,we,Me){const _e=[],xe=this.transform.elevation,ke=h.getProjection(),Ce=xe?xe.getAtTileOffsetFunc(Me,this.transform.center.lat,this.transform.worldSize,ke):null,Ue=new s.pointGeometry(w.tileAnchorX,w.tileAnchorY);let{x:Ze,y:qe,z:tt}=ke.projectTilePoint(Ue.x,Ue.y,Me.canonical);if(Ce){const[kt,Dt,Ye]=Ce(Ue);Ze+=kt,qe+=Dt,tt+=Ye}const ft=ke.name==="globe",lt=this.projectAndGetPerspectiveRatio(U,Ze,qe,tt,Me,ft||!!xe||this.transform.pitch>0,ke),{perspectiveRatio:it}=lt,Gt=(oe?B/it:B*it)/s.ONE_EM,ot=qi(Ze,qe,tt,H),bt=lt.signedDistanceFromCamera>0?lo(Gt,I,w.lineOffsetX*Gt,w.lineOffsetY*Gt,!1,ot,Ue,w,E,H,{},xe&&!oe?Ce:null,oe&&!!xe,ke,Me,oe):null;let mt=!1,Ut=!1,gt=!0;if(bt&&!lt.occluded){const kt=.5*be*it+we,Dt=new s.pointGeometry(-100,-100),Ye=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),at=new er,{first:Qt,last:mn}=bt,cn=Qt.path.length;let Fn=[];for(let an=cn-1;an>=1;an--)Fn.push(Qt.path[an]);for(let an=1;an<mn.path.length;an++)Fn.push(mn.path[an]);const Rn=2.5*kt;J&&(Fn=Fn.map(([an,ki,bi],Di)=>(Ce&&!ft&&(bi=Ce(Di<cn-1?Qt.tilePath[cn-1-Di]:mn.tilePath[Di-cn+2])[2]),qi(an,ki,bi,J))),Fn.some(an=>an[3]<=0)&&(Fn=[]));let Cn=[];if(Fn.length>0){let an=1/0,ki=-1/0,bi=1/0,Di=-1/0;for(const si of Fn)an=Math.min(an,si[0]),bi=Math.min(bi,si[1]),ki=Math.max(ki,si[0]),Di=Math.max(Di,si[1]);ki>=Dt.x&&an<=Ye.x&&Di>=Dt.y&&bi<=Ye.y&&(Cn=[Fn.map(si=>new s.pointGeometry(si[0],si[1]))],(an<Dt.x||ki>Ye.x||bi<Dt.y||Di>Ye.y)&&(Cn=s.clipLine(Cn,Dt.x,Dt.y,Ye.x,Ye.y)))}for(const an of Cn){at.reset(an,.25*kt);let ki=0;ki=at.length<=.5*kt?1:Math.ceil(at.paddedLength/Rn)+1;for(let bi=0;bi<ki;bi++){const Di=bi/Math.max(ki-1,1),si=at.lerp(Di),Ns=si.x+Da,Ys=si.y+Da;_e.push(Ns,Ys,kt,0);const jr=Ns-kt,Po=Ys-kt,Zi=Ns+kt,Si=Ys+kt;if(gt=gt&&this.isOffscreen(jr,Po,Zi,Si),Ut=Ut||this.isInsideGrid(jr,Po,Zi,Si),!p&&this.grid.hitTestCircle(Ns,Ys,kt,me)&&(mt=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:mt,occluded:!1}}}}return{circles:!Y&&mt||!Ut?[]:_e,offscreen:gt,collisionDetected:mt,occluded:lt.occluded}}queryRenderedSymbols(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let w=1/0,E=1/0,I=-1/0,B=-1/0;for(const Y of h){const oe=new s.pointGeometry(Y.x+Da,Y.y+Da);w=Math.min(w,oe.x),E=Math.min(E,oe.y),I=Math.max(I,oe.x),B=Math.max(B,oe.y),p.push(oe)}const U=this.grid.query(w,E,I,B).concat(this.ignoredGrid.query(w,E,I,B)),H={},J={};for(const Y of U){const oe=Y.key;if(H[oe.bucketInstanceId]===void 0&&(H[oe.bucketInstanceId]={}),H[oe.bucketInstanceId][oe.featureIndex])continue;const me=[new s.pointGeometry(Y.x1,Y.y1),new s.pointGeometry(Y.x2,Y.y1),new s.pointGeometry(Y.x2,Y.y2),new s.pointGeometry(Y.x1,Y.y2)];s.polygonIntersectsPolygon(p,me)&&(H[oe.bucketInstanceId][oe.featureIndex]=!0,J[oe.bucketInstanceId]===void 0&&(J[oe.bucketInstanceId]=[]),J[oe.bucketInstanceId].push(oe.featureIndex))}return J}insertCollisionBox(h,p,w,E,I){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:E,collisionGroupID:I},h[0],h[1],h[2],h[3])}insertCollisionCircles(h,p,w,E,I){const B=p?this.ignoredGrid:this.grid,U={bucketInstanceId:w,featureIndex:E,collisionGroupID:I};for(let H=0;H<h.length;H+=4)B.insertCircle(U,h[H],h[H+1],h[H+2])}projectAndGetPerspectiveRatio(h,p,w,E,I,B,U){const H=[p,w,E,1];let J=!1;if(E||this.transform.pitch>0){s.transformMat4$1(H,H,h);const oe=U.name==="globe";this.fogState&&I&&!oe&&(J=function(be,we,Me,_e,xe,ke){const Ce=ke.calculateFogTileMatrix(xe),Ue=[we,Me,_e];return s.transformMat4(Ue,Ue,Ce),ce(be,Ue,ke.pitch,ke._fov)}(this.fogState,p,w,E,I.toUnwrapped(),this.transform)>.9)}else xr(H,H,h);const Y=H[3];return{point:new s.pointGeometry((H[0]/Y+1)/2*this.transform.width+Da,(-H[1]/Y+1)/2*this.transform.height+Da),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(U)/Y*.5,1.5),signedDistanceFromCamera:Y,occluded:B&&H[2]>Y||J}}isOffscreen(h,p,w,E){return w<Da||h>=this.screenRightBoundary||E<Da||p>this.screenBottomBoundary}isInsideGrid(h,p,w,E){return w>=0&&h<this.gridRightBoundary&&E>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const h=s.identity([]);return s.translate(h,h,[-100,-100,0]),h}}function Hl(y,h,p){const w=h.createTileMatrix(y,y.worldSize,p.toUnwrapped());return s.multiply(new Float32Array(16),y.projMatrix,w)}function il(y,h,p){if(h.projection.name===p.projection.name)return y.projMatrix;const w=p.clone();return w.setProjection(h.projection),Hl(w,h.getProjection(),y)}function jl(y,h,p){return h.name===p.projection.name?y.projMatrix:Hl(p,h,y)}class Lp{constructor(h,p,w,E){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?p:-p))):E&&w?1:0,this.placed=w}isHidden(){return this.opacity===0&&!this.placed}}class ql{constructor(h,p,w,E,I,B=!1){this.text=new Lp(h?h.text:null,p,w,I),this.icon=new Lp(h?h.icon:null,p,E,I),this.clipped=B}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Dc{constructor(h,p,w,E=!1){this.text=h,this.icon=p,this.skipFade=w,this.clipped=E}}class Ru{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Lc{constructor(h,p,w,E,I){this.bucketInstanceId=h,this.featureIndex=p,this.sourceLayerIndex=w,this.bucketIndex=E,this.tileID=I}}class co{constructor(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}}get(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){const p=++this.maxGroupID;this.collisionGroups[h]={ID:p,predicate:w=>w.collisionGroupID===p}}return this.collisionGroups[h]}}function vr(y,h,p,w,E){const{horizontalAlign:I,verticalAlign:B}=s.getAnchorAlignment(y),U=-(I-.5)*h,H=-(B-.5)*p,J=s.evaluateVariableOffset(y,w);return new s.pointGeometry(U+J[0]*E,H+J[1]*E)}function Ei(y,h,p,w,E){const I=new s.pointGeometry(y,h);return p&&I._rotate(w?E:-E),I}class $d{constructor(h,p,w,E,I){this.transform=h.clone(),this.projection=h.projection.name,this.collisionIndex=new Wl(this.transform,I),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new co(w),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(h,p,w,E){const I=w.getBucket(p),B=w.latestFeatureIndex;if(!I||!B||p.id!==I.layerIds[0])return;const U=I.layers[0].layout,H=w.collisionBoxArray,J=Math.pow(2,this.transform.zoom-w.tileID.overscaledZ),Y=w.tileSize/s.EXTENT,oe=w.tileID.toUnwrapped();this.transform.setProjection(I.projection);const me=(be=w.tileID,we=I.getProjection(),Me=this.transform,we.name===this.projection?Me.calculateProjMatrix(be.toUnwrapped()):Hl(Me,we,be));var be,we,Me;const _e=U.get("text-pitch-alignment")==="map",xe=U.get("text-rotation-alignment")==="map";p.compileFilter();const ke=p.dynamicFilter(),Ce=p.dynamicFilterNeedsFeature(),Ue=this.transform.calculatePixelsToTileUnitsMatrix(w),Ze=yr(me,w.tileID.canonical,_e,xe,this.transform,I.getProjection(),Ue);let qe=null;if(_e){const lt=Nr(me,w.tileID.canonical,_e,xe,this.transform,I.getProjection(),Ue);qe=s.multiply([],this.transform.labelPlaneMatrix,lt)}let tt=null;ke&&w.latestFeatureIndex&&(tt={unwrappedTileID:oe,dynamicFilter:ke,dynamicFilterNeedsFeature:Ce,featureIndex:w.latestFeatureIndex}),this.retainedQueryData[I.bucketInstanceId]=new Lc(I.bucketInstanceId,B,I.sourceLayerIndex,I.index,w.tileID);const ft={bucket:I,layout:U,posMatrix:me,textLabelPlaneMatrix:Ze,labelToScreenMatrix:qe,clippingData:tt,scale:J,textPixelRatio:Y,holdingForFade:w.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(I.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(I.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(I.sourceID)};if(E)for(const lt of I.sortKeyRanges){const{sortKey:it,symbolInstanceStart:Gt,symbolInstanceEnd:ot}=lt;h.push({sortKey:it,symbolInstanceStart:Gt,symbolInstanceEnd:ot,parameters:ft})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:ft})}attemptAnchorPlacement(h,p,w,E,I,B,U,H,J,Y,oe,me,be,we,Me,_e,xe,ke){const{textOffset0:Ce,textOffset1:Ue,crossTileID:Ze}=me,qe=[Ce,Ue],tt=vr(h,w,E,qe,I),ft=this.collisionIndex.placeCollisionBox(we,I,p,Ei(tt.x,tt.y,B,U,this.transform.angle),oe,H,J,Y.predicate);if(_e){const lt=we.getSymbolInstanceIconSize(ke,this.transform.zoom,me.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(we,lt,_e,Ei(tt.x,tt.y,B,U,this.transform.angle),oe,H,J,Y.predicate).box.length===0)return}if(ft.box.length>0){let lt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ze]&&this.prevPlacement.placements[Ze]&&this.prevPlacement.placements[Ze].text&&(lt=this.prevPlacement.variableOffsets[Ze].anchor),this.variableOffsets[Ze]={textOffset:qe,width:w,height:E,anchor:h,textScale:I,prevAnchor:lt},this.markUsedJustification(we,h,me,Me),we.allowVerticalPlacement&&(this.markUsedOrientation(we,Me,me),this.placedOrientations[Ze]=Me),{shift:tt,placedGlyphBoxes:ft}}}placeLayerBucketPart(h,p,w,E){const{bucket:I,layout:B,posMatrix:U,textLabelPlaneMatrix:H,labelToScreenMatrix:J,clippingData:Y,textPixelRatio:oe,holdingForFade:me,collisionBoxArray:be,partiallyEvaluatedTextSize:we,partiallyEvaluatedIconSize:Me,collisionGroup:_e}=h.parameters,xe=B.get("text-optional"),ke=B.get("icon-optional"),Ce=B.get("text-allow-overlap"),Ue=B.get("icon-allow-overlap"),Ze=B.get("text-rotation-alignment")==="map",qe=B.get("text-pitch-alignment")==="map",tt=B.get("icon-text-fit")!=="none",ft=B.get("symbol-z-order")==="viewport-y";this.transform.setProjection(I.projection);let lt=Ce&&(Ue||!I.hasIconData()||ke),it=Ue&&(Ce||!I.hasTextData()||xe);!I.collisionArrays&&be&&I.deserializeCollisionBoxes(be),w&&E&&I.updateCollisionDebugBuffers(this.transform.zoom,be);const Gt=(ot,bt,mt)=>{const{crossTileID:Ut,numVerticalGlyphVertices:gt}=ot;if(Y){const Zi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Si=null;if(Y.dynamicFilterNeedsFeature){const yi=this.retainedQueryData[I.bucketInstanceId];Si=Y.featureIndex.loadFeature({featureIndex:ot.featureIndex,bucketIndex:yi.bucketIndex,sourceLayerIndex:yi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,Y.dynamicFilter)(Zi,Si,this.retainedQueryData[I.bucketInstanceId].tileID.canonical,new s.pointGeometry(ot.tileAnchorX,ot.tileAnchorY),this.transform.calculateDistanceTileData(Y.unwrappedTileID)))return this.placements[Ut]=new Dc(!1,!1,!1,!0),void(p[Ut]=!0)}if(p[Ut])return;if(me)return void(this.placements[Ut]=new Dc(!1,!1,!1));let kt=!1,Dt=!1,Ye=!0,at=!1,Qt=!1,mn=null,cn={box:null,offscreen:null,occluded:null},Fn={box:null,offscreen:null,occluded:null},Rn=null,Cn=null,an=null,ki=0,bi=0,Di=0;mt.textFeatureIndex?ki=mt.textFeatureIndex:ot.useRuntimeCollisionCircles&&(ki=ot.featureIndex),mt.verticalTextFeatureIndex&&(bi=mt.verticalTextFeatureIndex);const si=Zi=>{Zi.tileID=this.retainedQueryData[I.bucketInstanceId].tileID;const Si=this.transform.elevation;(Si||Zi.elevation)&&(Zi.elevation=Si?Si.getAtTileOffset(Zi.tileID,Zi.tileAnchorX,Zi.tileAnchorY):0)},Ns=mt.textBox;if(Ns){si(Ns);const Zi=yi=>{let tr=s.WritingMode.horizontal;if(I.allowVerticalPlacement&&!yi&&this.prevPlacement){const ts=this.prevPlacement.placedOrientations[Ut];ts&&(this.placedOrientations[Ut]=ts,tr=ts,this.markUsedOrientation(I,tr,ot))}return tr},Si=(yi,tr)=>{if(I.allowVerticalPlacement&&gt>0&&mt.verticalTextBox){for(const ts of I.writingModes)if(ts===s.WritingMode.vertical?(cn=tr(),Fn=cn):cn=yi(),cn&&cn.box&&cn.box.length)break}else cn=yi()};if(B.get("text-variable-anchor")){let yi=B.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ut]){const Oi=this.prevPlacement.variableOffsets[Ut];yi.indexOf(Oi.anchor)>0&&(yi=yi.filter(Cs=>Cs!==Oi.anchor),yi.unshift(Oi.anchor))}const tr=(Oi,Cs,tc)=>{const qo=I.getSymbolInstanceTextSize(we,ot,this.transform.zoom,bt),$i=(Oi.x2-Oi.x1)*qo+2*Oi.padding,ns=(Oi.y2-Oi.y1)*qo+2*Oi.padding,Ur=tt&&!Ue?Cs:null;Ur&&si(Ur);let ko={box:[],offscreen:!1,occluded:!1};const ms=Ce?2*yi.length:yi.length;for(let nu=0;nu<ms;++nu){const Zo=this.attemptAnchorPlacement(yi[nu%yi.length],Oi,$i,ns,qo,Ze,qe,oe,U,_e,nu>=yi.length,ot,bt,I,tc,Ur,we,Me);if(Zo&&(ko=Zo.placedGlyphBoxes,ko&&ko.box&&ko.box.length)){kt=!0,mn=Zo.shift;break}}return ko};Si(()=>tr(Ns,mt.iconBox,s.WritingMode.horizontal),()=>{const Oi=mt.verticalTextBox;return Oi&&si(Oi),I.allowVerticalPlacement&&!(cn&&cn.box&&cn.box.length)&&gt>0&&Oi?tr(Oi,mt.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),cn&&(kt=cn.box,Ye=cn.offscreen,at=cn.occluded);const ts=Zi(cn&&cn.box);if(!kt&&this.prevPlacement){const Oi=this.prevPlacement.variableOffsets[Ut];Oi&&(this.variableOffsets[Ut]=Oi,this.markUsedJustification(I,Oi.anchor,ot,ts))}}else{const yi=(tr,ts)=>{const Oi=I.getSymbolInstanceTextSize(we,ot,this.transform.zoom,bt),Cs=this.collisionIndex.placeCollisionBox(I,Oi,tr,new s.pointGeometry(0,0),Ce,oe,U,_e.predicate);return Cs&&Cs.box&&Cs.box.length&&(this.markUsedOrientation(I,ts,ot),this.placedOrientations[Ut]=ts),Cs};Si(()=>yi(Ns,s.WritingMode.horizontal),()=>{const tr=mt.verticalTextBox;return I.allowVerticalPlacement&&gt>0&&tr?(si(tr),yi(tr,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Zi(cn&&cn.box&&cn.box.length)}}if(Rn=cn,kt=Rn&&Rn.box&&Rn.box.length>0,Ye=Rn&&Rn.offscreen,at=Rn&&Rn.occluded,ot.useRuntimeCollisionCircles){const Zi=I.text.placedSymbolArray.get(ot.centerJustifiedTextSymbolIndex>=0?ot.centerJustifiedTextSymbolIndex:ot.verticalPlacedTextSymbolIndex),Si=s.evaluateSizeForFeature(I.textSizeData,we,Zi),yi=B.get("text-padding");Cn=this.collisionIndex.placeCollisionCircles(I,Ce,Zi,I.lineVertexArray,I.glyphOffsetArray,Si,U,H,J,w,qe,_e.predicate,ot.collisionCircleDiameter*Si/s.ONE_EM,yi,this.retainedQueryData[I.bucketInstanceId].tileID),kt=Ce||Cn.circles.length>0&&!Cn.collisionDetected,Ye=Ye&&Cn.offscreen,at=Cn.occluded}if(mt.iconFeatureIndex&&(Di=mt.iconFeatureIndex),mt.iconBox){const Zi=Si=>{si(Si);const yi=tt&&mn?Ei(mn.x,mn.y,Ze,qe,this.transform.angle):new s.pointGeometry(0,0),tr=I.getSymbolInstanceIconSize(Me,this.transform.zoom,ot.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(I,tr,Si,yi,Ue,oe,U,_e.predicate)};Fn&&Fn.box&&Fn.box.length&&mt.verticalIconBox?(an=Zi(mt.verticalIconBox),Dt=an.box.length>0):(an=Zi(mt.iconBox),Dt=an.box.length>0),Ye=Ye&&an.offscreen,Qt=an.occluded}const Ys=xe||ot.numHorizontalGlyphVertices===0&&gt===0,jr=ke||ot.numIconVertices===0;if(Ys||jr?jr?Ys||(Dt=Dt&&kt):kt=Dt&&kt:Dt=kt=Dt&&kt,kt&&Rn&&Rn.box&&this.collisionIndex.insertCollisionBox(Rn.box,B.get("text-ignore-placement"),I.bucketInstanceId,Fn&&Fn.box&&bi?bi:ki,_e.ID),Dt&&an&&this.collisionIndex.insertCollisionBox(an.box,B.get("icon-ignore-placement"),I.bucketInstanceId,Di,_e.ID),Cn&&(kt&&this.collisionIndex.insertCollisionCircles(Cn.circles,B.get("text-ignore-placement"),I.bucketInstanceId,ki,_e.ID),w)){const Zi=I.bucketInstanceId;let Si=this.collisionCircleArrays[Zi];Si===void 0&&(Si=this.collisionCircleArrays[Zi]=new Ru);for(let yi=0;yi<Cn.circles.length;yi+=4)Si.circles.push(Cn.circles[yi+0]),Si.circles.push(Cn.circles[yi+1]),Si.circles.push(Cn.circles[yi+2]),Si.circles.push(Cn.collisionDetected?1:0)}const Po=I.projection.name!=="globe";lt=lt&&(Po||!at),it=it&&(Po||!Qt),this.placements[Ut]=new Dc(kt||lt,Dt||it,Ye||I.justReloaded),p[Ut]=!0};if(ft){const ot=I.getSortedSymbolIndexes(this.transform.angle);for(let bt=ot.length-1;bt>=0;--bt){const mt=ot[bt];Gt(I.symbolInstances.get(mt),mt,I.collisionArrays[mt])}}else for(let ot=h.symbolInstanceStart;ot<h.symbolInstanceEnd;ot++)Gt(I.symbolInstances.get(ot),ot,I.collisionArrays[ot]);if(w&&I.bucketInstanceId in this.collisionCircleArrays){const ot=this.collisionCircleArrays[I.bucketInstanceId];s.invert(ot.invProjMatrix,U),ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1}markUsedJustification(h,p,w,E){const{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:B,rightJustifiedTextSymbolIndex:U,verticalPlacedTextSymbolIndex:H,crossTileID:J}=w,Y=s.getAnchorJustification(p),oe=E===s.WritingMode.vertical?H:Y==="left"?I:Y==="center"?B:Y==="right"?U:-1;I>=0&&(h.text.placedSymbolArray.get(I).crossTileID=oe>=0&&I!==oe?0:J),B>=0&&(h.text.placedSymbolArray.get(B).crossTileID=oe>=0&&B!==oe?0:J),U>=0&&(h.text.placedSymbolArray.get(U).crossTileID=oe>=0&&U!==oe?0:J),H>=0&&(h.text.placedSymbolArray.get(H).crossTileID=oe>=0&&H!==oe?0:J)}markUsedOrientation(h,p,w){const E=p===s.WritingMode.horizontal||p===s.WritingMode.horizontalOnly?p:0,I=p===s.WritingMode.vertical?p:0,{leftJustifiedTextSymbolIndex:B,centerJustifiedTextSymbolIndex:U,rightJustifiedTextSymbolIndex:H,verticalPlacedTextSymbolIndex:J}=w,Y=h.text.placedSymbolArray;B>=0&&(Y.get(B).placedOrientation=E),U>=0&&(Y.get(U).placedOrientation=E),H>=0&&(Y.get(H).placedOrientation=E),J>=0&&(Y.get(J).placedOrientation=I)}commit(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let w=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const E=p?p.symbolFadeChange(h):1,I=p?p.opacities:{},B=p?p.variableOffsets:{},U=p?p.placedOrientations:{};for(const H in this.placements){const J=this.placements[H],Y=I[H];Y?(this.opacities[H]=new ql(Y,E,J.text,J.icon,null,J.clipped),w=w||J.text!==Y.text.placed||J.icon!==Y.icon.placed):(this.opacities[H]=new ql(null,E,J.text,J.icon,J.skipFade,J.clipped),w=w||J.text||J.icon)}for(const H in I){const J=I[H];if(!this.opacities[H]){const Y=new ql(J,E,!1,!1);Y.isHidden()||(this.opacities[H]=Y,w=w||J.text.placed||J.icon.placed)}}for(const H in B)this.variableOffsets[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.variableOffsets[H]=B[H]);for(const H in U)this.placedOrientations[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.placedOrientations[H]=U[H]);w?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:h)}updateLayerOpacities(h,p){const w={};for(const E of p){const I=E.getBucket(h);I&&E.latestFeatureIndex&&h.id===I.layerIds[0]&&this.updateBucketOpacities(I,w,E.collisionBoxArray)}}updateBucketOpacities(h,p,w){h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();const E=h.layers[0].layout,I=!!h.layers[0].dynamicFilter(),B=new ql(null,0,!1,!1,!0),U=E.get("text-allow-overlap"),H=E.get("icon-allow-overlap"),J=E.get("text-variable-anchor"),Y=E.get("text-rotation-alignment")==="map",oe=E.get("text-pitch-alignment")==="map",me=E.get("icon-text-fit")!=="none",be=new ql(null,0,U&&(H||!h.hasIconData()||E.get("icon-optional")),H&&(U||!h.hasTextData()||E.get("text-optional")),!0);!h.collisionArrays&&w&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(w);const we=(_e,xe,ke)=>{for(let Ce=0;Ce<xe/4;Ce++)_e.opacityVertexArray.emplaceBack(ke)};let Me=0;for(let _e=0;_e<h.symbolInstances.length;_e++){const xe=h.symbolInstances.get(_e),{numHorizontalGlyphVertices:ke,numVerticalGlyphVertices:Ce,crossTileID:Ue,numIconVertices:Ze}=xe;let qe=this.opacities[Ue];p[Ue]?qe=B:qe||(qe=be,this.opacities[Ue]=qe),p[Ue]=!0;const tt=ke>0||Ce>0,ft=Ze>0,lt=this.placedOrientations[Ue],it=lt===s.WritingMode.vertical,Gt=lt===s.WritingMode.horizontal||lt===s.WritingMode.horizontalOnly;if(!tt&&!ft||qe.isHidden()||Me++,tt){const ot=fs(qe.text);we(h.text,ke,it?rl:ot),we(h.text,Ce,Gt?rl:ot);const bt=qe.text.isHidden(),{leftJustifiedTextSymbolIndex:mt,centerJustifiedTextSymbolIndex:Ut,rightJustifiedTextSymbolIndex:gt,verticalPlacedTextSymbolIndex:kt}=xe,Dt=h.text.placedSymbolArray,Ye=bt||it?1:0;mt>=0&&(Dt.get(mt).hidden=Ye),Ut>=0&&(Dt.get(Ut).hidden=Ye),gt>=0&&(Dt.get(gt).hidden=Ye),kt>=0&&(Dt.get(kt).hidden=bt||Gt?1:0);const at=this.variableOffsets[Ue];at&&this.markUsedJustification(h,at.anchor,xe,lt);const Qt=this.placedOrientations[Ue];Qt&&(this.markUsedJustification(h,"left",xe,Qt),this.markUsedOrientation(h,Qt,xe))}if(ft){const ot=fs(qe.icon),{placedIconSymbolIndex:bt,verticalPlacedIconSymbolIndex:mt}=xe,Ut=h.icon.placedSymbolArray,gt=qe.icon.isHidden()?1:0;bt>=0&&(we(h.icon,Ze,it?rl:ot),Ut.get(bt).hidden=gt),mt>=0&&(we(h.icon,xe.numVerticalIconVertices,Gt?rl:ot),Ut.get(mt).hidden=gt)}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){const ot=h.collisionArrays[_e];if(ot){let bt=new s.pointGeometry(0,0),mt=!0;if(ot.textBox||ot.verticalTextBox){if(J){const gt=this.variableOffsets[Ue];gt?(bt=vr(gt.anchor,gt.width,gt.height,gt.textOffset,gt.textScale),Y&&bt._rotate(oe?this.transform.angle:-this.transform.angle)):mt=!1}I&&(mt=!qe.clipped),ot.textBox&&Qr(h.textCollisionBox.collisionVertexArray,qe.text.placed,!mt||it,bt.x,bt.y),ot.verticalTextBox&&Qr(h.textCollisionBox.collisionVertexArray,qe.text.placed,!mt||Gt,bt.x,bt.y)}const Ut=mt&&Boolean(!Gt&&ot.verticalIconBox);ot.iconBox&&Qr(h.iconCollisionBox.collisionVertexArray,qe.icon.placed,Ut,me?bt.x:0,me?bt.y:0),ot.verticalIconBox&&Qr(h.iconCollisionBox.collisionVertexArray,qe.icon.placed,!Ut,me?bt.x:0,me?bt.y:0)}}}if(h.fullyClipped=Me===0,h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=_e.invProjMatrix,h.placementViewportMatrix=_e.viewportMatrix,h.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}}symbolFadeChange(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(h){return Math.max(0,(this.transform.zoom-h)/1.5)}hasTransitions(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(h,p){const w=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*w>h}setStale(){this.stale=!0}}function Qr(y,h,p,w,E){y.emplaceBack(h?1:0,p?1:0,w||0,E||0),y.emplaceBack(h?1:0,p?1:0,w||0,E||0),y.emplaceBack(h?1:0,p?1:0,w||0,E||0),y.emplaceBack(h?1:0,p?1:0,w||0,E||0)}const To=Math.pow(2,25),Eg=Math.pow(2,24),Xd=Math.pow(2,17),wi=Math.pow(2,16),Rc=Math.pow(2,9),Rp=Math.pow(2,8),zc=Math.pow(2,1);function fs(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const h=y.placed?1:0,p=Math.floor(127*y.opacity);return p*To+h*Eg+p*Xd+h*wi+p*Rc+h*Rp+p*zc+h}const rl=0;class Uo{constructor(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(h,p,w,E,I){const B=this._bucketParts;for(;this._currentTileIndex<h.length;)if(p.getBucketParts(B,E,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,I())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,B.sort((U,H)=>U.sortKey-H.sortKey));this._currentPartIndex<B.length;){const U=B[this._currentPartIndex];if(p.placeLayerBucketPart(U,this._seenCrossTileIDs,w,U.symbolInstanceStart===0),this._currentPartIndex++,I())return!0}return!1}}class sl{constructor(h,p,w,E,I,B,U,H){this.placement=new $d(h,I,B,U,H),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=w,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(h,p,w){const E=s.exported.now(),I=()=>{const B=s.exported.now()-E;return!this._forceFullPlacement&&B>2};for(;this._currentPlacementIndex>=0;){const B=p[h[this._currentPlacementIndex]],U=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=U)&&(!B.maxzoom||B.maxzoom>U)){if(this._inProgressLayer||(this._inProgressLayer=new Uo(B)),this._inProgressLayer.continuePlacement(w[B.source],this.placement,this._showCollisionBoxes,B,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(h){return this.placement.commit(h),this.placement}}const Eh=512/s.EXTENT/2;class Eo{constructor(h,p,w){this.tileID=h,this.indexedSymbolInstances={},this.bucketInstanceId=w;for(let E=0;E<p.length;E++){const I=p.get(E),B=I.key;this.indexedSymbolInstances[B]||(this.indexedSymbolInstances[B]=[]),this.indexedSymbolInstances[B].push({crossTileID:I.crossTileID,coord:this.getScaledCoordinates(I,h)})}}getScaledCoordinates(h,p){const w=Eh/Math.pow(2,p.canonical.z-this.tileID.canonical.z);return{x:Math.floor((p.canonical.x*s.EXTENT+h.tileAnchorX)*w),y:Math.floor((p.canonical.y*s.EXTENT+h.tileAnchorY)*w)}}findMatches(h,p,w){const E=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let I=0;I<h.length;I++){const B=h.get(I);if(B.crossTileID)continue;const U=this.indexedSymbolInstances[B.key];if(!U)continue;const H=this.getScaledCoordinates(B,p);for(const J of U)if(Math.abs(J.coord.x-H.x)<=E&&Math.abs(J.coord.y-H.y)<=E&&!w[J.crossTileID]){w[J.crossTileID]=!0,B.crossTileID=J.crossTileID;break}}}}class ol{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(h){const p=Math.round((h-this.lng)/360);if(p!==0)for(const w in this.indexes){const E=this.indexes[w],I={};for(const B in E){const U=E[B];U.tileID=U.tileID.unwrapTo(U.tileID.wrap+p),I[U.tileID.key]=U}this.indexes[w]=I}this.lng=h}addBucket(h,p,w){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(let I=0;I<p.symbolInstances.length;I++)p.symbolInstances.get(I).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});const E=this.usedCrossTileIDs[h.overscaledZ];for(const I in this.indexes){const B=this.indexes[I];if(Number(I)>h.overscaledZ)for(const U in B){const H=B[U];H.tileID.isChildOf(h)&&H.findMatches(p.symbolInstances,h,E)}else{const U=B[h.scaledTo(Number(I)).key];U&&U.findMatches(p.symbolInstances,h,E)}}for(let I=0;I<p.symbolInstances.length;I++){const B=p.symbolInstances.get(I);B.crossTileID||(B.crossTileID=w.generate(),E[B.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new Eo(h,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(h,p){for(const w in p.indexedSymbolInstances)for(const E of p.indexedSymbolInstances[w])delete this.usedCrossTileIDs[h][E.crossTileID]}removeStaleBuckets(h){let p=!1;for(const w in this.indexes){const E=this.indexes[w];for(const I in E)h[E[I].bucketInstanceId]||(this.removeBucketCrossTileIDs(w,E[I]),delete E[I],p=!0)}return p}}class al{constructor(){this.layerIndexes={},this.crossTileIDs=new ol,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(h,p,w,E){let I=this.layerIndexes[h.id];I===void 0&&(I=this.layerIndexes[h.id]=new zu);let B=!1;const U={};E.name!=="globe"&&I.handleWrapJump(w);for(const H of p){const J=H.getBucket(h);J&&h.id===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),I.addBucket(H.tileID,J,this.crossTileIDs)&&(B=!0),U[J.bucketInstanceId]=!0)}return I.removeStaleBuckets(U)&&(B=!0),B}pruneUnusedLayers(h){const p={};h.forEach(w=>{p[w]=!0});for(const w in this.layerIndexes)p[w]||delete this.layerIndexes[w]}}const Ah=(y,h)=>s.emitValidationErrors(y,h&&h.filter(p=>p.identifier!=="source.canvas")),Ag=s.pick(Sn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),qs=s.pick(Sn,["setCenter","setZoom","setBearing","setPitch"]),Zl={version:8,layers:[],sources:{}},Oc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ts extends s.Evented{constructor(h,p={}){super(),this.map=h,this.dispatcher=new nt(gn(),this),this.imageManager=new De,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(h._requestManager,p.localFontFamily?s.LocalGlyphMode.all:p.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,p.localFontFamily||p.localIdeographFontFamily),this.crossTileSymbolIndex=new al,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const w=this;this._rtlTextPluginCallback=Ts.registerForPluginStateChange(E=>{w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(I,B)=>{if(s.triggerPluginCompletionEvent(I),B&&B.every(U=>U))for(const U in w._sourceCaches){const H=w._sourceCaches[U],J=H.getSource().type;J!=="vector"&&J!=="geojson"||H.reload()}})}),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const I=this.getSource(E.sourceId);if(I&&I.vectorLayerIds)for(const B in this._layers){const U=this._layers[B];U.source===I.id&&this._validateLayer(U)}})}loadURL(h,p={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const w=typeof p.validate=="boolean"?p.validate:!s.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,p.accessToken);const E=this.map._requestManager.transformRequest(h,s.ResourceType.Style);this._request=s.getJSON(E,(I,B)=>{this._request=null,I?this.fire(new s.ErrorEvent(I)):B&&this._load(B,w)})}loadJSON(h,p={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(h,p.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Zl,!1)}_updateLayerCount(h,p){const w=p?1:-1;h.is3D()&&(this._num3DLayers+=w),h.type==="circle"&&(this._numCircleLayers+=w),h.type==="symbol"&&(this._numSymbolLayers+=w)}_load(h,p){if(p&&Ah(this,s.validateStyle(h)))return;this._loaded=!0,this.stylesheet=s.clone$1(h),this._updateMapProjection();for(const E in h.sources)this.addSource(E,h.sources[E],{validate:!1});this._changed=!1,h.sprite?this._loadSprite(h.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(h.glyphs);const w=ii(this.stylesheet.layers);this._order=w.map(E=>E.id),this._layers={},this._serializedLayers={};for(let E of w)E=s.createStyleLayer(E),E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new le(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(h){h?this.stylesheet.projection=h:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(h){this._spriteRequest=function(p,w,E){let I,B,U;const H=s.exported.devicePixelRatio>1?"@2x":"";let J=s.getJSON(w.transformRequest(w.normalizeSpriteURL(p,H,".json"),s.ResourceType.SpriteJSON),(me,be)=>{J=null,U||(U=me,I=be,oe())}),Y=s.getImage(w.transformRequest(w.normalizeSpriteURL(p,H,".png"),s.ResourceType.SpriteImage),(me,be)=>{Y=null,U||(U=me,B=be,oe())});function oe(){if(U)E(U);else if(I&&B){const me=s.exported.getImageData(B),be={};for(const we in I){const{width:Me,height:_e,x:xe,y:ke,sdf:Ce,pixelRatio:Ue,stretchX:Ze,stretchY:qe,content:tt}=I[we],ft=new s.RGBAImage({width:Me,height:_e});s.RGBAImage.copy(me,ft,{x:xe,y:ke},{x:0,y:0},{width:Me,height:_e}),be[we]={data:ft,pixelRatio:Ue,sdf:Ce,stretchX:Ze,stretchY:qe,content:tt}}E(null,be)}}return{cancel(){J&&(J.cancel(),J=null),Y&&(Y.cancel(),Y=null)}}}(h,this.map._requestManager,(p,w)=>{if(this._spriteRequest=null,p)this.fire(new s.ErrorEvent(p));else if(w)for(const E in w)this.imageManager.addImage(E,w[E]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(h){const p=this.getSource(h.source);if(!p)return;const w=h.sourceLayer;w&&(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(w)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${w}" does not exist on source "${p.id}" as specified by style layer "${h.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const h in this._sourceCaches)if(!this._sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(h){const p=[];for(const w of h){const E=this._layers[w];E.type!=="custom"&&p.push(E.serialize())}return p}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const h in this._sourceCaches)if(this._sourceCaches[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(h){return!!this.terrain&&Oc[h.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(h){if(!this._loaded)return;const p=this._changed;if(this._changed){const E=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);(E.length||I.length)&&this._updateWorkerLayers(E,I);for(const B in this._updatedSources){const U=this._updatedSources[B];U==="reload"?this._reloadSource(B):U==="clear"&&this._clearSource(B)}this._updateTilesForChangedImages();for(const B in this._updatedPaintProps)this._layers[B].updateTransitions(h);this.light.updateTransitions(h),this.fog&&this.fog.updateTransitions(h),this._resetUpdates()}const w={};for(const E in this._sourceCaches){const I=this._sourceCaches[E];w[E]=I.used,I.used=!1}for(const E of this._order){const I=this._layers[E];if(I.recalculate(h,this._availableImages),!I.isHidden(h.zoom)){const U=this._getLayerSourceCache(I);U&&(U.used=!0)}const B=this.map.painter;if(B){const U=I.getProgramIds();if(!U)continue;const H=I.getProgramConfiguration(h.zoom);for(const J of U)B.useProgram(J,H)}}for(const E in w){const I=this._sourceCaches[E];w[E]!==I.used&&I.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light.recalculate(h),this.terrain&&this.terrain.recalculate(h),this.fog&&this.fog.recalculate(h),this.z=h.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const h=Object.keys(this._changedImages);if(h.length){for(const p in this._sourceCaches)this._sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}}_updateWorkerLayers(h,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(h){if(this._checkLoaded(),Ah(this,s.validateStyle(h)))return!1;(h=s.clone$1(h)).layers=ii(h.layers);const p=function(E,I){if(!E)return[{command:Sn.setStyle,args:[I]}];let B=[];try{if(!d(E.version,I.version))return[{command:Sn.setStyle,args:[I]}];d(E.center,I.center)||B.push({command:Sn.setCenter,args:[I.center]}),d(E.zoom,I.zoom)||B.push({command:Sn.setZoom,args:[I.zoom]}),d(E.bearing,I.bearing)||B.push({command:Sn.setBearing,args:[I.bearing]}),d(E.pitch,I.pitch)||B.push({command:Sn.setPitch,args:[I.pitch]}),d(E.sprite,I.sprite)||B.push({command:Sn.setSprite,args:[I.sprite]}),d(E.glyphs,I.glyphs)||B.push({command:Sn.setGlyphs,args:[I.glyphs]}),d(E.transition,I.transition)||B.push({command:Sn.setTransition,args:[I.transition]}),d(E.light,I.light)||B.push({command:Sn.setLight,args:[I.light]}),d(E.fog,I.fog)||B.push({command:Sn.setFog,args:[I.fog]}),d(E.projection,I.projection)||B.push({command:Sn.setProjection,args:[I.projection]});const U={},H=[];(function(oe,me,be,we){let Me;for(Me in me=me||{},oe=oe||{})oe.hasOwnProperty(Me)&&(me.hasOwnProperty(Me)||kn(Me,be,we));for(Me in me)me.hasOwnProperty(Me)&&(oe.hasOwnProperty(Me)?d(oe[Me],me[Me])||(oe[Me].type==="geojson"&&me[Me].type==="geojson"&&Qi(oe,me,Me)?be.push({command:Sn.setGeoJSONSourceData,args:[Me,me[Me].data]}):hs(Me,me,be,we)):Kn(Me,me,be))})(E.sources,I.sources,H,U);const J=[];E.layers&&E.layers.forEach(oe=>{oe.source&&U[oe.source]?B.push({command:Sn.removeLayer,args:[oe.id]}):J.push(oe)});let Y=E.terrain;Y&&U[Y.source]&&(B.push({command:Sn.setTerrain,args:[void 0]}),Y=void 0),B=B.concat(H),d(Y,I.terrain)||B.push({command:Sn.setTerrain,args:[I.terrain]}),function(oe,me,be){me=me||[];const we=(oe=oe||[]).map(wt),Me=me.map(wt),_e=oe.reduce(Ss,{}),xe=me.reduce(Ss,{}),ke=we.slice(),Ce=Object.create(null);let Ue,Ze,qe,tt,ft,lt,it;for(Ue=0,Ze=0;Ue<we.length;Ue++)qe=we[Ue],xe.hasOwnProperty(qe)?Ze++:(be.push({command:Sn.removeLayer,args:[qe]}),ke.splice(ke.indexOf(qe,Ze),1));for(Ue=0,Ze=0;Ue<Me.length;Ue++)qe=Me[Me.length-1-Ue],ke[ke.length-1-Ue]!==qe&&(_e.hasOwnProperty(qe)?(be.push({command:Sn.removeLayer,args:[qe]}),ke.splice(ke.lastIndexOf(qe,ke.length-Ze),1)):Ze++,lt=ke[ke.length-Ue],be.push({command:Sn.addLayer,args:[xe[qe],lt]}),ke.splice(ke.length-Ue,0,qe),Ce[qe]=!0);for(Ue=0;Ue<Me.length;Ue++)if(qe=Me[Ue],tt=_e[qe],ft=xe[qe],!Ce[qe]&&!d(tt,ft))if(d(tt.source,ft.source)&&d(tt["source-layer"],ft["source-layer"])&&d(tt.type,ft.type)){for(it in Fr(tt.layout,ft.layout,be,qe,null,Sn.setLayoutProperty),Fr(tt.paint,ft.paint,be,qe,null,Sn.setPaintProperty),d(tt.filter,ft.filter)||be.push({command:Sn.setFilter,args:[qe,ft.filter]}),d(tt.minzoom,ft.minzoom)&&d(tt.maxzoom,ft.maxzoom)||be.push({command:Sn.setLayerZoomRange,args:[qe,ft.minzoom,ft.maxzoom]}),tt)tt.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?Fr(tt[it],ft[it],be,qe,it.slice(6),Sn.setPaintProperty):d(tt[it],ft[it])||be.push({command:Sn.setLayerProperty,args:[qe,it,ft[it]]}));for(it in ft)ft.hasOwnProperty(it)&&!tt.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?Fr(tt[it],ft[it],be,qe,it.slice(6),Sn.setPaintProperty):d(tt[it],ft[it])||be.push({command:Sn.setLayerProperty,args:[qe,it,ft[it]]}))}else be.push({command:Sn.removeLayer,args:[qe]}),lt=ke[ke.lastIndexOf(qe)+1],be.push({command:Sn.addLayer,args:[ft,lt]})}(J,I.layers,B)}catch(U){console.warn("Unable to compute style diff:",U),B=[{command:Sn.setStyle,args:[I]}]}return B}(this.serialize(),h).filter(E=>!(E.command in qs));if(p.length===0)return!1;const w=p.filter(E=>!(E.command in Ag));if(w.length>0)throw new Error(`Unimplemented: ${w.map(E=>E.command).join(", ")}.`);return p.forEach(E=>{E.command!=="setTransition"&&E.command!=="setProjection"&&this[E.command].apply(this,E.args)}),this.stylesheet=h,this._updateMapProjection(),!0}addImage(h,p){return this.getImage(h)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(h,p),this._afterImageUpdated(h),this)}updateImage(h,p){this.imageManager.updateImage(h,p)}getImage(h){return this.imageManager.getImage(h)}removeImage(h){return this.getImage(h)?(this.imageManager.removeImage(h),this._afterImageUpdated(h),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(h,p,w={}){if(this._checkLoaded(),this.getSource(h)!==void 0)throw new Error("There is already a source with this ID");if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(s.validateSource,`sources.${h}`,p,null,w))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const E=ye(h,p,this.dispatcher,this);E.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(h),source:E.serialize(),sourceId:h}));const I=B=>{const U=(B?"symbol:":"other:")+h,H=this._sourceCaches[U]=new s.SourceCache(U,E,B);(B?this._symbolSourceCaches:this._otherSourceCaches)[h]=H,H.style=this,H.onAdd(this.map)};I(!1),p.type!=="vector"&&p.type!=="geojson"||I(!0),E.onAdd&&E.onAdd(this.map),this._changed=!0}removeSource(h){this._checkLoaded();const p=this.getSource(h);if(!p)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===h)return this.fire(new s.ErrorEvent(new Error(`Source "${h}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.get().source===h)return this.fire(new s.ErrorEvent(new Error(`Source "${h}" cannot be removed while terrain is using it.`)));const w=this._getSourceCaches(h);for(const E of w)delete this._sourceCaches[E.id],delete this._updatedSources[E.id],E.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles();return delete this._otherSourceCaches[h],delete this._symbolSourceCaches[h],p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(h,p){this._checkLoaded(),this.getSource(h).setData(p),this._changed=!0}getSource(h){const p=this._getSourceCache(h);return p&&p.getSource()}_getSources(){const h=[];for(const p in this._otherSourceCaches){const w=this._getSourceCache(p);w&&h.push(w.getSource())}return h}addLayer(h,p,w={}){this._checkLoaded();const E=h.id;if(this.getLayer(E))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${E}" already exists on this map`)));let I;if(h.type==="custom"){if(Ah(this,s.validateCustomStyleLayer(h)))return;I=s.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(E,h.source),h=s.clone$1(h),h=s.extend(h,{source:E})),this._validate(s.validateLayer,`layers.${E}`,h,{arrayIndex:-1},w))return;I=s.createStyleLayer(h),this._validateLayer(I),I.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[I.id]=I.serialize(),this._updateLayerCount(I,!0)}const B=p?this._order.indexOf(p):this._order.length;if(p&&B===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`)));this._order.splice(B,0,E),this._layerOrderChanged=!0,this._layers[E]=I;const U=this._getLayerSourceCache(I);if(this._removedLayers[E]&&I.source&&U&&I.type!=="custom"){const H=this._removedLayers[E];delete this._removedLayers[E],H.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",U.pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(h,p){if(this._checkLoaded(),this._changed=!0,!this._layers[h])return void this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be moved.`)));if(h===p)return;const w=this._order.indexOf(h);this._order.splice(w,1);const E=p?this._order.indexOf(p):this._order.length;p&&E===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`))):(this._order.splice(E,0,h),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(h){this._checkLoaded();const p=this._layers[h];if(!p)return void this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be removed.`)));p.setEventedParent(null),this._updateLayerCount(p,!1);const w=this._order.indexOf(h);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=p,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],p.onRemove&&p.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(h){return this._layers[h]}hasLayer(h){return h in this._layers}hasLayerType(h){for(const p in this._layers)if(this._layers[p].type===h)return!0;return!1}setLayerZoomRange(h,p,w){this._checkLoaded();const E=this.getLayer(h);E?E.minzoom===p&&E.maxzoom===w||(p!=null&&(E.minzoom=p),w!=null&&(E.maxzoom=w),this._updateLayer(E)):this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(h,p,w={}){this._checkLoaded();const E=this.getLayer(h);if(E){if(!d(E.filter,p))return p==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(s.validateFilter,`layers.${E.id}.filter`,p,{layerType:E.type},w)||(E.filter=s.clone$1(p),this._updateLayer(E)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be filtered.`)))}getFilter(h){const p=this.getLayer(h);return p&&s.clone$1(p.filter)}setLayoutProperty(h,p,w,E={}){this._checkLoaded();const I=this.getLayer(h);I?d(I.getLayoutProperty(p),w)||(I.setLayoutProperty(p,w,E),this._updateLayer(I)):this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(h,p){const w=this.getLayer(h);if(w)return w.getLayoutProperty(p);this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style.`)))}setPaintProperty(h,p,w,E={}){this._checkLoaded();const I=this.getLayer(h);I?d(I.getPaintProperty(p),w)||(I.setPaintProperty(p,w,E)&&this._updateLayer(I),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(h,p){const w=this.getLayer(h);return w&&w.getPaintProperty(p)}setFeatureState(h,p){this._checkLoaded();const w=h.source,E=h.sourceLayer,I=this.getSource(w);if(!I)return void this.fire(new s.ErrorEvent(new Error(`The source '${w}' does not exist in the map's style.`)));const B=I.type;if(B==="geojson"&&E)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(B==="vector"&&!E)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const U=this._getSourceCaches(w);for(const H of U)H.setFeatureState(E,h.id,p)}removeFeatureState(h,p){this._checkLoaded();const w=h.source,E=this.getSource(w);if(!E)return void this.fire(new s.ErrorEvent(new Error(`The source '${w}' does not exist in the map's style.`)));const I=E.type,B=I==="vector"?h.sourceLayer:void 0;if(I==="vector"&&!B)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&typeof h.id!="string"&&typeof h.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const U=this._getSourceCaches(w);for(const H of U)H.removeFeatureState(B,h.id,p)}getFeatureState(h){this._checkLoaded();const p=h.source,w=h.sourceLayer,E=this.getSource(p);if(E){if(E.type!=="vector"||w)return h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(p)[0].getFeatureState(w,h.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const h={};for(const p in this._sourceCaches){const w=this._sourceCaches[p].getSource();h[w.id]||(h[w.id]=w.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:h,layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(h){this._updatedLayers[h.id]=!0;const p=this._getLayerSourceCache(h);h.source&&!this._updatedSources[h.source]&&p&&p.getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",p.pause()),this._changed=!0,h.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(h){const p=B=>this._layers[B].type==="fill-extrusion",w={},E=[];for(let B=this._order.length-1;B>=0;B--){const U=this._order[B];if(p(U)){w[U]=B;for(const H of h){const J=H[U];if(J)for(const Y of J)E.push(Y)}}}E.sort((B,U)=>U.intersectionZ-B.intersectionZ);const I=[];for(let B=this._order.length-1;B>=0;B--){const U=this._order[B];if(p(U))for(let H=E.length-1;H>=0;H--){const J=E[H].feature;if(w[J.layer.id]<B)break;I.push(J),E.pop()}else for(const H of h){const J=H[U];if(J)for(const Y of J)I.push(Y.feature)}}return I}queryRenderedFeatures(h,p,w){p&&p.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",p.filter,null,p);const E={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const H of p.layers){const J=this._layers[H];if(!J)return this.fire(new s.ErrorEvent(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];E[J.source]=!0}}const I=[];p.availableImages=this._availableImages;const B=p&&p.layers?p.layers.some(H=>{const J=this.getLayer(H);return J&&J.is3D()}):this.has3DLayers(),U=et.createFromScreenPoints(h,w);for(const H in this._sourceCaches){const J=this._sourceCaches[H].getSource().id;p.layers&&!E[J]||I.push(Je(this._sourceCaches[H],this._layers,this._serializedLayers,U,p,w,B,!!this.map._showQueryGeometry))}return this.placement&&I.push(function(H,J,Y,oe,me,be,we){const Me={},_e=be.queryRenderedSymbols(oe),xe=[];for(const ke of Object.keys(_e).map(Number))xe.push(we[ke]);xe.sort(zt);for(const ke of xe){const Ce=ke.featureIndex.lookupSymbolFeatures(_e[ke.bucketInstanceId],J,ke.bucketIndex,ke.sourceLayerIndex,me.filter,me.layers,me.availableImages,H);for(const Ue in Ce){const Ze=Me[Ue]=Me[Ue]||[],qe=Ce[Ue];qe.sort((tt,ft)=>{const lt=ke.featureSortOrder;if(lt){const it=lt.indexOf(tt.featureIndex);return lt.indexOf(ft.featureIndex)-it}return ft.featureIndex-tt.featureIndex});for(const tt of qe)Ze.push(tt)}}for(const ke in Me)Me[ke].forEach(Ce=>{const Ue=Ce.feature,Ze=Y(H[ke]).getFeatureState(Ue.layer["source-layer"],Ue.id);Ue.source=Ue.layer.source,Ue.layer["source-layer"]&&(Ue.sourceLayer=Ue.layer["source-layer"]),Ue.state=Ze});return Me}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),U.screenGeometry,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(I)}querySourceFeatures(h,p){p&&p.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",p.filter,null,p);const w=this._getSourceCaches(h);let E=[];for(const I of w)E=E.concat(ht(I,p));return E}addSourceType(h,p,w){return Ts.getSourceType(h)?w(new Error(`A source type called "${h}" already exists.`)):(Ts.setSourceType(h,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:p.workerSourceURL},w):w(null,null))}getLight(){return this.light.getLight()}setLight(h,p={}){this._checkLoaded();const w=this.light.getLight();let E=!1;for(const B in h)if(!d(h[B],w[B])){E=!0;break}if(!E)return;const I=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(h,p),this.light.updateTransitions(I)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(h,p=1){if(this._checkLoaded(),!h)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(p===1){if(typeof h.source=="object"){const w="terrain-dem-src";this.addSource(w,h.source),h=s.clone$1(h),h=s.extend(h,{source:w})}if(this._validate(s.validateTerrain,"terrain",h))return}if(!this.terrain||this.terrain&&p!==this.terrain.drapeRenderMode)this._createTerrain(h,p);else{const w=this.terrain,E=w.get();for(const I of Object.keys(s.spec.terrain))!h.hasOwnProperty(I)&&s.spec.terrain[I].default&&(h[I]=s.spec.terrain[I].default);for(const I in h)if(!d(h[I],E[I])){w.set(h),this.stylesheet.terrain=h;const B=this._setTransitionParameters({duration:0});w.updateTransitions(B);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(h){const p=this.fog=new Ne(h,this.map.transform);this.stylesheet.fog=h;const w=this._setTransitionParameters({duration:0});p.updateTransitions(w)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const h of this.map._markers)h._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(h){if(this._checkLoaded(),!h)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog,w=p.get();Object.keys(h).length===0&&p.set(h);for(const E in h)if(!d(h[E],w[E])){p.set(h),this.stylesheet.fog=h;const I=this._setTransitionParameters({duration:0});p.updateTransitions(I);break}}else this._createFog(h);this._markersNeedUpdate=!0}_setTransitionParameters(h){return{now:s.exported.now(),transition:s.extend(h,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const h=this._order.filter(w=>this.isLayerDraped(this._layers[w])),p=this._order.filter(w=>!this.isLayerDraped(this._layers[w]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...h),this._drapedFirstOrder.push(...p)}_createTerrain(h,p){const w=this.terrain=new We(h,p);this.stylesheet.terrain=h,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const E=this._setTransitionParameters({duration:0});w.updateTransitions(E)}_force3DLayerUpdate(){for(const h in this._layers){const p=this._layers[h];p.type==="fill-extrusion"&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const h in this._layers){const p=this._layers[h];p.type==="symbol"&&this._updateLayer(p)}}_validate(h,p,w,E,I={}){return(!I||I.validate!==!1)&&Ah(this,h.call(s.validateStyle,s.extend({key:p,style:this.serialize(),value:w,styleSpec:s.spec},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this._sourceCaches)this._sourceCaches[h].clearTiles(),this._sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(h){const p=this._getSourceCaches(h);for(const w of p)w.clearTiles()}_reloadSource(h){const p=this._getSourceCaches(h);for(const w of p)w.resume(),w.reload()}_reloadSources(){for(const h of this._getSources())h.reload&&h.reload()}_updateSources(h){for(const p in this._sourceCaches)this._sourceCaches[p].update(h)}_generateCollisionBoxes(){for(const h in this._sourceCaches){const p=this._sourceCaches[h];p.resume(),p.reload()}}_updatePlacement(h,p,w,E,I=!1){let B=!1,U=!1;const H={};for(const J of this._order){const Y=this._layers[J];if(Y.type!=="symbol")continue;if(!H[Y.source]){const me=this._getLayerSourceCache(Y);if(!me)continue;H[Y.source]=me.getRenderableIds(!0).map(be=>me.getTileByID(be)).sort((be,we)=>we.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(we.tileID)?-1:1))}const oe=this.crossTileSymbolIndex.addLayer(Y,H[Y.source],h.center.lng,h.projection);B=B||oe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),I=I||this._layerOrderChanged||w===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),h.zoom))&&(this.pauseablePlacement=new sl(h,this._order,I,p,w,E,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),U=!0),B&&this.pauseablePlacement.placement.setStale()),U||B)for(const J of this._order){const Y=this._layers[J];Y.type==="symbol"&&this.placement.updateLayerOpacities(Y,H[Y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const h in this._sourceCaches)this._sourceCaches[h].releaseSymbolFadeTiles()}getImages(h,p,w){this.imageManager.getImages(p.icons,w),this._updateTilesForChangedImages();const E=I=>{I&&I.setDependencies(p.tileID.key,p.type,p.icons)};E(this._otherSourceCaches[p.source]),E(this._symbolSourceCaches[p.source])}getGlyphs(h,p,w){this.glyphManager.getGlyphs(p.stacks,w)}getResource(h,p,w){return s.makeRequest(p,w)}_getSourceCache(h){return this._otherSourceCaches[h]}_getLayerSourceCache(h){return h.type==="symbol"?this._symbolSourceCaches[h.source]:this._otherSourceCaches[h.source]}_getSourceCaches(h){const p=[];return this._otherSourceCaches[h]&&p.push(this._otherSourceCaches[h]),this._symbolSourceCaches[h]&&p.push(this._symbolSourceCaches[h]),p}_isSourceCacheLoaded(h){const p=this._getSourceCaches(h);return p.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${h}'`))),!1):p.every(w=>w.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ts.getSourceType=function(y){return Ae[y]},Ts.setSourceType=function(y,h){Ae[y]=h},Ts.registerForPluginStateChange=s.registerForPluginStateChange;var uo=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,$l="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ch=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Fc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ou=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Yd={},Ih={};const Bc=[];ho(uo,Bc),ho(Ch,Bc),ho(Fc,Bc),ho(Ou,Bc),Yd=Ai("",Ch),Ih=Ai(Ou,Fc);const Ph=Ai(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Nc=uo,Fs=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Vo={background:Ai(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ai(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ai(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ai("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ai(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ai("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ai("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ai(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ai(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ai(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ai(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ai(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ai(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ai(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ai(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ai(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ai(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ai(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ai(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ai(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ai(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Ai(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ai(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$l),skyboxGradient:Ai(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$l),skyboxCapture:Ai(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ai(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ai(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ho(y,h){const p=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let w of p)if(w=w.trim(),w[0]==="#"&&w.includes("if")&&!w.includes("endif")){w=w.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const E=w.split(" ");for(const I of E)h.includes(I)||h.push(I)}}function Ai(y,h){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,w=h.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E={},I=[...Bc];return ho(y,I),ho(h,I),{fragmentSource:y=y.replace(p,(B,U,H,J,Y)=>(E[Y]=!0,U==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
varying ${H} ${J} ${Y};
#else
uniform ${H} ${J} u_${Y};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Y}
    ${H} ${J} ${Y} = u_${Y};
#endif
`)),vertexSource:h=h.replace(p,(B,U,H,J,Y)=>{const oe=J==="float"?"vec2":"vec4",me=Y.match(/color/)?"color":oe;return E[Y]?U==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${H} ${oe} a_${Y};
varying ${H} ${J} ${Y};
#else
uniform ${H} ${J} u_${Y};
#endif
`:me==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${H} ${J} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${me}(a_${Y}, u_${Y}_t);
#else
    ${H} ${J} ${Y} = u_${Y};
#endif
`:U==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${H} ${oe} a_${Y};
#else
uniform ${H} ${J} u_${Y};
#endif
`:me==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${H} ${J} ${Y} = a_${Y};
#else
    ${H} ${J} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${H} ${J} ${Y} = unpack_mix_${me}(a_${Y}, u_${Y}_t);
#else
    ${H} ${J} ${Y} = u_${Y};
#endif
`}),staticAttributes:w,usedDefines:I}}class zp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(h,p,w,E,I,B,U){this.context=h;let H=this.boundPaintVertexBuffers.length!==E.length;for(let Y=0;!H&&Y<E.length;Y++)this.boundPaintVertexBuffers[Y]!==E[Y]&&(H=!0);let J=this.boundDynamicVertexBuffers.length!==U.length;for(let Y=0;!J&&Y<U.length;Y++)this.boundDynamicVertexBuffers[Y]!==U[Y]&&(J=!0);if(!h.extVertexArrayObject||!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==w||H||J||this.boundIndexBuffer!==I||this.boundVertexOffset!==B)this.freshBind(p,w,E,I,B,U);else{h.bindVertexArrayOES.set(this.vao);for(const Y of U)Y&&Y.bind();I&&I.dynamicDraw&&I.bind()}}freshBind(h,p,w,E,I,B){let U;const H=h.numAttributes,J=this.context,Y=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),U=0,this.boundProgram=h,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=w,this.boundIndexBuffer=E,this.boundVertexOffset=I,this.boundDynamicVertexBuffers=B;else{U=J.currentNumAttributes||0;for(let oe=H;oe<U;oe++)Y.disableVertexAttribArray(oe)}p.enableAttributes(Y,h),p.bind(),p.setVertexAttribPointers(Y,h,I);for(const oe of w)oe.enableAttributes(Y,h),oe.bind(),oe.setVertexAttribPointers(Y,h,I);for(const oe of B)oe&&(oe.enableAttributes(Y,h),oe.bind(),oe.setVertexAttribPointers(Y,h,I));E&&E.bind(),J.currentNumAttributes=H}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ao(y,h){const p=Math.pow(2,h.canonical.z),w=h.canonical.y;return[new s.MercatorCoordinate(0,w/p).toLngLat().lat,new s.MercatorCoordinate(0,(w+1)/p).toLngLat().lat]}function La(y,h,p,w,E,I,B){const U=y.context,H=U.gl,J=p.fbo;if(!J)return;y.prepareDrawTile();const Y=y.useProgram("hillshade");U.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,J.colorAttachment.get());const oe=((Me,_e,xe,ke)=>{const Ce=xe.paint.get("hillshade-shadow-color"),Ue=xe.paint.get("hillshade-highlight-color"),Ze=xe.paint.get("hillshade-accent-color");let qe=xe.paint.get("hillshade-illumination-direction")*(Math.PI/180);xe.paint.get("hillshade-illumination-anchor")==="viewport"&&(qe-=Me.transform.angle);const tt=!Me.options.moving;return{u_matrix:ke||Me.transform.calculateProjMatrix(_e.tileID.toUnwrapped(),tt),u_image:0,u_latrange:Ao(0,_e.tileID),u_light:[xe.paint.get("hillshade-exaggeration"),qe],u_shadow:Ce,u_highlight:Ue,u_accent:Ze}})(y,p,w,y.terrain?h.projMatrix:null);y.prepareDrawProgram(U,Y,h.toUnwrapped());const{tileBoundsBuffer:me,tileBoundsIndexBuffer:be,tileBoundsSegments:we}=y.getTileBoundsBuffers(p);Y.draw(U,H.TRIANGLES,E,I,B,s.CullFaceMode.disabled,oe,w.id,me,be,we)}function ll(y,h,p){if(!h.needsDEMTextureUpload)return;const w=y.context,E=w.gl;w.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||y.getTileTexture(p.stride);const I=p.getPixels();h.demTexture?h.demTexture.update(I,{premultiply:!1}):h.demTexture=new s.Texture(w,I,E.RGBA,{premultiply:!1}),h.needsDEMTextureUpload=!1}function kh(y,h,p,w,E,I){const B=y.context,U=B.gl;if(!h.dem)return;const H=h.dem;if(B.activeTexture.set(U.TEXTURE1),ll(y,h,H),!h.demTexture)return;h.demTexture.bind(U.NEAREST,U.CLAMP_TO_EDGE);const J=H.dim;B.activeTexture.set(U.TEXTURE0);let Y=h.fbo;if(!Y){const we=new s.Texture(B,{width:J,height:J,data:null},U.RGBA);we.bind(U.LINEAR,U.CLAMP_TO_EDGE),Y=h.fbo=B.createFramebuffer(J,J,!0),Y.colorAttachment.set(we.texture)}B.bindFramebuffer.set(Y.framebuffer),B.viewport.set([0,0,J,J]);const{tileBoundsBuffer:oe,tileBoundsIndexBuffer:me,tileBoundsSegments:be}=y.getMercatorTileBoundsBuffers();y.useProgram("hillshadePrepare").draw(B,U.TRIANGLES,w,E,I,s.CullFaceMode.disabled,((we,Me)=>{const _e=Me.stride,xe=s.create();return s.ortho(xe,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(xe,xe,[0,-s.EXTENT,0]),{u_matrix:xe,u_image:1,u_dimension:[_e,_e],u_zoom:we.overscaledZ,u_unpack:Me.unpackVector}})(h.tileID,H),p.id,oe,me,be),h.needsHillshadePrepare=!1}const Xl=y=>({u_matrix:new s.UniformMatrix4f(y),u_image0:new s.Uniform1i(y),u_skirt_height:new s.Uniform1f(y)}),Dh=(y,h)=>({u_matrix:y,u_image0:0,u_skirt_height:h}),Jd=(y,h,p,w,E,I,B,U,H,J,Y,oe,me,be)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:h,u_normalize_matrix:Float32Array.from(w),u_merc_matrix:p,u_zoom_transition:E,u_merc_center:I,u_image0:0,u_frustum_tl:B,u_frustum_tr:U,u_frustum_br:H,u_frustum_bl:J,u_globe_pos:Y,u_globe_radius:oe,u_viewport:me,u_grid_matrix:be?Float32Array.from(be):new Float32Array(9)});function Fu(y,h){return y!=null&&h!=null&&!(!y.hasData()||!h.hasData())&&y.demTexture!=null&&h.demTexture!=null&&y.tileID.key!==h.tileID.key}const Ra=new class{constructor(){this.operations={}}newMorphing(y,h,p,w,E){if(y in this.operations){const I=this.operations[y];I.to.tileID.key!==p.tileID.key&&(I.queued=p)}else this.operations[y]={startTime:w,phase:0,duration:E,from:h,to:p,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const h=this.operations[y];return{from:h.from,to:h.to,phase:h.phase}}update(y){for(const h in this.operations){const p=this.operations[h];for(p.phase=(y-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,y)){delete this.operations[h];break}}}_nextOp(y,h){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=h,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},Uc={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Lh(y,h){const p=1<<y.z;return!h&&(y.x===0||y.x===p-1)||y.y===0||y.y===p-1}const Bu=y=>({u_matrix:y});function Nu(y,h,p,w,E){if(E>0){const I=s.exported.now(),B=(I-y.timeAdded)/E,U=h?(I-h.timeAdded)/E:-1,H=p.getSource(),J=w.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),Y=!h||Math.abs(h.tileID.overscaledZ-J)>Math.abs(y.tileID.overscaledZ-J),oe=Y&&y.refreshedUponExpiration?1:s.clamp(Y?B:1-U,0,1);return y.refreshedUponExpiration&&B>=1&&(y.refreshedUponExpiration=!1),h?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}class hi extends s.SourceCache{constructor(h){const p={type:"raster-dem",maxzoom:h.transform.maxZoom},w=new nt(gn(),null),E=ye("mock-dem",p,w,h.style);super("mock-dem",E,!1),E.setEventedParent(this),this._sourceLoaded=!0}_loadTile(h,p){h.state="loaded",p(null)}}class cl extends s.SourceCache{constructor(h){const p=ye("proxy",{type:"geojson",maxzoom:h.transform.maxZoom},new nt(gn(),null),h.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=h,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(h,p,w){if(h.freezeTileCoverage)return;this.transform=h;const E=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((I,B)=>{if(I[B.key]="",!this._tiles[B.key]){const U=new s.Tile(B,this._source.tileSize*B.overscaleFactor(),h.tileZoom);U.state="loaded",this._tiles[B.key]=U}return I},{});for(const I in this._tiles)I in E||(this.freeFBO(I),this._tiles[I].unloadVectorData(),delete this._tiles[I])}freeFBO(h){const p=this.proxyCachedFBO[h];if(p!==void 0){const w=Object.values(p);this.renderCachePool.push(...w),delete this.proxyCachedFBO[h]}}deallocRenderCache(){this.renderCache.forEach(h=>h.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Uu extends s.OverscaledTileID{constructor(h,p,w){super(h.overscaledZ,h.wrap,h.canonical.z,h.canonical.x,h.canonical.y),this.proxyTileKey=p,this.projMatrix=w}}class Rh extends s.Elevation{constructor(h,p){super(),this.painter=h,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[w,E,I]=function(H){const J=new s.StructArrayLayout4i8,Y=new s.StructArrayLayout3ui6,oe=131;J.reserve(17161),Y.reserve(33800);const me=s.EXTENT/128,be=s.EXTENT+me/2,we=be+me;for(let _e=-me;_e<we;_e+=me)for(let xe=-me;xe<we;xe+=me){const ke=xe<0||xe>be||_e<0||_e>be?24575:0,Ce=s.clamp(Math.round(xe),0,s.EXTENT),Ue=s.clamp(Math.round(_e),0,s.EXTENT);J.emplaceBack(Ce+ke,Ue,Ce,Ue)}const Me=(_e,xe)=>{const ke=xe*oe+_e;Y.emplaceBack(ke+1,ke,ke+oe),Y.emplaceBack(ke+oe,ke+oe+1,ke+1)};for(let _e=1;_e<129;_e++)for(let xe=1;xe<129;xe++)Me(xe,_e);return[0,129].forEach(_e=>{for(let xe=0;xe<130;xe++)Me(xe,_e),Me(_e,xe)}),[J,Y,32768]}(),B=h.context;this.gridBuffer=B.createVertexBuffer(w,s.boundsAttributes.members),this.gridIndexBuffer=B.createIndexBuffer(E),this.gridSegments=s.SegmentVector.simpleSegment(0,0,w.length,E.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,w.length,I),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cl(p.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const U=B.gl;this._overlapStencilMode=new s.StencilMode({func:U.GEQUAL,mask:255},0,255,U.KEEP,U.KEEP,U.REPLACE),this._previousZoom=h.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new hi(p.map)}set style(h){h.on("data",this._onStyleDataEvent.bind(this)),h.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=h,this._checkRenderCacheEfficiency()}update(h,p,w){if(h&&h.terrain){this._style!==h&&(this.style=h),this.enabled=!0;const E=h.terrain.properties;this.sourceCache=h.terrain.drapeRenderMode===0?this._mockSourceCache:h._getSourceCache(E.get("source")),this._exaggeration=E.get("exaggeration");const I=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(p,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,I(),this._initializing=!0),I(),p.updateElevation(!0,w),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(h){this._findCoveringTileCache[h]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const h=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||h.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${h.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${h.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(h){h.coord&&h.dataType==="source"?this._clearRenderCacheForTile(h.sourceCacheId,h.coord):h.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const h in this._style._sourceCaches)this._style._sourceCaches[h].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(h=>h.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const h=2*this.proxySourceCache.getSource().tileSize;return[h,h]}set useVertexMorphing(h){this._useVertexMorphing=h}updateTileBinding(h){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,w=this.painter.transform;this._initializing&&(this._initializing=w._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(w.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=p.getIds().map(H=>{const J=p.getTileByID(H).tileID;return J.projMatrix=w.calculateProjMatrix(J.toUnwrapped()),J});(function(H,J){const Y=J.transform.pointCoordinate(J.transform.getCameraPoint()),oe=new s.pointGeometry(Y.x,Y.y);H.sort((me,be)=>{if(be.overscaledZ-me.overscaledZ)return be.overscaledZ-me.overscaledZ;const we=new s.pointGeometry(me.canonical.x+(1<<me.canonical.z)*me.wrap,me.canonical.y),Me=new s.pointGeometry(be.canonical.x+(1<<be.canonical.z)*be.wrap,be.canonical.y),_e=oe.mult(1<<me.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(we)-_e.distSqr(Me)})})(E,this.painter),this._previousZoom=w.zoom;const I=this.proxyToSource||{};this.proxyToSource={},E.forEach(H=>{this.proxyToSource[H.key]={}}),this.terrainTileForTile={};const B=this._style._sourceCaches;for(const H in B){const J=B[H];if(!J.used||(J!==this.sourceCache&&this.resetTileLookupCache(J.id),this._setupProxiedCoordsForOrtho(J,h[H],I),J.usedForTerrain))continue;const Y=h[H];J.getSource().reparseOverscaled&&this._assignTerrainTiles(Y)}this.proxiedCoords[p.id]=E.map(H=>new Uu(H,H.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(I),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const U={};this._visibleDemTiles=[];for(const H of this.proxyCoords){const J=this.terrainTileForTile[H.key];if(!J)continue;const Y=J.tileID.key;Y in U||(this._visibleDemTiles.push(J),U[Y]=Y)}}_assignTerrainTiles(h){this._initializing||h.forEach(p=>{if(this.terrainTileForTile[p.key])return;const w=this._findTileCoveringTileID(p,this.sourceCache);w&&(this.terrainTileForTile[p.key]=w)})}_prepareDEMTextures(){const h=this.painter.context,p=h.gl;for(const w in this.terrainTileForTile){const E=this.terrainTileForTile[w],I=E.dem;!I||E.demTexture&&!E.needsDEMTextureUpload||(h.activeTexture.set(p.TEXTURE1),ll(this.painter,E,I))}}_prepareDemTileUniforms(h,p,w,E){if(!p||p.demTexture==null)return!1;const I=h.tileID.canonical,B=Math.pow(2,p.tileID.canonical.z-I.z),U=E||"";return w[`u_dem_tl${U}`]=[I.x*B%1,I.y*B%1],w[`u_dem_scale${U}`]=B,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const h=this.painter.context,p=h.gl;if(!this._emptyDepthBufferTexture){const w=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(h,w,p.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let h=0;const p=this._visibleDemTiles.reduce((w,E)=>{if(!E.dem)return w;const I=E.dem.tree.minimums[0];return I>0&&h++,w+I},0);return h?p/h:0}_updateEmptyDEMTexture(){const h=this.painter.context,p=h.gl;h.activeTexture.set(p.TEXTURE2);const w=this._getLoadedAreaMinimum(),E=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(w,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let I=this._emptyDEMTexture;return I?I.update(E,{premultiply:!1}):I=this._emptyDEMTexture=new s.Texture(h,E,p.RGBA,{premultiply:!1}),I}setupElevationDraw(h,p,w){const E=this.painter.context,I=E.gl,B=(U=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(U),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var U;B.u_dem_size=this.sourceCache.getSource().tileSize,B.u_exaggeration=this.exaggeration();let H=null,J=null,Y=1;if(w&&w.morphing&&this._useVertexMorphing){const oe=w.morphing.srcDemTile,me=w.morphing.dstDemTile;Y=w.morphing.phase,oe&&me&&(this._prepareDemTileUniforms(h,oe,B,"_prev")&&(J=oe),this._prepareDemTileUniforms(h,me,B)&&(H=me))}if(J&&H?(E.activeTexture.set(I.TEXTURE2),H.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE,I.NEAREST),E.activeTexture.set(I.TEXTURE4),J.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE,I.NEAREST),B.u_dem_lerp=Y):(H=this.terrainTileForTile[h.tileID.key],E.activeTexture.set(I.TEXTURE2),(this._prepareDemTileUniforms(h,H,B)?H.demTexture:this.emptyDEMTexture).bind(I.NEAREST,I.CLAMP_TO_EDGE)),E.activeTexture.set(I.TEXTURE3),w&&w.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE),this._depthFBO&&(B.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE),B.u_depth_size_inv=[1,1]),w&&w.useMeterToDem&&H){const oe=(1<<H.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;B.u_meter_to_dem=oe}if(w&&w.labelPlaneMatrixInv&&(B.u_label_plane_matrix_inv=w.labelPlaneMatrixInv),p.setTerrainUniformValues(E,B),this.painter.transform.projection.name==="globe"){const oe=this.globeUniformValues(this.painter.transform,h.tileID.canonical,w&&w.useDenormalizedUpVectorScale);p.setGlobeUniformValues(E,oe)}}globeUniformValues(h,p,w){const E=h.projection;return{u_tile_tl_up:E.upVector(p,0,0),u_tile_tr_up:E.upVector(p,s.EXTENT,0),u_tile_br_up:E.upVector(p,s.EXTENT,s.EXTENT),u_tile_bl_up:E.upVector(p,0,s.EXTENT),u_tile_up_scale:w?s.GLOBE_METERS_TO_ECEF:E.upVectorScale(p,h.center.lat,h.worldSize).metersToTile}}renderToBackBuffer(h){const p=this.painter,w=this.painter.context;h.length!==0&&(w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height]),p.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(E,I,B,U,H){if(E.transform.projection.name==="globe")(function(J,Y,oe,me,be){const we=J.context,Me=we.gl;let _e,xe;const ke=J.options.showTerrainWireframe?2:0,Ce=J.transform,Ue=s.globeUseCustomAntiAliasing(J,we,Ce),Ze=(Ut,gt)=>{if(xe===Ut)return;const kt=[Uc[Ut],"PROJECTION_GLOBE_VIEW"];Ue&&kt.push("CUSTOM_ANTIALIASING"),gt&&kt.push(Uc[ke]),_e=J.useProgram("globeRaster",null,kt),xe=Ut},qe=J.colorModeForRenderPass(),tt=new s.DepthMode(Me.LEQUAL,s.DepthMode.ReadWrite,J.depthRangeFor3D);Ra.update(be);const ft=s.calculateGlobeMercatorMatrix(Ce),lt=[s.mercatorXfromLng(Ce.center.lng),s.mercatorYfromLat(Ce.center.lat)],it=ke?[!1,!0]:[!1],Gt=J.globeSharedBuffers,ot=[Ce.width*s.exported.devicePixelRatio,Ce.height*s.exported.devicePixelRatio],bt=Float32Array.from(Ce.globeMatrix),mt={useDenormalizedUpVectorScale:!0};if(it.forEach(Ut=>{xe=-1;const gt=Ut?Me.LINES:Me.TRIANGLES;for(const kt of me){const Dt=oe.getTile(kt),Ye=s.StencilMode.disabled,at=Y.prevTerrainTileForTile[kt.key],Qt=Y.terrainTileForTile[kt.key];Fu(at,Qt)&&Ra.newMorphing(kt.key,at,Qt,be,250),we.activeTexture.set(Me.TEXTURE0),Dt.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE);const mn=Ra.getMorphValuesForProxy(kt.key),cn=mn?1:0;mn&&s.extend$1(mt,{morphing:{srcDemTile:mn.from,dstDemTile:mn.to,phase:s.easeCubicInOut(mn.phase)}});const Fn=s.tileCornersToBounds(kt.canonical),Rn=s.getLatitudinalLod(Fn.getCenter().lat),Cn=s.getGridMatrix(kt.canonical,Fn,Rn,Ce.worldSize/Ce._pixelsPerMercatorPixel),an=s.globeNormalizeECEF(s.globeTileBounds(kt.canonical)),ki=Jd(Ce.projMatrix,bt,ft,an,s.globeToMercatorTransition(Ce.zoom),lt,Ce.frustumCorners.TL,Ce.frustumCorners.TR,Ce.frustumCorners.BR,Ce.frustumCorners.BL,Ce.globeCenterInViewSpace,Ce.globeRadius,ot,Cn);if(Ze(cn,Ut),Y.setupElevationDraw(Dt,_e,mt),J.prepareDrawProgram(we,_e,kt.toUnwrapped()),Gt){const[bi,Di,si]=Ut?Gt.getWirefameBuffers(J.context,Rn):Gt.getGridBuffers(Rn);_e.draw(we,gt,tt,Ye,qe,s.CullFaceMode.backCCW,ki,"globe_raster",bi,Di,si)}}}),Gt){const Ut=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ue&&Ut.push("CUSTOM_ANTIALIASING"),_e=J.useProgram("globeRaster",null,Ut);for(const gt of me){const{x:kt,y:Dt,z:Ye}=gt.canonical,at=Dt===0,Qt=Dt===(1<<Ye)-1,[mn,cn,Fn,Rn]=Gt.getPoleBuffers(Ye);if(Rn&&(at||Qt)){const Cn=oe.getTile(gt);we.activeTexture.set(Me.TEXTURE0),Cn.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE);let an=s.globePoleMatrixForTile(Ye,kt,Ce);const ki=s.globeNormalizeECEF(s.globeTileBounds(gt.canonical)),bi=(Di,si)=>Di.draw(we,Me.TRIANGLES,tt,s.StencilMode.disabled,qe,s.CullFaceMode.disabled,Jd(Ce.projMatrix,an,an,ki,0,lt,Ce.frustumCorners.TL,Ce.frustumCorners.TR,Ce.frustumCorners.BR,Ce.frustumCorners.BL,Ce.globeCenterInViewSpace,Ce.globeRadius,ot),"globe_pole_raster",si,Fn,Rn);Y.setupElevationDraw(Cn,_e,mt),J.prepareDrawProgram(we,_e,gt.toUnwrapped()),at&&bi(_e,mn),Qt&&(an=s.scale(s.create(),an,[1,-1,1]),bi(_e,cn))}}}})(E,I,B,U,H);else{const J=E.context,Y=J.gl;let oe,me;const be=E.options.showTerrainWireframe?2:0,we=(Ce,Ue)=>{if(me===Ce)return;const Ze=[Uc[Ce]];Ue&&Ze.push(Uc[be]),oe=E.useProgram("terrainRaster",null,Ze),me=Ce},Me=E.colorModeForRenderPass(),_e=new s.DepthMode(Y.LEQUAL,s.DepthMode.ReadWrite,E.depthRangeFor3D);Ra.update(H);const xe=E.transform,ke=6*Math.pow(1.5,22-xe.zoom)*I.exaggeration();(be?[!1,!0]:[!1]).forEach(Ce=>{me=-1;const Ue=Ce?Y.LINES:Y.TRIANGLES,[Ze,qe]=Ce?I.getWirefameBuffer():[I.gridIndexBuffer,I.gridSegments];for(const tt of U){const ft=B.getTile(tt),lt=s.StencilMode.disabled,it=I.prevTerrainTileForTile[tt.key],Gt=I.terrainTileForTile[tt.key];Fu(it,Gt)&&Ra.newMorphing(tt.key,it,Gt,H,250),J.activeTexture.set(Y.TEXTURE0),ft.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST);const ot=Ra.getMorphValuesForProxy(tt.key),bt=ot?1:0;let mt;ot&&(mt={morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:s.easeCubicInOut(ot.phase)}});const Ut=Dh(tt.projMatrix,Lh(tt.canonical,xe.renderWorldCopies)?ke/10:ke);we(bt,Ce),I.setupElevationDraw(ft,oe,mt),E.prepareDrawProgram(J,oe,tt.toUnwrapped()),oe.draw(J,Ue,_e,lt,Me,s.CullFaceMode.backCCW,Ut,"terrain_raster",I.gridBuffer,Ze,qe)}})}}(p,this,this.proxySourceCache,h,this._updateTimestamp),this.renderingToTexture=!0,p.gpuTimingDeferredRenderEnd(),h.splice(0,h.length))}renderBatch(h){if(this._drapedRenderBatches.length===0)return h+1;this.renderingToTexture=!0;const p=this.painter,w=this.painter.context,E=this.proxySourceCache,I=this.proxiedCoords[E.id],B=this._drapedRenderBatches.shift(),U=[],H=p.style.order;let J=0;for(const Y of I){const oe=E.getTileByID(Y.proxyTileKey),me=E.proxyCachedFBO[Y.key]?E.proxyCachedFBO[Y.key][h]:void 0,be=me!==void 0?E.renderCache[me]:this.pool[J++],we=me!==void 0;if(oe.texture=be.tex,we&&!be.dirty){U.push(oe.tileID);continue}let Me;w.bindFramebuffer.set(be.fb.framebuffer),this.renderedToTile=!1,be.dirty&&(w.clear({color:s.Color.transparent,stencil:0}),be.dirty=!1);for(let _e=B.start;_e<=B.end;++_e){const xe=p.style._layers[H[_e]];if(xe.isHidden(p.transform.zoom))continue;const ke=p.style._getLayerSourceCache(xe),Ce=ke?this.proxyToSource[Y.key][ke.id]:[Y];if(!Ce)continue;const Ue=Ce;w.viewport.set([0,0,be.fb.width,be.fb.height]),Me!==(ke?ke.id:null)&&(this._setupStencil(be,Ce,xe,ke),Me=ke?ke.id:null),p.renderLayer(p,ke,xe,Ue)}this.renderedToTile?(be.dirty=!0,U.push(oe.tileID)):we||--J,J===5&&(J=0,this.renderToBackBuffer(U))}return this.renderToBackBuffer(U),this.renderingToTexture=!1,w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height]),B.end+1}postRender(){}renderCacheEfficiency(h){const p=h.order.length;if(p===0)return{efficiency:100};let w,E=0,I=0,B=!1;for(let U=0;U<p;++U){const H=h._layers[h.order[U]];this._style.isLayerDraped(H)?(B&&++E,++I):B||(B=!0,w=H.id)}return I===0?{efficiency:100}:{efficiency:100*(1-E/I),firstUndrapedLayer:w}}getMinElevationBelowMSL(){let h=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{h=Math.min(h,p.dem.tree.minimums[0])}),h===0?h:(h-30)*this._exaggeration}raycast(h,p,w){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(I=>I.dem).map(I=>{const B=I.tileID,U=1<<B.overscaledZ,{x:H,y:J}=B.canonical,Y=H/U,oe=(H+1)/U,me=J/U,be=(J+1)/U;return{minx:Y,miny:me,maxx:oe,maxy:be,t:I.dem.tree.raycastRoot(Y,me,oe,be,h,p,w),tile:I}});E.sort((I,B)=>(I.t!==null?I.t:Number.MAX_VALUE)-(B.t!==null?B.t:Number.MAX_VALUE));for(const I of E){if(I.t==null)return null;const B=I.tile.dem.tree.raycast(I.minx,I.miny,I.maxx,I.maxy,h,p,w);if(B!=null)return B}return null}_createFBO(){const h=this.painter.context,p=h.gl,w=this.drapeBufferSize;h.activeTexture.set(p.TEXTURE0);const E=new s.Texture(h,{width:w[0],height:w[1],data:null},p.RGBA);E.bind(p.LINEAR,p.CLAMP_TO_EDGE);const I=h.createFramebuffer(w[0],w[1],!1);return I.colorAttachment.set(E.texture),I.depthAttachment=new Kr(h,I.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=h.createRenderbuffer(h.gl.DEPTH_STENCIL,w[0],w[1]),this._stencilRef=0,I.depthAttachment.set(this._sharedDepthStencil),h.clear({stencil:0})):I.depthAttachment.set(this._sharedDepthStencil),h.extTextureFilterAnisotropic&&!h.extTextureFilterAnisotropicForceOff&&p.texParameterf(p.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax),{fb:I,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h].hasTransition())return!0;return this._style.order.some(h=>{const p=this._style._layers[h],w=p.isHidden(this.painter.transform.zoom);return p.type!=="custom"&&!w&&p.hasTransition()})}_clearRasterFadeFromRenderCache(){let h=!1;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof de){h=!0;break}if(h)for(let p=0;p<this._style.order.length;++p){const w=this._style._layers[this._style.order[p]],E=w.isHidden(this.painter.transform.zoom),I=this._style._getLayerSourceCache(w);if(w.type!=="raster"||E||!I)continue;const B=w.paint.get("raster-fade-duration");for(const U of this.proxyCoords){const H=this.proxyToSource[U.key][I.id];if(H)for(const J of H){const Y=Nu(I.getTile(J),I.findLoadedParent(J,0),I,this.painter.transform,B);(Y.opacity!==1||Y.mix!==0)&&this._clearRenderCacheForTile(I.id,J)}}}}_setupDrapedRenderBatches(){const h=this._style.order,p=h.length;if(p===0)return;const w=[];let E,I=0,B=this._style._layers[h[I]];for(;!this._style.isLayerDraped(B)&&B.isHidden(this.painter.transform.zoom)&&++I<p;)B=this._style._layers[h[I]];for(;I<p;++I){const U=this._style._layers[h[I]];U.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(U)?E===void 0&&(E=I):E!==void 0&&(w.push({start:E,end:I-1}),E=void 0))}E!==void 0&&w.push({start:E,end:I-1}),this._drapedRenderBatches=w}_setupRenderCache(h){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const B=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let U=0;U<B.length;++U){const H=Object.values(B[U]);p.renderCachePool.push(...H)}}return}this._clearRasterFadeFromRenderCache();const w=this.proxyCoords,E=this._tilesDirty;for(let B=w.length-1;B>=0;B--){const U=w[B];if(p.getTileByID(U.key),p.proxyCachedFBO[U.key]!==void 0){const H=h[U.key],J=this.proxyToSource[U.key];let Y=0;for(const oe in J){const me=J[oe],be=H[oe];if(!be||be.length!==me.length||me.some((we,Me)=>we!==be[Me]||E[oe]&&E[oe].hasOwnProperty(we.key))){Y=-1;break}++Y}for(const oe in p.proxyCachedFBO[U.key])p.renderCache[p.proxyCachedFBO[U.key][oe]].dirty=Y<0||Y!==Object.values(H).length}}const I=[...this._drapedRenderBatches];I.sort((B,U)=>U.end-U.start-(B.end-B.start));for(const B of I)for(const U of w){if(p.proxyCachedFBO[U.key])continue;let H=p.renderCachePool.pop();H===void 0&&p.renderCache.length<50&&(H=p.renderCache.length,p.renderCache.push(this._createFBO())),H!==void 0&&(p.proxyCachedFBO[U.key]={},p.proxyCachedFBO[U.key][B.start]=H,p.renderCache[H].dirty=!0)}this._tilesDirty={}}_setupStencil(h,p,w,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const I=this.painter.context,B=I.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let U;if(w.isTileClipped())U=p.length,this._overlapStencilMode.test={func:B.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);U=1,this._overlapStencilMode.test={func:B.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+U>255&&(I.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=U,this._overlapStencilMode.ref=this._stencilRef,w.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(h){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[h.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(h,p){const w=this.painter,E=this.painter.context,I=E.gl;w._tileClippingMaskIDs={},E.setColorMode(s.ColorMode.disabled),E.setDepthMode(s.DepthMode.disabled);const B=w.useProgram("clippingMask");for(const U of h){const H=w._tileClippingMaskIDs[U.key]=--p;B.draw(E,I.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:I.ALWAYS,mask:0},H,255,I.KEEP,I.KEEP,I.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Bu(U.projMatrix),"$clipping",w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}}pointCoordinate(h){const p=this.painter.transform;if(h.x<0||h.x>p.width||h.y<0||h.y>p.height)return null;const w=[h.x,h.y,1,1];s.transformMat4$1(w,w,p.pixelMatrixInverse),s.scale$1(w,w,1/w[3]),w[0]/=p.worldSize,w[1]/=p.worldSize;const E=p._camera.position,I=s.mercatorZfromAltitude(1,p.center.lat),B=[E[0],E[1],E[2]/I,0],U=s.subtract([],w.slice(0,3),B);s.normalize(U,U);const H=this.raycast(B,U,this._exaggeration);return H!==null&&H?(s.scaleAndAdd(B,B,U,H),B[3]=B[2],B[2]*=I,B):null}drawDepth(){const h=this.painter,p=h.context,w=this.proxySourceCache,E=Math.ceil(h.width),I=Math.ceil(h.height);if(!this._depthFBO||this._depthFBO.width===E&&this._depthFBO.height===I||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const B=p.gl,U=p.createFramebuffer(E,I,!0);p.activeTexture.set(B.TEXTURE0);const H=new s.Texture(p,{width:E,height:I,data:null},B.RGBA);H.bind(B.NEAREST,B.CLAMP_TO_EDGE),U.colorAttachment.set(H.texture);const J=p.createRenderbuffer(p.gl.DEPTH_COMPONENT16,E,I);U.depthAttachment.set(J),this._depthFBO=U,this._depthTexture=H}p.bindFramebuffer.set(this._depthFBO.framebuffer),p.viewport.set([0,0,E,I]),function(B,U,H,J){if(B.transform.projection.name==="globe")return;const Y=B.context,oe=Y.gl;Y.clear({depth:1});const me=B.useProgram("terrainDepth"),be=new s.DepthMode(oe.LESS,s.DepthMode.ReadWrite,B.depthRangeFor3D);for(const we of J){const Me=H.getTile(we),_e=Dh(we.projMatrix,0);U.setupElevationDraw(Me,me),me.draw(Y,oe.TRIANGLES,be,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,_e,"terrain_depth",U.gridBuffer,U.gridIndexBuffer,U.gridNoSkirtSegments)}}(h,this,w,this.proxyCoords)}_setupProxiedCoordsForOrtho(h,p,w){if(h.getSource()instanceof pe)return this._setupProxiedCoordsForImageSource(h,p,w);this._findCoveringTileCache[h.id]=this._findCoveringTileCache[h.id]||{};const E=this.proxiedCoords[h.id]=[],I=this.proxyCoords;for(let U=0;U<I.length;U++){const H=I[U],J=this._findTileCoveringTileID(H,h);if(J){const Y=this._createProxiedId(H,J,w[H.key]&&w[H.key][h.id]);E.push(Y),this.proxyToSource[H.key][h.id]=[Y]}}let B=!1;for(let U=0;U<p.length;U++){const H=h.getTile(p[U]);if(!H||!H.hasData())continue;const J=this._findTileCoveringTileID(H.tileID,this.proxySourceCache);if(J&&J.tileID.canonical.z!==H.tileID.canonical.z){const Y=this.proxyToSource[J.tileID.key][h.id],oe=this._createProxiedId(J.tileID,H,w[J.tileID.key]&&w[J.tileID.key][h.id]);Y?Y.splice(Y.length-1,0,oe):this.proxyToSource[J.tileID.key][h.id]=[oe],E.push(oe),B=!0}}this._sourceTilesOverlap[h.id]=B}_setupProxiedCoordsForImageSource(h,p,w){if(!h.getSource().loaded())return;const E=this.proxiedCoords[h.id]=[],I=this.proxyCoords,B=h.getSource(),U=new s.pointGeometry(B.tileID.x,B.tileID.y)._div(1<<B.tileID.z),H=B.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((Y,oe)=>(Y.min.x=Math.min(Y.min.x,oe.x-U.x),Y.min.y=Math.min(Y.min.y,oe.y-U.y),Y.max.x=Math.max(Y.max.x,oe.x-U.x),Y.max.y=Math.max(Y.max.y,oe.y-U.y),Y),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),J=(Y,oe)=>{const me=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),be=Y.canonical.y/(1<<Y.canonical.z),we=s.EXTENT/(1<<Y.canonical.z),Me=oe.wrap+oe.canonical.x/(1<<oe.canonical.z),_e=oe.canonical.y/(1<<oe.canonical.z);return me+we<Me+H.min.x||me>Me+H.max.x||be+we<_e+H.min.y||be>_e+H.max.y};for(let Y=0;Y<I.length;Y++){const oe=I[Y];for(let me=0;me<p.length;me++){const be=h.getTile(p[me]);if(!be||!be.hasData()||J(oe,be.tileID))continue;const we=this._createProxiedId(oe,be,w[oe.key]&&w[oe.key][h.id]),Me=this.proxyToSource[oe.key][h.id];Me?Me.push(we):this.proxyToSource[oe.key][h.id]=[we],E.push(we)}}}_createProxiedId(h,p,w){let E=this.orthoMatrix;if(w){const I=w.find(B=>B.key===p.tileID.key);if(I)return I}if(p.tileID.key!==h.key){const I=h.canonical.z-p.tileID.canonical.z;let B,U,H;E=s.create();const J=p.tileID.wrap-h.wrap<<h.overscaledZ;I>0?(B=s.EXTENT>>I,U=B*((p.tileID.canonical.x<<I)-h.canonical.x+J),H=B*((p.tileID.canonical.y<<I)-h.canonical.y)):(B=s.EXTENT<<-I,U=s.EXTENT*(p.tileID.canonical.x-(h.canonical.x+J<<-I)),H=s.EXTENT*(p.tileID.canonical.y-(h.canonical.y<<-I))),s.ortho(E,0,B,0,B,0,1),s.translate(E,E,[U,H,0])}return new Uu(p.tileID,h.key,E)}_findTileCoveringTileID(h,p){let w=p.getTile(h);if(w&&w.hasData())return w;const E=this._findCoveringTileCache[p.id],I=E[h.key];if(w=I?p.getTileByID(I):null,w&&w.hasData()||I===null)return w;let B=w?w.tileID:h,U=B.overscaledZ;const H=p.getSource().minzoom,J=[];if(!I){const oe=p.getSource().maxzoom;if(h.canonical.z>=oe){const me=h.canonical.z-oe;p.getSource().reparseOverscaled?(U=Math.max(h.canonical.z+2,p.transform.tileZoom),B=new s.OverscaledTileID(U,h.wrap,oe,h.canonical.x>>me,h.canonical.y>>me)):me!==0&&(U=oe,B=new s.OverscaledTileID(U,h.wrap,oe,h.canonical.x>>me,h.canonical.y>>me))}B.key!==h.key&&(J.push(B.key),w=p.getTile(B))}const Y=oe=>{J.forEach(me=>{E[me]=oe}),J.length=0};for(U-=1;U>=H&&(!w||!w.hasData());U--){w&&Y(w.tileID.key);const oe=B.calculateScaledKey(U);if(w=p.getTileByID(oe),w&&w.hasData())break;const me=E[oe];if(me===null)break;me===void 0?J.push(oe):w=p.getTileByID(me)}return Y(w?w.tileID.key:null),w&&w.hasData()?w:null}findDEMTileFor(h){return this.enabled?this._findTileCoveringTileID(h,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(h,p){let w=this._tilesDirty[h];w||(w=this._tilesDirty[h]={}),w[p.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const h=function(p){let w=0;const E=new s.StructArrayLayout2ui4,I=131;for(let B=1;B<129;B++){for(let U=1;U<129;U++)w=B*I+U,E.emplaceBack(w,w+1),E.emplaceBack(w,w+I),E.emplaceBack(w+1,w+I),B===128&&E.emplaceBack(w+I,w+I+1);E.emplaceBack(w+1,w+1+I)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(h),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,h.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class fo{static cacheKey(h,p,w,E){let I=`${p}${E?E.cacheKey:""}`;for(const B of w)h.usedDefines.includes(B)&&(I+=`/${B}`);return I}constructor(h,p,w,E,I,B){const U=h.gl;this.program=U.createProgram();const H=function(_e){const xe=[];for(let ke=0;ke<_e.length;ke++){if(_e[ke]===null)continue;const Ce=_e[ke].split(" ");xe.push(Ce.pop())}return xe}(w.staticAttributes),J=E?E.getBinderAttributes():[],Y=H.concat(J);let oe=E?E.defines():[];oe=oe.concat(B.map(_e=>`#define ${_e}`));const me=oe.concat(h.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Fs):Fs,Fs,Nc,Ph.fragmentSource,Ih.fragmentSource,w.fragmentSource).join(`
`),be=oe.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Nc,Ph.vertexSource,Ih.vertexSource,Yd.vertexSource,w.vertexSource).join(`
`),we=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);U.shaderSource(we,me),U.compileShader(we),U.attachShader(this.program,we);const Me=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())this.failedToCreate=!0;else{U.shaderSource(Me,be),U.compileShader(Me),U.attachShader(this.program,Me),this.attributes={},this.numAttributes=Y.length;for(let _e=0;_e<this.numAttributes;_e++)Y[_e]&&(U.bindAttribLocation(this.program,_e,Y[_e]),this.attributes[Y[_e]]=_e);U.linkProgram(this.program),U.deleteShader(Me),U.deleteShader(we),this.fixedUniforms=I(h),this.binderUniforms=E?E.getUniforms(h):[],B.includes("TERRAIN")&&(this.terrainUniforms=(_e=>({u_dem:new s.Uniform1i(_e),u_dem_prev:new s.Uniform1i(_e),u_dem_unpack:new s.Uniform4f(_e),u_dem_tl:new s.Uniform2f(_e),u_dem_scale:new s.Uniform1f(_e),u_dem_tl_prev:new s.Uniform2f(_e),u_dem_scale_prev:new s.Uniform1f(_e),u_dem_size:new s.Uniform1f(_e),u_dem_lerp:new s.Uniform1f(_e),u_exaggeration:new s.Uniform1f(_e),u_depth:new s.Uniform1i(_e),u_depth_size_inv:new s.Uniform2f(_e),u_meter_to_dem:new s.Uniform1f(_e),u_label_plane_matrix_inv:new s.UniformMatrix4f(_e)}))(h)),B.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new s.Uniform3f(_e),u_tile_tr_up:new s.Uniform3f(_e),u_tile_br_up:new s.Uniform3f(_e),u_tile_bl_up:new s.Uniform3f(_e),u_tile_up_scale:new s.Uniform1f(_e)}))(h)),B.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new s.UniformMatrix4f(_e),u_fog_range:new s.Uniform2f(_e),u_fog_color:new s.Uniform4f(_e),u_fog_horizon_blend:new s.Uniform1f(_e),u_fog_temporal_offset:new s.Uniform1f(_e),u_frustum_tl:new s.Uniform3f(_e),u_frustum_tr:new s.Uniform3f(_e),u_frustum_br:new s.Uniform3f(_e),u_frustum_bl:new s.Uniform3f(_e),u_globe_pos:new s.Uniform3f(_e),u_globe_radius:new s.Uniform1f(_e),u_globe_transition:new s.Uniform1f(_e),u_is_globe:new s.Uniform1i(_e),u_viewport:new s.Uniform2f(_e)}))(h))}}setTerrainUniformValues(h,p){if(!this.terrainUniforms)return;const w=this.terrainUniforms;if(!this.failedToCreate){h.program.set(this.program);for(const E in p)w[E]&&w[E].set(this.program,E,p[E])}}setGlobeUniformValues(h,p){if(!this.globeUniforms)return;const w=this.globeUniforms;if(!this.failedToCreate){h.program.set(this.program);for(const E in p)w[E]&&w[E].set(this.program,E,p[E])}}setFogUniformValues(h,p){if(!this.fogUniforms)return;const w=this.fogUniforms;if(!this.failedToCreate){h.program.set(this.program);for(const E in p)w[E].set(this.program,E,p[E])}}draw(h,p,w,E,I,B,U,H,J,Y,oe,me,be,we,Me){const _e=h.gl;if(this.failedToCreate)return;h.program.set(this.program),h.setDepthMode(w),h.setStencilMode(E),h.setColorMode(I),h.setCullFace(B);for(const ke of Object.keys(this.fixedUniforms))this.fixedUniforms[ke].set(this.program,ke,U[ke]);we&&we.setUniforms(this.program,h,this.binderUniforms,me,{zoom:be});const xe={[_e.LINES]:2,[_e.TRIANGLES]:3,[_e.LINE_STRIP]:1}[p];for(const ke of oe.get()){const Ce=ke.vaos||(ke.vaos={});(Ce[H]||(Ce[H]=new zp)).bind(h,this,J,we?we.getPaintVertexBuffers():[],Y,ke.vertexOffset,Me||[]),_e.drawElements(p,ke.primitiveLength*xe,_e.UNSIGNED_SHORT,ke.primitiveOffset*xe*2)}}}function Zs(y,h){const p=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,y.transform.tileZoom)/p,E=w*(h.tileID.canonical.x+h.tileID.wrap*p),I=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_tile_units_to_pixels:1/ze(h,1,y.transform.tileZoom),u_pixel_coord_upper:[E>>16,I>>16],u_pixel_coord_lower:[65535&E,65535&I]}}const Yl=s.create(),za=(y,h,p,w,E,I,B,U,H,J,Y)=>{const oe=h.style.light,me=oe.properties.get("position"),be=[me.x,me.y,me.z],we=s.create$1();oe.properties.get("anchor")==="viewport"&&(s.fromRotation(we,-h.transform.angle),s.transformMat3(be,be,we));const Me=oe.properties.get("color"),_e=h.transform,xe={u_matrix:y,u_lightpos:be,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[Me.r,Me.g,Me.b],u_vertical_gradient:+p,u_opacity:w,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yl,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:E,u_edge_radius:I};return _e.projection.name==="globe"&&(xe.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],xe.u_zoom_transition=H,xe.u_inv_rot_matrix=Y,xe.u_merc_center=J,xe.u_up_dir=_e.projection.upVector(new s.CanonicalTileID(0,0,0),J[0]*s.EXTENT,J[1]*s.EXTENT),xe.u_height_lift=U),xe},ul=(y,h,p,w,E,I,B,U,H,J,Y,oe)=>{const me=za(y,h,p,w,E,I,B,H,J,Y,oe),be={u_height_factor:-Math.pow(2,B.overscaledZ)/U.tileSize/8};return s.extend(me,Zs(h,U),be)},Oa=y=>({u_matrix:y}),zh=(y,h,p)=>s.extend(Oa(y),Zs(h,p)),Oh=(y,h)=>({u_matrix:y,u_world:h}),Fh=(y,h,p,w)=>s.extend(zh(y,h,p),{u_world:w}),po=s.create(),mo=(y,h,p,w,E,I)=>{const B=y.transform,U=B.projection.name==="globe";let H;if(I.paint.get("circle-pitch-alignment")==="map")if(U){const Y=s.globePixelsToTileUnits(B.zoom,h.canonical)*B._pixelsPerMercatorPixel;H=Float32Array.from([Y,0,0,Y])}else H=B.calculatePixelsToTileUnitsMatrix(p);else H=new Float32Array([B.pixelsToGLUnits[0],0,0,B.pixelsToGLUnits[1]]);const J={u_camera_to_center_distance:B.cameraToCenterDistance,u_matrix:y.translatePosMatrix(h.projMatrix,p,I.paint.get("circle-translate"),I.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:H,u_inv_rot_matrix:po,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(U){J.u_inv_rot_matrix=w,J.u_merc_center=E,J.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],J.u_zoom_transition=s.globeToMercatorTransition(B.zoom);const Y=E[0]*s.EXTENT,oe=E[1]*s.EXTENT;J.u_up_dir=B.projection.upVector(new s.CanonicalTileID(0,0,0),Y,oe)}return J},Mr=y=>{const h=[];return y.paint.get("circle-pitch-alignment")==="map"&&h.push("PITCH_WITH_MAP"),y.paint.get("circle-pitch-scale")==="map"&&h.push("SCALE_WITH_MAP"),h},hl=(y,h,p,w)=>{const E=s.EXTENT/p.tileSize;return{u_matrix:y,u_camera_to_center_distance:h.getCameraToCenterDistance(w),u_extrude_scale:[h.pixelsToGLUnits[0]/E,h.pixelsToGLUnits[1]/E]}},Bs=(y,h,p=1)=>({u_matrix:y,u_color:h,u_overlay:0,u_overlay_scale:p}),Op=s.create(),Bh=(y,h,p,w,E,I,B)=>{const U=y.transform,H=U.projection.name==="globe",J=H?s.globePixelsToTileUnits(U.zoom,h.canonical)*U._pixelsPerMercatorPixel:ze(p,1,I),Y={u_matrix:h.projMatrix,u_extrude_scale:J,u_intensity:B,u_inv_rot_matrix:Op,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(H){Y.u_inv_rot_matrix=w,Y.u_merc_center=E,Y.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],Y.u_zoom_transition=s.globeToMercatorTransition(U.zoom);const oe=E[0]*s.EXTENT,me=E[1]*s.EXTENT;Y.u_up_dir=U.projection.upVector(new s.CanonicalTileID(0,0,0),oe,me)}return Y},Nh=(y,h,p,w,E,I,B)=>{const U=y.transform,H=U.calculatePixelsToTileUnitsMatrix(h);return{u_matrix:Vc(y,h,p,w),u_pixels_to_tile_units:H,u_device_pixel_ratio:I,u_units_to_pixels:[1/U.pixelsToGLUnits[0],1/U.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:E,u_texsize:dl(p)?h.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Uh(h,y.transform),u_alpha_discard_threshold:0,u_trim_offset:B}},Go=(y,h,p,w,E)=>{const I=y.transform;return{u_matrix:Vc(y,h,p,w),u_texsize:h.imageAtlasTexture.size,u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(h),u_device_pixel_ratio:E,u_image:0,u_tile_units_to_pixels:Uh(h,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Uh(y,h){return 1/ze(y,1,h.tileZoom)}function Vc(y,h,p,w){return y.translatePosMatrix(w||h.tileID.projMatrix,h,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}function dl(y){const h=y.paint.get("line-dasharray").value;return h.value||h.kind!=="constant"}const Kd=(y,h,p,w,E,I)=>{return{u_matrix:y,u_tl_parent:h,u_scale_parent:p,u_fade_t:w.mix,u_opacity:w.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(U=E.paint.get("raster-saturation"),U>0?1-1/(1.001-U):-U),u_contrast_factor:(B=E.paint.get("raster-contrast"),B>0?1/(1-B):1+B),u_spin_weights:Gc(E.paint.get("raster-hue-rotate")),u_perspective_transform:I};var B,U};function Gc(y){y*=Math.PI/180;const h=Math.sin(y),p=Math.cos(y);return[(2*p+1)/3,(-Math.sqrt(3)*h-p+1)/3,(Math.sqrt(3)*h-p+1)/3]}const Vh=s.create(),Gh=(y,h,p,w,E,I,B,U,H,J,Y,oe,me,be,we,Me)=>{const _e=E.transform,xe={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:_e.cameraToCenterDistance,u_rotate_symbol:+p,u_aspect_ratio:_e.width/_e.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:B,u_coord_matrix:U,u_is_text:+H,u_pitch_with_map:+w,u_texsize:J,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Vh,u_up_vector:[0,-1,0]};return Me.name==="globe"&&(xe.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],xe.u_zoom_transition=oe,xe.u_inv_rot_matrix=be,xe.u_merc_center=me,xe.u_camera_forward=_e._camera.forward(),xe.u_ecef_origin=s.globeECEFOrigin(_e.globeMatrix,Y.toUnwrapped()),xe.u_tile_matrix=Float32Array.from(_e.globeMatrix),xe.u_up_vector=we),xe},Fp=(y,h,p,w,E,I,B,U,H,J,Y,oe,me,be,we,Me,_e)=>s.extend(Gh(y,h,p,w,E,I,B,U,H,J,oe,me,be,we,Me,_e),{u_gamma_scale:w?E.transform.cameraToCenterDistance*Math.cos(E.terrain?0:E.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+Y}),fl=(y,h,p,w,E,I,B,U,H,J,Y,oe,me,be,we,Me)=>s.extend(Fp(y,h,p,w,E,I,B,U,!0,H,!0,Y,oe,me,be,we,Me),{u_texsize_icon:J,u_texture_icon:1}),Cg=(y,h,p)=>({u_matrix:y,u_opacity:h,u_color:p}),Wc=(y,h,p,w,E)=>s.extend(function(I,B,U){const H=B.imageManager.getPattern(I.toString()),{width:J,height:Y}=B.imageManager.getPixelSize(),oe=Math.pow(2,U.tileID.overscaledZ),me=U.tileSize*Math.pow(2,B.transform.tileZoom)/oe,be=me*(U.tileID.canonical.x+U.tileID.wrap*oe),we=me*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[J,Y],u_pattern_size:H.displaySize,u_tile_units_to_pixels:1/ze(U,1,B.transform.tileZoom),u_pixel_coord_upper:[be>>16,we>>16],u_pixel_coord_lower:[65535&be,65535&we]}}(w,p,E),{u_matrix:y,u_opacity:h}),Wo={fillExtrusion:y=>({u_matrix:new s.UniformMatrix4f(y),u_lightpos:new s.Uniform3f(y),u_lightintensity:new s.Uniform1f(y),u_lightcolor:new s.Uniform3f(y),u_vertical_gradient:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y),u_edge_radius:new s.Uniform1f(y),u_ao:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_up_dir:new s.Uniform3f(y),u_height_lift:new s.Uniform1f(y)}),fillExtrusionPattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_lightpos:new s.Uniform3f(y),u_lightintensity:new s.Uniform1f(y),u_lightcolor:new s.Uniform3f(y),u_vertical_gradient:new s.Uniform1f(y),u_height_factor:new s.Uniform1f(y),u_edge_radius:new s.Uniform1f(y),u_ao:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_up_dir:new s.Uniform3f(y),u_height_lift:new s.Uniform1f(y),u_image:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y)}),fill:y=>({u_matrix:new s.UniformMatrix4f(y)}),fillPattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_image:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y)}),fillOutline:y=>({u_matrix:new s.UniformMatrix4f(y),u_world:new s.Uniform2f(y)}),fillOutlinePattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_world:new s.Uniform2f(y),u_image:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y)}),circle:y=>({u_camera_to_center_distance:new s.Uniform1f(y),u_extrude_scale:new s.UniformMatrix2f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_up_dir:new s.Uniform3f(y)}),collisionBox:y=>({u_matrix:new s.UniformMatrix4f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_extrude_scale:new s.Uniform2f(y)}),collisionCircle:y=>({u_matrix:new s.UniformMatrix4f(y),u_inv_matrix:new s.UniformMatrix4f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_viewport_size:new s.Uniform2f(y)}),debug:y=>({u_color:new s.UniformColor(y),u_matrix:new s.UniformMatrix4f(y),u_overlay:new s.Uniform1i(y),u_overlay_scale:new s.Uniform1f(y)}),clippingMask:y=>({u_matrix:new s.UniformMatrix4f(y)}),heatmap:y=>({u_extrude_scale:new s.Uniform1f(y),u_intensity:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_up_dir:new s.Uniform3f(y)}),heatmapTexture:y=>({u_image:new s.Uniform1i(y),u_color_ramp:new s.Uniform1i(y),u_opacity:new s.Uniform1f(y)}),hillshade:y=>({u_matrix:new s.UniformMatrix4f(y),u_image:new s.Uniform1i(y),u_latrange:new s.Uniform2f(y),u_light:new s.Uniform2f(y),u_shadow:new s.UniformColor(y),u_highlight:new s.UniformColor(y),u_accent:new s.UniformColor(y)}),hillshadePrepare:y=>({u_matrix:new s.UniformMatrix4f(y),u_image:new s.Uniform1i(y),u_dimension:new s.Uniform2f(y),u_zoom:new s.Uniform1f(y),u_unpack:new s.Uniform4f(y)}),line:y=>({u_matrix:new s.UniformMatrix4f(y),u_pixels_to_tile_units:new s.UniformMatrix2f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_units_to_pixels:new s.Uniform2f(y),u_dash_image:new s.Uniform1i(y),u_gradient_image:new s.Uniform1i(y),u_image_height:new s.Uniform1f(y),u_texsize:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y),u_alpha_discard_threshold:new s.Uniform1f(y),u_trim_offset:new s.Uniform2f(y)}),linePattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_texsize:new s.Uniform2f(y),u_pixels_to_tile_units:new s.UniformMatrix2f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_image:new s.Uniform1i(y),u_units_to_pixels:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y),u_alpha_discard_threshold:new s.Uniform1f(y)}),raster:y=>({u_matrix:new s.UniformMatrix4f(y),u_tl_parent:new s.Uniform2f(y),u_scale_parent:new s.Uniform1f(y),u_fade_t:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y),u_image0:new s.Uniform1i(y),u_image1:new s.Uniform1i(y),u_brightness_low:new s.Uniform1f(y),u_brightness_high:new s.Uniform1f(y),u_saturation_factor:new s.Uniform1f(y),u_contrast_factor:new s.Uniform1f(y),u_spin_weights:new s.Uniform3f(y),u_perspective_transform:new s.Uniform2f(y)}),symbolIcon:y=>({u_is_size_zoom_constant:new s.Uniform1i(y),u_is_size_feature_constant:new s.Uniform1i(y),u_size_t:new s.Uniform1f(y),u_size:new s.Uniform1f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_rotate_symbol:new s.Uniform1i(y),u_aspect_ratio:new s.Uniform1f(y),u_fade_change:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_label_plane_matrix:new s.UniformMatrix4f(y),u_coord_matrix:new s.UniformMatrix4f(y),u_is_text:new s.Uniform1i(y),u_pitch_with_map:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_camera_forward:new s.Uniform3f(y),u_tile_matrix:new s.UniformMatrix4f(y),u_up_vector:new s.Uniform3f(y),u_ecef_origin:new s.Uniform3f(y),u_texture:new s.Uniform1i(y)}),symbolSDF:y=>({u_is_size_zoom_constant:new s.Uniform1i(y),u_is_size_feature_constant:new s.Uniform1i(y),u_size_t:new s.Uniform1f(y),u_size:new s.Uniform1f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_rotate_symbol:new s.Uniform1i(y),u_aspect_ratio:new s.Uniform1f(y),u_fade_change:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_label_plane_matrix:new s.UniformMatrix4f(y),u_coord_matrix:new s.UniformMatrix4f(y),u_is_text:new s.Uniform1i(y),u_pitch_with_map:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_texture:new s.Uniform1i(y),u_gamma_scale:new s.Uniform1f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_camera_forward:new s.Uniform3f(y),u_tile_matrix:new s.UniformMatrix4f(y),u_up_vector:new s.Uniform3f(y),u_ecef_origin:new s.Uniform3f(y),u_is_halo:new s.Uniform1i(y)}),symbolTextAndIcon:y=>({u_is_size_zoom_constant:new s.Uniform1i(y),u_is_size_feature_constant:new s.Uniform1i(y),u_size_t:new s.Uniform1f(y),u_size:new s.Uniform1f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_rotate_symbol:new s.Uniform1i(y),u_aspect_ratio:new s.Uniform1f(y),u_fade_change:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_label_plane_matrix:new s.UniformMatrix4f(y),u_coord_matrix:new s.UniformMatrix4f(y),u_is_text:new s.Uniform1i(y),u_pitch_with_map:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_texsize_icon:new s.Uniform2f(y),u_texture:new s.Uniform1i(y),u_texture_icon:new s.Uniform1i(y),u_gamma_scale:new s.Uniform1f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_is_halo:new s.Uniform1i(y)}),background:y=>({u_matrix:new s.UniformMatrix4f(y),u_opacity:new s.Uniform1f(y),u_color:new s.UniformColor(y)}),backgroundPattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_opacity:new s.Uniform1f(y),u_image:new s.Uniform1i(y),u_pattern_tl:new s.Uniform2f(y),u_pattern_br:new s.Uniform2f(y),u_texsize:new s.Uniform2f(y),u_pattern_size:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y)}),terrainRaster:Xl,terrainDepth:Xl,skybox:y=>({u_matrix:new s.UniformMatrix4f(y),u_sun_direction:new s.Uniform3f(y),u_cubemap:new s.Uniform1i(y),u_opacity:new s.Uniform1f(y),u_temporal_offset:new s.Uniform1f(y)}),skyboxGradient:y=>({u_matrix:new s.UniformMatrix4f(y),u_color_ramp:new s.Uniform1i(y),u_center_direction:new s.Uniform3f(y),u_radius:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y),u_temporal_offset:new s.Uniform1f(y)}),skyboxCapture:y=>({u_matrix_3f:new s.UniformMatrix3f(y),u_sun_direction:new s.Uniform3f(y),u_sun_intensity:new s.Uniform1f(y),u_color_tint_r:new s.Uniform4f(y),u_color_tint_m:new s.Uniform4f(y),u_luminance:new s.Uniform1f(y)}),globeRaster:y=>({u_proj_matrix:new s.UniformMatrix4f(y),u_globe_matrix:new s.UniformMatrix4f(y),u_normalize_matrix:new s.UniformMatrix4f(y),u_merc_matrix:new s.UniformMatrix4f(y),u_zoom_transition:new s.Uniform1f(y),u_merc_center:new s.Uniform2f(y),u_image0:new s.Uniform1i(y),u_grid_matrix:new s.UniformMatrix3f(y),u_frustum_tl:new s.Uniform3f(y),u_frustum_tr:new s.Uniform3f(y),u_frustum_br:new s.Uniform3f(y),u_frustum_bl:new s.Uniform3f(y),u_globe_pos:new s.Uniform3f(y),u_globe_radius:new s.Uniform1f(y),u_viewport:new s.Uniform2f(y)}),globeAtmosphere:y=>({u_frustum_tl:new s.Uniform3f(y),u_frustum_tr:new s.Uniform3f(y),u_frustum_br:new s.Uniform3f(y),u_frustum_bl:new s.Uniform3f(y),u_horizon:new s.Uniform1f(y),u_transition:new s.Uniform1f(y),u_fadeout_range:new s.Uniform1f(y),u_color:new s.Uniform4f(y),u_high_color:new s.Uniform4f(y),u_space_color:new s.Uniform4f(y),u_star_intensity:new s.Uniform1f(y),u_star_density:new s.Uniform1f(y),u_star_size:new s.Uniform1f(y),u_temporal_offset:new s.Uniform1f(y),u_horizon_angle:new s.Uniform1f(y),u_rotation_matrix:new s.UniformMatrix4f(y)})};let Fa;function Hc(y,h,p,w,E,I,B){const U=y.context,H=U.gl,J=y.transform,Y=y.useProgram("collisionBox"),oe=[];let me=0,be=0;for(let Ue=0;Ue<w.length;Ue++){const Ze=w[Ue],qe=h.getTile(Ze),tt=qe.getBucket(p);if(!tt)continue;const ft=il(Ze,tt,J);let lt=ft;E[0]===0&&E[1]===0||(lt=y.translatePosMatrix(ft,qe,E,I));const it=B?tt.textCollisionBox:tt.iconCollisionBox,Gt=tt.collisionCircleArray;if(Gt.length>0){const ot=s.create(),bt=lt;s.mul(ot,tt.placementInvProjMatrix,J.glCoordMatrix),s.mul(ot,ot,tt.placementViewportMatrix),oe.push({circleArray:Gt,circleOffset:be,transform:bt,invTransform:ot,projection:tt.getProjection()}),me+=Gt.length/4,be=me}it&&(y.terrain&&y.terrain.setupElevationDraw(qe,Y),Y.draw(U,H.LINES,s.DepthMode.disabled,s.StencilMode.disabled,y.colorModeForRenderPass(),s.CullFaceMode.disabled,hl(lt,J,qe,tt.getProjection()),p.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,J.zoom,null,[it.collisionVertexBuffer,it.collisionVertexBufferExt]))}if(!B||!oe.length)return;const we=y.useProgram("collisionCircle"),Me=new s.StructArrayLayout2f1f2i16;Me.resize(4*me),Me._trim();let _e=0;for(const Ue of oe)for(let Ze=0;Ze<Ue.circleArray.length/4;Ze++){const qe=4*Ze,tt=Ue.circleArray[qe+0],ft=Ue.circleArray[qe+1],lt=Ue.circleArray[qe+2],it=Ue.circleArray[qe+3];Me.emplace(_e++,tt,ft,lt,it,0),Me.emplace(_e++,tt,ft,lt,it,1),Me.emplace(_e++,tt,ft,lt,it,2),Me.emplace(_e++,tt,ft,lt,it,3)}(!Fa||Fa.length<2*me)&&(Fa=function(Ue){const Ze=2*Ue,qe=new s.StructArrayLayout3ui6;qe.resize(Ze),qe._trim();for(let tt=0;tt<Ze;tt++){const ft=6*tt;qe.uint16[ft+0]=4*tt+0,qe.uint16[ft+1]=4*tt+1,qe.uint16[ft+2]=4*tt+2,qe.uint16[ft+3]=4*tt+2,qe.uint16[ft+4]=4*tt+3,qe.uint16[ft+5]=4*tt+0}return qe}(me));const xe=U.createIndexBuffer(Fa,!0),ke=U.createVertexBuffer(Me,s.collisionCircleLayout.members,!0);for(const Ue of oe){const Ze={u_matrix:Ue.transform,u_inv_matrix:Ue.invTransform,u_camera_to_center_distance:(Ce=J).getCameraToCenterDistance(Ue.projection),u_viewport_size:[Ce.width,Ce.height]};we.draw(U,H.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,y.colorModeForRenderPass(),s.CullFaceMode.disabled,Ze,p.id,ke,xe,s.SegmentVector.simpleSegment(0,2*Ue.circleOffset,Ue.circleArray.length,Ue.circleArray.length/2),null,J.zoom)}var Ce;ke.destroy(),xe.destroy()}const go=s.create();function Bp({width:y,height:h,anchor:p,textOffset:w,textScale:E},I){const{horizontalAlign:B,verticalAlign:U}=s.getAnchorAlignment(p),H=-(B-.5)*y,J=-(U-.5)*h,Y=s.evaluateVariableOffset(p,w);return new s.pointGeometry((H/E+Y[0])*I,(J/E+Y[1])*I)}function jc(y,h,p,w,E,I,B,U,H,J,Y){const oe=y.text.placedSymbolArray,me=y.text.dynamicLayoutVertexArray,be=y.icon.dynamicLayoutVertexArray,we={},Me=y.getProjection(),_e=jl(U,Me,I),xe=I.elevation,ke=Me.upVectorScale(U.canonical,I.center.lat,I.worldSize).metersToTile;me.clear();for(let Ce=0;Ce<oe.length;Ce++){const Ue=oe.get(Ce),{tileAnchorX:Ze,tileAnchorY:qe,numGlyphs:tt}=Ue,ft=y.allowVerticalPlacement&&!Ue.placedOrientation,lt=Ue.hidden||!Ue.crossTileID||ft?null:w[Ue.crossTileID];if(lt){let it=0,Gt=0,ot=0;if(xe){const Qt=xe?xe.getAtTileOffset(U,Ze,qe):0,[mn,cn,Fn]=Me.upVector(U.canonical,Ze,qe);it=Qt*mn*ke,Gt=Qt*cn*ke,ot=Qt*Fn*ke}let[bt,mt,Ut,gt]=qi(Ue.projectedAnchorX+it,Ue.projectedAnchorY+Gt,Ue.projectedAnchorZ+ot,p?_e:B);const kt=Jt(I.getCameraToCenterDistance(Me),gt);let Dt=E.evaluateSizeForFeature(y.textSizeData,J,Ue)*kt/s.ONE_EM;p&&(Dt*=y.tilePixelRatio/H);const Ye=Bp(lt,Dt);p?({x:bt,y:mt,z:Ut}=Me.projectTilePoint(Ze+Ye.x,qe+Ye.y,U.canonical),[bt,mt,Ut]=qi(bt+it,mt+Gt,Ut+ot,B)):(h&&Ye._rotate(-I.angle),bt+=Ye.x,mt+=Ye.y,Ut=0);const at=y.allowVerticalPlacement&&Ue.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let Qt=0;Qt<tt;Qt++)s.addDynamicAttributes(me,bt,mt,Ut,at);Y&&Ue.associatedIconIndex>=0&&(we[Ue.associatedIconIndex]={x:bt,y:mt,z:Ut,angle:at})}else Ms(tt,me)}if(Y){be.clear();const Ce=y.icon.placedSymbolArray;for(let Ue=0;Ue<Ce.length;Ue++){const Ze=Ce.get(Ue),{numGlyphs:qe}=Ze,tt=we[Ue];if(Ze.hidden||!tt)Ms(qe,be);else{const{x:ft,y:lt,z:it,angle:Gt}=tt;for(let ot=0;ot<qe;ot++)s.addDynamicAttributes(be,ft,lt,it,Gt)}}y.icon.dynamicLayoutVertexBuffer.updateData(be)}y.text.dynamicLayoutVertexBuffer.updateData(me)}function Np(y,h,p){return p.iconsInText&&h?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function pl(y,h,p,w,E,I,B,U,H,J,Y,oe){const me=y.context,be=me.gl,we=y.transform,Me=U==="map",_e=H==="map",xe=Me&&p.layout.get("symbol-placement")!=="point",ke=Me&&!_e&&!xe,Ce=p.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ue=!1;const Ze=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),qe=[s.mercatorXfromLng(we.center.lng),s.mercatorYfromLat(we.center.lat)],tt=p.layout.get("text-variable-anchor"),ft=we.projection.name==="globe",lt=[],it=[0,-1,0];let Gt=it;!ft&&!we.mercatorFromTransition||Me||(Gt=function(ot){const bt=ot._camera.getWorldToCamera(ot.worldSize,1),mt=s.multiply([],bt,ot.globeMatrix);s.invert(mt,mt);const Ut=[0,0,0],gt=[0,1,0,0];return s.transformMat4$1(gt,gt,mt),Ut[0]=gt[0],Ut[1]=gt[1],Ut[2]=gt[2],s.normalize(Ut,Ut),Ut}(we));for(const ot of w){const bt=h.getTile(ot),mt=bt.getBucket(p);if(!mt||mt.projection.name==="mercator"&&ft)continue;const Ut=E?mt.text:mt.icon;if(!Ut||mt.fullyClipped||!Ut.segments.get().length)continue;const gt=Ut.programConfigurations.get(p.id),kt=E||mt.sdfIcons,Dt=E?mt.textSizeData:mt.iconSizeData,Ye=_e||we.pitch!==0,at=s.evaluateSizeForZoom(Dt,we.zoom);let Qt,mn,cn,Fn,Rn=[0,0],Cn=null;if(E){if(mn=bt.glyphAtlasTexture,cn=be.LINEAR,Qt=bt.glyphAtlasTexture.size,mt.iconsInText){Rn=bt.imageAtlasTexture.size,Cn=bt.imageAtlasTexture;const ns=Dt.kind==="composite"||Dt.kind==="camera";Fn=Ye||y.options.rotating||y.options.zooming||ns?be.LINEAR:be.NEAREST}}else{const ns=p.layout.get("icon-size").constantOr(0)!==1||mt.iconsNeedLinear;mn=bt.imageAtlasTexture,cn=kt||y.options.rotating||y.options.zooming||ns||Ye?be.LINEAR:be.NEAREST,Qt=bt.imageAtlasTexture.size}const an=mt.projection.name==="globe",ki=an?Gt:it,bi=an?s.globeToMercatorTransition(we.zoom):0,Di=jl(ot,mt.getProjection(),we),si=we.calculatePixelsToTileUnitsMatrix(bt),Ns=ci(Di,bt.tileID.canonical,_e,Me,we,mt.getProjection(),si),Ys=y.terrain&&_e&&xe?s.invert(s.create(),Ns):go,jr=Nr(Di,bt.tileID.canonical,_e,Me,we,mt.getProjection(),si),Po=tt&&mt.hasTextData(),Zi=p.layout.get("icon-text-fit")!=="none"&&Po&&mt.hasIconData();if(xe){const ns=we.elevation,Ur=ns?ns.getAtTileOffsetFunc(ot,we.center.lat,we.worldSize,mt.getProjection()):null,ko=yr(Di,bt.tileID.canonical,_e,Me,we,mt.getProjection(),si);Jn(mt,Di,y,E,ko,jr,_e,J,Ur,ot)}const Si=xe||E&&tt||Zi,yi=y.translatePosMatrix(Di,bt,I,B),tr=Si?go:Ns,ts=y.translatePosMatrix(jr,bt,I,B,!0),Oi=mt.getProjection().createInversionMatrix(we,ot.canonical),Cs=[];y.terrainRenderModeElevated()&&_e&&Cs.push("PITCH_WITH_MAP_TERRAIN"),an&&Cs.push("PROJECTION_GLOBE_VIEW"),Si&&Cs.push("PROJECTED_POS_ON_VIEWPORT");const tc=kt&&p.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qo;qo=kt?mt.iconsInText?fl(Dt.kind,at,ke,_e,y,yi,tr,ts,Qt,Rn,ot,bi,qe,Oi,ki,mt.getProjection()):Fp(Dt.kind,at,ke,_e,y,yi,tr,ts,E,Qt,!0,ot,bi,qe,Oi,ki,mt.getProjection()):Gh(Dt.kind,at,ke,_e,y,yi,tr,ts,E,Qt,ot,bi,qe,Oi,ki,mt.getProjection());const $i={program:y.useProgram(Np(kt,E,mt),gt,Cs),buffers:Ut,uniformValues:qo,atlasTexture:mn,atlasTextureIcon:Cn,atlasInterpolation:cn,atlasInterpolationIcon:Fn,isSDF:kt,hasHalo:tc,tile:bt,labelPlaneMatrixInv:Ys};if(Ce&&mt.canOverlap){Ue=!0;const ns=Ut.segments.get();for(const Ur of ns)lt.push({segments:new s.SegmentVector([Ur]),sortKey:Ur.sortKey,state:$i})}else lt.push({segments:Ut.segments,sortKey:0,state:$i})}Ue&&lt.sort((ot,bt)=>ot.sortKey-bt.sortKey);for(const ot of lt){const bt=ot.state;if(y.terrain&&y.terrain.setupElevationDraw(bt.tile,bt.program,{useDepthForOcclusion:!ft,labelPlaneMatrixInv:bt.labelPlaneMatrixInv}),me.activeTexture.set(be.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,be.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(me.activeTexture.set(be.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,be.CLAMP_TO_EDGE)),bt.isSDF){const mt=bt.uniformValues;bt.hasHalo&&(mt.u_is_halo=1,Tr(bt.buffers,ot.segments,p,y,bt.program,Ze,Y,oe,mt)),mt.u_is_halo=0}Tr(bt.buffers,ot.segments,p,y,bt.program,Ze,Y,oe,bt.uniformValues)}}function Tr(y,h,p,w,E,I,B,U,H){const J=w.context,Y=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.globeExtVertexBuffer];E.draw(J,J.gl.TRIANGLES,I,B,U,s.CullFaceMode.disabled,H,p.id,y.layoutVertexBuffer,y.indexBuffer,h,p.paint,w.transform.zoom,y.programConfigurations.get(p.id),Y)}function Wh(y,h,p,w,E,I,B){const U=y.context.gl,H=p.paint.get("fill-pattern"),J=H&&H.constantOr(1);let Y,oe,me,be,we;B?(oe=J&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=U.LINES):(oe=J?"fillPattern":"fill",Y=U.TRIANGLES);for(const Me of w){const _e=h.getTile(Me);if(J&&!_e.patternsLoaded())continue;const xe=_e.getBucket(p);if(!xe)continue;y.prepareDrawTile();const ke=xe.programConfigurations.get(p.id),Ce=y.useProgram(oe,ke);J&&(y.context.activeTexture.set(U.TEXTURE0),_e.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),ke.updatePaintBuffers());const Ue=H.constantOr(null);if(Ue&&_e.imageAtlas){const qe=_e.imageAtlas.patternPositions[Ue.toString()];qe&&ke.setConstantPatternPositions(qe)}const Ze=y.translatePosMatrix(Me.projMatrix,_e,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(B){be=xe.indexBuffer2,we=xe.segments2;const qe=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];me=oe==="fillOutlinePattern"&&J?Fh(Ze,y,_e,qe):Oh(Ze,qe)}else be=xe.indexBuffer,we=xe.segments,me=J?zh(Ze,y,_e):Oa(Ze);y.prepareDrawProgram(y.context,Ce,Me.toUnwrapped()),Ce.draw(y.context,Y,E,y.stencilModeForClipping(Me),I,s.CullFaceMode.disabled,me,p.id,xe.layoutVertexBuffer,be,we,p.paint,y.transform.zoom,ke)}}function Hh(y,h,p,w,E,I,B){const U=y.context,H=U.gl,J=y.transform,Y=p.paint.get("fill-extrusion-pattern"),oe=Y.constantOr(1),me=p.paint.get("fill-extrusion-opacity"),be=[p.paint.get("fill-extrusion-ambient-occlusion-intensity"),p.paint.get("fill-extrusion-ambient-occlusion-radius")],we=p.layout.get("fill-extrusion-edge-radius"),Me=J.projection.name==="globe"?s.fillExtrusionHeightLift():0,_e=J.projection.name==="globe",xe=_e?s.globeToMercatorTransition(J.zoom):0,ke=[s.mercatorXfromLng(J.center.lng),s.mercatorYfromLat(J.center.lat)],Ce=[];_e&&(Ce.push("PROJECTION_GLOBE_VIEW"),y.style.terrainSetForDrapingOnly()&&Ce.push("TERRAIN")),be[0]>0&&Ce.push("FAUX_AO");for(const Ue of w){const Ze=h.getTile(Ue),qe=Ze.getBucket(p);if(!qe||qe.projection.name!==J.projection.name)continue;const tt=qe.programConfigurations.get(p.id),ft=y.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",tt,Ce);if(y.terrain){const Ut=y.terrain;if(y.style.terrainSetForDrapingOnly())Ut.setupElevationDraw(Ze,ft,{useMeterToDem:!0});else{if(!qe.enableTerrain)continue;if(Ut.setupElevationDraw(Ze,ft,{useMeterToDem:!0}),Up(U,h,Ue,qe,p,Ut),!qe.centroidVertexBuffer){const gt=ft.attributes.a_centroid_pos;gt!==void 0&&H.vertexAttrib2f(gt,0,0)}}}oe&&(y.context.activeTexture.set(H.TEXTURE0),Ze.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),tt.updatePaintBuffers());const lt=Y.constantOr(null);if(lt&&Ze.imageAtlas){const Ut=Ze.imageAtlas.patternPositions[lt.toString()];Ut&&tt.setConstantPatternPositions(Ut)}const it=y.translatePosMatrix(Ue.projMatrix,Ze,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Gt=J.projection.createInversionMatrix(J,Ue.canonical),ot=p.paint.get("fill-extrusion-vertical-gradient"),bt=oe?ul(it,y,ot,me,be,we,Ue,Ze,Me,xe,ke,Gt):za(it,y,ot,me,be,we,Ue,Me,xe,ke,Gt);y.prepareDrawProgram(U,ft,Ue.toUnwrapped());const mt=[];y.terrain&&mt.push(qe.centroidVertexBuffer),_e&&mt.push(qe.layoutVertexExtBuffer),ft.draw(U,U.gl.TRIANGLES,E,I,B,s.CullFaceMode.backCCW,bt,p.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,p.paint,y.transform.zoom,tt,mt)}}function Up(y,h,p,w,E,I){const B=[xe=>{let ke=xe.canonical.x-1,Ce=xe.wrap;return ke<0&&(ke=(1<<xe.canonical.z)-1,Ce--),new s.OverscaledTileID(xe.overscaledZ,Ce,xe.canonical.z,ke,xe.canonical.y)},xe=>{let ke=xe.canonical.x+1,Ce=xe.wrap;return ke===1<<xe.canonical.z&&(ke=0,Ce++),new s.OverscaledTileID(xe.overscaledZ,Ce,xe.canonical.z,ke,xe.canonical.y)},xe=>new s.OverscaledTileID(xe.overscaledZ,xe.wrap,xe.canonical.z,xe.canonical.x,(xe.canonical.y===0?1<<xe.canonical.z:xe.canonical.y)-1),xe=>new s.OverscaledTileID(xe.overscaledZ,xe.wrap,xe.canonical.z,xe.canonical.x,xe.canonical.y===(1<<xe.canonical.z)-1?0:xe.canonical.y+1)],U=xe=>{const ke=h.getSource().minzoom,Ce=Ze=>{const qe=h.getTileByID(Ze);if(qe&&qe.hasData())return qe.getBucket(E)},Ue=[0,-1,1];for(const Ze of Ue){if(xe.overscaledZ+Ze<ke)continue;const qe=Ce(xe.calculateScaledKey(xe.overscaledZ+Ze));if(qe)return qe}},H=[0,0,0],J=(xe,ke)=>(H[0]=Math.min(xe.min.y,ke.min.y),H[1]=Math.max(xe.max.y,ke.max.y),H[2]=s.EXTENT-ke.min.x>xe.max.x?ke.min.x-s.EXTENT:xe.max.x,H),Y=(xe,ke)=>(H[0]=Math.min(xe.min.x,ke.min.x),H[1]=Math.max(xe.max.x,ke.max.x),H[2]=s.EXTENT-ke.min.y>xe.max.y?ke.min.y-s.EXTENT:xe.max.y,H),oe=[(xe,ke)=>J(xe,ke),(xe,ke)=>J(ke,xe),(xe,ke)=>Y(xe,ke),(xe,ke)=>Y(ke,xe)],me=new s.pointGeometry(0,0);let be,we,Me;const _e=(xe,ke,Ce,Ue,Ze)=>{const qe=[[Ue?Ce:xe,Ue?xe:Ce,0],[Ue?Ce:ke,Ue?ke:Ce,0]],tt=Ze<0?s.EXTENT+Ze:Ze,ft=[Ue?tt:(xe+ke)/2,Ue?(xe+ke)/2:tt,0];return Ce===0&&Ze<0||Ce!==0&&Ze>0?I.getForTilePoints(Me,[ft],!0,we):qe.push(ft),I.getForTilePoints(p,qe,!0,be),Math.max(qe[0][2],qe[1][2],ft[2])/I.exaggeration()};for(let xe=0;xe<4;xe++){const ke=(xe<2?1:5)-xe,Ce=w.borders[xe];if(Ce.length===0)continue;const Ue=Me=B[xe](p),Ze=U(Ue);if(!(Ze&&Ze instanceof s.FillExtrusionBucket&&Ze.enableTerrain)||w.borderDoneWithNeighborZ[xe]===Ze.canonical.z&&Ze.borderDoneWithNeighborZ[ke]===w.canonical.z||(we=I.findDEMTileFor(Ue),!we||!we.dem))continue;if(!be){const lt=I.findDEMTileFor(p);if(!lt||!lt.dem)return;be=lt}const qe=Ze.borders[ke];let tt=0;const ft=Ze.borderDoneWithNeighborZ[ke]!==w.canonical.z;if(w.canonical.z===Ze.canonical.z){for(let lt=0;lt<Ce.length;lt++){const it=w.featuresOnBorder[Ce[lt]],Gt=it.borders[xe];let ot;for(;tt<qe.length&&(ot=Ze.featuresOnBorder[qe[tt]],!(ot.borders[ke][1]>Gt[0]+3));)ft&&Ze.encodeCentroid(void 0,ot,!1),tt++;if(ot&&tt<qe.length){const bt=tt;let mt=0;for(;!(ot.borders[ke][0]>Gt[1]-3)&&(mt++,++tt!==qe.length);)ot=Ze.featuresOnBorder[qe[tt]];if(ot=Ze.featuresOnBorder[qe[bt]],it.intersectsCount()>1||ot.intersectsCount()>1||mt!==1){mt!==1&&(tt=bt),w.encodeCentroid(void 0,it,!1),ft&&Ze.encodeCentroid(void 0,ot,!1);continue}const Ut=oe[xe](it,ot),gt=xe%2?s.EXTENT-1:0;me.x=_e(Ut[0],Math.min(s.EXTENT-1,Ut[1]),gt,xe<2,Ut[2]),me.y=0,w.encodeCentroid(me,it,!1),ft&&Ze.encodeCentroid(me,ot,!1)}else w.encodeCentroid(void 0,it,!1)}w.borderDoneWithNeighborZ[xe]=Ze.canonical.z,w.needsCentroidUpdate=!0,ft&&(Ze.borderDoneWithNeighborZ[ke]=w.canonical.z,Ze.needsCentroidUpdate=!0)}else{for(const lt of Ce)w.encodeCentroid(void 0,w.featuresOnBorder[lt],!1);if(ft){for(const lt of qe)Ze.encodeCentroid(void 0,Ze.featuresOnBorder[lt],!1);Ze.borderDoneWithNeighborZ[ke]=w.canonical.z,Ze.needsCentroidUpdate=!0}w.borderDoneWithNeighborZ[xe]=Ze.canonical.z,w.needsCentroidUpdate=!0}}(w.needsCentroidUpdate||!w.centroidVertexBuffer&&w.centroidVertexArray.length!==0)&&w.uploadCentroid(y)}const Qd=new s.Color(1,0,0,1),Ho=new s.Color(0,1,0,1),Jl=new s.Color(0,0,1,1),Er=new s.Color(1,0,1,1),Es=new s.Color(0,1,1,1);function es(y,h,p){const w=y.context,E=y.transform,I=w.gl,B=E.projection.name==="globe",U=B?["PROJECTION_GLOBE_VIEW"]:null;let H=p.projMatrix;if(B&&s.globeToMercatorTransition(E.zoom)>0){const it=s.transitionTileAABBinECEF(p.canonical,E),Gt=s.globeDenormalizeECEF(it);H=s.multiply(new Float32Array(16),E.globeMatrix,Gt),s.multiply(H,E.projMatrix,H)}const J=y.useProgram("debug",null,U),Y=h.getTileByID(p.key);y.terrain&&y.terrain.setupElevationDraw(Y,J);const oe=s.DepthMode.disabled,me=s.StencilMode.disabled,be=y.colorModeForRenderPass(),we="$debug";w.activeTexture.set(I.TEXTURE0),y.emptyTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),B?Y._makeGlobeTileDebugBuffers(y.context,E):Y._makeDebugTileBoundsBuffers(y.context,E.projection);const Me=Y._tileDebugBuffer||y.debugBuffer,_e=Y._tileDebugIndexBuffer||y.debugIndexBuffer,xe=Y._tileDebugSegments||y.debugSegments;J.draw(w,I.LINE_STRIP,oe,me,be,s.CullFaceMode.disabled,Bs(H,s.Color.red),we,Me,_e,xe,null,null,null,[Y._globeTileDebugBorderBuffer]);const ke=Y.latestRawTileData,Ce=Math.floor((ke&&ke.byteLength||0)/1024),Ue=h.getTile(p).tileSize,Ze=512/Math.min(Ue,512)*(p.overscaledZ/E.zoom)*.5;let qe=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(qe+=` => ${p.overscaledZ}`),qe+=` ${Ce}kb`,function(it,Gt){it.initDebugOverlayCanvas();const ot=it.debugOverlayCanvas,bt=it.context.gl,mt=it.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,ot.width,ot.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(Gt,5,5),mt.strokeText(Gt,5,5),it.debugOverlayTexture.update(ot),it.debugOverlayTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE)}(y,qe);const tt=Y._tileDebugTextBuffer||y.debugBuffer,ft=Y._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,lt=Y._tileDebugTextSegments||y.debugSegments;J.draw(w,I.TRIANGLES,oe,me,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Bs(H,s.Color.transparent,Ze),we,tt,ft,lt,null,null,null,[Y._globeTileDebugTextBuffer])}function Vu(y,h,p,w){_o(y,0,h+p/2,y.transform.width,p,w)}function Kl(y,h,p,w){_o(y,h-p/2,0,p,y.transform.height,w)}function _o(y,h,p,w,E,I){const B=y.context,U=B.gl;U.enable(U.SCISSOR_TEST),U.scissor(h*s.exported.devicePixelRatio,p*s.exported.devicePixelRatio,w*s.exported.devicePixelRatio,E*s.exported.devicePixelRatio),B.clear({color:I}),U.disable(U.SCISSOR_TEST)}const jh=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:As}=jh;function $s(y,h,p,w){y.emplaceBack(h,p,w)}class ml{constructor(h){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,$s(this.vertexArray,-1,-1,1),$s(this.vertexArray,1,-1,1),$s(this.vertexArray,-1,1,1),$s(this.vertexArray,1,1,1),$s(this.vertexArray,-1,-1,-1),$s(this.vertexArray,1,-1,-1),$s(this.vertexArray,-1,1,-1),$s(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=h.createVertexBuffer(this.vertexArray,As),this.indexBuffer=h.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function gl(y,h,p,w,E,I){const B=y.gl,U=h.paint.get("sky-atmosphere-color"),H=h.paint.get("sky-atmosphere-halo-color"),J=h.paint.get("sky-atmosphere-sun-intensity"),Y=((oe,me,be,we,Me)=>({u_matrix_3f:oe,u_sun_direction:me,u_sun_intensity:be,u_color_tint_r:[we.r,we.g,we.b,we.a],u_color_tint_m:[Me.r,Me.g,Me.b,Me.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),w),E,J,U,H);B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_CUBE_MAP_POSITIVE_X+I,h.skyboxTexture,0),p.draw(y,B.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,Y,"skyboxCapture",h.skyboxGeometry.vertexBuffer,h.skyboxGeometry.indexBuffer,h.skyboxGeometry.segment)}const ma=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class oi{constructor(h){const p=new s.StructArrayLayout5f20;p.emplaceBack(-1,1,1,0,0),p.emplaceBack(1,1,1,1,0),p.emplaceBack(1,-1,1,1,1),p.emplaceBack(-1,-1,1,0,1);const w=new s.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,3,0),this.vertexBuffer=h.createVertexBuffer(p,ma.members),this.indexBuffer=h.createIndexBuffer(w),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ga={symbol:function(y,h,p,w,E){if(y.renderPass!=="translucent")return;const I=s.StencilMode.disabled,B=y.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(U,H,J,Y,oe,me,be){const we=H.transform,Me=oe==="map",_e=me==="map";for(const xe of U){const ke=Y.getTile(xe),Ce=ke.getBucket(J);if(!Ce||!Ce.text||!Ce.text.segments.get().length)continue;const Ue=s.evaluateSizeForZoom(Ce.textSizeData,we.zoom),Ze=jl(xe,Ce.getProjection(),we),qe=we.calculatePixelsToTileUnitsMatrix(ke),tt=ci(Ze,ke.tileID.canonical,_e,Me,we,Ce.getProjection(),qe),ft=J.layout.get("icon-text-fit")!=="none"&&Ce.hasIconData();if(Ue){const lt=Math.pow(2,we.zoom-ke.tileID.overscaledZ);jc(Ce,Me,_e,be,s.symbolSize,we,tt,xe,lt,Ue,ft)}}}(w,y,p,h,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),E),p.paint.get("icon-opacity").constantOr(1)!==0&&pl(y,h,p,w,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),I,B),p.paint.get("text-opacity").constantOr(1)!==0&&pl(y,h,p,w,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),I,B),h.map.showCollisionBoxes&&(Hc(y,h,p,w,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),Hc(y,h,p,w,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(y,h,p,w){if(y.renderPass!=="translucent")return;const E=p.paint.get("circle-opacity"),I=p.paint.get("circle-stroke-width"),B=p.paint.get("circle-stroke-opacity"),U=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)===0&&(I.constantOr(1)===0||B.constantOr(1)===0))return;const H=y.context,J=H.gl,Y=y.transform,oe=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),me=s.StencilMode.disabled,be=y.colorModeForRenderPass(),we=Y.projection.name==="globe",Me=[s.mercatorXfromLng(Y.center.lng),s.mercatorYfromLat(Y.center.lat)],_e=[];for(let ke=0;ke<w.length;ke++){const Ce=w[ke],Ue=h.getTile(Ce),Ze=Ue.getBucket(p);if(!Ze||Ze.projection.name!==Y.projection.name)continue;const qe=Ze.programConfigurations.get(p.id),tt=Mr(p);we&&tt.push("PROJECTION_GLOBE_VIEW");const ft=y.useProgram("circle",qe,tt),lt=Ze.layoutVertexBuffer,it=Ze.globeExtVertexBuffer,Gt=Ze.indexBuffer,ot=Y.projection.createInversionMatrix(Y,Ce.canonical),bt={programConfiguration:qe,program:ft,layoutVertexBuffer:lt,globeExtVertexBuffer:it,indexBuffer:Gt,uniformValues:mo(y,Ce,Ue,ot,Me,p),tile:Ue};if(U){const mt=Ze.segments.get();for(const Ut of mt)_e.push({segments:new s.SegmentVector([Ut]),sortKey:Ut.sortKey,state:bt})}else _e.push({segments:Ze.segments,sortKey:0,state:bt})}U&&_e.sort((ke,Ce)=>ke.sortKey-Ce.sortKey);const xe={useDepthForOcclusion:!we};for(const ke of _e){const{programConfiguration:Ce,program:Ue,layoutVertexBuffer:Ze,globeExtVertexBuffer:qe,indexBuffer:tt,uniformValues:ft,tile:lt}=ke.state,it=ke.segments;y.terrain&&y.terrain.setupElevationDraw(lt,Ue,xe),y.prepareDrawProgram(H,Ue,lt.tileID.toUnwrapped()),Ue.draw(H,J.TRIANGLES,oe,me,be,s.CullFaceMode.disabled,ft,p.id,Ze,tt,it,p.paint,Y.zoom,Ce,[qe])}},heatmap:function(y,h,p,w){if(p.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const E=y.context,I=E.gl,B=s.StencilMode.disabled,U=new s.ColorMode([I.ONE,I.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(be,we,Me,_e){const xe=be.gl,ke=we.width*_e,Ce=we.height*_e;be.activeTexture.set(xe.TEXTURE1),be.viewport.set([0,0,ke,Ce]);let Ue=Me.heatmapFbo;if(!Ue||Ue&&(Ue.width!==ke||Ue.height!==Ce)){Ue&&Ue.destroy();const Ze=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,Ze),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),Ue=Me.heatmapFbo=be.createFramebuffer(ke,Ce,!1),function(qe,tt,ft,lt,it,Gt){const ot=qe.gl;ot.texImage2D(ot.TEXTURE_2D,0,ot.RGBA,it,Gt,0,ot.RGBA,qe.extRenderToTextureHalfFloat?qe.extTextureHalfFloat.HALF_FLOAT_OES:ot.UNSIGNED_BYTE,null),lt.colorAttachment.set(ft)}(be,0,Ze,Ue,ke,Ce)}else xe.bindTexture(xe.TEXTURE_2D,Ue.colorAttachment.get()),be.bindFramebuffer.set(Ue.framebuffer)})(E,y,p,y.transform.projection.name==="globe"?.5:.25),E.clear({color:s.Color.transparent});const H=y.transform,J=H.projection.name==="globe",Y=J?["PROJECTION_GLOBE_VIEW"]:null,oe=J?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,me=[s.mercatorXfromLng(H.center.lng),s.mercatorYfromLat(H.center.lat)];for(let be=0;be<w.length;be++){const we=w[be];if(h.hasRenderableParent(we))continue;const Me=h.getTile(we),_e=Me.getBucket(p);if(!_e||_e.projection.name!==H.projection.name)continue;const xe=_e.programConfigurations.get(p.id),ke=y.useProgram("heatmap",xe,Y),{zoom:Ce}=y.transform;y.terrain&&y.terrain.setupElevationDraw(Me,ke),y.prepareDrawProgram(E,ke,we.toUnwrapped());const Ue=H.projection.createInversionMatrix(H,we.canonical);ke.draw(E,I.TRIANGLES,s.DepthMode.disabled,B,U,oe,Bh(y,we,Me,Ue,me,Ce,p.paint.get("heatmap-intensity")),p.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,p.paint,y.transform.zoom,xe,J?[_e.globeExtVertexBuffer]:null)}E.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(E,I){const B=E.context,U=B.gl,H=I.heatmapFbo;if(!H)return;B.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,H.colorAttachment.get()),B.activeTexture.set(U.TEXTURE1);let J=I.colorRampTexture;J||(J=I.colorRampTexture=new s.Texture(B,I.colorRamp,U.RGBA)),J.bind(U.LINEAR,U.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(B,U.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,E.colorModeForRenderPass(),s.CullFaceMode.disabled,((Y,oe,me,be)=>({u_image:0,u_color_ramp:1,u_opacity:oe.paint.get("heatmap-opacity")}))(0,I),I.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,I.paint,E.transform.zoom)}(y,p))},line:function(y,h,p,w){if(y.renderPass!=="translucent")return;const E=p.paint.get("line-opacity"),I=p.paint.get("line-width");if(E.constantOr(1)===0||I.constantOr(1)===0)return;const B=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),U=y.colorModeForRenderPass(),H=y.terrain&&y.terrain.renderingToTexture?1:s.exported.devicePixelRatio,J=p.paint.get("line-dasharray"),Y=J.constantOr(1),oe=p.layout.get("line-cap"),me=p.paint.get("line-pattern"),be=me.constantOr(1),we=p.paint.get("line-gradient"),Me=be?"linePattern":"line",_e=y.context,xe=_e.gl,ke=(Ue=>{const Ze=[];dl(Ue)&&Ze.push("RENDER_LINE_DASH"),Ue.paint.get("line-gradient")&&Ze.push("RENDER_LINE_GRADIENT");const qe=Ue.paint.get("line-trim-offset");qe[0]===0&&qe[1]===0||Ze.push("RENDER_LINE_TRIM_OFFSET");const tt=Ue.paint.get("line-pattern").constantOr(1),ft=Ue.paint.get("line-opacity").constantOr(1)!==1;return!tt&&ft&&Ze.push("RENDER_LINE_ALPHA_DISCARD"),Ze})(p);let Ce=ke.includes("RENDER_LINE_ALPHA_DISCARD");y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(Ce=!1);for(const Ue of w){const Ze=h.getTile(Ue);if(be&&!Ze.patternsLoaded())continue;const qe=Ze.getBucket(p);if(!qe)continue;y.prepareDrawTile();const tt=qe.programConfigurations.get(p.id),ft=y.useProgram(Me,tt,ke),lt=me.constantOr(null);if(lt&&Ze.imageAtlas){const kt=Ze.imageAtlas.patternPositions[lt.toString()];kt&&tt.setConstantPatternPositions(kt)}const it=J.constantOr(null),Gt=oe.constantOr(null);if(!be&&it&&Gt&&Ze.lineAtlas){const kt=Ze.lineAtlas.getDash(it,Gt);kt&&tt.setConstantPatternPositions(kt)}let[ot,bt]=p.paint.get("line-trim-offset");(Gt==="round"||Gt==="square")&&ot!==bt&&(ot===0&&(ot-=1),bt===1&&(bt+=1));const mt=y.terrain?Ue.projMatrix:null,Ut=be?Go(y,Ze,p,mt,H):Nh(y,Ze,p,mt,qe.lineClipsArray.length,H,[ot,bt]);if(we){const kt=qe.gradients[p.id];let Dt=kt.texture;if(p.gradientVersion!==kt.version){let Ye=256;if(p.stepInterpolant){const at=h.getSource().maxzoom,Qt=Ue.canonical.z===at?Math.ceil(1<<y.transform.maxZoom-Ue.canonical.z):1;Ye=s.clamp(s.nextPowerOfTwo(qe.maxLineLength/s.EXTENT*1024*Qt),256,_e.maxTextureSize)}kt.gradient=s.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:Ye,image:kt.gradient||void 0,clips:qe.lineClipsArray}),kt.texture?kt.texture.update(kt.gradient):kt.texture=new s.Texture(_e,kt.gradient,xe.RGBA),kt.version=p.gradientVersion,Dt=kt.texture}_e.activeTexture.set(xe.TEXTURE1),Dt.bind(p.stepInterpolant?xe.NEAREST:xe.LINEAR,xe.CLAMP_TO_EDGE)}Y&&(_e.activeTexture.set(xe.TEXTURE0),Ze.lineAtlasTexture.bind(xe.LINEAR,xe.REPEAT),tt.updatePaintBuffers()),be&&(_e.activeTexture.set(xe.TEXTURE0),Ze.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),tt.updatePaintBuffers()),y.prepareDrawProgram(_e,ft,Ue.toUnwrapped());const gt=kt=>{ft.draw(_e,xe.TRIANGLES,B,kt,U,s.CullFaceMode.disabled,Ut,p.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,p.paint,y.transform.zoom,tt,[qe.layoutVertexBuffer2])};if(Ce){const kt=y.stencilModeForClipping(Ue).ref;kt===0&&y.terrain&&_e.clear({stencil:0});const Dt={func:xe.EQUAL,mask:255};Ut.u_alpha_discard_threshold=.8,gt(new s.StencilMode(Dt,kt,255,xe.KEEP,xe.KEEP,xe.INVERT)),Ut.u_alpha_discard_threshold=0,gt(new s.StencilMode(Dt,kt,255,xe.KEEP,xe.KEEP,xe.KEEP))}else gt(y.stencilModeForClipping(Ue))}Ce&&(y.resetStencilClippingMasks(),y.terrain&&_e.clear({stencil:0}))},fill:function(y,h,p,w){const E=p.paint.get("fill-color"),I=p.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const B=y.colorModeForRenderPass(),U=p.paint.get("fill-pattern"),H=y.opaquePassEnabledForLayer()&&!U.constantOr(1)&&E.constantOr(s.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===H){const J=y.depthModeForSublayer(1,y.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);Wh(y,h,p,w,J,B,!1)}if(y.renderPass==="translucent"&&p.paint.get("fill-antialias")){const J=y.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);Wh(y,h,p,w,J,B,!0)}},"fill-extrusion":function(y,h,p,w){const E=p.paint.get("fill-extrusion-opacity");if(E!==0&&y.renderPass==="translucent"){const I=new s.DepthMode(y.context.gl.LEQUAL,s.DepthMode.ReadWrite,y.depthRangeFor3D);if(E!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))Hh(y,h,p,w,I,s.StencilMode.disabled,s.ColorMode.disabled),Hh(y,h,p,w,I,y.stencilModeFor3D(),y.colorModeForRenderPass()),y.resetStencilClippingMasks();else{const B=y.colorModeForRenderPass();Hh(y,h,p,w,I,s.StencilMode.disabled,B)}}},hillshade:function(y,h,p,w){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const E=y.context,I=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),B=y.colorModeForRenderPass(),U=y.terrain&&y.terrain.renderingToTexture,[H,J]=y.renderPass!=="translucent"||U?[{},w]:y.stencilConfigForOverlap(w);for(const Y of J){const oe=h.getTile(Y);if(oe.needsHillshadePrepare&&y.renderPass==="offscreen")kh(y,oe,p,I,s.StencilMode.disabled,B);else if(y.renderPass==="translucent"){const me=U&&y.terrain?y.terrain.stencilModeForRTTOverlap(Y):H[Y.overscaledZ];La(y,Y,oe,p,I,me,B)}}E.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,h,p,w,E,I){if(y.renderPass!=="translucent"||p.paint.get("raster-opacity")===0||!w.length)return;const B=y.context,U=B.gl,H=h.getSource(),J=y.useProgram("raster"),Y=y.colorModeForRenderPass(),oe=y.terrain&&y.terrain.renderingToTexture,[me,be]=H instanceof pe||oe?[{},w]:y.stencilConfigForOverlap(w),we=be[be.length-1].overscaledZ,Me=!y.options.moving;for(const _e of be){const xe=oe?s.DepthMode.disabled:y.depthModeForSublayer(_e.overscaledZ-we,p.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,U.LESS),ke=_e.toUnwrapped(),Ce=h.getTile(_e);if(oe&&(!Ce||!Ce.hasData()))continue;const Ue=oe?_e.projMatrix:y.transform.calculateProjMatrix(ke,Me),Ze=y.terrain&&oe?y.terrain.stencilModeForRTTOverlap(_e):me[_e.overscaledZ],qe=I?0:p.paint.get("raster-fade-duration");Ce.registerFadeDuration(qe);const tt=h.findLoadedParent(_e,0),ft=Nu(Ce,tt,h,y.transform,qe);let lt,it;y.terrain&&y.terrain.prepareDrawTile();const Gt=p.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR;B.activeTexture.set(U.TEXTURE0),Ce.texture.bind(Gt,U.CLAMP_TO_EDGE),B.activeTexture.set(U.TEXTURE1),tt?(tt.texture.bind(Gt,U.CLAMP_TO_EDGE),lt=Math.pow(2,tt.tileID.overscaledZ-Ce.tileID.overscaledZ),it=[Ce.tileID.canonical.x*lt%1,Ce.tileID.canonical.y*lt%1]):Ce.texture.bind(Gt,U.CLAMP_TO_EDGE);const ot=Kd(Ue,it||[0,0],lt||1,ft,p,H instanceof pe?H.perspectiveTransform:[0,0]);if(y.prepareDrawProgram(B,J,ke),H instanceof pe)H.boundsBuffer&&H.boundsSegments&&J.draw(B,U.TRIANGLES,xe,s.StencilMode.disabled,Y,s.CullFaceMode.disabled,ot,p.id,H.boundsBuffer,y.quadTriangleIndexBuffer,H.boundsSegments);else{const{tileBoundsBuffer:bt,tileBoundsIndexBuffer:mt,tileBoundsSegments:Ut}=y.getTileBoundsBuffers(Ce);J.draw(B,U.TRIANGLES,xe,Ze,Y,s.CullFaceMode.disabled,ot,p.id,bt,mt,Ut)}}y.resetStencilClippingMasks()},background:function(y,h,p,w){const E=p.paint.get("background-color"),I=p.paint.get("background-opacity");if(I===0)return;const B=y.context,U=B.gl,H=y.transform,J=H.tileSize,Y=p.paint.get("background-pattern");if(y.isPatternMissing(Y))return;const oe=!Y&&E.a===1&&I===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==oe)return;const me=s.StencilMode.disabled,be=y.depthModeForSublayer(0,oe==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),we=y.colorModeForRenderPass(),Me=y.useProgram(Y?"backgroundPattern":"background");let _e,xe=w;xe||(_e=y.getBackgroundTiles(),xe=Object.values(_e).map(ke=>ke.tileID)),Y&&(B.activeTexture.set(U.TEXTURE0),y.imageManager.bind(y.context));for(const ke of xe){const Ce=ke.toUnwrapped(),Ue=w?ke.projMatrix:y.transform.calculateProjMatrix(Ce);y.prepareDrawTile();const Ze=h?h.getTile(ke):_e?_e[ke.key]:new s.Tile(ke,J,H.zoom,y),qe=Y?Wc(Ue,I,y,Y,{tileID:ke,tileSize:J}):Cg(Ue,I,E);y.prepareDrawProgram(B,Me,Ce);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:ft,tileBoundsSegments:lt}=y.getTileBoundsBuffers(Ze);Me.draw(B,U.TRIANGLES,be,me,we,s.CullFaceMode.disabled,qe,p.id,tt,ft,lt)}},sky:function(y,h,p){const w=y.transform,E=w.projection.name==="mercator"||w.projection.name==="globe"?1:s.smoothstep(7,8,w.zoom),I=p.paint.get("sky-opacity")*E;if(I===0)return;const B=y.context,U=p.paint.get("sky-type"),H=new s.DepthMode(B.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),J=y.frameCounter/1e3%1;U==="atmosphere"?y.renderPass==="offscreen"?p.needsSkyboxCapture(y)&&(function(Y,oe,me,be){const we=Y.context,Me=we.gl;let _e=oe.skyboxFbo;if(!_e){_e=oe.skyboxFbo=we.createFramebuffer(32,32,!1),oe.skyboxGeometry=new ml(we),oe.skyboxTexture=we.gl.createTexture(),Me.bindTexture(Me.TEXTURE_CUBE_MAP,oe.skyboxTexture),Me.texParameteri(Me.TEXTURE_CUBE_MAP,Me.TEXTURE_WRAP_S,Me.CLAMP_TO_EDGE),Me.texParameteri(Me.TEXTURE_CUBE_MAP,Me.TEXTURE_WRAP_T,Me.CLAMP_TO_EDGE),Me.texParameteri(Me.TEXTURE_CUBE_MAP,Me.TEXTURE_MIN_FILTER,Me.LINEAR),Me.texParameteri(Me.TEXTURE_CUBE_MAP,Me.TEXTURE_MAG_FILTER,Me.LINEAR);for(let Ue=0;Ue<6;++Ue)Me.texImage2D(Me.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,0,Me.RGBA,32,32,0,Me.RGBA,Me.UNSIGNED_BYTE,null)}we.bindFramebuffer.set(_e.framebuffer),we.viewport.set([0,0,32,32]);const xe=oe.getCenter(Y,!0),ke=Y.useProgram("skyboxCapture"),Ce=new Float64Array(16);s.identity(Ce),s.rotateY(Ce,Ce,.5*-Math.PI),gl(we,oe,ke,Ce,xe,0),s.identity(Ce),s.rotateY(Ce,Ce,.5*Math.PI),gl(we,oe,ke,Ce,xe,1),s.identity(Ce),s.rotateX(Ce,Ce,.5*-Math.PI),gl(we,oe,ke,Ce,xe,2),s.identity(Ce),s.rotateX(Ce,Ce,.5*Math.PI),gl(we,oe,ke,Ce,xe,3),s.identity(Ce),gl(we,oe,ke,Ce,xe,4),s.identity(Ce),s.rotateY(Ce,Ce,Math.PI),gl(we,oe,ke,Ce,xe,5),we.viewport.set([0,0,Y.width,Y.height])}(y,p),p.markSkyboxValid(y)):y.renderPass==="sky"&&function(Y,oe,me,be,we){const Me=Y.context,_e=Me.gl,xe=Y.transform,ke=Y.useProgram("skybox");Me.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_CUBE_MAP,oe.skyboxTexture);const Ce=((Ue,Ze,qe,tt,ft)=>({u_matrix:Ue,u_sun_direction:Ze,u_cubemap:0,u_opacity:tt,u_temporal_offset:ft}))(xe.skyboxMatrix,oe.getCenter(Y,!1),0,be,we);Y.prepareDrawProgram(Me,ke),ke.draw(Me,_e.TRIANGLES,me,s.StencilMode.disabled,Y.colorModeForRenderPass(),s.CullFaceMode.backCW,Ce,"skybox",oe.skyboxGeometry.vertexBuffer,oe.skyboxGeometry.indexBuffer,oe.skyboxGeometry.segment)}(y,p,H,I,J):U==="gradient"&&y.renderPass==="sky"&&function(Y,oe,me,be,we){const Me=Y.context,_e=Me.gl,xe=Y.transform,ke=Y.useProgram("skyboxGradient");oe.skyboxGeometry||(oe.skyboxGeometry=new ml(Me)),Me.activeTexture.set(_e.TEXTURE0);let Ce=oe.colorRampTexture;Ce||(Ce=oe.colorRampTexture=new s.Texture(Me,oe.colorRamp,_e.RGBA)),Ce.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const Ue=((Ze,qe,tt,ft,lt)=>({u_matrix:Ze,u_color_ramp:0,u_center_direction:qe,u_radius:s.degToRad(tt),u_opacity:ft,u_temporal_offset:lt}))(xe.skyboxMatrix,oe.getCenter(Y,!1),oe.paint.get("sky-gradient-radius"),be,we);Y.prepareDrawProgram(Me,ke),ke.draw(Me,_e.TRIANGLES,me,s.StencilMode.disabled,Y.colorModeForRenderPass(),s.CullFaceMode.backCW,Ue,"skyboxGradient",oe.skyboxGeometry.vertexBuffer,oe.skyboxGeometry.indexBuffer,oe.skyboxGeometry.segment)}(y,p,H,I,J)},debug:function(y,h,p){for(let w=0;w<p.length;w++)es(y,h,p[w])},custom:function(y,h,p){const w=y.context,E=p.implementation;if(y.transform.projection.unsupportedLayers&&y.transform.projection.unsupportedLayers.includes("custom"))s.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(y.renderPass==="offscreen"){const I=E.prerender;I&&(y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),I.call(E,w.gl,y.transform.customLayerMatrix()),w.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),w.setStencilMode(s.StencilMode.disabled);const I=E.renderingMode==="3d"?new s.DepthMode(y.context.gl.LEQUAL,s.DepthMode.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,s.DepthMode.ReadOnly);w.setDepthMode(I),E.render(w.gl,y.transform.customLayerMatrix()),w.setDirty(),y.setBaseState(),w.bindFramebuffer.set(null)}}};class ef{constructor(h,p){this.context=new se(h),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new al,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(h,p){const w=!!h&&!!h.terrain&&this.transform.projection.supportsTerrain;if(!(w||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Rh(this,h));const E=this._terrain;this.transform.elevation=w?E:null,E.update(h,this.transform,p)}_updateFog(h){const p=h.fog;if(!p||this.transform.projection.name==="globe"||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[w,E]=p.getFovAdjustedRange(this.transform._fov);if(w>E)return void(this.transform.fogCullDistSq=null);const I=w+.78*(E-w);this.transform.fogCullDistSq=I*I}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(h,p){if(this.width=h*s.exported.devicePixelRatio,this.height=p*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style.order)this.style._layers[w].resize()}setup(){const h=this.context,p=new s.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(s.EXTENT,0),p.emplaceBack(0,s.EXTENT),p.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(p,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const w=new s.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(s.EXTENT,0),w.emplaceBack(0,s.EXTENT),w.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=h.createVertexBuffer(w,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const E=new s.StructArrayLayout2i4;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(E,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const I=new s.StructArrayLayout4i8;I.emplaceBack(0,0,0,0),I.emplaceBack(s.EXTENT,0,s.EXTENT,0),I.emplaceBack(0,s.EXTENT,0,s.EXTENT),I.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=h.createVertexBuffer(I,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const B=new s.StructArrayLayout3ui6;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(B);const U=new s.StructArrayLayout1ui2;for(const J of[0,1,3,2,0])U.emplaceBack(J);this.debugIndexBuffer=h.createIndexBuffer(U),this.emptyTexture=new s.Texture(h,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),h.gl.RGBA),this.identityMat=s.create();const H=this.context.gl;this.stencilClearMode=new s.StencilMode({func:H.ALWAYS,mask:0},0,255,H.ZERO,H.ZERO,H.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new oi(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(h){return h._makeTileBoundsBuffers(this.context,this.transform.projection),h._tileBoundsBuffer?{tileBoundsBuffer:h._tileBoundsBuffer,tileBoundsIndexBuffer:h._tileBoundsIndexBuffer,tileBoundsSegments:h._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const h=this.context,p=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(h,p.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,Bu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(h,p,w){if(!p||this.currentStencilSource===p.id||!h.isTileClipped()||!w||w.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let U=!1;for(const H of w)if(this._tileClippingMaskIDs[H.key]===void 0){U=!0;break}if(!U)return}this.currentStencilSource=p.id;const E=this.context,I=E.gl;this.nextStencilID+w.length>256&&this.clearStencil(),E.setColorMode(s.ColorMode.disabled),E.setDepthMode(s.DepthMode.disabled);const B=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const U of w){const H=p.getTile(U),J=this._tileClippingMaskIDs[U.key]=this.nextStencilID++,{tileBoundsBuffer:Y,tileBoundsIndexBuffer:oe,tileBoundsSegments:me}=this.getTileBoundsBuffers(H);B.draw(E,I.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:I.ALWAYS,mask:0},J,255,I.KEEP,I.KEEP,I.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Bu(U.projMatrix),"$clipping",Y,oe,me)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const h=this.nextStencilID++,p=this.context.gl;return new s.StencilMode({func:p.NOTEQUAL,mask:255},h,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(h){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(h);const p=this.context.gl;return new s.StencilMode({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(h){const p=this.context.gl,w=h.sort((B,U)=>U.overscaledZ-B.overscaledZ),E=w[w.length-1].overscaledZ,I=w[0].overscaledZ-E+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();const B={};for(let U=0;U<I;U++)B[U+E]=new s.StencilMode({func:p.GEQUAL,mask:255},U+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=I,[B,w]}return[{[E]:s.StencilMode.disabled},w]}colorModeForRenderPass(){const h=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([h.CONSTANT_COLOR,h.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(h,p,w){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new s.DepthMode(w||this.context.gl.LEQUAL,p,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(h,p){this.style=h,this.options=p,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const w=this.style.order,E=this.style._sourceCaches;for(const H in E){const J=E[H];J.used&&J.prepare(this.context)}const I={},B={},U={};for(const H in E){const J=E[H];I[H]=J.getVisibleCoordinates(),B[H]=I[H].slice().reverse(),U[H]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<w.length;H++)if(this.style._layers[w[H]].is3D()){this.opaquePassCutoff=H;break}if(this.terrain&&(this.terrain.updateTileBinding(U),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const H of w){const J=this.style._layers[H],Y=h._getLayerSourceCache(J);if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const oe=Y?B[Y.id]:void 0;(J.type==="custom"||J.isSky()||oe&&oe.length)&&this.renderLayer(this,Y,J,oe)}if(this.depthRangeFor3D=[0,1-(h.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:p.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[w[this.currentLayer]],J=h._getLayerSourceCache(H);if(H.isSky())continue;const Y=J?B[J.id]:void 0;this._renderTileClippingMasks(H,J,Y),this.renderLayer(this,J,H,Y)}if(this.style.fog&&this.transform.projection.supportsFog&&function(H,J){const Y=H.context,oe=Y.gl,me=H.transform,be=new s.DepthMode(oe.LEQUAL,s.DepthMode.ReadOnly,[0,1]),we=H.useProgram("globeAtmosphere",null,me.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Me=s.globeToMercatorTransition(me.zoom),_e=J.properties.get("color").toArray01(),xe=J.properties.get("high-color").toArray01(),ke=J.properties.get("space-color").toArray01PremultipliedAlpha(),Ce=s.identity$1([]);s.rotateY$1(Ce,Ce,-s.degToRad(me._center.lng)),s.rotateX$1(Ce,Ce,s.degToRad(me._center.lat)),s.rotateZ$1(Ce,Ce,me.angle),s.rotateX$1(Ce,Ce,-me._pitch);const Ue=s.fromQuat(new Float32Array(16),Ce),Ze=s.mapValue(J.properties.get("star-intensity"),0,1,0,.25),qe=5e-4,tt=s.mapValue(J.properties.get("horizon-blend"),0,1,qe,.25),ft=s.globeUseCustomAntiAliasing(H,Y,me)&&tt===qe?me.worldSize/(2*Math.PI*1.025)-1:me.globeRadius,lt=H.frameCounter/1e3%1,it=s.length(me.globeCenterInViewSpace),Gt=Math.sqrt(Math.pow(it,2)-Math.pow(ft,2)),ot=Math.acos(Gt/it),bt=((Ut,gt,kt,Dt,Ye,at,Qt,mn,cn,Fn,Rn,Cn,an,ki)=>({u_frustum_tl:Ut,u_frustum_tr:gt,u_frustum_br:kt,u_frustum_bl:Dt,u_horizon:Ye,u_transition:at,u_fadeout_range:Qt,u_color:mn,u_high_color:cn,u_space_color:Fn,u_star_intensity:Rn,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Cn,u_horizon_angle:an,u_rotation_matrix:ki}))(me.frustumCorners.TL,me.frustumCorners.TR,me.frustumCorners.BR,me.frustumCorners.BL,me.frustumCorners.horizon,Me,tt,_e,xe,ke,Ze,lt,ot,Ue);H.prepareDrawProgram(Y,we);const mt=H.atmosphereBuffer;mt&&we.draw(Y,oe.TRIANGLES,be,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,bt,"skybox",mt.vertexBuffer,mt.indexBuffer,mt.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const H=this.style._layers[w[this.currentLayer]],J=h._getLayerSourceCache(H);H.isSky()&&this.renderLayer(this,J,H,J?B[J.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<w.length;){const H=this.style._layers[w[this.currentLayer]],J=h._getLayerSourceCache(H);if(H.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(H)){if(H.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Y=J?(H.type==="symbol"?U:B)[J.id]:void 0;this._renderTileClippingMasks(H,J,J?I[J.id]:void 0),this.renderLayer(this,J,H,Y),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let H=null;s.values(this.style._layers).forEach(J=>{const Y=h._getLayerSourceCache(J);Y&&!J.isHidden(this.transform.zoom)&&(!H||H.getSource().maxzoom<Y.getSource().maxzoom)&&(H=Y)}),H&&this.options.showTileBoundaries&&ga.debug(this,H,H.getVisibleCoordinates())}this.options.showPadding&&function(H){const J=H.transform.padding;Vu(H,H.transform.height-(J.top||0),3,Qd),Vu(H,J.bottom||0,3,Ho),Kl(H,J.left||0,3,Jl),Kl(H,H.transform.width-(J.right||0),3,Er);const Y=H.transform.centerPoint;(function(oe,me,be,we){_o(oe,me-1,be-10,2,20,we),_o(oe,me-10,be-1,20,2,we)})(H,Y.x,H.transform.height-Y.y,Es)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(h,p,w,E){w.isHidden(this.transform.zoom)||(w.type==="background"||w.type==="sky"||w.type==="custom"||E&&E.length)&&(this.id=w.id,this.gpuTimingStart(w),h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes(w.type)||ga[w.type](h,p,w,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(h){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery;let w=this.gpuTimers[h.id];w||(w=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:p.createQueryEXT()}),w.calls++,p.beginQueryEXT(p.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const h=this.context.extTimerQuery,p=h.createQueryEXT();this.deferredRenderGpuTimeQueries.push(p),h.beginQueryEXT(h.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}collectGpuTimers(){const h=this.gpuTimers;return this.gpuTimers={},h}collectDeferredRenderGpuQueries(){const h=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],h}queryGpuTimers(h){const p={};for(const w in h){const E=h[w],I=this.context.extTimerQuery,B=I.getQueryObjectEXT(E.query,I.QUERY_RESULT_EXT)/1e6;I.deleteQueryEXT(E.query),p[w]=B}return p}queryGpuTimeDeferredRender(h){if(!this.options.gpuTimingDeferredRender)return 0;const p=this.context.extTimerQuery;let w=0;for(const E of h)w+=p.getQueryObjectEXT(E,p.QUERY_RESULT_EXT)/1e6,p.deleteQueryEXT(E);return w}translatePosMatrix(h,p,w,E,I){if(!w[0]&&!w[1])return h;const B=I?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(B){const J=Math.sin(B),Y=Math.cos(B);w=[w[0]*Y-w[1]*J,w[0]*J+w[1]*Y]}const U=[I?w[0]:ze(p,w[0],this.transform.zoom),I?w[1]:ze(p,w[1],this.transform.zoom),0],H=new Float32Array(16);return s.translate(H,h,U),H}saveTileTexture(h){const p=this._tileTextures[h.size[0]];p?p.push(h):this._tileTextures[h.size[0]]=[h]}getTileTexture(h){const p=this._tileTextures[h];return p&&p.length>0?p.pop():null}isPatternMissing(h){return h===null||h!==void 0&&!this.imageManager.getPattern(h.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const h=this.terrain&&this.terrain.renderingToTexture,p=this.terrain&&this.terrain.exaggeration()===0,w=this.style&&this.style.fog,E=[];return this.terrainRenderModeElevated()&&E.push("TERRAIN"),this.transform.projection.name==="globe"&&E.push("GLOBE"),p&&E.push("ZERO_EXAGGERATION"),w&&!h&&w.getOpacity(this.transform.pitch)!==0&&E.push("FOG"),h&&E.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&E.push("OVERDRAW_INSPECTOR"),E}useProgram(h,p,w){this.cache=this.cache||{};const E=w||[],I=this.currentGlobalDefines().concat(E),B=fo.cacheKey(Vo[h],h,I,p);return this.cache[B]||(this.cache[B]=new fo(this.context,h,Vo[h],p,Wo[h],I)),this.cache[B]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(h,p,w){if(this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const I=E.getOpacity(this.transform.pitch),B=((U,H,J,Y,oe,me,be,we,Me,_e,xe)=>{const ke=U.transform,Ce=H.properties.get("color").toArray01();Ce[3]=Y;const Ue=U.frameCounter/1e3%1;return{u_fog_matrix:J?ke.calculateFogTileMatrix(J):U.identityMat,u_fog_range:H.getFovAdjustedRange(ke._fov),u_fog_color:Ce,u_fog_horizon_blend:H.properties.get("horizon-blend"),u_fog_temporal_offset:Ue,u_frustum_tl:oe,u_frustum_tr:me,u_frustum_br:be,u_frustum_bl:we,u_globe_pos:Me,u_globe_radius:_e,u_viewport:xe,u_globe_transition:s.globeToMercatorTransition(ke.zoom),u_is_globe:+(ke.projection.name==="globe")}})(this,E,w,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);p.setFogUniformValues(h,B)}}setTileLoadedFlag(h){this.tileLoaded=h}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const h=this.context.gl,p=h.createTexture();return h.bindTexture(h.TEXTURE_2D,p),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,0,0,h.drawingBufferWidth,h.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const h=this.style&&this.style.fog;return!!h&&h.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const h=this._backgroundTiles,p=this._backgroundTiles={},w=this.transform.coveringTiles({tileSize:512});for(const E of w)p[E.key]=h[E.key]||new s.Tile(E,512,this.transform.tileZoom,this);return p}clearBackgroundTiles(){this._backgroundTiles={}}}class qc{constructor(h=0,p=0,w=0,E=0){if(isNaN(h)||h<0||isNaN(p)||p<0||isNaN(w)||w<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=p,this.left=w,this.right=E}interpolate(h,p,w){return p.top!=null&&h.top!=null&&(this.top=s.number(h.top,p.top,w)),p.bottom!=null&&h.bottom!=null&&(this.bottom=s.number(h.bottom,p.bottom,w)),p.left!=null&&h.left!=null&&(this.left=s.number(h.left,p.left,w)),p.right!=null&&h.right!=null&&(this.right=s.number(h.right,p.right,w)),this}getCenter(h,p){const w=s.clamp((this.left+h-this.right)/2,0,h),E=s.clamp((this.top+p-this.bottom)/2,0,p);return new s.pointGeometry(w,E)}equals(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right}clone(){return new qc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Zc(y,h){const p=s.getColumn(y,3);s.fromQuat(y,h),s.setColumn(y,3,p)}function tf(y,h){const p=s.identity$1([]);return s.rotateZ$1(p,p,-h),s.rotateX$1(p,p,-y),p}function Vp(y,h){const p=[y[0],y[1],0],w=[h[0],h[1],0];if(s.length(p)>=1e-15){const B=s.normalize([],p);s.scale$2(w,B,s.dot(w,B)),h[0]=w[0],h[1]=w[1]}const E=s.cross([],h,y);if(s.len(E)<1e-15)return null;const I=Math.atan2(-E[1],E[0]);return tf(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),I)}class nf{constructor(h,p){this.position=h,this.orientation=p}get position(){return this._position}set position(h){if(h){const p=h instanceof s.MercatorCoordinate?h:new s.MercatorCoordinate(h[0],h[1],h[2]);this._renderWorldCopies&&(p.x=s.wrap(p.x,0,1)),this._position=p}else this._position=null}lookAtPoint(h,p){if(this.orientation=null,!this.position)return;const w=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(h)):0,E=this.position,I=s.MercatorCoordinate.fromLngLat(h,w),B=[I.x-E.x,I.y-E.y,I.z-E.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=Vp(B,p)}setPitchBearing(h,p){this.orientation=tf(s.degToRad(h),s.degToRad(-p))}}class rf{constructor(h,p){this._transform=s.identity([]),this.orientation=p,this.position=h}get mercatorPosition(){const h=this.position;return new s.MercatorCoordinate(h[0],h[1],h[2])}get position(){const h=s.getColumn(this._transform,3);return[h[0],h[1],h[2]]}set position(h){var p;h&&s.setColumn(this._transform,3,[(p=h)[0],p[1],p[2],1])}get orientation(){return this._orientation}set orientation(h){this._orientation=h||s.identity$1([]),h&&Zc(this._transform,this._orientation)}getPitchBearing(){const h=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2])}}setPitchBearing(h,p){this._orientation=tf(h,p),Zc(this._transform,this._orientation)}forward(){const h=s.getColumn(this._transform,2);return[-h[0],-h[1],-h[2]]}up(){const h=s.getColumn(this._transform,1);return[-h[0],-h[1],-h[2]]}right(){const h=s.getColumn(this._transform,0);return[h[0],h[1],h[2]]}getCameraToWorld(h,p){const w=new Float64Array(16);return s.invert(w,this.getWorldToCamera(h,p)),w}getWorldToCameraPosition(h,p,w){const E=this.position;s.scale$2(E,E,-h);const I=new Float64Array(16);return s.fromScaling(I,[w,w,w]),s.translate(I,I,E),I[10]*=p,I}getWorldToCamera(h,p){const w=new Float64Array(16),E=new Float64Array(4),I=this.position;return s.conjugate(E,this._orientation),s.scale$2(I,I,-h),s.fromQuat(w,E),s.translate(w,w,I),w[1]*=-1,w[5]*=-1,w[9]*=-1,w[13]*=-1,w[8]*=p,w[9]*=p,w[10]*=p,w[11]*=p,w}getCameraToClipPerspective(h,p,w,E){const I=new Float64Array(16);return s.perspective(I,h,p,w,E),I}getDistanceToElevation(h,p=!1){const w=h===0?0:s.mercatorZfromAltitude(h,p?s.latFromMercatorY(this.position[1]):this.position[1]),E=this.forward();return(w-this.position[2])/E[2]}clone(){return new rf([...this.position],[...this.orientation])}}function qh(y,h){const p=jo(y.projection,y.zoom,y.width,y.height),w=function(I,B,U,H,J){const Y=new s.LngLat(U.lng-180*_l,U.lat),oe=new s.LngLat(U.lng+180*_l,U.lat),me=I.project(Y.lng,Y.lat),be=I.project(oe.lng,oe.lat),we=-Math.atan2(be.y-me.y,be.x-me.x),Me=s.MercatorCoordinate.fromLngLat(U);Me.y=s.clamp(Me.y,-.999975,.999975);const _e=Me.toLngLat(),xe=I.project(_e.lng,_e.lat),ke=s.MercatorCoordinate.fromLngLat(_e);ke.x+=_l;const Ce=ke.toLngLat(),Ue=I.project(Ce.lng,Ce.lat),Ze=Gu(Ue.x-xe.x,Ue.y-xe.y,we),qe=s.MercatorCoordinate.fromLngLat(_e);qe.y+=_l;const tt=qe.toLngLat(),ft=I.project(tt.lng,tt.lat),lt=Gu(ft.x-xe.x,ft.y-xe.y,we),it=Math.abs(Ze.x)/Math.abs(lt.y),Gt=s.identity([]);s.rotateZ(Gt,Gt,-we*(1-(J?0:H)));const ot=s.identity([]);return s.scale(ot,ot,[1,1-(1-it)*H,1]),ot[4]=-lt.x/lt.y*H,s.rotateZ(ot,ot,we),s.multiply(ot,Gt,ot),ot}(y.projection,0,y.center,p,h),E=$c(y);return s.scale(w,w,[E,E,1]),w}function $c(y){const h=y.projection,p=jo(y.projection,y.zoom,y.width,y.height),w=Xc(h,y.center),E=Xc(h,s.LngLat.convert(h.center));return Math.pow(2,w*p+(1-p)*E)}function jo(y,h,p,w,E=1/0){const I=y.range;if(!I)return 0;const B=Math.min(E,Math.max(p,w)),U=Math.log(B/1024)/Math.LN2;return s.smoothstep(I[0]+U,I[1]+U,h)}const _l=1/4e4;function Xc(y,h){const p=s.clamp(h.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),w=new s.LngLat(h.lng-180*_l,p),E=new s.LngLat(h.lng+180*_l,p),I=y.project(w.lng,p),B=y.project(E.lng,p),U=s.MercatorCoordinate.fromLngLat(w),H=s.MercatorCoordinate.fromLngLat(E),J=B.x-I.x,Y=B.y-I.y,oe=H.x-U.x,me=H.y-U.y,be=Math.sqrt((oe*oe+me*me)/(J*J+Y*Y));return Math.log(be)/Math.LN2}function Gu(y,h,p){const w=Math.cos(p),E=Math.sin(p);return{x:y*w-h*E,y:y*E+h*w}}class Ql{constructor(h,p,w,E,I,B,U){this.tileSize=512,this._renderWorldCopies=I===void 0||I,this._minZoom=h||0,this._maxZoom=p||22,this._minPitch=w??0,this._maxPitch=E??60,this.setProjection(B),this.setMaxBounds(U),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new rf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const h=new Ql(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return h._elevation=this._elevation,h._centerAltitude=this._centerAltitude,h._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,h.tileSize=this.tileSize,h.mercatorFromTransition=this.mercatorFromTransition,h.width=this.width,h.height=this.height,h.cameraElevationReference=this.cameraElevationReference,h._center=this._center,h._setZoom(this.zoom),h._seaLevelZoom=this._seaLevelZoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._nearZ=this._nearZ,h._farZ=this._farZ,h._averageElevation=this._averageElevation,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._camera=this._camera.clone(),h._calcMatrices(),h.freezeTileCoverage=this.freezeTileCoverage,h.frustumCorners=this.frustumCorners,h}get elevation(){return this._elevation}set elevation(h){this._elevation!==h&&(this._elevation=h,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(h,p=!1){const w=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||w)&&this._updateCameraOnTerrain(),(h||w)&&this._constrainCamera(p),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(h){this.projectionOptions=h||{name:"mercator"};const p=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const w=!d(p,this.getProjection());return w&&this._calcMatrices(),this.mercatorFromTransition=!1,w}setMercatorFromTransition(){const h=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const p=h!==this.projection.name;return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))}get maxZoom(){return this._maxZoom}set maxZoom(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))}get minPitch(){return this._minPitch}set minPitch(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))}get maxPitch(){return this._maxPitch}set maxPitch(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const h=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(h))}get cameraWorldSize(){const h=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(h))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(h){this.rotation=h}get rotation(){return-this.angle/Math.PI*180}set rotation(h){const p=-h*Math.PI/180;var w;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=(w=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(w[1]=0,w[2]=0),w[0]=1,w[3]=1,w),function(E,I,B){var U=I[0],H=I[1],J=I[2],Y=I[3],oe=Math.sin(B),me=Math.cos(B);E[0]=U*me+J*oe,E[1]=H*me+Y*oe,E[2]=U*-oe+J*me,E[3]=H*-oe+Y*me}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(h){const p=s.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const h=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/h)}set fov(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=s.degToRad(h),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(h){this._averageElevation=h,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(h){const p=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(h){this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;this._centerAltitude=h.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=h.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const h=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],w=this.horizonLineFromTop();let E=0,I=0;for(let B=0;B<p.length;B++){const U=new s.pointGeometry(p[B][0]*this.width,w+p[B][1]*(this.height-w)),H=h.pointCoordinate(U);if(!H)continue;const J=1/Math.hypot(H[0]-this._camera.position[0],H[1]-this._camera.position[1]);E+=H[3]*J,I+=J}return I===0?NaN:E/I}get center(){return this._center}set center(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const h=this._seaLevelZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),w=this.pixelsPerMeter/this.worldSize*p,E=this._mercatorZfromZoom(h),I=this._mercatorZfromZoom(this._maxZoom),B=Math.max(E-w,I);this._setZoom(this._zoomFromMercatorZ(B))}get padding(){return this._edgeInsets.toJSON()}set padding(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())}computeZoomRelativeTo(h){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,h.toAltitude()));let w;w=h.z<this._camera.position[2]?[p.x,p.y,p.z]:[h.x,h.y,h.z];const E=s.length(s.sub([],this._camera.position,w));return s.clamp(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(h){if(!this.height||!h.position&&!h.orientation)return;this._updateCameraState();let p=!1;if(h.orientation&&!s.exactEquals(h.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(h.orientation)),h.position){const w=[h.position.x,h.position.y,h.position.z];s.exactEquals$1(w,this._camera.position)||(this._setCameraPosition(w),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const h=this._camera.position,p=new nf;return p.position=new s.MercatorCoordinate(h[0],h[1],h[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(h){if(!s.length$1(h))return!1;s.normalize$1(h,h);const p=s.transformQuat([],[0,0,-1],h),w=s.transformQuat([],[0,-1,0],h);if(w[2]<0)return!1;const E=Vp(p,w);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(h){const p=this.zoomScale(this.minZoom)*this.tileSize,w=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;h[2]=s.clamp(h[2],E/w,E/p),this._camera.position=h}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(h){return this._edgeInsets.equals(h)}interpolatePadding(h,p,w){this._unmodified=!1,this._edgeInsets.interpolate(h,p,w),this._constrain(),this._calcMatrices()}coveringZoomLevel(h){const p=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(h){const p=[new s.UnwrappedTileID(0,h)];if(this.renderWorldCopies){const w=this.pointCoordinate(new s.pointGeometry(0,0)),E=this.pointCoordinate(new s.pointGeometry(this.width,0)),I=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),B=this.pointCoordinate(new s.pointGeometry(0,this.height)),U=Math.floor(Math.min(w.x,E.x,I.x,B.x)),H=Math.floor(Math.max(w.x,E.x,I.x,B.x)),J=1;for(let Y=U-J;Y<=H+J;Y++)Y!==0&&p.push(new s.UnwrappedTileID(Y,h))}return p}coveringTiles(h){let p=this.coveringZoomLevel(h);const w=p,E=this.elevation&&!h.isTerrainDEM,I=this.projection.name==="mercator";if(h.minzoom!==void 0&&p<h.minzoom)return[];h.maxzoom!==void 0&&p>h.maxzoom&&(p=h.maxzoom);const B=this.locationCoordinate(this.center),U=this.center.lat,H=1<<p,J=[H*B.x,H*B.y,0],Y=this.projection.name==="globe",oe=!Y,me=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,oe),be=Y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),we=H*s.mercatorZfromAltitude(1,this.center.lat),Me=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),_e=[H*be.x,H*be.y,Me*(oe?1:we)],xe=this.cameraToCenterDistance/h.tileSize*(h.roundZoom?1:.502),ke=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?p:0,Ce=h.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ue=h.isTerrainDEM?-Ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ze=this.projection.isReprojectedInTileSpace?$c(this):1,qe=gt=>{const Dt=new s.MercatorCoordinate(gt.x+25e-6,gt.y,gt.z),Ye=new s.MercatorCoordinate(gt.x,gt.y+25e-6,gt.z),at=gt.toLngLat(),Qt=Dt.toLngLat(),mn=Ye.toLngLat(),cn=this.locationCoordinate(at),Fn=this.locationCoordinate(Qt),Rn=this.locationCoordinate(mn),Cn=Math.hypot(Fn.x-cn.x,Fn.y-cn.y),an=Math.hypot(Rn.x-cn.x,Rn.y-cn.y);return Math.sqrt(Cn*an)*Ze/25e-6},tt=gt=>{const kt=Ce,Dt=Ue;return{aabb:s.tileAABB(this,H,0,0,0,gt,Dt,kt,this.projection),zoom:0,x:0,y:0,minZ:Dt,maxZ:kt,wrap:gt,fullyVisible:!1}},ft=[];let lt=[];const it=p,Gt=h.reparseOverscaled?w:p,ot=gt=>gt*gt,bt=ot((Me-this._centerAltitude)*we),mt=gt=>{if(!this._elevation||!gt.tileID||!I)return;const kt=this._elevation.getMinMaxForTile(gt.tileID),Dt=gt.aabb;kt?(Dt.min[2]=kt.min,Dt.max[2]=kt.max,Dt.center[2]=(Dt.min[2]+Dt.max[2])/2):(gt.shouldSplit=Ut(gt),gt.shouldSplit||(Dt.min[2]=Dt.max[2]=Dt.center[2]=this._centerAltitude))},Ut=gt=>{if(gt.zoom<ke)return!0;if(gt.zoom===it)return!1;if(gt.shouldSplit!=null)return gt.shouldSplit;const kt=gt.aabb.distanceX(_e),Dt=gt.aabb.distanceY(_e);let Ye=bt,at=1;if(Y){Ye=ot(gt.aabb.distanceZ(_e));const cn=Math.pow(2,gt.zoom),Fn=s.latFromMercatorY((gt.y+1)/cn),Rn=s.latFromMercatorY(gt.y/cn),Cn=Math.min(Math.max(U,Fn),Rn),an=s.circumferenceAtLatitude(Cn)/s.circumferenceAtLatitude(U);if(at=Cn===U?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,an/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&gt.zoom===it-1&&an>=.9)return!0}else if(E&&(Ye=ot(gt.aabb.distanceZ(_e)*we)),this.projection.isReprojectedInTileSpace&&w<=5){const cn=Math.pow(2,gt.zoom),Fn=qe(new s.MercatorCoordinate((gt.x+.5)/cn,(gt.y+.5)/cn));at=Fn>.85?1:Fn}const Qt=kt*kt+Dt*Dt+Ye,mn=ot((1<<it-gt.zoom)*xe*at*((cn,Fn)=>{if(Fn*ot(.707)<cn)return 1;const Rn=Math.sqrt(Fn/cn);return Rn/(1.4144271570014144+(Math.pow(1.1,Rn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ye,bt),Qt));return Qt<mn};if(this.renderWorldCopies)for(let gt=1;gt<=3;gt++)ft.push(tt(-gt)),ft.push(tt(gt));for(ft.push(tt(0));ft.length>0;){const gt=ft.pop(),kt=gt.x,Dt=gt.y;let Ye=gt.fullyVisible;if(!Ye){const at=gt.aabb.intersects(me);if(at===0)continue;Ye=at===2}if(gt.zoom!==it&&Ut(gt))for(let at=0;at<4;at++){const Qt=(kt<<1)+at%2,mn=(Dt<<1)+(at>>1),cn={aabb:I?gt.aabb.quadrant(at):s.tileAABB(this,H,gt.zoom+1,Qt,mn,gt.wrap,gt.minZ,gt.maxZ,this.projection),zoom:gt.zoom+1,x:Qt,y:mn,wrap:gt.wrap,fullyVisible:Ye,tileID:void 0,shouldSplit:void 0,minZ:gt.minZ,maxZ:gt.maxZ};E&&!Y&&(cn.tileID=new s.OverscaledTileID(gt.zoom+1===it?Gt:gt.zoom+1,gt.wrap,gt.zoom+1,Qt,mn),mt(cn)),ft.push(cn)}else{const at=gt.zoom===it?Gt:gt.zoom;if(h.minzoom&&h.minzoom>at)continue;const Qt=J[0]-(.5+kt+(gt.wrap<<gt.zoom))*(1<<p-gt.zoom),mn=J[1]-.5-Dt,cn=gt.tileID?gt.tileID:new s.OverscaledTileID(at,gt.wrap,gt.zoom,kt,Dt);lt.push({tileID:cn,distanceSq:Qt*Qt+mn*mn})}}if(this.fogCullDistSq){const gt=this.fogCullDistSq,kt=this.horizonLineFromTop();lt=lt.filter(Dt=>{const Ye=[0,0,0,1],at=[s.EXTENT,s.EXTENT,0,1],Qt=this.calculateFogTileMatrix(Dt.tileID.toUnwrapped());s.transformMat4$1(Ye,Ye,Qt),s.transformMat4$1(at,at,Qt);const mn=s.getAABBPointSquareDist(Ye,at);if(mn===0)return!0;let cn=!1;const Fn=this._elevation;if(Fn&&mn>gt&&kt!==0){const Rn=this.calculateProjMatrix(Dt.tileID.toUnwrapped());let Cn;h.isTerrainDEM||(Cn=Fn.getMinMaxForTile(Dt.tileID)),Cn||(Cn={min:Ue,max:Ce});const an=s.furthestTileCorner(this.rotation),ki=[an[0]*s.EXTENT,an[1]*s.EXTENT,Cn.max];s.transformMat4(ki,ki,Rn),cn=(1-ki[1])*this.height*.5<kt}return mn<gt||cn})}return lt.sort((gt,kt)=>gt.distanceSq-kt.distanceSq).map(gt=>gt.tileID)}resize(h,p){this.width=h,this.height=p,this.pixelsToGLUnits=[2/h,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(h){return Math.pow(2,h)}scaleZoom(h){return Math.log(h)/Math.LN2}project(h){const p=s.clamp(h.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),w=this.projection.project(h.lng,p);return new s.pointGeometry(w.x*this.worldSize,w.y*this.worldSize)}unproject(h){return this.projection.unproject(h.x/this.worldSize,h.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(h,p){let w,E;const I=this.centerPoint;if(this.projection.name==="globe"){const U=this.worldSize;w=(p.x-I.x)/U,E=(p.y-I.y)/U}else{const U=this.pointCoordinate(p),H=this.pointCoordinate(I);w=U.x-H.x,E=U.y-H.y}const B=this.locationCoordinate(h);this.setLocation(new s.MercatorCoordinate(B.x-w,B.y-E))}setLocation(h){this.center=this.coordinateLocation(h),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(h){return this.projection.locationPoint(this,h)}locationPoint3D(h){return this.projection.locationPoint(this,h,!0)}pointLocation(h){return this.coordinateLocation(this.pointCoordinate(h))}pointLocation3D(h){return this.coordinateLocation(this.pointCoordinate3D(h))}locationCoordinate(h,p){const w=p?s.mercatorZfromAltitude(p,h.lat):void 0,E=this.projection.project(h.lng,h.lat);return new s.MercatorCoordinate(E.x,E.y,w)}coordinateLocation(h){return this.projection.unproject(h.x,h.y)}pointRayIntersection(h,p){const w=p??this._centerAltitude,E=[h.x,h.y,0,1],I=[h.x,h.y,1,1];s.transformMat4$1(E,E,this.pixelMatrixInverse),s.transformMat4$1(I,I,this.pixelMatrixInverse);const B=I[3];s.scale$1(E,E,1/E[3]),s.scale$1(I,I,1/B);const U=E[2],H=I[2];return{p0:E,p1:I,t:U===H?0:(w-U)/(H-U)}}screenPointToMercatorRay(h){const p=[h.x,h.y,0,1],w=[h.x,h.y,1,1];return s.transformMat4$1(p,p,this.pixelMatrixInverse),s.transformMat4$1(w,w,this.pixelMatrixInverse),s.scale$1(p,p,1/p[3]),s.scale$1(w,w,1/w[3]),p[2]=s.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,w[2]=s.mercatorZfromAltitude(w[2],this._center.lat)*this.worldSize,s.scale$1(p,p,1/this.worldSize),s.scale$1(w,w,1/this.worldSize),new s.Ray([p[0],p[1],p[2]],s.normalize([],s.sub([],w,p)))}rayIntersectionCoordinate(h){const{p0:p,p1:w,t:E}=h,I=s.mercatorZfromAltitude(p[2],this._center.lat),B=s.mercatorZfromAltitude(w[2],this._center.lat);return new s.MercatorCoordinate(s.number(p[0],w[0],E)/this.worldSize,s.number(p[1],w[1],E)/this.worldSize,s.number(I,B,E))}pointCoordinate(h,p=this._centerAltitude){return this.projection.pointCoordinate(this,h.x,h.y,p)}pointCoordinate3D(h){if(!this.elevation)return this.pointCoordinate(h);let p=this.projection.pointCoordinate3D(this,h.x,h.y);if(p)return new s.MercatorCoordinate(p[0],p[1],p[2]);let w=0,E=this.horizonLineFromTop();if(h.y>E)return this.pointCoordinate(h);const I=.02*E,B=h.clone();for(let U=0;U<10&&E-w>I;U++){B.y=s.number(w,E,.66);const H=this.projection.pointCoordinate3D(this,B.x,B.y);H?(E=B.y,p=H):w=B.y}return p?new s.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(h)}isPointAboveHorizon(h){return this.projection.isPointAboveHorizon(this,h)}_coordinatePoint(h,p){const w=p&&this.elevation?this.elevation.getAtPointOrZero(h,this._centerAltitude):this._centerAltitude,E=[h.x*this.worldSize,h.y*this.worldSize,w+h.toAltitude(),1];return s.transformMat4$1(E,E,this.pixelMatrix),E[3]>0?new s.pointGeometry(E[0]/E[3],E[1]/E[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:h,left:p}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,I=this.pointCoordinate3D(new s.pointGeometry(p,h)),B=this.pointCoordinate3D(new s.pointGeometry(E,h)),U=this.pointCoordinate3D(new s.pointGeometry(E,w)),H=this.pointCoordinate3D(new s.pointGeometry(p,w));let J=Math.min(I.x,H.x),Y=Math.max(B.x,U.x),oe=Math.min(I.y,B.y),me=Math.max(H.y,U.y);const be=Math.pow(2,-this.zoom)/16,we=(qe,tt,ft,lt)=>{const it=(qe+ft)/2,Gt=(tt+lt)/2,ot=new s.pointGeometry(it,Gt),bt=this.pointCoordinate3D(ot),mt=Math.max(0,J-bt.x,oe-bt.y,bt.x-Y,bt.y-me);J=Math.min(J,bt.x),Y=Math.max(Y,bt.x),oe=Math.min(oe,bt.y),me=Math.max(me,bt.y),mt>be&&(we(qe,tt,it,Gt),we(it,Gt,ft,lt))};we(p,h,E,h),we(E,h,E,w),we(E,w,p,w),we(p,w,p,h);const[Me,_e]=s.polesInViewport(this),xe=Me||_e,ke=Me?90:s.latFromMercatorY(oe),Ce=xe?180:s.lngFromMercatorX(Y),Ue=_e?-90:s.latFromMercatorY(me),Ze=xe?-180:s.lngFromMercatorX(J);return new s.LngLatBounds(new s.LngLat(Ze,Ue),new s.LngLat(Ce,ke))}_getBounds(h,p){if(this.projection.name==="globe")return this._getGlobeBounds();const w=new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),E=new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),I=new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),B=new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let U=this.pointCoordinate(w,h),H=this.pointCoordinate(E,h);const J=this.pointCoordinate(I,p),Y=this.pointCoordinate(B,p),oe=(me,be)=>(be.y-me.y)/(be.x-me.x);return U.y>1&&H.y>=0?U=new s.MercatorCoordinate((1-Y.y)/oe(Y,U)+Y.x,1):U.y<0&&H.y<=1&&(U=new s.MercatorCoordinate(-Y.y/oe(Y,U)+Y.x,0)),H.y>1&&U.y>=0?H=new s.MercatorCoordinate((1-J.y)/oe(J,H)+J.x,1):H.y<0&&U.y<=1&&(H=new s.MercatorCoordinate(-J.y/oe(J,H)+J.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(J))}_getBounds3D(){const h=this.elevation;if(!h.visibleDemTiles.length||h.isUsingMockSource())return this._getBounds(0,0);const p=h.visibleDemTiles.reduce((w,E)=>{if(E.dem){const I=E.dem.tree;w.min=Math.min(w.min,I.minimums[0]),w.max=Math.max(w.max,I.maximums[0])}return w},{min:Number.MAX_VALUE,max:0});return this._getBounds(p.min*h.exaggeration(),p.max*h.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(h=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,w=this.height/2-p*(1-this._horizonShift);return h?Math.max(0,w):w}getMaxBounds(){return this.maxBounds}setMaxBounds(h){this.maxBounds=h,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,h&&(this.minLat=h.getSouth(),this.maxLat=h.getNorth(),this.minLng=h.getWest(),this.maxLng=h.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(h,p){return this.projection.createTileMatrix(this,p,h)}calculateDistanceTileData(h){const p=h.key,w=this._distanceTileDataCache;if(w[p])return w[p];const E=h.canonical,I=1/this.height,B=this.cameraWorldSize,U=B/this.zoomScale(E.z),H=(E.x+Math.pow(2,E.z)*h.wrap)*U,J=E.y*U,Y=this.point;Y.x*=B/this.worldSize,Y.y*=B/this.worldSize;const oe=this.angle,me=Math.sin(-oe),be=-Math.cos(-oe);return w[p]={bearing:[me,be],center:[(Y.x-H)*I,(Y.y-J)*I],scale:U/s.EXTENT*I},w[p]}calculateFogTileMatrix(h){const p=h.key,w=this._fogTileMatrixCache;if(w[p])return w[p];const E=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,h);return s.multiply(E,this.worldToFogMatrix,E),w[p]=new Float32Array(E),w[p]}calculateProjMatrix(h,p=!1){const w=h.key,E=p?this._alignedProjMatrixCache:this._projMatrixCache;if(E[w])return E[w];const I=this.calculatePosMatrix(h,this.worldSize);return s.multiply(I,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.alignedProjMatrix:this.projMatrix,I),E[w]=new Float32Array(I),E[w]}calculatePixelsToTileUnitsMatrix(h){const p=h.tileID.key,w=this._pixelsToTileUnitsCache;if(w[p])return w[p];const E=function(I,B){const{scale:U}=I.tileTransform,H=U*s.EXTENT/(I.tileSize*Math.pow(2,B.zoom-I.tileID.overscaledZ+I.tileID.canonical.z));return J=new Float32Array(4),me=(Y=B.inverseAdjustmentMatrix)[1],be=Y[2],we=Y[3],_e=(oe=[H,H])[1],J[0]=Y[0]*(Me=oe[0]),J[1]=me*Me,J[2]=be*_e,J[3]=we*_e,J;var J,Y,oe,me,be,we,Me,_e}(h,this);return w[p]=E,w[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const h=this._elevation;this._updateCameraState();const p=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(p),E=this._camera.forward(),I=s.mercatorZfromAltitude(1,this._center.lat);w[2]/=I,E[2]/=I,s.normalize(E,E);const B=h.raycast(w,E,h.exaggeration());if(B){const U=s.scaleAndAdd([],w,E,B),H=new s.MercatorCoordinate(U[0],U[1],s.mercatorZfromAltitude(U[2],s.latFromMercatorY(U[1]))),J=(H.z+s.length([H.x-w[0],H.y-w[1],H.z-w[2]*I]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(J),this._centerAltitude=H.toAltitude(),this._center=this.coordinateLocation(H),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(h=!1){if(!this._elevation)return;const p=this._elevation,w=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(w),I=p.getAtPointOrZero(new s.MercatorCoordinate(...E)),B=this.pixelsPerMeter/this.worldSize*I,U=this._minimumHeightOverTerrain(),H=E[2]-B;if(H<=U)if(H<0||h){const J=this.locationCoordinate(this._center,this._centerAltitude),Y=[E[0],E[1],J.z-E[2]],oe=s.length(Y);Y[2]-=(U-H)/this._pixelsPerMercatorPixel;const me=s.length(Y);if(me===0)return;s.scale$2(Y,Y,oe/me*this._pixelsPerMercatorPixel),this._camera.position=[E[0],E[1],J.z*this._pixelsPerMercatorPixel-Y[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const h=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||h){const me=this.center;return me.lat=s.clamp(me.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!h)&&(me.lng=s.clamp(me.lng,this.minLng,this.maxLng)),this.center=me,void(this._constraining=!1)}const p=this._unmodified,{x:w,y:E}=this.point;let I=0,B=w,U=E;const H=this.width/2,J=this.height/2,Y=this.worldMinY*this.scale,oe=this.worldMaxY*this.scale;if(E-J<Y&&(U=Y+J),E+J>oe&&(U=oe-J),oe-Y<this.height&&(I=Math.max(I,this.height/(oe-Y)),U=(oe+Y)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const me=this.worldMinX*this.scale,be=this.worldMaxX*this.scale,we=this.worldSize/2-(me+be)/2;B=(w+we+this.worldSize)%this.worldSize-we,B-H<me&&(B=me+H),B+H>be&&(B=be-H),be-me<this.width&&(I=Math.max(I,this.width/(be-me)),B=(be+me)/2)}B===w&&U===E||(this.center=this.unproject(new s.pointGeometry(B,U))),I&&(this.zoom+=this.scaleZoom(I)),this._constrainCamera(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let h=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(h=Math.max(h,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),h}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const h=this.centerOffset,p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const w=jo(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const E=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?p:1),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-h.x/this.width,I[9]=2*h.y/this.height;let B=s.mul([],I,E);if(this.projection.isReprojectedInTileSpace){const Ze=this.locationCoordinate(this.center),qe=s.identity([]);s.translate(qe,qe,[Ze.x*this.worldSize,Ze.y*this.worldSize,0]),s.multiply(qe,qe,qh(this)),s.translate(qe,qe,[-Ze.x*this.worldSize,-Ze.y*this.worldSize,0]),s.multiply(B,B,qe),this.inverseAdjustmentMatrix=function(tt){const ft=qh(tt,!0);return ne([],[ft[0],ft[1],ft[4],ft[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],B,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=B,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const U=s.invert([],I);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height);const H=new Float32Array(16);s.identity(H),s.scale(H,H,[1,-1,1]),s.rotateX(H,H,this._pitch),s.rotateZ(H,H,this.angle);const J=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;J[8]=2*-h.x/this.width,J[9]=2*(h.y+Y)/this.height,this.skyboxMatrix=s.multiply(H,J,H);const oe=this.point,me=oe.x,be=oe.y,we=this.width%2/2,Me=this.height%2/2,_e=Math.cos(this.angle),xe=Math.sin(this.angle),ke=me-Math.round(me)+_e*we+xe*Me,Ce=be-Math.round(be)+_e*Me+xe*we,Ue=new Float64Array(B);if(s.translate(Ue,Ue,[ke>.5?ke-1:ke,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=Ue,B=s.create(),s.scale(B,B,[this.width/2,-this.height/2,1]),s.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=s.create(),s.scale(B,B,[1,-1,1]),s.translate(B,B,[-1,-1,0]),s.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},B=s.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const Ze=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(Ze,Ze,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const h=this.cameraWorldSizeForFog,p=this.cameraPixelsPerMeter,w=this._camera.position,E=1/this.height/this._pixelsPerMercatorPixel,I=[h,h,p];s.scale$2(I,I,E),s.scale$2(w,w,-1),s.multiply$2(w,w,I);const B=s.create();s.translate(B,B,w),s.scale(B,B,I),this.mercatorFogMatrix=B,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(h,p,E)}_computeCameraPosition(h){const p=(h=h||this.pixelsPerMeter)/this.pixelsPerMeter,w=this._camera.forward(),E=this.point,I=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*p-h/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-w[0]*I,E.y/this.worldSize-w[1]*I,h/this.worldSize*this._centerAltitude-w[2]*I]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(h){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),w=this._camera.position[2],E=h[2];let I=1;this.projection.wrap&&(this.center=this.center.wrap()),E>0&&(I=Math.min((p-w)/E,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,h,I),this._updateStateFromCamera()}_updateStateFromCamera(){const h=this._camera.position,p=this._camera.forward(),{pitch:w,bearing:E}=this._camera.getPitchBearing(),I=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,B=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),U=Math.max((h[2]-I)/Math.cos(w),B),H=this._zoomFromMercatorZ(U);s.scaleAndAdd(h,h,p,U),this._pitch=s.clamp(w,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(E,-Math.PI,Math.PI),this._setZoom(s.clamp(H,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(h[0],h[1],h[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(h){return Math.pow(2,h)*this.tileSize}_mercatorZfromZoom(h){return this.cameraToCenterDistance/this._worldSizeFromZoom(h)}_minimumHeightOverTerrain(){const h=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(h)}_zoomFromMercatorZ(h){return this.scaleZoom(this.cameraToCenterDistance/(h*this.tileSize))}zoomFromMercatorZAdjusted(h){const p=B=>{const U=this.getCameraToCenterDistance(this.projection,B);return this.scaleZoom(U/(h*this.tileSize))};let w,E=p(this.zoom),I=Math.abs(E-p(E));for(;w!==I;)E=p(E),w=I,I=Math.abs(E-p(E));return E}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(h,p){const w=Math.min(h.x,p.x),E=Math.max(h.x,p.x),I=Math.min(h.y,p.y),B=Math.max(h.y,p.y);if(I<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const U=[new s.pointGeometry(w,I),new s.pointGeometry(E,B),new s.pointGeometry(w,B),new s.pointGeometry(E,I)],H=this.renderWorldCopies?-3:0,J=this.renderWorldCopies?4:1;for(const Y of U){const oe=this.pointRayIntersection(Y);if(oe.t<0)return!0;const me=this.rayIntersectionCoordinate(oe);if(me.x<H||me.y<0||me.x>J||me.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(h,p){const w=s.length(s.sub([],this._camera.position,h)),E=this._zoomFromMercatorZ(w)+p;return w-this._mercatorZfromZoom(E)}getCameraPoint(){if(this.projection.name==="globe"){const h=function([p,w,E],I){const B=[p,w,E,1];s.transformMat4$1(B,B,I);const U=B[3]=Math.max(B[3],1e-6);return B[0]/=U,B[1]/=U,B[2]/=U,B}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(h[0],h[1])}{const h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,h))}}getCameraToCenterDistance(h,p=this.zoom){const w=jo(h,p,this.width,this.height,1024),E=h.pixelSpaceConversion(this.center.lat,this.worldSize,w);return .5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const h=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(h,h,this.globeMatrix),h}}function yl(y,h){let p=!1,w=null;const E=()=>{w=null,p&&(y(),w=setTimeout(E,h),p=!1)};return()=>(p=!0,w||E(),w)}class hn{constructor(h){this._hashName=h&&encodeURIComponent(h),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=yl(this._updateHashUnthrottled.bind(this),300)}addTo(h){return this._map=h,s.window.addEventListener("hashchange",this._onHashChange,!1),h.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const h=this._map;if(!h)return"";const p=Co(h);if(this._hashName){const w=this._hashName;let E=!1;const I=s.window.location.hash.slice(1).split("&").map(B=>{const U=B.split("=")[0];return U===w?(E=!0,`${U}=${p}`):B}).filter(B=>B);return E||I.push(`${w}=${p}`),`#${I.join("&")}`}return`#${p}`}_getCurrentHash(){const h=s.window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(w=>w.split("=")).forEach(w=>{w[0]===this._hashName&&(p=w)}),(p&&p[1]||"").split("/")}return h.split("/")}_onHashChange(){const h=this._map;if(!h)return!1;const p=this._getCurrentHash();if(p.length>=3&&!p.some(w=>isNaN(w))){const w=h.dragRotate.isEnabled()&&h.touchZoomRotate.isEnabled()?+(p[3]||0):h.getBearing();return h.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:w,pitch:+(p[4]||0)}),!0}return!1}_updateHashUnthrottled(){const h=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,h)}}function Co(y,h){const p=y.getCenter(),w=Math.round(100*y.getZoom())/100,E=Math.ceil((w*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,E),B=Math.round(p.lng*I)/I,U=Math.round(p.lat*I)/I,H=y.getBearing(),J=y.getPitch();let Y=h?`/${B}/${U}/${w}`:`${w}/${U}/${B}`;return(H||J)&&(Y+="/"+Math.round(10*H)/10),J&&(Y+=`/${Math.round(J)}`),Y}const Wu={linearity:.3,easing:s.bezier(0,0,.3,1)},Gp=s.extend({deceleration:2500,maxSpeed:1400},Wu),sf=s.extend({deceleration:20,maxSpeed:1400},Wu),Yc=s.extend({deceleration:1e3,maxSpeed:360},Wu),Wp=s.extend({deceleration:1e3,maxSpeed:90},Wu);class of{constructor(h){this._map=h,this.clear()}clear(){this._inertiaBuffer=[]}record(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:h})}_drainInertiaBuffer(){const h=this._inertiaBuffer,p=s.exported.now();for(;h.length>0&&p-h[0].time>160;)h.shift()}_onMoveEnd(h){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:I}of this._inertiaBuffer)p.zoom+=I.zoomDelta||0,p.bearing+=I.bearingDelta||0,p.pitch+=I.pitchDelta||0,I.panDelta&&p.pan._add(I.panDelta),I.around&&(p.around=I.around),I.pinchAround&&(p.pinchAround=I.pinchAround);const w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(p.pan.mag()){const I=Kc(p.pan.mag(),w,s.extend({},Gp,h||{}));E.offset=p.pan.mult(I.amount/p.pan.mag()),E.center=this._map.transform.center,Jc(E,I)}if(p.zoom){const I=Kc(p.zoom,w,sf);E.zoom=this._map.transform.zoom+I.amount,Jc(E,I)}if(p.bearing){const I=Kc(p.bearing,w,Yc);E.bearing=this._map.transform.bearing+s.clamp(I.amount,-179,179),Jc(E,I)}if(p.pitch){const I=Kc(p.pitch,w,Wp);E.pitch=this._map.transform.pitch+I.amount,Jc(E,I)}if(E.zoom||E.bearing){const I=p.pinchAround===void 0?p.around:p.pinchAround;E.around=I?this._map.unproject(I):this._map.getCenter()}return this.clear(),E.noMoveStart=!0,E}}function Jc(y,h){(!y.duration||y.duration<h.duration)&&(y.duration=h.duration,y.easing=h.easing)}function Kc(y,h,p){const{maxSpeed:w,linearity:E,deceleration:I}=p,B=s.clamp(y*E/(h/1e3),-w,w),U=Math.abs(B)/(I*E);return{easing:p.easing,duration:1e3*U,amount:B*(U/2)}}class yo extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,p,w,E={}){const I=j(p.getCanvasContainer(),w),B=p.unproject(I);super(h,s.extend({point:I,lngLat:B,originalEvent:w},E)),this._defaultPrevented=!1,this.target=p}}class Hu extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,p,w){const E=h==="touchend"?w.changedTouches:w.touches,I=Q(p.getCanvasContainer(),E),B=I.map(H=>p.unproject(H)),U=I.reduce((H,J,Y,oe)=>H.add(J.div(oe.length)),new s.pointGeometry(0,0));super(h,{points:I,point:U,lngLats:B,lngLat:p.unproject(U),originalEvent:w}),this._defaultPrevented=!1}}class Qc extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,p,w){super(h,{originalEvent:w}),this._defaultPrevented=!1}}class Ig{constructor(h,p){this._map=h,this._clickTolerance=p.clickTolerance}reset(){this._mousedownPos=void 0}wheel(h){return this._firePreventable(new Qc(h.type,this._map,h))}mousedown(h,p){return this._mousedownPos=p,this._firePreventable(new yo(h.type,this._map,h))}mouseup(h){this._map.fire(new yo(h.type,this._map,h))}preclick(h){const p=s.extend({},h);p.type="preclick",this._map.fire(new yo(p.type,this._map,p))}click(h,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(h),this._map.fire(new yo(h.type,this._map,h)))}dblclick(h){return this._firePreventable(new yo(h.type,this._map,h))}mouseover(h){this._map.fire(new yo(h.type,this._map,h))}mouseout(h){this._map.fire(new yo(h.type,this._map,h))}touchstart(h){return this._firePreventable(new Hu(h.type,this._map,h))}touchmove(h){this._map.fire(new Hu(h.type,this._map,h))}touchend(h){this._map.fire(new Hu(h.type,this._map,h))}touchcancel(h){this._map.fire(new Hu(h.type,this._map,h))}_firePreventable(h){if(this._map.fire(h),h.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pg{constructor(h){this._map=h}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(h){this._map.fire(new yo(h.type,this._map,h))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new yo(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zh{constructor(h,p){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(h,p){this.isEnabled()&&h.shiftKey&&h.button===0&&(O(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(h,p){if(!this._active)return;const w=p,E=this._startPos,I=this._lastPos;if(!E||!I||I.equals(w)||!this._box&&w.dist(E)<this._clickTolerance)return;this._lastPos=w,this._box||(this._box=T("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));const B=Math.min(E.x,w.x),U=Math.max(E.x,w.x),H=Math.min(E.y,w.y),J=Math.max(E.y,w.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${B}px,${H}px)`,this._box.style.width=U-B+"px",this._box.style.height=J-H+"px")})}mouseupWindow(h,p){if(!this._active)return;const w=this._startPos,E=p;if(w&&h.button===0){if(this.reset(),G(),w.x!==E.x||w.y!==E.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:I=>I.fitScreenCoordinates(w,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",h)}}keydown(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),F(),delete this._startPos,delete this._lastPos}_fireEvent(h,p){return this._map.fire(new s.Event(h,{originalEvent:p}))}}function ju(y,h){const p={};for(let w=0;w<y.length;w++)p[y[w].identifier]=h[w];return p}class Hp{constructor(h){this.reset(),this.numTouches=h.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(h,p,w){(this.centroid||w.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=h.timeStamp),w.length===this.numTouches&&(this.centroid=function(E){const I=new s.pointGeometry(0,0);for(const B of E)I._add(B);return I.div(E.length)}(p),this.touches=ju(w,p)))}touchmove(h,p,w){if(this.aborted||!this.centroid)return;const E=ju(w,p);for(const I in this.touches){const B=this.touches[I],U=E[I];(!U||U.dist(B)>30)&&(this.aborted=!0)}}touchend(h,p,w){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),w.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class af{constructor(h){this.singleTap=new Hp(h),this.numTaps=h.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(h,p,w){this.singleTap.touchstart(h,p,w)}touchmove(h,p,w){this.singleTap.touchmove(h,p,w)}touchend(h,p,w){const E=this.singleTap.touchend(h,p,w);if(E){const I=h.timeStamp-this.lastTime<500,B=!this.lastTap||this.lastTap.dist(E)<30;if(I&&B||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class lf{constructor(){this._zoomIn=new af({numTouches:1,numTaps:2}),this._zoomOut=new af({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(h,p,w){this._zoomIn.touchstart(h,p,w),this._zoomOut.touchstart(h,p,w)}touchmove(h,p,w){this._zoomIn.touchmove(h,p,w),this._zoomOut.touchmove(h,p,w)}touchend(h,p,w){const E=this._zoomIn.touchend(h,p,w),I=this._zoomOut.touchend(h,p,w);return E?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:B.getZoom()+1,around:B.unproject(E)},{originalEvent:h})}):I?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:B.getZoom()-1,around:B.unproject(I)},{originalEvent:h})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qu={0:1,2:2};class $h{constructor(h){this.reset(),this._clickTolerance=h.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(h,p){return!1}_move(h,p){return{}}mousedown(h,p){if(this._lastPoint)return;const w=re(h);this._correctButton(h,w)&&(this._lastPoint=p,this._eventButton=w)}mousemoveWindow(h,p){const w=this._lastPoint;if(w){if(h.preventDefault(),this._eventButton!=null&&function(E,I){const B=qu[I];return E.buttons===void 0||(E.buttons&B)!==B}(h,this._eventButton))this.reset();else if(this._moved||!(p.dist(w)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(w,p)}}mouseupWindow(h){this._lastPoint&&re(h)===this._eventButton&&(this._moved&&G(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jp extends $h{mousedown(h,p){super.mousedown(h,p),this._lastPoint&&(this._active=!0)}_correctButton(h,p){return p===0&&!h.ctrlKey}_move(h,p){return{around:p,panDelta:p.sub(h)}}}class cf extends $h{_correctButton(h,p){return p===0&&h.ctrlKey||p===2}_move(h,p){const w=.8*(p.x-h.x);if(w)return this._active=!0,{bearingDelta:w}}contextmenu(h){h.preventDefault()}}class uf extends $h{_correctButton(h,p){return p===0&&h.ctrlKey||p===2}_move(h,p){const w=-.5*(p.y-h.y);if(w)return this._active=!0,{pitchDelta:w}}contextmenu(h){h.preventDefault()}}class qp{constructor(h,p){this._map=h,this._el=h.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(h,p,w){return this._calculateTransform(h,p,w)}touchmove(h,p,w){if(this._active&&!(w.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(w.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return h.cancelable&&h.preventDefault(),this._calculateTransform(h,p,w)}}touchend(h,p,w){this._calculateTransform(h,p,w),this._active&&w.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(h,p,w){w.length>0&&(this._active=!0);const E=ju(w,p),I=new s.pointGeometry(0,0),B=new s.pointGeometry(0,0);let U=0;for(const J in E){const Y=E[J],oe=this._touches[J];oe&&(I._add(Y),B._add(Y.sub(oe)),U++,E[J]=Y)}if(this._touches=E,U<this._minTouches||!B.mag())return;const H=B.div(U);return this._sum._add(H),this._sum.mag()<this._clickTolerance?void 0:{around:I.div(U),panDelta:H}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=T("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Xh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(h){}_move(h,p,w){return{}}touchstart(h,p,w){this._firstTwoTouches||w.length<2||(this._firstTwoTouches=[w[0].identifier,w[1].identifier],this._start([p[0],p[1]]))}touchmove(h,p,w){const E=this._firstTwoTouches;if(!E)return;h.preventDefault();const[I,B]=E,U=ps(w,p,I),H=ps(w,p,B);if(!U||!H)return;const J=this._aroundCenter?null:U.add(H).div(2);return this._move([U,H],J,h)}touchend(h,p,w){if(!this._firstTwoTouches)return;const[E,I]=this._firstTwoTouches,B=ps(w,p,E),U=ps(w,p,I);B&&U||(this._active&&G(),this.reset())}touchcancel(){this.reset()}enable(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ps(y,h,p){for(let w=0;w<y.length;w++)if(y[w].identifier===p)return h[w]}function hf(y,h){return Math.log(y/h)/Math.LN2}class Zu extends Xh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(h){this._startDistance=this._distance=h[0].dist(h[1])}_move(h,p){const w=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(hf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hf(this._distance,w),pinchAround:p}}}function $u(y,h){return 180*y.angleWith(h)/Math.PI}class Yh extends Xh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])}_move(h,p){const w=this._vector;if(this._vector=h[0].sub(h[1]),w&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$u(this._vector,w),pinchAround:p}}_isBelowThreshold(h){this._minDiameter=Math.min(this._minDiameter,h.mag());const p=25/(Math.PI*this._minDiameter)*360,w=this._startVector;if(!w)return!1;const E=$u(h,w);return Math.abs(E)<p}}function eu(y){return Math.abs(y.y)>Math.abs(y.x)}class Zp extends Xh{constructor(h){super(),this._map=h}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(h){this._lastPoints=h,eu(h[0].sub(h[1]))&&(this._valid=!1)}_move(h,p,w){const E=this._lastPoints;if(!E)return;const I=h[0].sub(E[0]),B=h[1].sub(E[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&w.touches.length<3||(this._valid=this.gestureBeginsVertically(I,B,w.timeStamp),!this._valid)?void 0:(this._lastPoints=h,this._active=!0,{pitchDelta:(I.y+B.y)/2*-.5})}gestureBeginsVertically(h,p,w){if(this._valid!==void 0)return this._valid;const E=h.mag()>=2,I=p.mag()>=2;if(!E&&!I)return;if(!E||!I)return this._firstMove==null&&(this._firstMove=w),w-this._firstMove<100&&void 0;const B=h.y>0==p.y>0;return eu(h)&&eu(p)&&B}}const Xu={panStep:100,bearingStep:15,pitchStep:10};class Wi{constructor(){const h=Xu;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(h){if(h.altKey||h.ctrlKey||h.metaKey)return;let p=0,w=0,E=0,I=0,B=0;switch(h.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:h.shiftKey?w=-1:(h.preventDefault(),I=-1);break;case 39:h.shiftKey?w=1:(h.preventDefault(),I=1);break;case 38:h.shiftKey?E=1:(h.preventDefault(),B=-1);break;case 40:h.shiftKey?E=-1:(h.preventDefault(),B=1);break;default:return}return this._rotationDisabled&&(w=0,E=0),{cameraAnimation:U=>{const H=U.getZoom();U.easeTo({duration:300,easeId:"keyboardHandler",easing:jy,zoom:p?Math.round(H)+p*(h.shiftKey?2:1):H,bearing:U.getBearing()+w*this._bearingStep,pitch:U.getPitch()+E*this._pitchStep,offset:[-I*this._panStep,-B*this._panStep],center:U.getCenter()},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jy(y){return y*(2-y)}const $p=4.000244140625;class Io{constructor(h,p){this._map=h,this._el=h.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(h){this._defaultZoomRate=h}setWheelZoomRate(h){this._wheelZoomRate=h}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!h&&h.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(h){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(h.ctrlKey||h.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=h.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY;const w=s.exported.now(),E=w-(this._lastWheelEventTime||0);this._lastWheelEventTime=w,p!==0&&p%$p==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(E*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),h.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=h,this._delta-=p,this._active||this._start(h)),h.preventDefault()}_onTimeout(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)}_start(h){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=j(this._el,h);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const h=this._map.transform;this._type==="wheel"&&h.projection.wrap&&(h._center.lng>=180||h._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const p=()=>h._terrainEnabled()&&this._aroundCoord?h.computeZoomRelativeTo(this._aroundCoord):h.zoom;if(this._delta!==0){const H=this._type==="wheel"&&Math.abs(this._delta)>$p?this._wheelZoomRate:this._defaultZoomRate;let J=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&J!==0&&(J=1/J);const Y=p(),oe=Math.pow(2,Y),me=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):oe;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(me*J))),this._type==="wheel"&&(this._startZoom=Y,this._easing=this._smoothOutEasing(200)),this._delta=0}const w=typeof this._targetZoom=="number"?this._targetZoom:p(),E=this._startZoom,I=this._easing;let B,U=!1;if(this._type==="wheel"&&E&&I){const H=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),J=I(H);B=s.number(E,w,J),H<1?this._frameId||(this._frameId=!0):U=!0}else B=w,U=!0;return this._active=!0,U&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!U,zoomDelta:B-p(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(h){let p=s.ease;if(this._prevEase){const w=this._prevEase,E=(s.exported.now()-w.start)/w.duration,I=w.easing(E+.01)-w.easing(E),B=.27/Math.sqrt(I*I+1e-4)*.01,U=Math.sqrt(.0729-B*B);p=s.bezier(B,U,.25,1)}return this._prevEase={start:s.exported.now(),duration:h,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=T("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Xs{constructor(h,p){this._clickZoom=h,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ba{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(h,p){return h.preventDefault(),{cameraAnimation:w=>{w.easeTo({duration:300,zoom:w.getZoom()+(h.shiftKey?-1:1),around:w.unproject(p)},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xp{constructor(){this._tap=new af({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(h,p,w){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?w.length>0&&(this._swipePoint=p[0],this._swipeTouch=w[0].identifier):this._tap.touchstart(h,p,w))}touchmove(h,p,w){if(this._tapTime){if(this._swipePoint){if(w[0].identifier!==this._swipeTouch)return;const E=p[0],I=E.y-this._swipePoint.y;return this._swipePoint=E,h.preventDefault(),this._active=!0,{zoomDelta:I/128}}}else this._tap.touchmove(h,p,w)}touchend(h,p,w){this._tapTime?this._swipePoint&&w.length===0&&this.reset():this._tap.touchend(h,p,w)&&(this._tapTime=h.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tu{constructor(h,p,w){this._el=h,this._mousePan=p,this._touchPan=w}enable(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _a{constructor(h,p,w){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=p,this._mousePitch=w}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jh{constructor(h,p,w,E){this._el=h,this._touchZoom=p,this._touchRotate=w,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const dn=y=>y.zoom||y.drag||y.pitch||y.rotate;class Yp extends s.Event{}class df{constructor(){this.constants=[1,1,.01],this.radius=0}setup(h,p){const w=s.sub([],p,h);this.radius=s.length(w[2]<0?s.div([],w,this.constants):[w[0],w[1],0])}projectRay(h){s.div(h,h,this.constants),s.normalize(h,h),s.mul$1(h,h,this.constants);const p=s.scale$2([],h,this.radius);if(p[2]>0){const w=s.scale$2([],[0,0,1],s.dot(p,[0,0,1])),E=s.scale$2([],s.normalize([],[p[0],p[1],0]),this.radius),I=s.add([],p,s.scale$2([],s.sub([],s.add([],E,w),p),2));p[0]=I[0],p[1]=I[1]}return p}}function xl(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Yu{constructor(h,p){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new of(h),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new df,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),s.bindAll(["handleEvent","handleWindowEvent"],this);const w=this._el;this._listeners=[[w,"touchstart",{passive:!0}],[w,"touchmove",{passive:!1}],[w,"touchend",void 0],[w,"touchcancel",void 0],[w,"mousedown",void 0],[w,"mousemove",void 0],[w,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[w,"mouseover",void 0],[w,"mouseout",void 0],[w,"dblclick",void 0],[w,"click",void 0],[w,"keydown",{capture:!1}],[w,"keyup",void 0],[w,"wheel",{passive:!1}],[w,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[E,I,B]of this._listeners)E.addEventListener(I,E===s.window.document?this.handleWindowEvent:this.handleEvent,B)}destroy(){for(const[h,p,w]of this._listeners)h.removeEventListener(p,h===s.window.document?this.handleWindowEvent:this.handleEvent,w)}_addDefaultHandlers(h){const p=this._map,w=p.getCanvasContainer();this._add("mapEvent",new Ig(p,h));const E=p.boxZoom=new Zh(p,h);this._add("boxZoom",E);const I=new lf,B=new Ba;p.doubleClickZoom=new Xs(B,I),this._add("tapZoom",I),this._add("clickZoom",B);const U=new Xp;this._add("tapDragZoom",U);const H=p.touchPitch=new Zp(p);this._add("touchPitch",H);const J=new cf(h),Y=new uf(h);p.dragRotate=new _a(h,J,Y),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);const oe=new jp(h),me=new qp(p,h);p.dragPan=new tu(w,oe,me),this._add("mousePan",oe),this._add("touchPan",me,["touchZoom","touchRotate"]);const be=new Yh,we=new Zu;p.touchZoomRotate=new Jh(w,we,be,U),this._add("touchRotate",be,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Pg(p));const Me=p.scrollZoom=new Io(p,this);this._add("scrollZoom",Me,["mousePan"]);const _e=p.keyboard=new Wi;this._add("keyboard",_e);for(const xe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])h.interactive&&h[xe]&&p[xe].enable(h[xe])}_add(h,p,w){this._handlers.push({handlerName:h,handler:p,allowed:w}),this._handlersById[h]=p}stop(h){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}}isActive(){for(const{handler:h}of this._handlers)if(h.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!dn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(h,p,w){for(const E in h)if(E!==w&&(!p||p.indexOf(E)<0))return!0;return!1}handleWindowEvent(h){this.handleEvent(h,`${h.type}Window`)}_getMapTouches(h){const p=[];for(const w of h)this._el.contains(w.target)&&p.push(w);return p}handleEvent(h,p){this._updatingCamera=!0;const w=h.type==="renderFrame",E=w?void 0:h,I={needsRenderFrame:!1},B={},U={},H=h.touches?this._getMapTouches(h.touches):void 0,J=H?Q(this._el,H):w?void 0:j(this._el,h);for(const{handlerName:me,handler:be,allowed:we}of this._handlers){if(!be.isEnabled())continue;let Me;this._blockedByActive(U,we,me)?be.reset():be[p||h.type]&&(Me=be[p||h.type](h,J,H),this.mergeHandlerResult(I,B,Me,me,E),Me&&Me.needsRenderFrame&&this._triggerRenderFrame()),(Me||be.isActive())&&(U[me]=be)}const Y={};for(const me in this._previousActiveHandlers)U[me]||(Y[me]=E);this._previousActiveHandlers=U,(Object.keys(Y).length||xl(I))&&(this._changes.push([I,B,Y]),this._triggerRenderFrame()),(Object.keys(U).length||xl(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:oe}=I;oe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],oe(this._map))}mergeHandlerResult(h,p,w,E,I){if(!w)return;s.extend(h,w);const B={handlerName:E,originalEvent:w.originalEvent||I};w.zoomDelta!==void 0&&(p.zoom=B),w.panDelta!==void 0&&(p.drag=B),w.pitchDelta!==void 0&&(p.pitch=B),w.bearingDelta!==void 0&&(p.rotate=B)}_applyChanges(){const h={},p={},w={};for(const[E,I,B]of this._changes)E.panDelta&&(h.panDelta=(h.panDelta||new s.pointGeometry(0,0))._add(E.panDelta)),E.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(h.around=E.around),E.aroundCoord!==void 0&&(h.aroundCoord=E.aroundCoord),E.pinchAround!==void 0&&(h.pinchAround=E.pinchAround),E.noInertia&&(h.noInertia=E.noInertia),s.extend(p,I),s.extend(w,B);this._updateMapTransform(h,p,w),this._changes=[]}_updateMapTransform(h,p,w){const E=this._map,I=E.transform,B=ke=>[ke.x,ke.y,ke.z];if((ke=>{const Ce=this._eventsInProgress.drag;return Ce&&!this._handlersById[Ce.handlerName].isActive()})()&&!xl(h)){const ke=I.zoom;I.cameraElevationReference="sea",I.recenterOnTerrain(),I.cameraElevationReference="ground",ke!==I.zoom&&this._map._update(!0)}if(I._isCameraConstrained&&E._stop(!0),!xl(h))return void this._fireEvents(p,w,!0);let{panDelta:U,zoomDelta:H,bearingDelta:J,pitchDelta:Y,around:oe,aroundCoord:me,pinchAround:be}=h;I._isCameraConstrained&&(H>0&&(H=0),I._isCameraConstrained=!1),be!==void 0&&(oe=be),(ke=>p.drag&&!this._eventsInProgress.drag)()&&oe&&(this._dragOrigin=B(I.pointCoordinate3D(oe)),this._trackingEllipsoid.setup(I._camera.position,this._dragOrigin)),I.cameraElevationReference="sea",E._stop(!0),oe=oe||E.transform.centerPoint,J&&(I.bearing+=J),Y&&(I.pitch+=Y),I._updateCameraState();const we=[0,0,0];if(U)if(I.projection.name==="mercator"){const ke=this._trackingEllipsoid.projectRay(I.screenPointToMercatorRay(oe).dir),Ce=this._trackingEllipsoid.projectRay(I.screenPointToMercatorRay(oe.sub(U)).dir);we[0]=Ce[0]-ke[0],we[1]=Ce[1]-ke[1]}else{const ke=I.pointCoordinate(oe);if(I.projection.name==="globe"){U=U.rotate(-I.angle);const Ce=I._pixelsPerMercatorPixel/I.worldSize;we[0]=-U.x*s.mercatorScale(s.latFromMercatorY(ke.y))*Ce,we[1]=-U.y*s.mercatorScale(I.center.lat)*Ce}else{const Ce=I.pointCoordinate(oe.sub(U));ke&&Ce&&(we[0]=Ce.x-ke.x,we[1]=Ce.y-ke.y)}}const Me=I.zoom,_e=[0,0,0];if(H){const ke=B(me||I.pointCoordinate3D(oe)),Ce={dir:s.normalize([],s.sub([],ke,I._camera.position))};if(Ce.dir[2]<0){const Ue=I.zoomDeltaToMovement(ke,H);s.scale$2(_e,Ce.dir,Ue)}}const xe=s.add(we,we,_e);I._translateCameraConstrained(xe),H&&Math.abs(I.zoom-Me)>1e-4&&I.recenterOnTerrain(),I.cameraElevationReference="ground",this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(p,w,!0)}_fireEvents(h,p,w){const E=dn(this._eventsInProgress),I=dn(h),B={};for(const Y in h){const{originalEvent:oe}=h[Y];this._eventsInProgress[Y]||(B[`${Y}start`]=oe),this._eventsInProgress[Y]=h[Y]}!E&&I&&this._fireEvent("movestart",I.originalEvent);for(const Y in B)this._fireEvent(Y,B[Y]);I&&this._fireEvent("move",I.originalEvent);for(const Y in h){const{originalEvent:oe}=h[Y];this._fireEvent(Y,oe)}const U={};let H;for(const Y in this._eventsInProgress){const{handlerName:oe,originalEvent:me}=this._eventsInProgress[Y];this._handlersById[oe].isActive()||(delete this._eventsInProgress[Y],H=p[oe]||me,U[`${Y}end`]=H)}for(const Y in U)this._fireEvent(Y,U[Y]);const J=dn(this._eventsInProgress);if(w&&(E||I)&&!J){this._updatingCamera=!0;const Y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),oe=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;Y?(oe(Y.bearing||this._map.getBearing())&&(Y.bearing=0),this._map.easeTo(Y,{originalEvent:H})):(this._map.fire(new s.Event("moveend",{originalEvent:H})),oe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(h,p){this._map.fire(new s.Event(h,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(h=>{this._frameId=void 0,this.handleEvent(new Yp("renderFrame",{timeStamp:h})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ju="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Kh extends s.Evented{constructor(h,p){super(),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=p.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(h,p){return this.jumpTo({center:h},p)}panBy(h,p,w){return h=s.pointGeometry.convert(h).mult(-1),this.panTo(this.transform.center,s.extend({offset:h},p),w)}panTo(h,p,w){return this.easeTo(s.extend({center:h},p),w)}getZoom(){return this.transform.zoom}setZoom(h,p){return this.jumpTo({zoom:h},p),this}zoomTo(h,p,w){return this.easeTo(s.extend({zoom:h},p),w)}zoomIn(h,p){return this.zoomTo(this.getZoom()+1,h,p),this}zoomOut(h,p){return this.zoomTo(this.getZoom()-1,h,p),this}getBearing(){return this.transform.bearing}setBearing(h,p){return this.jumpTo({bearing:h},p),this}getPadding(){return this.transform.padding}setPadding(h,p){return this.jumpTo({padding:h},p),this}rotateTo(h,p,w){return this.easeTo(s.extend({bearing:h},p),w)}resetNorth(h,p){return this.rotateTo(0,s.extend({duration:1e3},h),p),this}resetNorthPitch(h,p){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},h),p),this}snapToNorth(h,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,p):this}getPitch(){return this.transform.pitch}setPitch(h,p){return this.jumpTo({pitch:h},p),this}cameraForBounds(h,p){h=s.LngLatBounds.convert(h);const w=p&&p.bearing||0,E=p&&p.pitch||0,I=h.getNorthWest(),B=h.getSouthEast();return this._cameraForBounds(this.transform,I,B,w,E,p)}_extendCameraOptions(h){const p={top:0,bottom:0,right:0,left:0};if(typeof(h=s.extend({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const w=h.padding;h.padding={top:w,bottom:w,right:w,left:w}}return h.padding=s.extend(p,h.padding),h}_minimumAABBFrustumDistance(h,p){const w=p.max[0]-p.min[0],E=p.max[1]-p.min[1];return w/E>h.aspect?w/(2*Math.tan(.5*h.fovX)*h.aspect):E/(2*Math.tan(.5*h.fovY)*h.aspect)}_cameraForBoundsOnGlobe(h,p,w,E,I,B){const U=h.clone(),H=this._extendCameraOptions(B);U.bearing=E,U.pitch=I;const J=s.LngLat.convert(p),Y=s.LngLat.convert(w),oe=.5*(J.lat+Y.lat),me=.5*(J.lng+Y.lng),be=s.latLngToECEF(oe,me),we=s.normalize([],be),Me=s.normalize([],s.cross([],we,[0,1,0])),_e=s.cross([],Me,we),xe=[Me[0],Me[1],Me[2],0,_e[0],_e[1],_e[2],0,we[0],we[1],we[2],0,0,0,0,1],ke=[be,s.latLngToECEF(J.lat,J.lng),s.latLngToECEF(Y.lat,J.lng),s.latLngToECEF(Y.lat,Y.lng),s.latLngToECEF(J.lat,Y.lng),s.latLngToECEF(oe,J.lng),s.latLngToECEF(oe,Y.lng),s.latLngToECEF(J.lat,me),s.latLngToECEF(Y.lat,me)];let Ce=s.Aabb.fromPoints(ke.map(Ye=>[s.dot(Me,Ye),s.dot(_e,Ye),s.dot(we,Ye)]));const Ue=s.transformMat4([],Ce.center,xe);s.squaredLength(Ue)===0&&s.set(Ue,0,0,1),s.normalize(Ue,Ue),s.scale$2(Ue,Ue,s.GLOBE_RADIUS),U.center=s.ecefToLatLng(Ue);const Ze=U.getWorldToCameraMatrix(),qe=s.invert(new Float64Array(16),Ze);Ce=s.Aabb.applyTransform(Ce,s.multiply([],Ze,xe)),s.transformMat4(Ue,Ue,Ze);const tt=.5*(Ce.max[2]-Ce.min[2]),ft=this._minimumAABBFrustumDistance(U,Ce),lt=s.scale$2([],[0,0,1],tt),it=s.add(lt,Ue,lt),Gt=ft+(U.pitch===0?0:s.distance(Ue,it)),ot=U.globeCenterInViewSpace,bt=s.sub([],Ue,[ot[0],ot[1],ot[2]]);s.normalize(bt,bt),s.scale$2(bt,bt,Gt);const mt=s.add([],Ue,bt);s.transformMat4(mt,mt,qe);const Ut=s.earthRadius/s.GLOBE_RADIUS,gt=s.length(mt),kt=s.mercatorZfromAltitude(gt*Ut-s.earthRadius,0),Dt=Math.min(U.zoomFromMercatorZAdjusted(kt),H.maxZoom);return Dt>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(U.setProjection({name:"mercator"}),U.zoom=Dt,this._cameraForBounds(U,p,w,E,I,B)):{center:U.center,zoom:Dt,bearing:E,pitch:I}}queryTerrainElevation(h,p){const w=this.transform.elevation;return w?(p=s.extend({},{exaggerated:!0},p),w.getAtPoint(s.MercatorCoordinate.fromLngLat(h),null,p.exaggerated)):null}_cameraForBounds(h,p,w,E,I,B){if(h.projection.name==="globe")return this._cameraForBoundsOnGlobe(h,p,w,E,I,B);const U=h.clone(),H=this._extendCameraOptions(B),J=U.padding;U.bearing=E,U.pitch=I;const Y=s.LngLat.convert(p),oe=s.LngLat.convert(w),me=new s.LngLat(Y.lng,oe.lat),be=new s.LngLat(oe.lng,Y.lat),we=U.project(Y),Me=U.project(oe),_e=this.queryTerrainElevation(Y),xe=this.queryTerrainElevation(oe),ke=this.queryTerrainElevation(me),Ce=this.queryTerrainElevation(be),Ue=[[we.x,we.y,Math.min(_e||0,xe||0,ke||0,Ce||0)],[Me.x,Me.y,Math.max(_e||0,xe||0,ke||0,Ce||0)]];let Ze=s.Aabb.fromPoints(Ue);const qe=U.getWorldToCameraMatrix(),tt=s.invert(new Float64Array(16),qe);Ze=s.Aabb.applyTransform(Ze,qe);const ft=s.sub([],Ze.max,Ze.min),lt=J.left||0,it=J.right||0,Gt=J.bottom||0,ot=J.top||0,{left:bt,right:mt,top:Ut,bottom:gt}=H.padding,kt=.5*(lt+it),Dt=.5*(ot+Gt),Ye=Math.min(U.scaleZoom(U.scale*Math.min((U.width-(lt+it+bt+mt))/ft[0],(U.height-(Gt+ot+gt+Ut))/ft[1])),H.maxZoom),at=U.scale/U.zoomScale(Ye);Ze=new s.Aabb([Ze.min[0]-(bt+kt)*at,Ze.min[1]-(gt+Dt)*at,Ze.min[2]],[Ze.max[0]+(mt+kt)*at,Ze.max[1]+(Ut+Dt)*at,Ze.max[2]]);const Qt=.5*ft[2],mn=this._minimumAABBFrustumDistance(U,Ze),cn=[0,0,1,0];s.transformMat4$1(cn,cn,qe),s.normalize$2(cn,cn);const Fn=s.scale$2([],cn,mn+Qt),Rn=s.add([],Ze.center,Fn),Cn=(typeof H.offset.x=="number"&&typeof H.offset.y=="number"?new s.pointGeometry(H.offset.x,H.offset.y):s.pointGeometry.convert(H.offset)).rotate(-s.degToRad(E));Ze.center[0]-=Cn.x*at,Ze.center[1]+=Cn.y*at,s.transformMat4(Ze.center,Ze.center,tt),s.transformMat4(Rn,Rn,tt);const an=[Ze.center[0],Ze.center[1],Rn[2]*U.pixelsPerMeter];s.scale$2(an,an,1/U.worldSize);const ki=s.lngFromMercatorX(an[0]),bi=s.latFromMercatorY(an[1]),Di=Math.min(U._zoomFromMercatorZ(an[2]),H.maxZoom),si=new s.LngLat(ki,bi);return U.mercatorFromTransition&&Di<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(U.setProjection({name:"globe"}),U.zoom=Di,this._cameraForBounds(U,p,w,E,I,B)):{center:si,zoom:Di,bearing:E,pitch:I}}fitBounds(h,p,w){const E=this.cameraForBounds(h,p);return this._fitInternal(E,p,w)}fitScreenCoordinates(h,p,w,E,I){const B=s.pointGeometry.convert(h),U=s.pointGeometry.convert(p),H=new s.pointGeometry(Math.min(B.x,U.x),Math.min(B.y,U.y)),J=new s.pointGeometry(Math.max(B.x,U.x),Math.max(B.y,U.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(B,U))return this;const Y=this.transform.pointLocation3D(H),oe=this.transform.pointLocation3D(J),me=this.transform.pointLocation3D(new s.pointGeometry(H.x,J.y)),be=this.transform.pointLocation3D(new s.pointGeometry(J.x,H.y)),we=[Math.min(Y.lng,oe.lng,me.lng,be.lng),Math.min(Y.lat,oe.lat,me.lat,be.lat)],Me=[Math.max(Y.lng,oe.lng,me.lng,be.lng),Math.max(Y.lat,oe.lat,me.lat,be.lat)],_e=E&&E.pitch?E.pitch:this.getPitch(),xe=this._cameraForBounds(this.transform,we,Me,w,_e,E);return this._fitInternal(xe,E,I)}_fitInternal(h,p,w){return h?(delete(p=s.extend(h,p)).padding,p.linear?this.easeTo(p,w):this.flyTo(p,w)):this}jumpTo(h,p){this.stop();const w=h.preloadOnly?this.transform.clone():this.transform;let E=!1,I=!1,B=!1;return"zoom"in h&&w.zoom!==+h.zoom&&(E=!0,w.zoom=+h.zoom),h.center!==void 0&&(w.center=s.LngLat.convert(h.center)),"bearing"in h&&w.bearing!==+h.bearing&&(I=!0,w.bearing=+h.bearing),"pitch"in h&&w.pitch!==+h.pitch&&(B=!0,w.pitch=+h.pitch),h.padding==null||w.isPaddingEqual(h.padding)||(w.padding=h.padding),h.preloadOnly?(this._preloadTiles(w),this):(this.fire(new s.Event("movestart",p)).fire(new s.Event("move",p)),E&&this.fire(new s.Event("zoomstart",p)).fire(new s.Event("zoom",p)).fire(new s.Event("zoomend",p)),I&&this.fire(new s.Event("rotatestart",p)).fire(new s.Event("rotate",p)).fire(new s.Event("rotateend",p)),B&&this.fire(new s.Event("pitchstart",p)).fire(new s.Event("pitch",p)).fire(new s.Event("pitchend",p)),this.fire(new s.Event("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Ju),this.transform.getFreeCameraOptions()}setFreeCameraOptions(h,p){const w=this.transform;if(!w.projection.supportsFreeCamera)return s.warnOnce(Ju),this;this.stop();const E=w.zoom,I=w.pitch,B=w.bearing;w.setFreeCameraOptions(h);const U=E!==w.zoom,H=I!==w.pitch,J=B!==w.bearing;return this.fire(new s.Event("movestart",p)).fire(new s.Event("move",p)),U&&this.fire(new s.Event("zoomstart",p)).fire(new s.Event("zoom",p)).fire(new s.Event("zoomend",p)),J&&this.fire(new s.Event("rotatestart",p)).fire(new s.Event("rotate",p)).fire(new s.Event("rotateend",p)),H&&this.fire(new s.Event("pitchstart",p)).fire(new s.Event("pitch",p)).fire(new s.Event("pitchend",p)),this.fire(new s.Event("moveend",p)),this}easeTo(h,p){this._stop(!1,h.easeId),((h=s.extend({offset:[0,0],duration:500,easing:s.ease},h)).animate===!1||!h.essential&&s.exported.prefersReducedMotion)&&(h.duration=0);const w=this.transform,E=this.getZoom(),I=this.getBearing(),B=this.getPitch(),U=this.getPadding(),H="zoom"in h?+h.zoom:E,J="bearing"in h?this._normalizeBearing(h.bearing,I):I,Y="pitch"in h?+h.pitch:B,oe="padding"in h?h.padding:w.padding,me=s.pointGeometry.convert(h.offset);let be,we,Me;if(w.projection.name==="globe"){const lt=s.MercatorCoordinate.fromLngLat(w.center),it=me.rotate(-w.angle);lt.x+=it.x/w.worldSize,lt.y+=it.y/w.worldSize;const Gt=lt.toLngLat(),ot=s.LngLat.convert(h.center||Gt);this._normalizeCenter(ot),be=w.centerPoint.add(it),we=new s.pointGeometry(lt.x,lt.y).mult(w.worldSize),Me=new s.pointGeometry(s.mercatorXfromLng(ot.lng),s.mercatorYfromLat(ot.lat)).mult(w.worldSize).sub(we)}else{be=w.centerPoint.add(me);const lt=w.pointLocation(be),it=s.LngLat.convert(h.center||lt);this._normalizeCenter(it),we=w.project(lt),Me=w.project(it).sub(we)}const _e=w.zoomScale(H-E);let xe,ke;h.around&&(xe=s.LngLat.convert(h.around),ke=w.locationPoint(xe));const Ce=this._zooming||H!==E,Ue=this._rotating||I!==J,Ze=this._pitching||Y!==B,qe=!w.isPaddingEqual(oe),tt=lt=>it=>{if(Ce&&(lt.zoom=s.number(E,H,it)),Ue&&(lt.bearing=s.number(I,J,it)),Ze&&(lt.pitch=s.number(B,Y,it)),qe&&(lt.interpolatePadding(U,oe,it),be=lt.centerPoint.add(me)),xe)lt.setLocationAtPoint(xe,ke);else{const Gt=lt.zoomScale(lt.zoom-E),ot=H>E?Math.min(2,_e):Math.max(.5,_e),bt=Math.pow(ot,1-it),mt=lt.unproject(we.add(Me.mult(it*bt)).mult(Gt));lt.setLocationAtPoint(lt.renderWorldCopies?mt.wrap():mt,be)}return h.preloadOnly||this._fireMoveEvents(p),lt};if(h.preloadOnly){const lt=this._emulate(tt,h.duration,w);return this._preloadTiles(lt),this}const ft={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ce,this._rotating=Ue,this._pitching=Ze,this._padding=qe,this._easeId=h.easeId,this._prepareEase(p,h.noMoveStart,ft),this._ease(tt(w),lt=>{w.recenterOnTerrain(),this._afterEase(p,lt)},h),this}_prepareEase(h,p,w={}){this._moving=!0,this.transform.cameraElevationReference="sea",p||w.moving||this.fire(new s.Event("movestart",h)),this._zooming&&!w.zooming&&this.fire(new s.Event("zoomstart",h)),this._rotating&&!w.rotating&&this.fire(new s.Event("rotatestart",h)),this._pitching&&!w.pitching&&this.fire(new s.Event("pitchstart",h))}_fireMoveEvents(h){this.fire(new s.Event("move",h)),this._zooming&&this.fire(new s.Event("zoom",h)),this._rotating&&this.fire(new s.Event("rotate",h)),this._pitching&&this.fire(new s.Event("pitch",h))}_afterEase(h,p){if(this._easeId&&p&&this._easeId===p)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const w=this._zooming,E=this._rotating,I=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new s.Event("zoomend",h)),E&&this.fire(new s.Event("rotateend",h)),I&&this.fire(new s.Event("pitchend",h)),this.fire(new s.Event("moveend",h))}flyTo(h,p){if(!h.essential&&s.exported.prefersReducedMotion){const Ye=s.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ye,p)}this.stop(),h=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},h);const w=this.transform,E=this.getZoom(),I=this.getBearing(),B=this.getPitch(),U=this.getPadding(),H="zoom"in h?s.clamp(+h.zoom,w.minZoom,w.maxZoom):E,J="bearing"in h?this._normalizeBearing(h.bearing,I):I,Y="pitch"in h?+h.pitch:B,oe="padding"in h?h.padding:w.padding,me=w.zoomScale(H-E),be=s.pointGeometry.convert(h.offset);let we=w.centerPoint.add(be);const Me=w.pointLocation(we),_e=s.LngLat.convert(h.center||Me);this._normalizeCenter(_e);const xe=w.project(Me),ke=w.project(_e).sub(xe);let Ce=h.curve;const Ue=Math.max(w.width,w.height),Ze=Ue/me,qe=ke.mag();if("minZoom"in h){const Ye=s.clamp(Math.min(h.minZoom,E,H),w.minZoom,w.maxZoom),at=Ue/w.zoomScale(Ye-E);Ce=Math.sqrt(at/qe*2)}const tt=Ce*Ce;function ft(Ye){const at=(Ze*Ze-Ue*Ue+(Ye?-1:1)*tt*tt*qe*qe)/(2*(Ye?Ze:Ue)*tt*qe);return Math.log(Math.sqrt(at*at+1)-at)}function lt(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function it(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const Gt=ft(0);let ot=function(Ye){return it(Gt)/it(Gt+Ce*Ye)},bt=function(Ye){return Ue*((it(Gt)*(lt(at=Gt+Ce*Ye)/it(at))-lt(Gt))/tt)/qe;var at},mt=(ft(1)-Gt)/Ce;if(Math.abs(qe)<1e-6||!isFinite(mt)){if(Math.abs(Ue-Ze)<1e-6)return this.easeTo(h,p);const Ye=Ze<Ue?-1:1;mt=Math.abs(Math.log(Ze/Ue))/Ce,bt=function(){return 0},ot=function(at){return Math.exp(Ye*Ce*at)}}h.duration="duration"in h?+h.duration:1e3*mt/("screenSpeed"in h?+h.screenSpeed/Ce:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0);const Ut=I!==J,gt=Y!==B,kt=!w.isPaddingEqual(oe),Dt=Ye=>at=>{const Qt=at*mt,mn=1/ot(Qt);Ye.zoom=at===1?H:E+Ye.scaleZoom(mn),Ut&&(Ye.bearing=s.number(I,J,at)),gt&&(Ye.pitch=s.number(B,Y,at)),kt&&(Ye.interpolatePadding(U,oe,at),we=Ye.centerPoint.add(be));const cn=at===1?_e:Ye.unproject(xe.add(ke.mult(bt(Qt))).mult(mn));return Ye.setLocationAtPoint(Ye.renderWorldCopies?cn.wrap():cn,we),Ye._updateCameraOnTerrain(),h.preloadOnly||this._fireMoveEvents(p),Ye};if(h.preloadOnly){const Ye=this._emulate(Dt,h.duration,w);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=Ut,this._pitching=gt,this._padding=kt,this._prepareEase(p,!1),this._ease(Dt(w),()=>this._afterEase(p),h),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(h,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const w=this._onEaseEnd;this._onEaseEnd=void 0,w.call(this,p)}if(!h){const w=this.handlers;w&&w.stop(!1)}return this}_ease(h,p,w){w.animate===!1||w.duration===0?(h(1),p()):(this._easeStart=s.exported.now(),this._easeOptions=w,this._onEaseFrame=h,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const h=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),p=this._onEaseFrame;p&&p(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(h,p){h=s.wrap(h,-180,180);const w=Math.abs(h-p);return Math.abs(h-360-p)<w&&(h-=360),Math.abs(h+360-p)<w&&(h+=360),h}_normalizeCenter(h){const p=this.transform;if(!p.renderWorldCopies||p.maxBounds)return;const w=h.lng-p.center.lng;h.lng+=w>180?-360:w<-180?360:0}_emulate(h,p,w){const E=Math.ceil(15*p/1e3),I=[],B=h(w.clone());for(let U=0;U<=E;U++){const H=B(U/E);I.push(H.clone())}return I}}class ff{constructor(h={}){this.options=h,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(h){const p=this.options&&this.options.compact;return this._map=h,this._container=T("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=T("button","mapboxgl-ctrl-attrib-button",this._container),T("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=T("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(h,p){const w=this._map._getUIString(`AttributionControl.${p}`);h.setAttribute("aria-label",w),h.removeAttribute("title"),h.firstElementChild&&h.firstElementChild.setAttribute("title",w)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(h){const w=p.reduce((E,I,B)=>(I.value&&(E+=`${I.key}=${I.value}${B<p.length-1?"&":""}`),E),"?");h.href=`${s.config.FEEDBACK_URL}/${w}#${Co(this._map,!0)}`,h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}}_updateData(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let h=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const p=this._map.style._sourceCaches;for(const E in p){const I=p[E];if(I.used){const B=I.getSource();B.attribution&&h.indexOf(B.attribution)<0&&h.push(B.attribution)}}h.sort((E,I)=>E.length-I.length),h=h.filter((E,I)=>{for(let B=I+1;B<h.length;B++)if(h[B].indexOf(E)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=[...this.options.customAttribution,...h]:h.unshift(this.options.customAttribution));const w=h.join(" | ");w!==this._attribHTML&&(this._attribHTML=w,h.length?(this._innerContainer.innerHTML=w,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Qh{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(h){this._map=h,this._container=T("div","mapboxgl-ctrl");const p=T("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const h=this._map.style._sourceCaches;if(Object.entries(h).length===0)return!0;for(const p in h){const w=h[p].getSource();if(w.hasOwnProperty("mapbox_logo")&&!w.mapbox_logo)return!1}return!0}_updateCompact(){const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class pf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(h){const p=++this._id;return this._queue.push({callback:h,id:p,cancelled:!1}),p}remove(h){const p=this._currentlyRunning,w=p?this._queue.concat(p):this._queue;for(const E of w)if(E.id===h)return void(E.cancelled=!0)}run(h=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const w of p)if(!w.cancelled&&(w.callback(h),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function mf(y,h,p){if(y=new s.LngLat(y.lng,y.lat),h){const w=new s.LngLat(y.lng-360,y.lat),E=new s.LngLat(y.lng+360,y.lat),I=360*Math.ceil(Math.abs(y.lng-p.center.lng)/360),B=p.locationPoint(y).distSqr(h),U=h.x<0||h.y<0||h.x>p.width||h.y>p.height;p.locationPoint(w).distSqr(h)<B&&(U||Math.abs(w.lng-p.center.lng)<I)?y=w:p.locationPoint(E).distSqr(h)<B&&(U||Math.abs(E.lng-p.center.lng)<I)&&(y=E)}for(;Math.abs(y.lng-p.center.lng)>180;){const w=p.locationPoint(y);if(w.x>=0&&w.y>=0&&w.x<=p.width&&w.y<=p.height)break;y.lng>p.center.lng?y.lng-=360:y.lng+=360}return y}const vl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ku extends s.Evented{constructor(h,p){if(super(),(h instanceof s.window.HTMLElement||p)&&(h=s.extend({element:h},p)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=h&&h.occludedOpacity||.2,h&&h.element)this._element=h.element,this._offset=s.pointGeometry.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=T("div");const E=41,I=27,B=C("svg",{display:"block",height:E*this._scale+"px",width:I*this._scale+"px",viewBox:`0 0 ${I} ${E}`},this._element),U=C("radialGradient",{id:"shadowGradient"},C("defs",{},B));C("stop",{offset:"10%","stop-opacity":.4},U),C("stop",{offset:"100%","stop-opacity":.05},U),C("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},B),C("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},B),C("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},B),C("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},B),this._offset=s.pointGeometry.convert(h&&h.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",E=>{E.preventDefault()}),this._element.addEventListener("mousedown",E=>{E.preventDefault()});const w=this._element.classList;for(const E in vl)w.remove(`mapboxgl-marker-anchor-${E}`);w.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(h){return h===this._map||(this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._updateMoving),h.on("moveend",this._update),h.on("remove",this._clearFadeTimer),h._addMarker(this),this.setDraggable(this._draggable),this._update(),h.on("click",this._onMapClick)),this}remove(){const h=this._map;return h&&(h.off("click",this._onMapClick),h.off("move",this._updateMoving),h.off("moveend",this._update),h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler),h.off("mouseup",this._onUp),h.off("touchend",this._onUp),h.off("mousemove",this._onMove),h.off("touchmove",this._onMove),h.off("remove",this._clearFadeTimer),h._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=s.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=h,h._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(h){const p=h.code,w=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&w!==32&&w!==13||this.togglePopup()}_onMapClick(h){const p=h.originalEvent.target,w=this._element;this._popup&&(p===w||w.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const h=this._popup;return h?(h.isOpen()?(h.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(h.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const h=this._map,p=this._pos;if(!h||!p)return!1;const w=h.unproject(p),E=h.getFreeCameraOptions();if(!E.position)return!1;const I=E.position.toLngLat();return I.distanceTo(w)<.9*I.distanceTo(this._lngLat)}_evaluateOpacity(){const h=this._map;if(!h)return;const p=this._pos;if(!p||p.x<0||p.x>h.transform.width||p.y<0||p.y>h.transform.height)return void this._clearFadeTimer();const w=h.unproject(p);let E;h._showingGlobe()&&s.isLngLatBehindGlobe(h.transform,this._lngLat)?E=0:(E=1-h._queryFogOpacity(w),h.transform._terrainEnabled()&&h.getTerrain()&&this._behindTerrain()&&(E*=this._occludedOpacity)),this._element.style.opacity=`${E}`,this._element.style.pointerEvents=E>0?"auto":"none",this._popup&&this._popup._setOpacity(E),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const h=this._pos;if(!h||!this._map)return;const p=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${h.x}px,${h.y}px)
            ${vl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${p.x}px,${p.y}px)
        `}_calculateXYTransform(){const h=this._pos,p=this._map,w=this.getPitchAlignment();if(!p||!h||w!=="map")return"";if(!p._showingGlobe()){const H=p.getPitch();return H?`rotateX(${H}deg)`:""}const E=s.radToDeg(s.globeTiltAtLngLat(p.transform,this._lngLat)),I=h.sub(s.globeCenterToScreenPoint(p.transform)),B=Math.abs(I.x)+Math.abs(I.y);if(B===0)return"";const U=E/B;return`rotateX(${-I.y*U}deg) rotateY(${I.x*U}deg)`}_calculateZTransform(){const h=this._pos,p=this._map;if(!p||!h)return"";let w=0;const E=this.getRotationAlignment();if(E==="map")if(p._showingGlobe()){const I=p.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),B=p.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(I);w=s.radToDeg(Math.atan2(B.y,B.x))-90}else w=-p.getBearing();else if(E==="horizon"){const I=s.smoothstep(4,6,p.getZoom()),B=s.globeCenterToScreenPoint(p.transform);B.y+=I*p.transform.height;const U=h.sub(B),H=s.radToDeg(Math.atan2(U.y,U.x));w=(H>90?H-270:H+90)*(1-I)}return w+=this._rotation,w?`rotateZ(${w}deg)`:""}_update(h){s.window.cancelAnimationFrame(this._updateFrameId);const p=this._map;p&&(p.transform.renderWorldCopies&&(this._lngLat=mf(this._lngLat,this._pos,p.transform)),this._pos=p.project(this._lngLat),h===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),p._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(p._showingGlobe()||p.getTerrain()||p.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(h){return this._offset=s.pointGeometry.convert(h),this._update(),this}_onMove(h){const p=this._map;if(!p)return;const w=this._pointerdownPos,E=this._positionDelta;if(w&&E){if(!this._isDragging){const I=this._clickTolerance||p._clickTolerance;if(h.point.dist(w)<I)return;this._isDragging=!0}this._pos=h.point.sub(E),this._lngLat=p.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const h=this._map;h&&(h.off("mousemove",this._onMove),h.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(h){const p=this._map,w=this._pos;p&&w&&this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(w),this._pointerdownPos=h.point,this._state="pending",p.on("mousemove",this._onMove),p.on("touchmove",this._onMove),p.once("mouseup",this._onUp),p.once("touchend",this._onUp))}setDraggable(h){this._draggable=!!h;const p=this._map;return p&&(h?(p.on("mousedown",this._addDragHandler),p.on("touchstart",this._addDragHandler)):(p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(h){return this._rotation=h||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(h){return this._rotationAlignment=h||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(h){return this._pitchAlignment=h||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(h){return this._occludedOpacity=h||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Qu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Jp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ya(y=new s.pointGeometry(0,0),h="bottom"){if(typeof y=="number"){const p=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(h){case"top":return new s.pointGeometry(0,y);case"top-left":return new s.pointGeometry(p,p);case"top-right":return new s.pointGeometry(-p,p);case"bottom":return new s.pointGeometry(0,-y);case"bottom-left":return new s.pointGeometry(p,-p);case"bottom-right":return new s.pointGeometry(-p,-p);case"left":return new s.pointGeometry(y,0);case"right":return new s.pointGeometry(-y,0)}return new s.pointGeometry(0,0)}return y instanceof s.pointGeometry||Array.isArray(y)?s.pointGeometry.convert(y):s.pointGeometry.convert(y[h]||[0,0])}class kg{constructor(h){this.jumpTo(h)}getValue(h){if(h<=this._startTime)return this._start;if(h>=this._endTime)return this._end;const p=s.easeCubicInOut((h-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(h){return h>=this._startTime&&h<=this._endTime}jumpTo(h){this._startTime=-1/0,this._endTime=-1/0,this._start=h,this._end=h}easeTo(h,p,w){this._start=this.getValue(p),this._end=h,this._startTime=p,this._endTime=p+w}}const Dg={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ed={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ec={showCompass:!0,showZoom:!0,visualizePitch:!1};class Lg{constructor(h,p,w=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new cf({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,w&&(this.mousePitch=new uf({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(h,p){this.mouseRotate.mousedown(h,p),this.mousePitch&&this.mousePitch.mousedown(h,p),O()}move(h,p){const w=this.map,E=this.mouseRotate.mousemoveWindow(h,p),I=E&&E.bearingDelta;if(I&&w.setBearing(w.getBearing()+I),this.mousePitch){const B=this.mousePitch.mousemoveWindow(h,p),U=B&&B.pitchDelta;U&&w.setPitch(w.getPitch()+U)}}off(){const h=this.element;h.removeEventListener("mousedown",this.mousedown),h.removeEventListener("touchstart",this.touchstart,{passive:!1}),h.removeEventListener("touchmove",this.touchmove),h.removeEventListener("touchend",this.touchend),h.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){F(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(h){this.down(s.extend({},h,{ctrlKey:!0,preventDefault:()=>h.preventDefault()}),j(this.element,h)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(h){this.move(h,j(this.element,h))}mouseup(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()}touchstart(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>h.preventDefault()},this._startPos))}touchmove(h){h.targetTouches.length!==1?this.reset():(this._lastPos=Q(this.element,h.targetTouches)[0],this.move({preventDefault:()=>h.preventDefault()},this._lastPos))}touchend(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const xn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},td={maxWidth:100,unit:"metric"};function gf(y,h,p){const w=_f(h),E=w/h,I={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[p];this._map._requestDomTask(()=>{this._container.style.width=y*E+"px",this._container.innerHTML=`${w}&nbsp;${I}`})}function _f(y){const h=Math.pow(10,`${Math.floor(y)}`.length-1);let p=y/h;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:p>=1?1:function(w){const E=Math.pow(10,Math.ceil(-Math.log(w)/Math.LN10));return Math.round(w*E)/E}(p),h*p}const nd={version:s.version,supported:m,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Kh{constructor(y){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(y=s.extend({},ed,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(y.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ql(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),y),this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._optimizeForTerrain=y.optimizeForTerrain,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new pf,this._domRenderTaskQueue=new pf,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Dg,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new kg(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,typeof y.container=="string"){if(this._container=s.window.document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Yu(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),this._hash=y.hash&&new hn(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,s.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),y.attributionControl&&this.addControl(new ff({customAttribution:y.customAttribution})),this._logoControl=new Qh,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new s.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new s.Event(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(y,h){if(h===void 0&&(h=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=y.onAdd(this);this._controls.push(y);const w=this._controlPositions[h];return h.indexOf("bottom")!==-1?w.insertBefore(p,w.firstChild):w.appendChild(p),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const h=this._controls.indexOf(y);return h>-1&&this._controls.splice(h,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const h=!this._moving;return h&&this.fire(new s.Event("movestart",y)).fire(new s.Event("move",y)),this.fire(new s.Event("resize",y)),h&&this.fire(new s.Event("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(s.LngLatBounds.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?s.window.navigator.language:Array.isArray(y)?y.length===0?void 0:y.map(h=>h==="auto"?s.window.navigator.language:h):y}setLanguage(y){const h=this._parseLanguage(y);if(!this.style||h===this._language)return this;this._language=h,this.style._reloadSources();for(const p of this._controls)p._setLanguage&&p._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,h=y.projection.name;let p;h==="globe"&&y.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(y.setMercatorFromTransition(),p=!0):h==="mercator"&&y.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(y.setProjection({name:"globe"}),p=!0),p&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,h){return this._updateProjection(y||h||{name:"mercator"})}_updateProjection(y){let h;if(h=y.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),h){this.painter.clearBackgroundTiles();for(const p in this.style._sourceCaches)this.style._sourceCaches[p].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(y){return this.transform.locationPoint3D(s.LngLat.convert(y))}unproject(y){return this.transform.pointLocation3D(s.pointGeometry.convert(y))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,h,p){if(y==="mouseenter"||y==="mouseover"){let w=!1;const E=B=>{const U=h.filter(J=>this.getLayer(J)),H=U.length?this.queryRenderedFeatures(B.point,{layers:U}):[];H.length?w||(w=!0,p.call(this,new yo(y,this,B.originalEvent,{features:H}))):w=!1},I=()=>{w=!1};return{layers:new Set(h),listener:p,delegates:{mousemove:E,mouseout:I}}}if(y==="mouseleave"||y==="mouseout"){let w=!1;const E=B=>{const U=h.filter(H=>this.getLayer(H));(U.length?this.queryRenderedFeatures(B.point,{layers:U}):[]).length?w=!0:w&&(w=!1,p.call(this,new yo(y,this,B.originalEvent)))},I=B=>{w&&(w=!1,p.call(this,new yo(y,this,B.originalEvent)))};return{layers:new Set(h),listener:p,delegates:{mousemove:E,mouseout:I}}}{const w=E=>{const I=h.filter(U=>this.getLayer(U)),B=I.length?this.queryRenderedFeatures(E.point,{layers:I}):[];B.length&&(E.features=B,p.call(this,E),delete E.features)};return{layers:new Set(h),listener:p,delegates:{[y]:w}}}}on(y,h,p){if(p===void 0)return super.on(y,h);Array.isArray(h)||(h=[h]);const w=this._createDelegatedListener(y,h,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(w);for(const E in w.delegates)this.on(E,w.delegates[E]);return this}once(y,h,p){if(p===void 0)return super.once(y,h);Array.isArray(h)||(h=[h]);const w=this._createDelegatedListener(y,h,p);for(const E in w.delegates)this.once(E,w.delegates[E]);return this}off(y,h,p){if(p===void 0)return super.off(y,h);h=new Set(Array.isArray(h)?h:[h]);const w=(I,B)=>{if(I.size!==B.size)return!1;for(const U of I)if(!B.has(U))return!1;return!0},E=this._delegatedListeners?this._delegatedListeners[y]:void 0;return E&&(I=>{for(let B=0;B<I.length;B++){const U=I[B];if(U.listener===p&&w(U.layers,h)){for(const H in U.delegates)this.off(H,U.delegates[H]);return I.splice(B,1),this}}})(E),this}queryRenderedFeatures(y,h){return this.style?(h!==void 0||y===void 0||y instanceof s.pointGeometry||Array.isArray(y)||(h=y,y=void 0),this.style.queryRenderedFeatures(y=y||[[0,0],[this.transform.width,this.transform.height]],h=h||{},this.transform)):[]}querySourceFeatures(y,h){return this.style.querySourceFeatures(y,h)}setStyle(y,h){return(h=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},h)).diff!==!1&&h.localIdeographFontFamily===this._localIdeographFontFamily&&h.localFontFamily===this._localFontFamily&&this.style&&y?(this._diffStyle(y,h),this):(this._localIdeographFontFamily=h.localIdeographFontFamily,this._localFontFamily=h.localFontFamily,this._updateStyle(y,h))}_getUIString(y){const h=this._locale[y];if(h==null)throw new Error(`Missing UI string '${y}'`);return h}_updateStyle(y,h){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y&&(this.style=new Ts(this,h||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ts(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,h){if(typeof y=="string"){const p=this._requestManager.normalizeStyleURL(y),w=this._requestManager.transformRequest(p,s.ResourceType.Style);s.getJSON(w,(E,I)=>{E?this.fire(new s.ErrorEvent(E)):I&&this._updateDiff(I,h)})}else typeof y=="object"&&this._updateDiff(y,h)}_updateDiff(y,h){try{this.style.setState(y)&&this._update(!0)}catch(p){s.warnOnce(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(y,h)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(y,h){return this._lazyInitEmptyStyle(),this.style.addSource(y,h),this._update(!0)}isSourceLoaded(y){return!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){const y=this.style&&this.style._sourceCaches;for(const h in y){const p=y[h]._tiles;for(const w in p){const E=p[w];if(E.state!=="loaded"&&E.state!=="errored")return!1}}return!0}addSourceType(y,h,p){this._lazyInitEmptyStyle(),this.style.addSourceType(y,h,p)}removeSource(y){return this.style.removeSource(y),this._updateTerrain(),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,h,{pixelRatio:p=1,sdf:w=!1,stretchX:E,stretchY:I,content:B}={}){if(this._lazyInitEmptyStyle(),h instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&h instanceof s.window.ImageBitmap){const{width:U,height:H,data:J}=s.exported.getImageData(h);this.style.addImage(y,{data:new s.RGBAImage({width:U,height:H},J),pixelRatio:p,stretchX:E,stretchY:I,content:B,sdf:w,version:0})}else if(h.width===void 0||h.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:U,height:H}=h,J=h;this.style.addImage(y,{data:new s.RGBAImage({width:U,height:H},new Uint8Array(J.data)),pixelRatio:p,stretchX:E,stretchY:I,content:B,sdf:w,version:0,userImage:J}),J.onAdd&&J.onAdd(this,y)}}updateImage(y,h){const p=this.style.getImage(y);if(!p)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=h instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&h instanceof s.window.ImageBitmap?s.exported.getImageData(h):h,{width:E,height:I}=w;E!==void 0&&I!==void 0?E===p.data.width&&I===p.data.height?(p.data.replace(w.data,!(h instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&h instanceof s.window.ImageBitmap)),this.style.updateImage(y,p)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${E}, ${I})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,h){s.getImage(this._requestManager.transformRequest(y,s.ResourceType.Image),(p,w)=>{h(p,w instanceof s.window.HTMLImageElement?s.exported.getImageData(w):w)})}listImages(){return this.style.listImages()}addLayer(y,h){return this._lazyInitEmptyStyle(),this.style.addLayer(y,h),this._update(!0)}moveLayer(y,h){return this.style.moveLayer(y,h),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,h,p){return this.style.setLayerZoomRange(y,h,p),this._update(!0)}setFilter(y,h,p={}){return this.style.setFilter(y,h,p),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,h,p,w={}){return this.style.setPaintProperty(y,h,p,w),this._update(!0)}getPaintProperty(y,h){return this.style.getPaintProperty(y,h)}setLayoutProperty(y,h,p,w={}){return this.style.setLayoutProperty(y,h,p,w),this._update(!0)}getLayoutProperty(y,h){return this.style.getLayoutProperty(y,h)}setLight(y,h={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,h),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(y),this.transform):0}setFeatureState(y,h){return this.style.setFeatureState(y,h),this._update()}removeFeatureState(y,h){return this.style.removeFeatureState(y,h),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,h=this._container.getBoundingClientRect().height||300;let p,w,E,I=this._container;for(;I&&(!w||!E);){const B=s.window.getComputedStyle(I).transform;B&&B!=="none"&&(p=B.match(/matrix.*\((.+)\)/)[1].split(", "),p[0]&&p[0]!=="0"&&p[0]!=="1"&&(w=p[0]),p[3]&&p[3]!=="0"&&p[3]!=="1"&&(E=p[3])),I=I.parentElement}this._containerWidth=w?Math.abs(y/w):y,this._containerHeight=E?Math.abs(h/E):h}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=T("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const h=this._canvasContainer=T("div","mapboxgl-canvas-container",y);this._interactive&&h.classList.add("mapboxgl-interactive"),this._canvas=T("canvas","mapboxgl-canvas",h),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=T("div","mapboxgl-control-container",y),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{w[E]=T("div",`mapboxgl-ctrl-${E}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,h){const p=s.exported.devicePixelRatio||1;this._canvas.width=p*Math.ceil(y),this._canvas.height=p*Math.ceil(h),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${h}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const h=this._markers.indexOf(y);h!==-1&&this._markers.splice(h,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const h=this._popups.indexOf(y);h!==-1&&this._popups.splice(h,1)}_setupPainter(){const y=s.extend({},m.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),h=this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);h?(s.storeAuthState(h,!0),this.painter=new ef(h,this.transform),this.on("data",p=>{p.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(h)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let h;const p=this.painter.context.extTimerQuery,w=s.exported.now();if(this.listens("gpu-timing-frame")&&(h=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,h)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,H=this.transform.pitch,J=s.exported.now(),Y=new s.EvaluationParameters(U,{now:J,fadeDuration:E,pitch:H,transition:this.style.getTransition()});this.style.update(Y)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(w),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):I=this._updateAverageElevation(w),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),h){const U=s.exported.now()-w;p.endQueryEXT(p.TIME_ELAPSED_EXT,h),setTimeout(()=>{const H=p.getQueryObjectEXT(h,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(h),this.fire(new s.Event("gpu-timing-frame",{cpuTime:U,gpuTime:H})),s.window.performance.mark("frame-gpu",{startTime:w,detail:{gpuTime:H}})},50)}if(this.listens("gpu-timing-layer")){const U=this.painter.collectGpuTimers();setTimeout(()=>{const H=this.painter.queryGpuTimers(U);this.fire(new s.Event("gpu-timing-layer",{layerTimes:H}))},50)}if(this.listens("gpu-timing-deferred-render")){const U=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const H=this.painter.queryGpuTimeDeferredRender(U);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:H}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(B||this._repaint)this.triggerRepaint();else{const U=!this.isMoving()&&this.loaded();if(U&&(I=this._updateAverageElevation(w,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),U&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const h of this._markers)y&&!this.getRenderWorldCopies()&&(h._lngLat=h._lngLat.wrap()),h._update();for(const h of this._popups)!y||this.getRenderWorldCopies()||h._trackPointer||(h._lngLat=h._lngLat.wrap()),h._update()}_updateAverageElevation(y,h=!1){const p=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&p(0);if((h||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const w=this.transform.averageElevation;let E=this.transform.sampleAverageElevation(),I=!1;this.transform.elevation&&(I=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(E)?E=0:this._averageElevationLastSampledAt=y;const B=Math.abs(w-E);if(B>1){if(this._isInitialLoad||I)return this._averageElevation.jumpTo(E),p(E);this._averageElevation.easeTo(E,y,300)}else if(B>1e-4)return this._averageElevation.jumpTo(E),p(E)}return!!this._averageElevation.isEasing(y)&&p(this._averageElevation.getValue(y))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,y=>{if(y&&(y.message===s.AUTH_ERR_MSG||y.status===401)){const h=this.painter.context.gl;s.storeAuthState(h,!1),this._logoControl instanceof Qh&&this._logoControl._updateLogo(),h&&h.clear(h.DEPTH_BUFFER_BIT|h.COLOR_BUFFER_BIT|h.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),h=this.painter.getCanvasCopiesAndTimestamps();h.timeStamps.push(performance.now());const p=this.painter.context.gl,w=p.createFramebuffer();function E(I){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,I,0);const B=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,B),B}return p.bindFramebuffer(p.FRAMEBUFFER,w),this._canvasPixelComparison(E(y),h.canvasCopies.map(E),h.timeStamps)}_canvasPixelComparison(y,h,p){let w=p[1]-p[0];const E=y.length/4;for(let I=0;I<h.length;I++){const B=h[I];let U=0;for(let H=0;H<B.length;H+=4)B[H]===y[H]&&B[H+1]===y[H+1]&&B[H+2]===y[H+2]&&B[H+3]===y[H+3]&&(U+=1);w+=(p[I+2]-p[I+1])*(1-U/E)}return w}remove(){this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=s.exported.frame(h=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(h)}))}_preloadTiles(y){const h=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(h,(p,w)=>p._preloadTiles(y,w),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,y&&this._update())}_setCacheLimits(y,h){s.setCacheLimits(y,h)}get version(){return s.version}},NavigationControl:class{constructor(y){this.options=s.extend({},ec,y),this._container=T("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",h=>h.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",h=>{this._map&&this._map.zoomIn({},{originalEvent:h})}),T("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",h=>{this._map&&this._map.zoomOut({},{originalEvent:h})}),T("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",h=>{const p=this._map;p&&(this.options.visualizePitch?p.resetNorthPitch({},{originalEvent:h}):p.resetNorth({},{originalEvent:h}))}),this._compassIcon=T("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const h=y.getZoom(),p=h===y.getMaxZoom(),w=h===y.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=w,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",w.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=h)})}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lg(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,h){const p=T("button",y,this._container);return p.type="button",p.addEventListener("click",h),p}_setButtonTitle(y,h){if(!this._map)return;const p=this._map._getUIString(`NavigationControl.${h}`);y.setAttribute("aria-label",p),y.firstElementChild&&y.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends s.Evented{constructor(y){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},xn,y),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=yl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=T("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const h=(p=!!this.options.geolocation)=>{this._supportsGeolocation=p,y(p)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(p=>h(p.state!=="denied")).catch(()=>h()):h()}_isOutOfMapMaxBounds(y){const h=this._map.getMaxBounds(),p=y.coords;return!!h&&(p.longitude<h.getWest()||p.longitude>h.getEast()||p.latitude<h.getSouth()||p.latitude>h.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",y)),this._finish()}}_updateCamera(y){const h=new s.LngLat(y.coords.longitude,y.coords.latitude),p=y.coords.accuracy,w=this._map.getBearing(),E=s.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(p),E,{geolocateSource:!0})}_updateMarker(y){if(y){const h=new s.LngLat(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,h=s.mercatorZfromAltitude(1,y._center.lat)*y.worldSize,p=Math.ceil(2*this._accuracy*h);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",h),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=T("button","mapboxgl-ctrl-geolocate",this._container),T("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",h),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",h),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=T("div","mapboxgl-user-location"),this._dotElement.appendChild(T("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(T("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ku({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=T("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ku({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(h=>{h==="granted"&&y()}).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ff,ScaleControl:class{constructor(y){this.options=s.extend({},td,y),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=gf.bind(this)),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,h=this._map,p=h._containerHeight/2,w=h._containerWidth/2-y/2,E=h.unproject([w,p]),I=h.unproject([w+y,p]),B=E.distanceTo(I);if(this.options.unit==="imperial"){const U=3.2808*B;U>5280?this._setScale(y,U/5280,"mile"):this._setScale(y,U,"foot")}else this.options.unit==="nautical"?this._setScale(y,B/1852,"nautical-mile"):B>=1e3?this._setScale(y,B/1e3,"kilometer"):this._setScale(y,B,"meter")}_setScale(y,h,p){const w=_f(h),E=w/h;this._map._requestDomTask(()=>{this._container.style.width=y*E+"px",this._container.innerHTML=p!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:p}).format(w):`${w}&nbsp;nm`})}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=T("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y){this._fullscreen=!1,y&&y.container&&(y.container instanceof s.window.HTMLElement?this._container=y.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=T("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=T("button","mapboxgl-ctrl-fullscreen",this._controlContainer);T("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(y){super(),this.options=s.extend(Object.create(Qu),y),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=s.LngLat.convert(y),this._pos=null,this._trackPointer=!1,this._update();const h=this._map;return h&&(h.on("move",this._update),h.off("mousemove",this._onMouseEvent),h._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(s.window.document.createTextNode(y))}setHTML(y){const h=s.window.document.createDocumentFragment(),p=s.window.document.createElement("body");let w;for(p.innerHTML=y;w=p.firstChild,w;)h.appendChild(w);return this.setDOMContent(h)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let h=this._content;if(h)for(;h.hasChildNodes();)h.firstChild&&h.removeChild(h.firstChild);else h=this._content=T("div","mapboxgl-popup-content",this._container||void 0);if(h.appendChild(y),this.options.closeButton){const p=this._closeButton=T("button","mapboxgl-popup-close-button",h);p.type="button",p.setAttribute("aria-label","Close popup"),p.setAttribute("aria-hidden","true"),p.innerHTML="&#215;",p.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let h;return this._classList.delete(y)?h=!1:(this._classList.add(y),h=!0),this._updateClassList(),h}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const h=this._map,p=this._container,w=this._pos;if(!h||!p||!w)return"bottom";const E=p.offsetWidth,I=p.offsetHeight,B=w.x<E/2,U=w.x>h.transform.width-E/2;if(w.y+y<I)return B?"top-left":U?"top-right":"top";if(w.y>h.transform.height-I){if(B)return"bottom-left";if(U)return"bottom-right"}return B?"left":U?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const h=[...this._classList];h.push("mapboxgl-popup"),this._anchor&&h.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&h.push("mapboxgl-popup-track-pointer"),y.className=h.join(" ")}_update(y){const h=this._map,p=this._content;if(!h||!this._lngLat&&!this._trackPointer||!p)return;let w=this._container;if(w||(w=this._container=T("div","mapboxgl-popup",h.getContainer()),this._tip=T("div","mapboxgl-popup-tip",w),w.appendChild(p)),this.options.maxWidth&&w.style.maxWidth!==this.options.maxWidth&&(w.style.maxWidth=this.options.maxWidth),h.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=mf(this._lngLat,this._pos,h.transform)),!this._trackPointer||y){const E=this._pos=this._trackPointer&&y?y:h.project(this._lngLat),I=ya(this.options.offset),B=this._anchor=this._getAnchor(I.y),U=ya(this.options.offset,B),H=E.add(U).round();h._requestDomTask(()=>{this._container&&B&&(this._container.style.transform=`${vl[B]} translate(${H.x}px,${H.y}px)`)})}if(!this._marker&&h._showingGlobe()){const E=s.isLngLatBehindGlobe(h.transform,this._lngLat)?0:1;this._setOpacity(E)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Jp);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:Ku,Style:Ts,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:nf,Evented:s.Evented,config:s.config,prewarm:function(){gn().acquire(Kt)},clearPrewarmedResources:function(){const y=Xt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Kt),Xt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(y){s.config.ACCESS_TOKEN=y},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(y){s.config.API_URL=y},get workerCount(){return Yt.workerCount},set workerCount(y){Yt.workerCount=y},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){s.config.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){s.clearTileCache(y)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return nd});var l=r;return l})})(pK);const Qz=bC;function mK(){let n=$t.useRef(null),[e,t]=$t.useState(37.01223403257954),[i,r]=$t.useState(-1.0953775626377544);return $t.useEffect(()=>{Qz.accessToken="pk.eyJ1IjoidGhlcGFyYWRveDIwIiwiYSI6ImNsZHdlMnpyMTA2bGUzbnBob2Jld2l3NmUifQ.zrAEdfZdTfrWr9yvSuu9Xg";let a=new Qz.Map({container:n.current,style:"mapbox://styles/mapbox/streets-v11",center:[e,i],zoom:17});return()=>a.remove()},[]),gr("div",{ref:n,style:{width:"100%",height:"90%"}})}const gK="/assets/nakuja_logo-3b1c7d44.png";function _K({url:n}){console.log("video",n);const e=$t.useRef(null);let[t,i]=$t.useState(!0);return $t.useEffect(()=>{jU.to(e.current,{rotation:"+=360",scale:.5,repeat:-1,yoyo:!0,duration:.7,ease:"power2.inOut"})},[]),Ma(YW,{children:[Ma("div",{className:"choice",children:[gr("button",{id:t?"active":"",onClick:r=>{i(!0)},children:"Live Stream"}),gr("button",{id:t?"":"active",onClick:r=>{i(!1)},children:"Map"})]}),t?gr("div",{className:"w-full h-[297px] md:h-[603px] lg:h-[354px] bg-black flex justify-center items-center",children:gr("div",{ref:e,children:gr("img",{alt:"logo",src:gK,width:"90",height:"80"})})}):gr(mK,{})]})}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const NM="150",Cm={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Im={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ZU=0,SC=1,$U=2,yK=3,XU=0,UM=1,Gx=2,Bm=3,Gd=0,nl=1,Pd=2,xK=2,Rd=0,Jm=1,MC=2,TC=3,EC=4,YU=5,km=100,JU=101,KU=102,AC=103,CC=104,QU=200,e6=201,t6=202,n6=203,JP=204,KP=205,i6=206,r6=207,s6=208,o6=209,a6=210,l6=0,c6=1,u6=2,nM=3,h6=4,d6=5,f6=6,p6=7,a1=0,m6=1,g6=2,Au=0,_6=1,y6=2,x6=3,QP=4,v6=5,VM=300,vp=301,wp=302,bv=303,Sv=304,By=306,Mv=1e3,la=1001,Tv=1002,Ls=1003,iM=1004,vK=1004,Wx=1005,wK=1005,zs=1006,ek=1007,bK=1007,bp=1008,SK=1008,Wd=1009,w6=1010,b6=1011,tk=1012,S6=1013,Kf=1014,kd=1015,Ty=1016,M6=1017,T6=1018,Km=1020,E6=1021,$a=1023,A6=1024,C6=1025,dp=1026,hg=1027,I6=1028,P6=1029,k6=1030,D6=1031,L6=1033,nS=33776,iS=33777,rS=33778,sS=33779,IC=35840,PC=35841,kC=35842,DC=35843,R6=36196,LC=37492,RC=37496,zC=37808,OC=37809,FC=37810,BC=37811,NC=37812,UC=37813,VC=37814,GC=37815,WC=37816,HC=37817,jC=37818,qC=37819,ZC=37820,$C=37821,oS=36492,z6=36283,XC=36284,YC=36285,JC=36286,O6=2200,F6=2201,B6=2202,Ev=2300,Av=2301,aS=2302,Nm=2400,Um=2401,Cv=2402,GM=2500,nk=2501,MK=0,TK=1,EK=2,Hd=3e3,Ar=3001,N6=3200,U6=3201,Ip=0,V6=1,AK="",yu="srgb",Ey="srgb-linear",ik="display-p3",CK=0,lS=7680,IK=7681,PK=7682,kK=7683,DK=34055,LK=34056,RK=5386,zK=512,OK=513,FK=514,BK=515,NK=516,UK=517,VK=518,G6=519,Iv=35044,GK=35048,WK=35040,HK=35045,jK=35049,qK=35041,ZK=35046,$K=35050,XK=35042,YK="100",KC="300 es",rM=1035;class Mh{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const a=r.indexOf(t);a!==-1&&r.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let a=0,l=r.length;a<l;a++)r[a].call(this,e);e.target=null}}}const ta=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let eO=1234567;const Qm=Math.PI/180,Pv=180/Math.PI;function Rl(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ta[n&255]+ta[n>>8&255]+ta[n>>16&255]+ta[n>>24&255]+"-"+ta[e&255]+ta[e>>8&255]+"-"+ta[e>>16&15|64]+ta[e>>24&255]+"-"+ta[t&63|128]+ta[t>>8&255]+"-"+ta[t>>16&255]+ta[t>>24&255]+ta[i&255]+ta[i>>8&255]+ta[i>>16&255]+ta[i>>24&255]).toLowerCase()}function Os(n,e,t){return Math.max(e,Math.min(t,n))}function rk(n,e){return(n%e+e)%e}function JK(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function KK(n,e,t){return n!==e?(t-n)/(e-n):0}function Hx(n,e,t){return(1-t)*n+t*e}function QK(n,e,t,i){return Hx(n,e,1-Math.exp(-t*i))}function eQ(n,e=1){return e-Math.abs(rk(n,e*2)-e)}function tQ(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function nQ(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function iQ(n,e){return n+Math.floor(Math.random()*(e-n+1))}function rQ(n,e){return n+Math.random()*(e-n)}function sQ(n){return n*(.5-Math.random())}function oQ(n){n!==void 0&&(eO=n);let e=eO+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function aQ(n){return n*Qm}function lQ(n){return n*Pv}function QC(n){return(n&n-1)===0&&n!==0}function W6(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function H6(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function cQ(n,e,t,i,r){const a=Math.cos,l=Math.sin,s=a(t/2),d=l(t/2),m=a((e+i)/2),_=l((e+i)/2),S=a((e-i)/2),T=l((e-i)/2),C=a((i-e)/2),P=l((i-e)/2);switch(r){case"XYX":n.set(s*_,d*S,d*T,s*m);break;case"YZY":n.set(d*T,s*_,d*S,s*m);break;case"ZXZ":n.set(d*S,d*T,s*_,s*m);break;case"XZX":n.set(s*_,d*P,d*C,s*m);break;case"YXY":n.set(d*C,s*_,d*P,s*m);break;case"ZYZ":n.set(d*P,d*C,s*_,s*m);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Dd(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function kr(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const uQ={DEG2RAD:Qm,RAD2DEG:Pv,generateUUID:Rl,clamp:Os,euclideanModulo:rk,mapLinear:JK,inverseLerp:KK,lerp:Hx,damp:QK,pingpong:eQ,smoothstep:tQ,smootherstep:nQ,randInt:iQ,randFloat:rQ,randFloatSpread:sQ,seededRandom:oQ,degToRad:aQ,radToDeg:lQ,isPowerOfTwo:QC,ceilPowerOfTwo:W6,floorPowerOfTwo:H6,setQuaternionFromProperEuler:cQ,normalize:kr,denormalize:Dd};class Ht{constructor(e=0,t=0){Ht.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),a=this.x-e.x,l=this.y-e.y;return this.x=a*i-l*r+e.x,this.y=a*r+l*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class zo{constructor(){zo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,a,l,s,d,m){const _=this.elements;return _[0]=e,_[1]=r,_[2]=s,_[3]=t,_[4]=a,_[5]=d,_[6]=i,_[7]=l,_[8]=m,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,a=this.elements,l=i[0],s=i[3],d=i[6],m=i[1],_=i[4],S=i[7],T=i[2],C=i[5],P=i[8],k=r[0],R=r[3],O=r[6],F=r[1],N=r[4],G=r[7],j=r[2],Q=r[5],re=r[8];return a[0]=l*k+s*F+d*j,a[3]=l*R+s*N+d*Q,a[6]=l*O+s*G+d*re,a[1]=m*k+_*F+S*j,a[4]=m*R+_*N+S*Q,a[7]=m*O+_*G+S*re,a[2]=T*k+C*F+P*j,a[5]=T*R+C*N+P*Q,a[8]=T*O+C*G+P*re,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],a=e[3],l=e[4],s=e[5],d=e[6],m=e[7],_=e[8];return t*l*_-t*s*m-i*a*_+i*s*d+r*a*m-r*l*d}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],a=e[3],l=e[4],s=e[5],d=e[6],m=e[7],_=e[8],S=_*l-s*m,T=s*d-_*a,C=m*a-l*d,P=t*S+i*T+r*C;if(P===0)return this.set(0,0,0,0,0,0,0,0,0);const k=1/P;return e[0]=S*k,e[1]=(r*m-_*i)*k,e[2]=(s*i-r*l)*k,e[3]=T*k,e[4]=(_*t-r*d)*k,e[5]=(r*a-s*t)*k,e[6]=C*k,e[7]=(i*d-m*t)*k,e[8]=(l*t-i*a)*k,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,a,l,s){const d=Math.cos(a),m=Math.sin(a);return this.set(i*d,i*m,-i*(d*l+m*s)+l+e,-r*m,r*d,-r*(-m*l+d*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(iE.makeScale(e,t)),this}rotate(e){return this.premultiply(iE.makeRotation(-e)),this}translate(e,t){return this.premultiply(iE.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const iE=new zo;function j6(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const hQ={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function H_(n,e){return new hQ[n](e)}function kv(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}class da{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,a,l,s){let d=i[r+0],m=i[r+1],_=i[r+2],S=i[r+3];const T=a[l+0],C=a[l+1],P=a[l+2],k=a[l+3];if(s===0){e[t+0]=d,e[t+1]=m,e[t+2]=_,e[t+3]=S;return}if(s===1){e[t+0]=T,e[t+1]=C,e[t+2]=P,e[t+3]=k;return}if(S!==k||d!==T||m!==C||_!==P){let R=1-s;const O=d*T+m*C+_*P+S*k,F=O>=0?1:-1,N=1-O*O;if(N>Number.EPSILON){const j=Math.sqrt(N),Q=Math.atan2(j,O*F);R=Math.sin(R*Q)/j,s=Math.sin(s*Q)/j}const G=s*F;if(d=d*R+T*G,m=m*R+C*G,_=_*R+P*G,S=S*R+k*G,R===1-s){const j=1/Math.sqrt(d*d+m*m+_*_+S*S);d*=j,m*=j,_*=j,S*=j}}e[t]=d,e[t+1]=m,e[t+2]=_,e[t+3]=S}static multiplyQuaternionsFlat(e,t,i,r,a,l){const s=i[r],d=i[r+1],m=i[r+2],_=i[r+3],S=a[l],T=a[l+1],C=a[l+2],P=a[l+3];return e[t]=s*P+_*S+d*C-m*T,e[t+1]=d*P+_*T+m*S-s*C,e[t+2]=m*P+_*C+s*T-d*S,e[t+3]=_*P-s*S-d*T-m*C,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,a=e._z,l=e._order,s=Math.cos,d=Math.sin,m=s(i/2),_=s(r/2),S=s(a/2),T=d(i/2),C=d(r/2),P=d(a/2);switch(l){case"XYZ":this._x=T*_*S+m*C*P,this._y=m*C*S-T*_*P,this._z=m*_*P+T*C*S,this._w=m*_*S-T*C*P;break;case"YXZ":this._x=T*_*S+m*C*P,this._y=m*C*S-T*_*P,this._z=m*_*P-T*C*S,this._w=m*_*S+T*C*P;break;case"ZXY":this._x=T*_*S-m*C*P,this._y=m*C*S+T*_*P,this._z=m*_*P+T*C*S,this._w=m*_*S-T*C*P;break;case"ZYX":this._x=T*_*S-m*C*P,this._y=m*C*S+T*_*P,this._z=m*_*P-T*C*S,this._w=m*_*S+T*C*P;break;case"YZX":this._x=T*_*S+m*C*P,this._y=m*C*S+T*_*P,this._z=m*_*P-T*C*S,this._w=m*_*S-T*C*P;break;case"XZY":this._x=T*_*S-m*C*P,this._y=m*C*S-T*_*P,this._z=m*_*P+T*C*S,this._w=m*_*S+T*C*P;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],a=t[8],l=t[1],s=t[5],d=t[9],m=t[2],_=t[6],S=t[10],T=i+s+S;if(T>0){const C=.5/Math.sqrt(T+1);this._w=.25/C,this._x=(_-d)*C,this._y=(a-m)*C,this._z=(l-r)*C}else if(i>s&&i>S){const C=2*Math.sqrt(1+i-s-S);this._w=(_-d)/C,this._x=.25*C,this._y=(r+l)/C,this._z=(a+m)/C}else if(s>S){const C=2*Math.sqrt(1+s-i-S);this._w=(a-m)/C,this._x=(r+l)/C,this._y=.25*C,this._z=(d+_)/C}else{const C=2*Math.sqrt(1+S-i-s);this._w=(l-r)/C,this._x=(a+m)/C,this._y=(d+_)/C,this._z=.25*C}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Os(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,a=e._z,l=e._w,s=t._x,d=t._y,m=t._z,_=t._w;return this._x=i*_+l*s+r*m-a*d,this._y=r*_+l*d+a*s-i*m,this._z=a*_+l*m+i*d-r*s,this._w=l*_-i*s-r*d-a*m,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,a=this._z,l=this._w;let s=l*e._w+i*e._x+r*e._y+a*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=l,this._x=i,this._y=r,this._z=a,this;const d=1-s*s;if(d<=Number.EPSILON){const C=1-t;return this._w=C*l+t*this._w,this._x=C*i+t*this._x,this._y=C*r+t*this._y,this._z=C*a+t*this._z,this.normalize(),this._onChangeCallback(),this}const m=Math.sqrt(d),_=Math.atan2(m,s),S=Math.sin((1-t)*_)/m,T=Math.sin(t*_)/m;return this._w=l*S+this._w*T,this._x=i*S+this._x*T,this._y=r*S+this._y*T,this._z=a*S+this._z*T,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(a),i*Math.cos(a),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Fe{constructor(e=0,t=0,i=0){Fe.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(tO.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(tO.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*i+a[6]*r,this.y=a[1]*t+a[4]*i+a[7]*r,this.z=a[2]*t+a[5]*i+a[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,a=e.elements,l=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*i+a[8]*r+a[12])*l,this.y=(a[1]*t+a[5]*i+a[9]*r+a[13])*l,this.z=(a[2]*t+a[6]*i+a[10]*r+a[14])*l,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,a=e.x,l=e.y,s=e.z,d=e.w,m=d*t+l*r-s*i,_=d*i+s*t-a*r,S=d*r+a*i-l*t,T=-a*t-l*i-s*r;return this.x=m*d+T*-a+_*-s-S*-l,this.y=_*d+T*-l+S*-a-m*-s,this.z=S*d+T*-s+m*-l-_*-a,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r,this.y=a[1]*t+a[5]*i+a[9]*r,this.z=a[2]*t+a[6]*i+a[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,a=e.z,l=t.x,s=t.y,d=t.z;return this.x=r*d-a*s,this.y=a*l-i*d,this.z=i*s-r*l,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return rE.copy(this).projectOnVector(e),this.sub(rE)}reflect(e){return this.sub(rE.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Os(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const rE=new Fe,tO=new da;function oy(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function sE(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const dQ=new zo().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),fQ=new zo().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Qf=new Fe;function pQ(n){return n.convertSRGBToLinear(),Qf.set(n.r,n.g,n.b).applyMatrix3(fQ),n.setRGB(Qf.x,Qf.y,Qf.z)}function mQ(n){return Qf.set(n.r,n.g,n.b).applyMatrix3(dQ),n.setRGB(Qf.x,Qf.y,Qf.z).convertLinearToSRGB()}const gQ={[Ey]:n=>n,[yu]:n=>n.convertSRGBToLinear(),[ik]:pQ},_Q={[Ey]:n=>n,[yu]:n=>n.convertLinearToSRGB(),[ik]:mQ},ia={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return Ey},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=gQ[e],r=_Q[t];if(i===void 0||r===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}};let u_;class sk{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{u_===void 0&&(u_=kv("canvas")),u_.width=e.width,u_.height=e.height;const i=u_.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=u_}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=kv("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),a=r.data;for(let l=0;l<a.length;l++)a[l]=oy(a[l]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(oy(t[i]/255)*255):t[i]=oy(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Vm{constructor(e=null){this.isSource=!0,this.uuid=Rl(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let a;if(Array.isArray(r)){a=[];for(let l=0,s=r.length;l<s;l++)r[l].isDataTexture?a.push(oE(r[l].image)):a.push(oE(r[l]))}else a=oE(r);i.url=a}return t||(e.images[this.uuid]=i),i}}function oE(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?sk.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let yQ=0;class bs extends Mh{constructor(e=bs.DEFAULT_IMAGE,t=bs.DEFAULT_MAPPING,i=la,r=la,a=zs,l=bp,s=$a,d=Wd,m=bs.DEFAULT_ANISOTROPY,_=Hd){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:yQ++}),this.uuid=Rl(),this.name="",this.source=new Vm(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=a,this.minFilter=l,this.anisotropy=m,this.format=s,this.internalFormat=null,this.type=d,this.offset=new Ht(0,0),this.repeat=new Ht(1,1),this.center=new Ht(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new zo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=_,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==VM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Mv:e.x=e.x-Math.floor(e.x);break;case la:e.x=e.x<0?0:1;break;case Tv:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Mv:e.y=e.y-Math.floor(e.y);break;case la:e.y=e.y<0?0:1;break;case Tv:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}bs.DEFAULT_IMAGE=null;bs.DEFAULT_MAPPING=VM;bs.DEFAULT_ANISOTROPY=1;class br{constructor(e=0,t=0,i=0,r=1){br.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,a=this.w,l=e.elements;return this.x=l[0]*t+l[4]*i+l[8]*r+l[12]*a,this.y=l[1]*t+l[5]*i+l[9]*r+l[13]*a,this.z=l[2]*t+l[6]*i+l[10]*r+l[14]*a,this.w=l[3]*t+l[7]*i+l[11]*r+l[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,a;const d=e.elements,m=d[0],_=d[4],S=d[8],T=d[1],C=d[5],P=d[9],k=d[2],R=d[6],O=d[10];if(Math.abs(_-T)<.01&&Math.abs(S-k)<.01&&Math.abs(P-R)<.01){if(Math.abs(_+T)<.1&&Math.abs(S+k)<.1&&Math.abs(P+R)<.1&&Math.abs(m+C+O-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const N=(m+1)/2,G=(C+1)/2,j=(O+1)/2,Q=(_+T)/4,re=(S+k)/4,$=(P+R)/4;return N>G&&N>j?N<.01?(i=0,r=.707106781,a=.707106781):(i=Math.sqrt(N),r=Q/i,a=re/i):G>j?G<.01?(i=.707106781,r=0,a=.707106781):(r=Math.sqrt(G),i=Q/r,a=$/r):j<.01?(i=.707106781,r=.707106781,a=0):(a=Math.sqrt(j),i=re/a,r=$/a),this.set(i,r,a,t),this}let F=Math.sqrt((R-P)*(R-P)+(S-k)*(S-k)+(T-_)*(T-_));return Math.abs(F)<.001&&(F=1),this.x=(R-P)/F,this.y=(S-k)/F,this.z=(T-_)/F,this.w=Math.acos((m+C+O-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Pu extends Mh{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new br(0,0,e,t),this.scissorTest=!1,this.viewport=new br(0,0,e,t);const r={width:e,height:t,depth:1};this.texture=new bs(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:zs,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Vm(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WM extends bs{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ls,this.minFilter=Ls,this.wrapR=la,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class xQ extends Pu{constructor(e=1,t=1,i=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new WM(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class ok extends bs{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ls,this.minFilter=Ls,this.wrapR=la,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class vQ extends Pu{constructor(e=1,t=1,i=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new ok(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class wQ extends Pu{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const a=this.texture;this.texture=[];for(let l=0;l<i;l++)this.texture[l]=a.clone(),this.texture[l].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,a=this.texture.length;r<a;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class vg{constructor(e=new Fe(1/0,1/0,1/0),t=new Fe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,a=-1/0,l=-1/0,s=-1/0;for(let d=0,m=e.length;d<m;d+=3){const _=e[d],S=e[d+1],T=e[d+2];_<t&&(t=_),S<i&&(i=S),T<r&&(r=T),_>a&&(a=_),S>l&&(l=S),T>s&&(s=T)}return this.min.set(t,i,r),this.max.set(a,l,s),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,a=-1/0,l=-1/0,s=-1/0;for(let d=0,m=e.count;d<m;d++){const _=e.getX(d),S=e.getY(d),T=e.getZ(d);_<t&&(t=_),S<i&&(i=S),T<r&&(r=T),_>a&&(a=_),S>l&&(l=S),T>s&&(s=T)}return this.min.set(t,i,r),this.max.set(a,l,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=mm.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){const a=i.attributes.position;for(let l=0,s=a.count;l<s;l++)mm.fromBufferAttribute(a,l).applyMatrix4(e.matrixWorld),this.expandByPoint(mm)}else i.boundingBox===null&&i.computeBoundingBox(),aE.copy(i.boundingBox),aE.applyMatrix4(e.matrixWorld),this.union(aE);const r=e.children;for(let a=0,l=r.length;a<l;a++)this.expandByObject(r[a],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,mm),mm.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(J0),Yw.subVectors(this.max,J0),h_.subVectors(e.a,J0),d_.subVectors(e.b,J0),f_.subVectors(e.c,J0),Pf.subVectors(d_,h_),kf.subVectors(f_,d_),gm.subVectors(h_,f_);let t=[0,-Pf.z,Pf.y,0,-kf.z,kf.y,0,-gm.z,gm.y,Pf.z,0,-Pf.x,kf.z,0,-kf.x,gm.z,0,-gm.x,-Pf.y,Pf.x,0,-kf.y,kf.x,0,-gm.y,gm.x,0];return!lE(t,h_,d_,f_,Yw)||(t=[1,0,0,0,1,0,0,0,1],!lE(t,h_,d_,f_,Yw))?!1:(Jw.crossVectors(Pf,kf),t=[Jw.x,Jw.y,Jw.z],lE(t,h_,d_,f_,Yw))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,mm).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(mm).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(hd[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),hd[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),hd[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),hd[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),hd[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),hd[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),hd[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),hd[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(hd),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const hd=[new Fe,new Fe,new Fe,new Fe,new Fe,new Fe,new Fe,new Fe],mm=new Fe,aE=new vg,h_=new Fe,d_=new Fe,f_=new Fe,Pf=new Fe,kf=new Fe,gm=new Fe,J0=new Fe,Yw=new Fe,Jw=new Fe,_m=new Fe;function lE(n,e,t,i,r){for(let a=0,l=n.length-3;a<=l;a+=3){_m.fromArray(n,a);const s=r.x*Math.abs(_m.x)+r.y*Math.abs(_m.y)+r.z*Math.abs(_m.z),d=e.dot(_m),m=t.dot(_m),_=i.dot(_m);if(Math.max(-Math.max(d,m,_),Math.min(d,m,_))>s)return!1}return!0}const bQ=new vg,K0=new Fe,cE=new Fe;class wg{constructor(e=new Fe,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):bQ.setFromPoints(e).getCenter(i);let r=0;for(let a=0,l=e.length;a<l;a++)r=Math.max(r,i.distanceToSquared(e[a]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;K0.subVectors(e,this.center);const t=K0.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(K0,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(cE.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(K0.copy(e.center).add(cE)),this.expandByPoint(K0.copy(e.center).sub(cE))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const dd=new Fe,uE=new Fe,Kw=new Fe,Df=new Fe,hE=new Fe,Qw=new Fe,dE=new Fe;class l1{constructor(e=new Fe,t=new Fe(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,dd)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=dd.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(dd.copy(this.origin).addScaledVector(this.direction,t),dd.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){uE.copy(e).add(t).multiplyScalar(.5),Kw.copy(t).sub(e).normalize(),Df.copy(this.origin).sub(uE);const a=e.distanceTo(t)*.5,l=-this.direction.dot(Kw),s=Df.dot(this.direction),d=-Df.dot(Kw),m=Df.lengthSq(),_=Math.abs(1-l*l);let S,T,C,P;if(_>0)if(S=l*d-s,T=l*s-d,P=a*_,S>=0)if(T>=-P)if(T<=P){const k=1/_;S*=k,T*=k,C=S*(S+l*T+2*s)+T*(l*S+T+2*d)+m}else T=a,S=Math.max(0,-(l*T+s)),C=-S*S+T*(T+2*d)+m;else T=-a,S=Math.max(0,-(l*T+s)),C=-S*S+T*(T+2*d)+m;else T<=-P?(S=Math.max(0,-(-l*a+s)),T=S>0?-a:Math.min(Math.max(-a,-d),a),C=-S*S+T*(T+2*d)+m):T<=P?(S=0,T=Math.min(Math.max(-a,-d),a),C=T*(T+2*d)+m):(S=Math.max(0,-(l*a+s)),T=S>0?a:Math.min(Math.max(-a,-d),a),C=-S*S+T*(T+2*d)+m);else T=l>0?-a:a,S=Math.max(0,-(l*T+s)),C=-S*S+T*(T+2*d)+m;return i&&i.copy(this.origin).addScaledVector(this.direction,S),r&&r.copy(uE).addScaledVector(Kw,T),C}intersectSphere(e,t){dd.subVectors(e.center,this.origin);const i=dd.dot(this.direction),r=dd.dot(dd)-i*i,a=e.radius*e.radius;if(r>a)return null;const l=Math.sqrt(a-r),s=i-l,d=i+l;return d<0?null:s<0?this.at(d,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,a,l,s,d;const m=1/this.direction.x,_=1/this.direction.y,S=1/this.direction.z,T=this.origin;return m>=0?(i=(e.min.x-T.x)*m,r=(e.max.x-T.x)*m):(i=(e.max.x-T.x)*m,r=(e.min.x-T.x)*m),_>=0?(a=(e.min.y-T.y)*_,l=(e.max.y-T.y)*_):(a=(e.max.y-T.y)*_,l=(e.min.y-T.y)*_),i>l||a>r||((a>i||isNaN(i))&&(i=a),(l<r||isNaN(r))&&(r=l),S>=0?(s=(e.min.z-T.z)*S,d=(e.max.z-T.z)*S):(s=(e.max.z-T.z)*S,d=(e.min.z-T.z)*S),i>d||s>r)||((s>i||i!==i)&&(i=s),(d<r||r!==r)&&(r=d),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,dd)!==null}intersectTriangle(e,t,i,r,a){hE.subVectors(t,e),Qw.subVectors(i,e),dE.crossVectors(hE,Qw);let l=this.direction.dot(dE),s;if(l>0){if(r)return null;s=1}else if(l<0)s=-1,l=-l;else return null;Df.subVectors(this.origin,e);const d=s*this.direction.dot(Qw.crossVectors(Df,Qw));if(d<0)return null;const m=s*this.direction.dot(hE.cross(Df));if(m<0||d+m>l)return null;const _=-s*Df.dot(dE);return _<0?null:this.at(_/l,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class vi{constructor(){vi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,a,l,s,d,m,_,S,T,C,P,k,R){const O=this.elements;return O[0]=e,O[4]=t,O[8]=i,O[12]=r,O[1]=a,O[5]=l,O[9]=s,O[13]=d,O[2]=m,O[6]=_,O[10]=S,O[14]=T,O[3]=C,O[7]=P,O[11]=k,O[15]=R,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new vi().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/p_.setFromMatrixColumn(e,0).length(),a=1/p_.setFromMatrixColumn(e,1).length(),l=1/p_.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*a,t[5]=i[5]*a,t[6]=i[6]*a,t[7]=0,t[8]=i[8]*l,t[9]=i[9]*l,t[10]=i[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,a=e.z,l=Math.cos(i),s=Math.sin(i),d=Math.cos(r),m=Math.sin(r),_=Math.cos(a),S=Math.sin(a);if(e.order==="XYZ"){const T=l*_,C=l*S,P=s*_,k=s*S;t[0]=d*_,t[4]=-d*S,t[8]=m,t[1]=C+P*m,t[5]=T-k*m,t[9]=-s*d,t[2]=k-T*m,t[6]=P+C*m,t[10]=l*d}else if(e.order==="YXZ"){const T=d*_,C=d*S,P=m*_,k=m*S;t[0]=T+k*s,t[4]=P*s-C,t[8]=l*m,t[1]=l*S,t[5]=l*_,t[9]=-s,t[2]=C*s-P,t[6]=k+T*s,t[10]=l*d}else if(e.order==="ZXY"){const T=d*_,C=d*S,P=m*_,k=m*S;t[0]=T-k*s,t[4]=-l*S,t[8]=P+C*s,t[1]=C+P*s,t[5]=l*_,t[9]=k-T*s,t[2]=-l*m,t[6]=s,t[10]=l*d}else if(e.order==="ZYX"){const T=l*_,C=l*S,P=s*_,k=s*S;t[0]=d*_,t[4]=P*m-C,t[8]=T*m+k,t[1]=d*S,t[5]=k*m+T,t[9]=C*m-P,t[2]=-m,t[6]=s*d,t[10]=l*d}else if(e.order==="YZX"){const T=l*d,C=l*m,P=s*d,k=s*m;t[0]=d*_,t[4]=k-T*S,t[8]=P*S+C,t[1]=S,t[5]=l*_,t[9]=-s*_,t[2]=-m*_,t[6]=C*S+P,t[10]=T-k*S}else if(e.order==="XZY"){const T=l*d,C=l*m,P=s*d,k=s*m;t[0]=d*_,t[4]=-S,t[8]=m*_,t[1]=T*S+k,t[5]=l*_,t[9]=C*S-P,t[2]=P*S-C,t[6]=s*_,t[10]=k*S+T}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(SQ,e,MQ)}lookAt(e,t,i){const r=this.elements;return Tl.subVectors(e,t),Tl.lengthSq()===0&&(Tl.z=1),Tl.normalize(),Lf.crossVectors(i,Tl),Lf.lengthSq()===0&&(Math.abs(i.z)===1?Tl.x+=1e-4:Tl.z+=1e-4,Tl.normalize(),Lf.crossVectors(i,Tl)),Lf.normalize(),eb.crossVectors(Tl,Lf),r[0]=Lf.x,r[4]=eb.x,r[8]=Tl.x,r[1]=Lf.y,r[5]=eb.y,r[9]=Tl.y,r[2]=Lf.z,r[6]=eb.z,r[10]=Tl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,a=this.elements,l=i[0],s=i[4],d=i[8],m=i[12],_=i[1],S=i[5],T=i[9],C=i[13],P=i[2],k=i[6],R=i[10],O=i[14],F=i[3],N=i[7],G=i[11],j=i[15],Q=r[0],re=r[4],$=r[8],ne=r[12],ue=r[1],De=r[5],$e=r[9],ae=r[13],le=r[2],fe=r[6],Oe=r[10],We=r[14],ce=r[3],Te=r[7],Pe=r[11],Qe=r[15];return a[0]=l*Q+s*ue+d*le+m*ce,a[4]=l*re+s*De+d*fe+m*Te,a[8]=l*$+s*$e+d*Oe+m*Pe,a[12]=l*ne+s*ae+d*We+m*Qe,a[1]=_*Q+S*ue+T*le+C*ce,a[5]=_*re+S*De+T*fe+C*Te,a[9]=_*$+S*$e+T*Oe+C*Pe,a[13]=_*ne+S*ae+T*We+C*Qe,a[2]=P*Q+k*ue+R*le+O*ce,a[6]=P*re+k*De+R*fe+O*Te,a[10]=P*$+k*$e+R*Oe+O*Pe,a[14]=P*ne+k*ae+R*We+O*Qe,a[3]=F*Q+N*ue+G*le+j*ce,a[7]=F*re+N*De+G*fe+j*Te,a[11]=F*$+N*$e+G*Oe+j*Pe,a[15]=F*ne+N*ae+G*We+j*Qe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],a=e[12],l=e[1],s=e[5],d=e[9],m=e[13],_=e[2],S=e[6],T=e[10],C=e[14],P=e[3],k=e[7],R=e[11],O=e[15];return P*(+a*d*S-r*m*S-a*s*T+i*m*T+r*s*C-i*d*C)+k*(+t*d*C-t*m*T+a*l*T-r*l*C+r*m*_-a*d*_)+R*(+t*m*S-t*s*C-a*l*S+i*l*C+a*s*_-i*m*_)+O*(-r*s*_-t*d*S+t*s*T+r*l*S-i*l*T+i*d*_)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],a=e[3],l=e[4],s=e[5],d=e[6],m=e[7],_=e[8],S=e[9],T=e[10],C=e[11],P=e[12],k=e[13],R=e[14],O=e[15],F=S*R*m-k*T*m+k*d*C-s*R*C-S*d*O+s*T*O,N=P*T*m-_*R*m-P*d*C+l*R*C+_*d*O-l*T*O,G=_*k*m-P*S*m+P*s*C-l*k*C-_*s*O+l*S*O,j=P*S*d-_*k*d-P*s*T+l*k*T+_*s*R-l*S*R,Q=t*F+i*N+r*G+a*j;if(Q===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const re=1/Q;return e[0]=F*re,e[1]=(k*T*a-S*R*a-k*r*C+i*R*C+S*r*O-i*T*O)*re,e[2]=(s*R*a-k*d*a+k*r*m-i*R*m-s*r*O+i*d*O)*re,e[3]=(S*d*a-s*T*a-S*r*m+i*T*m+s*r*C-i*d*C)*re,e[4]=N*re,e[5]=(_*R*a-P*T*a+P*r*C-t*R*C-_*r*O+t*T*O)*re,e[6]=(P*d*a-l*R*a-P*r*m+t*R*m+l*r*O-t*d*O)*re,e[7]=(l*T*a-_*d*a+_*r*m-t*T*m-l*r*C+t*d*C)*re,e[8]=G*re,e[9]=(P*S*a-_*k*a-P*i*C+t*k*C+_*i*O-t*S*O)*re,e[10]=(l*k*a-P*s*a+P*i*m-t*k*m-l*i*O+t*s*O)*re,e[11]=(_*s*a-l*S*a-_*i*m+t*S*m+l*i*C-t*s*C)*re,e[12]=j*re,e[13]=(_*k*r-P*S*r+P*i*T-t*k*T-_*i*R+t*S*R)*re,e[14]=(P*s*r-l*k*r-P*i*d+t*k*d+l*i*R-t*s*R)*re,e[15]=(l*S*r-_*s*r+_*i*d-t*S*d-l*i*T+t*s*T)*re,this}scale(e){const t=this.elements,i=e.x,r=e.y,a=e.z;return t[0]*=i,t[4]*=r,t[8]*=a,t[1]*=i,t[5]*=r,t[9]*=a,t[2]*=i,t[6]*=r,t[10]*=a,t[3]*=i,t[7]*=r,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),a=1-i,l=e.x,s=e.y,d=e.z,m=a*l,_=a*s;return this.set(m*l+i,m*s-r*d,m*d+r*s,0,m*s+r*d,_*s+i,_*d-r*l,0,m*d-r*s,_*d+r*l,a*d*d+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,a,l){return this.set(1,i,a,0,e,1,l,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,a=t._x,l=t._y,s=t._z,d=t._w,m=a+a,_=l+l,S=s+s,T=a*m,C=a*_,P=a*S,k=l*_,R=l*S,O=s*S,F=d*m,N=d*_,G=d*S,j=i.x,Q=i.y,re=i.z;return r[0]=(1-(k+O))*j,r[1]=(C+G)*j,r[2]=(P-N)*j,r[3]=0,r[4]=(C-G)*Q,r[5]=(1-(T+O))*Q,r[6]=(R+F)*Q,r[7]=0,r[8]=(P+N)*re,r[9]=(R-F)*re,r[10]=(1-(T+k))*re,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let a=p_.set(r[0],r[1],r[2]).length();const l=p_.set(r[4],r[5],r[6]).length(),s=p_.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),e.x=r[12],e.y=r[13],e.z=r[14],du.copy(this);const m=1/a,_=1/l,S=1/s;return du.elements[0]*=m,du.elements[1]*=m,du.elements[2]*=m,du.elements[4]*=_,du.elements[5]*=_,du.elements[6]*=_,du.elements[8]*=S,du.elements[9]*=S,du.elements[10]*=S,t.setFromRotationMatrix(du),i.x=a,i.y=l,i.z=s,this}makePerspective(e,t,i,r,a,l){const s=this.elements,d=2*a/(t-e),m=2*a/(i-r),_=(t+e)/(t-e),S=(i+r)/(i-r),T=-(l+a)/(l-a),C=-2*l*a/(l-a);return s[0]=d,s[4]=0,s[8]=_,s[12]=0,s[1]=0,s[5]=m,s[9]=S,s[13]=0,s[2]=0,s[6]=0,s[10]=T,s[14]=C,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,i,r,a,l){const s=this.elements,d=1/(t-e),m=1/(i-r),_=1/(l-a),S=(t+e)*d,T=(i+r)*m,C=(l+a)*_;return s[0]=2*d,s[4]=0,s[8]=0,s[12]=-S,s[1]=0,s[5]=2*m,s[9]=0,s[13]=-T,s[2]=0,s[6]=0,s[10]=-2*_,s[14]=-C,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const p_=new Fe,du=new vi,SQ=new Fe(0,0,0),MQ=new Fe(1,1,1),Lf=new Fe,eb=new Fe,Tl=new Fe,nO=new vi,iO=new da;class c1{constructor(e=0,t=0,i=0,r=c1.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,a=r[0],l=r[4],s=r[8],d=r[1],m=r[5],_=r[9],S=r[2],T=r[6],C=r[10];switch(t){case"XYZ":this._y=Math.asin(Os(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-_,C),this._z=Math.atan2(-l,a)):(this._x=Math.atan2(T,m),this._z=0);break;case"YXZ":this._x=Math.asin(-Os(_,-1,1)),Math.abs(_)<.9999999?(this._y=Math.atan2(s,C),this._z=Math.atan2(d,m)):(this._y=Math.atan2(-S,a),this._z=0);break;case"ZXY":this._x=Math.asin(Os(T,-1,1)),Math.abs(T)<.9999999?(this._y=Math.atan2(-S,C),this._z=Math.atan2(-l,m)):(this._y=0,this._z=Math.atan2(d,a));break;case"ZYX":this._y=Math.asin(-Os(S,-1,1)),Math.abs(S)<.9999999?(this._x=Math.atan2(T,C),this._z=Math.atan2(d,a)):(this._x=0,this._z=Math.atan2(-l,m));break;case"YZX":this._z=Math.asin(Os(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-_,m),this._y=Math.atan2(-S,a)):(this._x=0,this._y=Math.atan2(s,C));break;case"XZY":this._z=Math.asin(-Os(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(T,m),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-_,C),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return nO.makeRotationFromQuaternion(e),this.setFromRotationMatrix(nO,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return iO.setFromEuler(this),this.setFromQuaternion(iO,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}c1.DEFAULT_ORDER="XYZ";class eg{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let TQ=0;const rO=new Fe,m_=new da,fd=new vi,tb=new Fe,Q0=new Fe,EQ=new Fe,AQ=new da,sO=new Fe(1,0,0),oO=new Fe(0,1,0),aO=new Fe(0,0,1),CQ={type:"added"},lO={type:"removed"};class lr extends Mh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:TQ++}),this.uuid=Rl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=lr.DEFAULT_UP.clone();const e=new Fe,t=new c1,i=new da,r=new Fe(1,1,1);function a(){i.setFromEuler(t,!1)}function l(){t.setFromQuaternion(i,void 0,!1)}t._onChange(a),i._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new vi},normalMatrix:{value:new zo}}),this.matrix=new vi,this.matrixWorld=new vi,this.matrixAutoUpdate=lr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=lr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new eg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return m_.setFromAxisAngle(e,t),this.quaternion.multiply(m_),this}rotateOnWorldAxis(e,t){return m_.setFromAxisAngle(e,t),this.quaternion.premultiply(m_),this}rotateX(e){return this.rotateOnAxis(sO,e)}rotateY(e){return this.rotateOnAxis(oO,e)}rotateZ(e){return this.rotateOnAxis(aO,e)}translateOnAxis(e,t){return rO.copy(e).applyQuaternion(this.quaternion),this.position.add(rO.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(sO,e)}translateY(e){return this.translateOnAxis(oO,e)}translateZ(e){return this.translateOnAxis(aO,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(fd.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?tb.copy(e):tb.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Q0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fd.lookAt(Q0,tb,this.up):fd.lookAt(tb,Q0,this.up),this.quaternion.setFromRotationMatrix(fd),r&&(fd.extractRotation(r.matrixWorld),m_.setFromRotationMatrix(fd),this.quaternion.premultiply(m_.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(CQ)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(lO)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(lO)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),fd.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),fd.multiply(e.parent.matrixWorld)),e.applyMatrix4(fd),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const l=this.children[i].getObjectByProperty(e,t);if(l!==void 0)return l}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,a=this.children.length;r<a;r++){const l=this.children[r].getObjectsByProperty(e,t);l.length>0&&(i=i.concat(l))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Q0,e,EQ),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Q0,AQ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++){const a=t[i];(a.matrixWorldAutoUpdate===!0||e===!0)&&a.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let a=0,l=r.length;a<l;a++){const s=r[a];s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function a(s,d){return s[d.uuid]===void 0&&(s[d.uuid]=d.toJSON(e)),d.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(e.geometries,this.geometry);const s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){const d=s.shapes;if(Array.isArray(d))for(let m=0,_=d.length;m<_;m++){const S=d[m];a(e.shapes,S)}else a(e.shapes,d)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const s=[];for(let d=0,m=this.material.length;d<m;d++)s.push(a(e.materials,this.material[d]));r.material=s}else r.material=a(e.materials,this.material);if(this.children.length>0){r.children=[];for(let s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let s=0;s<this.animations.length;s++){const d=this.animations[s];r.animations.push(a(e.animations,d))}}if(t){const s=l(e.geometries),d=l(e.materials),m=l(e.textures),_=l(e.images),S=l(e.shapes),T=l(e.skeletons),C=l(e.animations),P=l(e.nodes);s.length>0&&(i.geometries=s),d.length>0&&(i.materials=d),m.length>0&&(i.textures=m),_.length>0&&(i.images=_),S.length>0&&(i.shapes=S),T.length>0&&(i.skeletons=T),C.length>0&&(i.animations=C),P.length>0&&(i.nodes=P)}return i.object=r,i;function l(s){const d=[];for(const m in s){const _=s[m];delete _.metadata,d.push(_)}return d}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}lr.DEFAULT_UP=new Fe(0,1,0);lr.DEFAULT_MATRIX_AUTO_UPDATE=!0;lr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const fu=new Fe,pd=new Fe,fE=new Fe,md=new Fe,g_=new Fe,__=new Fe,cO=new Fe,pE=new Fe,mE=new Fe,gE=new Fe;class yc{constructor(e=new Fe,t=new Fe,i=new Fe){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),fu.subVectors(e,t),r.cross(fu);const a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}static getBarycoord(e,t,i,r,a){fu.subVectors(r,t),pd.subVectors(i,t),fE.subVectors(e,t);const l=fu.dot(fu),s=fu.dot(pd),d=fu.dot(fE),m=pd.dot(pd),_=pd.dot(fE),S=l*m-s*s;if(S===0)return a.set(-2,-1,-1);const T=1/S,C=(m*d-s*_)*T,P=(l*_-s*d)*T;return a.set(1-C-P,P,C)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,md),md.x>=0&&md.y>=0&&md.x+md.y<=1}static getUV(e,t,i,r,a,l,s,d){return this.getBarycoord(e,t,i,r,md),d.set(0,0),d.addScaledVector(a,md.x),d.addScaledVector(l,md.y),d.addScaledVector(s,md.z),d}static isFrontFacing(e,t,i,r){return fu.subVectors(i,t),pd.subVectors(e,t),fu.cross(pd).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return fu.subVectors(this.c,this.b),pd.subVectors(this.a,this.b),fu.cross(pd).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return yc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return yc.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,a){return yc.getUV(e,this.a,this.b,this.c,t,i,r,a)}containsPoint(e){return yc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return yc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,a=this.c;let l,s;g_.subVectors(r,i),__.subVectors(a,i),pE.subVectors(e,i);const d=g_.dot(pE),m=__.dot(pE);if(d<=0&&m<=0)return t.copy(i);mE.subVectors(e,r);const _=g_.dot(mE),S=__.dot(mE);if(_>=0&&S<=_)return t.copy(r);const T=d*S-_*m;if(T<=0&&d>=0&&_<=0)return l=d/(d-_),t.copy(i).addScaledVector(g_,l);gE.subVectors(e,a);const C=g_.dot(gE),P=__.dot(gE);if(P>=0&&C<=P)return t.copy(a);const k=C*m-d*P;if(k<=0&&m>=0&&P<=0)return s=m/(m-P),t.copy(i).addScaledVector(__,s);const R=_*P-C*S;if(R<=0&&S-_>=0&&C-P>=0)return cO.subVectors(a,r),s=(S-_)/(S-_+(C-P)),t.copy(r).addScaledVector(cO,s);const O=1/(R+k+T);return l=k*O,s=T*O,t.copy(i).addScaledVector(g_,l).addScaledVector(__,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let IQ=0;class No extends Mh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:IQ++}),this.uuid=Rl(),this.name="",this.type="Material",this.blending=Jm,this.side=Gd,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=JP,this.blendDst=KP,this.blendEquation=km,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=nM,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=G6,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=lS,this.stencilZFail=lS,this.stencilZPass=lS,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Jm&&(i.blending=this.blending),this.side!==Gd&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(a){const l=[];for(const s in a){const d=a[s];delete d.metadata,l.push(d)}return l}if(t){const a=r(e.textures),l=r(e.images);a.length>0&&(i.textures=a),l.length>0&&(i.images=l)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let a=0;a!==r;++a)i[a]=t[a].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const q6={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},pu={h:0,s:0,l:0},nb={h:0,s:0,l:0};function _E(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class zn{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=yu){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ia.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=ia.workingColorSpace){return this.r=e,this.g=t,this.b=i,ia.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=ia.workingColorSpace){if(e=rk(e,1),t=Os(t,0,1),i=Os(i,0,1),t===0)this.r=this.g=this.b=i;else{const a=i<=.5?i*(1+t):i+t-i*t,l=2*i-a;this.r=_E(l,a,e+1/3),this.g=_E(l,a,e),this.b=_E(l,a,e-1/3)}return ia.toWorkingColorSpace(this,r),this}setStyle(e,t=yu){function i(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let a;const l=r[1],s=r[2];switch(l){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,ia.toWorkingColorSpace(this,t),i(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,ia.toWorkingColorSpace(this,t),i(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const d=parseFloat(a[1])/360,m=parseFloat(a[2])/100,_=parseFloat(a[3])/100;return i(a[4]),this.setHSL(d,m,_,t)}break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=r[1],l=a.length;if(l===3)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,ia.toWorkingColorSpace(this,t),this;if(l===6)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,ia.toWorkingColorSpace(this,t),this;console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=yu){const i=q6[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=oy(e.r),this.g=oy(e.g),this.b=oy(e.b),this}copyLinearToSRGB(e){return this.r=sE(e.r),this.g=sE(e.g),this.b=sE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=yu){return ia.fromWorkingColorSpace(na.copy(this),e),Os(na.r*255,0,255)<<16^Os(na.g*255,0,255)<<8^Os(na.b*255,0,255)<<0}getHexString(e=yu){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ia.workingColorSpace){ia.fromWorkingColorSpace(na.copy(this),t);const i=na.r,r=na.g,a=na.b,l=Math.max(i,r,a),s=Math.min(i,r,a);let d,m;const _=(s+l)/2;if(s===l)d=0,m=0;else{const S=l-s;switch(m=_<=.5?S/(l+s):S/(2-l-s),l){case i:d=(r-a)/S+(r<a?6:0);break;case r:d=(a-i)/S+2;break;case a:d=(i-r)/S+4;break}d/=6}return e.h=d,e.s=m,e.l=_,e}getRGB(e,t=ia.workingColorSpace){return ia.fromWorkingColorSpace(na.copy(this),t),e.r=na.r,e.g=na.g,e.b=na.b,e}getStyle(e=yu){ia.fromWorkingColorSpace(na.copy(this),e);const t=na.r,i=na.g,r=na.b;return e!==yu?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${t*255|0},${i*255|0},${r*255|0})`}offsetHSL(e,t,i){return this.getHSL(pu),pu.h+=e,pu.s+=t,pu.l+=i,this.setHSL(pu.h,pu.s,pu.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(pu),e.getHSL(nb);const i=Hx(pu.h,nb.h,t),r=Hx(pu.s,nb.s,t),a=Hx(pu.l,nb.l,t);return this.setHSL(i,r,a),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const na=new zn;zn.NAMES=q6;class Pp extends No{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new zn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=a1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Us=new Fe,ib=new Ht;class zr{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=Iv,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,a=this.itemSize;r<a;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)ib.fromBufferAttribute(this,t),ib.applyMatrix3(e),this.setXY(t,ib.x,ib.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Us.fromBufferAttribute(this,t),Us.applyMatrix3(e),this.setXYZ(t,Us.x,Us.y,Us.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Us.fromBufferAttribute(this,t),Us.applyMatrix4(e),this.setXYZ(t,Us.x,Us.y,Us.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Us.fromBufferAttribute(this,t),Us.applyNormalMatrix(e),this.setXYZ(t,Us.x,Us.y,Us.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Us.fromBufferAttribute(this,t),Us.transformDirection(e),this.setXYZ(t,Us.x,Us.y,Us.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Dd(t,this.array)),t}setX(e,t){return this.normalized&&(t=kr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Dd(t,this.array)),t}setY(e,t){return this.normalized&&(t=kr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Dd(t,this.array)),t}setZ(e,t){return this.normalized&&(t=kr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Dd(t,this.array)),t}setW(e,t){return this.normalized&&(t=kr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=kr(t,this.array),i=kr(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=kr(t,this.array),i=kr(i,this.array),r=kr(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,a){return e*=this.itemSize,this.normalized&&(t=kr(t,this.array),i=kr(i,this.array),r=kr(r,this.array),a=kr(a,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Iv&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class PQ extends zr{constructor(e,t,i){super(new Int8Array(e),t,i)}}class kQ extends zr{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class DQ extends zr{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class LQ extends zr{constructor(e,t,i){super(new Int16Array(e),t,i)}}class ak extends zr{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class RQ extends zr{constructor(e,t,i){super(new Int32Array(e),t,i)}}class lk extends zr{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class zQ extends zr{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}}class qn extends zr{constructor(e,t,i){super(new Float32Array(e),t,i)}}class OQ extends zr{constructor(e,t,i){super(new Float64Array(e),t,i)}}let FQ=0;const cc=new vi,yE=new lr,y_=new Fe,El=new vg,ex=new vg,wo=new Fe;class Pi extends Mh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:FQ++}),this.uuid=Rl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(j6(e)?lk:ak)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const a=new zo().getNormalMatrix(e);i.applyNormalMatrix(a),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return cc.makeRotationFromQuaternion(e),this.applyMatrix4(cc),this}rotateX(e){return cc.makeRotationX(e),this.applyMatrix4(cc),this}rotateY(e){return cc.makeRotationY(e),this.applyMatrix4(cc),this}rotateZ(e){return cc.makeRotationZ(e),this.applyMatrix4(cc),this}translate(e,t,i){return cc.makeTranslation(e,t,i),this.applyMatrix4(cc),this}scale(e,t,i){return cc.makeScale(e,t,i),this.applyMatrix4(cc),this}lookAt(e){return yE.lookAt(e),yE.updateMatrix(),this.applyMatrix4(yE.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(y_).negate(),this.translate(y_.x,y_.y,y_.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const a=e[i];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new qn(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new vg);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Fe(-1/0,-1/0,-1/0),new Fe(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const a=t[i];El.setFromBufferAttribute(a),this.morphTargetsRelative?(wo.addVectors(this.boundingBox.min,El.min),this.boundingBox.expandByPoint(wo),wo.addVectors(this.boundingBox.max,El.max),this.boundingBox.expandByPoint(wo)):(this.boundingBox.expandByPoint(El.min),this.boundingBox.expandByPoint(El.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wg);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Fe,1/0);return}if(e){const i=this.boundingSphere.center;if(El.setFromBufferAttribute(e),t)for(let a=0,l=t.length;a<l;a++){const s=t[a];ex.setFromBufferAttribute(s),this.morphTargetsRelative?(wo.addVectors(El.min,ex.min),El.expandByPoint(wo),wo.addVectors(El.max,ex.max),El.expandByPoint(wo)):(El.expandByPoint(ex.min),El.expandByPoint(ex.max))}El.getCenter(i);let r=0;for(let a=0,l=e.count;a<l;a++)wo.fromBufferAttribute(e,a),r=Math.max(r,i.distanceToSquared(wo));if(t)for(let a=0,l=t.length;a<l;a++){const s=t[a],d=this.morphTargetsRelative;for(let m=0,_=s.count;m<_;m++)wo.fromBufferAttribute(s,m),d&&(y_.fromBufferAttribute(e,m),wo.add(y_)),r=Math.max(r,i.distanceToSquared(wo))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,r=t.position.array,a=t.normal.array,l=t.uv.array,s=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new zr(new Float32Array(4*s),4));const d=this.getAttribute("tangent").array,m=[],_=[];for(let ue=0;ue<s;ue++)m[ue]=new Fe,_[ue]=new Fe;const S=new Fe,T=new Fe,C=new Fe,P=new Ht,k=new Ht,R=new Ht,O=new Fe,F=new Fe;function N(ue,De,$e){S.fromArray(r,ue*3),T.fromArray(r,De*3),C.fromArray(r,$e*3),P.fromArray(l,ue*2),k.fromArray(l,De*2),R.fromArray(l,$e*2),T.sub(S),C.sub(S),k.sub(P),R.sub(P);const ae=1/(k.x*R.y-R.x*k.y);isFinite(ae)&&(O.copy(T).multiplyScalar(R.y).addScaledVector(C,-k.y).multiplyScalar(ae),F.copy(C).multiplyScalar(k.x).addScaledVector(T,-R.x).multiplyScalar(ae),m[ue].add(O),m[De].add(O),m[$e].add(O),_[ue].add(F),_[De].add(F),_[$e].add(F))}let G=this.groups;G.length===0&&(G=[{start:0,count:i.length}]);for(let ue=0,De=G.length;ue<De;++ue){const $e=G[ue],ae=$e.start,le=$e.count;for(let fe=ae,Oe=ae+le;fe<Oe;fe+=3)N(i[fe+0],i[fe+1],i[fe+2])}const j=new Fe,Q=new Fe,re=new Fe,$=new Fe;function ne(ue){re.fromArray(a,ue*3),$.copy(re);const De=m[ue];j.copy(De),j.sub(re.multiplyScalar(re.dot(De))).normalize(),Q.crossVectors($,De);const ae=Q.dot(_[ue])<0?-1:1;d[ue*4]=j.x,d[ue*4+1]=j.y,d[ue*4+2]=j.z,d[ue*4+3]=ae}for(let ue=0,De=G.length;ue<De;++ue){const $e=G[ue],ae=$e.start,le=$e.count;for(let fe=ae,Oe=ae+le;fe<Oe;fe+=3)ne(i[fe+0]),ne(i[fe+1]),ne(i[fe+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new zr(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let T=0,C=i.count;T<C;T++)i.setXYZ(T,0,0,0);const r=new Fe,a=new Fe,l=new Fe,s=new Fe,d=new Fe,m=new Fe,_=new Fe,S=new Fe;if(e)for(let T=0,C=e.count;T<C;T+=3){const P=e.getX(T+0),k=e.getX(T+1),R=e.getX(T+2);r.fromBufferAttribute(t,P),a.fromBufferAttribute(t,k),l.fromBufferAttribute(t,R),_.subVectors(l,a),S.subVectors(r,a),_.cross(S),s.fromBufferAttribute(i,P),d.fromBufferAttribute(i,k),m.fromBufferAttribute(i,R),s.add(_),d.add(_),m.add(_),i.setXYZ(P,s.x,s.y,s.z),i.setXYZ(k,d.x,d.y,d.z),i.setXYZ(R,m.x,m.y,m.z)}else for(let T=0,C=t.count;T<C;T+=3)r.fromBufferAttribute(t,T+0),a.fromBufferAttribute(t,T+1),l.fromBufferAttribute(t,T+2),_.subVectors(l,a),S.subVectors(r,a),_.cross(S),i.setXYZ(T+0,_.x,_.y,_.z),i.setXYZ(T+1,_.x,_.y,_.z),i.setXYZ(T+2,_.x,_.y,_.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)wo.fromBufferAttribute(e,t),wo.normalize(),e.setXYZ(t,wo.x,wo.y,wo.z)}toNonIndexed(){function e(s,d){const m=s.array,_=s.itemSize,S=s.normalized,T=new m.constructor(d.length*_);let C=0,P=0;for(let k=0,R=d.length;k<R;k++){s.isInterleavedBufferAttribute?C=d[k]*s.data.stride+s.offset:C=d[k]*_;for(let O=0;O<_;O++)T[P++]=m[C++]}return new zr(T,_,S)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Pi,i=this.index.array,r=this.attributes;for(const s in r){const d=r[s],m=e(d,i);t.setAttribute(s,m)}const a=this.morphAttributes;for(const s in a){const d=[],m=a[s];for(let _=0,S=m.length;_<S;_++){const T=m[_],C=e(T,i);d.push(C)}t.morphAttributes[s]=d}t.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let s=0,d=l.length;s<d;s++){const m=l[s];t.addGroup(m.start,m.count,m.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const d=this.parameters;for(const m in d)d[m]!==void 0&&(e[m]=d[m]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const d in i){const m=i[d];e.data.attributes[d]=m.toJSON(e.data)}const r={};let a=!1;for(const d in this.morphAttributes){const m=this.morphAttributes[d],_=[];for(let S=0,T=m.length;S<T;S++){const C=m[S];_.push(C.toJSON(e.data))}_.length>0&&(r[d]=_,a=!0)}a&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const s=this.boundingSphere;return s!==null&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const m in r){const _=r[m];this.setAttribute(m,_.clone(t))}const a=e.morphAttributes;for(const m in a){const _=[],S=a[m];for(let T=0,C=S.length;T<C;T++)_.push(S[T].clone(t));this.morphAttributes[m]=_}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let m=0,_=l.length;m<_;m++){const S=l[m];this.addGroup(S.start,S.count,S.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const d=e.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const uO=new vi,dh=new l1,rb=new wg,hO=new Fe,tx=new Fe,nx=new Fe,ix=new Fe,xE=new Fe,sb=new Fe,ob=new Ht,ab=new Ht,lb=new Ht,vE=new Fe,cb=new Fe;class Oo extends lr{constructor(e=new Pi,t=new Pp){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=r.length;a<l;a++){const s=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=a}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const s=this.morphTargetInfluences;if(a&&s){sb.set(0,0,0);for(let d=0,m=a.length;d<m;d++){const _=s[d],S=a[d];_!==0&&(xE.fromBufferAttribute(S,e),l?sb.addScaledVector(xE,_):sb.addScaledVector(xE.sub(t),_))}t.add(sb)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){const i=this.geometry,r=this.material,a=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),rb.copy(i.boundingSphere),rb.applyMatrix4(a),dh.copy(e.ray).recast(e.near),rb.containsPoint(dh.origin)===!1&&(dh.intersectSphere(rb,hO)===null||dh.origin.distanceToSquared(hO)>(e.far-e.near)**2))||(uO.copy(a).invert(),dh.copy(e.ray).applyMatrix4(uO),i.boundingBox!==null&&dh.intersectsBox(i.boundingBox)===!1))return;let l;const s=i.index,d=i.attributes.position,m=i.attributes.uv,_=i.attributes.uv2,S=i.groups,T=i.drawRange;if(s!==null)if(Array.isArray(r))for(let C=0,P=S.length;C<P;C++){const k=S[C],R=r[k.materialIndex],O=Math.max(k.start,T.start),F=Math.min(s.count,Math.min(k.start+k.count,T.start+T.count));for(let N=O,G=F;N<G;N+=3){const j=s.getX(N),Q=s.getX(N+1),re=s.getX(N+2);l=ub(this,R,e,dh,m,_,j,Q,re),l&&(l.faceIndex=Math.floor(N/3),l.face.materialIndex=k.materialIndex,t.push(l))}}else{const C=Math.max(0,T.start),P=Math.min(s.count,T.start+T.count);for(let k=C,R=P;k<R;k+=3){const O=s.getX(k),F=s.getX(k+1),N=s.getX(k+2);l=ub(this,r,e,dh,m,_,O,F,N),l&&(l.faceIndex=Math.floor(k/3),t.push(l))}}else if(d!==void 0)if(Array.isArray(r))for(let C=0,P=S.length;C<P;C++){const k=S[C],R=r[k.materialIndex],O=Math.max(k.start,T.start),F=Math.min(d.count,Math.min(k.start+k.count,T.start+T.count));for(let N=O,G=F;N<G;N+=3){const j=N,Q=N+1,re=N+2;l=ub(this,R,e,dh,m,_,j,Q,re),l&&(l.faceIndex=Math.floor(N/3),l.face.materialIndex=k.materialIndex,t.push(l))}}else{const C=Math.max(0,T.start),P=Math.min(d.count,T.start+T.count);for(let k=C,R=P;k<R;k+=3){const O=k,F=k+1,N=k+2;l=ub(this,r,e,dh,m,_,O,F,N),l&&(l.faceIndex=Math.floor(k/3),t.push(l))}}}}function BQ(n,e,t,i,r,a,l,s){let d;if(e.side===nl?d=i.intersectTriangle(l,a,r,!0,s):d=i.intersectTriangle(r,a,l,e.side===Gd,s),d===null)return null;cb.copy(s),cb.applyMatrix4(n.matrixWorld);const m=t.ray.origin.distanceTo(cb);return m<t.near||m>t.far?null:{distance:m,point:cb.clone(),object:n}}function ub(n,e,t,i,r,a,l,s,d){n.getVertexPosition(l,tx),n.getVertexPosition(s,nx),n.getVertexPosition(d,ix);const m=BQ(n,e,t,i,tx,nx,ix,vE);if(m){r&&(ob.fromBufferAttribute(r,l),ab.fromBufferAttribute(r,s),lb.fromBufferAttribute(r,d),m.uv=yc.getUV(vE,tx,nx,ix,ob,ab,lb,new Ht)),a&&(ob.fromBufferAttribute(a,l),ab.fromBufferAttribute(a,s),lb.fromBufferAttribute(a,d),m.uv2=yc.getUV(vE,tx,nx,ix,ob,ab,lb,new Ht));const _={a:l,b:s,c:d,normal:new Fe,materialIndex:0};yc.getNormal(tx,nx,ix,_.normal),m.face=_}return m}class kp extends Pi{constructor(e=1,t=1,i=1,r=1,a=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:a,depthSegments:l};const s=this;r=Math.floor(r),a=Math.floor(a),l=Math.floor(l);const d=[],m=[],_=[],S=[];let T=0,C=0;P("z","y","x",-1,-1,i,t,e,l,a,0),P("z","y","x",1,-1,i,t,-e,l,a,1),P("x","z","y",1,1,e,i,t,r,l,2),P("x","z","y",1,-1,e,i,-t,r,l,3),P("x","y","z",1,-1,e,t,i,r,a,4),P("x","y","z",-1,-1,e,t,-i,r,a,5),this.setIndex(d),this.setAttribute("position",new qn(m,3)),this.setAttribute("normal",new qn(_,3)),this.setAttribute("uv",new qn(S,2));function P(k,R,O,F,N,G,j,Q,re,$,ne){const ue=G/re,De=j/$,$e=G/2,ae=j/2,le=Q/2,fe=re+1,Oe=$+1;let We=0,ce=0;const Te=new Fe;for(let Pe=0;Pe<Oe;Pe++){const Qe=Pe*De-ae;for(let Ne=0;Ne<fe;Ne++){const nt=Ne*ue-$e;Te[k]=nt*F,Te[R]=Qe*N,Te[O]=le,m.push(Te.x,Te.y,Te.z),Te[k]=0,Te[R]=0,Te[O]=Q>0?1:-1,_.push(Te.x,Te.y,Te.z),S.push(Ne/re),S.push(1-Pe/$),We+=1}}for(let Pe=0;Pe<$;Pe++)for(let Qe=0;Qe<re;Qe++){const Ne=T+Qe+fe*Pe,nt=T+Qe+fe*(Pe+1),ze=T+(Qe+1)+fe*(Pe+1),et=T+(Qe+1)+fe*Pe;d.push(Ne,nt,et),d.push(nt,ze,et),ce+=6}s.addGroup(C,ce,ne),C+=ce,T+=We}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new kp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ay(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function Sa(n){const e={};for(let t=0;t<n.length;t++){const i=Ay(n[t]);for(const r in i)e[r]=i[r]}return e}function NQ(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function Z6(n){return n.getRenderTarget()===null&&n.outputEncoding===Ar?yu:Ey}const $6={clone:Ay,merge:Sa};var UQ=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,VQ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Sh extends No{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=UQ,this.fragmentShader=VQ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ay(e.uniforms),this.uniformsGroups=NQ(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const l=this.uniforms[r].value;l&&l.isTexture?t.uniforms[r]={type:"t",value:l.toJSON(e).uuid}:l&&l.isColor?t.uniforms[r]={type:"c",value:l.getHex()}:l&&l.isVector2?t.uniforms[r]={type:"v2",value:l.toArray()}:l&&l.isVector3?t.uniforms[r]={type:"v3",value:l.toArray()}:l&&l.isVector4?t.uniforms[r]={type:"v4",value:l.toArray()}:l&&l.isMatrix3?t.uniforms[r]={type:"m3",value:l.toArray()}:l&&l.isMatrix4?t.uniforms[r]={type:"m4",value:l.toArray()}:t.uniforms[r]={value:l}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class u1 extends lr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new vi,this.projectionMatrix=new vi,this.projectionMatrixInverse=new vi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Yr extends u1{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Pv*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Qm*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Pv*2*Math.atan(Math.tan(Qm*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,a,l){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Qm*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,a=-.5*r;const l=this.view;if(this.view!==null&&this.view.enabled){const d=l.fullWidth,m=l.fullHeight;a+=l.offsetX*r/d,t-=l.offsetY*i/m,r*=l.width/d,i*=l.height/m}const s=this.filmOffset;s!==0&&(a+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const x_=-90,v_=1;class X6 extends lr{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const r=new Yr(x_,v_,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const a=new Yr(x_,v_,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(-1,0,0),this.add(a);const l=new Yr(x_,v_,e,t);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(0,1,0),this.add(l);const s=new Yr(x_,v_,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(0,-1,0),this.add(s);const d=new Yr(x_,v_,e,t);d.layers=this.layers,d.up.set(0,1,0),d.lookAt(0,0,1),this.add(d);const m=new Yr(x_,v_,e,t);m.layers=this.layers,m.up.set(0,1,0),m.lookAt(0,0,-1),this.add(m)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[r,a,l,s,d,m]=this.children,_=e.getRenderTarget(),S=e.toneMapping,T=e.xr.enabled;e.toneMapping=Au,e.xr.enabled=!1;const C=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,a),e.setRenderTarget(i,2),e.render(t,l),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,d),i.texture.generateMipmaps=C,e.setRenderTarget(i,5),e.render(t,m),e.setRenderTarget(_),e.toneMapping=S,e.xr.enabled=T,i.texture.needsPMREMUpdate=!0}}class h1 extends bs{constructor(e,t,i,r,a,l,s,d,m,_){e=e!==void 0?e:[],t=t!==void 0?t:vp,super(e,t,i,r,a,l,s,d,m,_),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Y6 extends Pu{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new h1(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:zs}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new kp(5,5,5),a=new Sh({name:"CubemapFromEquirect",uniforms:Ay(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:nl,blending:Rd});a.uniforms.tEquirect.value=t;const l=new Oo(r,a),s=t.minFilter;return t.minFilter===bp&&(t.minFilter=zs),new X6(1,10,this).update(e,l),t.minFilter=s,l.geometry.dispose(),l.material.dispose(),this}clear(e,t,i,r){const a=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(t,i,r);e.setRenderTarget(a)}}const wE=new Fe,GQ=new Fe,WQ=new zo;class Uf{constructor(e=new Fe(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=wE.subVectors(i,t).cross(GQ.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(wE),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:t.copy(e.start).addScaledVector(i,a)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||WQ.getNormalMatrix(e),r=this.coplanarPoint(wE).applyMatrix4(e),a=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const w_=new wg,hb=new Fe;class HM{constructor(e=new Uf,t=new Uf,i=new Uf,r=new Uf,a=new Uf,l=new Uf){this.planes=[e,t,i,r,a,l]}set(e,t,i,r,a,l){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(r),s[4].copy(a),s[5].copy(l),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],a=i[1],l=i[2],s=i[3],d=i[4],m=i[5],_=i[6],S=i[7],T=i[8],C=i[9],P=i[10],k=i[11],R=i[12],O=i[13],F=i[14],N=i[15];return t[0].setComponents(s-r,S-d,k-T,N-R).normalize(),t[1].setComponents(s+r,S+d,k+T,N+R).normalize(),t[2].setComponents(s+a,S+m,k+C,N+O).normalize(),t[3].setComponents(s-a,S-m,k-C,N-O).normalize(),t[4].setComponents(s-l,S-_,k-P,N-F).normalize(),t[5].setComponents(s+l,S+_,k+P,N+F).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),w_.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(w_)}intersectsSprite(e){return w_.center.set(0,0,0),w_.radius=.7071067811865476,w_.applyMatrix4(e.matrixWorld),this.intersectsSphere(w_)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(hb.x=r.normal.x>0?e.max.x:e.min.x,hb.y=r.normal.y>0?e.max.y:e.min.y,hb.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(hb)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function J6(){let n=null,e=!1,t=null,i=null;function r(a,l){t(a,l),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(a){t=a},setContext:function(a){n=a}}}function HQ(n,e){const t=e.isWebGL2,i=new WeakMap;function r(m,_){const S=m.array,T=m.usage,C=n.createBuffer();n.bindBuffer(_,C),n.bufferData(_,S,T),m.onUploadCallback();let P;if(S instanceof Float32Array)P=5126;else if(S instanceof Uint16Array)if(m.isFloat16BufferAttribute)if(t)P=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else P=5123;else if(S instanceof Int16Array)P=5122;else if(S instanceof Uint32Array)P=5125;else if(S instanceof Int32Array)P=5124;else if(S instanceof Int8Array)P=5120;else if(S instanceof Uint8Array)P=5121;else if(S instanceof Uint8ClampedArray)P=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+S);return{buffer:C,type:P,bytesPerElement:S.BYTES_PER_ELEMENT,version:m.version}}function a(m,_,S){const T=_.array,C=_.updateRange;n.bindBuffer(S,m),C.count===-1?n.bufferSubData(S,0,T):(t?n.bufferSubData(S,C.offset*T.BYTES_PER_ELEMENT,T,C.offset,C.count):n.bufferSubData(S,C.offset*T.BYTES_PER_ELEMENT,T.subarray(C.offset,C.offset+C.count)),C.count=-1),_.onUploadCallback()}function l(m){return m.isInterleavedBufferAttribute&&(m=m.data),i.get(m)}function s(m){m.isInterleavedBufferAttribute&&(m=m.data);const _=i.get(m);_&&(n.deleteBuffer(_.buffer),i.delete(m))}function d(m,_){if(m.isGLBufferAttribute){const T=i.get(m);(!T||T.version<m.version)&&i.set(m,{buffer:m.buffer,type:m.type,bytesPerElement:m.elementSize,version:m.version});return}m.isInterleavedBufferAttribute&&(m=m.data);const S=i.get(m);S===void 0?i.set(m,r(m,_)):S.version<m.version&&(a(S.buffer,m,_),S.version=m.version)}return{get:l,remove:s,update:d}}class Ny extends Pi{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const a=e/2,l=t/2,s=Math.floor(i),d=Math.floor(r),m=s+1,_=d+1,S=e/s,T=t/d,C=[],P=[],k=[],R=[];for(let O=0;O<_;O++){const F=O*T-l;for(let N=0;N<m;N++){const G=N*S-a;P.push(G,-F,0),k.push(0,0,1),R.push(N/s),R.push(1-O/d)}}for(let O=0;O<d;O++)for(let F=0;F<s;F++){const N=F+m*O,G=F+m*(O+1),j=F+1+m*(O+1),Q=F+1+m*O;C.push(N,G,Q),C.push(G,j,Q)}this.setIndex(C),this.setAttribute("position",new qn(P,3)),this.setAttribute("normal",new qn(k,3)),this.setAttribute("uv",new qn(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ny(e.width,e.height,e.widthSegments,e.heightSegments)}}var jQ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,qQ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ZQ=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,$Q=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,XQ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,YQ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,JQ="vec3 transformed = vec3( position );",KQ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,QQ=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,eee=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,tee=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,nee=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,iee=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,ree=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,see=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,oee=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,aee=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,lee=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,cee=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,uee=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,hee=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,dee=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,fee=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,pee=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,mee=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,gee=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,_ee="gl_FragColor = linearToOutputTexel( gl_FragColor );",yee=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,xee=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,vee=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,wee=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,bee=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,See=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Mee=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Tee=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Eee=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Aee=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Cee=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Iee=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Pee=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,kee=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Dee=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Lee=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Ree=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,zee=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Oee=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Fee=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Bee=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Nee=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Uee=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Vee=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Gee=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Wee=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Hee=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,jee=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,qee=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Zee=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,$ee=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Xee=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Yee=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Jee=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Kee=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Qee=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,ete=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,tte=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,nte=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,ite=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,rte=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,ste=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,ote=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ate=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,lte=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,cte=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,ute=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,hte=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,dte=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,fte=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,pte=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,mte=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,gte=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,_te=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,yte=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,xte=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,vte=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,wte=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,bte=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Ste=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Mte=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Tte=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Ete=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Ate=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Cte=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Ite=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Pte=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,kte=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Dte=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Lte=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Rte=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,zte=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, vec2 fullSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		
		vec2 lodFudge = pow( 1.95, lod ) / fullSize;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec2 fullSize = vec2( textureSize( sampler, 0 ) );
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), fullSize, floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), fullSize, ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Ote=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Fte=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Bte=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Nte=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Ute=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Vte=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,Gte=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Wte=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Hte=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,jte=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,qte=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Zte=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$te=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Xte=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Yte=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Jte=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Kte=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Qte=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,ene=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,tne=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,nne=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ine=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,rne=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,sne=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,one=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ane=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,lne=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cne=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,une=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,hne=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dne=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fne=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,pne=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mne=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gne=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_ne=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,yne=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,xne=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vne=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,wne=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,bne=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ii={alphamap_fragment:jQ,alphamap_pars_fragment:qQ,alphatest_fragment:ZQ,alphatest_pars_fragment:$Q,aomap_fragment:XQ,aomap_pars_fragment:YQ,begin_vertex:JQ,beginnormal_vertex:KQ,bsdfs:QQ,iridescence_fragment:eee,bumpmap_pars_fragment:tee,clipping_planes_fragment:nee,clipping_planes_pars_fragment:iee,clipping_planes_pars_vertex:ree,clipping_planes_vertex:see,color_fragment:oee,color_pars_fragment:aee,color_pars_vertex:lee,color_vertex:cee,common:uee,cube_uv_reflection_fragment:hee,defaultnormal_vertex:dee,displacementmap_pars_vertex:fee,displacementmap_vertex:pee,emissivemap_fragment:mee,emissivemap_pars_fragment:gee,encodings_fragment:_ee,encodings_pars_fragment:yee,envmap_fragment:xee,envmap_common_pars_fragment:vee,envmap_pars_fragment:wee,envmap_pars_vertex:bee,envmap_physical_pars_fragment:Ree,envmap_vertex:See,fog_vertex:Mee,fog_pars_vertex:Tee,fog_fragment:Eee,fog_pars_fragment:Aee,gradientmap_pars_fragment:Cee,lightmap_fragment:Iee,lightmap_pars_fragment:Pee,lights_lambert_fragment:kee,lights_lambert_pars_fragment:Dee,lights_pars_begin:Lee,lights_toon_fragment:zee,lights_toon_pars_fragment:Oee,lights_phong_fragment:Fee,lights_phong_pars_fragment:Bee,lights_physical_fragment:Nee,lights_physical_pars_fragment:Uee,lights_fragment_begin:Vee,lights_fragment_maps:Gee,lights_fragment_end:Wee,logdepthbuf_fragment:Hee,logdepthbuf_pars_fragment:jee,logdepthbuf_pars_vertex:qee,logdepthbuf_vertex:Zee,map_fragment:$ee,map_pars_fragment:Xee,map_particle_fragment:Yee,map_particle_pars_fragment:Jee,metalnessmap_fragment:Kee,metalnessmap_pars_fragment:Qee,morphcolor_vertex:ete,morphnormal_vertex:tte,morphtarget_pars_vertex:nte,morphtarget_vertex:ite,normal_fragment_begin:rte,normal_fragment_maps:ste,normal_pars_fragment:ote,normal_pars_vertex:ate,normal_vertex:lte,normalmap_pars_fragment:cte,clearcoat_normal_fragment_begin:ute,clearcoat_normal_fragment_maps:hte,clearcoat_pars_fragment:dte,iridescence_pars_fragment:fte,output_fragment:pte,packing:mte,premultiplied_alpha_fragment:gte,project_vertex:_te,dithering_fragment:yte,dithering_pars_fragment:xte,roughnessmap_fragment:vte,roughnessmap_pars_fragment:wte,shadowmap_pars_fragment:bte,shadowmap_pars_vertex:Ste,shadowmap_vertex:Mte,shadowmask_pars_fragment:Tte,skinbase_vertex:Ete,skinning_pars_vertex:Ate,skinning_vertex:Cte,skinnormal_vertex:Ite,specularmap_fragment:Pte,specularmap_pars_fragment:kte,tonemapping_fragment:Dte,tonemapping_pars_fragment:Lte,transmission_fragment:Rte,transmission_pars_fragment:zte,uv_pars_fragment:Ote,uv_pars_vertex:Fte,uv_vertex:Bte,uv2_pars_fragment:Nte,uv2_pars_vertex:Ute,uv2_vertex:Vte,worldpos_vertex:Gte,background_vert:Wte,background_frag:Hte,backgroundCube_vert:jte,backgroundCube_frag:qte,cube_vert:Zte,cube_frag:$te,depth_vert:Xte,depth_frag:Yte,distanceRGBA_vert:Jte,distanceRGBA_frag:Kte,equirect_vert:Qte,equirect_frag:ene,linedashed_vert:tne,linedashed_frag:nne,meshbasic_vert:ine,meshbasic_frag:rne,meshlambert_vert:sne,meshlambert_frag:one,meshmatcap_vert:ane,meshmatcap_frag:lne,meshnormal_vert:cne,meshnormal_frag:une,meshphong_vert:hne,meshphong_frag:dne,meshphysical_vert:fne,meshphysical_frag:pne,meshtoon_vert:mne,meshtoon_frag:gne,points_vert:_ne,points_frag:yne,shadow_vert:xne,shadow_frag:vne,sprite_vert:wne,sprite_frag:bne},vn={common:{diffuse:{value:new zn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new zo},uv2Transform:{value:new zo},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ht(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new zn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new zn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new zo}},sprite:{diffuse:{value:new zn(16777215)},opacity:{value:1},center:{value:new Ht(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new zo}}},vu={basic:{uniforms:Sa([vn.common,vn.specularmap,vn.envmap,vn.aomap,vn.lightmap,vn.fog]),vertexShader:Ii.meshbasic_vert,fragmentShader:Ii.meshbasic_frag},lambert:{uniforms:Sa([vn.common,vn.specularmap,vn.envmap,vn.aomap,vn.lightmap,vn.emissivemap,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.fog,vn.lights,{emissive:{value:new zn(0)}}]),vertexShader:Ii.meshlambert_vert,fragmentShader:Ii.meshlambert_frag},phong:{uniforms:Sa([vn.common,vn.specularmap,vn.envmap,vn.aomap,vn.lightmap,vn.emissivemap,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.fog,vn.lights,{emissive:{value:new zn(0)},specular:{value:new zn(1118481)},shininess:{value:30}}]),vertexShader:Ii.meshphong_vert,fragmentShader:Ii.meshphong_frag},standard:{uniforms:Sa([vn.common,vn.envmap,vn.aomap,vn.lightmap,vn.emissivemap,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.roughnessmap,vn.metalnessmap,vn.fog,vn.lights,{emissive:{value:new zn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ii.meshphysical_vert,fragmentShader:Ii.meshphysical_frag},toon:{uniforms:Sa([vn.common,vn.aomap,vn.lightmap,vn.emissivemap,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.gradientmap,vn.fog,vn.lights,{emissive:{value:new zn(0)}}]),vertexShader:Ii.meshtoon_vert,fragmentShader:Ii.meshtoon_frag},matcap:{uniforms:Sa([vn.common,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.fog,{matcap:{value:null}}]),vertexShader:Ii.meshmatcap_vert,fragmentShader:Ii.meshmatcap_frag},points:{uniforms:Sa([vn.points,vn.fog]),vertexShader:Ii.points_vert,fragmentShader:Ii.points_frag},dashed:{uniforms:Sa([vn.common,vn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ii.linedashed_vert,fragmentShader:Ii.linedashed_frag},depth:{uniforms:Sa([vn.common,vn.displacementmap]),vertexShader:Ii.depth_vert,fragmentShader:Ii.depth_frag},normal:{uniforms:Sa([vn.common,vn.bumpmap,vn.normalmap,vn.displacementmap,{opacity:{value:1}}]),vertexShader:Ii.meshnormal_vert,fragmentShader:Ii.meshnormal_frag},sprite:{uniforms:Sa([vn.sprite,vn.fog]),vertexShader:Ii.sprite_vert,fragmentShader:Ii.sprite_frag},background:{uniforms:{uvTransform:{value:new zo},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ii.background_vert,fragmentShader:Ii.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ii.backgroundCube_vert,fragmentShader:Ii.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ii.cube_vert,fragmentShader:Ii.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ii.equirect_vert,fragmentShader:Ii.equirect_frag},distanceRGBA:{uniforms:Sa([vn.common,vn.displacementmap,{referencePosition:{value:new Fe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ii.distanceRGBA_vert,fragmentShader:Ii.distanceRGBA_frag},shadow:{uniforms:Sa([vn.lights,vn.fog,{color:{value:new zn(0)},opacity:{value:1}}]),vertexShader:Ii.shadow_vert,fragmentShader:Ii.shadow_frag}};vu.physical={uniforms:Sa([vu.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ht(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new zn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ht},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new zn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new zn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ii.meshphysical_vert,fragmentShader:Ii.meshphysical_frag};const db={r:0,b:0,g:0};function Sne(n,e,t,i,r,a,l){const s=new zn(0);let d=a===!0?0:1,m,_,S=null,T=0,C=null;function P(R,O){let F=!1,N=O.isScene===!0?O.background:null;N&&N.isTexture&&(N=(O.backgroundBlurriness>0?t:e).get(N));const G=n.xr,j=G.getSession&&G.getSession();j&&j.environmentBlendMode==="additive"&&(N=null),N===null?k(s,d):N&&N.isColor&&(k(N,1),F=!0),(n.autoClear||F)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),N&&(N.isCubeTexture||N.mapping===By)?(_===void 0&&(_=new Oo(new kp(1,1,1),new Sh({name:"BackgroundCubeMaterial",uniforms:Ay(vu.backgroundCube.uniforms),vertexShader:vu.backgroundCube.vertexShader,fragmentShader:vu.backgroundCube.fragmentShader,side:nl,depthTest:!1,depthWrite:!1,fog:!1})),_.geometry.deleteAttribute("normal"),_.geometry.deleteAttribute("uv"),_.onBeforeRender=function(Q,re,$){this.matrixWorld.copyPosition($.matrixWorld)},Object.defineProperty(_.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(_)),_.material.uniforms.envMap.value=N,_.material.uniforms.flipEnvMap.value=N.isCubeTexture&&N.isRenderTargetTexture===!1?-1:1,_.material.uniforms.backgroundBlurriness.value=O.backgroundBlurriness,_.material.uniforms.backgroundIntensity.value=O.backgroundIntensity,_.material.toneMapped=N.encoding!==Ar,(S!==N||T!==N.version||C!==n.toneMapping)&&(_.material.needsUpdate=!0,S=N,T=N.version,C=n.toneMapping),_.layers.enableAll(),R.unshift(_,_.geometry,_.material,0,0,null)):N&&N.isTexture&&(m===void 0&&(m=new Oo(new Ny(2,2),new Sh({name:"BackgroundMaterial",uniforms:Ay(vu.background.uniforms),vertexShader:vu.background.vertexShader,fragmentShader:vu.background.fragmentShader,side:Gd,depthTest:!1,depthWrite:!1,fog:!1})),m.geometry.deleteAttribute("normal"),Object.defineProperty(m.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(m)),m.material.uniforms.t2D.value=N,m.material.uniforms.backgroundIntensity.value=O.backgroundIntensity,m.material.toneMapped=N.encoding!==Ar,N.matrixAutoUpdate===!0&&N.updateMatrix(),m.material.uniforms.uvTransform.value.copy(N.matrix),(S!==N||T!==N.version||C!==n.toneMapping)&&(m.material.needsUpdate=!0,S=N,T=N.version,C=n.toneMapping),m.layers.enableAll(),R.unshift(m,m.geometry,m.material,0,0,null))}function k(R,O){R.getRGB(db,Z6(n)),i.buffers.color.setClear(db.r,db.g,db.b,O,l)}return{getClearColor:function(){return s},setClearColor:function(R,O=1){s.set(R),d=O,k(s,d)},getClearAlpha:function(){return d},setClearAlpha:function(R){d=R,k(s,d)},render:P}}function Mne(n,e,t,i){const r=n.getParameter(34921),a=i.isWebGL2?null:e.get("OES_vertex_array_object"),l=i.isWebGL2||a!==null,s={},d=R(null);let m=d,_=!1;function S(le,fe,Oe,We,ce){let Te=!1;if(l){const Pe=k(We,Oe,fe);m!==Pe&&(m=Pe,C(m.object)),Te=O(le,We,Oe,ce),Te&&F(le,We,Oe,ce)}else{const Pe=fe.wireframe===!0;(m.geometry!==We.id||m.program!==Oe.id||m.wireframe!==Pe)&&(m.geometry=We.id,m.program=Oe.id,m.wireframe=Pe,Te=!0)}ce!==null&&t.update(ce,34963),(Te||_)&&(_=!1,$(le,fe,Oe,We),ce!==null&&n.bindBuffer(34963,t.get(ce).buffer))}function T(){return i.isWebGL2?n.createVertexArray():a.createVertexArrayOES()}function C(le){return i.isWebGL2?n.bindVertexArray(le):a.bindVertexArrayOES(le)}function P(le){return i.isWebGL2?n.deleteVertexArray(le):a.deleteVertexArrayOES(le)}function k(le,fe,Oe){const We=Oe.wireframe===!0;let ce=s[le.id];ce===void 0&&(ce={},s[le.id]=ce);let Te=ce[fe.id];Te===void 0&&(Te={},ce[fe.id]=Te);let Pe=Te[We];return Pe===void 0&&(Pe=R(T()),Te[We]=Pe),Pe}function R(le){const fe=[],Oe=[],We=[];for(let ce=0;ce<r;ce++)fe[ce]=0,Oe[ce]=0,We[ce]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:fe,enabledAttributes:Oe,attributeDivisors:We,object:le,attributes:{},index:null}}function O(le,fe,Oe,We){const ce=m.attributes,Te=fe.attributes;let Pe=0;const Qe=Oe.getAttributes();for(const Ne in Qe)if(Qe[Ne].location>=0){const ze=ce[Ne];let et=Te[Ne];if(et===void 0&&(Ne==="instanceMatrix"&&le.instanceMatrix&&(et=le.instanceMatrix),Ne==="instanceColor"&&le.instanceColor&&(et=le.instanceColor)),ze===void 0||ze.attribute!==et||et&&ze.data!==et.data)return!0;Pe++}return m.attributesNum!==Pe||m.index!==We}function F(le,fe,Oe,We){const ce={},Te=fe.attributes;let Pe=0;const Qe=Oe.getAttributes();for(const Ne in Qe)if(Qe[Ne].location>=0){let ze=Te[Ne];ze===void 0&&(Ne==="instanceMatrix"&&le.instanceMatrix&&(ze=le.instanceMatrix),Ne==="instanceColor"&&le.instanceColor&&(ze=le.instanceColor));const et={};et.attribute=ze,ze&&ze.data&&(et.data=ze.data),ce[Ne]=et,Pe++}m.attributes=ce,m.attributesNum=Pe,m.index=We}function N(){const le=m.newAttributes;for(let fe=0,Oe=le.length;fe<Oe;fe++)le[fe]=0}function G(le){j(le,0)}function j(le,fe){const Oe=m.newAttributes,We=m.enabledAttributes,ce=m.attributeDivisors;Oe[le]=1,We[le]===0&&(n.enableVertexAttribArray(le),We[le]=1),ce[le]!==fe&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](le,fe),ce[le]=fe)}function Q(){const le=m.newAttributes,fe=m.enabledAttributes;for(let Oe=0,We=fe.length;Oe<We;Oe++)fe[Oe]!==le[Oe]&&(n.disableVertexAttribArray(Oe),fe[Oe]=0)}function re(le,fe,Oe,We,ce,Te){i.isWebGL2===!0&&(Oe===5124||Oe===5125)?n.vertexAttribIPointer(le,fe,Oe,ce,Te):n.vertexAttribPointer(le,fe,Oe,We,ce,Te)}function $(le,fe,Oe,We){if(i.isWebGL2===!1&&(le.isInstancedMesh||We.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;N();const ce=We.attributes,Te=Oe.getAttributes(),Pe=fe.defaultAttributeValues;for(const Qe in Te){const Ne=Te[Qe];if(Ne.location>=0){let nt=ce[Qe];if(nt===void 0&&(Qe==="instanceMatrix"&&le.instanceMatrix&&(nt=le.instanceMatrix),Qe==="instanceColor"&&le.instanceColor&&(nt=le.instanceColor)),nt!==void 0){const ze=nt.normalized,et=nt.itemSize,Et=t.get(nt);if(Et===void 0)continue;const Nt=Et.buffer,qt=Et.type,wn=Et.bytesPerElement;if(nt.isInterleavedBufferAttribute){const _n=nt.data,Ln=_n.stride,At=nt.offset;if(_n.isInstancedInterleavedBuffer){for(let Ot=0;Ot<Ne.locationSize;Ot++)j(Ne.location+Ot,_n.meshPerAttribute);le.isInstancedMesh!==!0&&We._maxInstanceCount===void 0&&(We._maxInstanceCount=_n.meshPerAttribute*_n.count)}else for(let Ot=0;Ot<Ne.locationSize;Ot++)G(Ne.location+Ot);n.bindBuffer(34962,Nt);for(let Ot=0;Ot<Ne.locationSize;Ot++)re(Ne.location+Ot,et/Ne.locationSize,qt,ze,Ln*wn,(At+et/Ne.locationSize*Ot)*wn)}else{if(nt.isInstancedBufferAttribute){for(let _n=0;_n<Ne.locationSize;_n++)j(Ne.location+_n,nt.meshPerAttribute);le.isInstancedMesh!==!0&&We._maxInstanceCount===void 0&&(We._maxInstanceCount=nt.meshPerAttribute*nt.count)}else for(let _n=0;_n<Ne.locationSize;_n++)G(Ne.location+_n);n.bindBuffer(34962,Nt);for(let _n=0;_n<Ne.locationSize;_n++)re(Ne.location+_n,et/Ne.locationSize,qt,ze,et*wn,et/Ne.locationSize*_n*wn)}}else if(Pe!==void 0){const ze=Pe[Qe];if(ze!==void 0)switch(ze.length){case 2:n.vertexAttrib2fv(Ne.location,ze);break;case 3:n.vertexAttrib3fv(Ne.location,ze);break;case 4:n.vertexAttrib4fv(Ne.location,ze);break;default:n.vertexAttrib1fv(Ne.location,ze)}}}}Q()}function ne(){$e();for(const le in s){const fe=s[le];for(const Oe in fe){const We=fe[Oe];for(const ce in We)P(We[ce].object),delete We[ce];delete fe[Oe]}delete s[le]}}function ue(le){if(s[le.id]===void 0)return;const fe=s[le.id];for(const Oe in fe){const We=fe[Oe];for(const ce in We)P(We[ce].object),delete We[ce];delete fe[Oe]}delete s[le.id]}function De(le){for(const fe in s){const Oe=s[fe];if(Oe[le.id]===void 0)continue;const We=Oe[le.id];for(const ce in We)P(We[ce].object),delete We[ce];delete Oe[le.id]}}function $e(){ae(),_=!0,m!==d&&(m=d,C(m.object))}function ae(){d.geometry=null,d.program=null,d.wireframe=!1}return{setup:S,reset:$e,resetDefaultState:ae,dispose:ne,releaseStatesOfGeometry:ue,releaseStatesOfProgram:De,initAttributes:N,enableAttribute:G,disableUnusedAttributes:Q}}function Tne(n,e,t,i){const r=i.isWebGL2;let a;function l(m){a=m}function s(m,_){n.drawArrays(a,m,_),t.update(_,a,1)}function d(m,_,S){if(S===0)return;let T,C;if(r)T=n,C="drawArraysInstanced";else if(T=e.get("ANGLE_instanced_arrays"),C="drawArraysInstancedANGLE",T===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}T[C](a,m,_,S),t.update(_,a,S)}this.setMode=l,this.render=s,this.renderInstances=d}function Ene(n,e,t){let i;function r(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const re=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(re.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(re){if(re==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";re="mediump"}return re==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const l=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext;let s=t.precision!==void 0?t.precision:"highp";const d=a(s);d!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",d,"instead."),s=d);const m=l||e.has("WEBGL_draw_buffers"),_=t.logarithmicDepthBuffer===!0,S=n.getParameter(34930),T=n.getParameter(35660),C=n.getParameter(3379),P=n.getParameter(34076),k=n.getParameter(34921),R=n.getParameter(36347),O=n.getParameter(36348),F=n.getParameter(36349),N=T>0,G=l||e.has("OES_texture_float"),j=N&&G,Q=l?n.getParameter(36183):0;return{isWebGL2:l,drawBuffers:m,getMaxAnisotropy:r,getMaxPrecision:a,precision:s,logarithmicDepthBuffer:_,maxTextures:S,maxVertexTextures:T,maxTextureSize:C,maxCubemapSize:P,maxAttributes:k,maxVertexUniforms:R,maxVaryings:O,maxFragmentUniforms:F,vertexTextures:N,floatFragmentTextures:G,floatVertexTextures:j,maxSamples:Q}}function Ane(n){const e=this;let t=null,i=0,r=!1,a=!1;const l=new Uf,s=new zo,d={value:null,needsUpdate:!1};this.uniform=d,this.numPlanes=0,this.numIntersection=0,this.init=function(S,T){const C=S.length!==0||T||i!==0||r;return r=T,i=S.length,C},this.beginShadows=function(){a=!0,_(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(S,T){t=_(S,T,0)},this.setState=function(S,T,C){const P=S.clippingPlanes,k=S.clipIntersection,R=S.clipShadows,O=n.get(S);if(!r||P===null||P.length===0||a&&!R)a?_(null):m();else{const F=a?0:i,N=F*4;let G=O.clippingState||null;d.value=G,G=_(P,T,N,C);for(let j=0;j!==N;++j)G[j]=t[j];O.clippingState=G,this.numIntersection=k?this.numPlanes:0,this.numPlanes+=F}};function m(){d.value!==t&&(d.value=t,d.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function _(S,T,C,P){const k=S!==null?S.length:0;let R=null;if(k!==0){if(R=d.value,P!==!0||R===null){const O=C+k*4,F=T.matrixWorldInverse;s.getNormalMatrix(F),(R===null||R.length<O)&&(R=new Float32Array(O));for(let N=0,G=C;N!==k;++N,G+=4)l.copy(S[N]).applyMatrix4(F,s),l.normal.toArray(R,G),R[G+3]=l.constant}d.value=R,d.needsUpdate=!0}return e.numPlanes=k,e.numIntersection=0,R}}function Cne(n){let e=new WeakMap;function t(l,s){return s===bv?l.mapping=vp:s===Sv&&(l.mapping=wp),l}function i(l){if(l&&l.isTexture&&l.isRenderTargetTexture===!1){const s=l.mapping;if(s===bv||s===Sv)if(e.has(l)){const d=e.get(l).texture;return t(d,l.mapping)}else{const d=l.image;if(d&&d.height>0){const m=new Y6(d.height/2);return m.fromEquirectangularTexture(n,l),e.set(l,m),l.addEventListener("dispose",r),t(m.texture,l.mapping)}else return null}}return l}function r(l){const s=l.target;s.removeEventListener("dispose",r);const d=e.get(s);d!==void 0&&(e.delete(s),d.dispose())}function a(){e=new WeakMap}return{get:i,dispose:a}}class fp extends u1{constructor(e=-1,t=1,i=1,r=-1,a=.1,l=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=a,this.far=l,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,a,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let a=i-e,l=i+e,s=r+t,d=r-t;if(this.view!==null&&this.view.enabled){const m=(this.right-this.left)/this.view.fullWidth/this.zoom,_=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=m*this.view.offsetX,l=a+m*this.view.width,s-=_*this.view.offsetY,d=s-_*this.view.height}this.projectionMatrix.makeOrthographic(a,l,s,d,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const j_=4,dO=[.125,.215,.35,.446,.526,.582],Dm=20,bE=new fp,fO=new zn;let SE=null;const Pm=(1+Math.sqrt(5))/2,b_=1/Pm,pO=[new Fe(1,1,1),new Fe(-1,1,1),new Fe(1,1,-1),new Fe(-1,1,-1),new Fe(0,Pm,b_),new Fe(0,Pm,-b_),new Fe(b_,0,Pm),new Fe(-b_,0,Pm),new Fe(Pm,b_,0),new Fe(-Pm,b_,0)];class eI{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){SE=this._renderer.getRenderTarget(),this._setSize(256);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,i,r,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_O(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=gO(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(SE),e.scissorTest=!1,fb(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===vp||e.mapping===wp?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),SE=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:zs,minFilter:zs,generateMipmaps:!1,type:Ty,format:$a,encoding:Hd,depthBuffer:!1},r=mO(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=mO(e,t,i);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Ine(a)),this._blurMaterial=Pne(a,e,t)}return r}_compileMaterial(e){const t=new Oo(this._lodPlanes[0],e);this._renderer.compile(t,bE)}_sceneToCubeUV(e,t,i,r){const s=new Yr(90,1,t,i),d=[1,-1,1,1,1,1],m=[1,1,1,-1,-1,-1],_=this._renderer,S=_.autoClear,T=_.toneMapping;_.getClearColor(fO),_.toneMapping=Au,_.autoClear=!1;const C=new Pp({name:"PMREM.Background",side:nl,depthWrite:!1,depthTest:!1}),P=new Oo(new kp,C);let k=!1;const R=e.background;R?R.isColor&&(C.color.copy(R),e.background=null,k=!0):(C.color.copy(fO),k=!0);for(let O=0;O<6;O++){const F=O%3;F===0?(s.up.set(0,d[O],0),s.lookAt(m[O],0,0)):F===1?(s.up.set(0,0,d[O]),s.lookAt(0,m[O],0)):(s.up.set(0,d[O],0),s.lookAt(0,0,m[O]));const N=this._cubeSize;fb(r,F*N,O>2?N:0,N,N),_.setRenderTarget(r),k&&_.render(P,s),_.render(e,s)}P.geometry.dispose(),P.material.dispose(),_.toneMapping=T,_.autoClear=S,e.background=R}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===vp||e.mapping===wp;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=_O()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=gO());const a=r?this._cubemapMaterial:this._equirectMaterial,l=new Oo(this._lodPlanes[0],a),s=a.uniforms;s.envMap.value=e;const d=this._cubeSize;fb(t,0,0,3*d,2*d),i.setRenderTarget(t),i.render(l,bE)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),l=pO[(r-1)%pO.length];this._blur(e,r-1,r,a,l)}t.autoClear=i}_blur(e,t,i,r,a){const l=this._pingPongRenderTarget;this._halfBlur(e,l,t,i,r,"latitudinal",a),this._halfBlur(l,e,i,i,r,"longitudinal",a)}_halfBlur(e,t,i,r,a,l,s){const d=this._renderer,m=this._blurMaterial;l!=="latitudinal"&&l!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const _=3,S=new Oo(this._lodPlanes[r],m),T=m.uniforms,C=this._sizeLods[i]-1,P=isFinite(a)?Math.PI/(2*C):2*Math.PI/(2*Dm-1),k=a/P,R=isFinite(a)?1+Math.floor(_*k):Dm;R>Dm&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${R} samples when the maximum is set to ${Dm}`);const O=[];let F=0;for(let re=0;re<Dm;++re){const $=re/k,ne=Math.exp(-$*$/2);O.push(ne),re===0?F+=ne:re<R&&(F+=2*ne)}for(let re=0;re<O.length;re++)O[re]=O[re]/F;T.envMap.value=e.texture,T.samples.value=R,T.weights.value=O,T.latitudinal.value=l==="latitudinal",s&&(T.poleAxis.value=s);const{_lodMax:N}=this;T.dTheta.value=P,T.mipInt.value=N-i;const G=this._sizeLods[r],j=3*G*(r>N-j_?r-N+j_:0),Q=4*(this._cubeSize-G);fb(t,j,Q,3*G,2*G),d.setRenderTarget(t),d.render(S,bE)}}function Ine(n){const e=[],t=[],i=[];let r=n;const a=n-j_+1+dO.length;for(let l=0;l<a;l++){const s=Math.pow(2,r);t.push(s);let d=1/s;l>n-j_?d=dO[l-n+j_-1]:l===0&&(d=0),i.push(d);const m=1/(s-2),_=-m,S=1+m,T=[_,_,S,_,S,S,_,_,S,S,_,S],C=6,P=6,k=3,R=2,O=1,F=new Float32Array(k*P*C),N=new Float32Array(R*P*C),G=new Float32Array(O*P*C);for(let Q=0;Q<C;Q++){const re=Q%3*2/3-1,$=Q>2?0:-1,ne=[re,$,0,re+2/3,$,0,re+2/3,$+1,0,re,$,0,re+2/3,$+1,0,re,$+1,0];F.set(ne,k*P*Q),N.set(T,R*P*Q);const ue=[Q,Q,Q,Q,Q,Q];G.set(ue,O*P*Q)}const j=new Pi;j.setAttribute("position",new zr(F,k)),j.setAttribute("uv",new zr(N,R)),j.setAttribute("faceIndex",new zr(G,O)),e.push(j),r>j_&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function mO(n,e,t){const i=new Pu(n,e,t);return i.texture.mapping=By,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function fb(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function Pne(n,e,t){const i=new Float32Array(Dm),r=new Fe(0,1,0);return new Sh({name:"SphericalGaussianBlur",defines:{n:Dm,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:ck(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Rd,depthTest:!1,depthWrite:!1})}function gO(){return new Sh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:ck(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Rd,depthTest:!1,depthWrite:!1})}function _O(){return new Sh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:ck(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Rd,depthTest:!1,depthWrite:!1})}function ck(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function kne(n){let e=new WeakMap,t=null;function i(s){if(s&&s.isTexture){const d=s.mapping,m=d===bv||d===Sv,_=d===vp||d===wp;if(m||_)if(s.isRenderTargetTexture&&s.needsPMREMUpdate===!0){s.needsPMREMUpdate=!1;let S=e.get(s);return t===null&&(t=new eI(n)),S=m?t.fromEquirectangular(s,S):t.fromCubemap(s,S),e.set(s,S),S.texture}else{if(e.has(s))return e.get(s).texture;{const S=s.image;if(m&&S&&S.height>0||_&&S&&r(S)){t===null&&(t=new eI(n));const T=m?t.fromEquirectangular(s):t.fromCubemap(s);return e.set(s,T),s.addEventListener("dispose",a),T.texture}else return null}}}return s}function r(s){let d=0;const m=6;for(let _=0;_<m;_++)s[_]!==void 0&&d++;return d===m}function a(s){const d=s.target;d.removeEventListener("dispose",a);const m=e.get(d);m!==void 0&&(e.delete(d),m.dispose())}function l(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:l}}function Dne(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function Lne(n,e,t,i){const r={},a=new WeakMap;function l(S){const T=S.target;T.index!==null&&e.remove(T.index);for(const P in T.attributes)e.remove(T.attributes[P]);T.removeEventListener("dispose",l),delete r[T.id];const C=a.get(T);C&&(e.remove(C),a.delete(T)),i.releaseStatesOfGeometry(T),T.isInstancedBufferGeometry===!0&&delete T._maxInstanceCount,t.memory.geometries--}function s(S,T){return r[T.id]===!0||(T.addEventListener("dispose",l),r[T.id]=!0,t.memory.geometries++),T}function d(S){const T=S.attributes;for(const P in T)e.update(T[P],34962);const C=S.morphAttributes;for(const P in C){const k=C[P];for(let R=0,O=k.length;R<O;R++)e.update(k[R],34962)}}function m(S){const T=[],C=S.index,P=S.attributes.position;let k=0;if(C!==null){const F=C.array;k=C.version;for(let N=0,G=F.length;N<G;N+=3){const j=F[N+0],Q=F[N+1],re=F[N+2];T.push(j,Q,Q,re,re,j)}}else{const F=P.array;k=P.version;for(let N=0,G=F.length/3-1;N<G;N+=3){const j=N+0,Q=N+1,re=N+2;T.push(j,Q,Q,re,re,j)}}const R=new(j6(T)?lk:ak)(T,1);R.version=k;const O=a.get(S);O&&e.remove(O),a.set(S,R)}function _(S){const T=a.get(S);if(T){const C=S.index;C!==null&&T.version<C.version&&m(S)}else m(S);return a.get(S)}return{get:s,update:d,getWireframeAttribute:_}}function Rne(n,e,t,i){const r=i.isWebGL2;let a;function l(T){a=T}let s,d;function m(T){s=T.type,d=T.bytesPerElement}function _(T,C){n.drawElements(a,C,s,T*d),t.update(C,a,1)}function S(T,C,P){if(P===0)return;let k,R;if(r)k=n,R="drawElementsInstanced";else if(k=e.get("ANGLE_instanced_arrays"),R="drawElementsInstancedANGLE",k===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}k[R](a,C,s,T*d,P),t.update(C,a,P)}this.setMode=l,this.setIndex=m,this.render=_,this.renderInstances=S}function zne(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(a,l,s){switch(t.calls++,l){case 4:t.triangles+=s*(a/3);break;case 1:t.lines+=s*(a/2);break;case 3:t.lines+=s*(a-1);break;case 2:t.lines+=s*a;break;case 0:t.points+=s*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l);break}}function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function One(n,e){return n[0]-e[0]}function Fne(n,e){return Math.abs(e[1])-Math.abs(n[1])}function Bne(n,e,t){const i={},r=new Float32Array(8),a=new WeakMap,l=new br,s=[];for(let m=0;m<8;m++)s[m]=[m,0];function d(m,_,S){const T=m.morphTargetInfluences;if(e.isWebGL2===!0){const P=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,k=P!==void 0?P.length:0;let R=a.get(_);if(R===void 0||R.count!==k){let fe=function(){ae.dispose(),a.delete(_),_.removeEventListener("dispose",fe)};var C=fe;R!==void 0&&R.texture.dispose();const N=_.morphAttributes.position!==void 0,G=_.morphAttributes.normal!==void 0,j=_.morphAttributes.color!==void 0,Q=_.morphAttributes.position||[],re=_.morphAttributes.normal||[],$=_.morphAttributes.color||[];let ne=0;N===!0&&(ne=1),G===!0&&(ne=2),j===!0&&(ne=3);let ue=_.attributes.position.count*ne,De=1;ue>e.maxTextureSize&&(De=Math.ceil(ue/e.maxTextureSize),ue=e.maxTextureSize);const $e=new Float32Array(ue*De*4*k),ae=new WM($e,ue,De,k);ae.type=kd,ae.needsUpdate=!0;const le=ne*4;for(let Oe=0;Oe<k;Oe++){const We=Q[Oe],ce=re[Oe],Te=$[Oe],Pe=ue*De*4*Oe;for(let Qe=0;Qe<We.count;Qe++){const Ne=Qe*le;N===!0&&(l.fromBufferAttribute(We,Qe),$e[Pe+Ne+0]=l.x,$e[Pe+Ne+1]=l.y,$e[Pe+Ne+2]=l.z,$e[Pe+Ne+3]=0),G===!0&&(l.fromBufferAttribute(ce,Qe),$e[Pe+Ne+4]=l.x,$e[Pe+Ne+5]=l.y,$e[Pe+Ne+6]=l.z,$e[Pe+Ne+7]=0),j===!0&&(l.fromBufferAttribute(Te,Qe),$e[Pe+Ne+8]=l.x,$e[Pe+Ne+9]=l.y,$e[Pe+Ne+10]=l.z,$e[Pe+Ne+11]=Te.itemSize===4?l.w:1)}}R={count:k,texture:ae,size:new Ht(ue,De)},a.set(_,R),_.addEventListener("dispose",fe)}let O=0;for(let N=0;N<T.length;N++)O+=T[N];const F=_.morphTargetsRelative?1:1-O;S.getUniforms().setValue(n,"morphTargetBaseInfluence",F),S.getUniforms().setValue(n,"morphTargetInfluences",T),S.getUniforms().setValue(n,"morphTargetsTexture",R.texture,t),S.getUniforms().setValue(n,"morphTargetsTextureSize",R.size)}else{const P=T===void 0?0:T.length;let k=i[_.id];if(k===void 0||k.length!==P){k=[];for(let G=0;G<P;G++)k[G]=[G,0];i[_.id]=k}for(let G=0;G<P;G++){const j=k[G];j[0]=G,j[1]=T[G]}k.sort(Fne);for(let G=0;G<8;G++)G<P&&k[G][1]?(s[G][0]=k[G][0],s[G][1]=k[G][1]):(s[G][0]=Number.MAX_SAFE_INTEGER,s[G][1]=0);s.sort(One);const R=_.morphAttributes.position,O=_.morphAttributes.normal;let F=0;for(let G=0;G<8;G++){const j=s[G],Q=j[0],re=j[1];Q!==Number.MAX_SAFE_INTEGER&&re?(R&&_.getAttribute("morphTarget"+G)!==R[Q]&&_.setAttribute("morphTarget"+G,R[Q]),O&&_.getAttribute("morphNormal"+G)!==O[Q]&&_.setAttribute("morphNormal"+G,O[Q]),r[G]=re,F+=re):(R&&_.hasAttribute("morphTarget"+G)===!0&&_.deleteAttribute("morphTarget"+G),O&&_.hasAttribute("morphNormal"+G)===!0&&_.deleteAttribute("morphNormal"+G),r[G]=0)}const N=_.morphTargetsRelative?1:1-F;S.getUniforms().setValue(n,"morphTargetBaseInfluence",N),S.getUniforms().setValue(n,"morphTargetInfluences",r)}}return{update:d}}function Nne(n,e,t,i){let r=new WeakMap;function a(d){const m=i.render.frame,_=d.geometry,S=e.get(d,_);return r.get(S)!==m&&(e.update(S),r.set(S,m)),d.isInstancedMesh&&(d.hasEventListener("dispose",s)===!1&&d.addEventListener("dispose",s),t.update(d.instanceMatrix,34962),d.instanceColor!==null&&t.update(d.instanceColor,34962)),S}function l(){r=new WeakMap}function s(d){const m=d.target;m.removeEventListener("dispose",s),t.remove(m.instanceMatrix),m.instanceColor!==null&&t.remove(m.instanceColor)}return{update:a,dispose:l}}const K6=new bs,Q6=new WM,eV=new ok,tV=new h1,yO=[],xO=[],vO=new Float32Array(16),wO=new Float32Array(9),bO=new Float32Array(4);function Uy(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let a=yO[r];if(a===void 0&&(a=new Float32Array(r),yO[r]=a),e!==0){i.toArray(a,0);for(let l=1,s=0;l!==e;++l)s+=t,n[l].toArray(a,s)}return a}function oo(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function ao(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function jM(n,e){let t=xO[e];t===void 0&&(t=new Int32Array(e),xO[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function Une(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Vne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(oo(t,e))return;n.uniform2fv(this.addr,e),ao(t,e)}}function Gne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(oo(t,e))return;n.uniform3fv(this.addr,e),ao(t,e)}}function Wne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(oo(t,e))return;n.uniform4fv(this.addr,e),ao(t,e)}}function Hne(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(oo(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),ao(t,e)}else{if(oo(t,i))return;bO.set(i),n.uniformMatrix2fv(this.addr,!1,bO),ao(t,i)}}function jne(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(oo(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),ao(t,e)}else{if(oo(t,i))return;wO.set(i),n.uniformMatrix3fv(this.addr,!1,wO),ao(t,i)}}function qne(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(oo(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),ao(t,e)}else{if(oo(t,i))return;vO.set(i),n.uniformMatrix4fv(this.addr,!1,vO),ao(t,i)}}function Zne(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function $ne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(oo(t,e))return;n.uniform2iv(this.addr,e),ao(t,e)}}function Xne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(oo(t,e))return;n.uniform3iv(this.addr,e),ao(t,e)}}function Yne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(oo(t,e))return;n.uniform4iv(this.addr,e),ao(t,e)}}function Jne(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function Kne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(oo(t,e))return;n.uniform2uiv(this.addr,e),ao(t,e)}}function Qne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(oo(t,e))return;n.uniform3uiv(this.addr,e),ao(t,e)}}function eie(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(oo(t,e))return;n.uniform4uiv(this.addr,e),ao(t,e)}}function tie(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2D(e||K6,r)}function nie(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||eV,r)}function iie(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||tV,r)}function rie(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||Q6,r)}function sie(n){switch(n){case 5126:return Une;case 35664:return Vne;case 35665:return Gne;case 35666:return Wne;case 35674:return Hne;case 35675:return jne;case 35676:return qne;case 5124:case 35670:return Zne;case 35667:case 35671:return $ne;case 35668:case 35672:return Xne;case 35669:case 35673:return Yne;case 5125:return Jne;case 36294:return Kne;case 36295:return Qne;case 36296:return eie;case 35678:case 36198:case 36298:case 36306:case 35682:return tie;case 35679:case 36299:case 36307:return nie;case 35680:case 36300:case 36308:case 36293:return iie;case 36289:case 36303:case 36311:case 36292:return rie}}function oie(n,e){n.uniform1fv(this.addr,e)}function aie(n,e){const t=Uy(e,this.size,2);n.uniform2fv(this.addr,t)}function lie(n,e){const t=Uy(e,this.size,3);n.uniform3fv(this.addr,t)}function cie(n,e){const t=Uy(e,this.size,4);n.uniform4fv(this.addr,t)}function uie(n,e){const t=Uy(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function hie(n,e){const t=Uy(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function die(n,e){const t=Uy(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function fie(n,e){n.uniform1iv(this.addr,e)}function pie(n,e){n.uniform2iv(this.addr,e)}function mie(n,e){n.uniform3iv(this.addr,e)}function gie(n,e){n.uniform4iv(this.addr,e)}function _ie(n,e){n.uniform1uiv(this.addr,e)}function yie(n,e){n.uniform2uiv(this.addr,e)}function xie(n,e){n.uniform3uiv(this.addr,e)}function vie(n,e){n.uniform4uiv(this.addr,e)}function wie(n,e,t){const i=this.cache,r=e.length,a=jM(t,r);oo(i,a)||(n.uniform1iv(this.addr,a),ao(i,a));for(let l=0;l!==r;++l)t.setTexture2D(e[l]||K6,a[l])}function bie(n,e,t){const i=this.cache,r=e.length,a=jM(t,r);oo(i,a)||(n.uniform1iv(this.addr,a),ao(i,a));for(let l=0;l!==r;++l)t.setTexture3D(e[l]||eV,a[l])}function Sie(n,e,t){const i=this.cache,r=e.length,a=jM(t,r);oo(i,a)||(n.uniform1iv(this.addr,a),ao(i,a));for(let l=0;l!==r;++l)t.setTextureCube(e[l]||tV,a[l])}function Mie(n,e,t){const i=this.cache,r=e.length,a=jM(t,r);oo(i,a)||(n.uniform1iv(this.addr,a),ao(i,a));for(let l=0;l!==r;++l)t.setTexture2DArray(e[l]||Q6,a[l])}function Tie(n){switch(n){case 5126:return oie;case 35664:return aie;case 35665:return lie;case 35666:return cie;case 35674:return uie;case 35675:return hie;case 35676:return die;case 5124:case 35670:return fie;case 35667:case 35671:return pie;case 35668:case 35672:return mie;case 35669:case 35673:return gie;case 5125:return _ie;case 36294:return yie;case 36295:return xie;case 36296:return vie;case 35678:case 36198:case 36298:case 36306:case 35682:return wie;case 35679:case 36299:case 36307:return bie;case 35680:case 36300:case 36308:case 36293:return Sie;case 36289:case 36303:case 36311:case 36292:return Mie}}class Eie{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=sie(t.type)}}class Aie{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=Tie(t.type)}}class Cie{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let a=0,l=r.length;a!==l;++a){const s=r[a];s.setValue(e,t[s.id],i)}}}const ME=/(\w+)(\])?(\[|\.)?/g;function SO(n,e){n.seq.push(e),n.map[e.id]=e}function Iie(n,e,t){const i=n.name,r=i.length;for(ME.lastIndex=0;;){const a=ME.exec(i),l=ME.lastIndex;let s=a[1];const d=a[2]==="]",m=a[3];if(d&&(s=s|0),m===void 0||m==="["&&l+2===r){SO(t,m===void 0?new Eie(s,n,e):new Aie(s,n,e));break}else{let S=t.map[s];S===void 0&&(S=new Cie(s),SO(t,S)),t=S}}}class cS{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){const a=e.getActiveUniform(t,r),l=e.getUniformLocation(t,a.name);Iie(a,l,this)}}setValue(e,t,i,r){const a=this.map[t];a!==void 0&&a.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let a=0,l=t.length;a!==l;++a){const s=t[a],d=i[s.id];d.needsUpdate!==!1&&s.setValue(e,d.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,a=e.length;r!==a;++r){const l=e[r];l.id in t&&i.push(l)}return i}}function MO(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let Pie=0;function kie(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),a=Math.min(e+6,t.length);for(let l=r;l<a;l++){const s=l+1;i.push(`${s===e?">":" "} ${s}: ${t[l]}`)}return i.join(`
`)}function Die(n){switch(n){case Hd:return["Linear","( value )"];case Ar:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}function TO(n,e,t){const i=n.getShaderParameter(e,35713),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const l=parseInt(a[1]);return t.toUpperCase()+`

`+r+`

`+kie(n.getShaderSource(e),l)}else return r}function Lie(n,e){const t=Die(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Rie(n,e){let t;switch(e){case _6:t="Linear";break;case y6:t="Reinhard";break;case x6:t="OptimizedCineon";break;case QP:t="ACESFilmic";break;case v6:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function zie(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(bx).join(`
`)}function Oie(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function Fie(n,e){const t={},i=n.getProgramParameter(e,35721);for(let r=0;r<i;r++){const a=n.getActiveAttrib(e,r),l=a.name;let s=1;a.type===35674&&(s=2),a.type===35675&&(s=3),a.type===35676&&(s=4),t[l]={type:a.type,location:n.getAttribLocation(e,l),locationSize:s}}return t}function bx(n){return n!==""}function EO(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function AO(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Bie=/^[ \t]*#include +<([\w\d./]+)>/gm;function tI(n){return n.replace(Bie,Nie)}function Nie(n,e){const t=Ii[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return tI(t)}const Uie=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function CO(n){return n.replace(Uie,Vie)}function Vie(n,e,t,i){let r="";for(let a=parseInt(e);a<parseInt(t);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function IO(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Gie(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===UM?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===Gx?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Bm&&(e="SHADOWMAP_TYPE_VSM"),e}function Wie(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case vp:case wp:e="ENVMAP_TYPE_CUBE";break;case By:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Hie(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case wp:e="ENVMAP_MODE_REFRACTION";break}return e}function jie(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case a1:e="ENVMAP_BLENDING_MULTIPLY";break;case m6:e="ENVMAP_BLENDING_MIX";break;case g6:e="ENVMAP_BLENDING_ADD";break}return e}function qie(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function Zie(n,e,t,i){const r=n.getContext(),a=t.defines;let l=t.vertexShader,s=t.fragmentShader;const d=Gie(t),m=Wie(t),_=Hie(t),S=jie(t),T=qie(t),C=t.isWebGL2?"":zie(t),P=Oie(a),k=r.createProgram();let R,O,F=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(R=[P].filter(bx).join(`
`),R.length>0&&(R+=`
`),O=[C,P].filter(bx).join(`
`),O.length>0&&(O+=`
`)):(R=[IO(t),"#define SHADER_NAME "+t.shaderName,P,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+_:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(bx).join(`
`),O=[C,IO(t),"#define SHADER_NAME "+t.shaderName,P,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+m:"",t.envMap?"#define "+_:"",t.envMap?"#define "+S:"",T?"#define CUBEUV_TEXEL_WIDTH "+T.texelWidth:"",T?"#define CUBEUV_TEXEL_HEIGHT "+T.texelHeight:"",T?"#define CUBEUV_MAX_MIP "+T.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Au?"#define TONE_MAPPING":"",t.toneMapping!==Au?Ii.tonemapping_pars_fragment:"",t.toneMapping!==Au?Rie("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ii.encodings_pars_fragment,Lie("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(bx).join(`
`)),l=tI(l),l=EO(l,t),l=AO(l,t),s=tI(s),s=EO(s,t),s=AO(s,t),l=CO(l),s=CO(s),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(F=`#version 300 es
`,R=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+R,O=["#define varying in",t.glslVersion===KC?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===KC?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+O);const N=F+R+l,G=F+O+s,j=MO(r,35633,N),Q=MO(r,35632,G);if(r.attachShader(k,j),r.attachShader(k,Q),t.index0AttributeName!==void 0?r.bindAttribLocation(k,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(k,0,"position"),r.linkProgram(k),n.debug.checkShaderErrors){const ne=r.getProgramInfoLog(k).trim(),ue=r.getShaderInfoLog(j).trim(),De=r.getShaderInfoLog(Q).trim();let $e=!0,ae=!0;if(r.getProgramParameter(k,35714)===!1){$e=!1;const le=TO(r,j,"vertex"),fe=TO(r,Q,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(k,35715)+`

Program Info Log: `+ne+`
`+le+`
`+fe)}else ne!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ne):(ue===""||De==="")&&(ae=!1);ae&&(this.diagnostics={runnable:$e,programLog:ne,vertexShader:{log:ue,prefix:R},fragmentShader:{log:De,prefix:O}})}r.deleteShader(j),r.deleteShader(Q);let re;this.getUniforms=function(){return re===void 0&&(re=new cS(r,k)),re};let $;return this.getAttributes=function(){return $===void 0&&($=Fie(r,k)),$},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(k),this.program=void 0},this.name=t.shaderName,this.id=Pie++,this.cacheKey=e,this.usedTimes=1,this.program=k,this.vertexShader=j,this.fragmentShader=Q,this}let $ie=0;class Xie{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),a=this._getShaderStage(i),l=this._getShaderCacheForMaterial(e);return l.has(r)===!1&&(l.add(r),r.usedTimes++),l.has(a)===!1&&(l.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new Yie(e),t.set(e,i)),i}}class Yie{constructor(e){this.id=$ie++,this.code=e,this.usedTimes=0}}function Jie(n,e,t,i,r,a,l){const s=new eg,d=new Xie,m=[],_=r.isWebGL2,S=r.logarithmicDepthBuffer,T=r.vertexTextures;let C=r.precision;const P={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function k($,ne,ue,De,$e){const ae=De.fog,le=$e.geometry,fe=$.isMeshStandardMaterial?De.environment:null,Oe=($.isMeshStandardMaterial?t:e).get($.envMap||fe),We=Oe&&Oe.mapping===By?Oe.image.height:null,ce=P[$.type];$.precision!==null&&(C=r.getMaxPrecision($.precision),C!==$.precision&&console.warn("THREE.WebGLProgram.getParameters:",$.precision,"not supported, using",C,"instead."));const Te=le.morphAttributes.position||le.morphAttributes.normal||le.morphAttributes.color,Pe=Te!==void 0?Te.length:0;let Qe=0;le.morphAttributes.position!==void 0&&(Qe=1),le.morphAttributes.normal!==void 0&&(Qe=2),le.morphAttributes.color!==void 0&&(Qe=3);let Ne,nt,ze,et;if(ce){const Ln=vu[ce];Ne=Ln.vertexShader,nt=Ln.fragmentShader}else Ne=$.vertexShader,nt=$.fragmentShader,d.update($),ze=d.getVertexShaderID($),et=d.getFragmentShaderID($);const Et=n.getRenderTarget(),Nt=$.alphaTest>0,qt=$.clearcoat>0,wn=$.iridescence>0;return{isWebGL2:_,shaderID:ce,shaderName:$.type,vertexShader:Ne,fragmentShader:nt,defines:$.defines,customVertexShaderID:ze,customFragmentShaderID:et,isRawShaderMaterial:$.isRawShaderMaterial===!0,glslVersion:$.glslVersion,precision:C,instancing:$e.isInstancedMesh===!0,instancingColor:$e.isInstancedMesh===!0&&$e.instanceColor!==null,supportsVertexTextures:T,outputEncoding:Et===null?n.outputEncoding:Et.isXRRenderTarget===!0?Et.texture.encoding:Hd,map:!!$.map,matcap:!!$.matcap,envMap:!!Oe,envMapMode:Oe&&Oe.mapping,envMapCubeUVHeight:We,lightMap:!!$.lightMap,aoMap:!!$.aoMap,emissiveMap:!!$.emissiveMap,bumpMap:!!$.bumpMap,normalMap:!!$.normalMap,objectSpaceNormalMap:$.normalMapType===V6,tangentSpaceNormalMap:$.normalMapType===Ip,decodeVideoTexture:!!$.map&&$.map.isVideoTexture===!0&&$.map.encoding===Ar,clearcoat:qt,clearcoatMap:qt&&!!$.clearcoatMap,clearcoatRoughnessMap:qt&&!!$.clearcoatRoughnessMap,clearcoatNormalMap:qt&&!!$.clearcoatNormalMap,iridescence:wn,iridescenceMap:wn&&!!$.iridescenceMap,iridescenceThicknessMap:wn&&!!$.iridescenceThicknessMap,displacementMap:!!$.displacementMap,roughnessMap:!!$.roughnessMap,metalnessMap:!!$.metalnessMap,specularMap:!!$.specularMap,specularIntensityMap:!!$.specularIntensityMap,specularColorMap:!!$.specularColorMap,opaque:$.transparent===!1&&$.blending===Jm,alphaMap:!!$.alphaMap,alphaTest:Nt,gradientMap:!!$.gradientMap,sheen:$.sheen>0,sheenColorMap:!!$.sheenColorMap,sheenRoughnessMap:!!$.sheenRoughnessMap,transmission:$.transmission>0,transmissionMap:!!$.transmissionMap,thicknessMap:!!$.thicknessMap,combine:$.combine,vertexTangents:!!$.normalMap&&!!le.attributes.tangent,vertexColors:$.vertexColors,vertexAlphas:$.vertexColors===!0&&!!le.attributes.color&&le.attributes.color.itemSize===4,vertexUvs:!!$.map||!!$.bumpMap||!!$.normalMap||!!$.specularMap||!!$.alphaMap||!!$.emissiveMap||!!$.roughnessMap||!!$.metalnessMap||!!$.clearcoatMap||!!$.clearcoatRoughnessMap||!!$.clearcoatNormalMap||!!$.iridescenceMap||!!$.iridescenceThicknessMap||!!$.displacementMap||!!$.transmissionMap||!!$.thicknessMap||!!$.specularIntensityMap||!!$.specularColorMap||!!$.sheenColorMap||!!$.sheenRoughnessMap,uvsVertexOnly:!($.map||$.bumpMap||$.normalMap||$.specularMap||$.alphaMap||$.emissiveMap||$.roughnessMap||$.metalnessMap||$.clearcoatNormalMap||$.iridescenceMap||$.iridescenceThicknessMap||$.transmission>0||$.transmissionMap||$.thicknessMap||$.specularIntensityMap||$.specularColorMap||$.sheen>0||$.sheenColorMap||$.sheenRoughnessMap)&&!!$.displacementMap,fog:!!ae,useFog:$.fog===!0,fogExp2:ae&&ae.isFogExp2,flatShading:!!$.flatShading,sizeAttenuation:$.sizeAttenuation,logarithmicDepthBuffer:S,skinning:$e.isSkinnedMesh===!0,morphTargets:le.morphAttributes.position!==void 0,morphNormals:le.morphAttributes.normal!==void 0,morphColors:le.morphAttributes.color!==void 0,morphTargetsCount:Pe,morphTextureStride:Qe,numDirLights:ne.directional.length,numPointLights:ne.point.length,numSpotLights:ne.spot.length,numSpotLightMaps:ne.spotLightMap.length,numRectAreaLights:ne.rectArea.length,numHemiLights:ne.hemi.length,numDirLightShadows:ne.directionalShadowMap.length,numPointLightShadows:ne.pointShadowMap.length,numSpotLightShadows:ne.spotShadowMap.length,numSpotLightShadowsWithMaps:ne.numSpotLightShadowsWithMaps,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:$.dithering,shadowMapEnabled:n.shadowMap.enabled&&ue.length>0,shadowMapType:n.shadowMap.type,toneMapping:$.toneMapped?n.toneMapping:Au,useLegacyLights:n.useLegacyLights,premultipliedAlpha:$.premultipliedAlpha,doubleSided:$.side===Pd,flipSided:$.side===nl,useDepthPacking:!!$.depthPacking,depthPacking:$.depthPacking||0,index0AttributeName:$.index0AttributeName,extensionDerivatives:$.extensions&&$.extensions.derivatives,extensionFragDepth:$.extensions&&$.extensions.fragDepth,extensionDrawBuffers:$.extensions&&$.extensions.drawBuffers,extensionShaderTextureLOD:$.extensions&&$.extensions.shaderTextureLOD,rendererExtensionFragDepth:_||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:_||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:_||i.has("EXT_shader_texture_lod"),customProgramCacheKey:$.customProgramCacheKey()}}function R($){const ne=[];if($.shaderID?ne.push($.shaderID):(ne.push($.customVertexShaderID),ne.push($.customFragmentShaderID)),$.defines!==void 0)for(const ue in $.defines)ne.push(ue),ne.push($.defines[ue]);return $.isRawShaderMaterial===!1&&(O(ne,$),F(ne,$),ne.push(n.outputEncoding)),ne.push($.customProgramCacheKey),ne.join()}function O($,ne){$.push(ne.precision),$.push(ne.outputEncoding),$.push(ne.envMapMode),$.push(ne.envMapCubeUVHeight),$.push(ne.combine),$.push(ne.vertexUvs),$.push(ne.fogExp2),$.push(ne.sizeAttenuation),$.push(ne.morphTargetsCount),$.push(ne.morphAttributeCount),$.push(ne.numDirLights),$.push(ne.numPointLights),$.push(ne.numSpotLights),$.push(ne.numSpotLightMaps),$.push(ne.numHemiLights),$.push(ne.numRectAreaLights),$.push(ne.numDirLightShadows),$.push(ne.numPointLightShadows),$.push(ne.numSpotLightShadows),$.push(ne.numSpotLightShadowsWithMaps),$.push(ne.shadowMapType),$.push(ne.toneMapping),$.push(ne.numClippingPlanes),$.push(ne.numClipIntersection),$.push(ne.depthPacking)}function F($,ne){s.disableAll(),ne.isWebGL2&&s.enable(0),ne.supportsVertexTextures&&s.enable(1),ne.instancing&&s.enable(2),ne.instancingColor&&s.enable(3),ne.map&&s.enable(4),ne.matcap&&s.enable(5),ne.envMap&&s.enable(6),ne.lightMap&&s.enable(7),ne.aoMap&&s.enable(8),ne.emissiveMap&&s.enable(9),ne.bumpMap&&s.enable(10),ne.normalMap&&s.enable(11),ne.objectSpaceNormalMap&&s.enable(12),ne.tangentSpaceNormalMap&&s.enable(13),ne.clearcoat&&s.enable(14),ne.clearcoatMap&&s.enable(15),ne.clearcoatRoughnessMap&&s.enable(16),ne.clearcoatNormalMap&&s.enable(17),ne.iridescence&&s.enable(18),ne.iridescenceMap&&s.enable(19),ne.iridescenceThicknessMap&&s.enable(20),ne.displacementMap&&s.enable(21),ne.specularMap&&s.enable(22),ne.roughnessMap&&s.enable(23),ne.metalnessMap&&s.enable(24),ne.gradientMap&&s.enable(25),ne.alphaMap&&s.enable(26),ne.alphaTest&&s.enable(27),ne.vertexColors&&s.enable(28),ne.vertexAlphas&&s.enable(29),ne.vertexUvs&&s.enable(30),ne.vertexTangents&&s.enable(31),ne.uvsVertexOnly&&s.enable(32),$.push(s.mask),s.disableAll(),ne.fog&&s.enable(0),ne.useFog&&s.enable(1),ne.flatShading&&s.enable(2),ne.logarithmicDepthBuffer&&s.enable(3),ne.skinning&&s.enable(4),ne.morphTargets&&s.enable(5),ne.morphNormals&&s.enable(6),ne.morphColors&&s.enable(7),ne.premultipliedAlpha&&s.enable(8),ne.shadowMapEnabled&&s.enable(9),ne.useLegacyLights&&s.enable(10),ne.doubleSided&&s.enable(11),ne.flipSided&&s.enable(12),ne.useDepthPacking&&s.enable(13),ne.dithering&&s.enable(14),ne.specularIntensityMap&&s.enable(15),ne.specularColorMap&&s.enable(16),ne.transmission&&s.enable(17),ne.transmissionMap&&s.enable(18),ne.thicknessMap&&s.enable(19),ne.sheen&&s.enable(20),ne.sheenColorMap&&s.enable(21),ne.sheenRoughnessMap&&s.enable(22),ne.decodeVideoTexture&&s.enable(23),ne.opaque&&s.enable(24),$.push(s.mask)}function N($){const ne=P[$.type];let ue;if(ne){const De=vu[ne];ue=$6.clone(De.uniforms)}else ue=$.uniforms;return ue}function G($,ne){let ue;for(let De=0,$e=m.length;De<$e;De++){const ae=m[De];if(ae.cacheKey===ne){ue=ae,++ue.usedTimes;break}}return ue===void 0&&(ue=new Zie(n,ne,$,a),m.push(ue)),ue}function j($){if(--$.usedTimes===0){const ne=m.indexOf($);m[ne]=m[m.length-1],m.pop(),$.destroy()}}function Q($){d.remove($)}function re(){d.dispose()}return{getParameters:k,getProgramCacheKey:R,getUniforms:N,acquireProgram:G,releaseProgram:j,releaseShaderCache:Q,programs:m,dispose:re}}function Kie(){let n=new WeakMap;function e(a){let l=n.get(a);return l===void 0&&(l={},n.set(a,l)),l}function t(a){n.delete(a)}function i(a,l,s){n.get(a)[l]=s}function r(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:r}}function Qie(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function PO(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function kO(){const n=[];let e=0;const t=[],i=[],r=[];function a(){e=0,t.length=0,i.length=0,r.length=0}function l(S,T,C,P,k,R){let O=n[e];return O===void 0?(O={id:S.id,object:S,geometry:T,material:C,groupOrder:P,renderOrder:S.renderOrder,z:k,group:R},n[e]=O):(O.id=S.id,O.object=S,O.geometry=T,O.material=C,O.groupOrder=P,O.renderOrder=S.renderOrder,O.z=k,O.group=R),e++,O}function s(S,T,C,P,k,R){const O=l(S,T,C,P,k,R);C.transmission>0?i.push(O):C.transparent===!0?r.push(O):t.push(O)}function d(S,T,C,P,k,R){const O=l(S,T,C,P,k,R);C.transmission>0?i.unshift(O):C.transparent===!0?r.unshift(O):t.unshift(O)}function m(S,T){t.length>1&&t.sort(S||Qie),i.length>1&&i.sort(T||PO),r.length>1&&r.sort(T||PO)}function _(){for(let S=e,T=n.length;S<T;S++){const C=n[S];if(C.id===null)break;C.id=null,C.object=null,C.geometry=null,C.material=null,C.group=null}}return{opaque:t,transmissive:i,transparent:r,init:a,push:s,unshift:d,finish:_,sort:m}}function ere(){let n=new WeakMap;function e(i,r){const a=n.get(i);let l;return a===void 0?(l=new kO,n.set(i,[l])):r>=a.length?(l=new kO,a.push(l)):l=a[r],l}function t(){n=new WeakMap}return{get:e,dispose:t}}function tre(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Fe,color:new zn};break;case"SpotLight":t={position:new Fe,direction:new Fe,color:new zn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Fe,color:new zn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Fe,skyColor:new zn,groundColor:new zn};break;case"RectAreaLight":t={color:new zn,position:new Fe,halfWidth:new Fe,halfHeight:new Fe};break}return n[e.id]=t,t}}}function nre(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ht};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ht};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ht,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let ire=0;function rre(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function sre(n,e){const t=new tre,i=nre(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let _=0;_<9;_++)r.probe.push(new Fe);const a=new Fe,l=new vi,s=new vi;function d(_,S){let T=0,C=0,P=0;for(let De=0;De<9;De++)r.probe[De].set(0,0,0);let k=0,R=0,O=0,F=0,N=0,G=0,j=0,Q=0,re=0,$=0;_.sort(rre);const ne=S===!0?Math.PI:1;for(let De=0,$e=_.length;De<$e;De++){const ae=_[De],le=ae.color,fe=ae.intensity,Oe=ae.distance,We=ae.shadow&&ae.shadow.map?ae.shadow.map.texture:null;if(ae.isAmbientLight)T+=le.r*fe*ne,C+=le.g*fe*ne,P+=le.b*fe*ne;else if(ae.isLightProbe)for(let ce=0;ce<9;ce++)r.probe[ce].addScaledVector(ae.sh.coefficients[ce],fe);else if(ae.isDirectionalLight){const ce=t.get(ae);if(ce.color.copy(ae.color).multiplyScalar(ae.intensity*ne),ae.castShadow){const Te=ae.shadow,Pe=i.get(ae);Pe.shadowBias=Te.bias,Pe.shadowNormalBias=Te.normalBias,Pe.shadowRadius=Te.radius,Pe.shadowMapSize=Te.mapSize,r.directionalShadow[k]=Pe,r.directionalShadowMap[k]=We,r.directionalShadowMatrix[k]=ae.shadow.matrix,G++}r.directional[k]=ce,k++}else if(ae.isSpotLight){const ce=t.get(ae);ce.position.setFromMatrixPosition(ae.matrixWorld),ce.color.copy(le).multiplyScalar(fe*ne),ce.distance=Oe,ce.coneCos=Math.cos(ae.angle),ce.penumbraCos=Math.cos(ae.angle*(1-ae.penumbra)),ce.decay=ae.decay,r.spot[O]=ce;const Te=ae.shadow;if(ae.map&&(r.spotLightMap[re]=ae.map,re++,Te.updateMatrices(ae),ae.castShadow&&$++),r.spotLightMatrix[O]=Te.matrix,ae.castShadow){const Pe=i.get(ae);Pe.shadowBias=Te.bias,Pe.shadowNormalBias=Te.normalBias,Pe.shadowRadius=Te.radius,Pe.shadowMapSize=Te.mapSize,r.spotShadow[O]=Pe,r.spotShadowMap[O]=We,Q++}O++}else if(ae.isRectAreaLight){const ce=t.get(ae);ce.color.copy(le).multiplyScalar(fe),ce.halfWidth.set(ae.width*.5,0,0),ce.halfHeight.set(0,ae.height*.5,0),r.rectArea[F]=ce,F++}else if(ae.isPointLight){const ce=t.get(ae);if(ce.color.copy(ae.color).multiplyScalar(ae.intensity*ne),ce.distance=ae.distance,ce.decay=ae.decay,ae.castShadow){const Te=ae.shadow,Pe=i.get(ae);Pe.shadowBias=Te.bias,Pe.shadowNormalBias=Te.normalBias,Pe.shadowRadius=Te.radius,Pe.shadowMapSize=Te.mapSize,Pe.shadowCameraNear=Te.camera.near,Pe.shadowCameraFar=Te.camera.far,r.pointShadow[R]=Pe,r.pointShadowMap[R]=We,r.pointShadowMatrix[R]=ae.shadow.matrix,j++}r.point[R]=ce,R++}else if(ae.isHemisphereLight){const ce=t.get(ae);ce.skyColor.copy(ae.color).multiplyScalar(fe*ne),ce.groundColor.copy(ae.groundColor).multiplyScalar(fe*ne),r.hemi[N]=ce,N++}}F>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=vn.LTC_FLOAT_1,r.rectAreaLTC2=vn.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=vn.LTC_HALF_1,r.rectAreaLTC2=vn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=T,r.ambient[1]=C,r.ambient[2]=P;const ue=r.hash;(ue.directionalLength!==k||ue.pointLength!==R||ue.spotLength!==O||ue.rectAreaLength!==F||ue.hemiLength!==N||ue.numDirectionalShadows!==G||ue.numPointShadows!==j||ue.numSpotShadows!==Q||ue.numSpotMaps!==re)&&(r.directional.length=k,r.spot.length=O,r.rectArea.length=F,r.point.length=R,r.hemi.length=N,r.directionalShadow.length=G,r.directionalShadowMap.length=G,r.pointShadow.length=j,r.pointShadowMap.length=j,r.spotShadow.length=Q,r.spotShadowMap.length=Q,r.directionalShadowMatrix.length=G,r.pointShadowMatrix.length=j,r.spotLightMatrix.length=Q+re-$,r.spotLightMap.length=re,r.numSpotLightShadowsWithMaps=$,ue.directionalLength=k,ue.pointLength=R,ue.spotLength=O,ue.rectAreaLength=F,ue.hemiLength=N,ue.numDirectionalShadows=G,ue.numPointShadows=j,ue.numSpotShadows=Q,ue.numSpotMaps=re,r.version=ire++)}function m(_,S){let T=0,C=0,P=0,k=0,R=0;const O=S.matrixWorldInverse;for(let F=0,N=_.length;F<N;F++){const G=_[F];if(G.isDirectionalLight){const j=r.directional[T];j.direction.setFromMatrixPosition(G.matrixWorld),a.setFromMatrixPosition(G.target.matrixWorld),j.direction.sub(a),j.direction.transformDirection(O),T++}else if(G.isSpotLight){const j=r.spot[P];j.position.setFromMatrixPosition(G.matrixWorld),j.position.applyMatrix4(O),j.direction.setFromMatrixPosition(G.matrixWorld),a.setFromMatrixPosition(G.target.matrixWorld),j.direction.sub(a),j.direction.transformDirection(O),P++}else if(G.isRectAreaLight){const j=r.rectArea[k];j.position.setFromMatrixPosition(G.matrixWorld),j.position.applyMatrix4(O),s.identity(),l.copy(G.matrixWorld),l.premultiply(O),s.extractRotation(l),j.halfWidth.set(G.width*.5,0,0),j.halfHeight.set(0,G.height*.5,0),j.halfWidth.applyMatrix4(s),j.halfHeight.applyMatrix4(s),k++}else if(G.isPointLight){const j=r.point[C];j.position.setFromMatrixPosition(G.matrixWorld),j.position.applyMatrix4(O),C++}else if(G.isHemisphereLight){const j=r.hemi[R];j.direction.setFromMatrixPosition(G.matrixWorld),j.direction.transformDirection(O),R++}}}return{setup:d,setupView:m,state:r}}function DO(n,e){const t=new sre(n,e),i=[],r=[];function a(){i.length=0,r.length=0}function l(S){i.push(S)}function s(S){r.push(S)}function d(S){t.setup(i,S)}function m(S){t.setupView(i,S)}return{init:a,state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:d,setupLightsView:m,pushLight:l,pushShadow:s}}function ore(n,e){let t=new WeakMap;function i(a,l=0){const s=t.get(a);let d;return s===void 0?(d=new DO(n,e),t.set(a,[d])):l>=s.length?(d=new DO(n,e),s.push(d)):d=s[l],d}function r(){t=new WeakMap}return{get:i,dispose:r}}class uk extends No{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=N6,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class hk extends No{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Fe,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const are=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,lre=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function cre(n,e,t){let i=new HM;const r=new Ht,a=new Ht,l=new br,s=new uk({depthPacking:U6}),d=new hk,m={},_=t.maxTextureSize,S={[Gd]:nl,[nl]:Gd,[Pd]:Pd},T=new Sh({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ht},radius:{value:4}},vertexShader:are,fragmentShader:lre}),C=T.clone();C.defines.HORIZONTAL_PASS=1;const P=new Pi;P.setAttribute("position",new zr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const k=new Oo(P,T),R=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=UM,this.render=function(G,j,Q){if(R.enabled===!1||R.autoUpdate===!1&&R.needsUpdate===!1||G.length===0)return;const re=n.getRenderTarget(),$=n.getActiveCubeFace(),ne=n.getActiveMipmapLevel(),ue=n.state;ue.setBlending(Rd),ue.buffers.color.setClear(1,1,1,1),ue.buffers.depth.setTest(!0),ue.setScissorTest(!1);for(let De=0,$e=G.length;De<$e;De++){const ae=G[De],le=ae.shadow;if(le===void 0){console.warn("THREE.WebGLShadowMap:",ae,"has no shadow.");continue}if(le.autoUpdate===!1&&le.needsUpdate===!1)continue;r.copy(le.mapSize);const fe=le.getFrameExtents();if(r.multiply(fe),a.copy(le.mapSize),(r.x>_||r.y>_)&&(r.x>_&&(a.x=Math.floor(_/fe.x),r.x=a.x*fe.x,le.mapSize.x=a.x),r.y>_&&(a.y=Math.floor(_/fe.y),r.y=a.y*fe.y,le.mapSize.y=a.y)),le.map===null){const We=this.type!==Bm?{minFilter:Ls,magFilter:Ls}:{};le.map=new Pu(r.x,r.y,We),le.map.texture.name=ae.name+".shadowMap",le.camera.updateProjectionMatrix()}n.setRenderTarget(le.map),n.clear();const Oe=le.getViewportCount();for(let We=0;We<Oe;We++){const ce=le.getViewport(We);l.set(a.x*ce.x,a.y*ce.y,a.x*ce.z,a.y*ce.w),ue.viewport(l),le.updateMatrices(ae,We),i=le.getFrustum(),N(j,Q,le.camera,ae,this.type)}le.isPointLightShadow!==!0&&this.type===Bm&&O(le,Q),le.needsUpdate=!1}R.needsUpdate=!1,n.setRenderTarget(re,$,ne)};function O(G,j){const Q=e.update(k);T.defines.VSM_SAMPLES!==G.blurSamples&&(T.defines.VSM_SAMPLES=G.blurSamples,C.defines.VSM_SAMPLES=G.blurSamples,T.needsUpdate=!0,C.needsUpdate=!0),G.mapPass===null&&(G.mapPass=new Pu(r.x,r.y)),T.uniforms.shadow_pass.value=G.map.texture,T.uniforms.resolution.value=G.mapSize,T.uniforms.radius.value=G.radius,n.setRenderTarget(G.mapPass),n.clear(),n.renderBufferDirect(j,null,Q,T,k,null),C.uniforms.shadow_pass.value=G.mapPass.texture,C.uniforms.resolution.value=G.mapSize,C.uniforms.radius.value=G.radius,n.setRenderTarget(G.map),n.clear(),n.renderBufferDirect(j,null,Q,C,k,null)}function F(G,j,Q,re,$,ne){let ue=null;const De=Q.isPointLight===!0?G.customDistanceMaterial:G.customDepthMaterial;if(De!==void 0)ue=De;else if(ue=Q.isPointLight===!0?d:s,n.localClippingEnabled&&j.clipShadows===!0&&Array.isArray(j.clippingPlanes)&&j.clippingPlanes.length!==0||j.displacementMap&&j.displacementScale!==0||j.alphaMap&&j.alphaTest>0||j.map&&j.alphaTest>0){const $e=ue.uuid,ae=j.uuid;let le=m[$e];le===void 0&&(le={},m[$e]=le);let fe=le[ae];fe===void 0&&(fe=ue.clone(),le[ae]=fe),ue=fe}return ue.visible=j.visible,ue.wireframe=j.wireframe,ne===Bm?ue.side=j.shadowSide!==null?j.shadowSide:j.side:ue.side=j.shadowSide!==null?j.shadowSide:S[j.side],ue.alphaMap=j.alphaMap,ue.alphaTest=j.alphaTest,ue.map=j.map,ue.clipShadows=j.clipShadows,ue.clippingPlanes=j.clippingPlanes,ue.clipIntersection=j.clipIntersection,ue.displacementMap=j.displacementMap,ue.displacementScale=j.displacementScale,ue.displacementBias=j.displacementBias,ue.wireframeLinewidth=j.wireframeLinewidth,ue.linewidth=j.linewidth,Q.isPointLight===!0&&ue.isMeshDistanceMaterial===!0&&(ue.referencePosition.setFromMatrixPosition(Q.matrixWorld),ue.nearDistance=re,ue.farDistance=$),ue}function N(G,j,Q,re,$){if(G.visible===!1)return;if(G.layers.test(j.layers)&&(G.isMesh||G.isLine||G.isPoints)&&(G.castShadow||G.receiveShadow&&$===Bm)&&(!G.frustumCulled||i.intersectsObject(G))){G.modelViewMatrix.multiplyMatrices(Q.matrixWorldInverse,G.matrixWorld);const De=e.update(G),$e=G.material;if(Array.isArray($e)){const ae=De.groups;for(let le=0,fe=ae.length;le<fe;le++){const Oe=ae[le],We=$e[Oe.materialIndex];if(We&&We.visible){const ce=F(G,We,re,Q.near,Q.far,$);n.renderBufferDirect(Q,null,De,ce,G,Oe)}}}else if($e.visible){const ae=F(G,$e,re,Q.near,Q.far,$);n.renderBufferDirect(Q,null,De,ae,G,null)}}const ue=G.children;for(let De=0,$e=ue.length;De<$e;De++)N(ue[De],j,Q,re,$)}}function ure(n,e,t){const i=t.isWebGL2;function r(){let rt=!1;const Ct=new br;let Vt=null;const bn=new br(0,0,0,0);return{setMask:function(Pn){Vt!==Pn&&!rt&&(n.colorMask(Pn,Pn,Pn,Pn),Vt=Pn)},setLocked:function(Pn){rt=Pn},setClear:function(Pn,Ri,cr,Or,Cr){Cr===!0&&(Pn*=Or,Ri*=Or,cr*=Or),Ct.set(Pn,Ri,cr,Or),bn.equals(Ct)===!1&&(n.clearColor(Pn,Ri,cr,Or),bn.copy(Ct))},reset:function(){rt=!1,Vt=null,bn.set(-1,0,0,0)}}}function a(){let rt=!1,Ct=null,Vt=null,bn=null;return{setTest:function(Pn){Pn?Nt(2929):qt(2929)},setMask:function(Pn){Ct!==Pn&&!rt&&(n.depthMask(Pn),Ct=Pn)},setFunc:function(Pn){if(Vt!==Pn){switch(Pn){case l6:n.depthFunc(512);break;case c6:n.depthFunc(519);break;case u6:n.depthFunc(513);break;case nM:n.depthFunc(515);break;case h6:n.depthFunc(514);break;case d6:n.depthFunc(518);break;case f6:n.depthFunc(516);break;case p6:n.depthFunc(517);break;default:n.depthFunc(515)}Vt=Pn}},setLocked:function(Pn){rt=Pn},setClear:function(Pn){bn!==Pn&&(n.clearDepth(Pn),bn=Pn)},reset:function(){rt=!1,Ct=null,Vt=null,bn=null}}}function l(){let rt=!1,Ct=null,Vt=null,bn=null,Pn=null,Ri=null,cr=null,Or=null,Cr=null;return{setTest:function(Gi){rt||(Gi?Nt(2960):qt(2960))},setMask:function(Gi){Ct!==Gi&&!rt&&(n.stencilMask(Gi),Ct=Gi)},setFunc:function(Gi,Kr,Ee){(Vt!==Gi||bn!==Kr||Pn!==Ee)&&(n.stencilFunc(Gi,Kr,Ee),Vt=Gi,bn=Kr,Pn=Ee)},setOp:function(Gi,Kr,Ee){(Ri!==Gi||cr!==Kr||Or!==Ee)&&(n.stencilOp(Gi,Kr,Ee),Ri=Gi,cr=Kr,Or=Ee)},setLocked:function(Gi){rt=Gi},setClear:function(Gi){Cr!==Gi&&(n.clearStencil(Gi),Cr=Gi)},reset:function(){rt=!1,Ct=null,Vt=null,bn=null,Pn=null,Ri=null,cr=null,Or=null,Cr=null}}}const s=new r,d=new a,m=new l,_=new WeakMap,S=new WeakMap;let T={},C={},P=new WeakMap,k=[],R=null,O=!1,F=null,N=null,G=null,j=null,Q=null,re=null,$=null,ne=!1,ue=null,De=null,$e=null,ae=null,le=null;const fe=n.getParameter(35661);let Oe=!1,We=0;const ce=n.getParameter(7938);ce.indexOf("WebGL")!==-1?(We=parseFloat(/^WebGL (\d)/.exec(ce)[1]),Oe=We>=1):ce.indexOf("OpenGL ES")!==-1&&(We=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),Oe=We>=2);let Te=null,Pe={};const Qe=n.getParameter(3088),Ne=n.getParameter(2978),nt=new br().fromArray(Qe),ze=new br().fromArray(Ne);function et(rt,Ct,Vt){const bn=new Uint8Array(4),Pn=n.createTexture();n.bindTexture(rt,Pn),n.texParameteri(rt,10241,9728),n.texParameteri(rt,10240,9728);for(let Ri=0;Ri<Vt;Ri++)n.texImage2D(Ct+Ri,0,6408,1,1,0,6408,5121,bn);return Pn}const Et={};Et[3553]=et(3553,3553,1),Et[34067]=et(34067,34069,6),s.setClear(0,0,0,1),d.setClear(1),m.setClear(0),Nt(2929),d.setFunc(nM),pn(!1),Vn(SC),Nt(2884),Ft(Rd);function Nt(rt){T[rt]!==!0&&(n.enable(rt),T[rt]=!0)}function qt(rt){T[rt]!==!1&&(n.disable(rt),T[rt]=!1)}function wn(rt,Ct){return C[rt]!==Ct?(n.bindFramebuffer(rt,Ct),C[rt]=Ct,i&&(rt===36009&&(C[36160]=Ct),rt===36160&&(C[36009]=Ct)),!0):!1}function _n(rt,Ct){let Vt=k,bn=!1;if(rt)if(Vt=P.get(Ct),Vt===void 0&&(Vt=[],P.set(Ct,Vt)),rt.isWebGLMultipleRenderTargets){const Pn=rt.texture;if(Vt.length!==Pn.length||Vt[0]!==36064){for(let Ri=0,cr=Pn.length;Ri<cr;Ri++)Vt[Ri]=36064+Ri;Vt.length=Pn.length,bn=!0}}else Vt[0]!==36064&&(Vt[0]=36064,bn=!0);else Vt[0]!==1029&&(Vt[0]=1029,bn=!0);bn&&(t.isWebGL2?n.drawBuffers(Vt):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Vt))}function Ln(rt){return R!==rt?(n.useProgram(rt),R=rt,!0):!1}const At={[km]:32774,[JU]:32778,[KU]:32779};if(i)At[AC]=32775,At[CC]=32776;else{const rt=e.get("EXT_blend_minmax");rt!==null&&(At[AC]=rt.MIN_EXT,At[CC]=rt.MAX_EXT)}const Ot={[QU]:0,[e6]:1,[t6]:768,[JP]:770,[a6]:776,[s6]:774,[i6]:772,[n6]:769,[KP]:771,[o6]:775,[r6]:773};function Ft(rt,Ct,Vt,bn,Pn,Ri,cr,Or){if(rt===Rd){O===!0&&(qt(3042),O=!1);return}if(O===!1&&(Nt(3042),O=!0),rt!==YU){if(rt!==F||Or!==ne){if((N!==km||Q!==km)&&(n.blendEquation(32774),N=km,Q=km),Or)switch(rt){case Jm:n.blendFuncSeparate(1,771,1,771);break;case MC:n.blendFunc(1,1);break;case TC:n.blendFuncSeparate(0,769,0,1);break;case EC:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",rt);break}else switch(rt){case Jm:n.blendFuncSeparate(770,771,1,771);break;case MC:n.blendFunc(770,1);break;case TC:n.blendFuncSeparate(0,769,0,1);break;case EC:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",rt);break}G=null,j=null,re=null,$=null,F=rt,ne=Or}return}Pn=Pn||Ct,Ri=Ri||Vt,cr=cr||bn,(Ct!==N||Pn!==Q)&&(n.blendEquationSeparate(At[Ct],At[Pn]),N=Ct,Q=Pn),(Vt!==G||bn!==j||Ri!==re||cr!==$)&&(n.blendFuncSeparate(Ot[Vt],Ot[bn],Ot[Ri],Ot[cr]),G=Vt,j=bn,re=Ri,$=cr),F=rt,ne=!1}function An(rt,Ct){rt.side===Pd?qt(2884):Nt(2884);let Vt=rt.side===nl;Ct&&(Vt=!Vt),pn(Vt),rt.blending===Jm&&rt.transparent===!1?Ft(Rd):Ft(rt.blending,rt.blendEquation,rt.blendSrc,rt.blendDst,rt.blendEquationAlpha,rt.blendSrcAlpha,rt.blendDstAlpha,rt.premultipliedAlpha),d.setFunc(rt.depthFunc),d.setTest(rt.depthTest),d.setMask(rt.depthWrite),s.setMask(rt.colorWrite);const bn=rt.stencilWrite;m.setTest(bn),bn&&(m.setMask(rt.stencilWriteMask),m.setFunc(rt.stencilFunc,rt.stencilRef,rt.stencilFuncMask),m.setOp(rt.stencilFail,rt.stencilZFail,rt.stencilZPass)),Zn(rt.polygonOffset,rt.polygonOffsetFactor,rt.polygonOffsetUnits),rt.alphaToCoverage===!0?Nt(32926):qt(32926)}function pn(rt){ue!==rt&&(rt?n.frontFace(2304):n.frontFace(2305),ue=rt)}function Vn(rt){rt!==ZU?(Nt(2884),rt!==De&&(rt===SC?n.cullFace(1029):rt===$U?n.cullFace(1028):n.cullFace(1032))):qt(2884),De=rt}function On(rt){rt!==$e&&(Oe&&n.lineWidth(rt),$e=rt)}function Zn(rt,Ct,Vt){rt?(Nt(32823),(ae!==Ct||le!==Vt)&&(n.polygonOffset(Ct,Vt),ae=Ct,le=Vt)):qt(32823)}function ai(rt){rt?Nt(3089):qt(3089)}function Ti(rt){rt===void 0&&(rt=33984+fe-1),Te!==rt&&(n.activeTexture(rt),Te=rt)}function Be(rt,Ct,Vt){Vt===void 0&&(Te===null?Vt=33984+fe-1:Vt=Te);let bn=Pe[Vt];bn===void 0&&(bn={type:void 0,texture:void 0},Pe[Vt]=bn),(bn.type!==rt||bn.texture!==Ct)&&(Te!==Vt&&(n.activeTexture(Vt),Te=Vt),n.bindTexture(rt,Ct||Et[rt]),bn.type=rt,bn.texture=Ct)}function Se(){const rt=Pe[Te];rt!==void 0&&rt.type!==void 0&&(n.bindTexture(rt.type,null),rt.type=void 0,rt.texture=void 0)}function St(){try{n.compressedTexImage2D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function tn(){try{n.compressedTexImage3D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function nn(){try{n.texSubImage2D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function fn(){try{n.texSubImage3D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function Nn(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function yn(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function Lt(){try{n.texStorage2D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function Un(){try{n.texStorage3D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function Ke(){try{n.texImage2D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function It(){try{n.texImage3D.apply(n,arguments)}catch(rt){console.error("THREE.WebGLState:",rt)}}function Zt(rt){nt.equals(rt)===!1&&(n.scissor(rt.x,rt.y,rt.z,rt.w),nt.copy(rt))}function sn(rt){ze.equals(rt)===!1&&(n.viewport(rt.x,rt.y,rt.z,rt.w),ze.copy(rt))}function Yn(rt,Ct){let Vt=S.get(Ct);Vt===void 0&&(Vt=new WeakMap,S.set(Ct,Vt));let bn=Vt.get(rt);bn===void 0&&(bn=n.getUniformBlockIndex(Ct,rt.name),Vt.set(rt,bn))}function li(rt,Ct){const bn=S.get(Ct).get(rt);_.get(Ct)!==bn&&(n.uniformBlockBinding(Ct,bn,rt.__bindingPointIndex),_.set(Ct,bn))}function Bi(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),i===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),T={},Te=null,Pe={},C={},P=new WeakMap,k=[],R=null,O=!1,F=null,N=null,G=null,j=null,Q=null,re=null,$=null,ne=!1,ue=null,De=null,$e=null,ae=null,le=null,nt.set(0,0,n.canvas.width,n.canvas.height),ze.set(0,0,n.canvas.width,n.canvas.height),s.reset(),d.reset(),m.reset()}return{buffers:{color:s,depth:d,stencil:m},enable:Nt,disable:qt,bindFramebuffer:wn,drawBuffers:_n,useProgram:Ln,setBlending:Ft,setMaterial:An,setFlipSided:pn,setCullFace:Vn,setLineWidth:On,setPolygonOffset:Zn,setScissorTest:ai,activeTexture:Ti,bindTexture:Be,unbindTexture:Se,compressedTexImage2D:St,compressedTexImage3D:tn,texImage2D:Ke,texImage3D:It,updateUBOMapping:Yn,uniformBlockBinding:li,texStorage2D:Lt,texStorage3D:Un,texSubImage2D:nn,texSubImage3D:fn,compressedTexSubImage2D:Nn,compressedTexSubImage3D:yn,scissor:Zt,viewport:sn,reset:Bi}}function hre(n,e,t,i,r,a,l){const s=r.isWebGL2,d=r.maxTextures,m=r.maxCubemapSize,_=r.maxTextureSize,S=r.maxSamples,T=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,C=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),P=new WeakMap;let k;const R=new WeakMap;let O=!1;try{O=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function F(Be,Se){return O?new OffscreenCanvas(Be,Se):kv("canvas")}function N(Be,Se,St,tn){let nn=1;if((Be.width>tn||Be.height>tn)&&(nn=tn/Math.max(Be.width,Be.height)),nn<1||Se===!0)if(typeof HTMLImageElement<"u"&&Be instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Be instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Be instanceof ImageBitmap){const fn=Se?H6:Math.floor,Nn=fn(nn*Be.width),yn=fn(nn*Be.height);k===void 0&&(k=F(Nn,yn));const Lt=St?F(Nn,yn):k;return Lt.width=Nn,Lt.height=yn,Lt.getContext("2d").drawImage(Be,0,0,Nn,yn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Be.width+"x"+Be.height+") to ("+Nn+"x"+yn+")."),Lt}else return"data"in Be&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Be.width+"x"+Be.height+")."),Be;return Be}function G(Be){return QC(Be.width)&&QC(Be.height)}function j(Be){return s?!1:Be.wrapS!==la||Be.wrapT!==la||Be.minFilter!==Ls&&Be.minFilter!==zs}function Q(Be,Se){return Be.generateMipmaps&&Se&&Be.minFilter!==Ls&&Be.minFilter!==zs}function re(Be){n.generateMipmap(Be)}function $(Be,Se,St,tn,nn=!1){if(s===!1)return Se;if(Be!==null){if(n[Be]!==void 0)return n[Be];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Be+"'")}let fn=Se;return Se===6403&&(St===5126&&(fn=33326),St===5131&&(fn=33325),St===5121&&(fn=33321)),Se===33319&&(St===5126&&(fn=33328),St===5131&&(fn=33327),St===5121&&(fn=33323)),Se===6408&&(St===5126&&(fn=34836),St===5131&&(fn=34842),St===5121&&(fn=tn===Ar&&nn===!1?35907:32856),St===32819&&(fn=32854),St===32820&&(fn=32855)),(fn===33325||fn===33326||fn===33327||fn===33328||fn===34842||fn===34836)&&e.get("EXT_color_buffer_float"),fn}function ne(Be,Se,St){return Q(Be,St)===!0||Be.isFramebufferTexture&&Be.minFilter!==Ls&&Be.minFilter!==zs?Math.log2(Math.max(Se.width,Se.height))+1:Be.mipmaps!==void 0&&Be.mipmaps.length>0?Be.mipmaps.length:Be.isCompressedTexture&&Array.isArray(Be.image)?Se.mipmaps.length:1}function ue(Be){return Be===Ls||Be===iM||Be===Wx?9728:9729}function De(Be){const Se=Be.target;Se.removeEventListener("dispose",De),ae(Se),Se.isVideoTexture&&P.delete(Se)}function $e(Be){const Se=Be.target;Se.removeEventListener("dispose",$e),fe(Se)}function ae(Be){const Se=i.get(Be);if(Se.__webglInit===void 0)return;const St=Be.source,tn=R.get(St);if(tn){const nn=tn[Se.__cacheKey];nn.usedTimes--,nn.usedTimes===0&&le(Be),Object.keys(tn).length===0&&R.delete(St)}i.remove(Be)}function le(Be){const Se=i.get(Be);n.deleteTexture(Se.__webglTexture);const St=Be.source,tn=R.get(St);delete tn[Se.__cacheKey],l.memory.textures--}function fe(Be){const Se=Be.texture,St=i.get(Be),tn=i.get(Se);if(tn.__webglTexture!==void 0&&(n.deleteTexture(tn.__webglTexture),l.memory.textures--),Be.depthTexture&&Be.depthTexture.dispose(),Be.isWebGLCubeRenderTarget)for(let nn=0;nn<6;nn++)n.deleteFramebuffer(St.__webglFramebuffer[nn]),St.__webglDepthbuffer&&n.deleteRenderbuffer(St.__webglDepthbuffer[nn]);else{if(n.deleteFramebuffer(St.__webglFramebuffer),St.__webglDepthbuffer&&n.deleteRenderbuffer(St.__webglDepthbuffer),St.__webglMultisampledFramebuffer&&n.deleteFramebuffer(St.__webglMultisampledFramebuffer),St.__webglColorRenderbuffer)for(let nn=0;nn<St.__webglColorRenderbuffer.length;nn++)St.__webglColorRenderbuffer[nn]&&n.deleteRenderbuffer(St.__webglColorRenderbuffer[nn]);St.__webglDepthRenderbuffer&&n.deleteRenderbuffer(St.__webglDepthRenderbuffer)}if(Be.isWebGLMultipleRenderTargets)for(let nn=0,fn=Se.length;nn<fn;nn++){const Nn=i.get(Se[nn]);Nn.__webglTexture&&(n.deleteTexture(Nn.__webglTexture),l.memory.textures--),i.remove(Se[nn])}i.remove(Se),i.remove(Be)}let Oe=0;function We(){Oe=0}function ce(){const Be=Oe;return Be>=d&&console.warn("THREE.WebGLTextures: Trying to use "+Be+" texture units while this GPU supports only "+d),Oe+=1,Be}function Te(Be){const Se=[];return Se.push(Be.wrapS),Se.push(Be.wrapT),Se.push(Be.wrapR||0),Se.push(Be.magFilter),Se.push(Be.minFilter),Se.push(Be.anisotropy),Se.push(Be.internalFormat),Se.push(Be.format),Se.push(Be.type),Se.push(Be.generateMipmaps),Se.push(Be.premultiplyAlpha),Se.push(Be.flipY),Se.push(Be.unpackAlignment),Se.push(Be.encoding),Se.join()}function Pe(Be,Se){const St=i.get(Be);if(Be.isVideoTexture&&ai(Be),Be.isRenderTargetTexture===!1&&Be.version>0&&St.__version!==Be.version){const tn=Be.image;if(tn===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(tn.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{qt(St,Be,Se);return}}t.bindTexture(3553,St.__webglTexture,33984+Se)}function Qe(Be,Se){const St=i.get(Be);if(Be.version>0&&St.__version!==Be.version){qt(St,Be,Se);return}t.bindTexture(35866,St.__webglTexture,33984+Se)}function Ne(Be,Se){const St=i.get(Be);if(Be.version>0&&St.__version!==Be.version){qt(St,Be,Se);return}t.bindTexture(32879,St.__webglTexture,33984+Se)}function nt(Be,Se){const St=i.get(Be);if(Be.version>0&&St.__version!==Be.version){wn(St,Be,Se);return}t.bindTexture(34067,St.__webglTexture,33984+Se)}const ze={[Mv]:10497,[la]:33071,[Tv]:33648},et={[Ls]:9728,[iM]:9984,[Wx]:9986,[zs]:9729,[ek]:9985,[bp]:9987};function Et(Be,Se,St){if(St?(n.texParameteri(Be,10242,ze[Se.wrapS]),n.texParameteri(Be,10243,ze[Se.wrapT]),(Be===32879||Be===35866)&&n.texParameteri(Be,32882,ze[Se.wrapR]),n.texParameteri(Be,10240,et[Se.magFilter]),n.texParameteri(Be,10241,et[Se.minFilter])):(n.texParameteri(Be,10242,33071),n.texParameteri(Be,10243,33071),(Be===32879||Be===35866)&&n.texParameteri(Be,32882,33071),(Se.wrapS!==la||Se.wrapT!==la)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(Be,10240,ue(Se.magFilter)),n.texParameteri(Be,10241,ue(Se.minFilter)),Se.minFilter!==Ls&&Se.minFilter!==zs&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const tn=e.get("EXT_texture_filter_anisotropic");if(Se.magFilter===Ls||Se.minFilter!==Wx&&Se.minFilter!==bp||Se.type===kd&&e.has("OES_texture_float_linear")===!1||s===!1&&Se.type===Ty&&e.has("OES_texture_half_float_linear")===!1)return;(Se.anisotropy>1||i.get(Se).__currentAnisotropy)&&(n.texParameterf(Be,tn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Se.anisotropy,r.getMaxAnisotropy())),i.get(Se).__currentAnisotropy=Se.anisotropy)}}function Nt(Be,Se){let St=!1;Be.__webglInit===void 0&&(Be.__webglInit=!0,Se.addEventListener("dispose",De));const tn=Se.source;let nn=R.get(tn);nn===void 0&&(nn={},R.set(tn,nn));const fn=Te(Se);if(fn!==Be.__cacheKey){nn[fn]===void 0&&(nn[fn]={texture:n.createTexture(),usedTimes:0},l.memory.textures++,St=!0),nn[fn].usedTimes++;const Nn=nn[Be.__cacheKey];Nn!==void 0&&(nn[Be.__cacheKey].usedTimes--,Nn.usedTimes===0&&le(Se)),Be.__cacheKey=fn,Be.__webglTexture=nn[fn].texture}return St}function qt(Be,Se,St){let tn=3553;(Se.isDataArrayTexture||Se.isCompressedArrayTexture)&&(tn=35866),Se.isData3DTexture&&(tn=32879);const nn=Nt(Be,Se),fn=Se.source;t.bindTexture(tn,Be.__webglTexture,33984+St);const Nn=i.get(fn);if(fn.version!==Nn.__version||nn===!0){t.activeTexture(33984+St),n.pixelStorei(37440,Se.flipY),n.pixelStorei(37441,Se.premultiplyAlpha),n.pixelStorei(3317,Se.unpackAlignment),n.pixelStorei(37443,0);const yn=j(Se)&&G(Se.image)===!1;let Lt=N(Se.image,yn,!1,_);Lt=Ti(Se,Lt);const Un=G(Lt)||s,Ke=a.convert(Se.format,Se.encoding);let It=a.convert(Se.type),Zt=$(Se.internalFormat,Ke,It,Se.encoding,Se.isVideoTexture);Et(tn,Se,Un);let sn;const Yn=Se.mipmaps,li=s&&Se.isVideoTexture!==!0,Bi=Nn.__version===void 0||nn===!0,rt=ne(Se,Lt,Un);if(Se.isDepthTexture)Zt=6402,s?Se.type===kd?Zt=36012:Se.type===Kf?Zt=33190:Se.type===Km?Zt=35056:Zt=33189:Se.type===kd&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Se.format===dp&&Zt===6402&&Se.type!==tk&&Se.type!==Kf&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Se.type=Kf,It=a.convert(Se.type)),Se.format===hg&&Zt===6402&&(Zt=34041,Se.type!==Km&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Se.type=Km,It=a.convert(Se.type))),Bi&&(li?t.texStorage2D(3553,1,Zt,Lt.width,Lt.height):t.texImage2D(3553,0,Zt,Lt.width,Lt.height,0,Ke,It,null));else if(Se.isDataTexture)if(Yn.length>0&&Un){li&&Bi&&t.texStorage2D(3553,rt,Zt,Yn[0].width,Yn[0].height);for(let Ct=0,Vt=Yn.length;Ct<Vt;Ct++)sn=Yn[Ct],li?t.texSubImage2D(3553,Ct,0,0,sn.width,sn.height,Ke,It,sn.data):t.texImage2D(3553,Ct,Zt,sn.width,sn.height,0,Ke,It,sn.data);Se.generateMipmaps=!1}else li?(Bi&&t.texStorage2D(3553,rt,Zt,Lt.width,Lt.height),t.texSubImage2D(3553,0,0,0,Lt.width,Lt.height,Ke,It,Lt.data)):t.texImage2D(3553,0,Zt,Lt.width,Lt.height,0,Ke,It,Lt.data);else if(Se.isCompressedTexture)if(Se.isCompressedArrayTexture){li&&Bi&&t.texStorage3D(35866,rt,Zt,Yn[0].width,Yn[0].height,Lt.depth);for(let Ct=0,Vt=Yn.length;Ct<Vt;Ct++)sn=Yn[Ct],Se.format!==$a?Ke!==null?li?t.compressedTexSubImage3D(35866,Ct,0,0,0,sn.width,sn.height,Lt.depth,Ke,sn.data,0,0):t.compressedTexImage3D(35866,Ct,Zt,sn.width,sn.height,Lt.depth,0,sn.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):li?t.texSubImage3D(35866,Ct,0,0,0,sn.width,sn.height,Lt.depth,Ke,It,sn.data):t.texImage3D(35866,Ct,Zt,sn.width,sn.height,Lt.depth,0,Ke,It,sn.data)}else{li&&Bi&&t.texStorage2D(3553,rt,Zt,Yn[0].width,Yn[0].height);for(let Ct=0,Vt=Yn.length;Ct<Vt;Ct++)sn=Yn[Ct],Se.format!==$a?Ke!==null?li?t.compressedTexSubImage2D(3553,Ct,0,0,sn.width,sn.height,Ke,sn.data):t.compressedTexImage2D(3553,Ct,Zt,sn.width,sn.height,0,sn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):li?t.texSubImage2D(3553,Ct,0,0,sn.width,sn.height,Ke,It,sn.data):t.texImage2D(3553,Ct,Zt,sn.width,sn.height,0,Ke,It,sn.data)}else if(Se.isDataArrayTexture)li?(Bi&&t.texStorage3D(35866,rt,Zt,Lt.width,Lt.height,Lt.depth),t.texSubImage3D(35866,0,0,0,0,Lt.width,Lt.height,Lt.depth,Ke,It,Lt.data)):t.texImage3D(35866,0,Zt,Lt.width,Lt.height,Lt.depth,0,Ke,It,Lt.data);else if(Se.isData3DTexture)li?(Bi&&t.texStorage3D(32879,rt,Zt,Lt.width,Lt.height,Lt.depth),t.texSubImage3D(32879,0,0,0,0,Lt.width,Lt.height,Lt.depth,Ke,It,Lt.data)):t.texImage3D(32879,0,Zt,Lt.width,Lt.height,Lt.depth,0,Ke,It,Lt.data);else if(Se.isFramebufferTexture){if(Bi)if(li)t.texStorage2D(3553,rt,Zt,Lt.width,Lt.height);else{let Ct=Lt.width,Vt=Lt.height;for(let bn=0;bn<rt;bn++)t.texImage2D(3553,bn,Zt,Ct,Vt,0,Ke,It,null),Ct>>=1,Vt>>=1}}else if(Yn.length>0&&Un){li&&Bi&&t.texStorage2D(3553,rt,Zt,Yn[0].width,Yn[0].height);for(let Ct=0,Vt=Yn.length;Ct<Vt;Ct++)sn=Yn[Ct],li?t.texSubImage2D(3553,Ct,0,0,Ke,It,sn):t.texImage2D(3553,Ct,Zt,Ke,It,sn);Se.generateMipmaps=!1}else li?(Bi&&t.texStorage2D(3553,rt,Zt,Lt.width,Lt.height),t.texSubImage2D(3553,0,0,0,Ke,It,Lt)):t.texImage2D(3553,0,Zt,Ke,It,Lt);Q(Se,Un)&&re(tn),Nn.__version=fn.version,Se.onUpdate&&Se.onUpdate(Se)}Be.__version=Se.version}function wn(Be,Se,St){if(Se.image.length!==6)return;const tn=Nt(Be,Se),nn=Se.source;t.bindTexture(34067,Be.__webglTexture,33984+St);const fn=i.get(nn);if(nn.version!==fn.__version||tn===!0){t.activeTexture(33984+St),n.pixelStorei(37440,Se.flipY),n.pixelStorei(37441,Se.premultiplyAlpha),n.pixelStorei(3317,Se.unpackAlignment),n.pixelStorei(37443,0);const Nn=Se.isCompressedTexture||Se.image[0].isCompressedTexture,yn=Se.image[0]&&Se.image[0].isDataTexture,Lt=[];for(let Ct=0;Ct<6;Ct++)!Nn&&!yn?Lt[Ct]=N(Se.image[Ct],!1,!0,m):Lt[Ct]=yn?Se.image[Ct].image:Se.image[Ct],Lt[Ct]=Ti(Se,Lt[Ct]);const Un=Lt[0],Ke=G(Un)||s,It=a.convert(Se.format,Se.encoding),Zt=a.convert(Se.type),sn=$(Se.internalFormat,It,Zt,Se.encoding),Yn=s&&Se.isVideoTexture!==!0,li=fn.__version===void 0||tn===!0;let Bi=ne(Se,Un,Ke);Et(34067,Se,Ke);let rt;if(Nn){Yn&&li&&t.texStorage2D(34067,Bi,sn,Un.width,Un.height);for(let Ct=0;Ct<6;Ct++){rt=Lt[Ct].mipmaps;for(let Vt=0;Vt<rt.length;Vt++){const bn=rt[Vt];Se.format!==$a?It!==null?Yn?t.compressedTexSubImage2D(34069+Ct,Vt,0,0,bn.width,bn.height,It,bn.data):t.compressedTexImage2D(34069+Ct,Vt,sn,bn.width,bn.height,0,bn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Yn?t.texSubImage2D(34069+Ct,Vt,0,0,bn.width,bn.height,It,Zt,bn.data):t.texImage2D(34069+Ct,Vt,sn,bn.width,bn.height,0,It,Zt,bn.data)}}}else{rt=Se.mipmaps,Yn&&li&&(rt.length>0&&Bi++,t.texStorage2D(34067,Bi,sn,Lt[0].width,Lt[0].height));for(let Ct=0;Ct<6;Ct++)if(yn){Yn?t.texSubImage2D(34069+Ct,0,0,0,Lt[Ct].width,Lt[Ct].height,It,Zt,Lt[Ct].data):t.texImage2D(34069+Ct,0,sn,Lt[Ct].width,Lt[Ct].height,0,It,Zt,Lt[Ct].data);for(let Vt=0;Vt<rt.length;Vt++){const Pn=rt[Vt].image[Ct].image;Yn?t.texSubImage2D(34069+Ct,Vt+1,0,0,Pn.width,Pn.height,It,Zt,Pn.data):t.texImage2D(34069+Ct,Vt+1,sn,Pn.width,Pn.height,0,It,Zt,Pn.data)}}else{Yn?t.texSubImage2D(34069+Ct,0,0,0,It,Zt,Lt[Ct]):t.texImage2D(34069+Ct,0,sn,It,Zt,Lt[Ct]);for(let Vt=0;Vt<rt.length;Vt++){const bn=rt[Vt];Yn?t.texSubImage2D(34069+Ct,Vt+1,0,0,It,Zt,bn.image[Ct]):t.texImage2D(34069+Ct,Vt+1,sn,It,Zt,bn.image[Ct])}}}Q(Se,Ke)&&re(34067),fn.__version=nn.version,Se.onUpdate&&Se.onUpdate(Se)}Be.__version=Se.version}function _n(Be,Se,St,tn,nn){const fn=a.convert(St.format,St.encoding),Nn=a.convert(St.type),yn=$(St.internalFormat,fn,Nn,St.encoding);i.get(Se).__hasExternalTextures||(nn===32879||nn===35866?t.texImage3D(nn,0,yn,Se.width,Se.height,Se.depth,0,fn,Nn,null):t.texImage2D(nn,0,yn,Se.width,Se.height,0,fn,Nn,null)),t.bindFramebuffer(36160,Be),Zn(Se)?T.framebufferTexture2DMultisampleEXT(36160,tn,nn,i.get(St).__webglTexture,0,On(Se)):(nn===3553||nn>=34069&&nn<=34074)&&n.framebufferTexture2D(36160,tn,nn,i.get(St).__webglTexture,0),t.bindFramebuffer(36160,null)}function Ln(Be,Se,St){if(n.bindRenderbuffer(36161,Be),Se.depthBuffer&&!Se.stencilBuffer){let tn=33189;if(St||Zn(Se)){const nn=Se.depthTexture;nn&&nn.isDepthTexture&&(nn.type===kd?tn=36012:nn.type===Kf&&(tn=33190));const fn=On(Se);Zn(Se)?T.renderbufferStorageMultisampleEXT(36161,fn,tn,Se.width,Se.height):n.renderbufferStorageMultisample(36161,fn,tn,Se.width,Se.height)}else n.renderbufferStorage(36161,tn,Se.width,Se.height);n.framebufferRenderbuffer(36160,36096,36161,Be)}else if(Se.depthBuffer&&Se.stencilBuffer){const tn=On(Se);St&&Zn(Se)===!1?n.renderbufferStorageMultisample(36161,tn,35056,Se.width,Se.height):Zn(Se)?T.renderbufferStorageMultisampleEXT(36161,tn,35056,Se.width,Se.height):n.renderbufferStorage(36161,34041,Se.width,Se.height),n.framebufferRenderbuffer(36160,33306,36161,Be)}else{const tn=Se.isWebGLMultipleRenderTargets===!0?Se.texture:[Se.texture];for(let nn=0;nn<tn.length;nn++){const fn=tn[nn],Nn=a.convert(fn.format,fn.encoding),yn=a.convert(fn.type),Lt=$(fn.internalFormat,Nn,yn,fn.encoding),Un=On(Se);St&&Zn(Se)===!1?n.renderbufferStorageMultisample(36161,Un,Lt,Se.width,Se.height):Zn(Se)?T.renderbufferStorageMultisampleEXT(36161,Un,Lt,Se.width,Se.height):n.renderbufferStorage(36161,Lt,Se.width,Se.height)}}n.bindRenderbuffer(36161,null)}function At(Be,Se){if(Se&&Se.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,Be),!(Se.depthTexture&&Se.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(Se.depthTexture).__webglTexture||Se.depthTexture.image.width!==Se.width||Se.depthTexture.image.height!==Se.height)&&(Se.depthTexture.image.width=Se.width,Se.depthTexture.image.height=Se.height,Se.depthTexture.needsUpdate=!0),Pe(Se.depthTexture,0);const tn=i.get(Se.depthTexture).__webglTexture,nn=On(Se);if(Se.depthTexture.format===dp)Zn(Se)?T.framebufferTexture2DMultisampleEXT(36160,36096,3553,tn,0,nn):n.framebufferTexture2D(36160,36096,3553,tn,0);else if(Se.depthTexture.format===hg)Zn(Se)?T.framebufferTexture2DMultisampleEXT(36160,33306,3553,tn,0,nn):n.framebufferTexture2D(36160,33306,3553,tn,0);else throw new Error("Unknown depthTexture format")}function Ot(Be){const Se=i.get(Be),St=Be.isWebGLCubeRenderTarget===!0;if(Be.depthTexture&&!Se.__autoAllocateDepthBuffer){if(St)throw new Error("target.depthTexture not supported in Cube render targets");At(Se.__webglFramebuffer,Be)}else if(St){Se.__webglDepthbuffer=[];for(let tn=0;tn<6;tn++)t.bindFramebuffer(36160,Se.__webglFramebuffer[tn]),Se.__webglDepthbuffer[tn]=n.createRenderbuffer(),Ln(Se.__webglDepthbuffer[tn],Be,!1)}else t.bindFramebuffer(36160,Se.__webglFramebuffer),Se.__webglDepthbuffer=n.createRenderbuffer(),Ln(Se.__webglDepthbuffer,Be,!1);t.bindFramebuffer(36160,null)}function Ft(Be,Se,St){const tn=i.get(Be);Se!==void 0&&_n(tn.__webglFramebuffer,Be,Be.texture,36064,3553),St!==void 0&&Ot(Be)}function An(Be){const Se=Be.texture,St=i.get(Be),tn=i.get(Se);Be.addEventListener("dispose",$e),Be.isWebGLMultipleRenderTargets!==!0&&(tn.__webglTexture===void 0&&(tn.__webglTexture=n.createTexture()),tn.__version=Se.version,l.memory.textures++);const nn=Be.isWebGLCubeRenderTarget===!0,fn=Be.isWebGLMultipleRenderTargets===!0,Nn=G(Be)||s;if(nn){St.__webglFramebuffer=[];for(let yn=0;yn<6;yn++)St.__webglFramebuffer[yn]=n.createFramebuffer()}else{if(St.__webglFramebuffer=n.createFramebuffer(),fn)if(r.drawBuffers){const yn=Be.texture;for(let Lt=0,Un=yn.length;Lt<Un;Lt++){const Ke=i.get(yn[Lt]);Ke.__webglTexture===void 0&&(Ke.__webglTexture=n.createTexture(),l.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&Be.samples>0&&Zn(Be)===!1){const yn=fn?Se:[Se];St.__webglMultisampledFramebuffer=n.createFramebuffer(),St.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,St.__webglMultisampledFramebuffer);for(let Lt=0;Lt<yn.length;Lt++){const Un=yn[Lt];St.__webglColorRenderbuffer[Lt]=n.createRenderbuffer(),n.bindRenderbuffer(36161,St.__webglColorRenderbuffer[Lt]);const Ke=a.convert(Un.format,Un.encoding),It=a.convert(Un.type),Zt=$(Un.internalFormat,Ke,It,Un.encoding,Be.isXRRenderTarget===!0),sn=On(Be);n.renderbufferStorageMultisample(36161,sn,Zt,Be.width,Be.height),n.framebufferRenderbuffer(36160,36064+Lt,36161,St.__webglColorRenderbuffer[Lt])}n.bindRenderbuffer(36161,null),Be.depthBuffer&&(St.__webglDepthRenderbuffer=n.createRenderbuffer(),Ln(St.__webglDepthRenderbuffer,Be,!0)),t.bindFramebuffer(36160,null)}}if(nn){t.bindTexture(34067,tn.__webglTexture),Et(34067,Se,Nn);for(let yn=0;yn<6;yn++)_n(St.__webglFramebuffer[yn],Be,Se,36064,34069+yn);Q(Se,Nn)&&re(34067),t.unbindTexture()}else if(fn){const yn=Be.texture;for(let Lt=0,Un=yn.length;Lt<Un;Lt++){const Ke=yn[Lt],It=i.get(Ke);t.bindTexture(3553,It.__webglTexture),Et(3553,Ke,Nn),_n(St.__webglFramebuffer,Be,Ke,36064+Lt,3553),Q(Ke,Nn)&&re(3553)}t.unbindTexture()}else{let yn=3553;(Be.isWebGL3DRenderTarget||Be.isWebGLArrayRenderTarget)&&(s?yn=Be.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(yn,tn.__webglTexture),Et(yn,Se,Nn),_n(St.__webglFramebuffer,Be,Se,36064,yn),Q(Se,Nn)&&re(yn),t.unbindTexture()}Be.depthBuffer&&Ot(Be)}function pn(Be){const Se=G(Be)||s,St=Be.isWebGLMultipleRenderTargets===!0?Be.texture:[Be.texture];for(let tn=0,nn=St.length;tn<nn;tn++){const fn=St[tn];if(Q(fn,Se)){const Nn=Be.isWebGLCubeRenderTarget?34067:3553,yn=i.get(fn).__webglTexture;t.bindTexture(Nn,yn),re(Nn),t.unbindTexture()}}}function Vn(Be){if(s&&Be.samples>0&&Zn(Be)===!1){const Se=Be.isWebGLMultipleRenderTargets?Be.texture:[Be.texture],St=Be.width,tn=Be.height;let nn=16384;const fn=[],Nn=Be.stencilBuffer?33306:36096,yn=i.get(Be),Lt=Be.isWebGLMultipleRenderTargets===!0;if(Lt)for(let Un=0;Un<Se.length;Un++)t.bindFramebuffer(36160,yn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Un,36161,null),t.bindFramebuffer(36160,yn.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Un,3553,null,0);t.bindFramebuffer(36008,yn.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,yn.__webglFramebuffer);for(let Un=0;Un<Se.length;Un++){fn.push(36064+Un),Be.depthBuffer&&fn.push(Nn);const Ke=yn.__ignoreDepthValues!==void 0?yn.__ignoreDepthValues:!1;if(Ke===!1&&(Be.depthBuffer&&(nn|=256),Be.stencilBuffer&&(nn|=1024)),Lt&&n.framebufferRenderbuffer(36008,36064,36161,yn.__webglColorRenderbuffer[Un]),Ke===!0&&(n.invalidateFramebuffer(36008,[Nn]),n.invalidateFramebuffer(36009,[Nn])),Lt){const It=i.get(Se[Un]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,It,0)}n.blitFramebuffer(0,0,St,tn,0,0,St,tn,nn,9728),C&&n.invalidateFramebuffer(36008,fn)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),Lt)for(let Un=0;Un<Se.length;Un++){t.bindFramebuffer(36160,yn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Un,36161,yn.__webglColorRenderbuffer[Un]);const Ke=i.get(Se[Un]).__webglTexture;t.bindFramebuffer(36160,yn.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Un,3553,Ke,0)}t.bindFramebuffer(36009,yn.__webglMultisampledFramebuffer)}}function On(Be){return Math.min(S,Be.samples)}function Zn(Be){const Se=i.get(Be);return s&&Be.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Se.__useRenderToTexture!==!1}function ai(Be){const Se=l.render.frame;P.get(Be)!==Se&&(P.set(Be,Se),Be.update())}function Ti(Be,Se){const St=Be.encoding,tn=Be.format,nn=Be.type;return Be.isCompressedTexture===!0||Be.isVideoTexture===!0||Be.format===rM||St!==Hd&&(St===Ar?s===!1?e.has("EXT_sRGB")===!0&&tn===$a?(Be.format=rM,Be.minFilter=zs,Be.generateMipmaps=!1):Se=sk.sRGBToLinear(Se):(tn!==$a||nn!==Wd)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",St)),Se}this.allocateTextureUnit=ce,this.resetTextureUnits=We,this.setTexture2D=Pe,this.setTexture2DArray=Qe,this.setTexture3D=Ne,this.setTextureCube=nt,this.rebindTextures=Ft,this.setupRenderTarget=An,this.updateRenderTargetMipmap=pn,this.updateMultisampleRenderTarget=Vn,this.setupDepthRenderbuffer=Ot,this.setupFrameBufferTexture=_n,this.useMultisampledRTT=Zn}function nV(n,e,t){const i=t.isWebGL2;function r(a,l=null){let s;if(a===Wd)return 5121;if(a===M6)return 32819;if(a===T6)return 32820;if(a===w6)return 5120;if(a===b6)return 5122;if(a===tk)return 5123;if(a===S6)return 5124;if(a===Kf)return 5125;if(a===kd)return 5126;if(a===Ty)return i?5131:(s=e.get("OES_texture_half_float"),s!==null?s.HALF_FLOAT_OES:null);if(a===E6)return 6406;if(a===$a)return 6408;if(a===A6)return 6409;if(a===C6)return 6410;if(a===dp)return 6402;if(a===hg)return 34041;if(a===rM)return s=e.get("EXT_sRGB"),s!==null?s.SRGB_ALPHA_EXT:null;if(a===I6)return 6403;if(a===P6)return 36244;if(a===k6)return 33319;if(a===D6)return 33320;if(a===L6)return 36249;if(a===nS||a===iS||a===rS||a===sS)if(l===Ar)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(a===nS)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(a===iS)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(a===rS)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(a===sS)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(a===nS)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===iS)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===rS)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===sS)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(a===IC||a===PC||a===kC||a===DC)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(a===IC)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===PC)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===kC)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===DC)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(a===R6)return s=e.get("WEBGL_compressed_texture_etc1"),s!==null?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(a===LC||a===RC)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(a===LC)return l===Ar?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(a===RC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(a===zC||a===OC||a===FC||a===BC||a===NC||a===UC||a===VC||a===GC||a===WC||a===HC||a===jC||a===qC||a===ZC||a===$C)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(a===zC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(a===OC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(a===FC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(a===BC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(a===NC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(a===UC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(a===VC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(a===GC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(a===WC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(a===HC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(a===jC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(a===qC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(a===ZC)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(a===$C)return l===Ar?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(a===oS)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(a===oS)return l===Ar?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(a===z6||a===XC||a===YC||a===JC)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(a===oS)return s.COMPRESSED_RED_RGTC1_EXT;if(a===XC)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(a===YC)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(a===JC)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return a===Km?i?34042:(s=e.get("WEBGL_depth_texture"),s!==null?s.UNSIGNED_INT_24_8_WEBGL:null):n[a]!==void 0?n[a]:null}return{convert:r}}class iV extends Yr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class q_ extends lr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const dre={type:"move"};class TE{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new q_,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new q_,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Fe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Fe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new q_,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Fe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Fe),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,a=null,l=null;const s=this._targetRay,d=this._grip,m=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(m&&e.hand){l=!0;for(const k of e.hand.values()){const R=t.getJointPose(k,i),O=this._getHandJoint(m,k);R!==null&&(O.matrix.fromArray(R.transform.matrix),O.matrix.decompose(O.position,O.rotation,O.scale),O.jointRadius=R.radius),O.visible=R!==null}const _=m.joints["index-finger-tip"],S=m.joints["thumb-tip"],T=_.position.distanceTo(S.position),C=.02,P=.005;m.inputState.pinching&&T>C+P?(m.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!m.inputState.pinching&&T<=C-P&&(m.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else d!==null&&e.gripSpace&&(a=t.getPose(e.gripSpace,i),a!==null&&(d.matrix.fromArray(a.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),a.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(a.linearVelocity)):d.hasLinearVelocity=!1,a.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(a.angularVelocity)):d.hasAngularVelocity=!1));s!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&a!==null&&(r=a),r!==null&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(dre)))}return s!==null&&(s.visible=r!==null),d!==null&&(d.visible=a!==null),m!==null&&(m.visible=l!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new q_;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class rV extends bs{constructor(e,t,i,r,a,l,s,d,m,_){if(_=_!==void 0?_:dp,_!==dp&&_!==hg)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&_===dp&&(i=Kf),i===void 0&&_===hg&&(i=Km),super(null,r,a,l,s,d,_,i,m),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=s!==void 0?s:Ls,this.minFilter=d!==void 0?d:Ls,this.flipY=!1,this.generateMipmaps=!1}}class fre extends Mh{constructor(e,t){super();const i=this;let r=null,a=1,l=null,s="local-floor",d=1,m=null,_=null,S=null,T=null,C=null,P=null;const k=t.getContextAttributes();let R=null,O=null;const F=[],N=[],G=new Set,j=new Map,Q=new Yr;Q.layers.enable(1),Q.viewport=new br;const re=new Yr;re.layers.enable(2),re.viewport=new br;const $=[Q,re],ne=new iV;ne.layers.enable(1),ne.layers.enable(2);let ue=null,De=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ne){let nt=F[Ne];return nt===void 0&&(nt=new TE,F[Ne]=nt),nt.getTargetRaySpace()},this.getControllerGrip=function(Ne){let nt=F[Ne];return nt===void 0&&(nt=new TE,F[Ne]=nt),nt.getGripSpace()},this.getHand=function(Ne){let nt=F[Ne];return nt===void 0&&(nt=new TE,F[Ne]=nt),nt.getHandSpace()};function $e(Ne){const nt=N.indexOf(Ne.inputSource);if(nt===-1)return;const ze=F[nt];ze!==void 0&&ze.dispatchEvent({type:Ne.type,data:Ne.inputSource})}function ae(){r.removeEventListener("select",$e),r.removeEventListener("selectstart",$e),r.removeEventListener("selectend",$e),r.removeEventListener("squeeze",$e),r.removeEventListener("squeezestart",$e),r.removeEventListener("squeezeend",$e),r.removeEventListener("end",ae),r.removeEventListener("inputsourceschange",le);for(let Ne=0;Ne<F.length;Ne++){const nt=N[Ne];nt!==null&&(N[Ne]=null,F[Ne].disconnect(nt))}ue=null,De=null,e.setRenderTarget(R),C=null,T=null,S=null,r=null,O=null,Qe.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ne){a=Ne,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ne){s=Ne,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return m||l},this.setReferenceSpace=function(Ne){m=Ne},this.getBaseLayer=function(){return T!==null?T:C},this.getBinding=function(){return S},this.getFrame=function(){return P},this.getSession=function(){return r},this.setSession=async function(Ne){if(r=Ne,r!==null){if(R=e.getRenderTarget(),r.addEventListener("select",$e),r.addEventListener("selectstart",$e),r.addEventListener("selectend",$e),r.addEventListener("squeeze",$e),r.addEventListener("squeezestart",$e),r.addEventListener("squeezeend",$e),r.addEventListener("end",ae),r.addEventListener("inputsourceschange",le),k.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const nt={antialias:r.renderState.layers===void 0?k.antialias:!0,alpha:k.alpha,depth:k.depth,stencil:k.stencil,framebufferScaleFactor:a};C=new XRWebGLLayer(r,t,nt),r.updateRenderState({baseLayer:C}),O=new Pu(C.framebufferWidth,C.framebufferHeight,{format:$a,type:Wd,encoding:e.outputEncoding,stencilBuffer:k.stencil})}else{let nt=null,ze=null,et=null;k.depth&&(et=k.stencil?35056:33190,nt=k.stencil?hg:dp,ze=k.stencil?Km:Kf);const Et={colorFormat:32856,depthFormat:et,scaleFactor:a};S=new XRWebGLBinding(r,t),T=S.createProjectionLayer(Et),r.updateRenderState({layers:[T]}),O=new Pu(T.textureWidth,T.textureHeight,{format:$a,type:Wd,depthTexture:new rV(T.textureWidth,T.textureHeight,ze,void 0,void 0,void 0,void 0,void 0,void 0,nt),stencilBuffer:k.stencil,encoding:e.outputEncoding,samples:k.antialias?4:0});const Nt=e.properties.get(O);Nt.__ignoreDepthValues=T.ignoreDepthValues}O.isXRRenderTarget=!0,this.setFoveation(d),m=null,l=await r.requestReferenceSpace(s),Qe.setContext(r),Qe.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function le(Ne){for(let nt=0;nt<Ne.removed.length;nt++){const ze=Ne.removed[nt],et=N.indexOf(ze);et>=0&&(N[et]=null,F[et].disconnect(ze))}for(let nt=0;nt<Ne.added.length;nt++){const ze=Ne.added[nt];let et=N.indexOf(ze);if(et===-1){for(let Nt=0;Nt<F.length;Nt++)if(Nt>=N.length){N.push(ze),et=Nt;break}else if(N[Nt]===null){N[Nt]=ze,et=Nt;break}if(et===-1)break}const Et=F[et];Et&&Et.connect(ze)}}const fe=new Fe,Oe=new Fe;function We(Ne,nt,ze){fe.setFromMatrixPosition(nt.matrixWorld),Oe.setFromMatrixPosition(ze.matrixWorld);const et=fe.distanceTo(Oe),Et=nt.projectionMatrix.elements,Nt=ze.projectionMatrix.elements,qt=Et[14]/(Et[10]-1),wn=Et[14]/(Et[10]+1),_n=(Et[9]+1)/Et[5],Ln=(Et[9]-1)/Et[5],At=(Et[8]-1)/Et[0],Ot=(Nt[8]+1)/Nt[0],Ft=qt*At,An=qt*Ot,pn=et/(-At+Ot),Vn=pn*-At;nt.matrixWorld.decompose(Ne.position,Ne.quaternion,Ne.scale),Ne.translateX(Vn),Ne.translateZ(pn),Ne.matrixWorld.compose(Ne.position,Ne.quaternion,Ne.scale),Ne.matrixWorldInverse.copy(Ne.matrixWorld).invert();const On=qt+pn,Zn=wn+pn,ai=Ft-Vn,Ti=An+(et-Vn),Be=_n*wn/Zn*On,Se=Ln*wn/Zn*On;Ne.projectionMatrix.makePerspective(ai,Ti,Be,Se,On,Zn)}function ce(Ne,nt){nt===null?Ne.matrixWorld.copy(Ne.matrix):Ne.matrixWorld.multiplyMatrices(nt.matrixWorld,Ne.matrix),Ne.matrixWorldInverse.copy(Ne.matrixWorld).invert()}this.updateCamera=function(Ne){if(r===null)return;ne.near=re.near=Q.near=Ne.near,ne.far=re.far=Q.far=Ne.far,(ue!==ne.near||De!==ne.far)&&(r.updateRenderState({depthNear:ne.near,depthFar:ne.far}),ue=ne.near,De=ne.far);const nt=Ne.parent,ze=ne.cameras;ce(ne,nt);for(let Et=0;Et<ze.length;Et++)ce(ze[Et],nt);ne.matrixWorld.decompose(ne.position,ne.quaternion,ne.scale),Ne.matrix.copy(ne.matrix),Ne.matrix.decompose(Ne.position,Ne.quaternion,Ne.scale);const et=Ne.children;for(let Et=0,Nt=et.length;Et<Nt;Et++)et[Et].updateMatrixWorld(!0);ze.length===2?We(ne,Q,re):ne.projectionMatrix.copy(Q.projectionMatrix)},this.getCamera=function(){return ne},this.getFoveation=function(){if(!(T===null&&C===null))return d},this.setFoveation=function(Ne){d=Ne,T!==null&&(T.fixedFoveation=Ne),C!==null&&C.fixedFoveation!==void 0&&(C.fixedFoveation=Ne)},this.getPlanes=function(){return G};let Te=null;function Pe(Ne,nt){if(_=nt.getViewerPose(m||l),P=nt,_!==null){const ze=_.views;C!==null&&(e.setRenderTargetFramebuffer(O,C.framebuffer),e.setRenderTarget(O));let et=!1;ze.length!==ne.cameras.length&&(ne.cameras.length=0,et=!0);for(let Et=0;Et<ze.length;Et++){const Nt=ze[Et];let qt=null;if(C!==null)qt=C.getViewport(Nt);else{const _n=S.getViewSubImage(T,Nt);qt=_n.viewport,Et===0&&(e.setRenderTargetTextures(O,_n.colorTexture,T.ignoreDepthValues?void 0:_n.depthStencilTexture),e.setRenderTarget(O))}let wn=$[Et];wn===void 0&&(wn=new Yr,wn.layers.enable(Et),wn.viewport=new br,$[Et]=wn),wn.matrix.fromArray(Nt.transform.matrix),wn.projectionMatrix.fromArray(Nt.projectionMatrix),wn.viewport.set(qt.x,qt.y,qt.width,qt.height),Et===0&&ne.matrix.copy(wn.matrix),et===!0&&ne.cameras.push(wn)}}for(let ze=0;ze<F.length;ze++){const et=N[ze],Et=F[ze];et!==null&&Et!==void 0&&Et.update(et,nt,m||l)}if(Te&&Te(Ne,nt),nt.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:nt.detectedPlanes});let ze=null;for(const et of G)nt.detectedPlanes.has(et)||(ze===null&&(ze=[]),ze.push(et));if(ze!==null)for(const et of ze)G.delete(et),j.delete(et),i.dispatchEvent({type:"planeremoved",data:et});for(const et of nt.detectedPlanes)if(!G.has(et))G.add(et),j.set(et,nt.lastChangedTime),i.dispatchEvent({type:"planeadded",data:et});else{const Et=j.get(et);et.lastChangedTime>Et&&(j.set(et,et.lastChangedTime),i.dispatchEvent({type:"planechanged",data:et}))}}P=null}const Qe=new J6;Qe.setAnimationLoop(Pe),this.setAnimationLoop=function(Ne){Te=Ne},this.dispose=function(){}}}function pre(n,e){function t(k,R){R.color.getRGB(k.fogColor.value,Z6(n)),R.isFog?(k.fogNear.value=R.near,k.fogFar.value=R.far):R.isFogExp2&&(k.fogDensity.value=R.density)}function i(k,R,O,F,N){R.isMeshBasicMaterial||R.isMeshLambertMaterial?r(k,R):R.isMeshToonMaterial?(r(k,R),_(k,R)):R.isMeshPhongMaterial?(r(k,R),m(k,R)):R.isMeshStandardMaterial?(r(k,R),S(k,R),R.isMeshPhysicalMaterial&&T(k,R,N)):R.isMeshMatcapMaterial?(r(k,R),C(k,R)):R.isMeshDepthMaterial?r(k,R):R.isMeshDistanceMaterial?(r(k,R),P(k,R)):R.isMeshNormalMaterial?r(k,R):R.isLineBasicMaterial?(a(k,R),R.isLineDashedMaterial&&l(k,R)):R.isPointsMaterial?s(k,R,O,F):R.isSpriteMaterial?d(k,R):R.isShadowMaterial?(k.color.value.copy(R.color),k.opacity.value=R.opacity):R.isShaderMaterial&&(R.uniformsNeedUpdate=!1)}function r(k,R){k.opacity.value=R.opacity,R.color&&k.diffuse.value.copy(R.color),R.emissive&&k.emissive.value.copy(R.emissive).multiplyScalar(R.emissiveIntensity),R.map&&(k.map.value=R.map),R.alphaMap&&(k.alphaMap.value=R.alphaMap),R.bumpMap&&(k.bumpMap.value=R.bumpMap,k.bumpScale.value=R.bumpScale,R.side===nl&&(k.bumpScale.value*=-1)),R.displacementMap&&(k.displacementMap.value=R.displacementMap,k.displacementScale.value=R.displacementScale,k.displacementBias.value=R.displacementBias),R.emissiveMap&&(k.emissiveMap.value=R.emissiveMap),R.normalMap&&(k.normalMap.value=R.normalMap,k.normalScale.value.copy(R.normalScale),R.side===nl&&k.normalScale.value.negate()),R.specularMap&&(k.specularMap.value=R.specularMap),R.alphaTest>0&&(k.alphaTest.value=R.alphaTest);const O=e.get(R).envMap;if(O&&(k.envMap.value=O,k.flipEnvMap.value=O.isCubeTexture&&O.isRenderTargetTexture===!1?-1:1,k.reflectivity.value=R.reflectivity,k.ior.value=R.ior,k.refractionRatio.value=R.refractionRatio),R.lightMap){k.lightMap.value=R.lightMap;const G=n.useLegacyLights===!0?Math.PI:1;k.lightMapIntensity.value=R.lightMapIntensity*G}R.aoMap&&(k.aoMap.value=R.aoMap,k.aoMapIntensity.value=R.aoMapIntensity);let F;R.map?F=R.map:R.specularMap?F=R.specularMap:R.displacementMap?F=R.displacementMap:R.normalMap?F=R.normalMap:R.bumpMap?F=R.bumpMap:R.roughnessMap?F=R.roughnessMap:R.metalnessMap?F=R.metalnessMap:R.alphaMap?F=R.alphaMap:R.emissiveMap?F=R.emissiveMap:R.clearcoatMap?F=R.clearcoatMap:R.clearcoatNormalMap?F=R.clearcoatNormalMap:R.clearcoatRoughnessMap?F=R.clearcoatRoughnessMap:R.iridescenceMap?F=R.iridescenceMap:R.iridescenceThicknessMap?F=R.iridescenceThicknessMap:R.specularIntensityMap?F=R.specularIntensityMap:R.specularColorMap?F=R.specularColorMap:R.transmissionMap?F=R.transmissionMap:R.thicknessMap?F=R.thicknessMap:R.sheenColorMap?F=R.sheenColorMap:R.sheenRoughnessMap&&(F=R.sheenRoughnessMap),F!==void 0&&(F.isWebGLRenderTarget&&(F=F.texture),F.matrixAutoUpdate===!0&&F.updateMatrix(),k.uvTransform.value.copy(F.matrix));let N;R.aoMap?N=R.aoMap:R.lightMap&&(N=R.lightMap),N!==void 0&&(N.isWebGLRenderTarget&&(N=N.texture),N.matrixAutoUpdate===!0&&N.updateMatrix(),k.uv2Transform.value.copy(N.matrix))}function a(k,R){k.diffuse.value.copy(R.color),k.opacity.value=R.opacity}function l(k,R){k.dashSize.value=R.dashSize,k.totalSize.value=R.dashSize+R.gapSize,k.scale.value=R.scale}function s(k,R,O,F){k.diffuse.value.copy(R.color),k.opacity.value=R.opacity,k.size.value=R.size*O,k.scale.value=F*.5,R.map&&(k.map.value=R.map),R.alphaMap&&(k.alphaMap.value=R.alphaMap),R.alphaTest>0&&(k.alphaTest.value=R.alphaTest);let N;R.map?N=R.map:R.alphaMap&&(N=R.alphaMap),N!==void 0&&(N.matrixAutoUpdate===!0&&N.updateMatrix(),k.uvTransform.value.copy(N.matrix))}function d(k,R){k.diffuse.value.copy(R.color),k.opacity.value=R.opacity,k.rotation.value=R.rotation,R.map&&(k.map.value=R.map),R.alphaMap&&(k.alphaMap.value=R.alphaMap),R.alphaTest>0&&(k.alphaTest.value=R.alphaTest);let O;R.map?O=R.map:R.alphaMap&&(O=R.alphaMap),O!==void 0&&(O.matrixAutoUpdate===!0&&O.updateMatrix(),k.uvTransform.value.copy(O.matrix))}function m(k,R){k.specular.value.copy(R.specular),k.shininess.value=Math.max(R.shininess,1e-4)}function _(k,R){R.gradientMap&&(k.gradientMap.value=R.gradientMap)}function S(k,R){k.roughness.value=R.roughness,k.metalness.value=R.metalness,R.roughnessMap&&(k.roughnessMap.value=R.roughnessMap),R.metalnessMap&&(k.metalnessMap.value=R.metalnessMap),e.get(R).envMap&&(k.envMapIntensity.value=R.envMapIntensity)}function T(k,R,O){k.ior.value=R.ior,R.sheen>0&&(k.sheenColor.value.copy(R.sheenColor).multiplyScalar(R.sheen),k.sheenRoughness.value=R.sheenRoughness,R.sheenColorMap&&(k.sheenColorMap.value=R.sheenColorMap),R.sheenRoughnessMap&&(k.sheenRoughnessMap.value=R.sheenRoughnessMap)),R.clearcoat>0&&(k.clearcoat.value=R.clearcoat,k.clearcoatRoughness.value=R.clearcoatRoughness,R.clearcoatMap&&(k.clearcoatMap.value=R.clearcoatMap),R.clearcoatRoughnessMap&&(k.clearcoatRoughnessMap.value=R.clearcoatRoughnessMap),R.clearcoatNormalMap&&(k.clearcoatNormalScale.value.copy(R.clearcoatNormalScale),k.clearcoatNormalMap.value=R.clearcoatNormalMap,R.side===nl&&k.clearcoatNormalScale.value.negate())),R.iridescence>0&&(k.iridescence.value=R.iridescence,k.iridescenceIOR.value=R.iridescenceIOR,k.iridescenceThicknessMinimum.value=R.iridescenceThicknessRange[0],k.iridescenceThicknessMaximum.value=R.iridescenceThicknessRange[1],R.iridescenceMap&&(k.iridescenceMap.value=R.iridescenceMap),R.iridescenceThicknessMap&&(k.iridescenceThicknessMap.value=R.iridescenceThicknessMap)),R.transmission>0&&(k.transmission.value=R.transmission,k.transmissionSamplerMap.value=O.texture,k.transmissionSamplerSize.value.set(O.width,O.height),R.transmissionMap&&(k.transmissionMap.value=R.transmissionMap),k.thickness.value=R.thickness,R.thicknessMap&&(k.thicknessMap.value=R.thicknessMap),k.attenuationDistance.value=R.attenuationDistance,k.attenuationColor.value.copy(R.attenuationColor)),k.specularIntensity.value=R.specularIntensity,k.specularColor.value.copy(R.specularColor),R.specularIntensityMap&&(k.specularIntensityMap.value=R.specularIntensityMap),R.specularColorMap&&(k.specularColorMap.value=R.specularColorMap)}function C(k,R){R.matcap&&(k.matcap.value=R.matcap)}function P(k,R){k.referencePosition.value.copy(R.referencePosition),k.nearDistance.value=R.nearDistance,k.farDistance.value=R.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:i}}function mre(n,e,t,i){let r={},a={},l=[];const s=t.isWebGL2?n.getParameter(35375):0;function d(F,N){const G=N.program;i.uniformBlockBinding(F,G)}function m(F,N){let G=r[F.id];G===void 0&&(P(F),G=_(F),r[F.id]=G,F.addEventListener("dispose",R));const j=N.program;i.updateUBOMapping(F,j);const Q=e.render.frame;a[F.id]!==Q&&(T(F),a[F.id]=Q)}function _(F){const N=S();F.__bindingPointIndex=N;const G=n.createBuffer(),j=F.__size,Q=F.usage;return n.bindBuffer(35345,G),n.bufferData(35345,j,Q),n.bindBuffer(35345,null),n.bindBufferBase(35345,N,G),G}function S(){for(let F=0;F<s;F++)if(l.indexOf(F)===-1)return l.push(F),F;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function T(F){const N=r[F.id],G=F.uniforms,j=F.__cache;n.bindBuffer(35345,N);for(let Q=0,re=G.length;Q<re;Q++){const $=G[Q];if(C($,Q,j)===!0){const ne=$.__offset,ue=Array.isArray($.value)?$.value:[$.value];let De=0;for(let $e=0;$e<ue.length;$e++){const ae=ue[$e],le=k(ae);typeof ae=="number"?($.__data[0]=ae,n.bufferSubData(35345,ne+De,$.__data)):ae.isMatrix3?($.__data[0]=ae.elements[0],$.__data[1]=ae.elements[1],$.__data[2]=ae.elements[2],$.__data[3]=ae.elements[0],$.__data[4]=ae.elements[3],$.__data[5]=ae.elements[4],$.__data[6]=ae.elements[5],$.__data[7]=ae.elements[0],$.__data[8]=ae.elements[6],$.__data[9]=ae.elements[7],$.__data[10]=ae.elements[8],$.__data[11]=ae.elements[0]):(ae.toArray($.__data,De),De+=le.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(35345,ne,$.__data)}}n.bindBuffer(35345,null)}function C(F,N,G){const j=F.value;if(G[N]===void 0){if(typeof j=="number")G[N]=j;else{const Q=Array.isArray(j)?j:[j],re=[];for(let $=0;$<Q.length;$++)re.push(Q[$].clone());G[N]=re}return!0}else if(typeof j=="number"){if(G[N]!==j)return G[N]=j,!0}else{const Q=Array.isArray(G[N])?G[N]:[G[N]],re=Array.isArray(j)?j:[j];for(let $=0;$<Q.length;$++){const ne=Q[$];if(ne.equals(re[$])===!1)return ne.copy(re[$]),!0}}return!1}function P(F){const N=F.uniforms;let G=0;const j=16;let Q=0;for(let re=0,$=N.length;re<$;re++){const ne=N[re],ue={boundary:0,storage:0},De=Array.isArray(ne.value)?ne.value:[ne.value];for(let $e=0,ae=De.length;$e<ae;$e++){const le=De[$e],fe=k(le);ue.boundary+=fe.boundary,ue.storage+=fe.storage}if(ne.__data=new Float32Array(ue.storage/Float32Array.BYTES_PER_ELEMENT),ne.__offset=G,re>0){Q=G%j;const $e=j-Q;Q!==0&&$e-ue.boundary<0&&(G+=j-Q,ne.__offset=G)}G+=ue.storage}return Q=G%j,Q>0&&(G+=j-Q),F.__size=G,F.__cache={},this}function k(F){const N={boundary:0,storage:0};return typeof F=="number"?(N.boundary=4,N.storage=4):F.isVector2?(N.boundary=8,N.storage=8):F.isVector3||F.isColor?(N.boundary=16,N.storage=12):F.isVector4?(N.boundary=16,N.storage=16):F.isMatrix3?(N.boundary=48,N.storage=48):F.isMatrix4?(N.boundary=64,N.storage=64):F.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",F),N}function R(F){const N=F.target;N.removeEventListener("dispose",R);const G=l.indexOf(N.__bindingPointIndex);l.splice(G,1),n.deleteBuffer(r[N.id]),delete r[N.id],delete a[N.id]}function O(){for(const F in r)n.deleteBuffer(r[F]);l=[],r={},a={}}return{bind:d,update:m,dispose:O}}function gre(){const n=kv("canvas");return n.style.display="block",n}function qM(n={}){this.isWebGLRenderer=!0;const e=n.canvas!==void 0?n.canvas:gre(),t=n.context!==void 0?n.context:null,i=n.depth!==void 0?n.depth:!0,r=n.stencil!==void 0?n.stencil:!0,a=n.antialias!==void 0?n.antialias:!1,l=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,s=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,d=n.powerPreference!==void 0?n.powerPreference:"default",m=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let _;t!==null?_=t.getContextAttributes().alpha:_=n.alpha!==void 0?n.alpha:!1;let S=null,T=null;const C=[],P=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Hd,this.useLegacyLights=!0,this.toneMapping=Au,this.toneMappingExposure=1;const k=this;let R=!1,O=0,F=0,N=null,G=-1,j=null;const Q=new br,re=new br;let $=null,ne=e.width,ue=e.height,De=1,$e=null,ae=null;const le=new br(0,0,ne,ue),fe=new br(0,0,ne,ue);let Oe=!1;const We=new HM;let ce=!1,Te=!1,Pe=null;const Qe=new vi,Ne=new Fe,nt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ze(){return N===null?De:1}let et=t;function Et(ee,pe){for(let Ae=0;Ae<ee.length;Ae++){const ye=ee[Ae],ve=e.getContext(ye,pe);if(ve!==null)return ve}return null}try{const ee={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:s,powerPreference:d,failIfMajorPerformanceCaveat:m};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${NM}`),e.addEventListener("webglcontextlost",It,!1),e.addEventListener("webglcontextrestored",Zt,!1),e.addEventListener("webglcontextcreationerror",sn,!1),et===null){const pe=["webgl2","webgl","experimental-webgl"];if(k.isWebGL1Renderer===!0&&pe.shift(),et=Et(pe,ee),et===null)throw Et(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}et.getShaderPrecisionFormat===void 0&&(et.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ee){throw console.error("THREE.WebGLRenderer: "+ee.message),ee}let Nt,qt,wn,_n,Ln,At,Ot,Ft,An,pn,Vn,On,Zn,ai,Ti,Be,Se,St,tn,nn,fn,Nn,yn,Lt;function Un(){Nt=new Dne(et),qt=new Ene(et,Nt,n),Nt.init(qt),Nn=new nV(et,Nt,qt),wn=new ure(et,Nt,qt),_n=new zne,Ln=new Kie,At=new hre(et,Nt,wn,Ln,qt,Nn,_n),Ot=new Cne(k),Ft=new kne(k),An=new HQ(et,qt),yn=new Mne(et,Nt,An,qt),pn=new Lne(et,An,_n,yn),Vn=new Nne(et,pn,An,_n),tn=new Bne(et,qt,At),Be=new Ane(Ln),On=new Jie(k,Ot,Ft,Nt,qt,yn,Be),Zn=new pre(k,Ln),ai=new ere,Ti=new ore(Nt,qt),St=new Sne(k,Ot,Ft,wn,Vn,_,l),Se=new cre(k,Vn,qt),Lt=new mre(et,_n,qt,wn),nn=new Tne(et,Nt,_n,qt),fn=new Rne(et,Nt,_n,qt),_n.programs=On.programs,k.capabilities=qt,k.extensions=Nt,k.properties=Ln,k.renderLists=ai,k.shadowMap=Se,k.state=wn,k.info=_n}Un();const Ke=new fre(k,et);this.xr=Ke,this.getContext=function(){return et},this.getContextAttributes=function(){return et.getContextAttributes()},this.forceContextLoss=function(){const ee=Nt.get("WEBGL_lose_context");ee&&ee.loseContext()},this.forceContextRestore=function(){const ee=Nt.get("WEBGL_lose_context");ee&&ee.restoreContext()},this.getPixelRatio=function(){return De},this.setPixelRatio=function(ee){ee!==void 0&&(De=ee,this.setSize(ne,ue,!1))},this.getSize=function(ee){return ee.set(ne,ue)},this.setSize=function(ee,pe,Ae=!0){if(Ke.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ne=ee,ue=pe,e.width=Math.floor(ee*De),e.height=Math.floor(pe*De),Ae===!0&&(e.style.width=ee+"px",e.style.height=pe+"px"),this.setViewport(0,0,ee,pe)},this.getDrawingBufferSize=function(ee){return ee.set(ne*De,ue*De).floor()},this.setDrawingBufferSize=function(ee,pe,Ae){ne=ee,ue=pe,De=Ae,e.width=Math.floor(ee*Ae),e.height=Math.floor(pe*Ae),this.setViewport(0,0,ee,pe)},this.getCurrentViewport=function(ee){return ee.copy(Q)},this.getViewport=function(ee){return ee.copy(le)},this.setViewport=function(ee,pe,Ae,ye){ee.isVector4?le.set(ee.x,ee.y,ee.z,ee.w):le.set(ee,pe,Ae,ye),wn.viewport(Q.copy(le).multiplyScalar(De).floor())},this.getScissor=function(ee){return ee.copy(fe)},this.setScissor=function(ee,pe,Ae,ye){ee.isVector4?fe.set(ee.x,ee.y,ee.z,ee.w):fe.set(ee,pe,Ae,ye),wn.scissor(re.copy(fe).multiplyScalar(De).floor())},this.getScissorTest=function(){return Oe},this.setScissorTest=function(ee){wn.setScissorTest(Oe=ee)},this.setOpaqueSort=function(ee){$e=ee},this.setTransparentSort=function(ee){ae=ee},this.getClearColor=function(ee){return ee.copy(St.getClearColor())},this.setClearColor=function(){St.setClearColor.apply(St,arguments)},this.getClearAlpha=function(){return St.getClearAlpha()},this.setClearAlpha=function(){St.setClearAlpha.apply(St,arguments)},this.clear=function(ee=!0,pe=!0,Ae=!0){let ye=0;ee&&(ye|=16384),pe&&(ye|=256),Ae&&(ye|=1024),et.clear(ye)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",It,!1),e.removeEventListener("webglcontextrestored",Zt,!1),e.removeEventListener("webglcontextcreationerror",sn,!1),ai.dispose(),Ti.dispose(),Ln.dispose(),Ot.dispose(),Ft.dispose(),Vn.dispose(),yn.dispose(),Lt.dispose(),On.dispose(),Ke.dispose(),Ke.removeEventListener("sessionstart",Vt),Ke.removeEventListener("sessionend",bn),Pe&&(Pe.dispose(),Pe=null),Pn.stop()};function It(ee){ee.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function Zt(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1;const ee=_n.autoReset,pe=Se.enabled,Ae=Se.autoUpdate,ye=Se.needsUpdate,ve=Se.type;Un(),_n.autoReset=ee,Se.enabled=pe,Se.autoUpdate=Ae,Se.needsUpdate=ye,Se.type=ve}function sn(ee){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ee.statusMessage)}function Yn(ee){const pe=ee.target;pe.removeEventListener("dispose",Yn),li(pe)}function li(ee){Bi(ee),Ln.remove(ee)}function Bi(ee){const pe=Ln.get(ee).programs;pe!==void 0&&(pe.forEach(function(Ae){On.releaseProgram(Ae)}),ee.isShaderMaterial&&On.releaseShaderCache(ee))}this.renderBufferDirect=function(ee,pe,Ae,ye,ve,Je){pe===null&&(pe=nt);const ht=ve.isMesh&&ve.matrixWorld.determinant()<0,zt=se(ee,pe,Ae,ye,ve);wn.setMaterial(ye,ht);let vt=Ae.index,Kt=1;ye.wireframe===!0&&(vt=pn.getWireframeAttribute(Ae),Kt=2);const Yt=Ae.drawRange,Xt=Ae.attributes.position;let gn=Yt.start*Kt,$n=(Yt.start+Yt.count)*Kt;Je!==null&&(gn=Math.max(gn,Je.start*Kt),$n=Math.min($n,(Je.start+Je.count)*Kt)),vt!==null?(gn=Math.max(gn,0),$n=Math.min($n,vt.count)):Xt!=null&&(gn=Math.max(gn,0),$n=Math.min($n,Xt.count));const ii=$n-gn;if(ii<0||ii===1/0)return;yn.setup(ve,ye,zt,Ae,vt);let Sn,Kn=nn;if(vt!==null&&(Sn=An.get(vt),Kn=fn,Kn.setIndex(Sn)),ve.isMesh)ye.wireframe===!0?(wn.setLineWidth(ye.wireframeLinewidth*ze()),Kn.setMode(1)):Kn.setMode(4);else if(ve.isLine){let kn=ye.linewidth;kn===void 0&&(kn=1),wn.setLineWidth(kn*ze()),ve.isLineSegments?Kn.setMode(1):ve.isLineLoop?Kn.setMode(2):Kn.setMode(3)}else ve.isPoints?Kn.setMode(0):ve.isSprite&&Kn.setMode(4);if(ve.isInstancedMesh)Kn.renderInstances(gn,ii,ve.count);else if(Ae.isInstancedBufferGeometry){const kn=Ae._maxInstanceCount!==void 0?Ae._maxInstanceCount:1/0,hs=Math.min(Ae.instanceCount,kn);Kn.renderInstances(gn,ii,hs)}else Kn.render(gn,ii)},this.compile=function(ee,pe){function Ae(ye,ve,Je){ye.transparent===!0&&ye.side===Pd&&ye.forceSinglePass===!1?(ye.side=nl,ye.needsUpdate=!0,Kr(ye,ve,Je),ye.side=Gd,ye.needsUpdate=!0,Kr(ye,ve,Je),ye.side=Pd):Kr(ye,ve,Je)}T=Ti.get(ee),T.init(),P.push(T),ee.traverseVisible(function(ye){ye.isLight&&ye.layers.test(pe.layers)&&(T.pushLight(ye),ye.castShadow&&T.pushShadow(ye))}),T.setupLights(k.useLegacyLights),ee.traverse(function(ye){const ve=ye.material;if(ve)if(Array.isArray(ve))for(let Je=0;Je<ve.length;Je++){const ht=ve[Je];Ae(ht,ee,ye)}else Ae(ve,ee,ye)}),P.pop(),T=null};let rt=null;function Ct(ee){rt&&rt(ee)}function Vt(){Pn.stop()}function bn(){Pn.start()}const Pn=new J6;Pn.setAnimationLoop(Ct),typeof self<"u"&&Pn.setContext(self),this.setAnimationLoop=function(ee){rt=ee,Ke.setAnimationLoop(ee),ee===null?Pn.stop():Pn.start()},Ke.addEventListener("sessionstart",Vt),Ke.addEventListener("sessionend",bn),this.render=function(ee,pe){if(pe!==void 0&&pe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(R===!0)return;ee.matrixWorldAutoUpdate===!0&&ee.updateMatrixWorld(),pe.parent===null&&pe.matrixWorldAutoUpdate===!0&&pe.updateMatrixWorld(),Ke.enabled===!0&&Ke.isPresenting===!0&&(Ke.cameraAutoUpdate===!0&&Ke.updateCamera(pe),pe=Ke.getCamera()),ee.isScene===!0&&ee.onBeforeRender(k,ee,pe,N),T=Ti.get(ee,P.length),T.init(),P.push(T),Qe.multiplyMatrices(pe.projectionMatrix,pe.matrixWorldInverse),We.setFromProjectionMatrix(Qe),Te=this.localClippingEnabled,ce=Be.init(this.clippingPlanes,Te),S=ai.get(ee,C.length),S.init(),C.push(S),Ri(ee,pe,0,k.sortObjects),S.finish(),k.sortObjects===!0&&S.sort($e,ae),ce===!0&&Be.beginShadows();const Ae=T.state.shadowsArray;if(Se.render(Ae,ee,pe),ce===!0&&Be.endShadows(),this.info.autoReset===!0&&this.info.reset(),St.render(S,ee),T.setupLights(k.useLegacyLights),pe.isArrayCamera){const ye=pe.cameras;for(let ve=0,Je=ye.length;ve<Je;ve++){const ht=ye[ve];cr(S,ee,ht,ht.viewport)}}else cr(S,ee,pe);N!==null&&(At.updateMultisampleRenderTarget(N),At.updateRenderTargetMipmap(N)),ee.isScene===!0&&ee.onAfterRender(k,ee,pe),yn.resetDefaultState(),G=-1,j=null,P.pop(),P.length>0?T=P[P.length-1]:T=null,C.pop(),C.length>0?S=C[C.length-1]:S=null};function Ri(ee,pe,Ae,ye){if(ee.visible===!1)return;if(ee.layers.test(pe.layers)){if(ee.isGroup)Ae=ee.renderOrder;else if(ee.isLOD)ee.autoUpdate===!0&&ee.update(pe);else if(ee.isLight)T.pushLight(ee),ee.castShadow&&T.pushShadow(ee);else if(ee.isSprite){if(!ee.frustumCulled||We.intersectsSprite(ee)){ye&&Ne.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(Qe);const ht=Vn.update(ee),zt=ee.material;zt.visible&&S.push(ee,ht,zt,Ae,Ne.z,null)}}else if((ee.isMesh||ee.isLine||ee.isPoints)&&(ee.isSkinnedMesh&&ee.skeleton.frame!==_n.render.frame&&(ee.skeleton.update(),ee.skeleton.frame=_n.render.frame),!ee.frustumCulled||We.intersectsObject(ee))){ye&&Ne.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(Qe);const ht=Vn.update(ee),zt=ee.material;if(Array.isArray(zt)){const vt=ht.groups;for(let Kt=0,Yt=vt.length;Kt<Yt;Kt++){const Xt=vt[Kt],gn=zt[Xt.materialIndex];gn&&gn.visible&&S.push(ee,ht,gn,Ae,Ne.z,Xt)}}else zt.visible&&S.push(ee,ht,zt,Ae,Ne.z,null)}}const Je=ee.children;for(let ht=0,zt=Je.length;ht<zt;ht++)Ri(Je[ht],pe,Ae,ye)}function cr(ee,pe,Ae,ye){const ve=ee.opaque,Je=ee.transmissive,ht=ee.transparent;T.setupLightsView(Ae),ce===!0&&Be.setGlobalState(k.clippingPlanes,Ae),Je.length>0&&Or(ve,pe,Ae),ye&&wn.viewport(Q.copy(ye)),ve.length>0&&Cr(ve,pe,Ae),Je.length>0&&Cr(Je,pe,Ae),ht.length>0&&Cr(ht,pe,Ae),wn.buffers.depth.setTest(!0),wn.buffers.depth.setMask(!0),wn.buffers.color.setMask(!0),wn.setPolygonOffset(!1)}function Or(ee,pe,Ae){const ye=qt.isWebGL2;Pe===null&&(Pe=new Pu(1024,1024,{generateMipmaps:!0,type:Nt.has("EXT_color_buffer_half_float")?Ty:Wd,minFilter:bp,samples:ye&&a===!0?4:0}));const ve=k.getRenderTarget();k.setRenderTarget(Pe),k.clear();const Je=k.toneMapping;k.toneMapping=Au,Cr(ee,pe,Ae),k.toneMapping=Je,At.updateMultisampleRenderTarget(Pe),At.updateRenderTargetMipmap(Pe),k.setRenderTarget(ve)}function Cr(ee,pe,Ae){const ye=pe.isScene===!0?pe.overrideMaterial:null;for(let ve=0,Je=ee.length;ve<Je;ve++){const ht=ee[ve],zt=ht.object,vt=ht.geometry,Kt=ye===null?ht.material:ye,Yt=ht.group;zt.layers.test(Ae.layers)&&Gi(zt,pe,Ae,vt,Kt,Yt)}}function Gi(ee,pe,Ae,ye,ve,Je){ee.onBeforeRender(k,pe,Ae,ye,ve,Je),ee.modelViewMatrix.multiplyMatrices(Ae.matrixWorldInverse,ee.matrixWorld),ee.normalMatrix.getNormalMatrix(ee.modelViewMatrix),ve.onBeforeRender(k,pe,Ae,ye,ee,Je),ve.transparent===!0&&ve.side===Pd&&ve.forceSinglePass===!1?(ve.side=nl,ve.needsUpdate=!0,k.renderBufferDirect(Ae,pe,ye,ve,ee,Je),ve.side=Gd,ve.needsUpdate=!0,k.renderBufferDirect(Ae,pe,ye,ve,ee,Je),ve.side=Pd):k.renderBufferDirect(Ae,pe,ye,ve,ee,Je),ee.onAfterRender(k,pe,Ae,ye,ve,Je)}function Kr(ee,pe,Ae){pe.isScene!==!0&&(pe=nt);const ye=Ln.get(ee),ve=T.state.lights,Je=T.state.shadowsArray,ht=ve.state.version,zt=On.getParameters(ee,ve.state,Je,pe,Ae),vt=On.getProgramCacheKey(zt);let Kt=ye.programs;ye.environment=ee.isMeshStandardMaterial?pe.environment:null,ye.fog=pe.fog,ye.envMap=(ee.isMeshStandardMaterial?Ft:Ot).get(ee.envMap||ye.environment),Kt===void 0&&(ee.addEventListener("dispose",Yn),Kt=new Map,ye.programs=Kt);let Yt=Kt.get(vt);if(Yt!==void 0){if(ye.currentProgram===Yt&&ye.lightsStateVersion===ht)return Ee(ee,zt),Yt}else zt.uniforms=On.getUniforms(ee),ee.onBuild(Ae,zt,k),ee.onBeforeCompile(zt,k),Yt=On.acquireProgram(zt,vt),Kt.set(vt,Yt),ye.uniforms=zt.uniforms;const Xt=ye.uniforms;(!ee.isShaderMaterial&&!ee.isRawShaderMaterial||ee.clipping===!0)&&(Xt.clippingPlanes=Be.uniform),Ee(ee,zt),ye.needsLights=Ie(ee),ye.lightsStateVersion=ht,ye.needsLights&&(Xt.ambientLightColor.value=ve.state.ambient,Xt.lightProbe.value=ve.state.probe,Xt.directionalLights.value=ve.state.directional,Xt.directionalLightShadows.value=ve.state.directionalShadow,Xt.spotLights.value=ve.state.spot,Xt.spotLightShadows.value=ve.state.spotShadow,Xt.rectAreaLights.value=ve.state.rectArea,Xt.ltc_1.value=ve.state.rectAreaLTC1,Xt.ltc_2.value=ve.state.rectAreaLTC2,Xt.pointLights.value=ve.state.point,Xt.pointLightShadows.value=ve.state.pointShadow,Xt.hemisphereLights.value=ve.state.hemi,Xt.directionalShadowMap.value=ve.state.directionalShadowMap,Xt.directionalShadowMatrix.value=ve.state.directionalShadowMatrix,Xt.spotShadowMap.value=ve.state.spotShadowMap,Xt.spotLightMatrix.value=ve.state.spotLightMatrix,Xt.spotLightMap.value=ve.state.spotLightMap,Xt.pointShadowMap.value=ve.state.pointShadowMap,Xt.pointShadowMatrix.value=ve.state.pointShadowMatrix);const gn=Yt.getUniforms(),$n=cS.seqWithValue(gn.seq,Xt);return ye.currentProgram=Yt,ye.uniformsList=$n,Yt}function Ee(ee,pe){const Ae=Ln.get(ee);Ae.outputEncoding=pe.outputEncoding,Ae.instancing=pe.instancing,Ae.skinning=pe.skinning,Ae.morphTargets=pe.morphTargets,Ae.morphNormals=pe.morphNormals,Ae.morphColors=pe.morphColors,Ae.morphTargetsCount=pe.morphTargetsCount,Ae.numClippingPlanes=pe.numClippingPlanes,Ae.numIntersection=pe.numClipIntersection,Ae.vertexAlphas=pe.vertexAlphas,Ae.vertexTangents=pe.vertexTangents,Ae.toneMapping=pe.toneMapping}function se(ee,pe,Ae,ye,ve){pe.isScene!==!0&&(pe=nt),At.resetTextureUnits();const Je=pe.fog,ht=ye.isMeshStandardMaterial?pe.environment:null,zt=N===null?k.outputEncoding:N.isXRRenderTarget===!0?N.texture.encoding:Hd,vt=(ye.isMeshStandardMaterial?Ft:Ot).get(ye.envMap||ht),Kt=ye.vertexColors===!0&&!!Ae.attributes.color&&Ae.attributes.color.itemSize===4,Yt=!!ye.normalMap&&!!Ae.attributes.tangent,Xt=!!Ae.morphAttributes.position,gn=!!Ae.morphAttributes.normal,$n=!!Ae.morphAttributes.color,ii=ye.toneMapped?k.toneMapping:Au,Sn=Ae.morphAttributes.position||Ae.morphAttributes.normal||Ae.morphAttributes.color,Kn=Sn!==void 0?Sn.length:0,kn=Ln.get(ye),hs=T.state.lights;if(ce===!0&&(Te===!0||ee!==j)){const yr=ee===j&&ye.id===G;Be.setState(ye,ee,yr)}let Qi=!1;ye.version===kn.__version?(kn.needsLights&&kn.lightsStateVersion!==hs.state.version||kn.outputEncoding!==zt||ve.isInstancedMesh&&kn.instancing===!1||!ve.isInstancedMesh&&kn.instancing===!0||ve.isSkinnedMesh&&kn.skinning===!1||!ve.isSkinnedMesh&&kn.skinning===!0||kn.envMap!==vt||ye.fog===!0&&kn.fog!==Je||kn.numClippingPlanes!==void 0&&(kn.numClippingPlanes!==Be.numPlanes||kn.numIntersection!==Be.numIntersection)||kn.vertexAlphas!==Kt||kn.vertexTangents!==Yt||kn.morphTargets!==Xt||kn.morphNormals!==gn||kn.morphColors!==$n||kn.toneMapping!==ii||qt.isWebGL2===!0&&kn.morphTargetsCount!==Kn)&&(Qi=!0):(Qi=!0,kn.__version=ye.version);let Fr=kn.currentProgram;Qi===!0&&(Fr=Kr(ye,pe,ve));let wt=!1,Ss=!1,er=!1;const Ni=Fr.getUniforms(),zi=kn.uniforms;if(wn.useProgram(Fr.program)&&(wt=!0,Ss=!0,er=!0),ye.id!==G&&(G=ye.id,Ss=!0),wt||j!==ee){if(Ni.setValue(et,"projectionMatrix",ee.projectionMatrix),qt.logarithmicDepthBuffer&&Ni.setValue(et,"logDepthBufFC",2/(Math.log(ee.far+1)/Math.LN2)),j!==ee&&(j=ee,Ss=!0,er=!0),ye.isShaderMaterial||ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshStandardMaterial||ye.envMap){const yr=Ni.map.cameraPosition;yr!==void 0&&yr.setValue(et,Ne.setFromMatrixPosition(ee.matrixWorld))}(ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshLambertMaterial||ye.isMeshBasicMaterial||ye.isMeshStandardMaterial||ye.isShaderMaterial)&&Ni.setValue(et,"isOrthographic",ee.isOrthographicCamera===!0),(ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshLambertMaterial||ye.isMeshBasicMaterial||ye.isMeshStandardMaterial||ye.isShaderMaterial||ye.isShadowMaterial||ve.isSkinnedMesh)&&Ni.setValue(et,"viewMatrix",ee.matrixWorldInverse)}if(ve.isSkinnedMesh){Ni.setOptional(et,ve,"bindMatrix"),Ni.setOptional(et,ve,"bindMatrixInverse");const yr=ve.skeleton;yr&&(qt.floatVertexTextures?(yr.boneTexture===null&&yr.computeBoneTexture(),Ni.setValue(et,"boneTexture",yr.boneTexture,At),Ni.setValue(et,"boneTextureSize",yr.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const ci=Ae.morphAttributes;if((ci.position!==void 0||ci.normal!==void 0||ci.color!==void 0&&qt.isWebGL2===!0)&&tn.update(ve,Ae,Fr),(Ss||kn.receiveShadow!==ve.receiveShadow)&&(kn.receiveShadow=ve.receiveShadow,Ni.setValue(et,"receiveShadow",ve.receiveShadow)),ye.isMeshGouraudMaterial&&ye.envMap!==null&&(zi.envMap.value=vt,zi.flipEnvMap.value=vt.isCubeTexture&&vt.isRenderTargetTexture===!1?-1:1),Ss&&(Ni.setValue(et,"toneMappingExposure",k.toneMappingExposure),kn.needsLights&&de(zi,er),Je&&ye.fog===!0&&Zn.refreshFogUniforms(zi,Je),Zn.refreshMaterialUniforms(zi,ye,De,ue,Pe),cS.upload(et,kn.uniformsList,zi,At)),ye.isShaderMaterial&&ye.uniformsNeedUpdate===!0&&(cS.upload(et,kn.uniformsList,zi,At),ye.uniformsNeedUpdate=!1),ye.isSpriteMaterial&&Ni.setValue(et,"center",ve.center),Ni.setValue(et,"modelViewMatrix",ve.modelViewMatrix),Ni.setValue(et,"normalMatrix",ve.normalMatrix),Ni.setValue(et,"modelMatrix",ve.matrixWorld),ye.isShaderMaterial||ye.isRawShaderMaterial){const yr=ye.uniformsGroups;for(let Nr=0,qi=yr.length;Nr<qi;Nr++)if(qt.isWebGL2){const Jt=yr[Nr];Lt.update(Jt,Fr),Lt.bind(Jt,Fr)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Fr}function de(ee,pe){ee.ambientLightColor.needsUpdate=pe,ee.lightProbe.needsUpdate=pe,ee.directionalLights.needsUpdate=pe,ee.directionalLightShadows.needsUpdate=pe,ee.pointLights.needsUpdate=pe,ee.pointLightShadows.needsUpdate=pe,ee.spotLights.needsUpdate=pe,ee.spotLightShadows.needsUpdate=pe,ee.rectAreaLights.needsUpdate=pe,ee.hemisphereLights.needsUpdate=pe}function Ie(ee){return ee.isMeshLambertMaterial||ee.isMeshToonMaterial||ee.isMeshPhongMaterial||ee.isMeshStandardMaterial||ee.isShadowMaterial||ee.isShaderMaterial&&ee.lights===!0}this.getActiveCubeFace=function(){return O},this.getActiveMipmapLevel=function(){return F},this.getRenderTarget=function(){return N},this.setRenderTargetTextures=function(ee,pe,Ae){Ln.get(ee.texture).__webglTexture=pe,Ln.get(ee.depthTexture).__webglTexture=Ae;const ye=Ln.get(ee);ye.__hasExternalTextures=!0,ye.__hasExternalTextures&&(ye.__autoAllocateDepthBuffer=Ae===void 0,ye.__autoAllocateDepthBuffer||Nt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ye.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ee,pe){const Ae=Ln.get(ee);Ae.__webglFramebuffer=pe,Ae.__useDefaultFramebuffer=pe===void 0},this.setRenderTarget=function(ee,pe=0,Ae=0){N=ee,O=pe,F=Ae;let ye=!0,ve=null,Je=!1,ht=!1;if(ee){const vt=Ln.get(ee);vt.__useDefaultFramebuffer!==void 0?(wn.bindFramebuffer(36160,null),ye=!1):vt.__webglFramebuffer===void 0?At.setupRenderTarget(ee):vt.__hasExternalTextures&&At.rebindTextures(ee,Ln.get(ee.texture).__webglTexture,Ln.get(ee.depthTexture).__webglTexture);const Kt=ee.texture;(Kt.isData3DTexture||Kt.isDataArrayTexture||Kt.isCompressedArrayTexture)&&(ht=!0);const Yt=Ln.get(ee).__webglFramebuffer;ee.isWebGLCubeRenderTarget?(ve=Yt[pe],Je=!0):qt.isWebGL2&&ee.samples>0&&At.useMultisampledRTT(ee)===!1?ve=Ln.get(ee).__webglMultisampledFramebuffer:ve=Yt,Q.copy(ee.viewport),re.copy(ee.scissor),$=ee.scissorTest}else Q.copy(le).multiplyScalar(De).floor(),re.copy(fe).multiplyScalar(De).floor(),$=Oe;if(wn.bindFramebuffer(36160,ve)&&qt.drawBuffers&&ye&&wn.drawBuffers(ee,ve),wn.viewport(Q),wn.scissor(re),wn.setScissorTest($),Je){const vt=Ln.get(ee.texture);et.framebufferTexture2D(36160,36064,34069+pe,vt.__webglTexture,Ae)}else if(ht){const vt=Ln.get(ee.texture),Kt=pe||0;et.framebufferTextureLayer(36160,36064,vt.__webglTexture,Ae||0,Kt)}G=-1},this.readRenderTargetPixels=function(ee,pe,Ae,ye,ve,Je,ht){if(!(ee&&ee.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let zt=Ln.get(ee).__webglFramebuffer;if(ee.isWebGLCubeRenderTarget&&ht!==void 0&&(zt=zt[ht]),zt){wn.bindFramebuffer(36160,zt);try{const vt=ee.texture,Kt=vt.format,Yt=vt.type;if(Kt!==$a&&Nn.convert(Kt)!==et.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Xt=Yt===Ty&&(Nt.has("EXT_color_buffer_half_float")||qt.isWebGL2&&Nt.has("EXT_color_buffer_float"));if(Yt!==Wd&&Nn.convert(Yt)!==et.getParameter(35738)&&!(Yt===kd&&(qt.isWebGL2||Nt.has("OES_texture_float")||Nt.has("WEBGL_color_buffer_float")))&&!Xt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}pe>=0&&pe<=ee.width-ye&&Ae>=0&&Ae<=ee.height-ve&&et.readPixels(pe,Ae,ye,ve,Nn.convert(Kt),Nn.convert(Yt),Je)}finally{const vt=N!==null?Ln.get(N).__webglFramebuffer:null;wn.bindFramebuffer(36160,vt)}}},this.copyFramebufferToTexture=function(ee,pe,Ae=0){const ye=Math.pow(2,-Ae),ve=Math.floor(pe.image.width*ye),Je=Math.floor(pe.image.height*ye);At.setTexture2D(pe,0),et.copyTexSubImage2D(3553,Ae,0,0,ee.x,ee.y,ve,Je),wn.unbindTexture()},this.copyTextureToTexture=function(ee,pe,Ae,ye=0){const ve=pe.image.width,Je=pe.image.height,ht=Nn.convert(Ae.format),zt=Nn.convert(Ae.type);At.setTexture2D(Ae,0),et.pixelStorei(37440,Ae.flipY),et.pixelStorei(37441,Ae.premultiplyAlpha),et.pixelStorei(3317,Ae.unpackAlignment),pe.isDataTexture?et.texSubImage2D(3553,ye,ee.x,ee.y,ve,Je,ht,zt,pe.image.data):pe.isCompressedTexture?et.compressedTexSubImage2D(3553,ye,ee.x,ee.y,pe.mipmaps[0].width,pe.mipmaps[0].height,ht,pe.mipmaps[0].data):et.texSubImage2D(3553,ye,ee.x,ee.y,ht,zt,pe.image),ye===0&&Ae.generateMipmaps&&et.generateMipmap(3553),wn.unbindTexture()},this.copyTextureToTexture3D=function(ee,pe,Ae,ye,ve=0){if(k.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Je=ee.max.x-ee.min.x+1,ht=ee.max.y-ee.min.y+1,zt=ee.max.z-ee.min.z+1,vt=Nn.convert(ye.format),Kt=Nn.convert(ye.type);let Yt;if(ye.isData3DTexture)At.setTexture3D(ye,0),Yt=32879;else if(ye.isDataArrayTexture)At.setTexture2DArray(ye,0),Yt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}et.pixelStorei(37440,ye.flipY),et.pixelStorei(37441,ye.premultiplyAlpha),et.pixelStorei(3317,ye.unpackAlignment);const Xt=et.getParameter(3314),gn=et.getParameter(32878),$n=et.getParameter(3316),ii=et.getParameter(3315),Sn=et.getParameter(32877),Kn=Ae.isCompressedTexture?Ae.mipmaps[0]:Ae.image;et.pixelStorei(3314,Kn.width),et.pixelStorei(32878,Kn.height),et.pixelStorei(3316,ee.min.x),et.pixelStorei(3315,ee.min.y),et.pixelStorei(32877,ee.min.z),Ae.isDataTexture||Ae.isData3DTexture?et.texSubImage3D(Yt,ve,pe.x,pe.y,pe.z,Je,ht,zt,vt,Kt,Kn.data):Ae.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),et.compressedTexSubImage3D(Yt,ve,pe.x,pe.y,pe.z,Je,ht,zt,vt,Kn.data)):et.texSubImage3D(Yt,ve,pe.x,pe.y,pe.z,Je,ht,zt,vt,Kt,Kn),et.pixelStorei(3314,Xt),et.pixelStorei(32878,gn),et.pixelStorei(3316,$n),et.pixelStorei(3315,ii),et.pixelStorei(32877,Sn),ve===0&&ye.generateMipmaps&&et.generateMipmap(Yt),wn.unbindTexture()},this.initTexture=function(ee){ee.isCubeTexture?At.setTextureCube(ee,0):ee.isData3DTexture?At.setTexture3D(ee,0):ee.isDataArrayTexture||ee.isCompressedArrayTexture?At.setTexture2DArray(ee,0):At.setTexture2D(ee,0),wn.unbindTexture()},this.resetState=function(){O=0,F=0,N=null,wn.reset(),yn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object.defineProperties(qM.prototype,{physicallyCorrectLights:{get:function(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights},set:function(n){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!n}}});class sV extends qM{}sV.prototype.isWebGL1Renderer=!0;class ZM{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new zn(e),this.density=t}clone(){return new ZM(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class $M{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new zn(e),this.near=t,this.far=i}clone(){return new $M(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class sM extends lr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class XM{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Iv,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Rl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,a=this.stride;r<a;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ba=new Fe;class dg{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ba.fromBufferAttribute(this,t),ba.applyMatrix4(e),this.setXYZ(t,ba.x,ba.y,ba.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ba.fromBufferAttribute(this,t),ba.applyNormalMatrix(e),this.setXYZ(t,ba.x,ba.y,ba.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ba.fromBufferAttribute(this,t),ba.transformDirection(e),this.setXYZ(t,ba.x,ba.y,ba.z);return this}setX(e,t){return this.normalized&&(t=kr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=kr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=kr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=kr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Dd(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Dd(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Dd(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Dd(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=kr(t,this.array),i=kr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=kr(t,this.array),i=kr(i,this.array),r=kr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=kr(t,this.array),i=kr(i,this.array),r=kr(r,this.array),a=kr(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=a,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[r+a])}return new zr(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new dg(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[r+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class dk extends No{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new zn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let S_;const rx=new Fe,M_=new Fe,T_=new Fe,E_=new Ht,sx=new Ht,oV=new vi,pb=new Fe,ox=new Fe,mb=new Fe,LO=new Ht,EE=new Ht,RO=new Ht;class aV extends lr{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",S_===void 0){S_=new Pi;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new XM(t,5);S_.setIndex([0,1,2,0,2,3]),S_.setAttribute("position",new dg(i,3,0,!1)),S_.setAttribute("uv",new dg(i,2,3,!1))}this.geometry=S_,this.material=e!==void 0?e:new dk,this.center=new Ht(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),M_.setFromMatrixScale(this.matrixWorld),oV.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),T_.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&M_.multiplyScalar(-T_.z);const i=this.material.rotation;let r,a;i!==0&&(a=Math.cos(i),r=Math.sin(i));const l=this.center;gb(pb.set(-.5,-.5,0),T_,l,M_,r,a),gb(ox.set(.5,-.5,0),T_,l,M_,r,a),gb(mb.set(.5,.5,0),T_,l,M_,r,a),LO.set(0,0),EE.set(1,0),RO.set(1,1);let s=e.ray.intersectTriangle(pb,ox,mb,!1,rx);if(s===null&&(gb(ox.set(-.5,.5,0),T_,l,M_,r,a),EE.set(0,1),s=e.ray.intersectTriangle(pb,mb,ox,!1,rx),s===null))return;const d=e.ray.origin.distanceTo(rx);d<e.near||d>e.far||t.push({distance:d,point:rx.clone(),uv:yc.getUV(rx,pb,ox,mb,LO,EE,RO,new Ht),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function gb(n,e,t,i,r,a){E_.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(sx.x=a*E_.x-r*E_.y,sx.y=r*E_.x+a*E_.y):sx.copy(E_),n.copy(e),n.x+=sx.x,n.y+=sx.y,n.applyMatrix4(oV)}const _b=new Fe,zO=new Fe;class lV extends lr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,r=t.length;i<r;i++){const a=t[i];this.addLevel(a.object.clone(),a.distance,a.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const r=this.levels;let a;for(a=0;a<r.length&&!(t<r[a].distance);a++);return r.splice(a,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r;i++){let a=t[i].distance;if(t[i].object.visible&&(a-=a*t[i].hysteresis),e<a)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){_b.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(_b);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){_b.setFromMatrixPosition(e.matrixWorld),zO.setFromMatrixPosition(this.matrixWorld);const i=_b.distanceTo(zO)/e.zoom;t[0].object.visible=!0;let r,a;for(r=1,a=t.length;r<a;r++){let l=t[r].distance;if(t[r].object.visible&&(l-=l*t[r].hysteresis),i>=l)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<a;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let r=0,a=i.length;r<a;r++){const l=i[r];t.object.levels.push({object:l.object.uuid,distance:l.distance,hysteresis:l.hysteresis})}return t}}const OO=new Fe,FO=new br,BO=new br,_re=new Fe,NO=new vi;class cV extends Oo{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new vi,this.bindMatrixInverse=new vi}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new br,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,r=this.geometry;FO.fromBufferAttribute(r.attributes.skinIndex,e),BO.fromBufferAttribute(r.attributes.skinWeight,e),OO.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let a=0;a<4;a++){const l=BO.getComponent(a);if(l!==0){const s=FO.getComponent(a);NO.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),t.addScaledVector(_re.copy(OO).applyMatrix4(NO),l)}}return t.applyMatrix4(this.bindMatrixInverse)}}class fk extends lr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ay extends bs{constructor(e=null,t=1,i=1,r,a,l,s,d,m=Ls,_=Ls,S,T){super(null,l,s,d,m,_,r,a,S,T),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const UO=new vi,yre=new vi;class YM{constructor(e=[],t=[]){this.uuid=Rl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new vi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new vi;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let a=0,l=e.length;a<l;a++){const s=e[a]?e[a].matrixWorld:yre;UO.multiplyMatrices(s,t[a]),UO.toArray(i,a*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new YM(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=W6(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new ay(t,e,e,$a,kd);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const a=e.bones[i];let l=t[a];l===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),l=new fk),this.bones.push(l),this.boneInverses.push(new vi().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,a=t.length;r<a;r++){const l=t[r];e.bones.push(l.uuid);const s=i[r];e.boneInverses.push(s.toArray())}return e}}class Cy extends zr{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const VO=new vi,GO=new vi,yb=[],xre=new vi,ax=new Oo;class uV extends Oo{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Cy(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,xre)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(ax.geometry=this.geometry,ax.material=this.material,ax.material!==void 0)for(let a=0;a<r;a++){this.getMatrixAt(a,VO),GO.multiplyMatrices(i,VO),ax.matrixWorld=GO,ax.raycast(e,yb);for(let l=0,s=yb.length;l<s;l++){const d=yb[l];d.instanceId=a,d.object=this,t.push(d)}yb.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Cy(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class ka extends No{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new zn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const WO=new Fe,HO=new Fe,jO=new vi,AE=new l1,xb=new wg;class Sp extends lr{constructor(e=new Pi,t=new ka){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,a=t.count;r<a;r++)WO.fromBufferAttribute(t,r-1),HO.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=WO.distanceTo(HO);e.setAttribute("lineDistance",new qn(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,a=e.params.Line.threshold,l=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),xb.copy(i.boundingSphere),xb.applyMatrix4(r),xb.radius+=a,e.ray.intersectsSphere(xb)===!1)return;jO.copy(r).invert(),AE.copy(e.ray).applyMatrix4(jO);const s=a/((this.scale.x+this.scale.y+this.scale.z)/3),d=s*s,m=new Fe,_=new Fe,S=new Fe,T=new Fe,C=this.isLineSegments?2:1,P=i.index,R=i.attributes.position;if(P!==null){const O=Math.max(0,l.start),F=Math.min(P.count,l.start+l.count);for(let N=O,G=F-1;N<G;N+=C){const j=P.getX(N),Q=P.getX(N+1);if(m.fromBufferAttribute(R,j),_.fromBufferAttribute(R,Q),AE.distanceSqToSegment(m,_,T,S)>d)continue;T.applyMatrix4(this.matrixWorld);const $=e.ray.origin.distanceTo(T);$<e.near||$>e.far||t.push({distance:$,point:S.clone().applyMatrix4(this.matrixWorld),index:N,face:null,faceIndex:null,object:this})}}else{const O=Math.max(0,l.start),F=Math.min(R.count,l.start+l.count);for(let N=O,G=F-1;N<G;N+=C){if(m.fromBufferAttribute(R,N),_.fromBufferAttribute(R,N+1),AE.distanceSqToSegment(m,_,T,S)>d)continue;T.applyMatrix4(this.matrixWorld);const Q=e.ray.origin.distanceTo(T);Q<e.near||Q>e.far||t.push({distance:Q,point:S.clone().applyMatrix4(this.matrixWorld),index:N,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=r.length;a<l;a++){const s=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=a}}}}}const qO=new Fe,ZO=new Fe;class Th extends Sp{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,a=t.count;r<a;r+=2)qO.fromBufferAttribute(t,r),ZO.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+qO.distanceTo(ZO);e.setAttribute("lineDistance",new qn(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class hV extends Sp{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class pk extends No{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new zn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const $O=new vi,nI=new l1,vb=new wg,wb=new Fe;class dV extends lr{constructor(e=new Pi,t=new pk){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,a=e.params.Points.threshold,l=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),vb.copy(i.boundingSphere),vb.applyMatrix4(r),vb.radius+=a,e.ray.intersectsSphere(vb)===!1)return;$O.copy(r).invert(),nI.copy(e.ray).applyMatrix4($O);const s=a/((this.scale.x+this.scale.y+this.scale.z)/3),d=s*s,m=i.index,S=i.attributes.position;if(m!==null){const T=Math.max(0,l.start),C=Math.min(m.count,l.start+l.count);for(let P=T,k=C;P<k;P++){const R=m.getX(P);wb.fromBufferAttribute(S,R),XO(wb,R,d,r,e,t,this)}}else{const T=Math.max(0,l.start),C=Math.min(S.count,l.start+l.count);for(let P=T,k=C;P<k;P++)wb.fromBufferAttribute(S,P),XO(wb,P,d,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=r.length;a<l;a++){const s=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=a}}}}}function XO(n,e,t,i,r,a,l){const s=nI.distanceSqToPoint(n);if(s<t){const d=new Fe;nI.closestPointToPoint(n,d),d.applyMatrix4(i);const m=r.ray.origin.distanceTo(d);if(m<r.near||m>r.far)return;a.push({distance:m,distanceToRay:Math.sqrt(s),point:d,index:e,face:null,object:l})}}class vre extends bs{constructor(e,t,i,r,a,l,s,d,m){super(e,t,i,r,a,l,s,d,m),this.isVideoTexture=!0,this.minFilter=l!==void 0?l:zs,this.magFilter=a!==void 0?a:zs,this.generateMipmaps=!1;const _=this;function S(){_.needsUpdate=!0,e.requestVideoFrameCallback(S)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(S)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class wre extends bs{constructor(e,t,i){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=i,this.magFilter=Ls,this.minFilter=Ls,this.generateMipmaps=!1,this.needsUpdate=!0}}class mk extends bs{constructor(e,t,i,r,a,l,s,d,m,_,S,T){super(null,l,s,d,m,_,r,a,S,T),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class bre extends mk{constructor(e,t,i,r,a,l){super(e,t,i,a,l),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=la}}class Sre extends bs{constructor(e,t,i,r,a,l,s,d,m){super(e,t,i,r,a,l,s,d,m),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Du{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),a=0;t.push(0);for(let l=1;l<=e;l++)i=this.getPoint(l/e),a+=i.distanceTo(r),t.push(a),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const a=i.length;let l;t?l=t:l=e*i[a-1];let s=0,d=a-1,m;for(;s<=d;)if(r=Math.floor(s+(d-s)/2),m=i[r]-l,m<0)s=r+1;else if(m>0)d=r-1;else{d=r;break}if(r=d,i[r]===l)return r/(a-1);const _=i[r],T=i[r+1]-_,C=(l-_)/T;return(r+C)/(a-1)}getTangent(e,t){let r=e-1e-4,a=e+1e-4;r<0&&(r=0),a>1&&(a=1);const l=this.getPoint(r),s=this.getPoint(a),d=t||(l.isVector2?new Ht:new Fe);return d.copy(s).sub(l).normalize(),d}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new Fe,r=[],a=[],l=[],s=new Fe,d=new vi;for(let C=0;C<=e;C++){const P=C/e;r[C]=this.getTangentAt(P,new Fe)}a[0]=new Fe,l[0]=new Fe;let m=Number.MAX_VALUE;const _=Math.abs(r[0].x),S=Math.abs(r[0].y),T=Math.abs(r[0].z);_<=m&&(m=_,i.set(1,0,0)),S<=m&&(m=S,i.set(0,1,0)),T<=m&&i.set(0,0,1),s.crossVectors(r[0],i).normalize(),a[0].crossVectors(r[0],s),l[0].crossVectors(r[0],a[0]);for(let C=1;C<=e;C++){if(a[C]=a[C-1].clone(),l[C]=l[C-1].clone(),s.crossVectors(r[C-1],r[C]),s.length()>Number.EPSILON){s.normalize();const P=Math.acos(Os(r[C-1].dot(r[C]),-1,1));a[C].applyMatrix4(d.makeRotationAxis(s,P))}l[C].crossVectors(r[C],a[C])}if(t===!0){let C=Math.acos(Os(a[0].dot(a[e]),-1,1));C/=e,r[0].dot(s.crossVectors(a[0],a[e]))>0&&(C=-C);for(let P=1;P<=e;P++)a[P].applyMatrix4(d.makeRotationAxis(r[P],C*P)),l[P].crossVectors(r[P],a[P])}return{tangents:r,normals:a,binormals:l}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class JM extends Du{constructor(e=0,t=0,i=1,r=1,a=0,l=Math.PI*2,s=!1,d=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=a,this.aEndAngle=l,this.aClockwise=s,this.aRotation=d}getPoint(e,t){const i=t||new Ht,r=Math.PI*2;let a=this.aEndAngle-this.aStartAngle;const l=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=r;for(;a>r;)a-=r;a<Number.EPSILON&&(l?a=0:a=r),this.aClockwise===!0&&!l&&(a===r?a=-r:a=a-r);const s=this.aStartAngle+e*a;let d=this.aX+this.xRadius*Math.cos(s),m=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){const _=Math.cos(this.aRotation),S=Math.sin(this.aRotation),T=d-this.aX,C=m-this.aY;d=T*_-C*S+this.aX,m=T*S+C*_+this.aY}return i.set(d,m)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class fV extends JM{constructor(e,t,i,r,a,l){super(e,t,i,i,r,a,l),this.isArcCurve=!0,this.type="ArcCurve"}}function gk(){let n=0,e=0,t=0,i=0;function r(a,l,s,d){n=a,e=s,t=-3*a+3*l-2*s-d,i=2*a-2*l+s+d}return{initCatmullRom:function(a,l,s,d,m){r(l,s,m*(s-a),m*(d-l))},initNonuniformCatmullRom:function(a,l,s,d,m,_,S){let T=(l-a)/m-(s-a)/(m+_)+(s-l)/_,C=(s-l)/_-(d-l)/(_+S)+(d-s)/S;T*=_,C*=_,r(l,s,T,C)},calc:function(a){const l=a*a,s=l*a;return n+e*a+t*l+i*s}}}const bb=new Fe,CE=new gk,IE=new gk,PE=new gk;class pV extends Du{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new Fe){const i=t,r=this.points,a=r.length,l=(a-(this.closed?0:1))*e;let s=Math.floor(l),d=l-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/a)+1)*a:d===0&&s===a-1&&(s=a-2,d=1);let m,_;this.closed||s>0?m=r[(s-1)%a]:(bb.subVectors(r[0],r[1]).add(r[0]),m=bb);const S=r[s%a],T=r[(s+1)%a];if(this.closed||s+2<a?_=r[(s+2)%a]:(bb.subVectors(r[a-1],r[a-2]).add(r[a-1]),_=bb),this.curveType==="centripetal"||this.curveType==="chordal"){const C=this.curveType==="chordal"?.5:.25;let P=Math.pow(m.distanceToSquared(S),C),k=Math.pow(S.distanceToSquared(T),C),R=Math.pow(T.distanceToSquared(_),C);k<1e-4&&(k=1),P<1e-4&&(P=k),R<1e-4&&(R=k),CE.initNonuniformCatmullRom(m.x,S.x,T.x,_.x,P,k,R),IE.initNonuniformCatmullRom(m.y,S.y,T.y,_.y,P,k,R),PE.initNonuniformCatmullRom(m.z,S.z,T.z,_.z,P,k,R)}else this.curveType==="catmullrom"&&(CE.initCatmullRom(m.x,S.x,T.x,_.x,this.tension),IE.initCatmullRom(m.y,S.y,T.y,_.y,this.tension),PE.initCatmullRom(m.z,S.z,T.z,_.z,this.tension));return i.set(CE.calc(d),IE.calc(d),PE.calc(d)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new Fe().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function YO(n,e,t,i,r){const a=(i-e)*.5,l=(r-t)*.5,s=n*n,d=n*s;return(2*t-2*i+a+l)*d+(-3*t+3*i-2*a-l)*s+a*n+t}function Mre(n,e){const t=1-n;return t*t*e}function Tre(n,e){return 2*(1-n)*n*e}function Ere(n,e){return n*n*e}function jx(n,e,t,i){return Mre(n,e)+Tre(n,t)+Ere(n,i)}function Are(n,e){const t=1-n;return t*t*t*e}function Cre(n,e){const t=1-n;return 3*t*t*n*e}function Ire(n,e){return 3*(1-n)*n*n*e}function Pre(n,e){return n*n*n*e}function qx(n,e,t,i,r){return Are(n,e)+Cre(n,t)+Ire(n,i)+Pre(n,r)}class _k extends Du{constructor(e=new Ht,t=new Ht,i=new Ht,r=new Ht){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Ht){const i=t,r=this.v0,a=this.v1,l=this.v2,s=this.v3;return i.set(qx(e,r.x,a.x,l.x,s.x),qx(e,r.y,a.y,l.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class mV extends Du{constructor(e=new Fe,t=new Fe,i=new Fe,r=new Fe){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Fe){const i=t,r=this.v0,a=this.v1,l=this.v2,s=this.v3;return i.set(qx(e,r.x,a.x,l.x,s.x),qx(e,r.y,a.y,l.y,s.y),qx(e,r.z,a.z,l.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class KM extends Du{constructor(e=new Ht,t=new Ht){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ht){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ht){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class gV extends Du{constructor(e=new Fe,t=new Fe){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Fe){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Fe){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class yk extends Du{constructor(e=new Ht,t=new Ht,i=new Ht){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Ht){const i=t,r=this.v0,a=this.v1,l=this.v2;return i.set(jx(e,r.x,a.x,l.x),jx(e,r.y,a.y,l.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class xk extends Du{constructor(e=new Fe,t=new Fe,i=new Fe){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Fe){const i=t,r=this.v0,a=this.v1,l=this.v2;return i.set(jx(e,r.x,a.x,l.x),jx(e,r.y,a.y,l.y),jx(e,r.z,a.z,l.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class vk extends Du{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ht){const i=t,r=this.points,a=(r.length-1)*e,l=Math.floor(a),s=a-l,d=r[l===0?l:l-1],m=r[l],_=r[l>r.length-2?r.length-1:l+1],S=r[l>r.length-3?r.length-1:l+2];return i.set(YO(s,d.x,m.x,_.x,S.x),YO(s,d.y,m.y,_.y,S.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new Ht().fromArray(r))}return this}}var wk=Object.freeze({__proto__:null,ArcCurve:fV,CatmullRomCurve3:pV,CubicBezierCurve:_k,CubicBezierCurve3:mV,EllipseCurve:JM,LineCurve:KM,LineCurve3:gV,QuadraticBezierCurve:yk,QuadraticBezierCurve3:xk,SplineCurve:vk});class _V extends Du{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new KM(t,e))}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let a=0;for(;a<r.length;){if(r[a]>=i){const l=r[a]-i,s=this.curves[a],d=s.getLength(),m=d===0?0:1-l/d;return s.getPointAt(m,t)}a++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,a=this.curves;r<a.length;r++){const l=a[r],s=l.isEllipseCurve?e*2:l.isLineCurve||l.isLineCurve3?1:l.isSplineCurve?e*l.points.length:e,d=l.getPoints(s);for(let m=0;m<d.length;m++){const _=d[m];i&&i.equals(_)||(t.push(_),i=_)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(new wk[r.type]().fromJSON(r))}return this}}class Dv extends _V{constructor(e){super(),this.type="Path",this.currentPoint=new Ht,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new KM(this.currentPoint.clone(),new Ht(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const a=new yk(this.currentPoint.clone(),new Ht(e,t),new Ht(i,r));return this.curves.push(a),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,a,l){const s=new _k(this.currentPoint.clone(),new Ht(e,t),new Ht(i,r),new Ht(a,l));return this.curves.push(s),this.currentPoint.set(a,l),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new vk(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,a,l){const s=this.currentPoint.x,d=this.currentPoint.y;return this.absarc(e+s,t+d,i,r,a,l),this}absarc(e,t,i,r,a,l){return this.absellipse(e,t,i,i,r,a,l),this}ellipse(e,t,i,r,a,l,s,d){const m=this.currentPoint.x,_=this.currentPoint.y;return this.absellipse(e+m,t+_,i,r,a,l,s,d),this}absellipse(e,t,i,r,a,l,s,d){const m=new JM(e,t,i,r,a,l,s,d);if(this.curves.length>0){const S=m.getPoint(0);S.equals(this.currentPoint)||this.lineTo(S.x,S.y)}this.curves.push(m);const _=m.getPoint(1);return this.currentPoint.copy(_),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Vy extends Pi{constructor(e=[new Ht(0,-.5),new Ht(.5,0),new Ht(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Os(r,0,Math.PI*2);const a=[],l=[],s=[],d=[],m=[],_=1/t,S=new Fe,T=new Ht,C=new Fe,P=new Fe,k=new Fe;let R=0,O=0;for(let F=0;F<=e.length-1;F++)switch(F){case 0:R=e[F+1].x-e[F].x,O=e[F+1].y-e[F].y,C.x=O*1,C.y=-R,C.z=O*0,k.copy(C),C.normalize(),d.push(C.x,C.y,C.z);break;case e.length-1:d.push(k.x,k.y,k.z);break;default:R=e[F+1].x-e[F].x,O=e[F+1].y-e[F].y,C.x=O*1,C.y=-R,C.z=O*0,P.copy(C),C.x+=k.x,C.y+=k.y,C.z+=k.z,C.normalize(),d.push(C.x,C.y,C.z),k.copy(P)}for(let F=0;F<=t;F++){const N=i+F*_*r,G=Math.sin(N),j=Math.cos(N);for(let Q=0;Q<=e.length-1;Q++){S.x=e[Q].x*G,S.y=e[Q].y,S.z=e[Q].x*j,l.push(S.x,S.y,S.z),T.x=F/t,T.y=Q/(e.length-1),s.push(T.x,T.y);const re=d[3*Q+0]*G,$=d[3*Q+1],ne=d[3*Q+0]*j;m.push(re,$,ne)}}for(let F=0;F<t;F++)for(let N=0;N<e.length-1;N++){const G=N+F*e.length,j=G,Q=G+e.length,re=G+e.length+1,$=G+1;a.push(j,Q,$),a.push(re,$,Q)}this.setIndex(a),this.setAttribute("position",new qn(l,3)),this.setAttribute("uv",new qn(s,2)),this.setAttribute("normal",new qn(m,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vy(e.points,e.segments,e.phiStart,e.phiLength)}}class d1 extends Vy{constructor(e=1,t=1,i=4,r=8){const a=new Dv;a.absarc(0,-t/2,e,Math.PI*1.5,0),a.absarc(0,t/2,e,0,Math.PI*.5),super(a.getPoints(i),r),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:r}}static fromJSON(e){return new d1(e.radius,e.length,e.capSegments,e.radialSegments)}}class f1 extends Pi{constructor(e=1,t=32,i=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},t=Math.max(3,t);const a=[],l=[],s=[],d=[],m=new Fe,_=new Ht;l.push(0,0,0),s.push(0,0,1),d.push(.5,.5);for(let S=0,T=3;S<=t;S++,T+=3){const C=i+S/t*r;m.x=e*Math.cos(C),m.y=e*Math.sin(C),l.push(m.x,m.y,m.z),s.push(0,0,1),_.x=(l[T]/e+1)/2,_.y=(l[T+1]/e+1)/2,d.push(_.x,_.y)}for(let S=1;S<=t;S++)a.push(S,S+1,0);this.setIndex(a),this.setAttribute("position",new qn(l,3)),this.setAttribute("normal",new qn(s,3)),this.setAttribute("uv",new qn(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new f1(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class bg extends Pi{constructor(e=1,t=1,i=1,r=32,a=1,l=!1,s=0,d=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:a,openEnded:l,thetaStart:s,thetaLength:d};const m=this;r=Math.floor(r),a=Math.floor(a);const _=[],S=[],T=[],C=[];let P=0;const k=[],R=i/2;let O=0;F(),l===!1&&(e>0&&N(!0),t>0&&N(!1)),this.setIndex(_),this.setAttribute("position",new qn(S,3)),this.setAttribute("normal",new qn(T,3)),this.setAttribute("uv",new qn(C,2));function F(){const G=new Fe,j=new Fe;let Q=0;const re=(t-e)/i;for(let $=0;$<=a;$++){const ne=[],ue=$/a,De=ue*(t-e)+e;for(let $e=0;$e<=r;$e++){const ae=$e/r,le=ae*d+s,fe=Math.sin(le),Oe=Math.cos(le);j.x=De*fe,j.y=-ue*i+R,j.z=De*Oe,S.push(j.x,j.y,j.z),G.set(fe,re,Oe).normalize(),T.push(G.x,G.y,G.z),C.push(ae,1-ue),ne.push(P++)}k.push(ne)}for(let $=0;$<r;$++)for(let ne=0;ne<a;ne++){const ue=k[ne][$],De=k[ne+1][$],$e=k[ne+1][$+1],ae=k[ne][$+1];_.push(ue,De,ae),_.push(De,$e,ae),Q+=6}m.addGroup(O,Q,0),O+=Q}function N(G){const j=P,Q=new Ht,re=new Fe;let $=0;const ne=G===!0?e:t,ue=G===!0?1:-1;for(let $e=1;$e<=r;$e++)S.push(0,R*ue,0),T.push(0,ue,0),C.push(.5,.5),P++;const De=P;for(let $e=0;$e<=r;$e++){const le=$e/r*d+s,fe=Math.cos(le),Oe=Math.sin(le);re.x=ne*Oe,re.y=R*ue,re.z=ne*fe,S.push(re.x,re.y,re.z),T.push(0,ue,0),Q.x=fe*.5+.5,Q.y=Oe*.5*ue+.5,C.push(Q.x,Q.y),P++}for(let $e=0;$e<r;$e++){const ae=j+$e,le=De+$e;G===!0?_.push(le,le+1,ae):_.push(le+1,le,ae),$+=3}m.addGroup(O,$,G===!0?1:2),O+=$}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bg(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class p1 extends bg{constructor(e=1,t=1,i=32,r=1,a=!1,l=0,s=Math.PI*2){super(0,e,t,i,r,a,l,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:l,thetaLength:s}}static fromJSON(e){return new p1(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Zd extends Pi{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};const a=[],l=[];s(r),m(i),_(),this.setAttribute("position",new qn(a,3)),this.setAttribute("normal",new qn(a.slice(),3)),this.setAttribute("uv",new qn(l,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function s(F){const N=new Fe,G=new Fe,j=new Fe;for(let Q=0;Q<t.length;Q+=3)C(t[Q+0],N),C(t[Q+1],G),C(t[Q+2],j),d(N,G,j,F)}function d(F,N,G,j){const Q=j+1,re=[];for(let $=0;$<=Q;$++){re[$]=[];const ne=F.clone().lerp(G,$/Q),ue=N.clone().lerp(G,$/Q),De=Q-$;for(let $e=0;$e<=De;$e++)$e===0&&$===Q?re[$][$e]=ne:re[$][$e]=ne.clone().lerp(ue,$e/De)}for(let $=0;$<Q;$++)for(let ne=0;ne<2*(Q-$)-1;ne++){const ue=Math.floor(ne/2);ne%2===0?(T(re[$][ue+1]),T(re[$+1][ue]),T(re[$][ue])):(T(re[$][ue+1]),T(re[$+1][ue+1]),T(re[$+1][ue]))}}function m(F){const N=new Fe;for(let G=0;G<a.length;G+=3)N.x=a[G+0],N.y=a[G+1],N.z=a[G+2],N.normalize().multiplyScalar(F),a[G+0]=N.x,a[G+1]=N.y,a[G+2]=N.z}function _(){const F=new Fe;for(let N=0;N<a.length;N+=3){F.x=a[N+0],F.y=a[N+1],F.z=a[N+2];const G=R(F)/2/Math.PI+.5,j=O(F)/Math.PI+.5;l.push(G,1-j)}P(),S()}function S(){for(let F=0;F<l.length;F+=6){const N=l[F+0],G=l[F+2],j=l[F+4],Q=Math.max(N,G,j),re=Math.min(N,G,j);Q>.9&&re<.1&&(N<.2&&(l[F+0]+=1),G<.2&&(l[F+2]+=1),j<.2&&(l[F+4]+=1))}}function T(F){a.push(F.x,F.y,F.z)}function C(F,N){const G=F*3;N.x=e[G+0],N.y=e[G+1],N.z=e[G+2]}function P(){const F=new Fe,N=new Fe,G=new Fe,j=new Fe,Q=new Ht,re=new Ht,$=new Ht;for(let ne=0,ue=0;ne<a.length;ne+=9,ue+=6){F.set(a[ne+0],a[ne+1],a[ne+2]),N.set(a[ne+3],a[ne+4],a[ne+5]),G.set(a[ne+6],a[ne+7],a[ne+8]),Q.set(l[ue+0],l[ue+1]),re.set(l[ue+2],l[ue+3]),$.set(l[ue+4],l[ue+5]),j.copy(F).add(N).add(G).divideScalar(3);const De=R(j);k(Q,ue+0,F,De),k(re,ue+2,N,De),k($,ue+4,G,De)}}function k(F,N,G,j){j<0&&F.x===1&&(l[N]=F.x-1),G.x===0&&G.z===0&&(l[N]=j/2/Math.PI+.5)}function R(F){return Math.atan2(F.z,-F.x)}function O(F){return Math.atan2(-F.y,Math.sqrt(F.x*F.x+F.z*F.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Zd(e.vertices,e.indices,e.radius,e.details)}}class m1 extends Zd{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=1/i,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],l=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(a,l,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new m1(e.radius,e.detail)}}const Sb=new Fe,Mb=new Fe,kE=new Fe,Tb=new yc;class yV extends Pi{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),a=Math.cos(Qm*t),l=e.getIndex(),s=e.getAttribute("position"),d=l?l.count:s.count,m=[0,0,0],_=["a","b","c"],S=new Array(3),T={},C=[];for(let P=0;P<d;P+=3){l?(m[0]=l.getX(P),m[1]=l.getX(P+1),m[2]=l.getX(P+2)):(m[0]=P,m[1]=P+1,m[2]=P+2);const{a:k,b:R,c:O}=Tb;if(k.fromBufferAttribute(s,m[0]),R.fromBufferAttribute(s,m[1]),O.fromBufferAttribute(s,m[2]),Tb.getNormal(kE),S[0]=`${Math.round(k.x*r)},${Math.round(k.y*r)},${Math.round(k.z*r)}`,S[1]=`${Math.round(R.x*r)},${Math.round(R.y*r)},${Math.round(R.z*r)}`,S[2]=`${Math.round(O.x*r)},${Math.round(O.y*r)},${Math.round(O.z*r)}`,!(S[0]===S[1]||S[1]===S[2]||S[2]===S[0]))for(let F=0;F<3;F++){const N=(F+1)%3,G=S[F],j=S[N],Q=Tb[_[F]],re=Tb[_[N]],$=`${G}_${j}`,ne=`${j}_${G}`;ne in T&&T[ne]?(kE.dot(T[ne].normal)<=a&&(C.push(Q.x,Q.y,Q.z),C.push(re.x,re.y,re.z)),T[ne]=null):$ in T||(T[$]={index0:m[F],index1:m[N],normal:kE.clone()})}}for(const P in T)if(T[P]){const{index0:k,index1:R}=T[P];Sb.fromBufferAttribute(s,k),Mb.fromBufferAttribute(s,R),C.push(Sb.x,Sb.y,Sb.z),C.push(Mb.x,Mb.y,Mb.z)}this.setAttribute("position",new qn(C,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class tg extends Dv{constructor(e){super(e),this.uuid=Rl(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(new Dv().fromJSON(r))}return this}}const kre={triangulate:function(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let a=xV(n,0,r,t,!0);const l=[];if(!a||a.next===a.prev)return l;let s,d,m,_,S,T,C;if(i&&(a=Ore(n,e,a,t)),n.length>80*t){s=m=n[0],d=_=n[1];for(let P=t;P<r;P+=t)S=n[P],T=n[P+1],S<s&&(s=S),T<d&&(d=T),S>m&&(m=S),T>_&&(_=T);C=Math.max(m-s,_-d),C=C!==0?32767/C:0}return Lv(a,l,t,s,d,C,0),l}};function xV(n,e,t,i,r){let a,l;if(r===Zre(n,e,t,i)>0)for(a=e;a<t;a+=i)l=JO(a,n[a],n[a+1],l);else for(a=t-i;a>=e;a-=i)l=JO(a,n[a],n[a+1],l);return l&&QM(l,l.next)&&(zv(l),l=l.next),l}function fg(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(QM(t,t.next)||ls(t.prev,t,t.next)===0)){if(zv(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Lv(n,e,t,i,r,a,l){if(!n)return;!l&&a&&Vre(n,i,r,a);let s=n,d,m;for(;n.prev!==n.next;){if(d=n.prev,m=n.next,a?Lre(n,i,r,a):Dre(n)){e.push(d.i/t|0),e.push(n.i/t|0),e.push(m.i/t|0),zv(n),n=m.next,s=m.next;continue}if(n=m,n===s){l?l===1?(n=Rre(fg(n),e,t),Lv(n,e,t,i,r,a,2)):l===2&&zre(n,e,t,i,r,a):Lv(fg(n),e,t,i,r,a,1);break}}}function Dre(n){const e=n.prev,t=n,i=n.next;if(ls(e,t,i)>=0)return!1;const r=e.x,a=t.x,l=i.x,s=e.y,d=t.y,m=i.y,_=r<a?r<l?r:l:a<l?a:l,S=s<d?s<m?s:m:d<m?d:m,T=r>a?r>l?r:l:a>l?a:l,C=s>d?s>m?s:m:d>m?d:m;let P=i.next;for(;P!==e;){if(P.x>=_&&P.x<=T&&P.y>=S&&P.y<=C&&Z_(r,s,a,d,l,m,P.x,P.y)&&ls(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function Lre(n,e,t,i){const r=n.prev,a=n,l=n.next;if(ls(r,a,l)>=0)return!1;const s=r.x,d=a.x,m=l.x,_=r.y,S=a.y,T=l.y,C=s<d?s<m?s:m:d<m?d:m,P=_<S?_<T?_:T:S<T?S:T,k=s>d?s>m?s:m:d>m?d:m,R=_>S?_>T?_:T:S>T?S:T,O=iI(C,P,e,t,i),F=iI(k,R,e,t,i);let N=n.prevZ,G=n.nextZ;for(;N&&N.z>=O&&G&&G.z<=F;){if(N.x>=C&&N.x<=k&&N.y>=P&&N.y<=R&&N!==r&&N!==l&&Z_(s,_,d,S,m,T,N.x,N.y)&&ls(N.prev,N,N.next)>=0||(N=N.prevZ,G.x>=C&&G.x<=k&&G.y>=P&&G.y<=R&&G!==r&&G!==l&&Z_(s,_,d,S,m,T,G.x,G.y)&&ls(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;N&&N.z>=O;){if(N.x>=C&&N.x<=k&&N.y>=P&&N.y<=R&&N!==r&&N!==l&&Z_(s,_,d,S,m,T,N.x,N.y)&&ls(N.prev,N,N.next)>=0)return!1;N=N.prevZ}for(;G&&G.z<=F;){if(G.x>=C&&G.x<=k&&G.y>=P&&G.y<=R&&G!==r&&G!==l&&Z_(s,_,d,S,m,T,G.x,G.y)&&ls(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function Rre(n,e,t){let i=n;do{const r=i.prev,a=i.next.next;!QM(r,a)&&vV(r,i,i.next,a)&&Rv(r,a)&&Rv(a,r)&&(e.push(r.i/t|0),e.push(i.i/t|0),e.push(a.i/t|0),zv(i),zv(i.next),i=n=a),i=i.next}while(i!==n);return fg(i)}function zre(n,e,t,i,r,a){let l=n;do{let s=l.next.next;for(;s!==l.prev;){if(l.i!==s.i&&Hre(l,s)){let d=wV(l,s);l=fg(l,l.next),d=fg(d,d.next),Lv(l,e,t,i,r,a,0),Lv(d,e,t,i,r,a,0);return}s=s.next}l=l.next}while(l!==n)}function Ore(n,e,t,i){const r=[];let a,l,s,d,m;for(a=0,l=e.length;a<l;a++)s=e[a]*i,d=a<l-1?e[a+1]*i:n.length,m=xV(n,s,d,i,!1),m===m.next&&(m.steiner=!0),r.push(Wre(m));for(r.sort(Fre),a=0;a<r.length;a++)t=Bre(r[a],t);return t}function Fre(n,e){return n.x-e.x}function Bre(n,e){const t=Nre(n,e);if(!t)return e;const i=wV(t,n);return fg(i,i.next),fg(t,t.next)}function Nre(n,e){let t=e,i=-1/0,r;const a=n.x,l=n.y;do{if(l<=t.y&&l>=t.next.y&&t.next.y!==t.y){const T=t.x+(l-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(T<=a&&T>i&&(i=T,r=t.x<t.next.x?t:t.next,T===a))return r}t=t.next}while(t!==e);if(!r)return null;const s=r,d=r.x,m=r.y;let _=1/0,S;t=r;do a>=t.x&&t.x>=d&&a!==t.x&&Z_(l<m?a:i,l,d,m,l<m?i:a,l,t.x,t.y)&&(S=Math.abs(l-t.y)/(a-t.x),Rv(t,n)&&(S<_||S===_&&(t.x>r.x||t.x===r.x&&Ure(r,t)))&&(r=t,_=S)),t=t.next;while(t!==s);return r}function Ure(n,e){return ls(n.prev,n,e.prev)<0&&ls(e.next,n,n.next)<0}function Vre(n,e,t,i){let r=n;do r.z===0&&(r.z=iI(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,Gre(r)}function Gre(n){let e,t,i,r,a,l,s,d,m=1;do{for(t=n,n=null,a=null,l=0;t;){for(l++,i=t,s=0,e=0;e<m&&(s++,i=i.nextZ,!!i);e++);for(d=m;s>0||d>0&&i;)s!==0&&(d===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,s--):(r=i,i=i.nextZ,d--),a?a.nextZ=r:n=r,r.prevZ=a,a=r;t=i}a.nextZ=null,m*=2}while(l>1);return n}function iI(n,e,t,i,r){return n=(n-t)*r|0,e=(e-i)*r|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function Wre(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Z_(n,e,t,i,r,a,l,s){return(r-l)*(e-s)>=(n-l)*(a-s)&&(n-l)*(i-s)>=(t-l)*(e-s)&&(t-l)*(a-s)>=(r-l)*(i-s)}function Hre(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!jre(n,e)&&(Rv(n,e)&&Rv(e,n)&&qre(n,e)&&(ls(n.prev,n,e.prev)||ls(n,e.prev,e))||QM(n,e)&&ls(n.prev,n,n.next)>0&&ls(e.prev,e,e.next)>0)}function ls(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function QM(n,e){return n.x===e.x&&n.y===e.y}function vV(n,e,t,i){const r=Ab(ls(n,e,t)),a=Ab(ls(n,e,i)),l=Ab(ls(t,i,n)),s=Ab(ls(t,i,e));return!!(r!==a&&l!==s||r===0&&Eb(n,t,e)||a===0&&Eb(n,i,e)||l===0&&Eb(t,n,i)||s===0&&Eb(t,e,i))}function Eb(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Ab(n){return n>0?1:n<0?-1:0}function jre(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&vV(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Rv(n,e){return ls(n.prev,n,n.next)<0?ls(n,e,n.next)>=0&&ls(n,n.prev,e)>=0:ls(n,e,n.prev)<0||ls(n,n.next,e)<0}function qre(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,a=(n.y+e.y)/2;do t.y>a!=t.next.y>a&&t.next.y!==t.y&&r<(t.next.x-t.x)*(a-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function wV(n,e){const t=new rI(n.i,n.x,n.y),i=new rI(e.i,e.x,e.y),r=n.next,a=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,a.next=i,i.prev=a,i}function JO(n,e,t,i){const r=new rI(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function zv(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function rI(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zre(n,e,t,i){let r=0;for(let a=e,l=t-i;a<t;a+=i)r+=(n[l]-n[a])*(n[a+1]+n[l+1]),l=a;return r}class wh{static area(e){const t=e.length;let i=0;for(let r=t-1,a=0;a<t;r=a++)i+=e[r].x*e[a].y-e[a].x*e[r].y;return i*.5}static isClockWise(e){return wh.area(e)<0}static triangulateShape(e,t){const i=[],r=[],a=[];KO(e),QO(i,e);let l=e.length;t.forEach(KO);for(let d=0;d<t.length;d++)r.push(l),l+=t[d].length,QO(i,t[d]);const s=kre.triangulate(i,r);for(let d=0;d<s.length;d+=3)a.push(s.slice(d,d+3));return a}}function KO(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function QO(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class g1 extends Pi{constructor(e=new tg([new Ht(.5,.5),new Ht(-.5,.5),new Ht(-.5,-.5),new Ht(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],a=[];for(let s=0,d=e.length;s<d;s++){const m=e[s];l(m)}this.setAttribute("position",new qn(r,3)),this.setAttribute("uv",new qn(a,2)),this.computeVertexNormals();function l(s){const d=[],m=t.curveSegments!==void 0?t.curveSegments:12,_=t.steps!==void 0?t.steps:1,S=t.depth!==void 0?t.depth:1;let T=t.bevelEnabled!==void 0?t.bevelEnabled:!0,C=t.bevelThickness!==void 0?t.bevelThickness:.2,P=t.bevelSize!==void 0?t.bevelSize:C-.1,k=t.bevelOffset!==void 0?t.bevelOffset:0,R=t.bevelSegments!==void 0?t.bevelSegments:3;const O=t.extrudePath,F=t.UVGenerator!==void 0?t.UVGenerator:$re;let N,G=!1,j,Q,re,$;O&&(N=O.getSpacedPoints(_),G=!0,T=!1,j=O.computeFrenetFrames(_,!1),Q=new Fe,re=new Fe,$=new Fe),T||(R=0,C=0,P=0,k=0);const ne=s.extractPoints(m);let ue=ne.shape;const De=ne.holes;if(!wh.isClockWise(ue)){ue=ue.reverse();for(let At=0,Ot=De.length;At<Ot;At++){const Ft=De[At];wh.isClockWise(Ft)&&(De[At]=Ft.reverse())}}const ae=wh.triangulateShape(ue,De),le=ue;for(let At=0,Ot=De.length;At<Ot;At++){const Ft=De[At];ue=ue.concat(Ft)}function fe(At,Ot,Ft){return Ot||console.error("THREE.ExtrudeGeometry: vec does not exist"),At.clone().addScaledVector(Ot,Ft)}const Oe=ue.length,We=ae.length;function ce(At,Ot,Ft){let An,pn,Vn;const On=At.x-Ot.x,Zn=At.y-Ot.y,ai=Ft.x-At.x,Ti=Ft.y-At.y,Be=On*On+Zn*Zn,Se=On*Ti-Zn*ai;if(Math.abs(Se)>Number.EPSILON){const St=Math.sqrt(Be),tn=Math.sqrt(ai*ai+Ti*Ti),nn=Ot.x-Zn/St,fn=Ot.y+On/St,Nn=Ft.x-Ti/tn,yn=Ft.y+ai/tn,Lt=((Nn-nn)*Ti-(yn-fn)*ai)/(On*Ti-Zn*ai);An=nn+On*Lt-At.x,pn=fn+Zn*Lt-At.y;const Un=An*An+pn*pn;if(Un<=2)return new Ht(An,pn);Vn=Math.sqrt(Un/2)}else{let St=!1;On>Number.EPSILON?ai>Number.EPSILON&&(St=!0):On<-Number.EPSILON?ai<-Number.EPSILON&&(St=!0):Math.sign(Zn)===Math.sign(Ti)&&(St=!0),St?(An=-Zn,pn=On,Vn=Math.sqrt(Be)):(An=On,pn=Zn,Vn=Math.sqrt(Be/2))}return new Ht(An/Vn,pn/Vn)}const Te=[];for(let At=0,Ot=le.length,Ft=Ot-1,An=At+1;At<Ot;At++,Ft++,An++)Ft===Ot&&(Ft=0),An===Ot&&(An=0),Te[At]=ce(le[At],le[Ft],le[An]);const Pe=[];let Qe,Ne=Te.concat();for(let At=0,Ot=De.length;At<Ot;At++){const Ft=De[At];Qe=[];for(let An=0,pn=Ft.length,Vn=pn-1,On=An+1;An<pn;An++,Vn++,On++)Vn===pn&&(Vn=0),On===pn&&(On=0),Qe[An]=ce(Ft[An],Ft[Vn],Ft[On]);Pe.push(Qe),Ne=Ne.concat(Qe)}for(let At=0;At<R;At++){const Ot=At/R,Ft=C*Math.cos(Ot*Math.PI/2),An=P*Math.sin(Ot*Math.PI/2)+k;for(let pn=0,Vn=le.length;pn<Vn;pn++){const On=fe(le[pn],Te[pn],An);Nt(On.x,On.y,-Ft)}for(let pn=0,Vn=De.length;pn<Vn;pn++){const On=De[pn];Qe=Pe[pn];for(let Zn=0,ai=On.length;Zn<ai;Zn++){const Ti=fe(On[Zn],Qe[Zn],An);Nt(Ti.x,Ti.y,-Ft)}}}const nt=P+k;for(let At=0;At<Oe;At++){const Ot=T?fe(ue[At],Ne[At],nt):ue[At];G?(re.copy(j.normals[0]).multiplyScalar(Ot.x),Q.copy(j.binormals[0]).multiplyScalar(Ot.y),$.copy(N[0]).add(re).add(Q),Nt($.x,$.y,$.z)):Nt(Ot.x,Ot.y,0)}for(let At=1;At<=_;At++)for(let Ot=0;Ot<Oe;Ot++){const Ft=T?fe(ue[Ot],Ne[Ot],nt):ue[Ot];G?(re.copy(j.normals[At]).multiplyScalar(Ft.x),Q.copy(j.binormals[At]).multiplyScalar(Ft.y),$.copy(N[At]).add(re).add(Q),Nt($.x,$.y,$.z)):Nt(Ft.x,Ft.y,S/_*At)}for(let At=R-1;At>=0;At--){const Ot=At/R,Ft=C*Math.cos(Ot*Math.PI/2),An=P*Math.sin(Ot*Math.PI/2)+k;for(let pn=0,Vn=le.length;pn<Vn;pn++){const On=fe(le[pn],Te[pn],An);Nt(On.x,On.y,S+Ft)}for(let pn=0,Vn=De.length;pn<Vn;pn++){const On=De[pn];Qe=Pe[pn];for(let Zn=0,ai=On.length;Zn<ai;Zn++){const Ti=fe(On[Zn],Qe[Zn],An);G?Nt(Ti.x,Ti.y+N[_-1].y,N[_-1].x+Ft):Nt(Ti.x,Ti.y,S+Ft)}}}ze(),et();function ze(){const At=r.length/3;if(T){let Ot=0,Ft=Oe*Ot;for(let An=0;An<We;An++){const pn=ae[An];qt(pn[2]+Ft,pn[1]+Ft,pn[0]+Ft)}Ot=_+R*2,Ft=Oe*Ot;for(let An=0;An<We;An++){const pn=ae[An];qt(pn[0]+Ft,pn[1]+Ft,pn[2]+Ft)}}else{for(let Ot=0;Ot<We;Ot++){const Ft=ae[Ot];qt(Ft[2],Ft[1],Ft[0])}for(let Ot=0;Ot<We;Ot++){const Ft=ae[Ot];qt(Ft[0]+Oe*_,Ft[1]+Oe*_,Ft[2]+Oe*_)}}i.addGroup(At,r.length/3-At,0)}function et(){const At=r.length/3;let Ot=0;Et(le,Ot),Ot+=le.length;for(let Ft=0,An=De.length;Ft<An;Ft++){const pn=De[Ft];Et(pn,Ot),Ot+=pn.length}i.addGroup(At,r.length/3-At,1)}function Et(At,Ot){let Ft=At.length;for(;--Ft>=0;){const An=Ft;let pn=Ft-1;pn<0&&(pn=At.length-1);for(let Vn=0,On=_+R*2;Vn<On;Vn++){const Zn=Oe*Vn,ai=Oe*(Vn+1),Ti=Ot+An+Zn,Be=Ot+pn+Zn,Se=Ot+pn+ai,St=Ot+An+ai;wn(Ti,Be,Se,St)}}}function Nt(At,Ot,Ft){d.push(At),d.push(Ot),d.push(Ft)}function qt(At,Ot,Ft){_n(At),_n(Ot),_n(Ft);const An=r.length/3,pn=F.generateTopUV(i,r,An-3,An-2,An-1);Ln(pn[0]),Ln(pn[1]),Ln(pn[2])}function wn(At,Ot,Ft,An){_n(At),_n(Ot),_n(An),_n(Ot),_n(Ft),_n(An);const pn=r.length/3,Vn=F.generateSideWallUV(i,r,pn-6,pn-3,pn-2,pn-1);Ln(Vn[0]),Ln(Vn[1]),Ln(Vn[3]),Ln(Vn[1]),Ln(Vn[2]),Ln(Vn[3])}function _n(At){r.push(d[At*3+0]),r.push(d[At*3+1]),r.push(d[At*3+2])}function Ln(At){a.push(At.x),a.push(At.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return Xre(t,i,e)}static fromJSON(e,t){const i=[];for(let a=0,l=e.shapes.length;a<l;a++){const s=t[e.shapes[a]];i.push(s)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new wk[r.type]().fromJSON(r)),new g1(i,e.options)}}const $re={generateTopUV:function(n,e,t,i,r){const a=e[t*3],l=e[t*3+1],s=e[i*3],d=e[i*3+1],m=e[r*3],_=e[r*3+1];return[new Ht(a,l),new Ht(s,d),new Ht(m,_)]},generateSideWallUV:function(n,e,t,i,r,a){const l=e[t*3],s=e[t*3+1],d=e[t*3+2],m=e[i*3],_=e[i*3+1],S=e[i*3+2],T=e[r*3],C=e[r*3+1],P=e[r*3+2],k=e[a*3],R=e[a*3+1],O=e[a*3+2];return Math.abs(s-_)<Math.abs(l-m)?[new Ht(l,1-d),new Ht(m,1-S),new Ht(T,1-P),new Ht(k,1-O)]:[new Ht(s,1-d),new Ht(_,1-S),new Ht(C,1-P),new Ht(R,1-O)]}};function Xre(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){const a=n[i];t.shapes.push(a.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class _1 extends Zd{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,a,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _1(e.radius,e.detail)}}class Gy extends Zd{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Gy(e.radius,e.detail)}}class y1 extends Pi{constructor(e=.5,t=1,i=32,r=1,a=0,l=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:a,thetaLength:l},i=Math.max(3,i),r=Math.max(1,r);const s=[],d=[],m=[],_=[];let S=e;const T=(t-e)/r,C=new Fe,P=new Ht;for(let k=0;k<=r;k++){for(let R=0;R<=i;R++){const O=a+R/i*l;C.x=S*Math.cos(O),C.y=S*Math.sin(O),d.push(C.x,C.y,C.z),m.push(0,0,1),P.x=(C.x/t+1)/2,P.y=(C.y/t+1)/2,_.push(P.x,P.y)}S+=T}for(let k=0;k<r;k++){const R=k*(i+1);for(let O=0;O<i;O++){const F=O+R,N=F,G=F+i+1,j=F+i+2,Q=F+1;s.push(N,G,Q),s.push(G,j,Q)}}this.setIndex(s),this.setAttribute("position",new qn(d,3)),this.setAttribute("normal",new qn(m,3)),this.setAttribute("uv",new qn(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new y1(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class x1 extends Pi{constructor(e=new tg([new Ht(0,.5),new Ht(-.5,-.5),new Ht(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],a=[],l=[];let s=0,d=0;if(Array.isArray(e)===!1)m(e);else for(let _=0;_<e.length;_++)m(e[_]),this.addGroup(s,d,_),s+=d,d=0;this.setIndex(i),this.setAttribute("position",new qn(r,3)),this.setAttribute("normal",new qn(a,3)),this.setAttribute("uv",new qn(l,2));function m(_){const S=r.length/3,T=_.extractPoints(t);let C=T.shape;const P=T.holes;wh.isClockWise(C)===!1&&(C=C.reverse());for(let R=0,O=P.length;R<O;R++){const F=P[R];wh.isClockWise(F)===!0&&(P[R]=F.reverse())}const k=wh.triangulateShape(C,P);for(let R=0,O=P.length;R<O;R++){const F=P[R];C=C.concat(F)}for(let R=0,O=C.length;R<O;R++){const F=C[R];r.push(F.x,F.y,0),a.push(0,0,1),l.push(F.x,F.y)}for(let R=0,O=k.length;R<O;R++){const F=k[R],N=F[0]+S,G=F[1]+S,j=F[2]+S;i.push(N,G,j),d+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return Yre(t,e)}static fromJSON(e,t){const i=[];for(let r=0,a=e.shapes.length;r<a;r++){const l=t[e.shapes[r]];i.push(l)}return new x1(i,e.curveSegments)}}function Yre(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const r=n[t];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}class Wy extends Pi{constructor(e=1,t=32,i=16,r=0,a=Math.PI*2,l=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:a,thetaStart:l,thetaLength:s},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const d=Math.min(l+s,Math.PI);let m=0;const _=[],S=new Fe,T=new Fe,C=[],P=[],k=[],R=[];for(let O=0;O<=i;O++){const F=[],N=O/i;let G=0;O==0&&l==0?G=.5/t:O==i&&d==Math.PI&&(G=-.5/t);for(let j=0;j<=t;j++){const Q=j/t;S.x=-e*Math.cos(r+Q*a)*Math.sin(l+N*s),S.y=e*Math.cos(l+N*s),S.z=e*Math.sin(r+Q*a)*Math.sin(l+N*s),P.push(S.x,S.y,S.z),T.copy(S).normalize(),k.push(T.x,T.y,T.z),R.push(Q+G,1-N),F.push(m++)}_.push(F)}for(let O=0;O<i;O++)for(let F=0;F<t;F++){const N=_[O][F+1],G=_[O][F],j=_[O+1][F],Q=_[O+1][F+1];(O!==0||l>0)&&C.push(N,G,Q),(O!==i-1||d<Math.PI)&&C.push(G,j,Q)}this.setIndex(C),this.setAttribute("position",new qn(P,3)),this.setAttribute("normal",new qn(k,3)),this.setAttribute("uv",new qn(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wy(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class v1 extends Zd{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new v1(e.radius,e.detail)}}class w1 extends Pi{constructor(e=1,t=.4,i=12,r=48,a=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:a},i=Math.floor(i),r=Math.floor(r);const l=[],s=[],d=[],m=[],_=new Fe,S=new Fe,T=new Fe;for(let C=0;C<=i;C++)for(let P=0;P<=r;P++){const k=P/r*a,R=C/i*Math.PI*2;S.x=(e+t*Math.cos(R))*Math.cos(k),S.y=(e+t*Math.cos(R))*Math.sin(k),S.z=t*Math.sin(R),s.push(S.x,S.y,S.z),_.x=e*Math.cos(k),_.y=e*Math.sin(k),T.subVectors(S,_).normalize(),d.push(T.x,T.y,T.z),m.push(P/r),m.push(C/i)}for(let C=1;C<=i;C++)for(let P=1;P<=r;P++){const k=(r+1)*C+P-1,R=(r+1)*(C-1)+P-1,O=(r+1)*(C-1)+P,F=(r+1)*C+P;l.push(k,R,F),l.push(R,O,F)}this.setIndex(l),this.setAttribute("position",new qn(s,3)),this.setAttribute("normal",new qn(d,3)),this.setAttribute("uv",new qn(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new w1(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class b1 extends Pi{constructor(e=1,t=.4,i=64,r=8,a=2,l=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:a,q:l},i=Math.floor(i),r=Math.floor(r);const s=[],d=[],m=[],_=[],S=new Fe,T=new Fe,C=new Fe,P=new Fe,k=new Fe,R=new Fe,O=new Fe;for(let N=0;N<=i;++N){const G=N/i*a*Math.PI*2;F(G,a,l,e,C),F(G+.01,a,l,e,P),R.subVectors(P,C),O.addVectors(P,C),k.crossVectors(R,O),O.crossVectors(k,R),k.normalize(),O.normalize();for(let j=0;j<=r;++j){const Q=j/r*Math.PI*2,re=-t*Math.cos(Q),$=t*Math.sin(Q);S.x=C.x+(re*O.x+$*k.x),S.y=C.y+(re*O.y+$*k.y),S.z=C.z+(re*O.z+$*k.z),d.push(S.x,S.y,S.z),T.subVectors(S,C).normalize(),m.push(T.x,T.y,T.z),_.push(N/i),_.push(j/r)}}for(let N=1;N<=i;N++)for(let G=1;G<=r;G++){const j=(r+1)*(N-1)+(G-1),Q=(r+1)*N+(G-1),re=(r+1)*N+G,$=(r+1)*(N-1)+G;s.push(j,Q,$),s.push(Q,re,$)}this.setIndex(s),this.setAttribute("position",new qn(d,3)),this.setAttribute("normal",new qn(m,3)),this.setAttribute("uv",new qn(_,2));function F(N,G,j,Q,re){const $=Math.cos(N),ne=Math.sin(N),ue=j/G*N,De=Math.cos(ue);re.x=Q*(2+De)*.5*$,re.y=Q*(2+De)*ne*.5,re.z=Q*Math.sin(ue)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new b1(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class S1 extends Pi{constructor(e=new xk(new Fe(-1,-1,0),new Fe(-1,1,0),new Fe(1,1,0)),t=64,i=1,r=8,a=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:a};const l=e.computeFrenetFrames(t,a);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;const s=new Fe,d=new Fe,m=new Ht;let _=new Fe;const S=[],T=[],C=[],P=[];k(),this.setIndex(P),this.setAttribute("position",new qn(S,3)),this.setAttribute("normal",new qn(T,3)),this.setAttribute("uv",new qn(C,2));function k(){for(let N=0;N<t;N++)R(N);R(a===!1?t:0),F(),O()}function R(N){_=e.getPointAt(N/t,_);const G=l.normals[N],j=l.binormals[N];for(let Q=0;Q<=r;Q++){const re=Q/r*Math.PI*2,$=Math.sin(re),ne=-Math.cos(re);d.x=ne*G.x+$*j.x,d.y=ne*G.y+$*j.y,d.z=ne*G.z+$*j.z,d.normalize(),T.push(d.x,d.y,d.z),s.x=_.x+i*d.x,s.y=_.y+i*d.y,s.z=_.z+i*d.z,S.push(s.x,s.y,s.z)}}function O(){for(let N=1;N<=t;N++)for(let G=1;G<=r;G++){const j=(r+1)*(N-1)+(G-1),Q=(r+1)*N+(G-1),re=(r+1)*N+G,$=(r+1)*(N-1)+G;P.push(j,Q,$),P.push(Q,re,$)}}function F(){for(let N=0;N<=t;N++)for(let G=0;G<=r;G++)m.x=N/t,m.y=G/r,C.push(m.x,m.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new S1(new wk[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class bV extends Pi{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,r=new Fe,a=new Fe;if(e.index!==null){const l=e.attributes.position,s=e.index;let d=e.groups;d.length===0&&(d=[{start:0,count:s.count,materialIndex:0}]);for(let m=0,_=d.length;m<_;++m){const S=d[m],T=S.start,C=S.count;for(let P=T,k=T+C;P<k;P+=3)for(let R=0;R<3;R++){const O=s.getX(P+R),F=s.getX(P+(R+1)%3);r.fromBufferAttribute(l,O),a.fromBufferAttribute(l,F),eF(r,a,i)===!0&&(t.push(r.x,r.y,r.z),t.push(a.x,a.y,a.z))}}}else{const l=e.attributes.position;for(let s=0,d=l.count/3;s<d;s++)for(let m=0;m<3;m++){const _=3*s+m,S=3*s+(m+1)%3;r.fromBufferAttribute(l,_),a.fromBufferAttribute(l,S),eF(r,a,i)===!0&&(t.push(r.x,r.y,r.z),t.push(a.x,a.y,a.z))}}this.setAttribute("position",new qn(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function eF(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(r)===!0?!1:(t.add(i),t.add(r),!0)}var tF=Object.freeze({__proto__:null,BoxGeometry:kp,CapsuleGeometry:d1,CircleGeometry:f1,ConeGeometry:p1,CylinderGeometry:bg,DodecahedronGeometry:m1,EdgesGeometry:yV,ExtrudeGeometry:g1,IcosahedronGeometry:_1,LatheGeometry:Vy,OctahedronGeometry:Gy,PlaneGeometry:Ny,PolyhedronGeometry:Zd,RingGeometry:y1,ShapeGeometry:x1,SphereGeometry:Wy,TetrahedronGeometry:v1,TorusGeometry:w1,TorusKnotGeometry:b1,TubeGeometry:S1,WireframeGeometry:bV});class SV extends No{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new zn(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class MV extends Sh{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class bk extends No{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new zn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ip,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class TV extends bk{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ht(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Os(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new zn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new zn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new zn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class EV extends No{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new zn(16777215),this.specular=new zn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ip,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=a1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class AV extends No{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new zn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ip,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class CV extends No{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ip,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class IV extends No{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new zn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ip,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=a1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class PV extends No{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new zn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ip,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class kV extends ka{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function fc(n,e,t){return Sk(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)}function Gm(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function Sk(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function DV(n){function e(r,a){return n[r]-n[a]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i}function sI(n,e,t){const i=n.length,r=new n.constructor(i);for(let a=0,l=0;l!==i;++a){const s=t[a]*e;for(let d=0;d!==e;++d)r[l++]=n[s+d]}return r}function Mk(n,e,t,i){let r=1,a=n[0];for(;a!==void 0&&a[i]===void 0;)a=n[r++];if(a===void 0)return;let l=a[i];if(l!==void 0)if(Array.isArray(l))do l=a[i],l!==void 0&&(e.push(a.time),t.push.apply(t,l)),a=n[r++];while(a!==void 0);else if(l.toArray!==void 0)do l=a[i],l!==void 0&&(e.push(a.time),l.toArray(t,t.length)),a=n[r++];while(a!==void 0);else do l=a[i],l!==void 0&&(e.push(a.time),t.push(l)),a=n[r++];while(a!==void 0)}function Jre(n,e,t,i,r=30){const a=n.clone();a.name=e;const l=[];for(let d=0;d<a.tracks.length;++d){const m=a.tracks[d],_=m.getValueSize(),S=[],T=[];for(let C=0;C<m.times.length;++C){const P=m.times[C]*r;if(!(P<t||P>=i)){S.push(m.times[C]);for(let k=0;k<_;++k)T.push(m.values[C*_+k])}}S.length!==0&&(m.times=Gm(S,m.times.constructor),m.values=Gm(T,m.values.constructor),l.push(m))}a.tracks=l;let s=1/0;for(let d=0;d<a.tracks.length;++d)s>a.tracks[d].times[0]&&(s=a.tracks[d].times[0]);for(let d=0;d<a.tracks.length;++d)a.tracks[d].shift(-1*s);return a.resetDuration(),a}function Kre(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,a=e/i;for(let l=0;l<r;++l){const s=t.tracks[l],d=s.ValueTypeName;if(d==="bool"||d==="string")continue;const m=n.tracks.find(function(O){return O.name===s.name&&O.ValueTypeName===d});if(m===void 0)continue;let _=0;const S=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(_=S/3);let T=0;const C=m.getValueSize();m.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(T=C/3);const P=s.times.length-1;let k;if(a<=s.times[0]){const O=_,F=S-_;k=fc(s.values,O,F)}else if(a>=s.times[P]){const O=P*S+_,F=O+S-_;k=fc(s.values,O,F)}else{const O=s.createInterpolant(),F=_,N=S-_;O.evaluate(a),k=fc(O.resultBuffer,F,N)}d==="quaternion"&&new da().fromArray(k).normalize().conjugate().toArray(k);const R=m.times.length;for(let O=0;O<R;++O){const F=O*C+T;if(d==="quaternion")da.multiplyQuaternionsFlat(m.values,F,k,0,m.values,F);else{const N=C-T*2;for(let G=0;G<N;++G)m.values[F+G]-=k[G]}}}return n.blendMode=nk,n}const Qre={arraySlice:fc,convertArray:Gm,isTypedArray:Sk,getKeyframeOrder:DV,sortedArray:sI,flattenJSON:Mk,subclip:Jre,makeClipAdditive:Kre};class M1{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],a=t[i-1];e:{t:{let l;n:{i:if(!(e<r)){for(let s=i+2;;){if(r===void 0){if(e<a)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(a=r,r=t[++i],e<r)break t}l=t.length;break n}if(!(e>=a)){const s=t[1];e<s&&(i=2,a=s);for(let d=i-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===d)break;if(r=a,a=t[--i-1],e>=a)break t}l=i,i=0;break n}break e}for(;i<l;){const s=i+l>>>1;e<t[s]?l=s:i=s+1}if(r=t[i],a=t[i-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,a,r)}return this.interpolate_(i,a,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,a=e*r;for(let l=0;l!==r;++l)t[l]=i[a+l];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class LV extends M1{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Nm,endingEnd:Nm}}intervalChanged_(e,t,i){const r=this.parameterPositions;let a=e-2,l=e+1,s=r[a],d=r[l];if(s===void 0)switch(this.getSettings_().endingStart){case Um:a=e,s=2*t-i;break;case Cv:a=r.length-2,s=t+r[a]-r[a+1];break;default:a=e,s=i}if(d===void 0)switch(this.getSettings_().endingEnd){case Um:l=e,d=2*i-t;break;case Cv:l=1,d=i+r[1]-r[0];break;default:l=e-1,d=t}const m=(i-t)*.5,_=this.valueSize;this._weightPrev=m/(t-s),this._weightNext=m/(d-i),this._offsetPrev=a*_,this._offsetNext=l*_}interpolate_(e,t,i,r){const a=this.resultBuffer,l=this.sampleValues,s=this.valueSize,d=e*s,m=d-s,_=this._offsetPrev,S=this._offsetNext,T=this._weightPrev,C=this._weightNext,P=(i-t)/(r-t),k=P*P,R=k*P,O=-T*R+2*T*k-T*P,F=(1+T)*R+(-1.5-2*T)*k+(-.5+T)*P+1,N=(-1-C)*R+(1.5+C)*k+.5*P,G=C*R-C*k;for(let j=0;j!==s;++j)a[j]=O*l[_+j]+F*l[m+j]+N*l[d+j]+G*l[S+j];return a}}class Tk extends M1{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const a=this.resultBuffer,l=this.sampleValues,s=this.valueSize,d=e*s,m=d-s,_=(i-t)/(r-t),S=1-_;for(let T=0;T!==s;++T)a[T]=l[m+T]*S+l[d+T]*_;return a}}class RV extends M1{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Lu{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Gm(t,this.TimeBufferType),this.values=Gm(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Gm(e.times,Array),values:Gm(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new RV(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Tk(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new LV(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ev:t=this.InterpolantFactoryMethodDiscrete;break;case Av:t=this.InterpolantFactoryMethodLinear;break;case aS:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ev;case this.InterpolantFactoryMethodLinear:return Av;case this.InterpolantFactoryMethodSmooth:return aS}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let a=0,l=r-1;for(;a!==r&&i[a]<e;)++a;for(;l!==-1&&i[l]>t;)--l;if(++l,a!==0||l!==r){a>=l&&(l=Math.max(l,1),a=l-1);const s=this.getValueSize();this.times=fc(i,a,l),this.values=fc(this.values,a*s,l*s)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,a=i.length;a===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let l=null;for(let s=0;s!==a;s++){const d=i[s];if(typeof d=="number"&&isNaN(d)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,d),e=!1;break}if(l!==null&&l>d){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,d,l),e=!1;break}l=d}if(r!==void 0&&Sk(r))for(let s=0,d=r.length;s!==d;++s){const m=r[s];if(isNaN(m)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,m),e=!1;break}}return e}optimize(){const e=fc(this.times),t=fc(this.values),i=this.getValueSize(),r=this.getInterpolation()===aS,a=e.length-1;let l=1;for(let s=1;s<a;++s){let d=!1;const m=e[s],_=e[s+1];if(m!==_&&(s!==1||m!==e[0]))if(r)d=!0;else{const S=s*i,T=S-i,C=S+i;for(let P=0;P!==i;++P){const k=t[S+P];if(k!==t[T+P]||k!==t[C+P]){d=!0;break}}}if(d){if(s!==l){e[l]=e[s];const S=s*i,T=l*i;for(let C=0;C!==i;++C)t[T+C]=t[S+C]}++l}}if(a>0){e[l]=e[a];for(let s=a*i,d=l*i,m=0;m!==i;++m)t[d+m]=t[s+m];++l}return l!==e.length?(this.times=fc(e,0,l),this.values=fc(t,0,l*i)):(this.times=e,this.values=t),this}clone(){const e=fc(this.times,0),t=fc(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Lu.prototype.TimeBufferType=Float32Array;Lu.prototype.ValueBufferType=Float32Array;Lu.prototype.DefaultInterpolation=Av;class Sg extends Lu{}Sg.prototype.ValueTypeName="bool";Sg.prototype.ValueBufferType=Array;Sg.prototype.DefaultInterpolation=Ev;Sg.prototype.InterpolantFactoryMethodLinear=void 0;Sg.prototype.InterpolantFactoryMethodSmooth=void 0;class Ek extends Lu{}Ek.prototype.ValueTypeName="color";class Ov extends Lu{}Ov.prototype.ValueTypeName="number";class zV extends M1{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const a=this.resultBuffer,l=this.sampleValues,s=this.valueSize,d=(i-t)/(r-t);let m=e*s;for(let _=m+s;m!==_;m+=4)da.slerpFlat(a,0,l,m-s,l,m,d);return a}}class Hy extends Lu{InterpolantFactoryMethodLinear(e){return new zV(this.times,this.values,this.getValueSize(),e)}}Hy.prototype.ValueTypeName="quaternion";Hy.prototype.DefaultInterpolation=Av;Hy.prototype.InterpolantFactoryMethodSmooth=void 0;class Mg extends Lu{}Mg.prototype.ValueTypeName="string";Mg.prototype.ValueBufferType=Array;Mg.prototype.DefaultInterpolation=Ev;Mg.prototype.InterpolantFactoryMethodLinear=void 0;Mg.prototype.InterpolantFactoryMethodSmooth=void 0;class Fv extends Lu{}Fv.prototype.ValueTypeName="vector";class Bv{constructor(e,t=-1,i,r=GM){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Rl(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let l=0,s=i.length;l!==s;++l)t.push(tse(i[l]).scale(r));const a=new this(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let a=0,l=i.length;a!==l;++a)t.push(Lu.toJSON(i[a]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const a=t.length,l=[];for(let s=0;s<a;s++){let d=[],m=[];d.push((s+a-1)%a,s,(s+1)%a),m.push(0,1,0);const _=DV(d);d=sI(d,1,_),m=sI(m,1,_),!r&&d[0]===0&&(d.push(a),m.push(m[0])),l.push(new Ov(".morphTargetInfluences["+t[s].name+"]",d,m).scale(1/i))}return new this(e,-1,l)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},a=/^([\w-]*?)([\d]+)$/;for(let s=0,d=e.length;s<d;s++){const m=e[s],_=m.name.match(a);if(_&&_.length>1){const S=_[1];let T=r[S];T||(r[S]=T=[]),T.push(m)}}const l=[];for(const s in r)l.push(this.CreateFromMorphTargetSequence(s,r[s],t,i));return l}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(S,T,C,P,k){if(C.length!==0){const R=[],O=[];Mk(C,R,O,P),R.length!==0&&k.push(new S(T,R,O))}},r=[],a=e.name||"default",l=e.fps||30,s=e.blendMode;let d=e.length||-1;const m=e.hierarchy||[];for(let S=0;S<m.length;S++){const T=m[S].keys;if(!(!T||T.length===0))if(T[0].morphTargets){const C={};let P;for(P=0;P<T.length;P++)if(T[P].morphTargets)for(let k=0;k<T[P].morphTargets.length;k++)C[T[P].morphTargets[k]]=-1;for(const k in C){const R=[],O=[];for(let F=0;F!==T[P].morphTargets.length;++F){const N=T[P];R.push(N.time),O.push(N.morphTarget===k?1:0)}r.push(new Ov(".morphTargetInfluence["+k+"]",R,O))}d=C.length*l}else{const C=".bones["+t[S].name+"]";i(Fv,C+".position",T,"pos",r),i(Hy,C+".quaternion",T,"rot",r),i(Fv,C+".scale",T,"scl",r)}}return r.length===0?null:new this(a,d,r,s)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const a=this.tracks[i];t=Math.max(t,a.times[a.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ese(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ov;case"vector":case"vector2":case"vector3":case"vector4":return Fv;case"color":return Ek;case"quaternion":return Hy;case"bool":case"boolean":return Sg;case"string":return Mg}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function tse(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=ese(n.type);if(n.times===void 0){const t=[],i=[];Mk(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const pg={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Ak{constructor(e,t,i){const r=this;let a=!1,l=0,s=0,d;const m=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(_){s++,a===!1&&r.onStart!==void 0&&r.onStart(_,l,s),a=!0},this.itemEnd=function(_){l++,r.onProgress!==void 0&&r.onProgress(_,l,s),l===s&&(a=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(_){r.onError!==void 0&&r.onError(_)},this.resolveURL=function(_){return d?d(_):_},this.setURLModifier=function(_){return d=_,this},this.addHandler=function(_,S){return m.push(_,S),this},this.removeHandler=function(_){const S=m.indexOf(_);return S!==-1&&m.splice(S,2),this},this.getHandler=function(_){for(let S=0,T=m.length;S<T;S+=2){const C=m[S],P=m[S+1];if(C.global&&(C.lastIndex=0),C.test(_))return P}return null}}}const OV=new Ak;class Ul{constructor(e){this.manager=e!==void 0?e:OV,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,a){i.load(e,r,t,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const gd={};class nse extends Error{constructor(e,t){super(e),this.response=t}}class jd extends Ul{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=pg.get(e);if(a!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(a),this.manager.itemEnd(e)},0),a;if(gd[e]!==void 0){gd[e].push({onLoad:t,onProgress:i,onError:r});return}gd[e]=[],gd[e].push({onLoad:t,onProgress:i,onError:r});const l=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,d=this.responseType;fetch(l).then(m=>{if(m.status===200||m.status===0){if(m.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||m.body===void 0||m.body.getReader===void 0)return m;const _=gd[e],S=m.body.getReader(),T=m.headers.get("Content-Length")||m.headers.get("X-File-Size"),C=T?parseInt(T):0,P=C!==0;let k=0;const R=new ReadableStream({start(O){F();function F(){S.read().then(({done:N,value:G})=>{if(N)O.close();else{k+=G.byteLength;const j=new ProgressEvent("progress",{lengthComputable:P,loaded:k,total:C});for(let Q=0,re=_.length;Q<re;Q++){const $=_[Q];$.onProgress&&$.onProgress(j)}O.enqueue(G),F()}})}}});return new Response(R)}else throw new nse(`fetch for "${m.url}" responded with ${m.status}: ${m.statusText}`,m)}).then(m=>{switch(d){case"arraybuffer":return m.arrayBuffer();case"blob":return m.blob();case"document":return m.text().then(_=>new DOMParser().parseFromString(_,s));case"json":return m.json();default:if(s===void 0)return m.text();{const S=/charset="?([^;"\s]*)"?/i.exec(s),T=S&&S[1]?S[1].toLowerCase():void 0,C=new TextDecoder(T);return m.arrayBuffer().then(P=>C.decode(P))}}}).then(m=>{pg.add(e,m);const _=gd[e];delete gd[e];for(let S=0,T=_.length;S<T;S++){const C=_[S];C.onLoad&&C.onLoad(m)}}).catch(m=>{const _=gd[e];if(_===void 0)throw this.manager.itemError(e),m;delete gd[e];for(let S=0,T=_.length;S<T;S++){const C=_[S];C.onError&&C.onError(m)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ise extends Ul{constructor(e){super(e)}load(e,t,i,r){const a=this,l=new jd(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(s){try{t(a.parse(JSON.parse(s)))}catch(d){r?r(d):console.error(d),a.manager.itemError(e)}},i,r)}parse(e){const t=[];for(let i=0;i<e.length;i++){const r=Bv.parse(e[i]);t.push(r)}return t}}class rse extends Ul{constructor(e){super(e)}load(e,t,i,r){const a=this,l=[],s=new mk,d=new jd(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(a.withCredentials);let m=0;function _(S){d.load(e[S],function(T){const C=a.parse(T,!0);l[S]={width:C.width,height:C.height,format:C.format,mipmaps:C.mipmaps},m+=1,m===6&&(C.mipmapCount===1&&(s.minFilter=zs),s.image=l,s.format=C.format,s.needsUpdate=!0,t&&t(s))},i,r)}if(Array.isArray(e))for(let S=0,T=e.length;S<T;++S)_(S);else d.load(e,function(S){const T=a.parse(S,!0);if(T.isCubemap){const C=T.mipmaps.length/T.mipmapCount;for(let P=0;P<C;P++){l[P]={mipmaps:[]};for(let k=0;k<T.mipmapCount;k++)l[P].mipmaps.push(T.mipmaps[P*T.mipmapCount+k]),l[P].format=T.format,l[P].width=T.width,l[P].height=T.height}s.image=l}else s.image.width=T.width,s.image.height=T.height,s.mipmaps=T.mipmaps;T.mipmapCount===1&&(s.minFilter=zs),s.format=T.format,s.needsUpdate=!0,t&&t(s)},i,r);return s}}class Nv extends Ul{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,l=pg.get(e);if(l!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(l),a.manager.itemEnd(e)},0),l;const s=kv("img");function d(){_(),pg.add(e,this),t&&t(this),a.manager.itemEnd(e)}function m(S){_(),r&&r(S),a.manager.itemError(e),a.manager.itemEnd(e)}function _(){s.removeEventListener("load",d,!1),s.removeEventListener("error",m,!1)}return s.addEventListener("load",d,!1),s.addEventListener("error",m,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),a.manager.itemStart(e),s.src=e,s}}class sse extends Ul{constructor(e){super(e)}load(e,t,i,r){const a=new h1,l=new Nv(this.manager);l.setCrossOrigin(this.crossOrigin),l.setPath(this.path);let s=0;function d(m){l.load(e[m],function(_){a.images[m]=_,s++,s===6&&(a.needsUpdate=!0,t&&t(a))},void 0,r)}for(let m=0;m<e.length;++m)d(m);return a}}class ose extends Ul{constructor(e){super(e)}load(e,t,i,r){const a=this,l=new ay,s=new jd(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(a.withCredentials),s.load(e,function(d){const m=a.parse(d);m&&(m.image!==void 0?l.image=m.image:m.data!==void 0&&(l.image.width=m.width,l.image.height=m.height,l.image.data=m.data),l.wrapS=m.wrapS!==void 0?m.wrapS:la,l.wrapT=m.wrapT!==void 0?m.wrapT:la,l.magFilter=m.magFilter!==void 0?m.magFilter:zs,l.minFilter=m.minFilter!==void 0?m.minFilter:zs,l.anisotropy=m.anisotropy!==void 0?m.anisotropy:1,m.encoding!==void 0&&(l.encoding=m.encoding),m.flipY!==void 0&&(l.flipY=m.flipY),m.format!==void 0&&(l.format=m.format),m.type!==void 0&&(l.type=m.type),m.mipmaps!==void 0&&(l.mipmaps=m.mipmaps,l.minFilter=bp),m.mipmapCount===1&&(l.minFilter=zs),m.generateMipmaps!==void 0&&(l.generateMipmaps=m.generateMipmaps),l.needsUpdate=!0,t&&t(l,m))},i,r),l}}class ase extends Ul{constructor(e){super(e)}load(e,t,i,r){const a=new bs,l=new Nv(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,function(s){a.image=s,a.needsUpdate=!0,t!==void 0&&t(a)},i,r),a}}class Dp extends lr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new zn(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class FV extends Dp{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(lr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new zn(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const DE=new vi,nF=new Fe,iF=new Fe;class Ck{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ht(512,512),this.map=null,this.mapPass=null,this.matrix=new vi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new HM,this._frameExtents=new Ht(1,1),this._viewportCount=1,this._viewports=[new br(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;nF.setFromMatrixPosition(e.matrixWorld),t.position.copy(nF),iF.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(iF),t.updateMatrixWorld(),DE.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DE),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(DE)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class lse extends Ck{constructor(){super(new Yr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=Pv*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;(i!==t.fov||r!==t.aspect||a!==t.far)&&(t.fov=i,t.aspect=r,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class BV extends Dp{constructor(e,t,i=0,r=Math.PI/3,a=0,l=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(lr.DEFAULT_UP),this.updateMatrix(),this.target=new lr,this.distance=i,this.angle=r,this.penumbra=a,this.decay=l,this.map=null,this.shadow=new lse}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const rF=new vi,lx=new Fe,LE=new Fe;class cse extends Ck{constructor(){super(new Yr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ht(4,2),this._viewportCount=6,this._viewports=[new br(2,1,1,1),new br(0,1,1,1),new br(3,1,1,1),new br(1,1,1,1),new br(3,0,1,1),new br(1,0,1,1)],this._cubeDirections=[new Fe(1,0,0),new Fe(-1,0,0),new Fe(0,0,1),new Fe(0,0,-1),new Fe(0,1,0),new Fe(0,-1,0)],this._cubeUps=[new Fe(0,1,0),new Fe(0,1,0),new Fe(0,1,0),new Fe(0,1,0),new Fe(0,0,1),new Fe(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,a=e.distance||i.far;a!==i.far&&(i.far=a,i.updateProjectionMatrix()),lx.setFromMatrixPosition(e.matrixWorld),i.position.copy(lx),LE.copy(i.position),LE.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(LE),i.updateMatrixWorld(),r.makeTranslation(-lx.x,-lx.y,-lx.z),rF.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(rF)}}class NV extends Dp{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new cse}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class use extends Ck{constructor(){super(new fp(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class UV extends Dp{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(lr.DEFAULT_UP),this.updateMatrix(),this.target=new lr,this.shadow=new use}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class VV extends Dp{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class GV extends Dp{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class WV{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Fe)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,a=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.282095),t.addScaledVector(l[1],.488603*r),t.addScaledVector(l[2],.488603*a),t.addScaledVector(l[3],.488603*i),t.addScaledVector(l[4],1.092548*(i*r)),t.addScaledVector(l[5],1.092548*(r*a)),t.addScaledVector(l[6],.315392*(3*a*a-1)),t.addScaledVector(l[7],1.092548*(i*a)),t.addScaledVector(l[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,a=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.886227),t.addScaledVector(l[1],2*.511664*r),t.addScaledVector(l[2],2*.511664*a),t.addScaledVector(l[3],2*.511664*i),t.addScaledVector(l[4],2*.429043*i*r),t.addScaledVector(l[5],2*.429043*r*a),t.addScaledVector(l[6],.743125*a*a-.247708),t.addScaledVector(l[7],2*.429043*i*a),t.addScaledVector(l[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,a=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*a,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*i*a,t[8]=.546274*(i*i-r*r)}}class eT extends Dp{constructor(e=new WV,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class tT extends Ul{constructor(e){super(e),this.textures={}}load(e,t,i,r){const a=this,l=new jd(a.manager);l.setPath(a.path),l.setRequestHeader(a.requestHeader),l.setWithCredentials(a.withCredentials),l.load(e,function(s){try{t(a.parse(JSON.parse(s)))}catch(d){r?r(d):console.error(d),a.manager.itemError(e)}},i,r)}parse(e){const t=this.textures;function i(a){return t[a]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",a),t[a]}const r=tT.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new zn().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==1&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const a in e.uniforms){const l=e.uniforms[a];switch(r.uniforms[a]={},l.type){case"t":r.uniforms[a].value=i(l.value);break;case"c":r.uniforms[a].value=new zn().setHex(l.value);break;case"v2":r.uniforms[a].value=new Ht().fromArray(l.value);break;case"v3":r.uniforms[a].value=new Fe().fromArray(l.value);break;case"v4":r.uniforms[a].value=new br().fromArray(l.value);break;case"m3":r.uniforms[a].value=new zo().fromArray(l.value);break;case"m4":r.uniforms[a].value=new vi().fromArray(l.value);break;default:r.uniforms[a].value=l.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const a in e.extensions)r.extensions[a]=e.extensions[a];if(e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=i(e.map)),e.matcap!==void 0&&(r.matcap=i(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let a=e.normalScale;Array.isArray(a)===!1&&(a=[a,a]),r.normalScale=new Ht().fromArray(a)}return e.displacementMap!==void 0&&(r.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Ht().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=i(e.thicknessMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:SV,SpriteMaterial:dk,RawShaderMaterial:MV,ShaderMaterial:Sh,PointsMaterial:pk,MeshPhysicalMaterial:TV,MeshStandardMaterial:bk,MeshPhongMaterial:EV,MeshToonMaterial:AV,MeshNormalMaterial:CV,MeshLambertMaterial:IV,MeshDepthMaterial:uk,MeshDistanceMaterial:hk,MeshBasicMaterial:Pp,MeshMatcapMaterial:PV,LineDashedMaterial:kV,LineBasicMaterial:ka,Material:No};return new t[e]}}class oI{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class HV extends Pi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class jV extends Ul{constructor(e){super(e)}load(e,t,i,r){const a=this,l=new jd(a.manager);l.setPath(a.path),l.setRequestHeader(a.requestHeader),l.setWithCredentials(a.withCredentials),l.load(e,function(s){try{t(a.parse(JSON.parse(s)))}catch(d){r?r(d):console.error(d),a.manager.itemError(e)}},i,r)}parse(e){const t={},i={};function r(C,P){if(t[P]!==void 0)return t[P];const R=C.interleavedBuffers[P],O=a(C,R.buffer),F=H_(R.type,O),N=new XM(F,R.stride);return N.uuid=R.uuid,t[P]=N,N}function a(C,P){if(i[P]!==void 0)return i[P];const R=C.arrayBuffers[P],O=new Uint32Array(R).buffer;return i[P]=O,O}const l=e.isInstancedBufferGeometry?new HV:new Pi,s=e.data.index;if(s!==void 0){const C=H_(s.type,s.array);l.setIndex(new zr(C,1))}const d=e.data.attributes;for(const C in d){const P=d[C];let k;if(P.isInterleavedBufferAttribute){const R=r(e.data,P.data);k=new dg(R,P.itemSize,P.offset,P.normalized)}else{const R=H_(P.type,P.array),O=P.isInstancedBufferAttribute?Cy:zr;k=new O(R,P.itemSize,P.normalized)}P.name!==void 0&&(k.name=P.name),P.usage!==void 0&&k.setUsage(P.usage),P.updateRange!==void 0&&(k.updateRange.offset=P.updateRange.offset,k.updateRange.count=P.updateRange.count),l.setAttribute(C,k)}const m=e.data.morphAttributes;if(m)for(const C in m){const P=m[C],k=[];for(let R=0,O=P.length;R<O;R++){const F=P[R];let N;if(F.isInterleavedBufferAttribute){const G=r(e.data,F.data);N=new dg(G,F.itemSize,F.offset,F.normalized)}else{const G=H_(F.type,F.array);N=new zr(G,F.itemSize,F.normalized)}F.name!==void 0&&(N.name=F.name),k.push(N)}l.morphAttributes[C]=k}e.data.morphTargetsRelative&&(l.morphTargetsRelative=!0);const S=e.data.groups||e.data.drawcalls||e.data.offsets;if(S!==void 0)for(let C=0,P=S.length;C!==P;++C){const k=S[C];l.addGroup(k.start,k.count,k.materialIndex)}const T=e.data.boundingSphere;if(T!==void 0){const C=new Fe;T.center!==void 0&&C.fromArray(T.center),l.boundingSphere=new wg(C,T.radius)}return e.name&&(l.name=e.name),e.userData&&(l.userData=e.userData),l}}class hse extends Ul{constructor(e){super(e)}load(e,t,i,r){const a=this,l=this.path===""?oI.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||l;const s=new jd(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(d){let m=null;try{m=JSON.parse(d)}catch(S){r!==void 0&&r(S),console.error("THREE:ObjectLoader: Can't parse "+e+".",S.message);return}const _=m.metadata;if(_===void 0||_.type===void 0||_.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}a.parse(m,t)},i,r)}async loadAsync(e,t){const i=this,r=this.path===""?oI.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const a=new jd(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const l=await a.loadAsync(e,t),s=JSON.parse(l),d=s.metadata;if(d===void 0||d.type===void 0||d.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(s)}parse(e,t){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,r),l=this.parseImages(e.images,function(){t!==void 0&&t(m)}),s=this.parseTextures(e.textures,l),d=this.parseMaterials(e.materials,s),m=this.parseObject(e.object,a,d,s,i),_=this.parseSkeletons(e.skeletons,m);if(this.bindSkeletons(m,_),t!==void 0){let S=!1;for(const T in l)if(l[T].data instanceof HTMLImageElement){S=!0;break}S===!1&&t(m)}return m}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),a=await this.parseImagesAsync(e.images),l=this.parseTextures(e.textures,a),s=this.parseMaterials(e.materials,l),d=this.parseObject(e.object,r,s,l,t),m=this.parseSkeletons(e.skeletons,d);return this.bindSkeletons(d,m),d}parseShapes(e){const t={};if(e!==void 0)for(let i=0,r=e.length;i<r;i++){const a=new tg().fromJSON(e[i]);t[a.uuid]=a}return t}parseSkeletons(e,t){const i={},r={};if(t.traverse(function(a){a.isBone&&(r[a.uuid]=a)}),e!==void 0)for(let a=0,l=e.length;a<l;a++){const s=new YM().fromJSON(e[a],r);i[s.uuid]=s}return i}parseGeometries(e,t){const i={};if(e!==void 0){const r=new jV;for(let a=0,l=e.length;a<l;a++){let s;const d=e[a];switch(d.type){case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(d);break;default:d.type in tF?s=tF[d.type].fromJSON(d,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${d.type}"`)}s.uuid=d.uuid,d.name!==void 0&&(s.name=d.name),d.userData!==void 0&&(s.userData=d.userData),i[d.uuid]=s}}return i}parseMaterials(e,t){const i={},r={};if(e!==void 0){const a=new tT;a.setTextures(t);for(let l=0,s=e.length;l<s;l++){const d=e[l];i[d.uuid]===void 0&&(i[d.uuid]=a.parse(d)),r[d.uuid]=i[d.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const r=e[i],a=Bv.parse(r);t[a.uuid]=a}return t}parseImages(e,t){const i=this,r={};let a;function l(d){return i.manager.itemStart(d),a.load(d,function(){i.manager.itemEnd(d)},void 0,function(){i.manager.itemError(d),i.manager.itemEnd(d)})}function s(d){if(typeof d=="string"){const m=d,_=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(m)?m:i.resourcePath+m;return l(_)}else return d.data?{data:H_(d.type,d.data),width:d.width,height:d.height}:null}if(e!==void 0&&e.length>0){const d=new Ak(t);a=new Nv(d),a.setCrossOrigin(this.crossOrigin);for(let m=0,_=e.length;m<_;m++){const S=e[m],T=S.url;if(Array.isArray(T)){const C=[];for(let P=0,k=T.length;P<k;P++){const R=T[P],O=s(R);O!==null&&(O instanceof HTMLImageElement?C.push(O):C.push(new ay(O.data,O.width,O.height)))}r[S.uuid]=new Vm(C)}else{const C=s(S.url);r[S.uuid]=new Vm(C)}}}return r}async parseImagesAsync(e){const t=this,i={};let r;async function a(l){if(typeof l=="string"){const s=l,d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s)?s:t.resourcePath+s;return await r.loadAsync(d)}else return l.data?{data:H_(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){r=new Nv(this.manager),r.setCrossOrigin(this.crossOrigin);for(let l=0,s=e.length;l<s;l++){const d=e[l],m=d.url;if(Array.isArray(m)){const _=[];for(let S=0,T=m.length;S<T;S++){const C=m[S],P=await a(C);P!==null&&(P instanceof HTMLImageElement?_.push(P):_.push(new ay(P.data,P.width,P.height)))}i[d.uuid]=new Vm(_)}else{const _=await a(d.url);i[d.uuid]=new Vm(_)}}}return i}parseTextures(e,t){function i(a,l){return typeof a=="number"?a:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a),l[a])}const r={};if(e!==void 0)for(let a=0,l=e.length;a<l;a++){const s=e[a];s.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),t[s.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const d=t[s.image],m=d.data;let _;Array.isArray(m)?(_=new h1,m.length===6&&(_.needsUpdate=!0)):(m&&m.data?_=new ay:_=new bs,m&&(_.needsUpdate=!0)),_.source=d,_.uuid=s.uuid,s.name!==void 0&&(_.name=s.name),s.mapping!==void 0&&(_.mapping=i(s.mapping,dse)),s.offset!==void 0&&_.offset.fromArray(s.offset),s.repeat!==void 0&&_.repeat.fromArray(s.repeat),s.center!==void 0&&_.center.fromArray(s.center),s.rotation!==void 0&&(_.rotation=s.rotation),s.wrap!==void 0&&(_.wrapS=i(s.wrap[0],sF),_.wrapT=i(s.wrap[1],sF)),s.format!==void 0&&(_.format=s.format),s.internalFormat!==void 0&&(_.internalFormat=s.internalFormat),s.type!==void 0&&(_.type=s.type),s.encoding!==void 0&&(_.encoding=s.encoding),s.minFilter!==void 0&&(_.minFilter=i(s.minFilter,oF)),s.magFilter!==void 0&&(_.magFilter=i(s.magFilter,oF)),s.anisotropy!==void 0&&(_.anisotropy=s.anisotropy),s.flipY!==void 0&&(_.flipY=s.flipY),s.generateMipmaps!==void 0&&(_.generateMipmaps=s.generateMipmaps),s.premultiplyAlpha!==void 0&&(_.premultiplyAlpha=s.premultiplyAlpha),s.unpackAlignment!==void 0&&(_.unpackAlignment=s.unpackAlignment),s.userData!==void 0&&(_.userData=s.userData),r[s.uuid]=_}return r}parseObject(e,t,i,r,a){let l;function s(T){return t[T]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",T),t[T]}function d(T){if(T!==void 0){if(Array.isArray(T)){const C=[];for(let P=0,k=T.length;P<k;P++){const R=T[P];i[R]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",R),C.push(i[R])}return C}return i[T]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",T),i[T]}}function m(T){return r[T]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",T),r[T]}let _,S;switch(e.type){case"Scene":l=new sM,e.background!==void 0&&(Number.isInteger(e.background)?l.background=new zn(e.background):l.background=m(e.background)),e.environment!==void 0&&(l.environment=m(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?l.fog=new $M(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(l.fog=new ZM(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(l.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(l.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":l=new Yr(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(l.focus=e.focus),e.zoom!==void 0&&(l.zoom=e.zoom),e.filmGauge!==void 0&&(l.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(l.filmOffset=e.filmOffset),e.view!==void 0&&(l.view=Object.assign({},e.view));break;case"OrthographicCamera":l=new fp(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(l.zoom=e.zoom),e.view!==void 0&&(l.view=Object.assign({},e.view));break;case"AmbientLight":l=new VV(e.color,e.intensity);break;case"DirectionalLight":l=new UV(e.color,e.intensity);break;case"PointLight":l=new NV(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":l=new GV(e.color,e.intensity,e.width,e.height);break;case"SpotLight":l=new BV(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":l=new FV(e.color,e.groundColor,e.intensity);break;case"LightProbe":l=new eT().fromJSON(e);break;case"SkinnedMesh":_=s(e.geometry),S=d(e.material),l=new cV(_,S),e.bindMode!==void 0&&(l.bindMode=e.bindMode),e.bindMatrix!==void 0&&l.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(l.skeleton=e.skeleton);break;case"Mesh":_=s(e.geometry),S=d(e.material),l=new Oo(_,S);break;case"InstancedMesh":_=s(e.geometry),S=d(e.material);const T=e.count,C=e.instanceMatrix,P=e.instanceColor;l=new uV(_,S,T),l.instanceMatrix=new Cy(new Float32Array(C.array),16),P!==void 0&&(l.instanceColor=new Cy(new Float32Array(P.array),P.itemSize));break;case"LOD":l=new lV;break;case"Line":l=new Sp(s(e.geometry),d(e.material));break;case"LineLoop":l=new hV(s(e.geometry),d(e.material));break;case"LineSegments":l=new Th(s(e.geometry),d(e.material));break;case"PointCloud":case"Points":l=new dV(s(e.geometry),d(e.material));break;case"Sprite":l=new aV(d(e.material));break;case"Group":l=new q_;break;case"Bone":l=new fk;break;default:l=new lr}if(l.uuid=e.uuid,e.name!==void 0&&(l.name=e.name),e.matrix!==void 0?(l.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(l.matrixAutoUpdate=e.matrixAutoUpdate),l.matrixAutoUpdate&&l.matrix.decompose(l.position,l.quaternion,l.scale)):(e.position!==void 0&&l.position.fromArray(e.position),e.rotation!==void 0&&l.rotation.fromArray(e.rotation),e.quaternion!==void 0&&l.quaternion.fromArray(e.quaternion),e.scale!==void 0&&l.scale.fromArray(e.scale)),e.castShadow!==void 0&&(l.castShadow=e.castShadow),e.receiveShadow!==void 0&&(l.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(l.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(l.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(l.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&l.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(l.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(l.visible=e.visible),e.frustumCulled!==void 0&&(l.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(l.renderOrder=e.renderOrder),e.userData!==void 0&&(l.userData=e.userData),e.layers!==void 0&&(l.layers.mask=e.layers),e.children!==void 0){const T=e.children;for(let C=0;C<T.length;C++)l.add(this.parseObject(T[C],t,i,r,a))}if(e.animations!==void 0){const T=e.animations;for(let C=0;C<T.length;C++){const P=T[C];l.animations.push(a[P])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(l.autoUpdate=e.autoUpdate);const T=e.levels;for(let C=0;C<T.length;C++){const P=T[C],k=l.getObjectByProperty("uuid",P.object);k!==void 0&&l.addLevel(k,P.distance,P.hysteresis)}}return l}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const r=t[i.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(r,i.bindMatrix)}})}}const dse={UVMapping:VM,CubeReflectionMapping:vp,CubeRefractionMapping:wp,EquirectangularReflectionMapping:bv,EquirectangularRefractionMapping:Sv,CubeUVReflectionMapping:By},sF={RepeatWrapping:Mv,ClampToEdgeWrapping:la,MirroredRepeatWrapping:Tv},oF={NearestFilter:Ls,NearestMipmapNearestFilter:iM,NearestMipmapLinearFilter:Wx,LinearFilter:zs,LinearMipmapNearestFilter:ek,LinearMipmapLinearFilter:bp};class fse extends Ul{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,l=pg.get(e);if(l!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(l),a.manager.itemEnd(e)},0),l;const s={};s.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then(function(d){return d.blob()}).then(function(d){return createImageBitmap(d,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(d){pg.add(e,d),t&&t(d),a.manager.itemEnd(e)}).catch(function(d){r&&r(d),a.manager.itemError(e),a.manager.itemEnd(e)}),a.manager.itemStart(e)}}let Cb;class Ik{static getContext(){return Cb===void 0&&(Cb=new(window.AudioContext||window.webkitAudioContext)),Cb}static setContext(e){Cb=e}}class pse extends Ul{constructor(e){super(e)}load(e,t,i,r){const a=this,l=new jd(this.manager);l.setResponseType("arraybuffer"),l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(s){try{const d=s.slice(0);Ik.getContext().decodeAudioData(d,function(_){t(_)})}catch(d){r?r(d):console.error(d),a.manager.itemError(e)}},i,r)}}class mse extends eT{constructor(e,t,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const r=new zn().set(e),a=new zn().set(t),l=new Fe(r.r,r.g,r.b),s=new Fe(a.r,a.g,a.b),d=Math.sqrt(Math.PI),m=d*Math.sqrt(.75);this.sh.coefficients[0].copy(l).add(s).multiplyScalar(d),this.sh.coefficients[1].copy(l).sub(s).multiplyScalar(m)}}class gse extends eT{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const i=new zn().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const aF=new vi,lF=new vi,ym=new vi;class _se{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Yr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Yr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,ym.copy(e.projectionMatrix);const r=t.eyeSep/2,a=r*t.near/t.focus,l=t.near*Math.tan(Qm*t.fov*.5)/t.zoom;let s,d;lF.elements[12]=-r,aF.elements[12]=r,s=-l*t.aspect+a,d=l*t.aspect+a,ym.elements[0]=2*t.near/(d-s),ym.elements[8]=(d+s)/(d-s),this.cameraL.projectionMatrix.copy(ym),s=-l*t.aspect-a,d=l*t.aspect-a,ym.elements[0]=2*t.near/(d-s),ym.elements[8]=(d+s)/(d-s),this.cameraR.projectionMatrix.copy(ym)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(lF),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(aF)}}class Pk{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=cF(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=cF();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function cF(){return(typeof performance>"u"?Date:performance).now()}const xm=new Fe,uF=new da,yse=new Fe,vm=new Fe;class xse extends lr{constructor(){super(),this.type="AudioListener",this.context=Ik.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Pk}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(xm,uF,yse),vm.set(0,0,-1).applyQuaternion(uF),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(xm.x,r),t.positionY.linearRampToValueAtTime(xm.y,r),t.positionZ.linearRampToValueAtTime(xm.z,r),t.forwardX.linearRampToValueAtTime(vm.x,r),t.forwardY.linearRampToValueAtTime(vm.y,r),t.forwardZ.linearRampToValueAtTime(vm.z,r),t.upX.linearRampToValueAtTime(i.x,r),t.upY.linearRampToValueAtTime(i.y,r),t.upZ.linearRampToValueAtTime(i.z,r)}else t.setPosition(xm.x,xm.y,xm.z),t.setOrientation(vm.x,vm.y,vm.z,i.x,i.y,i.z)}}class qV extends lr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const wm=new Fe,hF=new da,vse=new Fe,bm=new Fe;class wse extends qV{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(wm,hF,vse),bm.set(0,0,1).applyQuaternion(hF);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(wm.x,i),t.positionY.linearRampToValueAtTime(wm.y,i),t.positionZ.linearRampToValueAtTime(wm.z,i),t.orientationX.linearRampToValueAtTime(bm.x,i),t.orientationY.linearRampToValueAtTime(bm.y,i),t.orientationZ.linearRampToValueAtTime(bm.z,i)}else t.setPosition(wm.x,wm.y,wm.z),t.setOrientation(bm.x,bm.y,bm.z)}}class bse{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class ZV{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,a,l;switch(t){case"quaternion":r=this._slerp,a=this._slerpAdditive,l=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,l=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,a=this._lerpAdditive,l=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=l,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,a=e*r+r;let l=this.cumulativeWeight;if(l===0){for(let s=0;s!==r;++s)i[a+s]=i[s];l=t}else{l+=t;const s=t/l;this._mixBufferRegion(i,a,0,s,r)}this.cumulativeWeight=l}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,a=this.cumulativeWeight,l=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const d=t*this._origIndex;this._mixBufferRegion(i,r,d,1-a,t)}l>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let d=t,m=t+t;d!==m;++d)if(i[d]!==i[d+t]){s.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let a=i,l=r;a!==l;++a)t[a]=t[r+a%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,a){if(r>=.5)for(let l=0;l!==a;++l)e[t+l]=e[i+l]}_slerp(e,t,i,r){da.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,a){const l=this._workIndex*a;da.multiplyQuaternionsFlat(e,l,e,t,e,i),da.slerpFlat(e,t,e,t,e,l,r)}_lerp(e,t,i,r,a){const l=1-r;for(let s=0;s!==a;++s){const d=t+s;e[d]=e[d]*l+e[i+s]*r}}_lerpAdditive(e,t,i,r,a){for(let l=0;l!==a;++l){const s=t+l;e[s]=e[s]+e[i+l]*r}}}const kk="\\[\\]\\.:\\/",Sse=new RegExp("["+kk+"]","g"),Dk="[^"+kk+"]",Mse="[^"+kk.replace("\\.","")+"]",Tse=/((?:WC+[\/:])*)/.source.replace("WC",Dk),Ese=/(WCOD+)?/.source.replace("WCOD",Mse),Ase=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Dk),Cse=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Dk),Ise=new RegExp("^"+Tse+Ese+Ase+Cse+"$"),Pse=["material","materials","bones","map"];class kse{constructor(e,t,i){const r=i||sr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,a=i.length;r!==a;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class sr{constructor(e,t,i){this.path=t,this.parsedPath=i||sr.parseTrackName(t),this.node=sr.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new sr.Composite(e,t,i):new sr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Sse,"")}static parseTrackName(e){const t=Ise.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const a=i.nodeName.substring(r+1);Pse.indexOf(a)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=a)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(a){for(let l=0;l<a.length;l++){const s=a[l];if(s.name===t||s.uuid===t)return s;const d=i(s.children);if(d)return d}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let a=t.propertyIndex;if(e||(e=sr.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let m=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let _=0;_<e.length;_++)if(e[_].name===m){m=_;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(m!==void 0){if(e[m]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[m]}}const l=e[r];if(l===void 0){const m=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+m+"."+r+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?s=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(s=this.Versioning.MatrixWorldNeedsUpdate);let d=this.BindingType.Direct;if(a!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[a]!==void 0&&(a=e.morphTargetDictionary[a])}d=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else l.fromArray!==void 0&&l.toArray!==void 0?(d=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(d=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=r;this.getValue=this.GetterByBindingType[d],this.setValue=this.SetterByBindingTypeAndVersioning[d][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}sr.Composite=kse;sr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};sr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};sr.prototype.GetterByBindingType=[sr.prototype._getValue_direct,sr.prototype._getValue_array,sr.prototype._getValue_arrayElement,sr.prototype._getValue_toArray];sr.prototype.SetterByBindingTypeAndVersioning=[[sr.prototype._setValue_direct,sr.prototype._setValue_direct_setNeedsUpdate,sr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[sr.prototype._setValue_array,sr.prototype._setValue_array_setNeedsUpdate,sr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[sr.prototype._setValue_arrayElement,sr.prototype._setValue_arrayElement_setNeedsUpdate,sr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[sr.prototype._setValue_fromArray,sr.prototype._setValue_fromArray_setNeedsUpdate,sr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Dse{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Rl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,a=this._bindings,l=a.length;let s,d=e.length,m=this.nCachedObjects_;for(let _=0,S=arguments.length;_!==S;++_){const T=arguments[_],C=T.uuid;let P=t[C];if(P===void 0){P=d++,t[C]=P,e.push(T);for(let k=0,R=l;k!==R;++k)a[k].push(new sr(T,i[k],r[k]))}else if(P<m){s=e[P];const k=--m,R=e[k];t[R.uuid]=P,e[P]=R,t[C]=k,e[k]=T;for(let O=0,F=l;O!==F;++O){const N=a[O],G=N[k];let j=N[P];N[P]=G,j===void 0&&(j=new sr(T,i[O],r[O])),N[k]=j}}else e[P]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=m}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let a=this.nCachedObjects_;for(let l=0,s=arguments.length;l!==s;++l){const d=arguments[l],m=d.uuid,_=t[m];if(_!==void 0&&_>=a){const S=a++,T=e[S];t[T.uuid]=_,e[_]=T,t[m]=S,e[S]=d;for(let C=0,P=r;C!==P;++C){const k=i[C],R=k[S],O=k[_];k[_]=R,k[S]=O}}}this.nCachedObjects_=a}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let a=this.nCachedObjects_,l=e.length;for(let s=0,d=arguments.length;s!==d;++s){const m=arguments[s],_=m.uuid,S=t[_];if(S!==void 0)if(delete t[_],S<a){const T=--a,C=e[T],P=--l,k=e[P];t[C.uuid]=S,e[S]=C,t[k.uuid]=T,e[T]=k,e.pop();for(let R=0,O=r;R!==O;++R){const F=i[R],N=F[T],G=F[P];F[S]=N,F[T]=G,F.pop()}}else{const T=--l,C=e[T];T>0&&(t[C.uuid]=S),e[S]=C,e.pop();for(let P=0,k=r;P!==k;++P){const R=i[P];R[S]=R[T],R.pop()}}}this.nCachedObjects_=a}subscribe_(e,t){const i=this._bindingsIndicesByPath;let r=i[e];const a=this._bindings;if(r!==void 0)return a[r];const l=this._paths,s=this._parsedPaths,d=this._objects,m=d.length,_=this.nCachedObjects_,S=new Array(m);r=a.length,i[e]=r,l.push(e),s.push(t),a.push(S);for(let T=_,C=d.length;T!==C;++T){const P=d[T];S[T]=new sr(P,e,t)}return S}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const r=this._paths,a=this._parsedPaths,l=this._bindings,s=l.length-1,d=l[s],m=e[s];t[m]=i,l[i]=d,l.pop(),a[i]=a[s],a.pop(),r[i]=r[s],r.pop()}}}class Lse{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const a=t.tracks,l=a.length,s=new Array(l),d={endingStart:Nm,endingEnd:Nm};for(let m=0;m!==l;++m){const _=a[m].createInterpolant(null);s[m]=_,_.settings=d}this._interpolantSettings=d,this._interpolants=s,this._propertyBindings=new Array(l),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=F6,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const r=this._clip.duration,a=e._clip.duration,l=a/r,s=r/a;e.warp(1,l,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,a=r.time,l=this.timeScale;let s=this._timeScaleInterpolant;s===null&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const d=s.parameterPositions,m=s.sampleValues;return d[0]=a,d[1]=a+i,m[0]=e/l,m[1]=t/l,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}const a=this._startTime;if(a!==null){const d=(e-a)*i;d<0||i===0?t=0:(this._startTime=null,t=i*d)}t*=this._updateTimeScale(e);const l=this._updateTime(t),s=this._updateWeight(e);if(s>0){const d=this._interpolants,m=this._propertyBindings;switch(this.blendMode){case nk:for(let _=0,S=d.length;_!==S;++_)d[_].evaluate(l),m[_].accumulateAdditive(s);break;case GM:default:for(let _=0,S=d.length;_!==S;++_)d[_].evaluate(l),m[_].accumulate(r,s)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,a=this._loopCount;const l=i===B6;if(e===0)return a===-1?r:l&&(a&1)===1?t-r:r;if(i===O6){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(a===-1&&(e>=0?(a=0,this._setEndings(!0,this.repetitions===0,l)):this._setEndings(this.repetitions===0,!0,l)),r>=t||r<0){const s=Math.floor(r/t);r-=t*s,a+=Math.abs(s);const d=this.repetitions-a;if(d<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(d===1){const m=e<0;this._setEndings(m,!m,l)}else this._setEndings(!1,!1,l);this._loopCount=a,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}else this.time=r;if(l&&(a&1)===1)return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=Um,r.endingEnd=Um):(e?r.endingStart=this.zeroSlopeAtStart?Um:Nm:r.endingStart=Cv,t?r.endingEnd=this.zeroSlopeAtEnd?Um:Nm:r.endingEnd=Cv)}_scheduleFading(e,t,i){const r=this._mixer,a=r.time;let l=this._weightInterpolant;l===null&&(l=r._lendControlInterpolant(),this._weightInterpolant=l);const s=l.parameterPositions,d=l.sampleValues;return s[0]=a,d[0]=t,s[1]=a+e,d[1]=i,this}}const Rse=new Float32Array(1);class zse extends Mh{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,a=r.length,l=e._propertyBindings,s=e._interpolants,d=i.uuid,m=this._bindingsByRootAndName;let _=m[d];_===void 0&&(_={},m[d]=_);for(let S=0;S!==a;++S){const T=r[S],C=T.name;let P=_[C];if(P!==void 0)++P.referenceCount,l[S]=P;else{if(P=l[S],P!==void 0){P._cacheIndex===null&&(++P.referenceCount,this._addInactiveBinding(P,d,C));continue}const k=t&&t._propertyBindings[S].binding.parsedPath;P=new ZV(sr.create(i,C,k),T.ValueTypeName,T.getValueSize()),++P.referenceCount,this._addInactiveBinding(P,d,C),l[S]=P}s[S].resultBuffer=P.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,a=this._actionsByClip[r];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const a=t[i];a.useCount++===0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const a=t[i];--a.useCount===0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,a=this._actionsByClip;let l=a[t];if(l===void 0)l={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=l;else{const s=l.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=r.length,r.push(e),l.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const a=e._clip.uuid,l=this._actionsByClip,s=l[a],d=s.knownActions,m=d[d.length-1],_=e._byClipCacheIndex;m._byClipCacheIndex=_,d[_]=m,d.pop(),e._byClipCacheIndex=null;const S=s.actionByRoot,T=(e._localRoot||this._root).uuid;delete S[T],d.length===0&&delete l[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const a=t[i];--a.referenceCount===0&&this._removeInactiveBinding(a)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=i,t[i]=a}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=i,t[i]=a}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,a=this._bindings;let l=r[t];l===void 0&&(l={},r[t]=l),l[i]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,a=i.path,l=this._bindingsByRootAndName,s=l[r],d=t[t.length-1],m=e._cacheIndex;d._cacheIndex=m,t[m]=d,t.pop(),delete s[a],Object.keys(s).length===0&&delete l[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=i,t[i]=a}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=i,t[i]=a}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new Tk(new Float32Array(2),new Float32Array(2),1,Rse),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,a=t[r];e.__cacheIndex=r,t[r]=e,a.__cacheIndex=i,t[i]=a}clipAction(e,t,i){const r=t||this._root,a=r.uuid;let l=typeof e=="string"?Bv.findByName(r,e):e;const s=l!==null?l.uuid:e,d=this._actionsByClip[s];let m=null;if(i===void 0&&(l!==null?i=l.blendMode:i=GM),d!==void 0){const S=d.actionByRoot[a];if(S!==void 0&&S.blendMode===i)return S;m=d.knownActions[0],l===null&&(l=m._clip)}if(l===null)return null;const _=new Lse(this,l,t,i);return this._bindAction(_,m),this._addInactiveAction(_,s,a),_}existingAction(e,t){const i=t||this._root,r=i.uuid,a=typeof e=="string"?Bv.findByName(i,e):e,l=a?a.uuid:e,s=this._actionsByClip[l];return s!==void 0&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,a=Math.sign(e),l=this._accuIndex^=1;for(let m=0;m!==i;++m)t[m]._update(r,e,a,l);const s=this._bindings,d=this._nActiveBindings;for(let m=0;m!==d;++m)s[m].apply(l);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,a=r[i];if(a!==void 0){const l=a.knownActions;for(let s=0,d=l.length;s!==d;++s){const m=l[s];this._deactivateAction(m);const _=m._cacheIndex,S=t[t.length-1];m._cacheIndex=null,m._byClipCacheIndex=null,S._cacheIndex=_,t[_]=S,t.pop(),this._removeInactiveBindingsForAction(m)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const l in i){const s=i[l].actionByRoot,d=s[t];d!==void 0&&(this._deactivateAction(d),this._removeInactiveAction(d))}const r=this._bindingsByRootAndName,a=r[t];if(a!==void 0)for(const l in a){const s=a[l];s.restoreOriginalState(),this._removeInactiveBinding(s)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Lk{constructor(e){this.value=e}clone(){return new Lk(this.value.clone===void 0?this.value:this.value.clone())}}let Ose=0;class Fse extends Mh{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Ose++}),this.name="",this.usage=Iv,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,r=t.length;i<r;i++)this.uniforms.push(t[i].clone());return this}clone(){return new this.constructor().copy(this)}}class Bse extends XM{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Nse{constructor(e,t,i,r,a){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class $V{constructor(e,t,i=0,r=1/0){this.ray=new l1(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new eg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return aI(e,this,i,t),i.sort(dF),i}intersectObjects(e,t=!0,i=[]){for(let r=0,a=e.length;r<a;r++)aI(e[r],this,i,t);return i.sort(dF),i}}function dF(n,e){return n.distance-e.distance}function aI(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const r=n.children;for(let a=0,l=r.length;a<l;a++)aI(r[a],e,t,!0)}}class lI{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Os(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Use{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}const fF=new Ht;class Vse{constructor(e=new Ht(1/0,1/0),t=new Ht(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=fF.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,fF).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const pF=new Fe,Ib=new Fe;class Gse{constructor(e=new Fe,t=new Fe){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){pF.subVectors(e,this.start),Ib.subVectors(this.end,this.start);const i=Ib.dot(Ib);let a=Ib.dot(pF)/i;return t&&(a=Os(a,0,1)),a}closestPointToPoint(e,t,i){const r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const mF=new Fe;class Wse extends lr{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new Pi,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let l=0,s=1,d=32;l<d;l++,s++){const m=l/d*Math.PI*2,_=s/d*Math.PI*2;r.push(Math.cos(m),Math.sin(m),1,Math.cos(_),Math.sin(_),1)}i.setAttribute("position",new qn(r,3));const a=new ka({fog:!1,toneMapped:!1});this.cone=new Th(i,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),mF.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(mF),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Rf=new Fe,Pb=new vi,RE=new vi;class Hse extends Th{constructor(e){const t=XV(e),i=new Pi,r=[],a=[],l=new zn(0,0,1),s=new zn(0,1,0);for(let m=0;m<t.length;m++){const _=t[m];_.parent&&_.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),a.push(l.r,l.g,l.b),a.push(s.r,s.g,s.b))}i.setAttribute("position",new qn(r,3)),i.setAttribute("color",new qn(a,3));const d=new ka({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,d),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");RE.copy(this.root.matrixWorld).invert();for(let a=0,l=0;a<t.length;a++){const s=t[a];s.parent&&s.parent.isBone&&(Pb.multiplyMatrices(RE,s.matrixWorld),Rf.setFromMatrixPosition(Pb),r.setXYZ(l,Rf.x,Rf.y,Rf.z),Pb.multiplyMatrices(RE,s.parent.matrixWorld),Rf.setFromMatrixPosition(Pb),r.setXYZ(l+1,Rf.x,Rf.y,Rf.z),l+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function XV(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,XV(n.children[t]));return e}class jse extends Oo{constructor(e,t,i){const r=new Wy(t,4,2),a=new Pp({wireframe:!0,fog:!1,toneMapped:!1});super(r,a),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const qse=new Fe,gF=new zn,_F=new zn;class Zse extends lr{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new Gy(t);r.rotateY(Math.PI*.5),this.material=new Pp({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const a=r.getAttribute("position"),l=new Float32Array(a.count*3);r.setAttribute("color",new zr(l,3)),this.add(new Oo(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");gF.copy(this.light.color),_F.copy(this.light.groundColor);for(let i=0,r=t.count;i<r;i++){const a=i<r/2?gF:_F;t.setXYZ(i,a.r,a.g,a.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(qse.setFromMatrixPosition(this.light.matrixWorld).negate())}}class $se extends Th{constructor(e=10,t=10,i=4473924,r=8947848){i=new zn(i),r=new zn(r);const a=t/2,l=e/t,s=e/2,d=[],m=[];for(let T=0,C=0,P=-s;T<=t;T++,P+=l){d.push(-s,0,P,s,0,P),d.push(P,0,-s,P,0,s);const k=T===a?i:r;k.toArray(m,C),C+=3,k.toArray(m,C),C+=3,k.toArray(m,C),C+=3,k.toArray(m,C),C+=3}const _=new Pi;_.setAttribute("position",new qn(d,3)),_.setAttribute("color",new qn(m,3));const S=new ka({vertexColors:!0,toneMapped:!1});super(_,S),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Xse extends Th{constructor(e=10,t=16,i=8,r=64,a=4473924,l=8947848){a=new zn(a),l=new zn(l);const s=[],d=[];if(t>1)for(let S=0;S<t;S++){const T=S/t*(Math.PI*2),C=Math.sin(T)*e,P=Math.cos(T)*e;s.push(0,0,0),s.push(C,0,P);const k=S&1?a:l;d.push(k.r,k.g,k.b),d.push(k.r,k.g,k.b)}for(let S=0;S<i;S++){const T=S&1?a:l,C=e-e/i*S;for(let P=0;P<r;P++){let k=P/r*(Math.PI*2),R=Math.sin(k)*C,O=Math.cos(k)*C;s.push(R,0,O),d.push(T.r,T.g,T.b),k=(P+1)/r*(Math.PI*2),R=Math.sin(k)*C,O=Math.cos(k)*C,s.push(R,0,O),d.push(T.r,T.g,T.b)}}const m=new Pi;m.setAttribute("position",new qn(s,3)),m.setAttribute("color",new qn(d,3));const _=new ka({vertexColors:!0,toneMapped:!1});super(m,_),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const yF=new Fe,kb=new Fe,xF=new Fe;class Yse extends lr{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Pi;r.setAttribute("position",new qn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const a=new ka({fog:!1,toneMapped:!1});this.lightPlane=new Sp(r,a),this.add(this.lightPlane),r=new Pi,r.setAttribute("position",new qn([0,0,0,0,0,1],3)),this.targetLine=new Sp(r,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),yF.setFromMatrixPosition(this.light.matrixWorld),kb.setFromMatrixPosition(this.light.target.matrixWorld),xF.subVectors(kb,yF),this.lightPlane.lookAt(kb),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(kb),this.targetLine.scale.z=xF.length()}}const Db=new Fe,_s=new u1;class Jse extends Th{constructor(e){const t=new Pi,i=new ka({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],a=[],l={};s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4");function s(P,k){d(P),d(k)}function d(P){r.push(0,0,0),a.push(0,0,0),l[P]===void 0&&(l[P]=[]),l[P].push(r.length/3-1)}t.setAttribute("position",new qn(r,3)),t.setAttribute("color",new qn(a,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=l,this.update();const m=new zn(16755200),_=new zn(16711680),S=new zn(43775),T=new zn(16777215),C=new zn(3355443);this.setColors(m,_,S,T,C)}setColors(e,t,i,r,a){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,a.r,a.g,a.b),s.setXYZ(41,a.r,a.g,a.b),s.setXYZ(42,a.r,a.g,a.b),s.setXYZ(43,a.r,a.g,a.b),s.setXYZ(44,a.r,a.g,a.b),s.setXYZ(45,a.r,a.g,a.b),s.setXYZ(46,a.r,a.g,a.b),s.setXYZ(47,a.r,a.g,a.b),s.setXYZ(48,a.r,a.g,a.b),s.setXYZ(49,a.r,a.g,a.b),s.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,r=1;_s.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ks("c",t,e,_s,0,0,-1),ks("t",t,e,_s,0,0,1),ks("n1",t,e,_s,-i,-r,-1),ks("n2",t,e,_s,i,-r,-1),ks("n3",t,e,_s,-i,r,-1),ks("n4",t,e,_s,i,r,-1),ks("f1",t,e,_s,-i,-r,1),ks("f2",t,e,_s,i,-r,1),ks("f3",t,e,_s,-i,r,1),ks("f4",t,e,_s,i,r,1),ks("u1",t,e,_s,i*.7,r*1.1,-1),ks("u2",t,e,_s,-i*.7,r*1.1,-1),ks("u3",t,e,_s,0,r*2,-1),ks("cf1",t,e,_s,-i,0,1),ks("cf2",t,e,_s,i,0,1),ks("cf3",t,e,_s,0,-r,1),ks("cf4",t,e,_s,0,r,1),ks("cn1",t,e,_s,-i,0,-1),ks("cn2",t,e,_s,i,0,-1),ks("cn3",t,e,_s,0,-r,-1),ks("cn4",t,e,_s,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ks(n,e,t,i,r,a,l){Db.set(r,a,l).unproject(i);const s=e[n];if(s!==void 0){const d=t.getAttribute("position");for(let m=0,_=s.length;m<_;m++)d.setXYZ(s[m],Db.x,Db.y,Db.z)}}const Lb=new vg;class Kse extends Th{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),a=new Pi;a.setIndex(new zr(i,1)),a.setAttribute("position",new zr(r,3)),super(a,new ka({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Lb.setFromObject(this.object),Lb.isEmpty())return;const t=Lb.min,i=Lb.max,r=this.geometry.attributes.position,a=r.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=t.x,a[4]=i.y,a[5]=i.z,a[6]=t.x,a[7]=t.y,a[8]=i.z,a[9]=i.x,a[10]=t.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=t.z,a[15]=t.x,a[16]=i.y,a[17]=t.z,a[18]=t.x,a[19]=t.y,a[20]=t.z,a[21]=i.x,a[22]=t.y,a[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Qse extends Th{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],a=new Pi;a.setIndex(new zr(i,1)),a.setAttribute("position",new qn(r,3)),super(a,new ka({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class eoe extends Sp{constructor(e,t=1,i=16776960){const r=i,a=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],l=new Pi;l.setAttribute("position",new qn(a,3)),l.computeBoundingSphere(),super(l,new ka({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],d=new Pi;d.setAttribute("position",new qn(s,3)),d.computeBoundingSphere(),this.add(new Oo(d,new Pp({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const vF=new Fe;let Rb,zE;class toe extends lr{constructor(e=new Fe(0,0,1),t=new Fe(0,0,0),i=1,r=16776960,a=i*.2,l=a*.2){super(),this.type="ArrowHelper",Rb===void 0&&(Rb=new Pi,Rb.setAttribute("position",new qn([0,0,0,0,1,0],3)),zE=new bg(0,.5,1,5,1),zE.translate(0,-.5,0)),this.position.copy(t),this.line=new Sp(Rb,new ka({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Oo(zE,new Pp({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,a,l)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{vF.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(vF,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class noe extends Th{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Pi;r.setAttribute("position",new qn(t,3)),r.setAttribute("color",new qn(i,3));const a=new ka({vertexColors:!0,toneMapped:!1});super(r,a),this.type="AxesHelper"}setColors(e,t,i){const r=new zn,a=this.geometry.attributes.color.array;return r.set(e),r.toArray(a,0),r.toArray(a,3),r.set(t),r.toArray(a,6),r.toArray(a,9),r.set(i),r.toArray(a,12),r.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ioe{constructor(){this.type="ShapePath",this.color=new zn,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Dv,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,a,l){return this.currentPath.bezierCurveTo(e,t,i,r,a,l),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(O){const F=[];for(let N=0,G=O.length;N<G;N++){const j=O[N],Q=new tg;Q.curves=j.curves,F.push(Q)}return F}function i(O,F){const N=F.length;let G=!1;for(let j=N-1,Q=0;Q<N;j=Q++){let re=F[j],$=F[Q],ne=$.x-re.x,ue=$.y-re.y;if(Math.abs(ue)>Number.EPSILON){if(ue<0&&(re=F[Q],ne=-ne,$=F[j],ue=-ue),O.y<re.y||O.y>$.y)continue;if(O.y===re.y){if(O.x===re.x)return!0}else{const De=ue*(O.x-re.x)-ne*(O.y-re.y);if(De===0)return!0;if(De<0)continue;G=!G}}else{if(O.y!==re.y)continue;if($.x<=O.x&&O.x<=re.x||re.x<=O.x&&O.x<=$.x)return!0}}return G}const r=wh.isClockWise,a=this.subPaths;if(a.length===0)return[];let l,s,d;const m=[];if(a.length===1)return s=a[0],d=new tg,d.curves=s.curves,m.push(d),m;let _=!r(a[0].getPoints());_=e?!_:_;const S=[],T=[];let C=[],P=0,k;T[P]=void 0,C[P]=[];for(let O=0,F=a.length;O<F;O++)s=a[O],k=s.getPoints(),l=r(k),l=e?!l:l,l?(!_&&T[P]&&P++,T[P]={s:new tg,p:k},T[P].s.curves=s.curves,_&&P++,C[P]=[]):C[P].push({h:s,p:k[0]});if(!T[0])return t(a);if(T.length>1){let O=!1,F=0;for(let N=0,G=T.length;N<G;N++)S[N]=[];for(let N=0,G=T.length;N<G;N++){const j=C[N];for(let Q=0;Q<j.length;Q++){const re=j[Q];let $=!0;for(let ne=0;ne<T.length;ne++)i(re.p,T[ne].p)&&(N!==ne&&F++,$?($=!1,S[ne].push(re)):O=!0);$&&S[N].push(re)}}F>0&&O===!1&&(C=S)}let R;for(let O=0,F=T.length;O<F;O++){d=T[O].s,m.push(d),R=C[O];for(let N=0,G=R.length;N<G;N++)d.holes.push(R[N].h)}return m}}const Td=roe();function roe(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let d=0;d<256;++d){const m=d-127;m<-27?(i[d]=0,i[d|256]=32768,r[d]=24,r[d|256]=24):m<-14?(i[d]=1024>>-m-14,i[d|256]=1024>>-m-14|32768,r[d]=-m-1,r[d|256]=-m-1):m<=15?(i[d]=m+15<<10,i[d|256]=m+15<<10|32768,r[d]=13,r[d|256]=13):m<128?(i[d]=31744,i[d|256]=64512,r[d]=24,r[d|256]=24):(i[d]=31744,i[d|256]=64512,r[d]=13,r[d|256]=13)}const a=new Uint32Array(2048),l=new Uint32Array(64),s=new Uint32Array(64);for(let d=1;d<1024;++d){let m=d<<13,_=0;for(;!(m&8388608);)m<<=1,_-=8388608;m&=-8388609,_+=947912704,a[d]=m|_}for(let d=1024;d<2048;++d)a[d]=939524096+(d-1024<<13);for(let d=1;d<31;++d)l[d]=d<<23;l[31]=1199570944,l[32]=2147483648;for(let d=33;d<63;++d)l[d]=2147483648+(d-32<<23);l[63]=3347054592;for(let d=1;d<64;++d)d!==32&&(s[d]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:a,exponentTable:l,offsetTable:s}}function soe(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Os(n,-65504,65504),Td.floatView[0]=n;const e=Td.uint32View[0],t=e>>23&511;return Td.baseTable[t]+((e&8388607)>>Td.shiftTable[t])}function ooe(n){const e=n>>10;return Td.uint32View[0]=Td.mantissaTable[Td.offsetTable[e]+(n&1023)]+Td.exponentTable[e],Td.floatView[0]}const aoe={toHalfFloat:soe,fromHalfFloat:ooe};class loe extends kp{constructor(e,t,i,r,a,l){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,i,r,a,l)}}class coe extends d1{constructor(e,t,i,r){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,i,r)}}class uoe extends f1{constructor(e,t,i,r){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,i,r)}}class hoe extends p1{constructor(e,t,i,r,a,l,s){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,i,r,a,l,s)}}class doe extends bg{constructor(e,t,i,r,a,l,s,d){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,i,r,a,l,s,d)}}class foe extends m1{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class poe extends g1{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class moe extends _1{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class goe extends Vy{constructor(e,t,i,r){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,i,r)}}class _oe extends Gy{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class yoe extends Ny{constructor(e,t,i,r){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,i,r)}}class xoe extends Zd{constructor(e,t,i,r){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,i,r)}}class voe extends y1{constructor(e,t,i,r,a,l){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,i,r,a,l)}}class woe extends x1{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class boe extends Wy{constructor(e,t,i,r,a,l,s){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,i,r,a,l,s)}}class Soe extends v1{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class Moe extends w1{constructor(e,t,i,r,a){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,i,r,a)}}class Toe extends b1{constructor(e,t,i,r,a,l){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,i,r,a,l)}}class Eoe extends S1{constructor(e,t,i,r,a){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,i,r,a)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:NM}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=NM);const Aoe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:QP,AddEquation:km,AddOperation:g6,AdditiveAnimationBlendMode:nk,AdditiveBlending:MC,AlphaFormat:E6,AlwaysDepth:c6,AlwaysStencilFunc:G6,AmbientLight:VV,AmbientLightProbe:gse,AnimationClip:Bv,AnimationLoader:ise,AnimationMixer:zse,AnimationObjectGroup:Dse,AnimationUtils:Qre,ArcCurve:fV,ArrayCamera:iV,ArrowHelper:toe,Audio:qV,AudioAnalyser:bse,AudioContext:Ik,AudioListener:xse,AudioLoader:pse,AxesHelper:noe,BackSide:nl,BasicDepthPacking:N6,BasicShadowMap:XU,Bone:fk,BooleanKeyframeTrack:Sg,Box2:Vse,Box3:vg,Box3Helper:Qse,BoxBufferGeometry:loe,BoxGeometry:kp,BoxHelper:Kse,BufferAttribute:zr,BufferGeometry:Pi,BufferGeometryLoader:jV,ByteType:w6,Cache:pg,Camera:u1,CameraHelper:Jse,CanvasTexture:Sre,CapsuleBufferGeometry:coe,CapsuleGeometry:d1,CatmullRomCurve3:pV,CineonToneMapping:x6,CircleBufferGeometry:uoe,CircleGeometry:f1,ClampToEdgeWrapping:la,Clock:Pk,Color:zn,ColorKeyframeTrack:Ek,ColorManagement:ia,CompressedArrayTexture:bre,CompressedTexture:mk,CompressedTextureLoader:rse,ConeBufferGeometry:hoe,ConeGeometry:p1,CubeCamera:X6,CubeReflectionMapping:vp,CubeRefractionMapping:wp,CubeTexture:h1,CubeTextureLoader:sse,CubeUVReflectionMapping:By,CubicBezierCurve:_k,CubicBezierCurve3:mV,CubicInterpolant:LV,CullFaceBack:SC,CullFaceFront:$U,CullFaceFrontBack:yK,CullFaceNone:ZU,Curve:Du,CurvePath:_V,CustomBlending:YU,CustomToneMapping:v6,CylinderBufferGeometry:doe,CylinderGeometry:bg,Cylindrical:Use,Data3DTexture:ok,DataArrayTexture:WM,DataTexture:ay,DataTextureLoader:ose,DataUtils:aoe,DecrementStencilOp:kK,DecrementWrapStencilOp:LK,DefaultLoadingManager:OV,DepthFormat:dp,DepthStencilFormat:hg,DepthTexture:rV,DirectionalLight:UV,DirectionalLightHelper:Yse,DiscreteInterpolant:RV,DisplayP3ColorSpace:ik,DodecahedronBufferGeometry:foe,DodecahedronGeometry:m1,DoubleSide:Pd,DstAlphaFactor:i6,DstColorFactor:s6,DynamicCopyUsage:$K,DynamicDrawUsage:GK,DynamicReadUsage:jK,EdgesGeometry:yV,EllipseCurve:JM,EqualDepth:h6,EqualStencilFunc:FK,EquirectangularReflectionMapping:bv,EquirectangularRefractionMapping:Sv,Euler:c1,EventDispatcher:Mh,ExtrudeBufferGeometry:poe,ExtrudeGeometry:g1,FileLoader:jd,Float16BufferAttribute:zQ,Float32BufferAttribute:qn,Float64BufferAttribute:OQ,FloatType:kd,Fog:$M,FogExp2:ZM,FramebufferTexture:wre,FrontSide:Gd,Frustum:HM,GLBufferAttribute:Nse,GLSL1:YK,GLSL3:KC,GreaterDepth:f6,GreaterEqualDepth:d6,GreaterEqualStencilFunc:VK,GreaterStencilFunc:NK,GridHelper:$se,Group:q_,HalfFloatType:Ty,HemisphereLight:FV,HemisphereLightHelper:Zse,HemisphereLightProbe:mse,IcosahedronBufferGeometry:moe,IcosahedronGeometry:_1,ImageBitmapLoader:fse,ImageLoader:Nv,ImageUtils:sk,IncrementStencilOp:PK,IncrementWrapStencilOp:DK,InstancedBufferAttribute:Cy,InstancedBufferGeometry:HV,InstancedInterleavedBuffer:Bse,InstancedMesh:uV,Int16BufferAttribute:LQ,Int32BufferAttribute:RQ,Int8BufferAttribute:PQ,IntType:S6,InterleavedBuffer:XM,InterleavedBufferAttribute:dg,Interpolant:M1,InterpolateDiscrete:Ev,InterpolateLinear:Av,InterpolateSmooth:aS,InvertStencilOp:RK,KeepStencilOp:lS,KeyframeTrack:Lu,LOD:lV,LatheBufferGeometry:goe,LatheGeometry:Vy,Layers:eg,LessDepth:u6,LessEqualDepth:nM,LessEqualStencilFunc:BK,LessStencilFunc:OK,Light:Dp,LightProbe:eT,Line:Sp,Line3:Gse,LineBasicMaterial:ka,LineCurve:KM,LineCurve3:gV,LineDashedMaterial:kV,LineLoop:hV,LineSegments:Th,LinearEncoding:Hd,LinearFilter:zs,LinearInterpolant:Tk,LinearMipMapLinearFilter:SK,LinearMipMapNearestFilter:bK,LinearMipmapLinearFilter:bp,LinearMipmapNearestFilter:ek,LinearSRGBColorSpace:Ey,LinearToneMapping:_6,Loader:Ul,LoaderUtils:oI,LoadingManager:Ak,LoopOnce:O6,LoopPingPong:B6,LoopRepeat:F6,LuminanceAlphaFormat:C6,LuminanceFormat:A6,MOUSE:Cm,Material:No,MaterialLoader:tT,MathUtils:uQ,Matrix3:zo,Matrix4:vi,MaxEquation:CC,Mesh:Oo,MeshBasicMaterial:Pp,MeshDepthMaterial:uk,MeshDistanceMaterial:hk,MeshLambertMaterial:IV,MeshMatcapMaterial:PV,MeshNormalMaterial:CV,MeshPhongMaterial:EV,MeshPhysicalMaterial:TV,MeshStandardMaterial:bk,MeshToonMaterial:AV,MinEquation:AC,MirroredRepeatWrapping:Tv,MixOperation:m6,MultiplyBlending:EC,MultiplyOperation:a1,NearestFilter:Ls,NearestMipMapLinearFilter:wK,NearestMipMapNearestFilter:vK,NearestMipmapLinearFilter:Wx,NearestMipmapNearestFilter:iM,NeverDepth:l6,NeverStencilFunc:zK,NoBlending:Rd,NoColorSpace:AK,NoToneMapping:Au,NormalAnimationBlendMode:GM,NormalBlending:Jm,NotEqualDepth:p6,NotEqualStencilFunc:UK,NumberKeyframeTrack:Ov,Object3D:lr,ObjectLoader:hse,ObjectSpaceNormalMap:V6,OctahedronBufferGeometry:_oe,OctahedronGeometry:Gy,OneFactor:e6,OneMinusDstAlphaFactor:r6,OneMinusDstColorFactor:o6,OneMinusSrcAlphaFactor:KP,OneMinusSrcColorFactor:n6,OrthographicCamera:fp,PCFShadowMap:UM,PCFSoftShadowMap:Gx,PMREMGenerator:eI,Path:Dv,PerspectiveCamera:Yr,Plane:Uf,PlaneBufferGeometry:yoe,PlaneGeometry:Ny,PlaneHelper:eoe,PointLight:NV,PointLightHelper:jse,Points:dV,PointsMaterial:pk,PolarGridHelper:Xse,PolyhedronBufferGeometry:xoe,PolyhedronGeometry:Zd,PositionalAudio:wse,PropertyBinding:sr,PropertyMixer:ZV,QuadraticBezierCurve:yk,QuadraticBezierCurve3:xk,Quaternion:da,QuaternionKeyframeTrack:Hy,QuaternionLinearInterpolant:zV,RED_GREEN_RGTC2_Format:YC,RED_RGTC1_Format:z6,REVISION:NM,RGBADepthPacking:U6,RGBAFormat:$a,RGBAIntegerFormat:L6,RGBA_ASTC_10x10_Format:qC,RGBA_ASTC_10x5_Format:WC,RGBA_ASTC_10x6_Format:HC,RGBA_ASTC_10x8_Format:jC,RGBA_ASTC_12x10_Format:ZC,RGBA_ASTC_12x12_Format:$C,RGBA_ASTC_4x4_Format:zC,RGBA_ASTC_5x4_Format:OC,RGBA_ASTC_5x5_Format:FC,RGBA_ASTC_6x5_Format:BC,RGBA_ASTC_6x6_Format:NC,RGBA_ASTC_8x5_Format:UC,RGBA_ASTC_8x6_Format:VC,RGBA_ASTC_8x8_Format:GC,RGBA_BPTC_Format:oS,RGBA_ETC2_EAC_Format:RC,RGBA_PVRTC_2BPPV1_Format:DC,RGBA_PVRTC_4BPPV1_Format:kC,RGBA_S3TC_DXT1_Format:iS,RGBA_S3TC_DXT3_Format:rS,RGBA_S3TC_DXT5_Format:sS,RGB_ETC1_Format:R6,RGB_ETC2_Format:LC,RGB_PVRTC_2BPPV1_Format:PC,RGB_PVRTC_4BPPV1_Format:IC,RGB_S3TC_DXT1_Format:nS,RGFormat:k6,RGIntegerFormat:D6,RawShaderMaterial:MV,Ray:l1,Raycaster:$V,RectAreaLight:GV,RedFormat:I6,RedIntegerFormat:P6,ReinhardToneMapping:y6,RepeatWrapping:Mv,ReplaceStencilOp:IK,ReverseSubtractEquation:KU,RingBufferGeometry:voe,RingGeometry:y1,SIGNED_RED_GREEN_RGTC2_Format:JC,SIGNED_RED_RGTC1_Format:XC,SRGBColorSpace:yu,Scene:sM,ShaderChunk:Ii,ShaderLib:vu,ShaderMaterial:Sh,ShadowMaterial:SV,Shape:tg,ShapeBufferGeometry:woe,ShapeGeometry:x1,ShapePath:ioe,ShapeUtils:wh,ShortType:b6,Skeleton:YM,SkeletonHelper:Hse,SkinnedMesh:cV,Source:Vm,Sphere:wg,SphereBufferGeometry:boe,SphereGeometry:Wy,Spherical:lI,SphericalHarmonics3:WV,SplineCurve:vk,SpotLight:BV,SpotLightHelper:Wse,Sprite:aV,SpriteMaterial:dk,SrcAlphaFactor:JP,SrcAlphaSaturateFactor:a6,SrcColorFactor:t6,StaticCopyUsage:ZK,StaticDrawUsage:Iv,StaticReadUsage:HK,StereoCamera:_se,StreamCopyUsage:XK,StreamDrawUsage:WK,StreamReadUsage:qK,StringKeyframeTrack:Mg,SubtractEquation:JU,SubtractiveBlending:TC,TOUCH:Im,TangentSpaceNormalMap:Ip,TetrahedronBufferGeometry:Soe,TetrahedronGeometry:v1,Texture:bs,TextureLoader:ase,TorusBufferGeometry:Moe,TorusGeometry:w1,TorusKnotBufferGeometry:Toe,TorusKnotGeometry:b1,Triangle:yc,TriangleFanDrawMode:EK,TriangleStripDrawMode:TK,TrianglesDrawMode:MK,TubeBufferGeometry:Eoe,TubeGeometry:S1,TwoPassDoubleSide:xK,UVMapping:VM,Uint16BufferAttribute:ak,Uint32BufferAttribute:lk,Uint8BufferAttribute:kQ,Uint8ClampedBufferAttribute:DQ,Uniform:Lk,UniformsGroup:Fse,UniformsLib:vn,UniformsUtils:$6,UnsignedByteType:Wd,UnsignedInt248Type:Km,UnsignedIntType:Kf,UnsignedShort4444Type:M6,UnsignedShort5551Type:T6,UnsignedShortType:tk,VSMShadowMap:Bm,Vector2:Ht,Vector3:Fe,Vector4:br,VectorKeyframeTrack:Fv,VideoTexture:vre,WebGL1Renderer:sV,WebGL3DRenderTarget:vQ,WebGLArrayRenderTarget:xQ,WebGLCubeRenderTarget:Y6,WebGLMultipleRenderTargets:wQ,WebGLRenderTarget:Pu,WebGLRenderer:qM,WebGLUtils:nV,WireframeGeometry:bV,WrapAroundEnding:Cv,ZeroCurvatureEnding:Nm,ZeroFactor:QU,ZeroSlopeEnding:Um,ZeroStencilOp:CK,_SRGBAFormat:rM,sRGBEncoding:Ar},Symbol.toStringTag,{value:"Module"}));var ep={},Coe={get exports(){return ep},set exports(n){ep=n}},Tg={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Tg.ConcurrentRoot=1;Tg.ContinuousEventPriority=4;Tg.DefaultEventPriority=16;Tg.DiscreteEventPriority=1;Tg.IdleEventPriority=536870912;Tg.LegacyRoot=0;(function(n){n.exports=Tg})(Coe);function Ioe(n){let e;const t=new Set,i=(m,_)=>{const S=typeof m=="function"?m(e):m;if(S!==e){const T=e;e=_?S:Object.assign({},e,S),t.forEach(C=>C(e,T))}},r=()=>e,a=(m,_=r,S=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let T=_(e);function C(){const P=_(e);if(!S(T,P)){const k=T;m(T=P,k)}}return t.add(C),()=>t.delete(C)},d={setState:i,getState:r,subscribe:(m,_,S)=>_||S?a(m,_,S):(t.add(m),()=>t.delete(m)),destroy:()=>t.clear()};return e=n(i,r,d),d}const Poe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),wF=Poe?$t.useEffect:$t.useLayoutEffect;function koe(n){const e=typeof n=="function"?Ioe(n):n,t=(i=e.getState,r=Object.is)=>{const[,a]=$t.useReducer(R=>R+1,0),l=e.getState(),s=$t.useRef(l),d=$t.useRef(i),m=$t.useRef(r),_=$t.useRef(!1),S=$t.useRef();S.current===void 0&&(S.current=i(l));let T,C=!1;(s.current!==l||d.current!==i||m.current!==r||_.current)&&(T=i(l),C=!r(S.current,T)),wF(()=>{C&&(S.current=T),s.current=l,d.current=i,m.current=r,_.current=!1});const P=$t.useRef(l);wF(()=>{const R=()=>{try{const F=e.getState(),N=d.current(F);m.current(S.current,N)||(s.current=F,S.current=N,a())}catch{_.current=!0,a()}},O=e.subscribe(R);return e.getState()!==P.current&&R(),O},[]);const k=C?T:S.current;return $t.useDebugValue(k),k};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[t,e];return{next(){const r=i.length<=0;return{value:i.shift(),done:r}}}},t}var cI={},Doe={get exports(){return cI},set exports(n){cI=n}},oM={},Loe={get exports(){return oM},set exports(n){oM=n}},OE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bF;function Roe(){return bF||(bF=1,function(n){function e(ce,Te){var Pe=ce.length;ce.push(Te);e:for(;0<Pe;){var Qe=Pe-1>>>1,Ne=ce[Qe];if(0<r(Ne,Te))ce[Qe]=Te,ce[Pe]=Ne,Pe=Qe;else break e}}function t(ce){return ce.length===0?null:ce[0]}function i(ce){if(ce.length===0)return null;var Te=ce[0],Pe=ce.pop();if(Pe!==Te){ce[0]=Pe;e:for(var Qe=0,Ne=ce.length,nt=Ne>>>1;Qe<nt;){var ze=2*(Qe+1)-1,et=ce[ze],Et=ze+1,Nt=ce[Et];if(0>r(et,Pe))Et<Ne&&0>r(Nt,et)?(ce[Qe]=Nt,ce[Et]=Pe,Qe=Et):(ce[Qe]=et,ce[ze]=Pe,Qe=ze);else if(Et<Ne&&0>r(Nt,Pe))ce[Qe]=Nt,ce[Et]=Pe,Qe=Et;else break e}}return Te}function r(ce,Te){var Pe=ce.sortIndex-Te.sortIndex;return Pe!==0?Pe:ce.id-Te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,s=l.now();n.unstable_now=function(){return l.now()-s}}var d=[],m=[],_=1,S=null,T=3,C=!1,P=!1,k=!1,R=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,F=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(ce){for(var Te=t(m);Te!==null;){if(Te.callback===null)i(m);else if(Te.startTime<=ce)i(m),Te.sortIndex=Te.expirationTime,e(d,Te);else break;Te=t(m)}}function G(ce){if(k=!1,N(ce),!P)if(t(d)!==null)P=!0,Oe(j);else{var Te=t(m);Te!==null&&We(G,Te.startTime-ce)}}function j(ce,Te){P=!1,k&&(k=!1,O($),$=-1),C=!0;var Pe=T;try{for(N(Te),S=t(d);S!==null&&(!(S.expirationTime>Te)||ce&&!De());){var Qe=S.callback;if(typeof Qe=="function"){S.callback=null,T=S.priorityLevel;var Ne=Qe(S.expirationTime<=Te);Te=n.unstable_now(),typeof Ne=="function"?S.callback=Ne:S===t(d)&&i(d),N(Te)}else i(d);S=t(d)}if(S!==null)var nt=!0;else{var ze=t(m);ze!==null&&We(G,ze.startTime-Te),nt=!1}return nt}finally{S=null,T=Pe,C=!1}}var Q=!1,re=null,$=-1,ne=5,ue=-1;function De(){return!(n.unstable_now()-ue<ne)}function $e(){if(re!==null){var ce=n.unstable_now();ue=ce;var Te=!0;try{Te=re(!0,ce)}finally{Te?ae():(Q=!1,re=null)}}else Q=!1}var ae;if(typeof F=="function")ae=function(){F($e)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,fe=le.port2;le.port1.onmessage=$e,ae=function(){fe.postMessage(null)}}else ae=function(){R($e,0)};function Oe(ce){re=ce,Q||(Q=!0,ae())}function We(ce,Te){$=R(function(){ce(n.unstable_now())},Te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ce){ce.callback=null},n.unstable_continueExecution=function(){P||C||(P=!0,Oe(j))},n.unstable_forceFrameRate=function(ce){0>ce||125<ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<ce?Math.floor(1e3/ce):5},n.unstable_getCurrentPriorityLevel=function(){return T},n.unstable_getFirstCallbackNode=function(){return t(d)},n.unstable_next=function(ce){switch(T){case 1:case 2:case 3:var Te=3;break;default:Te=T}var Pe=T;T=Te;try{return ce()}finally{T=Pe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ce,Te){switch(ce){case 1:case 2:case 3:case 4:case 5:break;default:ce=3}var Pe=T;T=ce;try{return Te()}finally{T=Pe}},n.unstable_scheduleCallback=function(ce,Te,Pe){var Qe=n.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?Qe+Pe:Qe):Pe=Qe,ce){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=Pe+Ne,ce={id:_++,callback:Te,priorityLevel:ce,startTime:Pe,expirationTime:Ne,sortIndex:-1},Pe>Qe?(ce.sortIndex=Pe,e(m,ce),t(d)===null&&ce===t(m)&&(k?(O($),$=-1):k=!0,We(G,Pe-Qe))):(ce.sortIndex=Ne,e(d,ce),P||C||(P=!0,Oe(j))),ce},n.unstable_shouldYield=De,n.unstable_wrapCallback=function(ce){var Te=T;return function(){var Pe=T;T=Te;try{return ce.apply(this,arguments)}finally{T=Pe}}}}(OE)),OE}var SF;function zoe(){return SF||(SF=1,function(n){n.exports=Roe()}(Loe)),oM}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ooe=function(e){var t={},i=$t,r=zoe(),a=Object.assign;function l(x){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+x,L=1;L<arguments.length;L++)b+="&args[]="+encodeURIComponent(arguments[L]);return"Minified React error #"+x+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,d=Symbol.for("react.element"),m=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),P=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),G=Symbol.for("react.offscreen"),j=Symbol.iterator;function Q(x){return x===null||typeof x!="object"?null:(x=j&&x[j]||x["@@iterator"],typeof x=="function"?x:null)}function re(x){if(x==null)return null;if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case _:return"Fragment";case m:return"Portal";case T:return"Profiler";case S:return"StrictMode";case R:return"Suspense";case O:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case P:return(x.displayName||"Context")+".Consumer";case C:return(x._context.displayName||"Context")+".Provider";case k:var b=x.render;return x=x.displayName,x||(x=b.displayName||b.name||"",x=x!==""?"ForwardRef("+x+")":"ForwardRef"),x;case F:return b=x.displayName||null,b!==null?b:re(x.type)||"Memo";case N:b=x._payload,x=x._init;try{return re(x(b))}catch{}}return null}function $(x){var b=x.type;switch(x.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return x=b.render,x=x.displayName||x.name||"",b.displayName||(x!==""?"ForwardRef("+x+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return re(b);case 8:return b===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function ne(x){var b=x,L=x;if(x.alternate)for(;b.return;)b=b.return;else{x=b;do b=x,b.flags&4098&&(L=b.return),x=b.return;while(x)}return b.tag===3?L:null}function ue(x){if(ne(x)!==x)throw Error(l(188))}function De(x){var b=x.alternate;if(!b){if(b=ne(x),b===null)throw Error(l(188));return b!==x?null:x}for(var L=x,V=b;;){var Z=L.return;if(Z===null)break;var te=Z.alternate;if(te===null){if(V=Z.return,V!==null){L=V;continue}break}if(Z.child===te.child){for(te=Z.child;te;){if(te===L)return ue(Z),x;if(te===V)return ue(Z),b;te=te.sibling}throw Error(l(188))}if(L.return!==V.return)L=Z,V=te;else{for(var Ve=!1,st=Z.child;st;){if(st===L){Ve=!0,L=Z,V=te;break}if(st===V){Ve=!0,V=Z,L=te;break}st=st.sibling}if(!Ve){for(st=te.child;st;){if(st===L){Ve=!0,L=te,V=Z;break}if(st===V){Ve=!0,V=te,L=Z;break}st=st.sibling}if(!Ve)throw Error(l(189))}}if(L.alternate!==V)throw Error(l(190))}if(L.tag!==3)throw Error(l(188));return L.stateNode.current===L?x:b}function $e(x){return x=De(x),x!==null?ae(x):null}function ae(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){var b=ae(x);if(b!==null)return b;x=x.sibling}return null}function le(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){if(x.tag!==4){var b=le(x);if(b!==null)return b}x=x.sibling}return null}var fe=Array.isArray,Oe=e.getPublicInstance,We=e.getRootHostContext,ce=e.getChildHostContext,Te=e.prepareForCommit,Pe=e.resetAfterCommit,Qe=e.createInstance,Ne=e.appendInitialChild,nt=e.finalizeInitialChildren,ze=e.prepareUpdate,et=e.shouldSetTextContent,Et=e.createTextInstance,Nt=e.scheduleTimeout,qt=e.cancelTimeout,wn=e.noTimeout,_n=e.isPrimaryRenderer,Ln=e.supportsMutation,At=e.supportsPersistence,Ot=e.supportsHydration,Ft=e.getInstanceFromNode,An=e.preparePortalMount,pn=e.getCurrentEventPriority,Vn=e.detachDeletedInstance,On=e.supportsMicrotasks,Zn=e.scheduleMicrotask,ai=e.supportsTestSelectors,Ti=e.findFiberRoot,Be=e.getBoundingRect,Se=e.getTextContent,St=e.isHiddenSubtree,tn=e.matchAccessibilityRole,nn=e.setFocusIfFocusable,fn=e.setupIntersectionObserver,Nn=e.appendChild,yn=e.appendChildToContainer,Lt=e.commitTextUpdate,Un=e.commitMount,Ke=e.commitUpdate,It=e.insertBefore,Zt=e.insertInContainerBefore,sn=e.removeChild,Yn=e.removeChildFromContainer,li=e.resetTextContent,Bi=e.hideInstance,rt=e.hideTextInstance,Ct=e.unhideInstance,Vt=e.unhideTextInstance,bn=e.clearContainer,Pn=e.cloneInstance,Ri=e.createContainerChildSet,cr=e.appendChildToContainerChildSet,Or=e.finalizeContainerChildren,Cr=e.replaceContainerChildren,Gi=e.cloneHiddenInstance,Kr=e.cloneHiddenTextInstance,Ee=e.canHydrateInstance,se=e.canHydrateTextInstance,de=e.canHydrateSuspenseInstance,Ie=e.isSuspenseInstancePending,ee=e.isSuspenseInstanceFallback,pe=e.registerSuspenseInstanceRetry,Ae=e.getNextHydratableSibling,ye=e.getFirstHydratableChild,ve=e.getFirstHydratableChildWithinContainer,Je=e.getFirstHydratableChildWithinSuspenseInstance,ht=e.hydrateInstance,zt=e.hydrateTextInstance,vt=e.hydrateSuspenseInstance,Kt=e.getNextHydratableInstanceAfterSuspenseInstance,Yt=e.commitHydratedContainer,Xt=e.commitHydratedSuspenseInstance,gn=e.clearSuspenseBoundary,$n=e.clearSuspenseBoundaryFromContainer,ii=e.shouldDeleteUnhydratedTailInstances,Sn=e.didNotMatchHydratedContainerTextInstance,Kn=e.didNotMatchHydratedTextInstance,kn;function hs(x){if(kn===void 0)try{throw Error()}catch(L){var b=L.stack.trim().match(/\n( *(at )?)/);kn=b&&b[1]||""}return`
`+kn+x}var Qi=!1;function Fr(x,b){if(!x||Qi)return"";Qi=!0;var L=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(ln){var V=ln}Reflect.construct(x,[],b)}else{try{b.call()}catch(ln){V=ln}x.call(b.prototype)}else{try{throw Error()}catch(ln){V=ln}x()}}catch(ln){if(ln&&V&&typeof ln.stack=="string"){for(var Z=ln.stack.split(`
`),te=V.stack.split(`
`),Ve=Z.length-1,st=te.length-1;1<=Ve&&0<=st&&Z[Ve]!==te[st];)st--;for(;1<=Ve&&0<=st;Ve--,st--)if(Z[Ve]!==te[st]){if(Ve!==1||st!==1)do if(Ve--,st--,0>st||Z[Ve]!==te[st]){var pt=`
`+Z[Ve].replace(" at new "," at ");return x.displayName&&pt.includes("<anonymous>")&&(pt=pt.replace("<anonymous>",x.displayName)),pt}while(1<=Ve&&0<=st);break}}}finally{Qi=!1,Error.prepareStackTrace=L}return(x=x?x.displayName||x.name:"")?hs(x):""}var wt=Object.prototype.hasOwnProperty,Ss=[],er=-1;function Ni(x){return{current:x}}function zi(x){0>er||(x.current=Ss[er],Ss[er]=null,er--)}function ci(x,b){er++,Ss[er]=x.current,x.current=b}var yr={},Nr=Ni(yr),qi=Ni(!1),Jt=yr;function ni(x,b){var L=x.type.contextTypes;if(!L)return yr;var V=x.stateNode;if(V&&V.__reactInternalMemoizedUnmaskedChildContext===b)return V.__reactInternalMemoizedMaskedChildContext;var Z={},te;for(te in L)Z[te]=b[te];return V&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=b,x.__reactInternalMemoizedMaskedChildContext=Z),Z}function Jn(x){return x=x.childContextTypes,x!=null}function lo(){zi(qi),zi(Nr)}function Vl(x,b,L){if(Nr.current!==yr)throw Error(l(168));ci(Nr,b),ci(qi,L)}function ri(x,b,L){var V=x.stateNode;if(b=b.childContextTypes,typeof V.getChildContext!="function")return L;V=V.getChildContext();for(var Z in V)if(!(Z in b))throw Error(l(108,$(x)||"Unknown",Z));return a({},L,V)}function Gl(x){return x=(x=x.stateNode)&&x.__reactInternalMemoizedMergedChildContext||yr,Jt=Nr.current,ci(Nr,x),ci(qi,qi.current),!0}function kc(x,b,L){var V=x.stateNode;if(!V)throw Error(l(169));L?(x=ri(x,b,Jt),V.__reactInternalMemoizedMergedChildContext=x,zi(qi),zi(Nr),ci(Nr,x)):zi(qi),ci(qi,L)}var ds=Math.clz32?Math.clz32:Da,Ms=Math.log,xr=Math.LN2;function Da(x){return x>>>=0,x===0?32:31-(Ms(x)/xr|0)|0}var Wl=64,Hl=4194304;function il(x){switch(x&-x){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return x&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return x}}function jl(x,b){var L=x.pendingLanes;if(L===0)return 0;var V=0,Z=x.suspendedLanes,te=x.pingedLanes,Ve=L&268435455;if(Ve!==0){var st=Ve&~Z;st!==0?V=il(st):(te&=Ve,te!==0&&(V=il(te)))}else Ve=L&~Z,Ve!==0?V=il(Ve):te!==0&&(V=il(te));if(V===0)return 0;if(b!==0&&b!==V&&!(b&Z)&&(Z=V&-V,te=b&-b,Z>=te||Z===16&&(te&4194240)!==0))return b;if(V&4&&(V|=L&16),b=x.entangledLanes,b!==0)for(x=x.entanglements,b&=V;0<b;)L=31-ds(b),Z=1<<L,V|=x[L],b&=~Z;return V}function Lp(x,b){switch(x){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ql(x,b){for(var L=x.suspendedLanes,V=x.pingedLanes,Z=x.expirationTimes,te=x.pendingLanes;0<te;){var Ve=31-ds(te),st=1<<Ve,pt=Z[Ve];pt===-1?(!(st&L)||st&V)&&(Z[Ve]=Lp(st,b)):pt<=b&&(x.expiredLanes|=st),te&=~st}}function Dc(x){return x=x.pendingLanes&-1073741825,x!==0?x:x&1073741824?1073741824:0}function Ru(x){for(var b=[],L=0;31>L;L++)b.push(x);return b}function Lc(x,b,L){x.pendingLanes|=b,b!==536870912&&(x.suspendedLanes=0,x.pingedLanes=0),x=x.eventTimes,b=31-ds(b),x[b]=L}function co(x,b){var L=x.pendingLanes&~b;x.pendingLanes=b,x.suspendedLanes=0,x.pingedLanes=0,x.expiredLanes&=b,x.mutableReadLanes&=b,x.entangledLanes&=b,b=x.entanglements;var V=x.eventTimes;for(x=x.expirationTimes;0<L;){var Z=31-ds(L),te=1<<Z;b[Z]=0,V[Z]=-1,x[Z]=-1,L&=~te}}function vr(x,b){var L=x.entangledLanes|=b;for(x=x.entanglements;L;){var V=31-ds(L),Z=1<<V;Z&b|x[V]&b&&(x[V]|=b),L&=~Z}}var Ei=0;function $d(x){return x&=-x,1<x?4<x?x&268435455?16:536870912:4:1}var Qr=r.unstable_scheduleCallback,To=r.unstable_cancelCallback,Eg=r.unstable_shouldYield,Xd=r.unstable_requestPaint,wi=r.unstable_now,Rc=r.unstable_ImmediatePriority,Rp=r.unstable_UserBlockingPriority,zc=r.unstable_NormalPriority,fs=r.unstable_IdlePriority,rl=null,Uo=null;function sl(x){if(Uo&&typeof Uo.onCommitFiberRoot=="function")try{Uo.onCommitFiberRoot(rl,x,void 0,(x.current.flags&128)===128)}catch{}}function Eh(x,b){return x===b&&(x!==0||1/x===1/b)||x!==x&&b!==b}var Eo=typeof Object.is=="function"?Object.is:Eh,ol=null,zu=!1,al=!1;function Ah(x){ol===null?ol=[x]:ol.push(x)}function Ag(x){zu=!0,Ah(x)}function qs(){if(!al&&ol!==null){al=!0;var x=0,b=Ei;try{var L=ol;for(Ei=1;x<L.length;x++){var V=L[x];do V=V(!0);while(V!==null)}ol=null,zu=!1}catch(Z){throw ol!==null&&(ol=ol.slice(x+1)),Qr(Rc,qs),Z}finally{Ei=b,al=!1}}return null}var Zl=s.ReactCurrentBatchConfig;function Oc(x,b){if(Eo(x,b))return!0;if(typeof x!="object"||x===null||typeof b!="object"||b===null)return!1;var L=Object.keys(x),V=Object.keys(b);if(L.length!==V.length)return!1;for(V=0;V<L.length;V++){var Z=L[V];if(!wt.call(b,Z)||!Eo(x[Z],b[Z]))return!1}return!0}function Ts(x){switch(x.tag){case 5:return hs(x.type);case 16:return hs("Lazy");case 13:return hs("Suspense");case 19:return hs("SuspenseList");case 0:case 2:case 15:return x=Fr(x.type,!1),x;case 11:return x=Fr(x.type.render,!1),x;case 1:return x=Fr(x.type,!0),x;default:return""}}function uo(x,b){if(x&&x.defaultProps){b=a({},b),x=x.defaultProps;for(var L in x)b[L]===void 0&&(b[L]=x[L]);return b}return b}var $l=Ni(null),Ch=null,Fc=null,Ou=null;function Yd(){Ou=Fc=Ch=null}function Ih(x,b,L){_n?(ci($l,b._currentValue),b._currentValue=L):(ci($l,b._currentValue2),b._currentValue2=L)}function Bc(x){var b=$l.current;zi($l),_n?x._currentValue=b:x._currentValue2=b}function Ph(x,b,L){for(;x!==null;){var V=x.alternate;if((x.childLanes&b)!==b?(x.childLanes|=b,V!==null&&(V.childLanes|=b)):V!==null&&(V.childLanes&b)!==b&&(V.childLanes|=b),x===L)break;x=x.return}}function Nc(x,b){Ch=x,Ou=Fc=null,x=x.dependencies,x!==null&&x.firstContext!==null&&(x.lanes&b&&(Io=!0),x.firstContext=null)}function Fs(x){var b=_n?x._currentValue:x._currentValue2;if(Ou!==x)if(x={context:x,memoizedValue:b,next:null},Fc===null){if(Ch===null)throw Error(l(308));Fc=x,Ch.dependencies={lanes:0,firstContext:x}}else Fc=Fc.next=x;return b}var Vo=null,ho=!1;function Ai(x){x.updateQueue={baseState:x.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zp(x,b){x=x.updateQueue,b.updateQueue===x&&(b.updateQueue={baseState:x.baseState,firstBaseUpdate:x.firstBaseUpdate,lastBaseUpdate:x.lastBaseUpdate,shared:x.shared,effects:x.effects})}function Ao(x,b){return{eventTime:x,lane:b,tag:0,payload:null,callback:null,next:null}}function La(x,b){var L=x.updateQueue;L!==null&&(L=L.shared,at!==null&&x.mode&1&&!(Ye&2)?(x=L.interleaved,x===null?(b.next=b,Vo===null?Vo=[L]:Vo.push(L)):(b.next=x.next,x.next=b),L.interleaved=b):(x=L.pending,x===null?b.next=b:(b.next=x.next,x.next=b),L.pending=b))}function ll(x,b,L){if(b=b.updateQueue,b!==null&&(b=b.shared,(L&4194240)!==0)){var V=b.lanes;V&=x.pendingLanes,L|=V,b.lanes=L,vr(x,L)}}function kh(x,b){var L=x.updateQueue,V=x.alternate;if(V!==null&&(V=V.updateQueue,L===V)){var Z=null,te=null;if(L=L.firstBaseUpdate,L!==null){do{var Ve={eventTime:L.eventTime,lane:L.lane,tag:L.tag,payload:L.payload,callback:L.callback,next:null};te===null?Z=te=Ve:te=te.next=Ve,L=L.next}while(L!==null);te===null?Z=te=b:te=te.next=b}else Z=te=b;L={baseState:V.baseState,firstBaseUpdate:Z,lastBaseUpdate:te,shared:V.shared,effects:V.effects},x.updateQueue=L;return}x=L.lastBaseUpdate,x===null?L.firstBaseUpdate=b:x.next=b,L.lastBaseUpdate=b}function Xl(x,b,L,V){var Z=x.updateQueue;ho=!1;var te=Z.firstBaseUpdate,Ve=Z.lastBaseUpdate,st=Z.shared.pending;if(st!==null){Z.shared.pending=null;var pt=st,ln=pt.next;pt.next=null,Ve===null?te=ln:Ve.next=ln,Ve=pt;var Dn=x.alternate;Dn!==null&&(Dn=Dn.updateQueue,st=Dn.lastBaseUpdate,st!==Ve&&(st===null?Dn.firstBaseUpdate=ln:st.next=ln,Dn.lastBaseUpdate=pt))}if(te!==null){var Qn=Z.baseState;Ve=0,Dn=ln=pt=null,st=te;do{var Gn=st.lane,Ci=st.eventTime;if((V&Gn)===Gn){Dn!==null&&(Dn=Dn.next={eventTime:Ci,lane:0,tag:st.tag,payload:st.payload,callback:st.callback,next:null});e:{var In=x,Hi=st;switch(Gn=b,Ci=L,Hi.tag){case 1:if(In=Hi.payload,typeof In=="function"){Qn=In.call(Ci,Qn,Gn);break e}Qn=In;break e;case 3:In.flags=In.flags&-65537|128;case 0:if(In=Hi.payload,Gn=typeof In=="function"?In.call(Ci,Qn,Gn):In,Gn==null)break e;Qn=a({},Qn,Gn);break e;case 2:ho=!0}}st.callback!==null&&st.lane!==0&&(x.flags|=64,Gn=Z.effects,Gn===null?Z.effects=[st]:Gn.push(st))}else Ci={eventTime:Ci,lane:Gn,tag:st.tag,payload:st.payload,callback:st.callback,next:null},Dn===null?(ln=Dn=Ci,pt=Qn):Dn=Dn.next=Ci,Ve|=Gn;if(st=st.next,st===null){if(st=Z.shared.pending,st===null)break;Gn=st,st=Gn.next,Gn.next=null,Z.lastBaseUpdate=Gn,Z.shared.pending=null}}while(1);if(Dn===null&&(pt=Qn),Z.baseState=pt,Z.firstBaseUpdate=ln,Z.lastBaseUpdate=Dn,b=Z.shared.interleaved,b!==null){Z=b;do Ve|=Z.lane,Z=Z.next;while(Z!==b)}else te===null&&(Z.shared.lanes=0);an|=Ve,x.lanes=Ve,x.memoizedState=Qn}}function Dh(x,b,L){if(x=b.effects,b.effects=null,x!==null)for(b=0;b<x.length;b++){var V=x[b],Z=V.callback;if(Z!==null){if(V.callback=null,V=L,typeof Z!="function")throw Error(l(191,Z));Z.call(V)}}}var Jd=new i.Component().refs;function Fu(x,b,L,V){b=x.memoizedState,L=L(V,b),L=L==null?b:a({},b,L),x.memoizedState=L,x.lanes===0&&(x.updateQueue.baseState=L)}var Ra={isMounted:function(x){return(x=x._reactInternals)?ne(x)===x:!1},enqueueSetState:function(x,b,L){x=x._reactInternals;var V=$i(),Z=ns(x),te=Ao(V,Z);te.payload=b,L!=null&&(te.callback=L),La(x,te),b=Ur(x,Z,V),b!==null&&ll(b,x,Z)},enqueueReplaceState:function(x,b,L){x=x._reactInternals;var V=$i(),Z=ns(x),te=Ao(V,Z);te.tag=1,te.payload=b,L!=null&&(te.callback=L),La(x,te),b=Ur(x,Z,V),b!==null&&ll(b,x,Z)},enqueueForceUpdate:function(x,b){x=x._reactInternals;var L=$i(),V=ns(x),Z=Ao(L,V);Z.tag=2,b!=null&&(Z.callback=b),La(x,Z),b=Ur(x,V,L),b!==null&&ll(b,x,V)}};function Uc(x,b,L,V,Z,te,Ve){return x=x.stateNode,typeof x.shouldComponentUpdate=="function"?x.shouldComponentUpdate(V,te,Ve):b.prototype&&b.prototype.isPureReactComponent?!Oc(L,V)||!Oc(Z,te):!0}function Lh(x,b,L){var V=!1,Z=yr,te=b.contextType;return typeof te=="object"&&te!==null?te=Fs(te):(Z=Jn(b)?Jt:Nr.current,V=b.contextTypes,te=(V=V!=null)?ni(x,Z):yr),b=new b(L,te),x.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Ra,x.stateNode=b,b._reactInternals=x,V&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=Z,x.__reactInternalMemoizedMaskedChildContext=te),b}function Bu(x,b,L,V){x=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(L,V),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(L,V),b.state!==x&&Ra.enqueueReplaceState(b,b.state,null)}function Nu(x,b,L,V){var Z=x.stateNode;Z.props=L,Z.state=x.memoizedState,Z.refs=Jd,Ai(x);var te=b.contextType;typeof te=="object"&&te!==null?Z.context=Fs(te):(te=Jn(b)?Jt:Nr.current,Z.context=ni(x,te)),Z.state=x.memoizedState,te=b.getDerivedStateFromProps,typeof te=="function"&&(Fu(x,b,te,L),Z.state=x.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof Z.getSnapshotBeforeUpdate=="function"||typeof Z.UNSAFE_componentWillMount!="function"&&typeof Z.componentWillMount!="function"||(b=Z.state,typeof Z.componentWillMount=="function"&&Z.componentWillMount(),typeof Z.UNSAFE_componentWillMount=="function"&&Z.UNSAFE_componentWillMount(),b!==Z.state&&Ra.enqueueReplaceState(Z,Z.state,null),Xl(x,L,Z,V),Z.state=x.memoizedState),typeof Z.componentDidMount=="function"&&(x.flags|=4194308)}var hi=[],cl=0,Uu=null,Rh=0,fo=[],Zs=0,Yl=null,za=1,ul="";function Oa(x,b){hi[cl++]=Rh,hi[cl++]=Uu,Uu=x,Rh=b}function zh(x,b,L){fo[Zs++]=za,fo[Zs++]=ul,fo[Zs++]=Yl,Yl=x;var V=za;x=ul;var Z=32-ds(V)-1;V&=~(1<<Z),L+=1;var te=32-ds(b)+Z;if(30<te){var Ve=Z-Z%5;te=(V&(1<<Ve)-1).toString(32),V>>=Ve,Z-=Ve,za=1<<32-ds(b)+Z|L<<Z|V,ul=te+x}else za=1<<te|L<<Z|V,ul=x}function Oh(x){x.return!==null&&(Oa(x,1),zh(x,1,0))}function Fh(x){for(;x===Uu;)Uu=hi[--cl],hi[cl]=null,Rh=hi[--cl],hi[cl]=null;for(;x===Yl;)Yl=fo[--Zs],fo[Zs]=null,ul=fo[--Zs],fo[Zs]=null,za=fo[--Zs],fo[Zs]=null}var po=null,mo=null,Mr=!1,hl=!1,Bs=null;function Op(x,b){var L=xa(5,null,null,0);L.elementType="DELETED",L.stateNode=b,L.return=x,b=x.deletions,b===null?(x.deletions=[L],x.flags|=16):b.push(L)}function Bh(x,b){switch(x.tag){case 5:return b=Ee(b,x.type,x.pendingProps),b!==null?(x.stateNode=b,po=x,mo=ye(b),!0):!1;case 6:return b=se(b,x.pendingProps),b!==null?(x.stateNode=b,po=x,mo=null,!0):!1;case 13:if(b=de(b),b!==null){var L=Yl!==null?{id:za,overflow:ul}:null;return x.memoizedState={dehydrated:b,treeContext:L,retryLane:1073741824},L=xa(18,null,null,0),L.stateNode=b,L.return=x,x.child=L,po=x,mo=null,!0}return!1;default:return!1}}function Nh(x){return(x.mode&1)!==0&&(x.flags&128)===0}function Go(x){if(Mr){var b=mo;if(b){var L=b;if(!Bh(x,b)){if(Nh(x))throw Error(l(418));b=Ae(L);var V=po;b&&Bh(x,b)?Op(V,L):(x.flags=x.flags&-4097|2,Mr=!1,po=x)}}else{if(Nh(x))throw Error(l(418));x.flags=x.flags&-4097|2,Mr=!1,po=x}}}function Uh(x){for(x=x.return;x!==null&&x.tag!==5&&x.tag!==3&&x.tag!==13;)x=x.return;po=x}function Vc(x){if(!Ot||x!==po)return!1;if(!Mr)return Uh(x),Mr=!0,!1;if(x.tag!==3&&(x.tag!==5||ii(x.type)&&!et(x.type,x.memoizedProps))){var b=mo;if(b){if(Nh(x)){for(x=mo;x;)x=Ae(x);throw Error(l(418))}for(;b;)Op(x,b),b=Ae(b)}}if(Uh(x),x.tag===13){if(!Ot)throw Error(l(316));if(x=x.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(l(317));mo=Kt(x)}else mo=po?Ae(x.stateNode):null;return!0}function dl(){Ot&&(mo=po=null,hl=Mr=!1)}function Kd(x){Bs===null?Bs=[x]:Bs.push(x)}function Gc(x,b,L){if(x=L.ref,x!==null&&typeof x!="function"&&typeof x!="object"){if(L._owner){if(L=L._owner,L){if(L.tag!==1)throw Error(l(309));var V=L.stateNode}if(!V)throw Error(l(147,x));var Z=V,te=""+x;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===te?b.ref:(b=function(Ve){var st=Z.refs;st===Jd&&(st=Z.refs={}),Ve===null?delete st[te]:st[te]=Ve},b._stringRef=te,b)}if(typeof x!="string")throw Error(l(284));if(!L._owner)throw Error(l(290,x))}return x}function Vh(x,b){throw x=Object.prototype.toString.call(b),Error(l(31,x==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":x))}function Gh(x){var b=x._init;return b(x._payload)}function Fp(x){function b(_t,ct){if(x){var Mt=_t.deletions;Mt===null?(_t.deletions=[ct],_t.flags|=16):Mt.push(ct)}}function L(_t,ct){if(!x)return null;for(;ct!==null;)b(_t,ct),ct=ct.sibling;return null}function V(_t,ct){for(_t=new Map;ct!==null;)ct.key!==null?_t.set(ct.key,ct):_t.set(ct.index,ct),ct=ct.sibling;return _t}function Z(_t,ct){return _t=nh(_t,ct),_t.index=0,_t.sibling=null,_t}function te(_t,ct,Mt){return _t.index=Mt,x?(Mt=_t.alternate,Mt!==null?(Mt=Mt.index,Mt<ct?(_t.flags|=2,ct):Mt):(_t.flags|=2,ct)):(_t.flags|=1048576,ct)}function Ve(_t){return x&&_t.alternate===null&&(_t.flags|=2),_t}function st(_t,ct,Mt,Mn){return ct===null||ct.tag!==6?(ct=bl(Mt,_t.mode,Mn),ct.return=_t,ct):(ct=Z(ct,Mt),ct.return=_t,ct)}function pt(_t,ct,Mt,Mn){var Hn=Mt.type;return Hn===_?Dn(_t,ct,Mt.props.children,Mn,Mt.key):ct!==null&&(ct.elementType===Hn||typeof Hn=="object"&&Hn!==null&&Hn.$$typeof===N&&Gh(Hn)===ct.type)?(Mn=Z(ct,Mt.props),Mn.ref=Gc(_t,ct,Mt),Mn.return=_t,Mn):(Mn=yf(Mt.type,Mt.key,Mt.props,null,_t.mode,Mn),Mn.ref=Gc(_t,ct,Mt),Mn.return=_t,Mn)}function ln(_t,ct,Mt,Mn){return ct===null||ct.tag!==4||ct.stateNode.containerInfo!==Mt.containerInfo||ct.stateNode.implementation!==Mt.implementation?(ct=va(Mt,_t.mode,Mn),ct.return=_t,ct):(ct=Z(ct,Mt.children||[]),ct.return=_t,ct)}function Dn(_t,ct,Mt,Mn,Hn){return ct===null||ct.tag!==7?(ct=wl(Mt,_t.mode,Mn,Hn),ct.return=_t,ct):(ct=Z(ct,Mt),ct.return=_t,ct)}function Qn(_t,ct,Mt){if(typeof ct=="string"&&ct!==""||typeof ct=="number")return ct=bl(""+ct,_t.mode,Mt),ct.return=_t,ct;if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case d:return Mt=yf(ct.type,ct.key,ct.props,null,_t.mode,Mt),Mt.ref=Gc(_t,null,ct),Mt.return=_t,Mt;case m:return ct=va(ct,_t.mode,Mt),ct.return=_t,ct;case N:var Mn=ct._init;return Qn(_t,Mn(ct._payload),Mt)}if(fe(ct)||Q(ct))return ct=wl(ct,_t.mode,Mt,null),ct.return=_t,ct;Vh(_t,ct)}return null}function Gn(_t,ct,Mt,Mn){var Hn=ct!==null?ct.key:null;if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number")return Hn!==null?null:st(_t,ct,""+Mt,Mn);if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case d:return Mt.key===Hn?pt(_t,ct,Mt,Mn):null;case m:return Mt.key===Hn?ln(_t,ct,Mt,Mn):null;case N:return Hn=Mt._init,Gn(_t,ct,Hn(Mt._payload),Mn)}if(fe(Mt)||Q(Mt))return Hn!==null?null:Dn(_t,ct,Mt,Mn,null);Vh(_t,Mt)}return null}function Ci(_t,ct,Mt,Mn,Hn){if(typeof Mn=="string"&&Mn!==""||typeof Mn=="number")return _t=_t.get(Mt)||null,st(ct,_t,""+Mn,Hn);if(typeof Mn=="object"&&Mn!==null){switch(Mn.$$typeof){case d:return _t=_t.get(Mn.key===null?Mt:Mn.key)||null,pt(ct,_t,Mn,Hn);case m:return _t=_t.get(Mn.key===null?Mt:Mn.key)||null,ln(ct,_t,Mn,Hn);case N:var pi=Mn._init;return Ci(_t,ct,Mt,pi(Mn._payload),Hn)}if(fe(Mn)||Q(Mn))return _t=_t.get(Mt)||null,Dn(ct,_t,Mn,Hn,null);Vh(ct,Mn)}return null}function In(_t,ct,Mt,Mn){for(var Hn=null,pi=null,di=ct,Ui=ct=0,Is=null;di!==null&&Ui<Mt.length;Ui++){di.index>Ui?(Is=di,di=null):Is=di.sibling;var Xi=Gn(_t,di,Mt[Ui],Mn);if(Xi===null){di===null&&(di=Is);break}x&&di&&Xi.alternate===null&&b(_t,di),ct=te(Xi,ct,Ui),pi===null?Hn=Xi:pi.sibling=Xi,pi=Xi,di=Is}if(Ui===Mt.length)return L(_t,di),Mr&&Oa(_t,Ui),Hn;if(di===null){for(;Ui<Mt.length;Ui++)di=Qn(_t,Mt[Ui],Mn),di!==null&&(ct=te(di,ct,Ui),pi===null?Hn=di:pi.sibling=di,pi=di);return Mr&&Oa(_t,Ui),Hn}for(di=V(_t,di);Ui<Mt.length;Ui++)Is=Ci(di,_t,Ui,Mt[Ui],Mn),Is!==null&&(x&&Is.alternate!==null&&di.delete(Is.key===null?Ui:Is.key),ct=te(Is,ct,Ui),pi===null?Hn=Is:pi.sibling=Is,pi=Is);return x&&di.forEach(function(xo){return b(_t,xo)}),Mr&&Oa(_t,Ui),Hn}function Hi(_t,ct,Mt,Mn){var Hn=Q(Mt);if(typeof Hn!="function")throw Error(l(150));if(Mt=Hn.call(Mt),Mt==null)throw Error(l(151));for(var pi=Hn=null,di=ct,Ui=ct=0,Is=null,Xi=Mt.next();di!==null&&!Xi.done;Ui++,Xi=Mt.next()){di.index>Ui?(Is=di,di=null):Is=di.sibling;var xo=Gn(_t,di,Xi.value,Mn);if(xo===null){di===null&&(di=Is);break}x&&di&&xo.alternate===null&&b(_t,di),ct=te(xo,ct,Ui),pi===null?Hn=xo:pi.sibling=xo,pi=xo,di=Is}if(Xi.done)return L(_t,di),Mr&&Oa(_t,Ui),Hn;if(di===null){for(;!Xi.done;Ui++,Xi=Mt.next())Xi=Qn(_t,Xi.value,Mn),Xi!==null&&(ct=te(Xi,ct,Ui),pi===null?Hn=Xi:pi.sibling=Xi,pi=Xi);return Mr&&Oa(_t,Ui),Hn}for(di=V(_t,di);!Xi.done;Ui++,Xi=Mt.next())Xi=Ci(di,_t,Ui,Xi.value,Mn),Xi!==null&&(x&&Xi.alternate!==null&&di.delete(Xi.key===null?Ui:Xi.key),ct=te(Xi,ct,Ui),pi===null?Hn=Xi:pi.sibling=Xi,pi=Xi);return x&&di.forEach(function(rd){return b(_t,rd)}),Mr&&Oa(_t,Ui),Hn}function wa(_t,ct,Mt,Mn){if(typeof Mt=="object"&&Mt!==null&&Mt.type===_&&Mt.key===null&&(Mt=Mt.props.children),typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case d:e:{for(var Hn=Mt.key,pi=ct;pi!==null;){if(pi.key===Hn){if(Hn=Mt.type,Hn===_){if(pi.tag===7){L(_t,pi.sibling),ct=Z(pi,Mt.props.children),ct.return=_t,_t=ct;break e}}else if(pi.elementType===Hn||typeof Hn=="object"&&Hn!==null&&Hn.$$typeof===N&&Gh(Hn)===pi.type){L(_t,pi.sibling),ct=Z(pi,Mt.props),ct.ref=Gc(_t,pi,Mt),ct.return=_t,_t=ct;break e}L(_t,pi);break}else b(_t,pi);pi=pi.sibling}Mt.type===_?(ct=wl(Mt.props.children,_t.mode,Mn,Mt.key),ct.return=_t,_t=ct):(Mn=yf(Mt.type,Mt.key,Mt.props,null,_t.mode,Mn),Mn.ref=Gc(_t,ct,Mt),Mn.return=_t,_t=Mn)}return Ve(_t);case m:e:{for(pi=Mt.key;ct!==null;){if(ct.key===pi)if(ct.tag===4&&ct.stateNode.containerInfo===Mt.containerInfo&&ct.stateNode.implementation===Mt.implementation){L(_t,ct.sibling),ct=Z(ct,Mt.children||[]),ct.return=_t,_t=ct;break e}else{L(_t,ct);break}else b(_t,ct);ct=ct.sibling}ct=va(Mt,_t.mode,Mn),ct.return=_t,_t=ct}return Ve(_t);case N:return pi=Mt._init,wa(_t,ct,pi(Mt._payload),Mn)}if(fe(Mt))return In(_t,ct,Mt,Mn);if(Q(Mt))return Hi(_t,ct,Mt,Mn);Vh(_t,Mt)}return typeof Mt=="string"&&Mt!==""||typeof Mt=="number"?(Mt=""+Mt,ct!==null&&ct.tag===6?(L(_t,ct.sibling),ct=Z(ct,Mt),ct.return=_t,_t=ct):(L(_t,ct),ct=bl(Mt,_t.mode,Mn),ct.return=_t,_t=ct),Ve(_t)):L(_t,ct)}return wa}var fl=Fp(!0),Cg=Fp(!1),Wc={},Wo=Ni(Wc),Fa=Ni(Wc),Hc=Ni(Wc);function go(x){if(x===Wc)throw Error(l(174));return x}function Bp(x,b){ci(Hc,b),ci(Fa,x),ci(Wo,Wc),x=We(b),zi(Wo),ci(Wo,x)}function jc(){zi(Wo),zi(Fa),zi(Hc)}function Np(x){var b=go(Hc.current),L=go(Wo.current);b=ce(L,x.type,b),L!==b&&(ci(Fa,x),ci(Wo,b))}function pl(x){Fa.current===x&&(zi(Wo),zi(Fa))}var Tr=Ni(0);function Wh(x){for(var b=x;b!==null;){if(b.tag===13){var L=b.memoizedState;if(L!==null&&(L=L.dehydrated,L===null||Ie(L)||ee(L)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if(b.flags&128)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var Hh=[];function Up(){for(var x=0;x<Hh.length;x++){var b=Hh[x];_n?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}Hh.length=0}var Qd=s.ReactCurrentDispatcher,Ho=s.ReactCurrentBatchConfig,Jl=0,Er=null,Es=null,es=null,Vu=!1,Kl=!1,_o=0,jh=0;function As(){throw Error(l(321))}function $s(x,b){if(b===null)return!1;for(var L=0;L<b.length&&L<x.length;L++)if(!Eo(x[L],b[L]))return!1;return!0}function ml(x,b,L,V,Z,te){if(Jl=te,Er=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,Qd.current=x===null||x.memoizedState===null?ju:Hp,x=L(V,Z),Kl){te=0;do{if(Kl=!1,_o=0,25<=te)throw Error(l(301));te+=1,es=Es=null,b.updateQueue=null,Qd.current=af,x=L(V,Z)}while(Kl)}if(Qd.current=Zh,b=Es!==null&&Es.next!==null,Jl=0,es=Es=Er=null,Vu=!1,b)throw Error(l(300));return x}function gl(){var x=_o!==0;return _o=0,x}function ma(){var x={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return es===null?Er.memoizedState=es=x:es=es.next=x,es}function oi(){if(Es===null){var x=Er.alternate;x=x!==null?x.memoizedState:null}else x=Es.next;var b=es===null?Er.memoizedState:es.next;if(b!==null)es=b,Es=x;else{if(x===null)throw Error(l(310));Es=x,x={memoizedState:Es.memoizedState,baseState:Es.baseState,baseQueue:Es.baseQueue,queue:Es.queue,next:null},es===null?Er.memoizedState=es=x:es=es.next=x}return es}function ga(x,b){return typeof b=="function"?b(x):b}function ef(x){var b=oi(),L=b.queue;if(L===null)throw Error(l(311));L.lastRenderedReducer=x;var V=Es,Z=V.baseQueue,te=L.pending;if(te!==null){if(Z!==null){var Ve=Z.next;Z.next=te.next,te.next=Ve}V.baseQueue=Z=te,L.pending=null}if(Z!==null){te=Z.next,V=V.baseState;var st=Ve=null,pt=null,ln=te;do{var Dn=ln.lane;if((Jl&Dn)===Dn)pt!==null&&(pt=pt.next={lane:0,action:ln.action,hasEagerState:ln.hasEagerState,eagerState:ln.eagerState,next:null}),V=ln.hasEagerState?ln.eagerState:x(V,ln.action);else{var Qn={lane:Dn,action:ln.action,hasEagerState:ln.hasEagerState,eagerState:ln.eagerState,next:null};pt===null?(st=pt=Qn,Ve=V):pt=pt.next=Qn,Er.lanes|=Dn,an|=Dn}ln=ln.next}while(ln!==null&&ln!==te);pt===null?Ve=V:pt.next=st,Eo(V,b.memoizedState)||(Io=!0),b.memoizedState=V,b.baseState=Ve,b.baseQueue=pt,L.lastRenderedState=V}if(x=L.interleaved,x!==null){Z=x;do te=Z.lane,Er.lanes|=te,an|=te,Z=Z.next;while(Z!==x)}else Z===null&&(L.lanes=0);return[b.memoizedState,L.dispatch]}function qc(x){var b=oi(),L=b.queue;if(L===null)throw Error(l(311));L.lastRenderedReducer=x;var V=L.dispatch,Z=L.pending,te=b.memoizedState;if(Z!==null){L.pending=null;var Ve=Z=Z.next;do te=x(te,Ve.action),Ve=Ve.next;while(Ve!==Z);Eo(te,b.memoizedState)||(Io=!0),b.memoizedState=te,b.baseQueue===null&&(b.baseState=te),L.lastRenderedState=te}return[te,V]}function Zc(){}function tf(x,b){var L=Er,V=oi(),Z=b(),te=!Eo(V.memoizedState,Z);if(te&&(V.memoizedState=Z,Io=!0),V=V.queue,yl(rf.bind(null,L,V,x),[x]),V.getSnapshot!==b||te||es!==null&&es.memoizedState.tag&1){if(L.flags|=2048,jo(9,nf.bind(null,L,V,Z,b),void 0,null),at===null)throw Error(l(349));Jl&30||Vp(L,b,Z)}return Z}function Vp(x,b,L){x.flags|=16384,x={getSnapshot:b,value:L},b=Er.updateQueue,b===null?(b={lastEffect:null,stores:null},Er.updateQueue=b,b.stores=[x]):(L=b.stores,L===null?b.stores=[x]:L.push(x))}function nf(x,b,L,V){b.value=L,b.getSnapshot=V,qh(b)&&Ur(x,1,-1)}function rf(x,b,L){return L(function(){qh(b)&&Ur(x,1,-1)})}function qh(x){var b=x.getSnapshot;x=x.value;try{var L=b();return!Eo(x,L)}catch{return!0}}function $c(x){var b=ma();return typeof x=="function"&&(x=x()),b.memoizedState=b.baseState=x,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:x},b.queue=x,x=x.dispatch=yo.bind(null,Er,x),[b.memoizedState,x]}function jo(x,b,L,V){return x={tag:x,create:b,destroy:L,deps:V,next:null},b=Er.updateQueue,b===null?(b={lastEffect:null,stores:null},Er.updateQueue=b,b.lastEffect=x.next=x):(L=b.lastEffect,L===null?b.lastEffect=x.next=x:(V=L.next,L.next=x,x.next=V,b.lastEffect=x)),x}function _l(){return oi().memoizedState}function Xc(x,b,L,V){var Z=ma();Er.flags|=x,Z.memoizedState=jo(1|b,L,void 0,V===void 0?null:V)}function Gu(x,b,L,V){var Z=oi();V=V===void 0?null:V;var te=void 0;if(Es!==null){var Ve=Es.memoizedState;if(te=Ve.destroy,V!==null&&$s(V,Ve.deps)){Z.memoizedState=jo(b,L,te,V);return}}Er.flags|=x,Z.memoizedState=jo(1|b,L,te,V)}function Ql(x,b){return Xc(8390656,8,x,b)}function yl(x,b){return Gu(2048,8,x,b)}function hn(x,b){return Gu(4,2,x,b)}function Co(x,b){return Gu(4,4,x,b)}function Wu(x,b){if(typeof b=="function")return x=x(),b(x),function(){b(null)};if(b!=null)return x=x(),b.current=x,function(){b.current=null}}function Gp(x,b,L){return L=L!=null?L.concat([x]):null,Gu(4,4,Wu.bind(null,b,x),L)}function sf(){}function Yc(x,b){var L=oi();b=b===void 0?null:b;var V=L.memoizedState;return V!==null&&b!==null&&$s(b,V[1])?V[0]:(L.memoizedState=[x,b],x)}function Wp(x,b){var L=oi();b=b===void 0?null:b;var V=L.memoizedState;return V!==null&&b!==null&&$s(b,V[1])?V[0]:(x=x(),L.memoizedState=[x,b],x)}function of(x,b){var L=Ei;Ei=L!==0&&4>L?L:4,x(!0);var V=Ho.transition;Ho.transition={};try{x(!1),b()}finally{Ei=L,Ho.transition=V}}function Jc(){return oi().memoizedState}function Kc(x,b,L){var V=ns(x);L={lane:V,action:L,hasEagerState:!1,eagerState:null,next:null},Hu(x)?Qc(b,L):(Ig(x,b,L),L=$i(),x=Ur(x,V,L),x!==null&&Pg(x,b,V))}function yo(x,b,L){var V=ns(x),Z={lane:V,action:L,hasEagerState:!1,eagerState:null,next:null};if(Hu(x))Qc(b,Z);else{Ig(x,b,Z);var te=x.alternate;if(x.lanes===0&&(te===null||te.lanes===0)&&(te=b.lastRenderedReducer,te!==null))try{var Ve=b.lastRenderedState,st=te(Ve,L);if(Z.hasEagerState=!0,Z.eagerState=st,Eo(st,Ve))return}catch{}finally{}L=$i(),x=Ur(x,V,L),x!==null&&Pg(x,b,V)}}function Hu(x){var b=x.alternate;return x===Er||b!==null&&b===Er}function Qc(x,b){Kl=Vu=!0;var L=x.pending;L===null?b.next=b:(b.next=L.next,L.next=b),x.pending=b}function Ig(x,b,L){at!==null&&x.mode&1&&!(Ye&2)?(x=b.interleaved,x===null?(L.next=L,Vo===null?Vo=[b]:Vo.push(b)):(L.next=x.next,x.next=L),b.interleaved=L):(x=b.pending,x===null?L.next=L:(L.next=x.next,x.next=L),b.pending=L)}function Pg(x,b,L){if(L&4194240){var V=b.lanes;V&=x.pendingLanes,L|=V,b.lanes=L,vr(x,L)}}var Zh={readContext:Fs,useCallback:As,useContext:As,useEffect:As,useImperativeHandle:As,useInsertionEffect:As,useLayoutEffect:As,useMemo:As,useReducer:As,useRef:As,useState:As,useDebugValue:As,useDeferredValue:As,useTransition:As,useMutableSource:As,useSyncExternalStore:As,useId:As,unstable_isNewReconciler:!1},ju={readContext:Fs,useCallback:function(x,b){return ma().memoizedState=[x,b===void 0?null:b],x},useContext:Fs,useEffect:Ql,useImperativeHandle:function(x,b,L){return L=L!=null?L.concat([x]):null,Xc(4194308,4,Wu.bind(null,b,x),L)},useLayoutEffect:function(x,b){return Xc(4194308,4,x,b)},useInsertionEffect:function(x,b){return Xc(4,2,x,b)},useMemo:function(x,b){var L=ma();return b=b===void 0?null:b,x=x(),L.memoizedState=[x,b],x},useReducer:function(x,b,L){var V=ma();return b=L!==void 0?L(b):b,V.memoizedState=V.baseState=b,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:x,lastRenderedState:b},V.queue=x,x=x.dispatch=Kc.bind(null,Er,x),[V.memoizedState,x]},useRef:function(x){var b=ma();return x={current:x},b.memoizedState=x},useState:$c,useDebugValue:sf,useDeferredValue:function(x){var b=$c(x),L=b[0],V=b[1];return Ql(function(){var Z=Ho.transition;Ho.transition={};try{V(x)}finally{Ho.transition=Z}},[x]),L},useTransition:function(){var x=$c(!1),b=x[0];return x=of.bind(null,x[1]),ma().memoizedState=x,[b,x]},useMutableSource:function(){},useSyncExternalStore:function(x,b,L){var V=Er,Z=ma();if(Mr){if(L===void 0)throw Error(l(407));L=L()}else{if(L=b(),at===null)throw Error(l(349));Jl&30||Vp(V,b,L)}Z.memoizedState=L;var te={value:L,getSnapshot:b};return Z.queue=te,Ql(rf.bind(null,V,te,x),[x]),V.flags|=2048,jo(9,nf.bind(null,V,te,L,b),void 0,null),L},useId:function(){var x=ma(),b=at.identifierPrefix;if(Mr){var L=ul,V=za;L=(V&~(1<<32-ds(V)-1)).toString(32)+L,b=":"+b+"R"+L,L=_o++,0<L&&(b+="H"+L.toString(32)),b+=":"}else L=jh++,b=":"+b+"r"+L.toString(32)+":";return x.memoizedState=b},unstable_isNewReconciler:!1},Hp={readContext:Fs,useCallback:Yc,useContext:Fs,useEffect:yl,useImperativeHandle:Gp,useInsertionEffect:hn,useLayoutEffect:Co,useMemo:Wp,useReducer:ef,useRef:_l,useState:function(){return ef(ga)},useDebugValue:sf,useDeferredValue:function(x){var b=ef(ga),L=b[0],V=b[1];return yl(function(){var Z=Ho.transition;Ho.transition={};try{V(x)}finally{Ho.transition=Z}},[x]),L},useTransition:function(){var x=ef(ga)[0],b=oi().memoizedState;return[x,b]},useMutableSource:Zc,useSyncExternalStore:tf,useId:Jc,unstable_isNewReconciler:!1},af={readContext:Fs,useCallback:Yc,useContext:Fs,useEffect:yl,useImperativeHandle:Gp,useInsertionEffect:hn,useLayoutEffect:Co,useMemo:Wp,useReducer:qc,useRef:_l,useState:function(){return qc(ga)},useDebugValue:sf,useDeferredValue:function(x){var b=qc(ga),L=b[0],V=b[1];return yl(function(){var Z=Ho.transition;Ho.transition={};try{V(x)}finally{Ho.transition=Z}},[x]),L},useTransition:function(){var x=qc(ga)[0],b=oi().memoizedState;return[x,b]},useMutableSource:Zc,useSyncExternalStore:tf,useId:Jc,unstable_isNewReconciler:!1};function lf(x,b){try{var L="",V=b;do L+=Ts(V),V=V.return;while(V);var Z=L}catch(te){Z=`
Error generating stack: `+te.message+`
`+te.stack}return{value:x,source:b,stack:Z}}function qu(x,b){try{console.error(b.value)}catch(L){setTimeout(function(){throw L})}}var $h=typeof WeakMap=="function"?WeakMap:Map;function jp(x,b,L){L=Ao(-1,L),L.tag=3,L.payload={element:null};var V=b.value;return L.callback=function(){Po||(Po=!0,Zi=V),qu(x,b)},L}function cf(x,b,L){L=Ao(-1,L),L.tag=3;var V=x.type.getDerivedStateFromError;if(typeof V=="function"){var Z=b.value;L.payload=function(){return V(Z)},L.callback=function(){qu(x,b)}}var te=x.stateNode;return te!==null&&typeof te.componentDidCatch=="function"&&(L.callback=function(){qu(x,b),typeof V!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var Ve=b.stack;this.componentDidCatch(b.value,{componentStack:Ve!==null?Ve:""})}),L}function uf(x,b,L){var V=x.pingCache;if(V===null){V=x.pingCache=new $h;var Z=new Set;V.set(b,Z)}else Z=V.get(b),Z===void 0&&(Z=new Set,V.set(b,Z));Z.has(L)||(Z.add(L),x=Bg.bind(null,x,b,L),b.then(x,x))}function qp(x){do{var b;if((b=x.tag===13)&&(b=x.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return x;x=x.return}while(x!==null);return null}function Xh(x,b,L,V,Z){return x.mode&1?(x.flags|=65536,x.lanes=Z,x):(x===b?x.flags|=65536:(x.flags|=128,L.flags|=131072,L.flags&=-52805,L.tag===1&&(L.alternate===null?L.tag=17:(b=Ao(-1,1),b.tag=2,La(L,b))),L.lanes|=1),x)}function ps(x){x.flags|=4}function hf(x,b){if(x!==null&&x.child===b.child)return!0;if(b.flags&16)return!1;for(x=b.child;x!==null;){if(x.flags&12854||x.subtreeFlags&12854)return!1;x=x.sibling}return!0}var Zu,$u,Yh,eu;if(Ln)Zu=function(x,b){for(var L=b.child;L!==null;){if(L.tag===5||L.tag===6)Ne(x,L.stateNode);else if(L.tag!==4&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===b)break;for(;L.sibling===null;){if(L.return===null||L.return===b)return;L=L.return}L.sibling.return=L.return,L=L.sibling}},$u=function(){},Yh=function(x,b,L,V,Z){if(x=x.memoizedProps,x!==V){var te=b.stateNode,Ve=go(Wo.current);L=ze(te,L,x,V,Z,Ve),(b.updateQueue=L)&&ps(b)}},eu=function(x,b,L,V){L!==V&&ps(b)};else if(At){Zu=function(x,b,L,V){for(var Z=b.child;Z!==null;){if(Z.tag===5){var te=Z.stateNode;L&&V&&(te=Gi(te,Z.type,Z.memoizedProps,Z)),Ne(x,te)}else if(Z.tag===6)te=Z.stateNode,L&&V&&(te=Kr(te,Z.memoizedProps,Z)),Ne(x,te);else if(Z.tag!==4){if(Z.tag===22&&Z.memoizedState!==null)te=Z.child,te!==null&&(te.return=Z),Zu(x,Z,!0,!0);else if(Z.child!==null){Z.child.return=Z,Z=Z.child;continue}}if(Z===b)break;for(;Z.sibling===null;){if(Z.return===null||Z.return===b)return;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}};var Zp=function(x,b,L,V){for(var Z=b.child;Z!==null;){if(Z.tag===5){var te=Z.stateNode;L&&V&&(te=Gi(te,Z.type,Z.memoizedProps,Z)),cr(x,te)}else if(Z.tag===6)te=Z.stateNode,L&&V&&(te=Kr(te,Z.memoizedProps,Z)),cr(x,te);else if(Z.tag!==4){if(Z.tag===22&&Z.memoizedState!==null)te=Z.child,te!==null&&(te.return=Z),Zp(x,Z,!0,!0);else if(Z.child!==null){Z.child.return=Z,Z=Z.child;continue}}if(Z===b)break;for(;Z.sibling===null;){if(Z.return===null||Z.return===b)return;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}};$u=function(x,b){var L=b.stateNode;if(!hf(x,b)){x=L.containerInfo;var V=Ri(x);Zp(V,b,!1,!1),L.pendingChildren=V,ps(b),Or(x,V)}},Yh=function(x,b,L,V,Z){var te=x.stateNode,Ve=x.memoizedProps;if((x=hf(x,b))&&Ve===V)b.stateNode=te;else{var st=b.stateNode,pt=go(Wo.current),ln=null;Ve!==V&&(ln=ze(st,L,Ve,V,Z,pt)),x&&ln===null?b.stateNode=te:(te=Pn(te,ln,L,Ve,V,b,x,st),nt(te,L,V,Z,pt)&&ps(b),b.stateNode=te,x?ps(b):Zu(te,b,!1,!1))}},eu=function(x,b,L,V){L!==V?(x=go(Hc.current),L=go(Wo.current),b.stateNode=Et(V,x,L,b),ps(b)):b.stateNode=x.stateNode}}else $u=function(){},Yh=function(){},eu=function(){};function Xu(x,b){if(!Mr)switch(x.tailMode){case"hidden":b=x.tail;for(var L=null;b!==null;)b.alternate!==null&&(L=b),b=b.sibling;L===null?x.tail=null:L.sibling=null;break;case"collapsed":L=x.tail;for(var V=null;L!==null;)L.alternate!==null&&(V=L),L=L.sibling;V===null?b||x.tail===null?x.tail=null:x.tail.sibling=null:V.sibling=null}}function Wi(x){var b=x.alternate!==null&&x.alternate.child===x.child,L=0,V=0;if(b)for(var Z=x.child;Z!==null;)L|=Z.lanes|Z.childLanes,V|=Z.subtreeFlags&14680064,V|=Z.flags&14680064,Z.return=x,Z=Z.sibling;else for(Z=x.child;Z!==null;)L|=Z.lanes|Z.childLanes,V|=Z.subtreeFlags,V|=Z.flags,Z.return=x,Z=Z.sibling;return x.subtreeFlags|=V,x.childLanes=L,b}function jy(x,b,L){var V=b.pendingProps;switch(Fh(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wi(b),null;case 1:return Jn(b.type)&&lo(),Wi(b),null;case 3:return V=b.stateNode,jc(),zi(qi),zi(Nr),Up(),V.pendingContext&&(V.context=V.pendingContext,V.pendingContext=null),(x===null||x.child===null)&&(Vc(b)?ps(b):x===null||x.memoizedState.isDehydrated&&!(b.flags&256)||(b.flags|=1024,Bs!==null&&(id(Bs),Bs=null))),$u(x,b),Wi(b),null;case 5:pl(b),L=go(Hc.current);var Z=b.type;if(x!==null&&b.stateNode!=null)Yh(x,b,Z,V,L),x.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!V){if(b.stateNode===null)throw Error(l(166));return Wi(b),null}if(x=go(Wo.current),Vc(b)){if(!Ot)throw Error(l(175));x=ht(b.stateNode,b.type,b.memoizedProps,L,x,b,!hl),b.updateQueue=x,x!==null&&ps(b)}else{var te=Qe(Z,V,L,x,b);Zu(te,b,!1,!1),b.stateNode=te,nt(te,Z,V,L,x)&&ps(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return Wi(b),null;case 6:if(x&&b.stateNode!=null)eu(x,b,x.memoizedProps,V);else{if(typeof V!="string"&&b.stateNode===null)throw Error(l(166));if(x=go(Hc.current),L=go(Wo.current),Vc(b)){if(!Ot)throw Error(l(176));if(x=b.stateNode,V=b.memoizedProps,(L=zt(x,V,b,!hl))&&(Z=po,Z!==null))switch(te=(Z.mode&1)!==0,Z.tag){case 3:Sn(Z.stateNode.containerInfo,x,V,te);break;case 5:Kn(Z.type,Z.memoizedProps,Z.stateNode,x,V,te)}L&&ps(b)}else b.stateNode=Et(V,x,L,b)}return Wi(b),null;case 13:if(zi(Tr),V=b.memoizedState,Mr&&mo!==null&&b.mode&1&&!(b.flags&128)){for(x=mo;x;)x=Ae(x);return dl(),b.flags|=98560,b}if(V!==null&&V.dehydrated!==null){if(V=Vc(b),x===null){if(!V)throw Error(l(318));if(!Ot)throw Error(l(344));if(x=b.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(l(317));vt(x,b)}else dl(),!(b.flags&128)&&(b.memoizedState=null),b.flags|=4;return Wi(b),null}return Bs!==null&&(id(Bs),Bs=null),b.flags&128?(b.lanes=L,b):(V=V!==null,L=!1,x===null?Vc(b):L=x.memoizedState!==null,V&&!L&&(b.child.flags|=8192,b.mode&1&&(x===null||Tr.current&1?Rn===0&&(Rn=3):Fg())),b.updateQueue!==null&&(b.flags|=4),Wi(b),null);case 4:return jc(),$u(x,b),x===null&&An(b.stateNode.containerInfo),Wi(b),null;case 10:return Bc(b.type._context),Wi(b),null;case 17:return Jn(b.type)&&lo(),Wi(b),null;case 19:if(zi(Tr),Z=b.memoizedState,Z===null)return Wi(b),null;if(V=(b.flags&128)!==0,te=Z.rendering,te===null)if(V)Xu(Z,!1);else{if(Rn!==0||x!==null&&x.flags&128)for(x=b.child;x!==null;){if(te=Wh(x),te!==null){for(b.flags|=128,Xu(Z,!1),x=te.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),b.subtreeFlags=0,x=L,V=b.child;V!==null;)L=V,Z=x,L.flags&=14680066,te=L.alternate,te===null?(L.childLanes=0,L.lanes=Z,L.child=null,L.subtreeFlags=0,L.memoizedProps=null,L.memoizedState=null,L.updateQueue=null,L.dependencies=null,L.stateNode=null):(L.childLanes=te.childLanes,L.lanes=te.lanes,L.child=te.child,L.subtreeFlags=0,L.deletions=null,L.memoizedProps=te.memoizedProps,L.memoizedState=te.memoizedState,L.updateQueue=te.updateQueue,L.type=te.type,Z=te.dependencies,L.dependencies=Z===null?null:{lanes:Z.lanes,firstContext:Z.firstContext}),V=V.sibling;return ci(Tr,Tr.current&1|2),b.child}x=x.sibling}Z.tail!==null&&wi()>Ys&&(b.flags|=128,V=!0,Xu(Z,!1),b.lanes=4194304)}else{if(!V)if(x=Wh(te),x!==null){if(b.flags|=128,V=!0,x=x.updateQueue,x!==null&&(b.updateQueue=x,b.flags|=4),Xu(Z,!0),Z.tail===null&&Z.tailMode==="hidden"&&!te.alternate&&!Mr)return Wi(b),null}else 2*wi()-Z.renderingStartTime>Ys&&L!==1073741824&&(b.flags|=128,V=!0,Xu(Z,!1),b.lanes=4194304);Z.isBackwards?(te.sibling=b.child,b.child=te):(x=Z.last,x!==null?x.sibling=te:b.child=te,Z.last=te)}return Z.tail!==null?(b=Z.tail,Z.rendering=b,Z.tail=b.sibling,Z.renderingStartTime=wi(),b.sibling=null,x=Tr.current,ci(Tr,V?x&1|2:x&1),b):(Wi(b),null);case 22:case 23:return Og(),V=b.memoizedState!==null,x!==null&&x.memoizedState!==null!==V&&(b.flags|=8192),V&&b.mode&1?cn&1073741824&&(Wi(b),Ln&&b.subtreeFlags&6&&(b.flags|=8192)):Wi(b),null;case 24:return null;case 25:return null}throw Error(l(156,b.tag))}var $p=s.ReactCurrentOwner,Io=!1;function Xs(x,b,L,V){b.child=x===null?Cg(b,null,L,V):fl(b,x.child,L,V)}function Ba(x,b,L,V,Z){L=L.render;var te=b.ref;return Nc(b,Z),V=ml(x,b,L,V,te,Z),L=gl(),x!==null&&!Io?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~Z,ya(x,b,Z)):(Mr&&L&&Oh(b),b.flags|=1,Xs(x,b,V,Z),b.child)}function Xp(x,b,L,V,Z){if(x===null){var te=L.type;return typeof te=="function"&&!Ky(te)&&te.defaultProps===void 0&&L.compare===null&&L.defaultProps===void 0?(b.tag=15,b.type=te,tu(x,b,te,V,Z)):(x=yf(L.type,null,V,b,b.mode,Z),x.ref=b.ref,x.return=b,b.child=x)}if(te=x.child,!(x.lanes&Z)){var Ve=te.memoizedProps;if(L=L.compare,L=L!==null?L:Oc,L(Ve,V)&&x.ref===b.ref)return ya(x,b,Z)}return b.flags|=1,x=nh(te,V),x.ref=b.ref,x.return=b,b.child=x}function tu(x,b,L,V,Z){if(x!==null&&Oc(x.memoizedProps,V)&&x.ref===b.ref)if(Io=!1,(x.lanes&Z)!==0)x.flags&131072&&(Io=!0);else return b.lanes=x.lanes,ya(x,b,Z);return dn(x,b,L,V,Z)}function _a(x,b,L){var V=b.pendingProps,Z=V.children,te=x!==null?x.memoizedState:null;if(V.mode==="hidden")if(!(b.mode&1))b.memoizedState={baseLanes:0,cachePool:null},ci(Fn,cn),cn|=L;else if(L&1073741824)b.memoizedState={baseLanes:0,cachePool:null},V=te!==null?te.baseLanes:L,ci(Fn,cn),cn|=V;else return x=te!==null?te.baseLanes|L:L,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:x,cachePool:null},b.updateQueue=null,ci(Fn,cn),cn|=x,null;else te!==null?(V=te.baseLanes|L,b.memoizedState=null):V=L,ci(Fn,cn),cn|=V;return Xs(x,b,Z,L),b.child}function Jh(x,b){var L=b.ref;(x===null&&L!==null||x!==null&&x.ref!==L)&&(b.flags|=512,b.flags|=2097152)}function dn(x,b,L,V,Z){var te=Jn(L)?Jt:Nr.current;return te=ni(b,te),Nc(b,Z),L=ml(x,b,L,V,te,Z),V=gl(),x!==null&&!Io?(b.updateQueue=x.updateQueue,b.flags&=-2053,x.lanes&=~Z,ya(x,b,Z)):(Mr&&V&&Oh(b),b.flags|=1,Xs(x,b,L,Z),b.child)}function Yp(x,b,L,V,Z){if(Jn(L)){var te=!0;Gl(b)}else te=!1;if(Nc(b,Z),b.stateNode===null)x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2),Lh(b,L,V),Nu(b,L,V,Z),V=!0;else if(x===null){var Ve=b.stateNode,st=b.memoizedProps;Ve.props=st;var pt=Ve.context,ln=L.contextType;typeof ln=="object"&&ln!==null?ln=Fs(ln):(ln=Jn(L)?Jt:Nr.current,ln=ni(b,ln));var Dn=L.getDerivedStateFromProps,Qn=typeof Dn=="function"||typeof Ve.getSnapshotBeforeUpdate=="function";Qn||typeof Ve.UNSAFE_componentWillReceiveProps!="function"&&typeof Ve.componentWillReceiveProps!="function"||(st!==V||pt!==ln)&&Bu(b,Ve,V,ln),ho=!1;var Gn=b.memoizedState;Ve.state=Gn,Xl(b,V,Ve,Z),pt=b.memoizedState,st!==V||Gn!==pt||qi.current||ho?(typeof Dn=="function"&&(Fu(b,L,Dn,V),pt=b.memoizedState),(st=ho||Uc(b,L,st,V,Gn,pt,ln))?(Qn||typeof Ve.UNSAFE_componentWillMount!="function"&&typeof Ve.componentWillMount!="function"||(typeof Ve.componentWillMount=="function"&&Ve.componentWillMount(),typeof Ve.UNSAFE_componentWillMount=="function"&&Ve.UNSAFE_componentWillMount()),typeof Ve.componentDidMount=="function"&&(b.flags|=4194308)):(typeof Ve.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=V,b.memoizedState=pt),Ve.props=V,Ve.state=pt,Ve.context=ln,V=st):(typeof Ve.componentDidMount=="function"&&(b.flags|=4194308),V=!1)}else{Ve=b.stateNode,zp(x,b),st=b.memoizedProps,ln=b.type===b.elementType?st:uo(b.type,st),Ve.props=ln,Qn=b.pendingProps,Gn=Ve.context,pt=L.contextType,typeof pt=="object"&&pt!==null?pt=Fs(pt):(pt=Jn(L)?Jt:Nr.current,pt=ni(b,pt));var Ci=L.getDerivedStateFromProps;(Dn=typeof Ci=="function"||typeof Ve.getSnapshotBeforeUpdate=="function")||typeof Ve.UNSAFE_componentWillReceiveProps!="function"&&typeof Ve.componentWillReceiveProps!="function"||(st!==Qn||Gn!==pt)&&Bu(b,Ve,V,pt),ho=!1,Gn=b.memoizedState,Ve.state=Gn,Xl(b,V,Ve,Z);var In=b.memoizedState;st!==Qn||Gn!==In||qi.current||ho?(typeof Ci=="function"&&(Fu(b,L,Ci,V),In=b.memoizedState),(ln=ho||Uc(b,L,ln,V,Gn,In,pt)||!1)?(Dn||typeof Ve.UNSAFE_componentWillUpdate!="function"&&typeof Ve.componentWillUpdate!="function"||(typeof Ve.componentWillUpdate=="function"&&Ve.componentWillUpdate(V,In,pt),typeof Ve.UNSAFE_componentWillUpdate=="function"&&Ve.UNSAFE_componentWillUpdate(V,In,pt)),typeof Ve.componentDidUpdate=="function"&&(b.flags|=4),typeof Ve.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof Ve.componentDidUpdate!="function"||st===x.memoizedProps&&Gn===x.memoizedState||(b.flags|=4),typeof Ve.getSnapshotBeforeUpdate!="function"||st===x.memoizedProps&&Gn===x.memoizedState||(b.flags|=1024),b.memoizedProps=V,b.memoizedState=In),Ve.props=V,Ve.state=In,Ve.context=pt,V=ln):(typeof Ve.componentDidUpdate!="function"||st===x.memoizedProps&&Gn===x.memoizedState||(b.flags|=4),typeof Ve.getSnapshotBeforeUpdate!="function"||st===x.memoizedProps&&Gn===x.memoizedState||(b.flags|=1024),V=!1)}return df(x,b,L,V,te,Z)}function df(x,b,L,V,Z,te){Jh(x,b);var Ve=(b.flags&128)!==0;if(!V&&!Ve)return Z&&kc(b,L,!1),ya(x,b,te);V=b.stateNode,$p.current=b;var st=Ve&&typeof L.getDerivedStateFromError!="function"?null:V.render();return b.flags|=1,x!==null&&Ve?(b.child=fl(b,x.child,null,te),b.child=fl(b,null,st,te)):Xs(x,b,st,te),b.memoizedState=V.state,Z&&kc(b,L,!0),b.child}function xl(x){var b=x.stateNode;b.pendingContext?Vl(x,b.pendingContext,b.pendingContext!==b.context):b.context&&Vl(x,b.context,!1),Bp(x,b.containerInfo)}function Yu(x,b,L,V,Z){return dl(),Kd(Z),b.flags|=256,Xs(x,b,L,V),b.child}var Ju={dehydrated:null,treeContext:null,retryLane:0};function Kh(x){return{baseLanes:x,cachePool:null}}function ff(x,b,L){var V=b.pendingProps,Z=Tr.current,te=!1,Ve=(b.flags&128)!==0,st;if((st=Ve)||(st=x!==null&&x.memoizedState===null?!1:(Z&2)!==0),st?(te=!0,b.flags&=-129):(x===null||x.memoizedState!==null)&&(Z|=1),ci(Tr,Z&1),x===null)return Go(b),x=b.memoizedState,x!==null&&(x=x.dehydrated,x!==null)?(b.mode&1?ee(x)?b.lanes=8:b.lanes=1073741824:b.lanes=1,null):(Z=V.children,x=V.fallback,te?(V=b.mode,te=b.child,Z={mode:"hidden",children:Z},!(V&1)&&te!==null?(te.childLanes=0,te.pendingProps=Z):te=ru(Z,V,0,null),x=wl(x,V,L,null),te.return=b,x.return=b,te.sibling=x,b.child=te,b.child.memoizedState=Kh(L),b.memoizedState=Ju,x):Qh(b,Z));if(Z=x.memoizedState,Z!==null){if(st=Z.dehydrated,st!==null){if(Ve)return b.flags&256?(b.flags&=-257,vl(x,b,L,Error(l(422)))):b.memoizedState!==null?(b.child=x.child,b.flags|=128,null):(te=V.fallback,Z=b.mode,V=ru({mode:"visible",children:V.children},Z,0,null),te=wl(te,Z,L,null),te.flags|=2,V.return=b,te.return=b,V.sibling=te,b.child=V,b.mode&1&&fl(b,x.child,null,L),b.child.memoizedState=Kh(L),b.memoizedState=Ju,te);if(!(b.mode&1))b=vl(x,b,L,null);else if(ee(st))b=vl(x,b,L,Error(l(419)));else if(V=(L&x.childLanes)!==0,Io||V){if(V=at,V!==null){switch(L&-L){case 4:te=2;break;case 16:te=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:te=32;break;case 536870912:te=268435456;break;default:te=0}V=te&(V.suspendedLanes|L)?0:te,V!==0&&V!==Z.retryLane&&(Z.retryLane=V,Ur(x,V,-1))}Fg(),b=vl(x,b,L,Error(l(421)))}else Ie(st)?(b.flags|=128,b.child=x.child,b=Jy.bind(null,x),pe(st,b),b=null):(L=Z.treeContext,Ot&&(mo=Je(st),po=b,Mr=!0,Bs=null,hl=!1,L!==null&&(fo[Zs++]=za,fo[Zs++]=ul,fo[Zs++]=Yl,za=L.id,ul=L.overflow,Yl=b)),b=Qh(b,b.pendingProps.children),b.flags|=4096);return b}return te?(V=mf(x,b,V.children,V.fallback,L),te=b.child,Z=x.child.memoizedState,te.memoizedState=Z===null?Kh(L):{baseLanes:Z.baseLanes|L,cachePool:null},te.childLanes=x.childLanes&~L,b.memoizedState=Ju,V):(L=pf(x,b,V.children,L),b.memoizedState=null,L)}return te?(V=mf(x,b,V.children,V.fallback,L),te=b.child,Z=x.child.memoizedState,te.memoizedState=Z===null?Kh(L):{baseLanes:Z.baseLanes|L,cachePool:null},te.childLanes=x.childLanes&~L,b.memoizedState=Ju,V):(L=pf(x,b,V.children,L),b.memoizedState=null,L)}function Qh(x,b){return b=ru({mode:"visible",children:b},x.mode,0,null),b.return=x,x.child=b}function pf(x,b,L,V){var Z=x.child;return x=Z.sibling,L=nh(Z,{mode:"visible",children:L}),!(b.mode&1)&&(L.lanes=V),L.return=b,L.sibling=null,x!==null&&(V=b.deletions,V===null?(b.deletions=[x],b.flags|=16):V.push(x)),b.child=L}function mf(x,b,L,V,Z){var te=b.mode;x=x.child;var Ve=x.sibling,st={mode:"hidden",children:L};return!(te&1)&&b.child!==x?(L=b.child,L.childLanes=0,L.pendingProps=st,b.deletions=null):(L=nh(x,st),L.subtreeFlags=x.subtreeFlags&14680064),Ve!==null?V=nh(Ve,V):(V=wl(V,te,Z,null),V.flags|=2),V.return=b,L.return=b,L.sibling=V,b.child=L,V}function vl(x,b,L,V){return V!==null&&Kd(V),fl(b,x.child,null,L),x=Qh(b,b.pendingProps.children),x.flags|=2,b.memoizedState=null,x}function Ku(x,b,L){x.lanes|=b;var V=x.alternate;V!==null&&(V.lanes|=b),Ph(x.return,b,L)}function Qu(x,b,L,V,Z){var te=x.memoizedState;te===null?x.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:V,tail:L,tailMode:Z}:(te.isBackwards=b,te.rendering=null,te.renderingStartTime=0,te.last=V,te.tail=L,te.tailMode=Z)}function Jp(x,b,L){var V=b.pendingProps,Z=V.revealOrder,te=V.tail;if(Xs(x,b,V.children,L),V=Tr.current,V&2)V=V&1|2,b.flags|=128;else{if(x!==null&&x.flags&128)e:for(x=b.child;x!==null;){if(x.tag===13)x.memoizedState!==null&&Ku(x,L,b);else if(x.tag===19)Ku(x,L,b);else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===b)break e;for(;x.sibling===null;){if(x.return===null||x.return===b)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}V&=1}if(ci(Tr,V),!(b.mode&1))b.memoizedState=null;else switch(Z){case"forwards":for(L=b.child,Z=null;L!==null;)x=L.alternate,x!==null&&Wh(x)===null&&(Z=L),L=L.sibling;L=Z,L===null?(Z=b.child,b.child=null):(Z=L.sibling,L.sibling=null),Qu(b,!1,Z,L,te);break;case"backwards":for(L=null,Z=b.child,b.child=null;Z!==null;){if(x=Z.alternate,x!==null&&Wh(x)===null){b.child=Z;break}x=Z.sibling,Z.sibling=L,L=Z,Z=x}Qu(b,!0,L,null,te);break;case"together":Qu(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function ya(x,b,L){if(x!==null&&(b.dependencies=x.dependencies),an|=b.lanes,!(L&b.childLanes))return null;if(x!==null&&b.child!==x.child)throw Error(l(153));if(b.child!==null){for(x=b.child,L=nh(x,x.pendingProps),b.child=L,L.return=b;x.sibling!==null;)x=x.sibling,L=L.sibling=nh(x,x.pendingProps),L.return=b;L.sibling=null}return b.child}function kg(x,b,L){switch(b.tag){case 3:xl(b),dl();break;case 5:Np(b);break;case 1:Jn(b.type)&&Gl(b);break;case 4:Bp(b,b.stateNode.containerInfo);break;case 10:Ih(b,b.type._context,b.memoizedProps.value);break;case 13:var V=b.memoizedState;if(V!==null)return V.dehydrated!==null?(ci(Tr,Tr.current&1),b.flags|=128,null):L&b.child.childLanes?ff(x,b,L):(ci(Tr,Tr.current&1),x=ya(x,b,L),x!==null?x.sibling:null);ci(Tr,Tr.current&1);break;case 19:if(V=(L&b.childLanes)!==0,x.flags&128){if(V)return Jp(x,b,L);b.flags|=128}var Z=b.memoizedState;if(Z!==null&&(Z.rendering=null,Z.tail=null,Z.lastEffect=null),ci(Tr,Tr.current),V)break;return null;case 22:case 23:return b.lanes=0,_a(x,b,L)}return ya(x,b,L)}function Dg(x,b){switch(Fh(b),b.tag){case 1:return Jn(b.type)&&lo(),x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 3:return jc(),zi(qi),zi(Nr),Up(),x=b.flags,x&65536&&!(x&128)?(b.flags=x&-65537|128,b):null;case 5:return pl(b),null;case 13:if(zi(Tr),x=b.memoizedState,x!==null&&x.dehydrated!==null){if(b.alternate===null)throw Error(l(340));dl()}return x=b.flags,x&65536?(b.flags=x&-65537|128,b):null;case 19:return zi(Tr),null;case 4:return jc(),null;case 10:return Bc(b.type._context),null;case 22:case 23:return Og(),null;case 24:return null;default:return null}}var ed=!1,ec=!1,Lg=typeof WeakSet=="function"?WeakSet:Set,xn=null;function td(x,b){var L=x.ref;if(L!==null)if(typeof L=="function")try{L(null)}catch(V){$o(x,b,V)}else L.current=null}function gf(x,b,L){try{L()}catch(V){$o(x,b,V)}}var _f=!1;function nd(x,b){for(Te(x.containerInfo),xn=b;xn!==null;)if(x=xn,b=x.child,(x.subtreeFlags&1028)!==0&&b!==null)b.return=x,xn=b;else for(;xn!==null;){x=xn;try{var L=x.alternate;if(x.flags&1024)switch(x.tag){case 0:case 11:case 15:break;case 1:if(L!==null){var V=L.memoizedProps,Z=L.memoizedState,te=x.stateNode,Ve=te.getSnapshotBeforeUpdate(x.elementType===x.type?V:uo(x.type,V),Z);te.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:Ln&&bn(x.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(l(163))}}catch(st){$o(x,x.return,st)}if(b=x.sibling,b!==null){b.return=x.return,xn=b;break}xn=x.return}return L=_f,_f=!1,L}function y(x,b,L){var V=b.updateQueue;if(V=V!==null?V.lastEffect:null,V!==null){var Z=V=V.next;do{if((Z.tag&x)===x){var te=Z.destroy;Z.destroy=void 0,te!==void 0&&gf(b,L,te)}Z=Z.next}while(Z!==V)}}function h(x,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var L=b=b.next;do{if((L.tag&x)===x){var V=L.create;L.destroy=V()}L=L.next}while(L!==b)}}function p(x){var b=x.ref;if(b!==null){var L=x.stateNode;switch(x.tag){case 5:x=Oe(L);break;default:x=L}typeof b=="function"?b(x):b.current=x}}function w(x,b,L){if(Uo&&typeof Uo.onCommitFiberUnmount=="function")try{Uo.onCommitFiberUnmount(rl,b)}catch{}switch(b.tag){case 0:case 11:case 14:case 15:if(x=b.updateQueue,x!==null&&(x=x.lastEffect,x!==null)){var V=x=x.next;do{var Z=V,te=Z.destroy;Z=Z.tag,te!==void 0&&(Z&2||Z&4)&&gf(b,L,te),V=V.next}while(V!==x)}break;case 1:if(td(b,L),x=b.stateNode,typeof x.componentWillUnmount=="function")try{x.props=b.memoizedProps,x.state=b.memoizedState,x.componentWillUnmount()}catch(Ve){$o(b,L,Ve)}break;case 5:td(b,L);break;case 4:Ln?oe(x,b,L):At&&At&&(b=b.stateNode.containerInfo,L=Ri(b),Cr(b,L))}}function E(x,b,L){for(var V=b;;)if(w(x,V,L),V.child===null||Ln&&V.tag===4){if(V===b)break;for(;V.sibling===null;){if(V.return===null||V.return===b)return;V=V.return}V.sibling.return=V.return,V=V.sibling}else V.child.return=V,V=V.child}function I(x){var b=x.alternate;b!==null&&(x.alternate=null,I(b)),x.child=null,x.deletions=null,x.sibling=null,x.tag===5&&(b=x.stateNode,b!==null&&Vn(b)),x.stateNode=null,x.return=null,x.dependencies=null,x.memoizedProps=null,x.memoizedState=null,x.pendingProps=null,x.stateNode=null,x.updateQueue=null}function B(x){return x.tag===5||x.tag===3||x.tag===4}function U(x){e:for(;;){for(;x.sibling===null;){if(x.return===null||B(x.return))return null;x=x.return}for(x.sibling.return=x.return,x=x.sibling;x.tag!==5&&x.tag!==6&&x.tag!==18;){if(x.flags&2||x.child===null||x.tag===4)continue e;x.child.return=x,x=x.child}if(!(x.flags&2))return x.stateNode}}function H(x){if(Ln){e:{for(var b=x.return;b!==null;){if(B(b))break e;b=b.return}throw Error(l(160))}var L=b;switch(L.tag){case 5:b=L.stateNode,L.flags&32&&(li(b),L.flags&=-33),L=U(x),Y(x,L,b);break;case 3:case 4:b=L.stateNode.containerInfo,L=U(x),J(x,L,b);break;default:throw Error(l(161))}}}function J(x,b,L){var V=x.tag;if(V===5||V===6)x=x.stateNode,b?Zt(L,x,b):yn(L,x);else if(V!==4&&(x=x.child,x!==null))for(J(x,b,L),x=x.sibling;x!==null;)J(x,b,L),x=x.sibling}function Y(x,b,L){var V=x.tag;if(V===5||V===6)x=x.stateNode,b?It(L,x,b):Nn(L,x);else if(V!==4&&(x=x.child,x!==null))for(Y(x,b,L),x=x.sibling;x!==null;)Y(x,b,L),x=x.sibling}function oe(x,b,L){for(var V=b,Z=!1,te,Ve;;){if(!Z){Z=V.return;e:for(;;){if(Z===null)throw Error(l(160));switch(te=Z.stateNode,Z.tag){case 5:Ve=!1;break e;case 3:te=te.containerInfo,Ve=!0;break e;case 4:te=te.containerInfo,Ve=!0;break e}Z=Z.return}Z=!0}if(V.tag===5||V.tag===6)E(x,V,L),Ve?Yn(te,V.stateNode):sn(te,V.stateNode);else if(V.tag===18)Ve?$n(te,V.stateNode):gn(te,V.stateNode);else if(V.tag===4){if(V.child!==null){te=V.stateNode.containerInfo,Ve=!0,V.child.return=V,V=V.child;continue}}else if(w(x,V,L),V.child!==null){V.child.return=V,V=V.child;continue}if(V===b)break;for(;V.sibling===null;){if(V.return===null||V.return===b)return;V=V.return,V.tag===4&&(Z=!1)}V.sibling.return=V.return,V=V.sibling}}function me(x,b){if(Ln){switch(b.tag){case 0:case 11:case 14:case 15:y(3,b,b.return),h(3,b),y(5,b,b.return);return;case 1:return;case 5:var L=b.stateNode;if(L!=null){var V=b.memoizedProps;x=x!==null?x.memoizedProps:V;var Z=b.type,te=b.updateQueue;b.updateQueue=null,te!==null&&Ke(L,te,Z,x,V,b)}return;case 6:if(b.stateNode===null)throw Error(l(162));L=b.memoizedProps,Lt(b.stateNode,x!==null?x.memoizedProps:L,L);return;case 3:Ot&&x!==null&&x.memoizedState.isDehydrated&&Yt(b.stateNode.containerInfo);return;case 12:return;case 13:be(b);return;case 19:be(b);return;case 17:return}throw Error(l(163))}switch(b.tag){case 0:case 11:case 14:case 15:y(3,b,b.return),h(3,b),y(5,b,b.return);return;case 12:return;case 13:be(b);return;case 19:be(b);return;case 3:Ot&&x!==null&&x.memoizedState.isDehydrated&&Yt(b.stateNode.containerInfo);break;case 22:case 23:return}e:if(At){switch(b.tag){case 1:case 5:case 6:break e;case 3:case 4:b=b.stateNode,Cr(b.containerInfo,b.pendingChildren);break e}throw Error(l(163))}}function be(x){var b=x.updateQueue;if(b!==null){x.updateQueue=null;var L=x.stateNode;L===null&&(L=x.stateNode=new Lg),b.forEach(function(V){var Z=Ng.bind(null,x,V);L.has(V)||(L.add(V),V.then(Z,Z))})}}function we(x,b){for(xn=b;xn!==null;){b=xn;var L=b.deletions;if(L!==null)for(var V=0;V<L.length;V++){var Z=L[V];try{var te=x;Ln?oe(te,Z,b):E(te,Z,b);var Ve=Z.alternate;Ve!==null&&(Ve.return=null),Z.return=null}catch(Hn){$o(Z,b,Hn)}}if(L=b.child,b.subtreeFlags&12854&&L!==null)L.return=b,xn=L;else for(;xn!==null;){b=xn;try{var st=b.flags;if(st&32&&Ln&&li(b.stateNode),st&512){var pt=b.alternate;if(pt!==null){var ln=pt.ref;ln!==null&&(typeof ln=="function"?ln(null):ln.current=null)}}if(st&8192)switch(b.tag){case 13:if(b.memoizedState!==null){var Dn=b.alternate;(Dn===null||Dn.memoizedState===null)&&(Ns=wi())}break;case 22:var Qn=b.memoizedState!==null,Gn=b.alternate,Ci=Gn!==null&&Gn.memoizedState!==null;if(L=b,Ln){e:if(V=L,Z=Qn,te=null,Ln)for(var In=V;;){if(In.tag===5){if(te===null){te=In;var Hi=In.stateNode;Z?Bi(Hi):Ct(In.stateNode,In.memoizedProps)}}else if(In.tag===6){if(te===null){var wa=In.stateNode;Z?rt(wa):Vt(wa,In.memoizedProps)}}else if((In.tag!==22&&In.tag!==23||In.memoizedState===null||In===V)&&In.child!==null){In.child.return=In,In=In.child;continue}if(In===V)break;for(;In.sibling===null;){if(In.return===null||In.return===V)break e;te===In&&(te=null),In=In.return}te===In&&(te=null),In.sibling.return=In.return,In=In.sibling}}if(Qn&&!Ci&&L.mode&1){xn=L;for(var _t=L.child;_t!==null;){for(L=xn=_t;xn!==null;){V=xn;var ct=V.child;switch(V.tag){case 0:case 11:case 14:case 15:y(4,V,V.return);break;case 1:td(V,V.return);var Mt=V.stateNode;if(typeof Mt.componentWillUnmount=="function"){var Mn=V.return;try{Mt.props=V.memoizedProps,Mt.state=V.memoizedState,Mt.componentWillUnmount()}catch(Hn){$o(V,Mn,Hn)}}break;case 5:td(V,V.return);break;case 22:if(V.memoizedState!==null){ke(L);continue}}ct!==null?(ct.return=V,xn=ct):ke(L)}_t=_t.sibling}}}switch(st&4102){case 2:H(b),b.flags&=-3;break;case 6:H(b),b.flags&=-3,me(b.alternate,b);break;case 4096:b.flags&=-4097;break;case 4100:b.flags&=-4097,me(b.alternate,b);break;case 4:me(b.alternate,b)}}catch(Hn){$o(b,b.return,Hn)}if(L=b.sibling,L!==null){L.return=b.return,xn=L;break}xn=b.return}}}function Me(x,b,L){xn=x,_e(x)}function _e(x,b,L){for(var V=(x.mode&1)!==0;xn!==null;){var Z=xn,te=Z.child;if(Z.tag===22&&V){var Ve=Z.memoizedState!==null||ed;if(!Ve){var st=Z.alternate,pt=st!==null&&st.memoizedState!==null||ec;st=ed;var ln=ec;if(ed=Ve,(ec=pt)&&!ln)for(xn=Z;xn!==null;)Ve=xn,pt=Ve.child,Ve.tag===22&&Ve.memoizedState!==null?Ce(Z):pt!==null?(pt.return=Ve,xn=pt):Ce(Z);for(;te!==null;)xn=te,_e(te),te=te.sibling;xn=Z,ed=st,ec=ln}xe(x)}else Z.subtreeFlags&8772&&te!==null?(te.return=Z,xn=te):xe(x)}}function xe(x){for(;xn!==null;){var b=xn;if(b.flags&8772){var L=b.alternate;try{if(b.flags&8772)switch(b.tag){case 0:case 11:case 15:ec||h(5,b);break;case 1:var V=b.stateNode;if(b.flags&4&&!ec)if(L===null)V.componentDidMount();else{var Z=b.elementType===b.type?L.memoizedProps:uo(b.type,L.memoizedProps);V.componentDidUpdate(Z,L.memoizedState,V.__reactInternalSnapshotBeforeUpdate)}var te=b.updateQueue;te!==null&&Dh(b,te,V);break;case 3:var Ve=b.updateQueue;if(Ve!==null){if(L=null,b.child!==null)switch(b.child.tag){case 5:L=Oe(b.child.stateNode);break;case 1:L=b.child.stateNode}Dh(b,Ve,L)}break;case 5:var st=b.stateNode;L===null&&b.flags&4&&Un(st,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(Ot&&b.memoizedState===null){var pt=b.alternate;if(pt!==null){var ln=pt.memoizedState;if(ln!==null){var Dn=ln.dehydrated;Dn!==null&&Xt(Dn)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(l(163))}ec||b.flags&512&&p(b)}catch(Qn){$o(b,b.return,Qn)}}if(b===x){xn=null;break}if(L=b.sibling,L!==null){L.return=b.return,xn=L;break}xn=b.return}}function ke(x){for(;xn!==null;){var b=xn;if(b===x){xn=null;break}var L=b.sibling;if(L!==null){L.return=b.return,xn=L;break}xn=b.return}}function Ce(x){for(;xn!==null;){var b=xn;try{switch(b.tag){case 0:case 11:case 15:var L=b.return;try{h(4,b)}catch(pt){$o(b,L,pt)}break;case 1:var V=b.stateNode;if(typeof V.componentDidMount=="function"){var Z=b.return;try{V.componentDidMount()}catch(pt){$o(b,Z,pt)}}var te=b.return;try{p(b)}catch(pt){$o(b,te,pt)}break;case 5:var Ve=b.return;try{p(b)}catch(pt){$o(b,Ve,pt)}}}catch(pt){$o(b,b.return,pt)}if(b===x){xn=null;break}var st=b.sibling;if(st!==null){st.return=b.return,xn=st;break}xn=b.return}}var Ue=0,Ze=1,qe=2,tt=3,ft=4;if(typeof Symbol=="function"&&Symbol.for){var lt=Symbol.for;Ue=lt("selector.component"),Ze=lt("selector.has_pseudo_class"),qe=lt("selector.role"),tt=lt("selector.test_id"),ft=lt("selector.text")}function it(x){var b=Ft(x);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(l(364));return b}if(x=Ti(x),x===null)throw Error(l(362));return x.stateNode.current}function Gt(x,b){switch(b.$$typeof){case Ue:if(x.type===b.value)return!0;break;case Ze:e:{b=b.value,x=[x,0];for(var L=0;L<x.length;){var V=x[L++],Z=x[L++],te=b[Z];if(V.tag!==5||!St(V)){for(;te!=null&&Gt(V,te);)Z++,te=b[Z];if(Z===b.length){b=!0;break e}else for(V=V.child;V!==null;)x.push(V,Z),V=V.sibling}}b=!1}return b;case qe:if(x.tag===5&&tn(x.stateNode,b.value))return!0;break;case ft:if((x.tag===5||x.tag===6)&&(x=Se(x),x!==null&&0<=x.indexOf(b.value)))return!0;break;case tt:if(x.tag===5&&(x=x.memoizedProps["data-testname"],typeof x=="string"&&x.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(l(365))}return!1}function ot(x){switch(x.$$typeof){case Ue:return"<"+(re(x.value)||"Unknown")+">";case Ze:return":has("+(ot(x)||"")+")";case qe:return'[role="'+x.value+'"]';case ft:return'"'+x.value+'"';case tt:return'[data-testname="'+x.value+'"]';default:throw Error(l(365))}}function bt(x,b){var L=[];x=[x,0];for(var V=0;V<x.length;){var Z=x[V++],te=x[V++],Ve=b[te];if(Z.tag!==5||!St(Z)){for(;Ve!=null&&Gt(Z,Ve);)te++,Ve=b[te];if(te===b.length)L.push(Z);else for(Z=Z.child;Z!==null;)x.push(Z,te),Z=Z.sibling}}return L}function mt(x,b){if(!ai)throw Error(l(363));x=it(x),x=bt(x,b),b=[],x=Array.from(x);for(var L=0;L<x.length;){var V=x[L++];if(V.tag===5)St(V)||b.push(V.stateNode);else for(V=V.child;V!==null;)x.push(V),V=V.sibling}return b}var Ut=Math.ceil,gt=s.ReactCurrentDispatcher,kt=s.ReactCurrentOwner,Dt=s.ReactCurrentBatchConfig,Ye=0,at=null,Qt=null,mn=0,cn=0,Fn=Ni(0),Rn=0,Cn=null,an=0,ki=0,bi=0,Di=null,si=null,Ns=0,Ys=1/0;function jr(){Ys=wi()+500}var Po=!1,Zi=null,Si=null,yi=!1,tr=null,ts=0,Oi=0,Cs=null,tc=-1,qo=0;function $i(){return Ye&6?wi():tc!==-1?tc:tc=wi()}function ns(x){return x.mode&1?Ye&2&&mn!==0?mn&-mn:Zl.transition!==null?(qo===0&&(x=Wl,Wl<<=1,!(Wl&4194240)&&(Wl=64),qo=x),qo):(x=Ei,x!==0?x:pn()):1}function Ur(x,b,L){if(50<Oi)throw Oi=0,Cs=null,Error(l(185));var V=ko(x,b);return V===null?null:(Lc(V,b,L),(!(Ye&2)||V!==at)&&(V===at&&(!(Ye&2)&&(ki|=b),Rn===4&&iu(V,mn)),ms(V,L),b===1&&Ye===0&&!(x.mode&1)&&(jr(),zu&&qs())),V)}function ko(x,b){x.lanes|=b;var L=x.alternate;for(L!==null&&(L.lanes|=b),L=x,x=x.return;x!==null;)x.childLanes|=b,L=x.alternate,L!==null&&(L.childLanes|=b),L=x,x=x.return;return L.tag===3?L.stateNode:null}function ms(x,b){var L=x.callbackNode;ql(x,b);var V=jl(x,x===at?mn:0);if(V===0)L!==null&&To(L),x.callbackNode=null,x.callbackPriority=0;else if(b=V&-V,x.callbackPriority!==b){if(L!=null&&To(L),b===1)x.tag===0?Ag(zg.bind(null,x)):Ah(zg.bind(null,x)),On?Zn(function(){Ye===0&&qs()}):Qr(Rc,qs),L=null;else{switch($d(V)){case 1:L=Rc;break;case 4:L=Rp;break;case 16:L=zc;break;case 536870912:L=fs;break;default:L=zc}L=Qp(L,nu.bind(null,x))}x.callbackPriority=b,x.callbackNode=L}}function nu(x,b){if(tc=-1,qo=0,Ye&6)throw Error(l(327));var L=x.callbackNode;if(th()&&x.callbackNode!==L)return null;var V=jl(x,x===at?mn:0);if(V===0)return null;if(V&30||V&x.expiredLanes||b)b=Kp(x,V);else{b=V;var Z=Ye;Ye|=2;var te=$y();(at!==x||mn!==b)&&(jr(),eh(x,b));do try{A1();break}catch(st){Zy(x,st)}while(1);Yd(),gt.current=te,Ye=Z,Qt!==null?b=0:(at=null,mn=0,b=Rn)}if(b!==0){if(b===2&&(Z=Dc(x),Z!==0&&(V=Z,b=Zo(x,Z))),b===1)throw L=Cn,eh(x,0),iu(x,V),ms(x,wi()),L;if(b===6)iu(x,V);else{if(Z=x.current.alternate,!(V&30)&&!Rg(Z)&&(b=Kp(x,V),b===2&&(te=Dc(x),te!==0&&(V=te,b=Zo(x,te))),b===1))throw L=Cn,eh(x,0),iu(x,V),ms(x,wi()),L;switch(x.finishedWork=Z,x.finishedLanes=V,b){case 0:case 1:throw Error(l(345));case 2:Na(x,si);break;case 3:if(iu(x,V),(V&130023424)===V&&(b=Ns+500-wi(),10<b)){if(jl(x,0)!==0)break;if(Z=x.suspendedLanes,(Z&V)!==V){$i(),x.pingedLanes|=x.suspendedLanes&Z;break}x.timeoutHandle=Nt(Na.bind(null,x,si),b);break}Na(x,si);break;case 4:if(iu(x,V),(V&4194240)===V)break;for(b=x.eventTimes,Z=-1;0<V;){var Ve=31-ds(V);te=1<<Ve,Ve=b[Ve],Ve>Z&&(Z=Ve),V&=~te}if(V=Z,V=wi()-V,V=(120>V?120:480>V?480:1080>V?1080:1920>V?1920:3e3>V?3e3:4320>V?4320:1960*Ut(V/1960))-V,10<V){x.timeoutHandle=Nt(Na.bind(null,x,si),V);break}Na(x,si);break;case 5:Na(x,si);break;default:throw Error(l(329))}}}return ms(x,wi()),x.callbackNode===L?nu.bind(null,x):null}function Zo(x,b){var L=Di;return x.current.memoizedState.isDehydrated&&(eh(x,b).flags|=256),x=Kp(x,b),x!==2&&(b=si,si=L,b!==null&&id(b)),x}function id(x){si===null?si=x:si.push.apply(si,x)}function Rg(x){for(var b=x;;){if(b.flags&16384){var L=b.updateQueue;if(L!==null&&(L=L.stores,L!==null))for(var V=0;V<L.length;V++){var Z=L[V],te=Z.getSnapshot;Z=Z.value;try{if(!Eo(te(),Z))return!1}catch{return!1}}}if(L=b.child,b.subtreeFlags&16384&&L!==null)L.return=b,b=L;else{if(b===x)break;for(;b.sibling===null;){if(b.return===null||b.return===x)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function iu(x,b){for(b&=~bi,b&=~ki,x.suspendedLanes|=b,x.pingedLanes&=~b,x=x.expirationTimes;0<b;){var L=31-ds(b),V=1<<L;x[L]=-1,b&=~V}}function zg(x){if(Ye&6)throw Error(l(327));th();var b=jl(x,0);if(!(b&1))return ms(x,wi()),null;var L=Kp(x,b);if(x.tag!==0&&L===2){var V=Dc(x);V!==0&&(b=V,L=Zo(x,V))}if(L===1)throw L=Cn,eh(x,0),iu(x,b),ms(x,wi()),L;if(L===6)throw Error(l(345));return x.finishedWork=x.current.alternate,x.finishedLanes=b,Na(x,si),ms(x,wi()),null}function qy(x){tr!==null&&tr.tag===0&&!(Ye&6)&&th();var b=Ye;Ye|=1;var L=Dt.transition,V=Ei;try{if(Dt.transition=null,Ei=1,x)return x()}finally{Ei=V,Dt.transition=L,Ye=b,!(Ye&6)&&qs()}}function Og(){cn=Fn.current,zi(Fn)}function eh(x,b){x.finishedWork=null,x.finishedLanes=0;var L=x.timeoutHandle;if(L!==wn&&(x.timeoutHandle=wn,qt(L)),Qt!==null)for(L=Qt.return;L!==null;){var V=L;switch(Fh(V),V.tag){case 1:V=V.type.childContextTypes,V!=null&&lo();break;case 3:jc(),zi(qi),zi(Nr),Up();break;case 5:pl(V);break;case 4:jc();break;case 13:zi(Tr);break;case 19:zi(Tr);break;case 10:Bc(V.type._context);break;case 22:case 23:Og()}L=L.return}if(at=x,Qt=x=nh(x.current,null),mn=cn=b,Rn=0,Cn=null,bi=ki=an=0,si=Di=null,Vo!==null){for(b=0;b<Vo.length;b++)if(L=Vo[b],V=L.interleaved,V!==null){L.interleaved=null;var Z=V.next,te=L.pending;if(te!==null){var Ve=te.next;te.next=Z,V.next=Ve}L.pending=V}Vo=null}return x}function Zy(x,b){do{var L=Qt;try{if(Yd(),Qd.current=Zh,Vu){for(var V=Er.memoizedState;V!==null;){var Z=V.queue;Z!==null&&(Z.pending=null),V=V.next}Vu=!1}if(Jl=0,es=Es=Er=null,Kl=!1,_o=0,kt.current=null,L===null||L.return===null){Rn=1,Cn=b,Qt=null;break}e:{var te=x,Ve=L.return,st=L,pt=b;if(b=mn,st.flags|=32768,pt!==null&&typeof pt=="object"&&typeof pt.then=="function"){var ln=pt,Dn=st,Qn=Dn.tag;if(!(Dn.mode&1)&&(Qn===0||Qn===11||Qn===15)){var Gn=Dn.alternate;Gn?(Dn.updateQueue=Gn.updateQueue,Dn.memoizedState=Gn.memoizedState,Dn.lanes=Gn.lanes):(Dn.updateQueue=null,Dn.memoizedState=null)}var Ci=qp(Ve);if(Ci!==null){Ci.flags&=-257,Xh(Ci,Ve,st,te,b),Ci.mode&1&&uf(te,ln,b),b=Ci,pt=ln;var In=b.updateQueue;if(In===null){var Hi=new Set;Hi.add(pt),b.updateQueue=Hi}else In.add(pt);break e}else{if(!(b&1)){uf(te,ln,b),Fg();break e}pt=Error(l(426))}}else if(Mr&&st.mode&1){var wa=qp(Ve);if(wa!==null){!(wa.flags&65536)&&(wa.flags|=256),Xh(wa,Ve,st,te,b),Kd(pt);break e}}te=pt,Rn!==4&&(Rn=2),Di===null?Di=[te]:Di.push(te),pt=lf(pt,st),st=Ve;do{switch(st.tag){case 3:st.flags|=65536,b&=-b,st.lanes|=b;var _t=jp(st,pt,b);kh(st,_t);break e;case 1:te=pt;var ct=st.type,Mt=st.stateNode;if(!(st.flags&128)&&(typeof ct.getDerivedStateFromError=="function"||Mt!==null&&typeof Mt.componentDidCatch=="function"&&(Si===null||!Si.has(Mt)))){st.flags|=65536,b&=-b,st.lanes|=b;var Mn=cf(st,te,b);kh(st,Mn);break e}}st=st.return}while(st!==null)}I1(L)}catch(Hn){b=Hn,Qt===L&&L!==null&&(Qt=L=L.return);continue}break}while(1)}function $y(){var x=gt.current;return gt.current=Zh,x===null?Zh:x}function Fg(){(Rn===0||Rn===3||Rn===2)&&(Rn=4),at===null||!(an&268435455)&&!(ki&268435455)||iu(at,mn)}function Kp(x,b){var L=Ye;Ye|=2;var V=$y();at===x&&mn===b||eh(x,b);do try{E1();break}catch(Z){Zy(x,Z)}while(1);if(Yd(),Ye=L,gt.current=V,Qt!==null)throw Error(l(261));return at=null,mn=0,Rn}function E1(){for(;Qt!==null;)C1(Qt)}function A1(){for(;Qt!==null&&!Eg();)C1(Qt)}function C1(x){var b=nc(x.alternate,x,cn);x.memoizedProps=x.pendingProps,b===null?I1(x):Qt=b,kt.current=null}function I1(x){var b=x;do{var L=b.alternate;if(x=b.return,b.flags&32768){if(L=Dg(L,b),L!==null){L.flags&=32767,Qt=L;return}if(x!==null)x.flags|=32768,x.subtreeFlags=0,x.deletions=null;else{Rn=6,Qt=null;return}}else if(L=jy(L,b,cn),L!==null){Qt=L;return}if(b=b.sibling,b!==null){Qt=b;return}Qt=b=x}while(b!==null);Rn===0&&(Rn=5)}function Na(x,b){var L=Ei,V=Dt.transition;try{Dt.transition=null,Ei=1,P1(x,b,L)}finally{Dt.transition=V,Ei=L}return null}function P1(x,b,L){do th();while(tr!==null);if(Ye&6)throw Error(l(327));var V=x.finishedWork,Z=x.finishedLanes;if(V===null)return null;if(x.finishedWork=null,x.finishedLanes=0,V===x.current)throw Error(l(177));x.callbackNode=null,x.callbackPriority=0;var te=V.lanes|V.childLanes;if(co(x,te),x===at&&(Qt=at=null,mn=0),!(V.subtreeFlags&2064)&&!(V.flags&2064)||yi||(yi=!0,Qp(zc,function(){return th(),null})),te=(V.flags&15990)!==0,V.subtreeFlags&15990||te){te=Dt.transition,Dt.transition=null;var Ve=Ei;Ei=1;var st=Ye;Ye|=4,kt.current=null,nd(x,V),we(x,V),Pe(x.containerInfo),x.current=V,Me(V),Xd(),Ye=st,Ei=Ve,Dt.transition=te}else x.current=V;if(yi&&(yi=!1,tr=x,ts=Z),te=x.pendingLanes,te===0&&(Si=null),sl(V.stateNode),ms(x,wi()),b!==null)for(L=x.onRecoverableError,V=0;V<b.length;V++)L(b[V]);if(Po)throw Po=!1,x=Zi,Zi=null,x;return ts&1&&x.tag!==0&&th(),te=x.pendingLanes,te&1?x===Cs?Oi++:(Oi=0,Cs=x):Oi=0,qs(),null}function th(){if(tr!==null){var x=$d(ts),b=Dt.transition,L=Ei;try{if(Dt.transition=null,Ei=16>x?16:x,tr===null)var V=!1;else{if(x=tr,tr=null,ts=0,Ye&6)throw Error(l(331));var Z=Ye;for(Ye|=4,xn=x.current;xn!==null;){var te=xn,Ve=te.child;if(xn.flags&16){var st=te.deletions;if(st!==null){for(var pt=0;pt<st.length;pt++){var ln=st[pt];for(xn=ln;xn!==null;){var Dn=xn;switch(Dn.tag){case 0:case 11:case 15:y(8,Dn,te)}var Qn=Dn.child;if(Qn!==null)Qn.return=Dn,xn=Qn;else for(;xn!==null;){Dn=xn;var Gn=Dn.sibling,Ci=Dn.return;if(I(Dn),Dn===ln){xn=null;break}if(Gn!==null){Gn.return=Ci,xn=Gn;break}xn=Ci}}}var In=te.alternate;if(In!==null){var Hi=In.child;if(Hi!==null){In.child=null;do{var wa=Hi.sibling;Hi.sibling=null,Hi=wa}while(Hi!==null)}}xn=te}}if(te.subtreeFlags&2064&&Ve!==null)Ve.return=te,xn=Ve;else e:for(;xn!==null;){if(te=xn,te.flags&2048)switch(te.tag){case 0:case 11:case 15:y(9,te,te.return)}var _t=te.sibling;if(_t!==null){_t.return=te.return,xn=_t;break e}xn=te.return}}var ct=x.current;for(xn=ct;xn!==null;){Ve=xn;var Mt=Ve.child;if(Ve.subtreeFlags&2064&&Mt!==null)Mt.return=Ve,xn=Mt;else e:for(Ve=ct;xn!==null;){if(st=xn,st.flags&2048)try{switch(st.tag){case 0:case 11:case 15:h(9,st)}}catch(Hn){$o(st,st.return,Hn)}if(st===Ve){xn=null;break e}var Mn=st.sibling;if(Mn!==null){Mn.return=st.return,xn=Mn;break e}xn=st.return}}if(Ye=Z,qs(),Uo&&typeof Uo.onPostCommitFiberRoot=="function")try{Uo.onPostCommitFiberRoot(rl,x)}catch{}V=!0}return V}finally{Ei=L,Dt.transition=b}}return!1}function Xy(x,b,L){b=lf(L,b),b=jp(x,b,1),La(x,b),b=$i(),x=ko(x,1),x!==null&&(Lc(x,1,b),ms(x,b))}function $o(x,b,L){if(x.tag===3)Xy(x,x,L);else for(;b!==null;){if(b.tag===3){Xy(b,x,L);break}else if(b.tag===1){var V=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof V.componentDidCatch=="function"&&(Si===null||!Si.has(V))){x=lf(L,x),x=cf(b,x,1),La(b,x),x=$i(),b=ko(b,1),b!==null&&(Lc(b,1,x),ms(b,x));break}}b=b.return}}function Bg(x,b,L){var V=x.pingCache;V!==null&&V.delete(b),b=$i(),x.pingedLanes|=x.suspendedLanes&L,at===x&&(mn&L)===L&&(Rn===4||Rn===3&&(mn&130023424)===mn&&500>wi()-Ns?eh(x,0):bi|=L),ms(x,b)}function Yy(x,b){b===0&&(x.mode&1?(b=Hl,Hl<<=1,!(Hl&130023424)&&(Hl=4194304)):b=1);var L=$i();x=ko(x,b),x!==null&&(Lc(x,b,L),ms(x,L))}function Jy(x){var b=x.memoizedState,L=0;b!==null&&(L=b.retryLane),Yy(x,L)}function Ng(x,b){var L=0;switch(x.tag){case 13:var V=x.stateNode,Z=x.memoizedState;Z!==null&&(L=Z.retryLane);break;case 19:V=x.stateNode;break;default:throw Error(l(314))}V!==null&&V.delete(b),Yy(x,L)}var nc;nc=function(x,b,L){if(x!==null)if(x.memoizedProps!==b.pendingProps||qi.current)Io=!0;else{if(!(x.lanes&L)&&!(b.flags&128))return Io=!1,kg(x,b,L);Io=!!(x.flags&131072)}else Io=!1,Mr&&b.flags&1048576&&zh(b,Rh,b.index);switch(b.lanes=0,b.tag){case 2:var V=b.type;x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2),x=b.pendingProps;var Z=ni(b,Nr.current);Nc(b,L),Z=ml(null,b,V,x,Z,L);var te=gl();return b.flags|=1,typeof Z=="object"&&Z!==null&&typeof Z.render=="function"&&Z.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,Jn(V)?(te=!0,Gl(b)):te=!1,b.memoizedState=Z.state!==null&&Z.state!==void 0?Z.state:null,Ai(b),Z.updater=Ra,b.stateNode=Z,Z._reactInternals=b,Nu(b,V,x,L),b=df(null,b,V,!0,te,L)):(b.tag=0,Mr&&te&&Oh(b),Xs(null,b,Z,L),b=b.child),b;case 16:V=b.elementType;e:{switch(x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2),x=b.pendingProps,Z=V._init,V=Z(V._payload),b.type=V,Z=b.tag=nT(V),x=uo(V,x),Z){case 0:b=dn(null,b,V,x,L);break e;case 1:b=Yp(null,b,V,x,L);break e;case 11:b=Ba(null,b,V,x,L);break e;case 14:b=Xp(null,b,V,uo(V.type,x),L);break e}throw Error(l(306,V,""))}return b;case 0:return V=b.type,Z=b.pendingProps,Z=b.elementType===V?Z:uo(V,Z),dn(x,b,V,Z,L);case 1:return V=b.type,Z=b.pendingProps,Z=b.elementType===V?Z:uo(V,Z),Yp(x,b,V,Z,L);case 3:e:{if(xl(b),x===null)throw Error(l(387));V=b.pendingProps,te=b.memoizedState,Z=te.element,zp(x,b),Xl(b,V,null,L);var Ve=b.memoizedState;if(V=Ve.element,Ot&&te.isDehydrated)if(te={element:V,isDehydrated:!1,cache:Ve.cache,transitions:Ve.transitions},b.updateQueue.baseState=te,b.memoizedState=te,b.flags&256){Z=Error(l(423)),b=Yu(x,b,V,L,Z);break e}else if(V!==Z){Z=Error(l(424)),b=Yu(x,b,V,L,Z);break e}else for(Ot&&(mo=ve(b.stateNode.containerInfo),po=b,Mr=!0,Bs=null,hl=!1),L=Cg(b,null,V,L),b.child=L;L;)L.flags=L.flags&-3|4096,L=L.sibling;else{if(dl(),V===Z){b=ya(x,b,L);break e}Xs(x,b,V,L)}b=b.child}return b;case 5:return Np(b),x===null&&Go(b),V=b.type,Z=b.pendingProps,te=x!==null?x.memoizedProps:null,Ve=Z.children,et(V,Z)?Ve=null:te!==null&&et(V,te)&&(b.flags|=32),Jh(x,b),Xs(x,b,Ve,L),b.child;case 6:return x===null&&Go(b),null;case 13:return ff(x,b,L);case 4:return Bp(b,b.stateNode.containerInfo),V=b.pendingProps,x===null?b.child=fl(b,null,V,L):Xs(x,b,V,L),b.child;case 11:return V=b.type,Z=b.pendingProps,Z=b.elementType===V?Z:uo(V,Z),Ba(x,b,V,Z,L);case 7:return Xs(x,b,b.pendingProps,L),b.child;case 8:return Xs(x,b,b.pendingProps.children,L),b.child;case 12:return Xs(x,b,b.pendingProps.children,L),b.child;case 10:e:{if(V=b.type._context,Z=b.pendingProps,te=b.memoizedProps,Ve=Z.value,Ih(b,V,Ve),te!==null)if(Eo(te.value,Ve)){if(te.children===Z.children&&!qi.current){b=ya(x,b,L);break e}}else for(te=b.child,te!==null&&(te.return=b);te!==null;){var st=te.dependencies;if(st!==null){Ve=te.child;for(var pt=st.firstContext;pt!==null;){if(pt.context===V){if(te.tag===1){pt=Ao(-1,L&-L),pt.tag=2;var ln=te.updateQueue;if(ln!==null){ln=ln.shared;var Dn=ln.pending;Dn===null?pt.next=pt:(pt.next=Dn.next,Dn.next=pt),ln.pending=pt}}te.lanes|=L,pt=te.alternate,pt!==null&&(pt.lanes|=L),Ph(te.return,L,b),st.lanes|=L;break}pt=pt.next}}else if(te.tag===10)Ve=te.type===b.type?null:te.child;else if(te.tag===18){if(Ve=te.return,Ve===null)throw Error(l(341));Ve.lanes|=L,st=Ve.alternate,st!==null&&(st.lanes|=L),Ph(Ve,L,b),Ve=te.sibling}else Ve=te.child;if(Ve!==null)Ve.return=te;else for(Ve=te;Ve!==null;){if(Ve===b){Ve=null;break}if(te=Ve.sibling,te!==null){te.return=Ve.return,Ve=te;break}Ve=Ve.return}te=Ve}Xs(x,b,Z.children,L),b=b.child}return b;case 9:return Z=b.type,V=b.pendingProps.children,Nc(b,L),Z=Fs(Z),V=V(Z),b.flags|=1,Xs(x,b,V,L),b.child;case 14:return V=b.type,Z=uo(V,b.pendingProps),Z=uo(V.type,Z),Xp(x,b,V,Z,L);case 15:return tu(x,b,b.type,b.pendingProps,L);case 17:return V=b.type,Z=b.pendingProps,Z=b.elementType===V?Z:uo(V,Z),x!==null&&(x.alternate=null,b.alternate=null,b.flags|=2),b.tag=1,Jn(V)?(x=!0,Gl(b)):x=!1,Nc(b,L),Lh(b,V,Z),Nu(b,V,Z,L),df(null,b,V,!0,x,L);case 19:return Jp(x,b,L);case 22:return _a(x,b,L)}throw Error(l(156,b.tag))};function Qp(x,b){return Qr(x,b)}function k1(x,b,L,V){this.tag=x,this.key=L,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=V,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xa(x,b,L,V){return new k1(x,b,L,V)}function Ky(x){return x=x.prototype,!(!x||!x.isReactComponent)}function nT(x){if(typeof x=="function")return Ky(x)?1:0;if(x!=null){if(x=x.$$typeof,x===k)return 11;if(x===F)return 14}return 2}function nh(x,b){var L=x.alternate;return L===null?(L=xa(x.tag,b,x.key,x.mode),L.elementType=x.elementType,L.type=x.type,L.stateNode=x.stateNode,L.alternate=x,x.alternate=L):(L.pendingProps=b,L.type=x.type,L.flags=0,L.subtreeFlags=0,L.deletions=null),L.flags=x.flags&14680064,L.childLanes=x.childLanes,L.lanes=x.lanes,L.child=x.child,L.memoizedProps=x.memoizedProps,L.memoizedState=x.memoizedState,L.updateQueue=x.updateQueue,b=x.dependencies,L.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},L.sibling=x.sibling,L.index=x.index,L.ref=x.ref,L}function yf(x,b,L,V,Z,te){var Ve=2;if(V=x,typeof x=="function")Ky(x)&&(Ve=1);else if(typeof x=="string")Ve=5;else e:switch(x){case _:return wl(L.children,Z,te,b);case S:Ve=8,Z|=8;break;case T:return x=xa(12,L,b,Z|2),x.elementType=T,x.lanes=te,x;case R:return x=xa(13,L,b,Z),x.elementType=R,x.lanes=te,x;case O:return x=xa(19,L,b,Z),x.elementType=O,x.lanes=te,x;case G:return ru(L,Z,te,b);default:if(typeof x=="object"&&x!==null)switch(x.$$typeof){case C:Ve=10;break e;case P:Ve=9;break e;case k:Ve=11;break e;case F:Ve=14;break e;case N:Ve=16,V=null;break e}throw Error(l(130,x==null?x:typeof x,""))}return b=xa(Ve,L,b,Z),b.elementType=x,b.type=V,b.lanes=te,b}function wl(x,b,L,V){return x=xa(7,x,V,b),x.lanes=L,x}function ru(x,b,L,V){return x=xa(22,x,V,b),x.elementType=G,x.lanes=L,x.stateNode={},x}function bl(x,b,L){return x=xa(6,x,null,b),x.lanes=L,x}function va(x,b,L){return b=xa(4,x.children!==null?x.children:[],x.key,b),b.lanes=L,b.stateNode={containerInfo:x.containerInfo,pendingChildren:null,implementation:x.implementation},b}function ih(x,b,L,V,Z){this.tag=b,this.containerInfo=x,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=wn,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ru(0),this.expirationTimes=Ru(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ru(0),this.identifierPrefix=V,this.onRecoverableError=Z,Ot&&(this.mutableSourceEagerHydrationData=null)}function su(x,b,L,V,Z,te,Ve,st,pt){return x=new ih(x,b,L,st,pt),b===1?(b=1,te===!0&&(b|=8)):b=0,te=xa(3,null,null,b),x.current=te,te.stateNode=x,te.memoizedState={element:V,isDehydrated:L,cache:null,transitions:null},Ai(te),x}function rh(x){if(!x)return yr;x=x._reactInternals;e:{if(ne(x)!==x||x.tag!==1)throw Error(l(170));var b=x;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(Jn(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(l(171))}if(x.tag===1){var L=x.type;if(Jn(L))return ri(x,L,b)}return b}function D1(x){var b=x._reactInternals;if(b===void 0)throw typeof x.render=="function"?Error(l(188)):(x=Object.keys(x).join(","),Error(l(268,x)));return x=$e(b),x===null?null:x.stateNode}function L1(x,b){if(x=x.memoizedState,x!==null&&x.dehydrated!==null){var L=x.retryLane;x.retryLane=L!==0&&L<b?L:b}}function Qy(x,b){L1(x,b),(x=x.alternate)&&L1(x,b)}function iT(x){return x=$e(x),x===null?null:x.stateNode}function R1(){return null}return t.attemptContinuousHydration=function(x){if(x.tag===13){var b=$i();Ur(x,134217728,b),Qy(x,134217728)}},t.attemptHydrationAtCurrentPriority=function(x){if(x.tag===13){var b=$i(),L=ns(x);Ur(x,L,b),Qy(x,L)}},t.attemptSynchronousHydration=function(x){switch(x.tag){case 3:var b=x.stateNode;if(b.current.memoizedState.isDehydrated){var L=il(b.pendingLanes);L!==0&&(vr(b,L|1),ms(b,wi()),!(Ye&6)&&(jr(),qs()))}break;case 13:var V=$i();qy(function(){return Ur(x,1,V)}),Qy(x,1)}},t.batchedUpdates=function(x,b){var L=Ye;Ye|=1;try{return x(b)}finally{Ye=L,Ye===0&&(jr(),zu&&qs())}},t.createComponentSelector=function(x){return{$$typeof:Ue,value:x}},t.createContainer=function(x,b,L,V,Z,te,Ve){return su(x,b,!1,null,L,V,Z,te,Ve)},t.createHasPseudoClassSelector=function(x){return{$$typeof:Ze,value:x}},t.createHydrationContainer=function(x,b,L,V,Z,te,Ve,st,pt){return x=su(L,V,!0,x,Z,te,Ve,st,pt),x.context=rh(null),L=x.current,V=$i(),Z=ns(L),te=Ao(V,Z),te.callback=b??null,La(L,te),x.current.lanes=Z,Lc(x,Z,V),ms(x,V),x},t.createPortal=function(x,b,L){var V=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:m,key:V==null?null:""+V,children:x,containerInfo:b,implementation:L}},t.createRoleSelector=function(x){return{$$typeof:qe,value:x}},t.createTestNameSelector=function(x){return{$$typeof:tt,value:x}},t.createTextSelector=function(x){return{$$typeof:ft,value:x}},t.deferredUpdates=function(x){var b=Ei,L=Dt.transition;try{return Dt.transition=null,Ei=16,x()}finally{Ei=b,Dt.transition=L}},t.discreteUpdates=function(x,b,L,V,Z){var te=Ei,Ve=Dt.transition;try{return Dt.transition=null,Ei=1,x(b,L,V,Z)}finally{Ei=te,Dt.transition=Ve,Ye===0&&jr()}},t.findAllNodes=mt,t.findBoundingRects=function(x,b){if(!ai)throw Error(l(363));b=mt(x,b),x=[];for(var L=0;L<b.length;L++)x.push(Be(b[L]));for(b=x.length-1;0<b;b--){L=x[b];for(var V=L.x,Z=V+L.width,te=L.y,Ve=te+L.height,st=b-1;0<=st;st--)if(b!==st){var pt=x[st],ln=pt.x,Dn=ln+pt.width,Qn=pt.y,Gn=Qn+pt.height;if(V>=ln&&te>=Qn&&Z<=Dn&&Ve<=Gn){x.splice(b,1);break}else if(V!==ln||L.width!==pt.width||Gn<te||Qn>Ve){if(!(te!==Qn||L.height!==pt.height||Dn<V||ln>Z)){ln>V&&(pt.width+=ln-V,pt.x=V),Dn<Z&&(pt.width=Z-ln),x.splice(b,1);break}}else{Qn>te&&(pt.height+=Qn-te,pt.y=te),Gn<Ve&&(pt.height=Ve-Qn),x.splice(b,1);break}}}return x},t.findHostInstance=D1,t.findHostInstanceWithNoPortals=function(x){return x=De(x),x=x!==null?le(x):null,x===null?null:x.stateNode},t.findHostInstanceWithWarning=function(x){return D1(x)},t.flushControlled=function(x){var b=Ye;Ye|=1;var L=Dt.transition,V=Ei;try{Dt.transition=null,Ei=1,x()}finally{Ei=V,Dt.transition=L,Ye=b,Ye===0&&(jr(),qs())}},t.flushPassiveEffects=th,t.flushSync=qy,t.focusWithin=function(x,b){if(!ai)throw Error(l(363));for(x=it(x),b=bt(x,b),b=Array.from(b),x=0;x<b.length;){var L=b[x++];if(!St(L)){if(L.tag===5&&nn(L.stateNode))return!0;for(L=L.child;L!==null;)b.push(L),L=L.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Ei},t.getFindAllNodesFailureDescription=function(x,b){if(!ai)throw Error(l(363));var L=0,V=[];x=[it(x),0];for(var Z=0;Z<x.length;){var te=x[Z++],Ve=x[Z++],st=b[Ve];if((te.tag!==5||!St(te))&&(Gt(te,st)&&(V.push(ot(st)),Ve++,Ve>L&&(L=Ve)),Ve<b.length))for(te=te.child;te!==null;)x.push(te,Ve),te=te.sibling}if(L<b.length){for(x=[];L<b.length;L++)x.push(ot(b[L]));return`findAllNodes was able to match part of the selector:
  `+(V.join(" > ")+`

No matching component was found for:
  `)+x.join(" > ")}return null},t.getPublicRootInstance=function(x){if(x=x.current,!x.child)return null;switch(x.child.tag){case 5:return Oe(x.child.stateNode);default:return x.child.stateNode}},t.injectIntoDevTools=function(x){if(x={bundleType:x.bundleType,version:x.version,rendererPackageName:x.rendererPackageName,rendererConfig:x.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:iT,findFiberByHostInstance:x.findFiberByHostInstance||R1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")x=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)x=!0;else{try{rl=b.inject(x),Uo=b}catch{}x=!!b.checkDCE}}return x},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(x,b,L,V){if(!ai)throw Error(l(363));x=mt(x,b);var Z=fn(x,L,V).disconnect;return{disconnect:function(){Z()}}},t.registerMutableSourceForHydration=function(x,b){var L=b._getVersion;L=L(b._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[b,L]:x.mutableSourceEagerHydrationData.push(b,L)},t.runWithPriority=function(x,b){var L=Ei;try{return Ei=x,b()}finally{Ei=L}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(x,b,L,V){var Z=b.current,te=$i(),Ve=ns(Z);return L=rh(L),b.context===null?b.context=L:b.pendingContext=L,b=Ao(te,Ve),b.payload={element:x},V=V===void 0?null:V,V!==null&&(b.callback=V),La(Z,b),x=Ur(Z,Ve,te),x!==null&&ll(x,Z,Ve),Ve},t};(function(n){n.exports=Ooe})(Doe);const Foe=BF(cI);var aM={},Boe={get exports(){return aM},set exports(n){aM=n}},YV={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(ce,Te){var Pe=ce.length;ce.push(Te);e:for(;0<Pe;){var Qe=Pe-1>>>1,Ne=ce[Qe];if(0<r(Ne,Te))ce[Qe]=Te,ce[Pe]=Ne,Pe=Qe;else break e}}function t(ce){return ce.length===0?null:ce[0]}function i(ce){if(ce.length===0)return null;var Te=ce[0],Pe=ce.pop();if(Pe!==Te){ce[0]=Pe;e:for(var Qe=0,Ne=ce.length,nt=Ne>>>1;Qe<nt;){var ze=2*(Qe+1)-1,et=ce[ze],Et=ze+1,Nt=ce[Et];if(0>r(et,Pe))Et<Ne&&0>r(Nt,et)?(ce[Qe]=Nt,ce[Et]=Pe,Qe=Et):(ce[Qe]=et,ce[ze]=Pe,Qe=ze);else if(Et<Ne&&0>r(Nt,Pe))ce[Qe]=Nt,ce[Et]=Pe,Qe=Et;else break e}}return Te}function r(ce,Te){var Pe=ce.sortIndex-Te.sortIndex;return Pe!==0?Pe:ce.id-Te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,s=l.now();n.unstable_now=function(){return l.now()-s}}var d=[],m=[],_=1,S=null,T=3,C=!1,P=!1,k=!1,R=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,F=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(ce){for(var Te=t(m);Te!==null;){if(Te.callback===null)i(m);else if(Te.startTime<=ce)i(m),Te.sortIndex=Te.expirationTime,e(d,Te);else break;Te=t(m)}}function G(ce){if(k=!1,N(ce),!P)if(t(d)!==null)P=!0,Oe(j);else{var Te=t(m);Te!==null&&We(G,Te.startTime-ce)}}function j(ce,Te){P=!1,k&&(k=!1,O($),$=-1),C=!0;var Pe=T;try{for(N(Te),S=t(d);S!==null&&(!(S.expirationTime>Te)||ce&&!De());){var Qe=S.callback;if(typeof Qe=="function"){S.callback=null,T=S.priorityLevel;var Ne=Qe(S.expirationTime<=Te);Te=n.unstable_now(),typeof Ne=="function"?S.callback=Ne:S===t(d)&&i(d),N(Te)}else i(d);S=t(d)}if(S!==null)var nt=!0;else{var ze=t(m);ze!==null&&We(G,ze.startTime-Te),nt=!1}return nt}finally{S=null,T=Pe,C=!1}}var Q=!1,re=null,$=-1,ne=5,ue=-1;function De(){return!(n.unstable_now()-ue<ne)}function $e(){if(re!==null){var ce=n.unstable_now();ue=ce;var Te=!0;try{Te=re(!0,ce)}finally{Te?ae():(Q=!1,re=null)}}else Q=!1}var ae;if(typeof F=="function")ae=function(){F($e)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,fe=le.port2;le.port1.onmessage=$e,ae=function(){fe.postMessage(null)}}else ae=function(){R($e,0)};function Oe(ce){re=ce,Q||(Q=!0,ae())}function We(ce,Te){$=R(function(){ce(n.unstable_now())},Te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ce){ce.callback=null},n.unstable_continueExecution=function(){P||C||(P=!0,Oe(j))},n.unstable_forceFrameRate=function(ce){0>ce||125<ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<ce?Math.floor(1e3/ce):5},n.unstable_getCurrentPriorityLevel=function(){return T},n.unstable_getFirstCallbackNode=function(){return t(d)},n.unstable_next=function(ce){switch(T){case 1:case 2:case 3:var Te=3;break;default:Te=T}var Pe=T;T=Te;try{return ce()}finally{T=Pe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ce,Te){switch(ce){case 1:case 2:case 3:case 4:case 5:break;default:ce=3}var Pe=T;T=ce;try{return Te()}finally{T=Pe}},n.unstable_scheduleCallback=function(ce,Te,Pe){var Qe=n.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?Qe+Pe:Qe):Pe=Qe,ce){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=Pe+Ne,ce={id:_++,callback:Te,priorityLevel:ce,startTime:Pe,expirationTime:Ne,sortIndex:-1},Pe>Qe?(ce.sortIndex=Pe,e(m,ce),t(d)===null&&ce===t(m)&&(k?(O($),$=-1):k=!0,We(G,Pe-Qe))):(ce.sortIndex=Ne,e(d,ce),P||C||(P=!0,Oe(j))),ce},n.unstable_shouldYield=De,n.unstable_wrapCallback=function(ce){var Te=T;return function(){var Pe=T;T=Te;try{return ce.apply(this,arguments)}finally{T=Pe}}}})(YV);(function(n){n.exports=YV})(Boe);const Rk={},Noe=n=>void Object.assign(Rk,n);function Uoe(n,e){function t(_,{args:S=[],attach:T,...C},P){let k=`${_[0].toUpperCase()}${_.slice(1)}`,R;if(_==="primitive"){if(C.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const O=C.object;R=C_(O,{type:_,root:P,attach:T,primitive:!0})}else{const O=Rk[k];if(!O)throw new Error(`R3F: ${k} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(S))throw new Error("R3F: The args prop must be an array!");R=C_(new O(...S),{type:_,root:P,attach:T,memoizedProps:{args:S}})}return R.__r3f.attach===void 0&&(R instanceof Pi?R.__r3f.attach="geometry":R instanceof No&&(R.__r3f.attach="material")),k!=="inject"&&BE(R,C),R}function i(_,S){let T=!1;if(S){var C,P;(C=S.__r3f)!=null&&C.attach?FE(_,S,S.__r3f.attach):S.isObject3D&&_.isObject3D&&(_.add(S),T=!0),T||(P=_.__r3f)==null||P.objects.push(S),S.__r3f||C_(S,{}),S.__r3f.parent=_,hI(S),I_(S)}}function r(_,S,T){let C=!1;if(S){var P,k;if((P=S.__r3f)!=null&&P.attach)FE(_,S,S.__r3f.attach);else if(S.isObject3D&&_.isObject3D){S.parent=_,S.dispatchEvent({type:"added"});const R=_.children.filter(F=>F!==S),O=R.indexOf(T);_.children=[...R.slice(0,O),S,...R.slice(O)],C=!0}C||(k=_.__r3f)==null||k.objects.push(S),S.__r3f||C_(S,{}),S.__r3f.parent=_,hI(S),I_(S)}}function a(_,S,T=!1){_&&[..._].forEach(C=>l(S,C,T))}function l(_,S,T){if(S){var C,P,k;if(S.__r3f&&(S.__r3f.parent=null),(C=_.__r3f)!=null&&C.objects&&(_.__r3f.objects=_.__r3f.objects.filter(G=>G!==S)),(P=S.__r3f)!=null&&P.attach)CF(_,S,S.__r3f.attach);else if(S.isObject3D&&_.isObject3D){var R;_.remove(S),(R=S.__r3f)!=null&&R.root&&Zoe(S.__r3f.root,S)}const F=(k=S.__r3f)==null?void 0:k.primitive,N=T===void 0?S.dispose!==null&&!F:T;if(!F){var O;a((O=S.__r3f)==null?void 0:O.objects,S,N),a(S.children,S,N)}S.__r3f&&(delete S.__r3f.root,delete S.__r3f.objects,delete S.__r3f.handlers,delete S.__r3f.memoizedProps,F||delete S.__r3f),N&&S.dispose&&S.type!=="Scene"&&aM.unstable_scheduleCallback(aM.unstable_IdlePriority,()=>{try{S.dispose()}catch{}}),I_(_)}}function s(_,S,T,C){var P;const k=(P=_.__r3f)==null?void 0:P.parent;if(!k)return;const R=t(S,T,_.__r3f.root);if(_.children){for(const O of _.children)O.__r3f&&i(R,O);_.children=_.children.filter(O=>!O.__r3f)}_.__r3f.objects.forEach(O=>i(R,O)),_.__r3f.objects=[],_.__r3f.autoRemovedBeforeAppend||l(k,_),R.parent&&(R.__r3f.autoRemovedBeforeAppend=!0),i(k,R),R.raycast&&R.__r3f.eventCount&&R.__r3f.root.getState().internal.interaction.push(R),[C,C.alternate].forEach(O=>{O!==null&&(O.stateNode=R,O.ref&&(typeof O.ref=="function"?O.ref(R):O.ref.current=R))})}const d=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Foe({createInstance:t,removeChild:l,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(_,S)=>{if(!S)return;const T=_.getState().scene;T.__r3f&&(T.__r3f.root=_,i(T,S))},removeChildFromContainer:(_,S)=>{S&&l(_.getState().scene,S)},insertInContainerBefore:(_,S,T)=>{if(!S||!T)return;const C=_.getState().scene;C.__r3f&&r(C,S,T)},getRootHostContext:()=>null,getChildHostContext:_=>_,finalizeInitialChildren(_){var S;const T=(S=_==null?void 0:_.__r3f)!=null?S:{};return Boolean(T.handlers)},prepareUpdate(_,S,T,C){if(_.__r3f.primitive&&C.object&&C.object!==_)return[!0];{const{args:P=[],children:k,...R}=C,{args:O=[],children:F,...N}=T;if(!Array.isArray(P))throw new Error("R3F: the args prop must be an array!");if(P.some((j,Q)=>j!==O[Q]))return[!0];const G=i8(_,R,N,!0);return G.changes.length?[!1,G]:null}},commitUpdate(_,[S,T],C,P,k,R){S?s(_,C,k,R):BE(_,T)},commitMount(_,S,T,C){var P;const k=(P=_.__r3f)!=null?P:{};_.raycast&&k.handlers&&k.eventCount&&_.__r3f.root.getState().internal.interaction.push(_)},getPublicInstance:_=>_,prepareForCommit:()=>null,preparePortalMount:_=>C_(_.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(_){var S;const{attach:T,parent:C}=(S=_.__r3f)!=null?S:{};T&&C&&CF(C,_,T),_.isObject3D&&(_.visible=!1),I_(_)},unhideInstance(_,S){var T;const{attach:C,parent:P}=(T=_.__r3f)!=null?T:{};C&&P&&FE(P,_,C),(_.isObject3D&&S.visible==null||S.visible)&&(_.visible=!0),I_(_)},createTextInstance:d,hideTextInstance:d,unhideTextInstance:d,getCurrentEventPriority:()=>e?e():ep.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&$r.fun(performance.now)?performance.now:$r.fun(Date.now)?Date.now:()=>0,scheduleTimeout:$r.fun(setTimeout)?setTimeout:void 0,cancelTimeout:$r.fun(clearTimeout)?clearTimeout:void 0}),applyProps:BE}}var MF,TF;const JV=()=>{var n;return(n=Rk.ColorManagement)!=null?n:null},KV=n=>n&&n.isOrthographicCamera,Voe=n=>n&&n.hasOwnProperty("current"),T1=typeof window<"u"&&((MF=window.document)!=null&&MF.createElement||((TF=window.navigator)==null?void 0:TF.product)==="ReactNative")?$t.useLayoutEffect:$t.useEffect;function QV(n){const e=$t.useRef(n);return T1(()=>void(e.current=n),[n]),e}function Goe({set:n}){return T1(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}class e8 extends $t.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}e8.getDerivedStateFromError=()=>({error:!0});const t8="__default",EF=new Map,Woe=n=>n&&!!n.memoized&&!!n.changes;function n8(n){const e=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(n)?Math.min(Math.max(n[0],e),n[1]):n}const cx=n=>{var e;return(e=n.__r3f)==null?void 0:e.root.getState()},$r={obj:n=>n===Object(n)&&!$r.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:i="reference",strict:r=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if($r.str(n)||$r.num(n))return n===e;const a=$r.obj(n);if(a&&i==="reference")return n===e;const l=$r.arr(n);if(l&&t==="reference")return n===e;if((l||a)&&n===e)return!0;let s;for(s in n)if(!(s in e))return!1;if(a&&t==="shallow"&&i==="shallow"){for(s in r?e:n)if(!$r.equ(n[s],e[s],{strict:r,objects:"reference"}))return!1}else for(s in r?e:n)if(n[s]!==e[s])return!1;if($r.und(s)){if(l&&n.length===0&&e.length===0||a&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function Hoe(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const e in n)e.dispose==null||e.dispose(),delete n[e]}function C_(n,e){const t=n;return(e!=null&&e.primitive||!t.__r3f)&&(t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e}),n}function uI(n,e){let t=n;if(e.includes("-")){const i=e.split("-"),r=i.pop();return t=i.reduce((a,l)=>a[l],n),{target:t,key:r}}else return{target:t,key:e}}const AF=/-\d+$/;function FE(n,e,t){if($r.str(t)){if(AF.test(t)){const a=t.replace(AF,""),{target:l,key:s}=uI(n,a);Array.isArray(l[s])||(l[s]=[])}const{target:i,key:r}=uI(n,t);e.__r3f.previousAttach=i[r],i[r]=e}else e.__r3f.previousAttach=t(n,e)}function CF(n,e,t){var i,r;if($r.str(t)){const{target:a,key:l}=uI(n,t),s=e.__r3f.previousAttach;s===void 0?delete a[l]:a[l]=s}else(i=e.__r3f)==null||i.previousAttach==null||i.previousAttach(n,e);(r=e.__r3f)==null||delete r.previousAttach}function i8(n,{children:e,key:t,ref:i,...r},{children:a,key:l,ref:s,...d}={},m=!1){var _;const S=(_=n==null?void 0:n.__r3f)!=null?_:{},T=Object.entries(r),C=[];if(m){const k=Object.keys(d);for(let R=0;R<k.length;R++)r.hasOwnProperty(k[R])||T.unshift([k[R],t8+"remove"])}T.forEach(([k,R])=>{var O;if((O=n.__r3f)!=null&&O.primitive&&k==="object"||$r.equ(R,d[k]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(k))return C.push([k,R,!0,[]]);let F=[];k.includes("-")&&(F=k.split("-")),C.push([k,R,!1,F]);for(const N in r){const G=r[N];N.startsWith(`${k}-`)&&C.push([N,G,!1,N.split("-")])}});const P={...r};return S.memoizedProps&&S.memoizedProps.args&&(P.args=S.memoizedProps.args),S.memoizedProps&&S.memoizedProps.attach&&(P.attach=S.memoizedProps.attach),{memoized:P,changes:C}}function BE(n,e){var t,i,r;const a=(t=n.__r3f)!=null?t:{},l=a.root,s=(i=l==null||l.getState==null?void 0:l.getState())!=null?i:{},{memoized:d,changes:m}=Woe(e)?e:i8(n,e),_=a.eventCount;n.__r3f&&(n.__r3f.memoizedProps=d);for(let T=0;T<m.length;T++){let[C,P,k,R]=m[T],O=n,F=O[C];if(R.length&&(F=R.reduce((N,G)=>N[G],n),!(F&&F.set))){const[N,...G]=R.reverse();O=G.reverse().reduce((j,Q)=>j[Q],n),C=N}if(P===t8+"remove")if(O.constructor){let N=EF.get(O.constructor);N||(N=new O.constructor,EF.set(O.constructor,N)),P=N[C]}else P=0;if(k)P?a.handlers[C]=P:delete a.handlers[C],a.eventCount=Object.keys(a.handlers).length;else if(F&&F.set&&(F.copy||F instanceof eg)){if(Array.isArray(P))F.fromArray?F.fromArray(P):F.set(...P);else if(F.copy&&P&&P.constructor&&F.constructor===P.constructor)F.copy(P);else if(P!==void 0){const N=F instanceof zn;!N&&F.setScalar?F.setScalar(P):F instanceof eg&&P instanceof eg?F.mask=P.mask:F.set(P),!JV()&&!s.linear&&N&&F.convertSRGBToLinear()}}else O[C]=P,!s.linear&&O[C]instanceof bs&&O[C].format===$a&&O[C].type===Wd&&(O[C].encoding=Ar);I_(n)}if(a.parent&&s.internal&&n.raycast&&_!==a.eventCount){const T=s.internal.interaction.indexOf(n);T>-1&&s.internal.interaction.splice(T,1),a.eventCount&&s.internal.interaction.push(n)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(r=n.__r3f)!=null&&r.parent&&hI(n),n}function I_(n){var e,t;const i=(e=n.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();i&&i.internal.frames===0&&i.invalidate()}function hI(n){n.onUpdate==null||n.onUpdate(n)}function joe(n,e){n.manual||(KV(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function zb(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function qoe(){var n;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return ep.DefaultEventPriority;switch((n=e.event)==null?void 0:n.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ep.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ep.ContinuousEventPriority;default:return ep.DefaultEventPriority}}function r8(n,e,t,i){const r=t.get(e);r&&(t.delete(e),t.size===0&&(n.delete(i),r.target.releasePointerCapture(i)))}function Zoe(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(i=>i!==e),t.initialHits=t.initialHits.filter(i=>i!==e),t.hovered.forEach((i,r)=>{(i.eventObject===e||i.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((i,r)=>{r8(t.capturedMap,e,i,r)})}function $oe(n){function e(d){const{internal:m}=n.getState(),_=d.offsetX-m.initialClick[0],S=d.offsetY-m.initialClick[1];return Math.round(Math.sqrt(_*_+S*S))}function t(d){return d.filter(m=>["Move","Over","Enter","Out","Leave"].some(_=>{var S;return(S=m.__r3f)==null?void 0:S.handlers["onPointer"+_]}))}function i(d,m){const _=n.getState(),S=new Set,T=[],C=m?m(_.internal.interaction):_.internal.interaction;for(let O=0;O<C.length;O++){const F=cx(C[O]);F&&(F.raycaster.camera=void 0)}_.previousRoot||_.events.compute==null||_.events.compute(d,_);function P(O){const F=cx(O);if(!F||!F.events.enabled||F.raycaster.camera===null)return[];if(F.raycaster.camera===void 0){var N;F.events.compute==null||F.events.compute(d,F,(N=F.previousRoot)==null?void 0:N.getState()),F.raycaster.camera===void 0&&(F.raycaster.camera=null)}return F.raycaster.camera?F.raycaster.intersectObject(O,!0):[]}let k=C.flatMap(P).sort((O,F)=>{const N=cx(O.object),G=cx(F.object);return!N||!G?O.distance-F.distance:G.events.priority-N.events.priority||O.distance-F.distance}).filter(O=>{const F=zb(O);return S.has(F)?!1:(S.add(F),!0)});_.events.filter&&(k=_.events.filter(k,_));for(const O of k){let F=O.object;for(;F;){var R;(R=F.__r3f)!=null&&R.eventCount&&T.push({...O,eventObject:F}),F=F.parent}}if("pointerId"in d&&_.internal.capturedMap.has(d.pointerId))for(let O of _.internal.capturedMap.get(d.pointerId).values())S.has(zb(O.intersection))||T.push(O.intersection);return T}function r(d,m,_,S){const T=n.getState();if(d.length){const C={stopped:!1};for(const P of d){const k=cx(P.object)||T,{raycaster:R,pointer:O,camera:F,internal:N}=k,G=new Fe(O.x,O.y,0).unproject(F),j=ue=>{var De,$e;return(De=($e=N.capturedMap.get(ue))==null?void 0:$e.has(P.eventObject))!=null?De:!1},Q=ue=>{const De={intersection:P,target:m.target};N.capturedMap.has(ue)?N.capturedMap.get(ue).set(P.eventObject,De):N.capturedMap.set(ue,new Map([[P.eventObject,De]])),m.target.setPointerCapture(ue)},re=ue=>{const De=N.capturedMap.get(ue);De&&r8(N.capturedMap,P.eventObject,De,ue)};let $={};for(let ue in m){let De=m[ue];typeof De!="function"&&($[ue]=De)}let ne={...P,...$,pointer:O,intersections:d,stopped:C.stopped,delta:_,unprojectedPoint:G,ray:R.ray,camera:F,stopPropagation(){const ue="pointerId"in m&&N.capturedMap.get(m.pointerId);if((!ue||ue.has(P.eventObject))&&(ne.stopped=C.stopped=!0,N.hovered.size&&Array.from(N.hovered.values()).find(De=>De.eventObject===P.eventObject))){const De=d.slice(0,d.indexOf(P));a([...De,P])}},target:{hasPointerCapture:j,setPointerCapture:Q,releasePointerCapture:re},currentTarget:{hasPointerCapture:j,setPointerCapture:Q,releasePointerCapture:re},nativeEvent:m};if(S(ne),C.stopped===!0)break}}return d}function a(d){const{internal:m}=n.getState();for(const _ of m.hovered.values())if(!d.length||!d.find(S=>S.object===_.object&&S.index===_.index&&S.instanceId===_.instanceId)){const T=_.eventObject.__r3f,C=T==null?void 0:T.handlers;if(m.hovered.delete(zb(_)),T!=null&&T.eventCount){const P={..._,intersections:d};C.onPointerOut==null||C.onPointerOut(P),C.onPointerLeave==null||C.onPointerLeave(P)}}}function l(d,m){for(let _=0;_<m.length;_++){const S=m[_].__r3f;S==null||S.handlers.onPointerMissed==null||S.handlers.onPointerMissed(d)}}function s(d){switch(d){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return m=>{const{internal:_}=n.getState();"pointerId"in m&&_.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{_.capturedMap.has(m.pointerId)&&(_.capturedMap.delete(m.pointerId),a([]))})}}return function(_){const{onPointerMissed:S,internal:T}=n.getState();T.lastEvent.current=_;const C=d==="onPointerMove",P=d==="onClick"||d==="onContextMenu"||d==="onDoubleClick",R=i(_,C?t:void 0),O=P?e(_):0;d==="onPointerDown"&&(T.initialClick=[_.offsetX,_.offsetY],T.initialHits=R.map(N=>N.eventObject)),P&&!R.length&&O<=2&&(l(_,T.interaction),S&&S(_)),C&&a(R);function F(N){const G=N.eventObject,j=G.__r3f,Q=j==null?void 0:j.handlers;if(j!=null&&j.eventCount)if(C){if(Q.onPointerOver||Q.onPointerEnter||Q.onPointerOut||Q.onPointerLeave){const re=zb(N),$=T.hovered.get(re);$?$.stopped&&N.stopPropagation():(T.hovered.set(re,N),Q.onPointerOver==null||Q.onPointerOver(N),Q.onPointerEnter==null||Q.onPointerEnter(N))}Q.onPointerMove==null||Q.onPointerMove(N)}else{const re=Q[d];re?(!P||T.initialHits.includes(G))&&(l(_,T.interaction.filter($=>!T.initialHits.includes($))),re(N)):P&&T.initialHits.includes(G)&&l(_,T.interaction.filter($=>!T.initialHits.includes($)))}}r(R,_,O,F)}}return{handlePointer:s}}const s8=n=>!!(n!=null&&n.render),o8=$t.createContext(null),Xoe=(n,e)=>{const t=koe((s,d)=>{const m=new Fe,_=new Fe,S=new Fe;function T(O=d().camera,F=_,N=d().size){const{width:G,height:j,top:Q,left:re}=N,$=G/j;F instanceof Fe?S.copy(F):S.set(...F);const ne=O.getWorldPosition(m).distanceTo(S);if(KV(O))return{width:G/O.zoom,height:j/O.zoom,top:Q,left:re,factor:1,distance:ne,aspect:$};{const ue=O.fov*Math.PI/180,De=2*Math.tan(ue/2)*ne,$e=De*(G/j);return{width:$e,height:De,top:Q,left:re,factor:G/$e,distance:ne,aspect:$}}}let C;const P=O=>s(F=>({performance:{...F.performance,current:O}})),k=new Ht;return{set:s,get:d,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(O=1)=>n(d(),O),advance:(O,F)=>e(O,F,d()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Pk,pointer:k,mouse:k,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const O=d();C&&clearTimeout(C),O.performance.current!==O.performance.min&&P(O.performance.min),C=setTimeout(()=>P(d().performance.max),O.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:T},setEvents:O=>s(F=>({...F,events:{...F.events,...O}})),setSize:(O,F,N,G,j)=>{const Q=d().camera,re={width:O,height:F,top:G||0,left:j||0,updateStyle:N};s($=>({size:re,viewport:{...$.viewport,...T(Q,_,re)}}))},setDpr:O=>s(F=>{const N=n8(O);return{viewport:{...F.viewport,dpr:N,initialDpr:F.viewport.initialDpr||N}}}),setFrameloop:(O="always")=>{const F=d().clock;F.stop(),F.elapsedTime=0,O!=="never"&&(F.start(),F.elapsedTime=0),s(()=>({frameloop:O}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:$t.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(O,F,N)=>{const G=d().internal;return G.priority=G.priority+(F>0?1:0),G.subscribers.push({ref:O,priority:F,store:N}),G.subscribers=G.subscribers.sort((j,Q)=>j.priority-Q.priority),()=>{const j=d().internal;j!=null&&j.subscribers&&(j.priority=j.priority-(F>0?1:0),j.subscribers=j.subscribers.filter(Q=>Q.ref!==O))}}}}}),i=t.getState();let r=i.size,a=i.viewport.dpr,l=i.camera;return t.subscribe(()=>{const{camera:s,size:d,viewport:m,gl:_,set:S}=t.getState();if(d!==r||m.dpr!==a){var T;r=d,a=m.dpr,joe(s,d),_.setPixelRatio(m.dpr);const C=(T=d.updateStyle)!=null?T:typeof HTMLCanvasElement<"u"&&_.domElement instanceof HTMLCanvasElement;_.setSize(d.width,d.height,C)}s!==l&&(l=s,S(C=>({viewport:{...C.viewport,...C.viewport.getCurrentViewport(s)}})))}),t.subscribe(s=>n(s)),t};let Ob,Yoe=new Set,Joe=new Set,Koe=new Set;function NE(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function ux(n,e){switch(n){case"before":return NE(Yoe,e);case"after":return NE(Joe,e);case"tail":return NE(Koe,e)}}let UE,VE;function GE(n,e,t){let i=e.clock.getDelta();for(e.frameloop==="never"&&typeof n=="number"&&(i=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),UE=e.internal.subscribers,Ob=0;Ob<UE.length;Ob++)VE=UE[Ob],VE.ref.current(VE.store.getState(),i,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function Qoe(n){let e=!1,t,i,r;function a(d){i=requestAnimationFrame(a),e=!0,t=0,ux("before",d);for(const _ of n.values()){var m;r=_.store.getState(),r.internal.active&&(r.frameloop==="always"||r.internal.frames>0)&&!((m=r.gl.xr)!=null&&m.isPresenting)&&(t+=GE(d,r))}if(ux("after",d),t===0)return ux("tail",d),e=!1,cancelAnimationFrame(i)}function l(d,m=1){var _;if(!d)return n.forEach(S=>l(S.store.getState()),m);(_=d.gl.xr)!=null&&_.isPresenting||!d.internal.active||d.frameloop==="never"||(d.internal.frames=Math.min(60,d.internal.frames+m),e||(e=!0,requestAnimationFrame(a)))}function s(d,m=!0,_,S){if(m&&ux("before",d),_)GE(d,_,S);else for(const T of n.values())GE(d,T.store.getState());m&&ux("after",d)}return{loop:a,invalidate:l,advance:s}}function a8(){const n=$t.useContext(o8);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function zf(n=t=>t,e){return a8()(n,e)}function l8(n,e=0){const t=a8(),i=t.getState().internal.subscribe,r=QV(n);return T1(()=>i(r,e,t),[e,i,t]),null}const Iy=new Map,{invalidate:IF,advance:PF}=Qoe(Iy),{reconciler:lM,applyProps:hx}=Uoe(Iy,qoe),A_={objects:"shallow",strict:!1},eae=(n,e)=>{const t=typeof n=="function"?n(e):n;return s8(t)?t:new qM({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...n})};function tae(n,e){if(e)return e;if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:t,height:i,top:r,left:a}=n.parentElement.getBoundingClientRect();return{width:t,height:i,top:r,left:a}}else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function nae(n){const e=Iy.get(n),t=e==null?void 0:e.fiber,i=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,a=i||Xoe(IF,PF),l=t||lM.createContainer(a,ep.ConcurrentRoot,null,!1,null,"",r,null);e||Iy.set(n,{fiber:l,store:a});let s,d=!1,m;return{configure(_={}){let{gl:S,size:T,scene:C,events:P,onCreated:k,shadows:R=!1,linear:O=!1,flat:F=!1,legacy:N=!1,orthographic:G=!1,frameloop:j="always",dpr:Q=[1,2],performance:re,raycaster:$,camera:ne,onPointerMissed:ue}=_,De=a.getState(),$e=De.gl;De.gl||De.set({gl:$e=eae(S,n)});let ae=De.raycaster;ae||De.set({raycaster:ae=new $V});const{params:le,...fe}=$||{};if($r.equ(fe,ae,A_)||hx(ae,{...fe}),$r.equ(le,ae.params,A_)||hx(ae,{params:{...ae.params,...le}}),!De.camera||De.camera===m&&!$r.equ(m,ne,A_)){m=ne;const Qe=ne instanceof u1,Ne=Qe?ne:G?new fp(0,0,0,0,.1,1e3):new Yr(75,0,.1,1e3);Qe||(Ne.position.z=5,ne&&hx(Ne,ne),!De.camera&&!(ne!=null&&ne.rotation)&&Ne.lookAt(0,0,0)),De.set({camera:Ne})}if(!De.scene){let Qe;C instanceof sM?Qe=C:(Qe=new sM,C&&hx(Qe,C)),De.set({scene:C_(Qe)})}if(!De.xr){const Qe=(ze,et)=>{const Et=a.getState();Et.frameloop!=="never"&&PF(ze,!0,Et,et)},Ne=()=>{const ze=a.getState();ze.gl.xr.enabled=ze.gl.xr.isPresenting,ze.gl.xr.setAnimationLoop(ze.gl.xr.isPresenting?Qe:null),ze.gl.xr.isPresenting||IF(ze)},nt={connect(){const ze=a.getState().gl;ze.xr.addEventListener("sessionstart",Ne),ze.xr.addEventListener("sessionend",Ne)},disconnect(){const ze=a.getState().gl;ze.xr.removeEventListener("sessionstart",Ne),ze.xr.removeEventListener("sessionend",Ne)}};$e.xr&&nt.connect(),De.set({xr:nt})}if($e.shadowMap){const Qe=$e.shadowMap.enabled,Ne=$e.shadowMap.type;if($e.shadowMap.enabled=!!R,$r.boo(R))$e.shadowMap.type=Gx;else if($r.str(R)){var Oe;const nt={basic:XU,percentage:UM,soft:Gx,variance:Bm};$e.shadowMap.type=(Oe=nt[R])!=null?Oe:Gx}else $r.obj(R)&&Object.assign($e.shadowMap,R);(Qe!==$e.shadowMap.enabled||Ne!==$e.shadowMap.type)&&($e.shadowMap.needsUpdate=!0)}const We=JV();We&&("enabled"in We?We.enabled=!N:"legacyMode"in We&&(We.legacyMode=N));const ce=O?Hd:Ar,Te=F?Au:QP;$e.outputEncoding!==ce&&($e.outputEncoding=ce),$e.toneMapping!==Te&&($e.toneMapping=Te),De.legacy!==N&&De.set(()=>({legacy:N})),De.linear!==O&&De.set(()=>({linear:O})),De.flat!==F&&De.set(()=>({flat:F})),S&&!$r.fun(S)&&!s8(S)&&!$r.equ(S,$e,A_)&&hx($e,S),P&&!De.events.handlers&&De.set({events:P(a)});const Pe=tae(n,T);return $r.equ(Pe,De.size,A_)||De.setSize(Pe.width,Pe.height,Pe.updateStyle,Pe.top,Pe.left),Q&&De.viewport.dpr!==n8(Q)&&De.setDpr(Q),De.frameloop!==j&&De.setFrameloop(j),De.onPointerMissed||De.set({onPointerMissed:ue}),re&&!$r.equ(re,De.performance,A_)&&De.set(Qe=>({performance:{...Qe.performance,...re}})),s=k,d=!0,this},render(_){return d||this.configure(),lM.updateContainer($t.createElement(iae,{store:a,children:_,onCreated:s,rootElement:n}),l,null,()=>{}),a},unmount(){c8(n)}}}function iae({store:n,children:e,onCreated:t,rootElement:i}){return T1(()=>{const r=n.getState();r.set(a=>({internal:{...a.internal,active:!0}})),t&&t(r),n.getState().events.connected||r.events.connect==null||r.events.connect(i)},[]),$t.createElement(o8.Provider,{value:n},e)}function c8(n,e){const t=Iy.get(n),i=t==null?void 0:t.fiber;if(i){const r=t==null?void 0:t.store.getState();r&&(r.internal.active=!1),lM.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var a,l,s,d;r.events.disconnect==null||r.events.disconnect(),(a=r.gl)==null||(l=a.renderLists)==null||l.dispose==null||l.dispose(),(s=r.gl)==null||s.forceContextLoss==null||s.forceContextLoss(),(d=r.gl)!=null&&d.xr&&r.xr.disconnect(),Hoe(r),Iy.delete(n),e&&e(n)}catch{}},500)})}}lM.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:$t.version});function Uv(){return Uv=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Uv.apply(this,arguments)}function dI(n,e,t){var i,r,a,l,s;e==null&&(e=100);function d(){var _=Date.now()-l;_<e&&_>=0?i=setTimeout(d,e-_):(i=null,t||(s=n.apply(a,r),a=r=null))}var m=function(){a=this,r=arguments,l=Date.now();var _=t&&!i;return i||(i=setTimeout(d,e)),_&&(s=n.apply(a,r),a=r=null),s};return m.clear=function(){i&&(clearTimeout(i),i=null)},m.flush=function(){i&&(s=n.apply(a,r),a=r=null,clearTimeout(i),i=null)},m}dI.debounce=dI;var kF=dI;function rae(n){let{debounce:e,scroll:t,polyfill:i,offsetSize:r}=n===void 0?{debounce:0,scroll:!1,offsetSize:!1}:n;const a=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[l,s]=$t.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),d=$t.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:l}),m=e?typeof e=="number"?e:e.scroll:null,_=e?typeof e=="number"?e:e.resize:null,S=$t.useRef(!1);$t.useEffect(()=>(S.current=!0,()=>void(S.current=!1)));const[T,C,P]=$t.useMemo(()=>{const F=()=>{if(!d.current.element)return;const{left:N,top:G,width:j,height:Q,bottom:re,right:$,x:ne,y:ue}=d.current.element.getBoundingClientRect(),De={left:N,top:G,width:j,height:Q,bottom:re,right:$,x:ne,y:ue};d.current.element instanceof HTMLElement&&r&&(De.height=d.current.element.offsetHeight,De.width=d.current.element.offsetWidth),Object.freeze(De),S.current&&!lae(d.current.lastBounds,De)&&s(d.current.lastBounds=De)};return[F,_?kF(F,_):F,m?kF(F,m):F]},[s,r,m,_]);function k(){d.current.scrollContainers&&(d.current.scrollContainers.forEach(F=>F.removeEventListener("scroll",P,!0)),d.current.scrollContainers=null),d.current.resizeObserver&&(d.current.resizeObserver.disconnect(),d.current.resizeObserver=null)}function R(){d.current.element&&(d.current.resizeObserver=new a(P),d.current.resizeObserver.observe(d.current.element),t&&d.current.scrollContainers&&d.current.scrollContainers.forEach(F=>F.addEventListener("scroll",P,{capture:!0,passive:!0})))}const O=F=>{!F||F===d.current.element||(k(),d.current.element=F,d.current.scrollContainers=u8(F),R())};return oae(P,Boolean(t)),sae(C),$t.useEffect(()=>{k(),R()},[t,P,C]),$t.useEffect(()=>k,[]),[O,l,T]}function sae(n){$t.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function oae(n,e){$t.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,e])}function u8(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:i,overflowY:r}=window.getComputedStyle(n);return[t,i,r].some(a=>a==="auto"||a==="scroll")&&e.push(n),[...e,...u8(n.parentElement)]}const aae=["x","y","top","bottom","left","right","width","height"],lae=(n,e)=>aae.every(t=>n[t]===e[t]);var cae=Object.defineProperty,uae=Object.defineProperties,hae=Object.getOwnPropertyDescriptors,DF=Object.getOwnPropertySymbols,dae=Object.prototype.hasOwnProperty,fae=Object.prototype.propertyIsEnumerable,LF=(n,e,t)=>e in n?cae(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,RF=(n,e)=>{for(var t in e||(e={}))dae.call(e,t)&&LF(n,t,e[t]);if(DF)for(var t of DF(e))fae.call(e,t)&&LF(n,t,e[t]);return n},pae=(n,e)=>uae(n,hae(e));function h8(n,e,t){if(!n)return;if(t(n)===!0)return n;let i=e?n.return:n.child;for(;i;){const r=h8(i,e,t);if(r)return r;i=e?null:i.sibling}}function d8(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const zk=d8($t.createContext(null));class f8 extends $t.Component{render(){return $t.createElement(zk.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:zF,ReactCurrentDispatcher:OF}=$t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function mae(){const n=$t.useContext(zk);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=$t.useId();return $t.useMemo(()=>{var i;return(i=zF==null?void 0:zF.current)!=null?i:h8(n,!1,r=>{let a=r.memoizedState;for(;a;){if(a.memoizedState===e)return!0;a=a.next}})},[n,e])}function gae(){var n,e;const t=mae(),[i]=$t.useState(()=>new Map);i.clear();let r=t;for(;r;){const a=(n=r.type)==null?void 0:n._context;a&&a!==zk&&!i.has(a)&&i.set(a,(e=OF==null?void 0:OF.current)==null?void 0:e.readContext(d8(a))),r=r.return}return $t.useMemo(()=>Array.from(i.keys()).reduce((a,l)=>s=>$t.createElement(a,null,$t.createElement(l.Provider,pae(RF({},s),{value:i.get(l)}))),a=>$t.createElement(f8,RF({},a))),[i])}const WE={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function _ae(n){const{handlePointer:e}=$oe(n);return{priority:1,enabled:!0,compute(t,i,r){i.pointer.set(t.offsetX/i.size.width*2-1,-(t.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(WE).reduce((t,i)=>({...t,[i]:e(i)}),{}),update:()=>{var t;const{events:i,internal:r}=n.getState();(t=r.lastEvent)!=null&&t.current&&i.handlers&&i.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var i;const{set:r,events:a}=n.getState();a.disconnect==null||a.disconnect(),r(l=>({events:{...l.events,connected:t}})),Object.entries((i=a.handlers)!=null?i:[]).forEach(([l,s])=>{const[d,m]=WE[l];t.addEventListener(d,s,{passive:m})})},disconnect:()=>{const{set:t,events:i}=n.getState();if(i.connected){var r;Object.entries((r=i.handlers)!=null?r:[]).forEach(([a,l])=>{if(i&&i.connected instanceof HTMLElement){const[s]=WE[a];i.connected.removeEventListener(s,l)}}),t(a=>({events:{...a.events,connected:void 0}}))}}}}const yae=$t.forwardRef(function({children:e,fallback:t,resize:i,style:r,gl:a,events:l=_ae,eventSource:s,eventPrefix:d,shadows:m,linear:_,flat:S,legacy:T,orthographic:C,frameloop:P,dpr:k,performance:R,raycaster:O,camera:F,onPointerMissed:N,onCreated:G,...j},Q){$t.useMemo(()=>Noe(Aoe),[]);const re=gae(),[$,ne]=rae({scroll:!0,debounce:{scroll:50,resize:0},...i}),ue=$t.useRef(null),De=$t.useRef(null);$t.useImperativeHandle(Q,()=>ue.current);const $e=QV(N),[ae,le]=$t.useState(!1),[fe,Oe]=$t.useState(!1);if(ae)throw ae;if(fe)throw fe;const We=$t.useRef(null);T1(()=>{const Te=ue.current;ne.width>0&&ne.height>0&&Te&&(We.current||(We.current=nae(Te)),We.current.configure({gl:a,events:l,shadows:m,linear:_,flat:S,legacy:T,orthographic:C,frameloop:P,dpr:k,performance:R,raycaster:O,camera:F,size:ne,onPointerMissed:(...Pe)=>$e.current==null?void 0:$e.current(...Pe),onCreated:Pe=>{Pe.events.connect==null||Pe.events.connect(s?Voe(s)?s.current:s:De.current),d&&Pe.setEvents({compute:(Qe,Ne)=>{const nt=Qe[d+"X"],ze=Qe[d+"Y"];Ne.pointer.set(nt/Ne.size.width*2-1,-(ze/Ne.size.height)*2+1),Ne.raycaster.setFromCamera(Ne.pointer,Ne.camera)}}),G==null||G(Pe)}}),We.current.render($t.createElement(re,null,$t.createElement(e8,{set:Oe},$t.createElement($t.Suspense,{fallback:$t.createElement(Goe,{set:le})},e)))))}),$t.useEffect(()=>{const Te=ue.current;if(Te)return()=>c8(Te)},[]);const ce=s?"none":"auto";return $t.createElement("div",Uv({ref:De,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:ce,...r}},j),$t.createElement("div",{ref:$,style:{width:"100%",height:"100%"}},$t.createElement("canvas",{ref:ue,style:{display:"block"}},t)))}),xae=$t.forwardRef(function(e,t){return $t.createElement(f8,null,$t.createElement(yae,Uv({},e,{ref:t})))});function Vv(n){return Vv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vv(n)}function vae(n,e){if(Vv(n)!=="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(Vv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function wae(n){var e=vae(n,"string");return Vv(e)==="symbol"?e:String(e)}function xi(n,e,t){return e=wae(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}const FF=(n,e)=>(n%e+e)%e;let bae=class extends Mh{constructor(e,t){super(),xi(this,"object",void 0),xi(this,"domElement",void 0),xi(this,"enabled",!0),xi(this,"target",new Fe),xi(this,"minDistance",0),xi(this,"maxDistance",1/0),xi(this,"minZoom",0),xi(this,"maxZoom",1/0),xi(this,"minPolarAngle",0),xi(this,"maxPolarAngle",Math.PI),xi(this,"minAzimuthAngle",-1/0),xi(this,"maxAzimuthAngle",1/0),xi(this,"enableDamping",!1),xi(this,"dampingFactor",.05),xi(this,"enableZoom",!0),xi(this,"zoomSpeed",1),xi(this,"enableRotate",!0),xi(this,"rotateSpeed",1),xi(this,"enablePan",!0),xi(this,"panSpeed",1),xi(this,"screenSpacePanning",!0),xi(this,"keyPanSpeed",7),xi(this,"autoRotate",!1),xi(this,"autoRotateSpeed",2),xi(this,"reverseOrbit",!1),xi(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),xi(this,"mouseButtons",{LEFT:Cm.ROTATE,MIDDLE:Cm.DOLLY,RIGHT:Cm.PAN}),xi(this,"touches",{ONE:Im.ROTATE,TWO:Im.DOLLY_PAN}),xi(this,"target0",void 0),xi(this,"position0",void 0),xi(this,"zoom0",void 0),xi(this,"_domElementKeyEvents",null),xi(this,"getPolarAngle",void 0),xi(this,"getAzimuthalAngle",void 0),xi(this,"setPolarAngle",void 0),xi(this,"setAzimuthalAngle",void 0),xi(this,"getDistance",void 0),xi(this,"listenToKeyEvents",void 0),xi(this,"saveState",void 0),xi(this,"reset",void 0),xi(this,"update",void 0),xi(this,"connect",void 0),xi(this,"dispose",void 0),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object instanceof Yr?this.object.zoom:1,this.getPolarAngle=()=>_.phi,this.getAzimuthalAngle=()=>_.theta,this.setPolarAngle=Ke=>{let It=FF(Ke,2*Math.PI),Zt=_.phi;Zt<0&&(Zt+=2*Math.PI),It<0&&(It+=2*Math.PI);let sn=Math.abs(It-Zt);2*Math.PI-sn<sn&&(It<Zt?It+=2*Math.PI:Zt+=2*Math.PI),S.phi=It-Zt,i.update()},this.setAzimuthalAngle=Ke=>{let It=FF(Ke,2*Math.PI),Zt=_.theta;Zt<0&&(Zt+=2*Math.PI),It<0&&(It+=2*Math.PI);let sn=Math.abs(It-Zt);2*Math.PI-sn<sn&&(It<Zt?It+=2*Math.PI:Zt+=2*Math.PI),S.theta=It-Zt,i.update()},this.getDistance=()=>i.object.position.distanceTo(i.target),this.listenToKeyEvents=Ke=>{Ke.addEventListener("keydown",St),this._domElementKeyEvents=Ke},this.saveState=()=>{i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object instanceof Yr?i.object.zoom:1},this.reset=()=>{i.target.copy(i.target0),i.object.position.copy(i.position0),i.object instanceof Yr&&(i.object.zoom=i.zoom0,i.object.updateProjectionMatrix()),i.dispatchEvent(r),i.update(),d=s.NONE},this.update=(()=>{const Ke=new Fe,It=new da().setFromUnitVectors(e.up,new Fe(0,1,0)),Zt=It.clone().invert(),sn=new Fe,Yn=new da,li=2*Math.PI;return function(){const rt=i.object.position;Ke.copy(rt).sub(i.target),Ke.applyQuaternion(It),_.setFromVector3(Ke),i.autoRotate&&d===s.NONE&&$e(ue()),i.enableDamping?(_.theta+=S.theta*i.dampingFactor,_.phi+=S.phi*i.dampingFactor):(_.theta+=S.theta,_.phi+=S.phi);let Ct=i.minAzimuthAngle,Vt=i.maxAzimuthAngle;return isFinite(Ct)&&isFinite(Vt)&&(Ct<-Math.PI?Ct+=li:Ct>Math.PI&&(Ct-=li),Vt<-Math.PI?Vt+=li:Vt>Math.PI&&(Vt-=li),Ct<=Vt?_.theta=Math.max(Ct,Math.min(Vt,_.theta)):_.theta=_.theta>(Ct+Vt)/2?Math.max(Ct,_.theta):Math.min(Vt,_.theta)),_.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,_.phi)),_.makeSafe(),_.radius*=T,_.radius=Math.max(i.minDistance,Math.min(i.maxDistance,_.radius)),i.enableDamping===!0?i.target.addScaledVector(C,i.dampingFactor):i.target.add(C),Ke.setFromSpherical(_),Ke.applyQuaternion(Zt),rt.copy(i.target).add(Ke),i.object.lookAt(i.target),i.enableDamping===!0?(S.theta*=1-i.dampingFactor,S.phi*=1-i.dampingFactor,C.multiplyScalar(1-i.dampingFactor)):(S.set(0,0,0),C.set(0,0,0)),T=1,P||sn.distanceToSquared(i.object.position)>m||8*(1-Yn.dot(i.object.quaternion))>m?(i.dispatchEvent(r),sn.copy(i.object.position),Yn.copy(i.object.quaternion),P=!1,!0):!1}})(),this.connect=Ke=>{Ke===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),i.domElement=Ke,i.domElement.style.touchAction="none",i.domElement.addEventListener("contextmenu",fn),i.domElement.addEventListener("pointerdown",Vn),i.domElement.addEventListener("pointercancel",ai),i.domElement.addEventListener("wheel",Se)},this.dispose=()=>{var Ke,It,Zt,sn,Yn,li;(Ke=i.domElement)===null||Ke===void 0||Ke.removeEventListener("contextmenu",fn),(It=i.domElement)===null||It===void 0||It.removeEventListener("pointerdown",Vn),(Zt=i.domElement)===null||Zt===void 0||Zt.removeEventListener("pointercancel",ai),(sn=i.domElement)===null||sn===void 0||sn.removeEventListener("wheel",Se),(Yn=i.domElement)===null||Yn===void 0||Yn.ownerDocument.removeEventListener("pointermove",On),(li=i.domElement)===null||li===void 0||li.ownerDocument.removeEventListener("pointerup",Zn),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",St)};const i=this,r={type:"change"},a={type:"start"},l={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=s.NONE;const m=1e-6,_=new lI,S=new lI;let T=1;const C=new Fe;let P=!1;const k=new Ht,R=new Ht,O=new Ht,F=new Ht,N=new Ht,G=new Ht,j=new Ht,Q=new Ht,re=new Ht,$=[],ne={};function ue(){return 2*Math.PI/60/60*i.autoRotateSpeed}function De(){return Math.pow(.95,i.zoomSpeed)}function $e(Ke){i.reverseOrbit?S.theta+=Ke:S.theta-=Ke}function ae(Ke){i.reverseOrbit?S.phi+=Ke:S.phi-=Ke}const le=(()=>{const Ke=new Fe;return function(Zt,sn){Ke.setFromMatrixColumn(sn,0),Ke.multiplyScalar(-Zt),C.add(Ke)}})(),fe=(()=>{const Ke=new Fe;return function(Zt,sn){i.screenSpacePanning===!0?Ke.setFromMatrixColumn(sn,1):(Ke.setFromMatrixColumn(sn,0),Ke.crossVectors(i.object.up,Ke)),Ke.multiplyScalar(Zt),C.add(Ke)}})(),Oe=(()=>{const Ke=new Fe;return function(Zt,sn){const Yn=i.domElement;if(Yn&&i.object instanceof Yr&&i.object.isPerspectiveCamera){const li=i.object.position;Ke.copy(li).sub(i.target);let Bi=Ke.length();Bi*=Math.tan(i.object.fov/2*Math.PI/180),le(2*Zt*Bi/Yn.clientHeight,i.object.matrix),fe(2*sn*Bi/Yn.clientHeight,i.object.matrix)}else Yn&&i.object instanceof fp&&i.object.isOrthographicCamera?(le(Zt*(i.object.right-i.object.left)/i.object.zoom/Yn.clientWidth,i.object.matrix),fe(sn*(i.object.top-i.object.bottom)/i.object.zoom/Yn.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}})();function We(Ke){i.object instanceof Yr&&i.object.isPerspectiveCamera?T/=Ke:i.object instanceof fp&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*Ke)),i.object.updateProjectionMatrix(),P=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ce(Ke){i.object instanceof Yr&&i.object.isPerspectiveCamera?T*=Ke:i.object instanceof fp&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/Ke)),i.object.updateProjectionMatrix(),P=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Te(Ke){k.set(Ke.clientX,Ke.clientY)}function Pe(Ke){j.set(Ke.clientX,Ke.clientY)}function Qe(Ke){F.set(Ke.clientX,Ke.clientY)}function Ne(Ke){R.set(Ke.clientX,Ke.clientY),O.subVectors(R,k).multiplyScalar(i.rotateSpeed);const It=i.domElement;It&&($e(2*Math.PI*O.x/It.clientHeight),ae(2*Math.PI*O.y/It.clientHeight)),k.copy(R),i.update()}function nt(Ke){Q.set(Ke.clientX,Ke.clientY),re.subVectors(Q,j),re.y>0?We(De()):re.y<0&&ce(De()),j.copy(Q),i.update()}function ze(Ke){N.set(Ke.clientX,Ke.clientY),G.subVectors(N,F).multiplyScalar(i.panSpeed),Oe(G.x,G.y),F.copy(N),i.update()}function et(Ke){Ke.deltaY<0?ce(De()):Ke.deltaY>0&&We(De()),i.update()}function Et(Ke){let It=!1;switch(Ke.code){case i.keys.UP:Oe(0,i.keyPanSpeed),It=!0;break;case i.keys.BOTTOM:Oe(0,-i.keyPanSpeed),It=!0;break;case i.keys.LEFT:Oe(i.keyPanSpeed,0),It=!0;break;case i.keys.RIGHT:Oe(-i.keyPanSpeed,0),It=!0;break}It&&(Ke.preventDefault(),i.update())}function Nt(){if($.length==1)k.set($[0].pageX,$[0].pageY);else{const Ke=.5*($[0].pageX+$[1].pageX),It=.5*($[0].pageY+$[1].pageY);k.set(Ke,It)}}function qt(){if($.length==1)F.set($[0].pageX,$[0].pageY);else{const Ke=.5*($[0].pageX+$[1].pageX),It=.5*($[0].pageY+$[1].pageY);F.set(Ke,It)}}function wn(){const Ke=$[0].pageX-$[1].pageX,It=$[0].pageY-$[1].pageY,Zt=Math.sqrt(Ke*Ke+It*It);j.set(0,Zt)}function _n(){i.enableZoom&&wn(),i.enablePan&&qt()}function Ln(){i.enableZoom&&wn(),i.enableRotate&&Nt()}function At(Ke){if($.length==1)R.set(Ke.pageX,Ke.pageY);else{const Zt=Un(Ke),sn=.5*(Ke.pageX+Zt.x),Yn=.5*(Ke.pageY+Zt.y);R.set(sn,Yn)}O.subVectors(R,k).multiplyScalar(i.rotateSpeed);const It=i.domElement;It&&($e(2*Math.PI*O.x/It.clientHeight),ae(2*Math.PI*O.y/It.clientHeight)),k.copy(R)}function Ot(Ke){if($.length==1)N.set(Ke.pageX,Ke.pageY);else{const It=Un(Ke),Zt=.5*(Ke.pageX+It.x),sn=.5*(Ke.pageY+It.y);N.set(Zt,sn)}G.subVectors(N,F).multiplyScalar(i.panSpeed),Oe(G.x,G.y),F.copy(N)}function Ft(Ke){const It=Un(Ke),Zt=Ke.pageX-It.x,sn=Ke.pageY-It.y,Yn=Math.sqrt(Zt*Zt+sn*sn);Q.set(0,Yn),re.set(0,Math.pow(Q.y/j.y,i.zoomSpeed)),We(re.y),j.copy(Q)}function An(Ke){i.enableZoom&&Ft(Ke),i.enablePan&&Ot(Ke)}function pn(Ke){i.enableZoom&&Ft(Ke),i.enableRotate&&At(Ke)}function Vn(Ke){if(i.enabled!==!1){if($.length===0){var It,Zt;(It=i.domElement)===null||It===void 0||It.ownerDocument.addEventListener("pointermove",On),(Zt=i.domElement)===null||Zt===void 0||Zt.ownerDocument.addEventListener("pointerup",Zn)}Nn(Ke),Ke.pointerType==="touch"?tn(Ke):Ti(Ke)}}function On(Ke){i.enabled!==!1&&(Ke.pointerType==="touch"?nn(Ke):Be(Ke))}function Zn(Ke){if(yn(Ke),$.length===0){var It,Zt,sn;(It=i.domElement)===null||It===void 0||It.releasePointerCapture(Ke.pointerId),(Zt=i.domElement)===null||Zt===void 0||Zt.ownerDocument.removeEventListener("pointermove",On),(sn=i.domElement)===null||sn===void 0||sn.ownerDocument.removeEventListener("pointerup",Zn)}i.dispatchEvent(l),d=s.NONE}function ai(Ke){yn(Ke)}function Ti(Ke){let It;switch(Ke.button){case 0:It=i.mouseButtons.LEFT;break;case 1:It=i.mouseButtons.MIDDLE;break;case 2:It=i.mouseButtons.RIGHT;break;default:It=-1}switch(It){case Cm.DOLLY:if(i.enableZoom===!1)return;Pe(Ke),d=s.DOLLY;break;case Cm.ROTATE:if(Ke.ctrlKey||Ke.metaKey||Ke.shiftKey){if(i.enablePan===!1)return;Qe(Ke),d=s.PAN}else{if(i.enableRotate===!1)return;Te(Ke),d=s.ROTATE}break;case Cm.PAN:if(Ke.ctrlKey||Ke.metaKey||Ke.shiftKey){if(i.enableRotate===!1)return;Te(Ke),d=s.ROTATE}else{if(i.enablePan===!1)return;Qe(Ke),d=s.PAN}break;default:d=s.NONE}d!==s.NONE&&i.dispatchEvent(a)}function Be(Ke){if(i.enabled!==!1)switch(d){case s.ROTATE:if(i.enableRotate===!1)return;Ne(Ke);break;case s.DOLLY:if(i.enableZoom===!1)return;nt(Ke);break;case s.PAN:if(i.enablePan===!1)return;ze(Ke);break}}function Se(Ke){i.enabled===!1||i.enableZoom===!1||d!==s.NONE&&d!==s.ROTATE||(Ke.preventDefault(),i.dispatchEvent(a),et(Ke),i.dispatchEvent(l))}function St(Ke){i.enabled===!1||i.enablePan===!1||Et(Ke)}function tn(Ke){switch(Lt(Ke),$.length){case 1:switch(i.touches.ONE){case Im.ROTATE:if(i.enableRotate===!1)return;Nt(),d=s.TOUCH_ROTATE;break;case Im.PAN:if(i.enablePan===!1)return;qt(),d=s.TOUCH_PAN;break;default:d=s.NONE}break;case 2:switch(i.touches.TWO){case Im.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;_n(),d=s.TOUCH_DOLLY_PAN;break;case Im.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ln(),d=s.TOUCH_DOLLY_ROTATE;break;default:d=s.NONE}break;default:d=s.NONE}d!==s.NONE&&i.dispatchEvent(a)}function nn(Ke){switch(Lt(Ke),d){case s.TOUCH_ROTATE:if(i.enableRotate===!1)return;At(Ke),i.update();break;case s.TOUCH_PAN:if(i.enablePan===!1)return;Ot(Ke),i.update();break;case s.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;An(Ke),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;pn(Ke),i.update();break;default:d=s.NONE}}function fn(Ke){i.enabled!==!1&&Ke.preventDefault()}function Nn(Ke){$.push(Ke)}function yn(Ke){delete ne[Ke.pointerId];for(let It=0;It<$.length;It++)if($[It].pointerId==Ke.pointerId){$.splice(It,1);return}}function Lt(Ke){let It=ne[Ke.pointerId];It===void 0&&(It=new Ht,ne[Ke.pointerId]=It),It.set(Ke.pageX,Ke.pageY)}function Un(Ke){const It=Ke.pointerId===$[0].pointerId?$[1]:$[0];return ne[It.pointerId]}t!==void 0&&this.connect(t),this.update()}};const Sae=$t.forwardRef(({makeDefault:n,camera:e,regress:t,domElement:i,enableDamping:r=!0,onChange:a,onStart:l,onEnd:s,...d},m)=>{const _=zf(j=>j.invalidate),S=zf(j=>j.camera),T=zf(j=>j.gl),C=zf(j=>j.events),P=zf(j=>j.setEvents),k=zf(j=>j.set),R=zf(j=>j.get),O=zf(j=>j.performance),F=e||S,N=i||C.connected||T.domElement,G=$t.useMemo(()=>new bae(F),[F]);return l8(()=>{G.enabled&&G.update()},-1),$t.useEffect(()=>(G.connect(N),()=>void G.dispose()),[N,t,G,_]),$t.useEffect(()=>{const j=$=>{_(),t&&O.regress(),a&&a($)},Q=$=>{l&&l($)},re=$=>{s&&s($)};return G.addEventListener("change",j),G.addEventListener("start",Q),G.addEventListener("end",re),()=>{G.removeEventListener("start",Q),G.removeEventListener("end",re),G.removeEventListener("change",j)}},[a,l,s,G,_,P]),$t.useEffect(()=>{if(n){const j=R().controls;return k({controls:G}),()=>k({controls:j})}},[n,G]),$t.createElement("primitive",Uv({ref:m,object:G,enableDamping:r},d))});function Mae(n){const e=$t.useRef(),[t,i]=$t.useState(!1),[r,a]=$t.useState(!1);return l8((l,s)=>e.current.rotation.y+=s),Ma("mesh",{...n,ref:e,scale:r?1.5:1,onClick:l=>a(!r),onPointerOver:l=>i(!0),onPointerOut:l=>i(!1),children:[gr("boxGeometry",{args:[1,3,1]}),gr("meshStandardMaterial",{color:t?"hotpink":"orange"})]})}function Tae(){return Ma("div",{className:"contents",children:[gr("div",{className:"inline"}),Ma(xae,{children:[gr("ambientLight",{intensity:.5}),gr("spotLight",{position:[10,10,10],angle:.15,penumbra:1}),gr("pointLight",{position:[-10,-10,-10]}),gr(Mae,{position:[0,0,0]}),gr(Sae,{})]}),gr("div",{})]})}function Eae(){let n=$t.useRef(),e=$t.useRef(),t=$t.useRef(),[i,r]=$t.useState(0),[a,l]=$t.useState(0),[s,d]=$t.useState(0),[m,_]=$t.useState(0),[S,T]=$t.useState(0),[C,P]=$t.useState(0),[k,R]=$t.useState(0),[O,F]=$t.useState(0),[N,G]=$t.useState("disconnected"),j=new n9.Client("127.0.0.1",1884,"dashboard"),Q=ne=>{ne.errorCode!==0&&console.log("onConnectionLost:"+ne.errorMessage)},re=ne=>{console.log("onMessageArrived:");let ue=ne.payloadString.split(",");console.log(ue);let De=Date.now();r(ue[1]),l(ue[8]),d(ue[9]),_(ue[10]),T(ue[11]),P(ue[12]),R(ue[13]),F(ue[14]),n.current.data.datasets[0].data.push({x:De,y:ue[2]}),n.current.data.datasets[1].data.push({x:De,y:ue[1]}),n.current.update("quiet"),e.current.data.datasets[0].data.push({x:De,y:ue[3]}),e.current.update("quiet"),t.current.data.datasets[0].data.push({x:De,y:ue[4]}),t.current.data.datasets[1].data.push({x:De,y:ue[5]}),t.current.data.datasets[2].data.push({x:De,y:ue[6]}),t.current.data.datasets[3].data.push({x:De,y:ue[7]}),t.current.update("quiet")},$=()=>{console.log("connected"),j.subscribe("esp32")};return j.onConnectionLost=Q,j.onMessageArrived=re,j.connect({onSuccess:$,keepAliveInterval:3600}),gr("div",{className:"lg:max-h-screen max-w-screen overflow-hidden",children:Ma("main",{className:"p-2",children:[Ma("div",{className:"text-sm lg:text-base text-center",children:["The WebSocket is currently ",N]}),Ma("div",{className:"text-xs lg:text-base md:w-2/3 mx-auto font-bold flex flex-wrap justify-between",children:[Ma("span",{children:["Timestamp:"," "]}),Ma("span",{children:["State:",k," "]}),Ma("span",{children:["Altitude: ",i]}),Ma("span",{children:["Longitude:",C," "]}),Ma("span",{children:["Latitude: ",S," "]})]}),Ma("div",{className:"grid grid-cols-1 lg:grid-cols-3",children:[gr("div",{children:gr(_K,{url:"http://192.168.0.103:81/stream"})}),gr("div",{className:"lg:order-first w-full lg:w-10/12 lg:col-span-2",children:gr(Tae,{})})]}),Ma("div",{className:"grid grid-cols-1 lg:grid-cols-3",children:[gr("div",{className:"w-full lg:w-11/12",children:gr(Z2,{ref:n,type:"altitude"})}),gr("div",{className:"w-full lg:w-11/12",children:gr(Z2,{ref:e,type:"velocity"})}),gr("div",{className:"w-full lg:w-11/12",children:gr(Z2,{ref:t,type:"acceleration"})})]})]})})}HE.createRoot(document.getElementById("root")).render(gr(_I.StrictMode,{children:gr(Eae,{})}));
